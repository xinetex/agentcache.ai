<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AgentCache.ai - Growth Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-neutral-950 text-neutral-100 antialiased">
  <!-- Header -->
  <header class="border-b border-white/10 bg-neutral-900/50 backdrop-blur">
    <div class="mx-auto max-w-7xl px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 grid place-content-center rounded-md bg-white/5 ring-1 ring-white/10">
          <span class="text-sm font-semibold">AC</span>
        </div>
        <span class="text-sm font-semibold">AgentCache.ai <span class="text-neutral-500">/ Growth Dashboard</span></span>
      </div>
      <button id="refresh-btn" class="inline-flex items-center gap-2 rounded-md px-3 py-1.5 text-sm text-neutral-300 ring-1 ring-white/10 hover:bg-white/5 transition">
        <i data-lucide="refresh-cw" class="h-4 w-4"></i>
        Refresh
      </button>
    </div>
  </header>

  <div class="mx-auto max-w-7xl px-6 py-8">
    <!-- Goal Progress -->
    <div class="rounded-xl ring-1 ring-indigo-500/30 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-2xl font-semibold">Path to 50 Users</h1>
          <p class="text-sm text-neutral-400 mt-1">When we hit 50, we launch Stripe billing ðŸš€</p>
        </div>
        <div class="text-right">
          <div id="user-count" class="text-4xl font-bold text-white">0</div>
          <div class="text-sm text-neutral-400">/ 50 users</div>
        </div>
      </div>
      
      <!-- Progress Bar -->
      <div class="relative h-4 rounded-full bg-white/10 overflow-hidden">
        <div id="progress-bar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-1000" style="width: 0%"></div>
      </div>
      <div class="mt-2 flex justify-between text-xs text-neutral-400">
        <span id="progress-text">0% complete</span>
        <span id="remaining-text">50 users to go</span>
      </div>
    </div>

    <!-- Key Metrics Grid -->
    <div class="grid md:grid-cols-4 gap-4 mb-8">
      <!-- Total Users -->
      <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-5">
        <div class="flex items-center gap-2 text-sm text-neutral-400 mb-2">
          <i data-lucide="users" class="h-4 w-4"></i>
          Total Users
        </div>
        <div id="total-users" class="text-3xl font-semibold">0</div>
        <div class="mt-2 text-xs text-emerald-400">
          <span id="new-users-today">+0 today</span>
        </div>
      </div>

      <!-- API Keys -->
      <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-5">
        <div class="flex items-center gap-2 text-sm text-neutral-400 mb-2">
          <i data-lucide="key" class="h-4 w-4"></i>
          API Keys
        </div>
        <div id="api-keys" class="text-3xl font-semibold">0</div>
        <div class="mt-2 text-xs text-neutral-400">
          <span id="demo-keys">0 demo</span> â€¢ <span id="live-keys">0 live</span>
        </div>
      </div>

      <!-- Cache Hits Today -->
      <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-5">
        <div class="flex items-center gap-2 text-sm text-neutral-400 mb-2">
          <i data-lucide="zap" class="h-4 w-4"></i>
          Cache Hits
        </div>
        <div id="cache-hits" class="text-3xl font-semibold">0</div>
        <div class="mt-2 text-xs text-neutral-400">
          <span id="hit-rate">0%</span> hit rate
        </div>
      </div>

      <!-- Cost Saved -->
      <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-5">
        <div class="flex items-center gap-2 text-sm text-neutral-400 mb-2">
          <i data-lucide="dollar-sign" class="h-4 w-4"></i>
          Saved Today
        </div>
        <div id="cost-saved" class="text-3xl font-semibold">$0</div>
        <div class="mt-2 text-xs text-emerald-400">
          <span id="monthly-projection">~$0/mo</span>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="grid lg:grid-cols-2 gap-6 mb-8">
      <!-- Growth Chart -->
      <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-6">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i data-lucide="trending-up" class="h-5 w-5"></i>
          User Growth (Last 7 Days)
        </h3>
        <div id="growth-chart" class="h-48 flex items-end gap-2">
          <!-- Will be populated by JS -->
        </div>
      </div>

      <!-- Top Users -->
      <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-6">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i data-lucide="star" class="h-5 w-5"></i>
          Power Users
        </h3>
        <div id="top-users" class="space-y-3">
          <div class="text-sm text-neutral-400 text-center py-8">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-6">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
        <i data-lucide="activity" class="h-5 w-5"></i>
        Recent Activity
      </h3>
      <div id="recent-activity" class="space-y-2">
        <div class="text-sm text-neutral-400 text-center py-8">Loading...</div>
      </div>
    </div>

    <!-- Milestones -->
    <div class="mt-8 rounded-xl ring-1 ring-white/10 bg-white/[0.03] p-6">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
        <i data-lucide="flag" class="h-5 w-5"></i>
        Milestones
      </h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <div id="milestone-1" class="h-8 w-8 rounded-full bg-white/5 ring-1 ring-white/10 grid place-content-center">
            <i data-lucide="circle" class="h-4 w-4 text-neutral-500"></i>
          </div>
          <div class="flex-1">
            <div class="text-sm font-semibold">First User</div>
            <div class="text-xs text-neutral-400">Launch to the world</div>
          </div>
          <div id="milestone-1-status" class="text-xs text-neutral-500">0 / 1</div>
        </div>
        
        <div class="flex items-center gap-3">
          <div id="milestone-10" class="h-8 w-8 rounded-full bg-white/5 ring-1 ring-white/10 grid place-content-center">
            <i data-lucide="circle" class="h-4 w-4 text-neutral-500"></i>
          </div>
          <div class="flex-1">
            <div class="text-sm font-semibold">10 Users</div>
            <div class="text-xs text-neutral-400">Product-market fit validation</div>
          </div>
          <div id="milestone-10-status" class="text-xs text-neutral-500">0 / 10</div>
        </div>
        
        <div class="flex items-center gap-3">
          <div id="milestone-20" class="h-8 w-8 rounded-full bg-white/5 ring-1 ring-white/10 grid place-content-center">
            <i data-lucide="circle" class="h-4 w-4 text-neutral-500"></i>
          </div>
          <div class="flex-1">
            <div class="text-sm font-semibold">20 Users</div>
            <div class="text-xs text-neutral-400">Prepare Stripe integration</div>
          </div>
          <div id="milestone-20-status" class="text-xs text-neutral-500">0 / 20</div>
        </div>
        
        <div class="flex items-center gap-3">
          <div id="milestone-50" class="h-8 w-8 rounded-full bg-indigo-500/20 ring-1 ring-indigo-500/30 grid place-content-center">
            <i data-lucide="rocket" class="h-4 w-4 text-indigo-400"></i>
          </div>
          <div class="flex-1">
            <div class="text-sm font-semibold text-indigo-300">50 Users ðŸŽ¯</div>
            <div class="text-xs text-neutral-400">Launch billing & go-to-market</div>
          </div>
          <div id="milestone-50-status" class="text-xs text-indigo-400">0 / 50</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize Lucide icons
    if (window.lucide) {
      window.lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });
    }

    // Dashboard state
    let currentData = null;

    // Fetch dashboard data
    async function fetchDashboardData() {
      try {
        const response = await fetch('/api/admin-stats', {
          headers: {
            'X-Admin-Token': localStorage.getItem('admin_token') || ''
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            promptAdminToken();
            return;
          }
          throw new Error('Failed to fetch data');
        }
        
        currentData = await response.json();
        updateDashboard(currentData);
      } catch (error) {
        console.error('Error fetching dashboard data:', error);
        showError('Failed to load dashboard data');
      }
    }

    // Prompt for admin token
    function promptAdminToken() {
      const token = prompt('Enter admin token:');
      if (token) {
        localStorage.setItem('admin_token', token);
        fetchDashboardData();
      }
    }

    // Update dashboard with data
    function updateDashboard(data) {
      const users = data.total_users || 0;
      const progress = Math.min((users / 50) * 100, 100);
      
      // Update progress
      document.getElementById('user-count').textContent = users;
      document.getElementById('progress-bar').style.width = progress + '%';
      document.getElementById('progress-text').textContent = progress.toFixed(1) + '% complete';
      document.getElementById('remaining-text').textContent = Math.max(0, 50 - users) + ' users to go';
      
      // Update metrics
      document.getElementById('total-users').textContent = users;
      document.getElementById('new-users-today').textContent = '+' + (data.new_users_today || 0) + ' today';
      document.getElementById('api-keys').textContent = data.total_keys || 0;
      document.getElementById('demo-keys').textContent = (data.demo_keys || 0) + ' demo';
      document.getElementById('live-keys').textContent = (data.live_keys || 0) + ' live';
      document.getElementById('cache-hits').textContent = formatNumber(data.cache_hits_today || 0);
      document.getElementById('hit-rate').textContent = (data.hit_rate || 0).toFixed(1) + '%';
      document.getElementById('cost-saved').textContent = data.cost_saved_today || '$0.00';
      document.getElementById('monthly-projection').textContent = '~' + (data.monthly_projection || '$0.00') + '/mo';
      
      // Update milestones
      updateMilestone(1, users);
      updateMilestone(10, users);
      updateMilestone(20, users);
      updateMilestone(50, users);
      
      // Update growth chart
      updateGrowthChart(data.growth_data || []);
      
      // Update top users
      updateTopUsers(data.top_users || []);
      
      // Update recent activity
      updateRecentActivity(data.recent_activity || []);
    }

    // Update milestone status
    function updateMilestone(target, current) {
      const icon = document.querySelector(`#milestone-${target} i`);
      const status = document.getElementById(`milestone-${target}-status`);
      
      if (current >= target) {
        icon.setAttribute('data-lucide', 'check-circle');
        icon.className = 'h-4 w-4 text-emerald-400';
        status.textContent = 'âœ“ Complete';
        status.className = 'text-xs text-emerald-400';
      } else {
        status.textContent = current + ' / ' + target;
      }
      
      if (window.lucide) window.lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });
    }

    // Update growth chart
    function updateGrowthChart(data) {
      const chart = document.getElementById('growth-chart');
      if (data.length === 0) {
        chart.innerHTML = '<div class="text-sm text-neutral-400 text-center w-full">No data yet</div>';
        return;
      }
      
      const max = Math.max(...data.map(d => d.users), 1);
      chart.innerHTML = data.map((d, i) => `
        <div class="flex-1 flex flex-col items-center gap-2">
          <div class="w-full bg-indigo-500/30 rounded-t transition-all hover:bg-indigo-500/50" 
               style="height: ${(d.users / max) * 100}%"
               title="${d.users} users on ${d.date}"></div>
          <div class="text-xs text-neutral-500">${d.day}</div>
        </div>
      `).join('');
    }

    // Update top users
    function updateTopUsers(users) {
      const container = document.getElementById('top-users');
      if (users.length === 0) {
        container.innerHTML = '<div class="text-sm text-neutral-400 text-center py-4">No users yet</div>';
        return;
      }
      
      container.innerHTML = users.slice(0, 5).map((user, i) => `
        <div class="flex items-center justify-between py-2 border-b border-white/5">
          <div class="flex items-center gap-3">
            <div class="text-neutral-500 text-sm">${i + 1}</div>
            <div>
              <div class="text-sm font-semibold">${user.email || 'Anonymous'}</div>
              <div class="text-xs text-neutral-400">${formatNumber(user.requests || 0)} requests</div>
            </div>
          </div>
          <div class="text-xs text-emerald-400">${user.hit_rate || 0}% hit rate</div>
        </div>
      `).join('');
    }

    // Update recent activity
    function updateRecentActivity(activities) {
      const container = document.getElementById('recent-activity');
      if (activities.length === 0) {
        container.innerHTML = '<div class="text-sm text-neutral-400 text-center py-4">No activity yet</div>';
        return;
      }
      
      container.innerHTML = activities.slice(0, 10).map(activity => `
        <div class="flex items-center gap-3 py-2 text-sm border-b border-white/5">
          <div class="text-neutral-500">${formatTime(activity.timestamp)}</div>
          <div class="flex-1 text-neutral-300">${activity.message}</div>
        </div>
      `).join('');
    }

    // Format numbers
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    // Format time
    function formatTime(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
      if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
      return Math.floor(diff / 86400000) + 'd ago';
    }

    // Show error
    function showError(message) {
      console.error(message);
      // Could show a toast notification here
    }

    // Refresh button
    document.getElementById('refresh-btn').addEventListener('click', () => {
      fetchDashboardData();
    });

    // Initial load
    fetchDashboardData();

    // Auto-refresh every 30 seconds
    setInterval(fetchDashboardData, 30000);
  </script>
</body>
</html>
