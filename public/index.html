<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentCache | Intelligence Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=JetBrains+Mono:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/assets/premium.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            500: '#0ea5e9',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Specific Bento Styles */
        body {
            background-color: #e2e8f0;
            /* Light/silver bg like Drgnflai */
            overflow: hidden;
            /* Dashboard feel */
            color: #0f172a;
        }

        .dark-mode {
            background-color: #0f172a;
            color: #f8fafc;
        }

        .card-bg {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
        }

        .dark-mode .card-bg {
            background: rgba(15, 23, 42, 0.8);
        }

        .bento-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(12, 1fr);
            /* Fixed rows for dashboard feel */
            gap: 1.5rem;
            height: 100vh;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .bento-grid {
                display: flex;
                flex-direction: column;
                height: auto;
                min-height: 100vh;
                overflow-y: visible;
                padding: 1rem;
            }

            .tile-bottom {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
                padding: 1.5rem !important;
            }

            .tile-bottom>div:first-child {
                flex-wrap: wrap;
                justify-content: center;
            }

            .h-12.w-px {
                display: none;
                /* Hide vertical separator on mobile */
            }

            #stats-cycle {
                width: 100%;
                margin-left: 0 !important;
                justify-content: center !important;
            }

            /* Adjust cycling text size */
            .cycling-text {
                font-size: 3rem !important;
                /* Smaller than 5rem */
            }

            /* Mission text adjustments */
            #mission-text {
                font-size: 3rem;
            }
        }

        /* Mission Tile (Top Left) */
        .tile-mission {
            grid-column: span 8;
            grid-row: span 8;
            background-color: #020617;
            /* Dark navy */
            color: white;
            position: relative;
            overflow: hidden;
            border-radius: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
        }

        /* Side Tiles (Top Right) */
        .tile-side {
            grid-column: span 4;
            grid-row: span 4;
            border-radius: 1.5rem;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            /* transition: transform 0.2s; Handled by anime.js now */
        }

        /* .tile-side:hover {
            transform: scale(1.02);
            z-index: 10;
        } */

        /* Bottom Section (Incubator/Status) */
        .tile-bottom {
            grid-column: span 12;
            grid-row: span 4;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .cycling-text {
            font-size: 5rem;
            font-weight: 900;
            line-height: 0.9;
            text-transform: uppercase;
            letter-spacing: -0.05em;
            /* transition: opacity 0.5s; Handled by anime.js */
        }

        .slide-panel {
            position: fixed;
            bottom: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .rsvp-word {
            font-weight: 900;
            line-height: 0.9;
            text-transform: uppercase;
            letter-spacing: -0.05em;
            transition: color 0.1s;
        }

        .dark-mode .slide-panel {
            background: rgba(15, 23, 42, 0.95);
        }
    </style>
</head>

<body class="selection:bg-cyan-500 selection:text-white transition-colors duration-500">

    <!-- Header -->
    <div class="fixed top-0 left-0 w-full p-6 flex justify-between items-center z-50 pointer-events-none">
        <div>
            <h1 id="header-logo-text"
                class="font-black text-2xl tracking-tighter uppercase text-slate-800 dark:text-white pointer-events-auto">
                AgentCache</h1>
            <p class="text-[10px] font-mono tracking-[0.2em] text-slate-500 uppercase">Agent Exchange // v3.0</p>
        </div>
        <button onclick="toggleTheme()"
            class="pointer-events-auto p-2 rounded-full bg-slate-200 dark:bg-slate-800 hover:opacity-80 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
        </button>
    </div>

    <!-- Main Grid -->
    <div class="bento-grid pt-24" id="main-grid">

        <!-- Mission Tile (Left Large) -->
        <div class="tile-mission shadow-2xl group relative">
            <div class="text-[10px] font-mono tracking-[0.3em] text-cyan-400 absolute top-8 left-8 uppercase z-20">
                Mission
                Protocol</div>

            <!-- Animated Background Grid -->
            <div class="absolute inset-0 z-0 opacity-20"
                style="background-image: radial-gradient(#0ea5e9 1px, transparent 1px); background-size: 40px 40px;">
            </div>

            <div id="rsvp-target" class="cycling-text relative z-10 leading-none tracking-tighter rsvp-word">
                DEPLOY<br>YOUR<br><span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600">AGENTS</span>
            </div>

            <p class="mt-8 text-slate-400 max-w-lg text-xl leading-relaxed font-light relative z-10">
                <span class="text-white font-medium">The Global Agent Marketplace.</span><br>
                Buy and sell high-fidelity intelligence. Connect workflows. Automate the economy.
            </p>

            <div class="absolute bottom-8 right-8 flex gap-3 items-center">
                <div class="flex gap-1 h-3 items-end">
                    <div class="w-1 bg-cyan-500 h-full animate-pulse"></div>
                    <div class="w-1 bg-cyan-500 h-2/3 animate-pulse" style="animation-delay: 100ms"></div>
                    <div class="w-1 bg-cyan-500 h-1/2 animate-pulse" style="animation-delay: 200ms"></div>
                </div>
                <span class="text-[10px] font-mono text-cyan-500 tracking-widest">NEURAL LINK ACTIVE</span>
            </div>
        </div>

        <!-- Tile 1: Agent Exchange (Replaces Reasoning Visualizer) -->
        <div class="tile-side card-bg shadow-xl border border-white/10 group overflow-hidden relative"
            onclick="window.location.href='/dashboard-local.html'">
            <!-- Scanline effect -->
            <div
                class="absolute inset-0 bg-gradient-to-b from-transparent via-cyan-500/5 to-transparent z-0 opacity-50 pointer-events-none animate-scan">
            </div>

            <div class="relative z-10 p-8 h-full flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-2xl font-black uppercase tracking-tight mb-1">Agent<br>Exchange</h3>
                        <p class="text-[10px] font-mono tracking-widest text-cyan-500 uppercase">Status: <span
                                class="text-emerald-500 animate-pulse">LIVE</span></p>
                    </div>
                    <div class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.8)]"></div>
                </div>

                <!-- Live Ticker -->
                <div class="space-y-3 font-mono text-xs mt-4">
                    <div class="flex gap-2 items-center opacity-70">
                        <span class="text-cyan-400">ASK</span>
                        <span class="text-slate-500">Research Report</span>
                        <div class="flex-1 border-b border-dashed border-slate-700"></div>
                        <span class="text-white">$15.00</span>
                    </div>
                    <div class="flex gap-2 items-center opacity-70">
                        <span class="text-cyan-400">ASK</span>
                        <span class="text-slate-500">Code Audit</span>
                        <div class="flex-1 border-b border-dashed border-slate-700"></div>
                        <span class="text-white">$25.00</span>
                    </div>
                    <div class="flex gap-2 items-center opacity-40">
                        <span class="text-slate-500">BID</span>
                        <span class="text-slate-600">Verification</span>
                        <div class="flex-1 border-b border-dashed border-slate-800"></div>
                        <span class="text-slate-600">$5.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tile 2: Workflows (Replaces Deploy Core) -->
        <div class="tile-side card-bg shadow-xl border border-white/10 group relative overflow-hidden"
            onclick="window.location.href='/workflows.html'">
            <div
                class="absolute -right-12 -top-12 w-48 h-48 bg-purple-500/20 rounded-full blur-3xl group-hover:bg-purple-500/30 transition">
            </div>

            <div class="relative z-10 p-8 h-full flex flex-col justify-between">
                <div>
                    <h3 class="text-2xl font-black uppercase tracking-tight mb-1">Workflow<br>Engine</h3>
                    <p class="text-[10px] font-mono tracking-widest text-purple-400 uppercase">Pipe Intelligence</p>
                </div>

                <div
                    class="text-4xl font-mono font-bold tracking-tighter text-slate-700 dark:text-white group-hover:translate-x-2 transition cursor-pointer">
                    Build <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Flows</span>
                    <span class="text-lg text-slate-500">-></span>
                </div>
            </div>
        </div>

        <!-- Bottom Row: Services + Stats -->
        <div class="tile-bottom px-8 flex justify-between items-center group">
            <!-- Left: Services -->
            <div class="flex items-center gap-6">
                <div class="group/icon relative cursor-pointer" onmouseenter="pulseIcon(this)"
                    onclick="window.location.href='/services#cache'">
                    <div
                        class="w-16 h-16 rounded-2xl bg-white shadow-lg flex items-center justify-center text-3xl group-hover/icon:scale-105 transition">
                        ‚ö°Ô∏è</div>
                    <div
                        class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold tracking-widest uppercase opacity-0 group-hover/icon:opacity-100 transition">
                        Cache</div>
                </div>
                <div class="group/icon relative cursor-pointer" onmouseenter="pulseIcon(this)"
                    onclick="window.location.href='/services#memory'">
                    <div
                        class="w-16 h-16 rounded-2xl bg-white shadow-lg flex items-center justify-center text-3xl group-hover/icon:scale-105 transition">
                        üß†</div>
                    <div
                        class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold tracking-widest uppercase opacity-0 group-hover/icon:opacity-100 transition">
                        Memory</div>
                </div>
                <div class="group/icon relative cursor-pointer" onmouseenter="pulseIcon(this)"
                    onclick="window.location.href='/services#security'">
                    <div
                        class="w-16 h-16 rounded-2xl bg-white shadow-lg flex items-center justify-center text-3xl group-hover/icon:scale-105 transition">
                        üõ°Ô∏è</div>
                    <div
                        class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold tracking-widest uppercase opacity-0 group-hover/icon:opacity-100 transition">
                        Security</div>
                </div>

                <div class="h-12 w-px bg-slate-300 dark:bg-slate-700 mx-4"></div>
                <div class="text-xl font-black uppercase tracking-tight text-slate-300 dark:text-slate-700 select-none cursor-pointer"
                    onclick="window.location.href='/services'">
                    SERVICES</div>
            </div>

            <!-- Right: Live Stats Cycle -->
            <div id="stats-cycle" class="flex-1 flex justify-end items-center h-full ml-12">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Slide Up Panel -->
    <div id="panel" class="slide-panel">
        <div class="max-w-4xl w-full h-full overflow-y-auto p-12 pt-24 relative">
            <button onclick="closePanel()"
                class="absolute top-8 right-8 p-4 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>

            <div id="panel-content" class="mt-8 opacity-0 translate-y-8">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <script>
        // State
        let contentData = null;
        let cycles = {}; // Store intervals

        // DOM Elements
        const els = {
            mission: document.getElementById('mission-text'),
            usecases: document.getElementById('usecases-cycle'),
            pricing: document.getElementById('pricing-cycle'),
            stats: document.getElementById('stats-cycle'),
            panel: document.getElementById('panel'),
            panelContent: document.getElementById('panel-content')
        };

        // Initialize
        async function init() {
            // Theme check
            if (!document.body.classList.contains('dark-mode')) {
                document.body.classList.add('dark-mode');
            }

            // Fetch Data
            try {
                const res = await fetch('/api/content');
                contentData = await res.json();

                // Apply Theme Settings
                if (contentData.settings) {
                    applyTheme(contentData.settings);
                }

                // Start Cycles
                setupCycles();
                startRSVP();

                // Animate Entrance
                anime({
                    targets: '.bento-grid > div',
                    opacity: [0, 1],
                    translateY: [20, 0],
                    delay: anime.stagger(100),
                    easing: 'easeOutExpo',
                    duration: 1200
                });
            } catch (err) {
                console.error("Failed to load content:", err);
                // Even on error, start visualizer if elements exist
                if (document.getElementById('latency-counter')) startVisualizer();
            }
        }

        function applyTheme(settings) {
            if (!settings) return;

            // 1. Logo / Org Name
            const headerTitle = document.getElementById('header-logo-text');
            if (headerTitle) {
                if (settings.logoUrl) {
                    headerTitle.innerHTML = `<img src="${settings.logoUrl}" alt="${settings.orgName}" class="h-10 object-contain">`;
                } else if (settings.orgName) {
                    headerTitle.innerText = settings.orgName;
                }
            }

            if (settings.orgName) {
                document.title = `${settings.orgName} | Intelligence Module`;
            }

            // 2. Dynamic Colors
            if (settings.accentColor || settings.darkModeBg) {
                const c = settings.accentColor || '#0ea5e9'; // Default blue
                const bg = settings.darkModeBg || '#0f172a'; // Default slate-900

                document.documentElement.style.setProperty('--theme-color', c);

                let style = document.getElementById('theme-overrides');
                if (!style) {
                    style = document.createElement('style');
                    style.id = 'theme-overrides';
                    document.head.appendChild(style);
                }

                // Override Tailwind Classes
                // We target the specific cyan/blue classes used in the bento grid
                style.innerHTML = `
                    .dark-mode { background-color: ${bg} !important; }
                    .dark-mode .slide-panel { background-color: ${bg}FA !important; } /* High opacity bg */
                    
                    .text-cyan-400, .text-cyan-500, .text-blue-400 { color: ${c} !important; }
                    .bg-cyan-500, .bg-cyan-400, .bg-blue-500 { background-color: ${c} !important; }
                    .from-cyan-400, .from-blue-400 { --tw-gradient-from: ${c} !important; }
                    .to-cyan-400, .to-cyan-500, .to-blue-600 { --tw-gradient-to: ${c} !important; }
                    .border-cyan-500 { border-color: ${c} !important; }
                    .shadow-\\[0_0_10px_rgba\\(34\\,211\\,238\\,0\\.8\\)\\] { box-shadow: 0 0 10px ${c}CC !important; }
                    .selection\\:bg-cyan-500 *::selection { background-color: ${c} !important; }
                    
                    /* Radial Gradient Hack for Mission Tile */
                    .tile-mission .absolute.inset-0 {
                        background-image: radial-gradient(${c} 1px, transparent 1px) !important;
                    }
                `;
            }
        }

        // Reasoning Visualizer Animation
        function startVisualizer() {
            // (Legacy function kept for compatibility if visualizer tile is restored)
        }

        function startRSVP() {
            const display = document.getElementById('rsvp-target');
            if (!display) return;

            const words = [
                ["DEPLOY", "YOUR", "AGENTS"],
                ["SCALE", "YOUR", "SWARM"],
                ["CACHE", "YOUR", "THOUGHTS"],
                ["MONETIZE", "YOUR", "CODE"],
                ["OWN", "YOUR", "DATA"]
            ];

            let groupIndex = 0;

            setInterval(() => {
                groupIndex = (groupIndex + 1) % words.length;
                const group = words[groupIndex];

                // Color logic
                let highlightClass = "text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600";
                if (group[2] === "SWARM") highlightClass = "text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600";
                if (group[2] === "CODE") highlightClass = "text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-green-600";

                // Animate Out
                anime({
                    targets: display,
                    opacity: [1, 0],
                    translateY: [0, -10],
                    scale: [1, 0.9],
                    easing: 'easeInExpo',
                    duration: 300,
                    complete: () => {
                        display.innerHTML = `${group[0]}<br>${group[1]}<br><span class="${highlightClass}">${group[2]}</span>`;

                        // Animate In
                        anime({
                            targets: display,
                            opacity: [0, 1],
                            translateY: [10, 0],
                            scale: [1.1, 1],
                            easing: 'easeOutExpo',
                            duration: 600
                        });
                    }
                });

            }, 4000); // Cycle every 4 seconds
        }


        // Setup Cycles based on API data
        function setupCycles() {
            const missionCards = contentData.cards.filter(c => c.laneId === 'mission');
            const usecaseCards = contentData.cards.filter(c => c.laneId === 'usecases');
            // Support both pricing and monitor lanes for backward compat, or just pricing
            const pricingCards = contentData.cards.filter(c => c.laneId === 'pricing').length ?
                contentData.cards.filter(c => c.laneId === 'pricing') :
                contentData.cards.filter(c => c.laneId === 'monitor');
            const statsCards = contentData.cards.filter(c => c.laneId === 'stats');

            startCycle(els.mission, missionCards, 4000);
            startCycle(els.usecases, usecaseCards, 3000);
            startCycle(els.pricing, pricingCards, 3500);
            startCycle(els.stats, statsCards, 3000);
        }

        function startCycle(element, cards, speed) {
            if (!cards || !cards.length || !element) return;

            let i = 0;
            // Initial render
            renderCard(element, cards[0]);

            const interval = setInterval(() => {
                i = (i + 1) % cards.length;

                // Anime.js transition
                anime({
                    targets: element,
                    opacity: [1, 0],
                    translateY: [0, -10],
                    easing: 'easeInQuad',
                    duration: 300,
                    complete: () => {
                        renderCard(element, cards[i]);
                        anime({
                            targets: element,
                            opacity: [0, 1],
                            translateY: [10, 0],
                            easing: 'easeOutQuad',
                            duration: 400
                        });
                    }
                });
            }, speed);

            cycles[element.id] = interval;
        }

        function renderCard(element, card) {
            // Check if it's the Mission Hero text or standard card
            if (card.template === 'hero') {
                element.innerHTML = card.data.title.replace(' ', '<br>');
            } else if (card.template === 'stat') {
                element.innerHTML = `
                    <div class="flex items-center gap-8 w-full justify-end pr-8">
                        <div class="text-right">
                            <div class="text-xs font-mono tracking-widest text-slate-500 uppercase mb-1">${card.data.subtitle}</div>
                            <div class="text-sm text-slate-400 max-w-xs leading-tight">${card.data.content}</div>
                        </div>
                        <div class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-500 tracking-tighter">${card.data.title}</div>
                    </div>
                `;
            } else {
                element.innerHTML = `
                    <div>
                        <div class="text-indigo-400 text-xs font-mono uppercase mb-1">${card.data.subtitle}</div>
                        <div>${card.data.title}</div>
                    </div>
                `;
            }
        }

        // Interactions
        window.hoverCard = (el) => {
            anime({
                targets: el,
                scale: 1.02,
                duration: 400,
                easing: 'easeOutExpo'
            });
        };

        window.unhoverCard = (el) => {
            anime({
                targets: el,
                scale: 1.0,
                duration: 400,
                easing: 'easeOutExpo'
            });
        };

        window.pulseIcon = (el) => {
            anime({
                targets: el,
                scale: [1, 1.2, 1],
                duration: 600,
                easing: 'easeOutElastic(1, .5)'
            });
        }

        // Panel Logic
        window.openPanel = (laneId) => {
            // Find content from API data
            const cards = contentData.cards.filter(c => c.laneId === laneId);
            if (!cards.length) return;

            // Simple render of all cards in that lane for "Deep Dive"
            // In a real app we'd click a specific card, but here we show the lane category
            let html = `<h2 class="text-6xl font-black mb-12 uppercase tracking-tighter text-slate-900 dark:text-white">${contentData.lanes.find(l => l.id === laneId).title}</h2>`;

            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-8">';
            cards.forEach(card => {
                html += `
                    <div class="p-8 rounded-2xl bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                        <div class="text-indigo-500 font-bold tracking-widest text-xs uppercase mb-4">${card.data.subtitle}</div>
                        <h3 class="font-bold text-3xl mb-4 text-slate-800 dark:text-white">${card.data.title}</h3>
                        <p class="text-slate-500 text-lg leading-relaxed">${card.data.content}</p>
                    </div>
                `;
            });
            html += '</div>';

            html += `
                <div class="mt-16 flex justify-center">
                    <a href="/index.html" class="inline-flex items-center gap-2 px-8 py-4 bg-cyan-600 text-white font-bold rounded-full hover:bg-cyan-500 transition shadow-lg hover:shadow-cyan-500/25">
                        <span>EXPLORE FULL SITE</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </a>
                </div>
            `;

            els.panelContent.innerHTML = html;

            // Slide Up Panel
            anime({
                targets: els.panel,
                bottom: '0%',
                easing: 'cubicBezier(0.16, 1, 0.3, 1)', // Apple-style ease
                duration: 600
            });

            // Fade in content
            anime({
                targets: els.panelContent,
                opacity: [0, 1],
                translateY: [20, 0],
                delay: 200,
                easing: 'easeOutExpo',
                duration: 800
            });
        };

        window.closePanel = () => {
            anime({
                targets: els.panel,
                bottom: '-100%',
                easing: 'cubicBezier(0.16, 1, 0.3, 1)',
                duration: 500
            });
        };

        // Theme Toggle
        window.toggleTheme = () => {
            document.body.classList.toggle('dark-mode');
        };

        // Run
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>