<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <title>Mission Control - AgentCache</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: #e5e7eb;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
    </style>
</head>

<body class="h-screen flex overflow-hidden">

    <!-- 1. LEFT SIDEBAR (Navigation) -->
    <aside class="w-64 bg-[#09090b] border-r border-white/5 flex flex-col justify-between shrink-0 z-20">
        <div>
            <div class="h-14 flex items-center px-6 border-b border-white/5">
                <div class="flex items-center gap-2 text-white font-bold tracking-tight">
                    <iconify-icon icon="solar:infinity-bold" class="text-emerald-500"></iconify-icon>
                    AgentCache
                </div>
            </div>
            <nav class="p-4 space-y-1">
                <a href="/mission-control.html"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium text-white bg-white/5 rounded-lg border border-white/5">
                    <iconify-icon icon="solar:widget-linear"></iconify-icon> Dashboard
                </a>
                <a href="/user-dashboard.html"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium text-gray-500 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                    <iconify-icon icon="solar:users-group-rounded-linear"></iconify-icon> Workspace
                </a>
                <a href="/agents.html"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium text-gray-500 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                    <iconify-icon icon="solar:graph-new-linear"></iconify-icon> Agents
                </a>
                <div class="pt-4 pb-2">
                    <div class="px-3 text-[10px] font-bold text-gray-600 uppercase tracking-widest">Sectors
                    </div>
                </div>
                <a href="/sector.html?name=finance"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium text-gray-500 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                    <iconify-icon icon="solar:wallet-money-linear"></iconify-icon> Finance
                </a>
                <a href="/sector.html?name=biotech"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium text-gray-500 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                    <iconify-icon icon="solar:atom-linear"></iconify-icon> Biologics
                </a>
            </nav>
        </div>
        <div class="p-4 border-t border-white/5">
            <div class="flex items-center gap-3 px-3 py-2">
                <div
                    class="w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-xs font-bold text-emerald-400">
                    DT</div>
                <div class="text-xs">
                    <div class="text-white font-medium">Dev Team</div>
                    <div class="text-gray-600">Pro Plan</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- 2. MAIN CONTENT (Center) -->
    <main class="flex-1 overflow-y-auto bg-[#050505] relative custom-scrollbar">
        <!-- Top Bar -->
        <header
            class="h-14 border-b border-white/5 flex items-center justify-between px-6 sticky top-0 bg-[#050505]/80 backdrop-blur-md z-10">
            <div class="text-xs text-gray-500">Mission Control / <span class="text-gray-200">System
                    Overview</span></div>
            <div id="status-pill" class="flex items-center gap-2 px-2 py-1 rounded bg-white/5 border border-white/5">
                <div id="status-dot"
                    class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]">
                </div>
                <span id="status-text" class="text-xs font-medium text-gray-300">Online</span>
            </div>
        </header>

        <div class="p-8 max-w-7xl mx-auto space-y-8">

            <!-- HEADER METRICS -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- System Health -->
                <div class="glass p-5 rounded-xl flex flex-col justify-between h-32">
                    <div class="flex justify-between items-start">
                        <span class="text-xs text-gray-500 uppercase tracking-wider">Health</span>
                        <iconify-icon icon="solar:server-square-linear" class="text-emerald-500"></iconify-icon>
                    </div>
                    <div>
                        <div id="health-metric" class="text-2xl font-light text-white">Healthy</div>
                        <div class="text-xs text-emerald-500/80 mt-1 flex items-center gap-1">
                            <iconify-icon icon="solar:check-circle-linear"></iconify-icon> All systems go
                        </div>
                    </div>
                </div>

                <!-- Treasury -->
                <div class="glass p-5 rounded-xl flex flex-col justify-between h-32">
                    <div class="flex justify-between items-start">
                        <span class="text-xs text-gray-500 uppercase tracking-wider">Treasury</span>
                        <iconify-icon icon="solar:wallet-linear" class="text-gray-400"></iconify-icon>
                    </div>
                    <div>
                        <div id="treasury-metric" class="text-2xl font-light text-white">$4,863</div>
                        <div class="text-xs text-gray-500 mt-1">Credits Available</div>
                    </div>
                </div>

                <!-- Blocked Threats -->
                <div class="glass p-5 rounded-xl flex flex-col justify-between h-32">
                    <div class="flex justify-between items-start">
                        <span class="text-xs text-gray-500 uppercase tracking-wider">Defense</span>
                        <iconify-icon icon="solar:shield-warning-linear" class="text-rose-400"></iconify-icon>
                    </div>
                    <div>
                        <div id="armor-blocked" class="text-2xl font-light text-white">142</div>
                        <div class="text-xs text-rose-500/80 mt-1">Threats Blocked (24h)</div>
                    </div>
                </div>

                <!-- Throughput -->
                <div class="glass p-5 rounded-xl flex flex-col justify-between h-32">
                    <div class="flex justify-between items-start">
                        <span class="text-xs text-gray-500 uppercase tracking-wider">Throughput</span>
                        <iconify-icon icon="solar:bolt-linear" class="text-amber-400"></iconify-icon>
                    </div>
                    <div>
                        <div class="text-2xl font-light text-white">1.2 TB/s</div>
                        <div class="text-xs text-gray-500 mt-1">Optical Bus Load</div>
                    </div>
                </div>
            </section>

            <!-- CORE WIDGETS -->
            <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[500px]">

                <!-- Center Stage: Trust Broker Console -->
                <div class="lg:col-span-2 glass rounded-2xl p-0 overflow-hidden flex flex-col relative">
                    <div class="h-12 border-b border-white/5 flex items-center justify-between px-4 bg-white/[0.02]">
                        <div class="flex items-center gap-2">
                            <iconify-icon icon="solar:verified-check-bold" class="text-emerald-500"></iconify-icon>
                            <span class="text-sm font-medium text-white">Trust Broker</span>
                        </div>
                        <div class="text-xs text-gray-600 font-mono">ID: T-992A</div>
                    </div>
                    <div class="flex-1 p-6 flex flex-col justify-center items-center text-center space-y-4">
                        <div class="w-16 h-16 rounded-full bg-emerald-500/10 flex items-center justify-center mb-2">
                            <iconify-icon icon="solar:shield-check-linear"
                                class="text-3xl text-emerald-500"></iconify-icon>
                        </div>
                        <h3 class="text-lg text-white font-medium">Verify Claims & Logic</h3>
                        <p class="text-sm text-gray-500 max-w-sm">Enter a claim or logic snippet below to
                            verify its truth against the immutable ledger.</p>

                        <div class="w-full max-w-md bg-black/20 border border-white/10 rounded-lg p-3 flex gap-2">
                            <input type="text" placeholder="e.g. 'User A has admin rights'"
                                class="bg-transparent border-none text-sm text-white flex-1 focus:ring-0 placeholder-gray-600">
                            <button
                                class="px-4 py-1.5 bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-medium rounded transition-colors">Verify</button>
                        </div>
                    </div>
                </div>

                <!-- Right Rail: Activity Feed -->
                <div class="glass rounded-2xl p-5 overflow-hidden flex flex-col">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">Live
                        Activity</h3>
                    <div class="space-y-4 overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Item 1 -->
                        <div class="flex gap-3">
                            <div class="mt-1 w-2 h-2 rounded-full bg-blue-500 shrink-0"></div>
                            <div>
                                <div class="text-sm text-gray-300">New Integration Added</div>
                                <div class="text-xs text-gray-600 mt-1">User 'Admin' connected Snowflake
                                    Data Warehouse.</div>
                                <div class="text-[10px] text-gray-700 mt-1">2m ago</div>
                            </div>
                        </div>
                        <!-- Item 2 -->
                        <div class="flex gap-3">
                            <div class="mt-1 w-2 h-2 rounded-full bg-amber-500 shrink-0"></div>
                            <div>
                                <div class="text-sm text-gray-300">Policy Eviction</div>
                                <div class="text-xs text-gray-600 mt-1">TTL changed from 24h to 48h for
                                    RiskCache.</div>
                                <div class="text-[10px] text-gray-700 mt-1">15m ago</div>
                            </div>
                        </div>
                        <!-- Item 3 -->
                        <div class="flex gap-3">
                            <div class="mt-1 w-2 h-2 rounded-full bg-emerald-500 shrink-0"></div>
                            <div>
                                <div class="text-sm text-gray-300">Large Batch Verified</div>
                                <div class="text-xs text-gray-600 mt-1">5,000 claims processed via Alpha-One
                                    agent.</div>
                                <div class="text-[10px] text-gray-700 mt-1">1h ago</div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Quick Links -->
            <div>
                <h3 class="text-sm font-medium text-gray-200 mb-3 tracking-tight">Quick Actions</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button
                        class="flex items-center gap-3 p-3 rounded-lg border border-white/5 bg-white/[0.01] hover:bg-white/[0.04] hover:border-white/10 transition-all text-left group">
                        <div
                            class="w-8 h-8 rounded-md bg-indigo-500/10 text-indigo-400 flex items-center justify-center flex-shrink-0 group-hover:bg-indigo-500/20 transition-colors">
                            <iconify-icon icon="solar:shield-check-linear" width="18"></iconify-icon>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs font-medium text-gray-200">New Claim</span>
                            <span class="text-[10px] text-gray-500">Verify logic</span>
                        </div>
                    </button>

                    <a href="/agents.html"
                        class="flex items-center gap-3 p-3 rounded-lg border border-white/5 bg-white/[0.01] hover:bg-white/[0.04] hover:border-white/10 transition-all text-left group">
                        <div
                            class="w-8 h-8 rounded-md bg-purple-500/10 text-purple-400 flex items-center justify-center flex-shrink-0 group-hover:bg-purple-500/20 transition-colors">
                            <iconify-icon icon="solar:magic-stick-3-linear" width="18"></iconify-icon>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs font-medium text-gray-200">New Agent</span>
                            <span class="text-[10px] text-gray-500">From template</span>
                        </div>
                    </a>

                    <a href="/data.html"
                        class="flex items-center gap-3 p-3 rounded-lg border border-white/5 bg-white/[0.01] hover:bg-white/[0.04] hover:border-white/10 transition-all text-left group">
                        <div
                            class="w-8 h-8 rounded-md bg-blue-500/10 text-blue-400 flex items-center justify-center flex-shrink-0 group-hover:bg-blue-500/20 transition-colors">
                            <iconify-icon icon="solar:database-linear" width="18"></iconify-icon>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs font-medium text-gray-200">Connect Data</span>
                            <span class="text-[10px] text-gray-500">Integration</span>
                        </div>
                    </a>

                    <button
                        class="flex items-center gap-3 p-3 rounded-lg border border-white/5 bg-white/[0.01] hover:bg-white/[0.04] hover:border-white/10 transition-all text-left group">
                        <div
                            class="w-8 h-8 rounded-md bg-rose-500/10 text-rose-400 flex items-center justify-center flex-shrink-0 group-hover:bg-rose-500/20 transition-colors">
                            <iconify-icon icon="solar:danger-triangle-linear" width="18"></iconify-icon>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs font-medium text-gray-200">Incidents</span>
                            <span class="text-[10px] text-gray-500">View status</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Active Sectors -->
            <div>
                <h3 class="text-sm font-medium text-gray-200 mb-3 tracking-tight">Active Sectors</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

                    <!-- Finance -->
                    <div
                        class="p-5 rounded-xl border border-white/5 bg-gradient-to-b from-[#0f141f] to-[#050505] hover:border-white/10 transition-all group relative">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 rounded-lg bg-blue-500/10 text-blue-400 flex items-center justify-center">
                                    <iconify-icon icon="solar:wallet-linear" width="20"></iconify-icon>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-200">Finance</div>
                                    <div class="text-[10px] text-gray-500">RiskCache</div>
                                </div>
                            </div>
                            <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-y-4 gap-x-2 mb-4">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Monte Carlo Hits</div>
                                <div class="text-lg font-medium text-gray-200 tracking-tight">82%</div>
                            </div>
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Latency p95</div>
                                <div class="text-lg font-medium text-gray-200 tracking-tight">45ms</div>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-white/5 flex items-center justify-between">
                            <span class="text-[10px] text-gray-600">Updated 2m ago</span>
                            <a href="/sector.html?name=finance"
                                class="text-[10px] text-blue-400 hover:text-blue-300 transition-colors">View
                                Dashboard
                                &rarr;</a>
                        </div>
                    </div>

                    <!-- Photonics -->
                    <div
                        class="p-5 rounded-xl border border-white/5 bg-gradient-to-b from-[#0f141f] to-[#050505] hover:border-white/10 transition-all group">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 rounded-lg bg-orange-500/10 text-orange-400 flex items-center justify-center">
                                    <iconify-icon icon="solar:bolt-linear" width="20"></iconify-icon>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-200">Photonics</div>
                                    <div class="text-[10px] text-gray-500">OpticalCache</div>
                                </div>
                            </div>
                            <div class="w-1.5 h-1.5 rounded-full bg-amber-500 shadow-[0_0_8px_rgba(245,158,11,0.5)]">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-y-4 gap-x-2 mb-4">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Mode</div>
                                <div class="text-sm font-medium text-gray-200 tracking-tight mt-1">Prototyping</div>
                            </div>
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Eff. Throughput</div>
                                <div class="text-lg font-medium text-gray-200 tracking-tight">1.2 TB/s</div>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-white/5 flex items-center justify-between">
                            <span class="text-[10px] text-gray-600">Minor Timeout Spikes</span>
                            <a href="/sector.html?name=photonics"
                                class="text-[10px] text-orange-400 hover:text-orange-300 transition-colors">View
                                Dashboard &rarr;</a>
                        </div>
                    </div>

                    <!-- Biologics -->
                    <div
                        class="p-5 rounded-xl border border-white/5 bg-gradient-to-b from-[#0f141f] to-[#050505] hover:border-white/10 transition-all group">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 rounded-lg bg-pink-500/10 text-pink-400 flex items-center justify-center">
                                    <iconify-icon icon="solar:dna-linear" width="20"></iconify-icon>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-200">Biologics</div>
                                    <div class="text-[10px] text-gray-500">FoldingCache</div>
                                </div>
                            </div>
                            <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-y-4 gap-x-2 mb-4">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">GPU Hrs Saved</div>
                                <div class="text-lg font-medium text-gray-200 tracking-tight">840h</div>
                            </div>
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase">Queue Depth</div>
                                <div class="text-lg font-medium text-gray-200 tracking-tight">0</div>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-white/5 flex items-center justify-between">
                            <span class="text-[10px] text-gray-600">Optimization Active</span>
                            <a href="/sector.html?name=biologics"
                                class="text-[10px] text-pink-400 hover:text-pink-300 transition-colors">View
                                Dashboard
                                &rarr;</a>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </main>

    <script>
        // Use same polling logic as before, just cleaner structure
        async function refreshStats() {
            const headers = { 'X-API-Key': 'ac_demo_admin' };
            try {
                const h = await fetch('/api/health').then(r => r.json());
                const s = await fetch('/api/stats', { headers }).then(r => r.json());
                const a = await fetch('/api/admin/armor/stats', { headers }).then(r => r.json());

                if (h) {
                    document.getElementById('health-metric').innerText = h.status.charAt(0).toUpperCase() + h.status.slice(1);
                    document.getElementById('status-text').innerText = h.status === 'ok' ? 'Online' : 'Issues';
                    document.getElementById('status-dot').className = h.status === 'ok' ? 'w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]' : 'w-1.5 h-1.5 rounded-full bg-rose-500';
                }

                if (s) {
                    // Generic mock data if api/stats returns mock
                    // We don't have exact id mapping for s values yet in this template, mostly visual
                }

                document.getElementById('treasury-metric').innerText = '$' + (4863 + Math.floor(Math.random() * 50)).toLocaleString(); // Sim live change

                if (a && a.threats_blocked) document.getElementById('armor-blocked').innerText = a.threats_blocked;

            } catch (e) { console.log("Polling error (expected in dev without full backend)"); }
        }
        setInterval(refreshStats, 5000);
        refreshStats();
    </script>
</body>

</html>