<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <title>AgentCache Studio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        console: {
                            bg: '#020408',       // Very dark background
                            sidebar: '#05080f',  // Slightly lighter sidebar
                            panel: '#0a0d14',    // Panel background
                            border: '#1e232e',   // Subtle borders
                            accent: '#00b8d4',   // Cyan accent (Execute button)
                            text: '#e2e8f0',     // Main text
                            dim: '#64748b'       // Dim text
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #020408;
            color: #e2e8f0;
        }

        .nav-item {
            border-left: 2px solid transparent;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }

        .nav-item.active {
            background-color: rgba(0, 184, 212, 0.1);
            border-left-color: #00b8d4;
            color: #fff;
        }

        .console-panel {
            background-color: #0a0d14;
            border: 1px solid #1e232e;
            border-radius: 6px;
        }

        .console-input {
            background-color: transparent;
            border: none;
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
            resize: none;
        }

        .console-input:focus {
            outline: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #1e232e;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #334155;
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header
        class="h-12 bg-console-sidebar border-b border-console-border flex items-center justify-between px-4 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gradient-to-br from-cyan-500 to-blue-600 rounded flex items-center justify-center">
                <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <span class="font-medium text-sm tracking-wide">AgentCache <span
                    class="text-console-dim">Studio</span></span>
        </div>
        <div class="flex items-center gap-6 text-xs font-medium text-console-dim">
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                <span>SYSTEM ONLINE</span>
            </div>
            <a href="/" class="hover:text-white transition">EXIT STUDIO</a>
        </div>
    </header>

    <div class="flex-1 flex min-h-0">
        <!-- Sidebar -->
        <aside class="w-64 bg-console-sidebar border-r border-console-border flex flex-col shrink-0">
            <div class="p-4 text-xs font-bold text-console-dim uppercase tracking-wider">Modules</div>
            <nav class="flex-1 space-y-0.5 px-2">
                <button onclick="switchModule('spelling')" id="nav-spelling"
                    class="nav-item active w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                        </path>
                    </svg>
                    Semantic Correction
                </button>
                <button onclick="switchModule('constraints')" id="nav-constraints"
                    class="nav-item w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Constraint Protocol
                </button>
                <button onclick="switchModule('image')" id="nav-image"
                    class="nav-item w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    Verified Generation
                </button>
                <div class="my-2 border-t border-console-border mx-3"></div>
                <button onclick="switchModule('history')" id="nav-history"
                    class="nav-item w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Audit History
                </button>
                <button onclick="switchModule('integrations')" id="nav-integrations"
                    class="nav-item w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z">
                        </path>
                    </svg>
                    Integrations
                </button>
                <button onclick="switchModule('settings')" id="nav-settings"
                    class="nav-item w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Control Panel
                </button>
                <button onclick="switchModule('pii')" id="nav-pii"
                    class="nav-item w-full text-left px-3 py-2.5 text-sm font-medium text-console-dim rounded-r-md flex items-center gap-3">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    Medical / PII
                </button>
            </nav>

            <div class="p-4 border-t border-console-border">
                <div class="text-xs font-bold text-console-dim uppercase mb-2">Cache Status</div>
                <div class="flex items-center justify-between mb-1">
                    <span class="text-sm text-white">Hit Rate</span>
                    <span class="text-sm font-mono text-emerald-400" id="hit-rate">94.2%</span>
                </div>
                <div class="w-full bg-console-border h-1 rounded-full overflow-hidden">
                    <div class="bg-emerald-500 h-full w-[94%]"></div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0 bg-console-bg">
            <!-- Module Header -->
            <div class="h-16 flex items-center justify-between px-8 border-b border-console-border shrink-0">
                <div>
                    <div class="console-panel h-full flex items-center justify-center text-console-dim">
                        Integrations View Placeholder
                    </div>
                </div>
                <div id="workspace-settings" class="hidden h-full">
                    <div class="console-panel h-full flex items-center justify-center text-console-dim">
                        Settings View Placeholder
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // State
        let activeModule = 'spelling';

        // Module Configs
        const modules = {
            spelling: {
                title: 'Semantic Correction',
                desc: 'Self-correcting cache for LLM text normalization.',
                placeholder: "Thsi is a tst of the sytem.",
                endpoint: '/api/spelling/fix',
                hasConstraints: false
            },
            constraints: {
                title: 'Constraint Protocol',
                desc: 'Protocol for enforcing negative constraints.',
                placeholder: "Write a sentence about AI with a dramatic pause using a dash.",
                endpoint: '/api/constraints/enforce',
                hasConstraints: true
            },
            image: {
                title: 'Verified Generation',
                desc: 'OCR-verified caching for stochastic generative models.',
                placeholder: "A neon sign that says 'Open Late'",
                endpoint: '/api/image-gen/generate',
                hasConstraints: false
            },
            history: { title: 'Audit History', isView: true },
            integrations: { title: 'Integrations', isView: true },
            settings: { title: 'Control Panel', isView: true },
            pii: { title: 'Medical / PII', isView: true }
        };

        function switchModule(mod) {
            activeModule = mod;
            const config = modules[mod];

            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${mod}`).classList.add('active');

            // Update Header
            document.getElementById('module-title').innerText = config.title;
            document.getElementById('module-desc').innerText = config.desc || '';

            // Toggle Views
            document.getElementById('workspace-standard').classList.add('hidden');
            document.getElementById('workspace-history').classList.add('hidden');
            document.getElementById('workspace-integrations').classList.add('hidden');
            document.getElementById('workspace-settings').classList.add('hidden');

            const actionBtn = document.getElementById('action-btn');

            if (config.isView) {
                actionBtn.classList.add('hidden');
                document.getElementById(`workspace-${mod === 'pii' ? 'settings' : mod}`).classList.remove('hidden'); // Simple mapping for now
            } else {
                actionBtn.classList.remove('hidden');
                document.getElementById('workspace-standard').classList.remove('hidden');

                // Reset Inputs
                document.getElementById('input-area').value = '';
                document.getElementById('input-area').placeholder = config.placeholder;
                document.getElementById('output-area').innerText = '';
                document.getElementById('output-status').innerText = 'IDLE';

                // Toggle Constraints
                const constraintOptions = document.getElementById('constraint-options');
                if (config.hasConstraints) {
                    constraintOptions.classList.remove('hidden');
                } else {
                    constraintOptions.classList.add('hidden');
                }
            }
        }

        async function runActiveModule() {
            const config = modules[activeModule];
            if (config.isView) return;

            const input = document.getElementById('input-area').value;
            if (!input) return;

            const outputArea = document.getElementById('output-area');
            const statusEl = document.getElementById('output-status');
            const latencyEl = document.getElementById('stat-latency');
            const costEl = document.getElementById('stat-cost');

            outputArea.innerText = 'Processing...';
            statusEl.innerText = 'RUNNING';
            statusEl.className = 'text-xs font-mono text-console-accent animate-pulse';

            try {
                const payload = { text: input, prompt: input };
                if (activeModule === 'constraints') {
                    payload.constraint = document.getElementById('constraint-select').value;
                }

                const startTime = Date.now();
                const res = await fetch(config.endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                const endTime = Date.now();

                // Update UI
                if (activeModule === 'image') {
                    outputArea.innerText = `Seed: ${data.seed}\nAttempts: ${data.attempts}\nStatus: Verified`;
                } else if (activeModule === 'spelling') {
                    outputArea.innerText = data.fixed;
                } else {
                    outputArea.innerText = data.output || data.fixed || JSON.stringify(data, null, 2);
                }

                statusEl.innerText = 'SUCCESS';
                statusEl.className = 'text-xs font-mono text-emerald-400';
                latencyEl.innerText = `${endTime - startTime}ms`;
                costEl.innerText = '$0.001';

            } catch (err) {
                outputArea.innerText = `Error: ${err.message}`;
                statusEl.innerText = 'FAILED';
                statusEl.className = 'text-xs font-mono text-red-400';
            }
        }

        // Poll Stats
        async function updateStats() {
            try {
                const res = await fetch('/api/studio/stats');
                const data = await res.json();
                document.getElementById('hit-rate').innerText = `${data.cache.hitRate}%`;
            } catch (e) { }
        }
        setInterval(updateStats, 5000);
        updateStats();

    </script>
</body>

</html>