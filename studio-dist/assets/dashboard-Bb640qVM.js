import"./modulepreload-polyfill-B5Qt9EMX.js";import{j as p,r as he,M as Ba,a as za,R as Wa,U as Va,S as Ha,b as Ur,c as Xa,C as ct,V as kr,d as Ya,e as Kt,I as Ka,f as Ja,B as xa,g as qa,T as Qa,L as qr,h as Za,i as Qr,D as $a,P as Cr,u as en,_ as tn,k as rn,l as an,O as nn,m as ya,A as ba,n as _a,o as on}from"./Stars-Ch6AU-tl.js";function sn({activeView:l,onViewChange:r}){const u=[{id:"overview",label:"Overview",icon:"ðŸ“Š"},{id:"pipelines",label:"Pipelines",icon:"âš¡"},{id:"swarm",label:"Swarm",icon:"ðŸŒŒ"},{id:"data",label:"Data Explorer",icon:"ðŸ’¾"},{id:"governance",label:"Governance",icon:"âš–ï¸"}];return p.jsxs("div",{className:"w-64 bg-slate-900 border-r border-slate-800 flex flex-col",children:[p.jsxs("div",{className:"p-6 border-b border-slate-800",children:[p.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-green-400 to-cyan-400 bg-clip-text text-transparent",children:"AgentCache"}),p.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Mission Control"})]}),p.jsx("nav",{className:"flex-1 p-4 space-y-2",children:u.map(c=>p.jsxs("button",{onClick:()=>r(c.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${l===c.id?"bg-green-500/10 text-green-400 border border-green-500/20":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[p.jsx("span",{children:c.icon}),c.label]},c.id))}),p.jsx("div",{className:"p-4 border-t border-slate-800",children:p.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[p.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-xs font-bold text-white",children:"AC"}),p.jsxs("div",{children:[p.jsx("div",{className:"text-sm font-medium text-white",children:"Admin"}),p.jsx("div",{className:"text-xs text-slate-500",children:"Pro Plan"})]})]})})]})}function Zr(){const[l,r]=he.useState(null),[u,c]=he.useState(!0);return he.useEffect(()=>{const t=async()=>{try{const a=localStorage.getItem("ac_api_key");if(!a)return;const o=await fetch("/api/stats",{headers:{"X-API-Key":a}});if(o.ok){const n=await o.json();r(n)}}catch(a){console.error(a)}finally{c(!1)}};t();const e=setInterval(t,5e3);return()=>clearInterval(e)},[]),u?p.jsx("div",{className:"p-8 text-slate-400",children:"Loading stats..."}):p.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[p.jsxs("header",{className:"mb-8",children:[p.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Overview"}),p.jsx("p",{className:"text-slate-400",children:"Real-time platform metrics"})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[p.jsx(It,{label:"Requests Today",value:l?.requestsToday||0,sub:`${(l?.monthlyQuota||1e4)-(l?.used||0)} remaining`}),p.jsx(It,{label:"Cache Hit Rate",value:`${l?.hitRate||0}%`,valueColor:"text-green-400",sub:`${l?.hits||0} hits / ${l?.misses||0} misses`}),p.jsx(It,{label:"Money Saved",value:`$${(l?.costSaved||0).toFixed(2)}`,valueColor:"text-green-400",sub:"This month"}),p.jsx(It,{label:"Avg Latency",value:`${l?.avgLatency||0}ms`,valueColor:"text-cyan-400",sub:`P95: ${l?.latencyP95||0}ms`})]}),p.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[p.jsx("h3",{className:"text-lg font-bold mb-4",children:"Cache Freshness"}),p.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[p.jsxs("div",{children:[p.jsx("div",{className:"text-3xl font-bold text-green-500",children:l?.freshness?.fresh||0}),p.jsx("div",{className:"text-sm text-slate-400",children:"Fresh"})]}),p.jsxs("div",{children:[p.jsx("div",{className:"text-3xl font-bold text-yellow-500",children:l?.freshness?.stale||0}),p.jsx("div",{className:"text-sm text-slate-400",children:"Stale"})]}),p.jsxs("div",{children:[p.jsx("div",{className:"text-3xl font-bold text-red-500",children:l?.freshness?.expired||0}),p.jsx("div",{className:"text-sm text-slate-400",children:"Expired"})]})]})]})]})}function It({label:l,value:r,sub:u,valueColor:c="text-white"}){return p.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[p.jsx("div",{className:"text-sm text-slate-400 mb-2",children:l}),p.jsx("div",{className:`text-4xl font-bold mb-1 ${c}`,children:r}),p.jsx("div",{className:"text-xs text-slate-500",children:u})]})}const ln=l=>typeof l=="object"&&typeof l.then=="function",Bt=[];function cn(l,r,u=(c,t)=>c===t){if(l===r)return!0;if(!l||!r)return!1;const c=l.length;if(r.length!==c)return!1;for(let t=0;t<c;t++)if(!u(l[t],r[t]))return!1;return!0}function un(l,r=null,u=!1,c={}){r===null&&(r=[l]);for(const e of Bt)if(cn(r,e.keys,e.equal)){if(u)return;if(Object.prototype.hasOwnProperty.call(e,"error"))throw e.error;if(Object.prototype.hasOwnProperty.call(e,"response"))return c.lifespan&&c.lifespan>0&&(e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(e.remove,c.lifespan)),e.response;if(!u)throw e.promise}const t={keys:r,equal:c.equal,remove:()=>{const e=Bt.indexOf(t);e!==-1&&Bt.splice(e,1)},promise:(ln(l)?l:l(...r)).then(e=>{t.response=e,c.lifespan&&c.lifespan>0&&(t.timeout=setTimeout(t.remove,c.lifespan))}).catch(e=>t.error=e)};if(Bt.push(t),!u)throw t.promise}const fn=(l,r,u)=>un(l,r,!1,u);function dn(){var l=Object.create(null);function r(t,e){var a=t.id,o=t.name,n=t.dependencies;n===void 0&&(n=[]);var i=t.init;i===void 0&&(i=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(d){return d&&d.isWorkerModule&&(r(d,function(h){if(h instanceof Error)throw h}),d=l[d.id].value),d}),i=c("<"+o+">.init",i),s&&(s=c("<"+o+">.getTransferables",s));var f=null;typeof i=="function"?f=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:f,getTransferables:s},e(f)}catch(d){d&&d.noLog||console.error(d),e(d)}}function u(t,e){var a,o=t.id,n=t.args;(!l[o]||typeof l[o].value!="function")&&e(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(a=l[o]).value.apply(a,n);i&&typeof i.then=="function"?i.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(i)}catch(f){e(f)}function s(f){try{var d=l[o].getTransferables&&l[o].getTransferables(f);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(f,d)}catch(h){console.error(h),e(h)}}}function c(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var o=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(n){console.error(n)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,o=e.action,n=e.data;try{o==="registerModule"&&r(n,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),o==="callModule"&&u(n,function(i,s){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function hn(l){var r=function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,u);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var u=l.dependencies,c=l.init;u=Array.isArray(u)?u.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(u).then(function(e){return c.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Sa=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(u){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+u.message+"]")}return Sa=function(){return l},l},pn=0,vn=0,gr=!1,kt=Object.create(null),Ct=Object.create(null),br=Object.create(null);function ut(l){if((!l||typeof l.init!="function")&&!gr)throw new Error("requires `options.init` function");var r=l.dependencies,u=l.init,c=l.getTransferables,t=l.workerId,e=hn(l);t==null&&(t="#default");var a="workerModule"+ ++pn,o=l.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(gr=!0,s=ut({workerId:t,name:"<"+o+"> function dependency: "+s.name,init:`function(){return (
`+Xt(s)+`
)}`}),gr=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function i(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(!Sa())return e.apply(void 0,s);if(!n){n=$r(t,"registerModule",i.workerModuleData);var d=function(){n=null,Ct[t].delete(d)};(Ct[t]||(Ct[t]=new Set)).add(d)}return n.then(function(h){var g=h.isCallable;if(g)return $r(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return i.workerModuleData={isWorkerModule:!0,id:a,name:o,dependencies:r,init:Xt(u),getTransferables:c&&Xt(c)},i.onMainThread=e,i}function gn(l){Ct[l]&&Ct[l].forEach(function(r){r()}),kt[l]&&(kt[l].terminate(),delete kt[l])}function Xt(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function mn(l){var r=kt[l];if(!r){var u=Xt(dn);r=kt[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+u+")()"],{type:"application/javascript"}))),r.onmessage=function(c){var t=c.data,e=t.messageId,a=br[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete br[e],a(t)}}return r}function $r(l,r,u){return new Promise(function(c,t){var e=++vn;br[e]=function(a){a.success?c(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},mn(l).postMessage({messageId:e,action:r,data:u})})}function wa(){var l=(function(r){function u(G,P,v,w,A,D,k,B){var j=1-k;B.x=j*j*G+2*j*k*v+k*k*A,B.y=j*j*P+2*j*k*w+k*k*D}function c(G,P,v,w,A,D,k,B,j,I){var Y=1-j;I.x=Y*Y*Y*G+3*Y*Y*j*v+3*Y*j*j*A+j*j*j*k,I.y=Y*Y*Y*P+3*Y*Y*j*w+3*Y*j*j*D+j*j*j*B}function t(G,P){for(var v=/([MLQCZ])([^MLQCZ]*)/g,w,A,D,k,B;w=v.exec(G);){var j=w[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(I){return parseFloat(I)});switch(w[1]){case"M":k=A=j[0],B=D=j[1];break;case"L":(j[0]!==k||j[1]!==B)&&P("L",k,B,k=j[0],B=j[1]);break;case"Q":{P("Q",k,B,k=j[2],B=j[3],j[0],j[1]);break}case"C":{P("C",k,B,k=j[4],B=j[5],j[0],j[1],j[2],j[3]);break}case"Z":(k!==A||B!==D)&&P("L",k,B,A,D);break}}}function e(G,P,v){v===void 0&&(v=16);var w={x:0,y:0};t(G,function(A,D,k,B,j,I,Y,ee,H){switch(A){case"L":P(D,k,B,j);break;case"Q":{for(var z=D,me=k,fe=1;fe<v;fe++)u(D,k,I,Y,B,j,fe/(v-1),w),P(z,me,w.x,w.y),z=w.x,me=w.y;break}case"C":{for(var Q=D,te=k,le=1;le<v;le++)c(D,k,I,Y,ee,H,B,j,le/(v-1),w),P(Q,te,w.x,w.y),Q=w.x,te=w.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(G,P){var v=G.getContext?G.getContext("webgl",i):G,w=n.get(v);if(!w){let Y=function(Q){var te=D[Q];if(!te&&(te=D[Q]=v.getExtension(Q),!te))throw new Error(Q+" not supported");return te},ee=function(Q,te){var le=v.createShader(te);return v.shaderSource(le,Q),v.compileShader(le),le},H=function(Q,te,le,V){if(!k[Q]){var re={},$={},O=v.createProgram();v.attachShader(O,ee(te,v.VERTEX_SHADER)),v.attachShader(O,ee(le,v.FRAGMENT_SHADER)),v.linkProgram(O),k[Q]={program:O,transaction:function(q){v.useProgram(O),q({setUniform:function(K,_e){for(var ne=[],ie=arguments.length-2;ie-- >0;)ne[ie]=arguments[ie+2];var ue=$[_e]||($[_e]=v.getUniformLocation(O,_e));v["uniform"+K].apply(v,[ue].concat(ne))},setAttribute:function(K,_e,ne,ie,ue){var ve=re[K];ve||(ve=re[K]={buf:v.createBuffer(),loc:v.getAttribLocation(O,K),data:null}),v.bindBuffer(v.ARRAY_BUFFER,ve.buf),v.vertexAttribPointer(ve.loc,_e,v.FLOAT,!1,0,0),v.enableVertexAttribArray(ve.loc),A?v.vertexAttribDivisor(ve.loc,ie):Y("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ve.loc,ie),ue!==ve.data&&(v.bufferData(v.ARRAY_BUFFER,ue,ne),ve.data=ue)}})}}}k[Q].transaction(V)},z=function(Q,te){j++;try{v.activeTexture(v.TEXTURE0+j);var le=B[Q];le||(le=B[Q]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,le),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,le),te(le,j)}finally{j--}},me=function(Q,te,le){var V=v.createFramebuffer();I.push(V),v.bindFramebuffer(v.FRAMEBUFFER,V),v.activeTexture(v.TEXTURE0+te),v.bindTexture(v.TEXTURE_2D,Q),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,Q,0);try{le(V)}finally{v.deleteFramebuffer(V),v.bindFramebuffer(v.FRAMEBUFFER,I[--I.length-1]||null)}},fe=function(){D={},k={},B={},j=-1,I.length=0};var A=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,D={},k={},B={},j=-1,I=[];v.canvas.addEventListener("webglcontextlost",function(Q){fe(),Q.preventDefault()},!1),n.set(v,w={gl:v,isWebGL2:A,getExtension:Y,withProgram:H,withTexture:z,withTextureFramebuffer:me,handleContextLoss:fe})}P(w)}function f(G,P,v,w,A,D,k,B){k===void 0&&(k=15),B===void 0&&(B=null),s(G,function(j){var I=j.gl,Y=j.withProgram,ee=j.withTexture;ee("copy",function(H,z){I.texImage2D(I.TEXTURE_2D,0,I.RGBA,A,D,0,I.RGBA,I.UNSIGNED_BYTE,P),Y("copy",a,o,function(me){var fe=me.setUniform,Q=me.setAttribute;Q("aUV",2,I.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),fe("1i","image",z),I.bindFramebuffer(I.FRAMEBUFFER,B||null),I.disable(I.BLEND),I.colorMask(k&8,k&4,k&2,k&1),I.viewport(v,w,A,D),I.scissor(v,w,A,D),I.drawArrays(I.TRIANGLES,0,3)})})})}function d(G,P,v){var w=G.width,A=G.height;s(G,function(D){var k=D.gl,B=new Uint8Array(w*A*4);k.readPixels(0,0,w,A,k.RGBA,k.UNSIGNED_BYTE,B),G.width=P,G.height=v,f(k,B,0,0,w,A)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:d});function g(G,P,v,w,A,D){D===void 0&&(D=1);var k=new Uint8Array(G*P),B=w[2]-w[0],j=w[3]-w[1],I=[];e(v,function(Q,te,le,V){I.push({x1:Q,y1:te,x2:le,y2:V,minX:Math.min(Q,le),minY:Math.min(te,V),maxX:Math.max(Q,le),maxY:Math.max(te,V)})}),I.sort(function(Q,te){return Q.maxX-te.maxX});for(var Y=0;Y<G;Y++)for(var ee=0;ee<P;ee++){var H=me(w[0]+B*(Y+.5)/G,w[1]+j*(ee+.5)/P),z=Math.pow(1-Math.abs(H)/A,D)/2;H<0&&(z=1-z),z=Math.max(0,Math.min(255,Math.round(z*255))),k[ee*G+Y]=z}return k;function me(Q,te){for(var le=1/0,V=1/0,re=I.length;re--;){var $=I[re];if($.maxX+V<=Q)break;if(Q+V>$.minX&&te-V<$.maxY&&te+V>$.minY){var O=R(Q,te,$.x1,$.y1,$.x2,$.y2);O<le&&(le=O,V=Math.sqrt(le))}}return fe(Q,te)&&(V=-V),V}function fe(Q,te){for(var le=0,V=I.length;V--;){var re=I[V];if(re.maxX<=Q)break;var $=re.y1>te!=re.y2>te&&Q<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;$&&(le+=re.y1<re.y2?1:-1)}return le!==0}}function x(G,P,v,w,A,D,k,B,j,I){D===void 0&&(D=1),B===void 0&&(B=0),j===void 0&&(j=0),I===void 0&&(I=0),y(G,P,v,w,A,D,k,null,B,j,I)}function y(G,P,v,w,A,D,k,B,j,I,Y){D===void 0&&(D=1),j===void 0&&(j=0),I===void 0&&(I=0),Y===void 0&&(Y=0);for(var ee=g(G,P,v,w,A,D),H=new Uint8Array(ee.length*4),z=0;z<ee.length;z++)H[z*4+Y]=ee[z];f(k,H,j,I,G,P,1<<3-Y,B)}function R(G,P,v,w,A,D){var k=A-v,B=D-w,j=k*k+B*B,I=j?Math.max(0,Math.min(1,((G-v)*k+(P-w)*B)/j)):0,Y=G-(v+I*k),ee=P-(w+I*B);return Y*Y+ee*ee}var C=Object.freeze({__proto__:null,generate:g,generateIntoCanvas:x,generateIntoFramebuffer:y}),_="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",m="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",S="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",M=new Float32Array([0,0,2,0,0,2]),U=null,T=!1,L={},N=new WeakMap;function J(G){if(!T&&!X(G))throw new Error("WebGL generation not supported")}function b(G,P,v,w,A,D,k){if(D===void 0&&(D=1),k===void 0&&(k=null),!k&&(k=U,!k)){var B=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!B)throw new Error("OffscreenCanvas or DOM canvas not supported");k=U=B.getContext("webgl",{depth:!1})}J(k);var j=new Uint8Array(G*P*4);s(k,function(H){var z=H.gl,me=H.withTexture,fe=H.withTextureFramebuffer;me("readable",function(Q,te){z.texImage2D(z.TEXTURE_2D,0,z.RGBA,G,P,0,z.RGBA,z.UNSIGNED_BYTE,null),fe(Q,te,function(le){F(G,P,v,w,A,D,z,le,0,0,0),z.readPixels(0,0,G,P,z.RGBA,z.UNSIGNED_BYTE,j)})})});for(var I=new Uint8Array(G*P),Y=0,ee=0;Y<j.length;Y+=4)I[ee++]=j[Y];return I}function E(G,P,v,w,A,D,k,B,j,I){D===void 0&&(D=1),B===void 0&&(B=0),j===void 0&&(j=0),I===void 0&&(I=0),F(G,P,v,w,A,D,k,null,B,j,I)}function F(G,P,v,w,A,D,k,B,j,I,Y){D===void 0&&(D=1),j===void 0&&(j=0),I===void 0&&(I=0),Y===void 0&&(Y=0),J(k);var ee=[];e(v,function(H,z,me,fe){ee.push(H,z,me,fe)}),ee=new Float32Array(ee),s(k,function(H){var z=H.gl,me=H.isWebGL2,fe=H.getExtension,Q=H.withProgram,te=H.withTexture,le=H.withTextureFramebuffer,V=H.handleContextLoss;if(te("rawDistances",function(re,$){(G!==re._lastWidth||P!==re._lastHeight)&&z.texImage2D(z.TEXTURE_2D,0,z.RGBA,re._lastWidth=G,re._lastHeight=P,0,z.RGBA,z.UNSIGNED_BYTE,null),Q("main",_,m,function(O){var pe=O.setAttribute,q=O.setUniform,oe=!me&&fe("ANGLE_instanced_arrays"),K=!me&&fe("EXT_blend_minmax");pe("aUV",2,z.STATIC_DRAW,0,M),pe("aLineSegment",4,z.DYNAMIC_DRAW,1,ee),q.apply(void 0,["4f","uGlyphBounds"].concat(w)),q("1f","uMaxDistance",A),q("1f","uExponent",D),le(re,$,function(_e){z.enable(z.BLEND),z.colorMask(!0,!0,!0,!0),z.viewport(0,0,G,P),z.scissor(0,0,G,P),z.blendFunc(z.ONE,z.ONE),z.blendEquationSeparate(z.FUNC_ADD,me?z.MAX:K.MAX_EXT),z.clear(z.COLOR_BUFFER_BIT),me?z.drawArraysInstanced(z.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(z.TRIANGLES,0,3,ee.length/4)})}),Q("post",a,S,function(O){O.setAttribute("aUV",2,z.STATIC_DRAW,0,M),O.setUniform("1i","tex",$),z.bindFramebuffer(z.FRAMEBUFFER,B),z.disable(z.BLEND),z.colorMask(Y===0,Y===1,Y===2,Y===3),z.viewport(j,I,G,P),z.scissor(j,I,G,P),z.drawArrays(z.TRIANGLES,0,3)})}),z.isContextLost())throw V(),new Error("webgl context lost")})}function X(G){var P=!G||G===U?L:G.canvas||G,v=N.get(P);if(v===void 0){T=!0;var w=null;try{var A=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],D=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,G);v=D&&A.length===D.length&&D.every(function(k,B){return k===A[B]}),v||(w="bad trial run results",console.info(A,D))}catch(k){v=!1,w=k.message}w&&console.warn("WebGL SDF generation not supported:",w),T=!1,N.set(P,v)}return v}var W=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:E,generateIntoFramebuffer:F,isSupported:X});function Z(G,P,v,w,A,D){A===void 0&&(A=Math.max(w[2]-w[0],w[3]-w[1])/2),D===void 0&&(D=1);try{return b.apply(W,arguments)}catch(k){return console.info("WebGL SDF generation failed, falling back to JS",k),g.apply(C,arguments)}}function ae(G,P,v,w,A,D,k,B,j,I){A===void 0&&(A=Math.max(w[2]-w[0],w[3]-w[1])/2),D===void 0&&(D=1),B===void 0&&(B=0),j===void 0&&(j=0),I===void 0&&(I=0);try{return E.apply(W,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),x.apply(C,arguments)}}return r.forEachPathCommand=t,r.generate=Z,r.generateIntoCanvas=ae,r.javascript=C,r.pathToLineSegments=e,r.webgl=W,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r})({});return l}function xn(){var l=(function(r){var u={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},c={},t={};c.L=1,t[1]="L",Object.keys(u).forEach(function(V,re){c[V]=1<<re+1,t[c[V]]=V}),Object.freeze(c);var e=c.LRI|c.RLI|c.FSI,a=c.L|c.R|c.AL,o=c.B|c.S|c.WS|c.ON|c.FSI|c.LRI|c.RLI|c.PDI,n=c.BN|c.RLE|c.LRE|c.RLO|c.LRO|c.PDF,i=c.S|c.WS|c.B|e|c.PDI|n,s=null;function f(){if(!s){s=new Map;var V=function($){if(u.hasOwnProperty($)){var O=0;u[$].split(",").forEach(function(pe){var q=pe.split("+"),oe=q[0],K=q[1];oe=parseInt(oe,36),K=K?parseInt(K,36):0,s.set(O+=oe,c[$]);for(var _e=0;_e<K;_e++)s.set(++O,c[$])})}};for(var re in u)V(re)}}function d(V){return f(),s.get(V.codePointAt(0))||c.L}function h(V){return t[d(V)]}var g={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function x(V,re){var $=36,O=0,pe=new Map,q=re&&new Map,oe;return V.split(",").forEach(function K(_e){if(_e.indexOf("+")!==-1)for(var ne=+_e;ne--;)K(oe);else{oe=_e;var ie=_e.split(">"),ue=ie[0],ve=ie[1];ue=String.fromCodePoint(O+=parseInt(ue,$)),ve=String.fromCodePoint(O+=parseInt(ve,$)),pe.set(ue,ve),re&&q.set(ve,ue)}}),{map:pe,reverseMap:q}}var y,R,C;function _(){if(!y){var V=x(g.pairs,!0),re=V.map,$=V.reverseMap;y=re,R=$,C=x(g.canonical,!1).map}}function m(V){return _(),y.get(V)||null}function S(V){return _(),R.get(V)||null}function M(V){return _(),C.get(V)||null}var U=c.L,T=c.R,L=c.EN,N=c.ES,J=c.ET,b=c.AN,E=c.CS,F=c.B,X=c.S,W=c.ON,Z=c.BN,ae=c.NSM,G=c.AL,P=c.LRO,v=c.RLO,w=c.LRE,A=c.RLE,D=c.PDF,k=c.LRI,B=c.RLI,j=c.FSI,I=c.PDI;function Y(V,re){for(var $=125,O=new Uint32Array(V.length),pe=0;pe<V.length;pe++)O[pe]=d(V[pe]);var q=new Map;function oe(Le,Ve){var Ge=O[Le];O[Le]=Ve,q.set(Ge,q.get(Ge)-1),Ge&o&&q.set(o,q.get(o)-1),q.set(Ve,(q.get(Ve)||0)+1),Ve&o&&q.set(o,(q.get(o)||0)+1)}for(var K=new Uint8Array(V.length),_e=new Map,ne=[],ie=null,ue=0;ue<V.length;ue++)ie||ne.push(ie={start:ue,end:V.length-1,level:re==="rtl"?1:re==="ltr"?0:Kr(ue,!1)}),O[ue]&F&&(ie.end=ue,ie=null);for(var ve=A|w|v|P|e|I|D|F,Ue=function(Le){return Le+(Le&1?1:2)},Fe=function(Le){return Le+(Le&1?2:1)},xe=0;xe<ne.length;xe++){ie=ne[xe];var ye=[{_level:ie.level,_override:0,_isolate:0}],ce=void 0,De=0,Ce=0,Oe=0;q.clear();for(var ke=ie.start;ke<=ie.end;ke++){var de=O[ke];if(ce=ye[ye.length-1],q.set(de,(q.get(de)||0)+1),de&o&&q.set(o,(q.get(o)||0)+1),de&ve)if(de&(A|w)){K[ke]=ce._level;var Se=(de===A?Fe:Ue)(ce._level);Se<=$&&!De&&!Ce?ye.push({_level:Se,_override:0,_isolate:0}):De||Ce++}else if(de&(v|P)){K[ke]=ce._level;var Ke=(de===v?Fe:Ue)(ce._level);Ke<=$&&!De&&!Ce?ye.push({_level:Ke,_override:de&v?T:U,_isolate:0}):De||Ce++}else if(de&e){de&j&&(de=Kr(ke+1,!0)===1?B:k),K[ke]=ce._level,ce._override&&oe(ke,ce._override);var we=(de===B?Fe:Ue)(ce._level);we<=$&&De===0&&Ce===0?(Oe++,ye.push({_level:we,_override:0,_isolate:1,_isolInitIndex:ke})):De++}else if(de&I){if(De>0)De--;else if(Oe>0){for(Ce=0;!ye[ye.length-1]._isolate;)ye.pop();var be=ye[ye.length-1]._isolInitIndex;be!=null&&(_e.set(be,ke),_e.set(ke,be)),ye.pop(),Oe--}ce=ye[ye.length-1],K[ke]=ce._level,ce._override&&oe(ke,ce._override)}else de&D?(De===0&&(Ce>0?Ce--:!ce._isolate&&ye.length>1&&(ye.pop(),ce=ye[ye.length-1])),K[ke]=ce._level):de&F&&(K[ke]=ie.level);else K[ke]=ce._level,ce._override&&de!==Z&&oe(ke,ce._override)}for(var Ee=[],Te=null,ge=ie.start;ge<=ie.end;ge++){var Ae=O[ge];if(!(Ae&n)){var Pe=K[ge],Ne=Ae&e,je=Ae===I;Te&&Pe===Te._level?(Te._end=ge,Te._endsWithIsolInit=Ne):Ee.push(Te={_start:ge,_end:ge,_level:Pe,_startsWithPDI:je,_endsWithIsolInit:Ne})}}for(var ze=[],Je=0;Je<Ee.length;Je++){var Xe=Ee[Je];if(!Xe._startsWithPDI||Xe._startsWithPDI&&!_e.has(Xe._start)){for(var qe=[Te=Xe],$e=void 0;Te&&Te._endsWithIsolInit&&($e=_e.get(Te._end))!=null;)for(var Ye=Je+1;Ye<Ee.length;Ye++)if(Ee[Ye]._start===$e){qe.push(Te=Ee[Ye]);break}for(var Re=[],et=0;et<qe.length;et++)for(var Ar=qe[et],qt=Ar._start;qt<=Ar._end;qt++)Re.push(qt);for(var Pa=K[Re[0]],Fr=ie.level,Tt=Re[0]-1;Tt>=0;Tt--)if(!(O[Tt]&n)){Fr=K[Tt];break}var Qt=Re[Re.length-1],Ra=K[Qt],Dr=ie.level;if(!(O[Qt]&e)){for(var At=Qt+1;At<=ie.end;At++)if(!(O[At]&n)){Dr=K[At];break}}ze.push({_seqIndices:Re,_sosType:Math.max(Fr,Pa)%2?T:U,_eosType:Math.max(Dr,Ra)%2?T:U})}}for(var Zt=0;Zt<ze.length;Zt++){var $t=ze[Zt],se=$t._seqIndices,ft=$t._sosType,Oa=$t._eosType,at=K[se[0]]&1?T:U;if(q.get(ae))for(var Ft=0;Ft<se.length;Ft++){var Er=se[Ft];if(O[Er]&ae){for(var er=ft,Dt=Ft-1;Dt>=0;Dt--)if(!(O[se[Dt]]&n)){er=O[se[Dt]];break}oe(Er,er&(e|I)?W:er)}}if(q.get(L))for(var Et=0;Et<se.length;Et++){var jr=se[Et];if(O[jr]&L)for(var jt=Et-1;jt>=-1;jt--){var Mr=jt===-1?ft:O[se[jt]];if(Mr&a){Mr===G&&oe(jr,b);break}}}if(q.get(G))for(var tr=0;tr<se.length;tr++){var Nr=se[tr];O[Nr]&G&&oe(Nr,T)}if(q.get(N)||q.get(E))for(var dt=1;dt<se.length-1;dt++){var rr=se[dt];if(O[rr]&(N|E)){for(var nt=0,ar=0,nr=dt-1;nr>=0&&(nt=O[se[nr]],!!(nt&n));nr--);for(var or=dt+1;or<se.length&&(ar=O[se[or]],!!(ar&n));or++);nt===ar&&(O[rr]===N?nt===L:nt&(L|b))&&oe(rr,nt)}}if(q.get(L))for(var He=0;He<se.length;He++){var La=se[He];if(O[La]&L){for(var Mt=He-1;Mt>=0&&O[se[Mt]]&(J|n);Mt--)oe(se[Mt],L);for(He++;He<se.length&&O[se[He]]&(J|n|L);He++)O[se[He]]!==L&&oe(se[He],L)}}if(q.get(J)||q.get(N)||q.get(E))for(var ht=0;ht<se.length;ht++){var Pr=se[ht];if(O[Pr]&(J|N|E)){oe(Pr,W);for(var Nt=ht-1;Nt>=0&&O[se[Nt]]&n;Nt--)oe(se[Nt],W);for(var Pt=ht+1;Pt<se.length&&O[se[Pt]]&n;Pt++)oe(se[Pt],W)}}if(q.get(L))for(var ir=0,Rr=ft;ir<se.length;ir++){var Or=se[ir],sr=O[Or];sr&L?Rr===U&&oe(Or,U):sr&a&&(Rr=sr)}if(q.get(o)){var pt=T|L|b,Lr=pt|U,Rt=[];{for(var ot=[],it=0;it<se.length;it++)if(O[se[it]]&o){var vt=V[se[it]],Gr=void 0;if(m(vt)!==null)if(ot.length<63)ot.push({char:vt,seqIndex:it});else break;else if((Gr=S(vt))!==null)for(var gt=ot.length-1;gt>=0;gt--){var lr=ot[gt].char;if(lr===Gr||lr===S(M(vt))||m(M(lr))===vt){Rt.push([ot[gt].seqIndex,it]),ot.length=gt;break}}}Rt.sort(function(Le,Ve){return Le[0]-Ve[0]})}for(var cr=0;cr<Rt.length;cr++){for(var Ir=Rt[cr],Ot=Ir[0],ur=Ir[1],Br=!1,We=0,fr=Ot+1;fr<ur;fr++){var zr=se[fr];if(O[zr]&Lr){Br=!0;var Wr=O[zr]&pt?T:U;if(Wr===at){We=Wr;break}}}if(Br&&!We){We=ft;for(var dr=Ot-1;dr>=0;dr--){var Vr=se[dr];if(O[Vr]&Lr){var Hr=O[Vr]&pt?T:U;Hr!==at?We=Hr:We=at;break}}}if(We){if(O[se[Ot]]=O[se[ur]]=We,We!==at){for(var mt=Ot+1;mt<se.length;mt++)if(!(O[se[mt]]&n)){d(V[se[mt]])&ae&&(O[se[mt]]=We);break}}if(We!==at){for(var xt=ur+1;xt<se.length;xt++)if(!(O[se[xt]]&n)){d(V[se[xt]])&ae&&(O[se[xt]]=We);break}}}}for(var Qe=0;Qe<se.length;Qe++)if(O[se[Qe]]&o){for(var Xr=Qe,hr=Qe,pr=ft,yt=Qe-1;yt>=0;yt--)if(O[se[yt]]&n)Xr=yt;else{pr=O[se[yt]]&pt?T:U;break}for(var Yr=Oa,bt=Qe+1;bt<se.length;bt++)if(O[se[bt]]&(o|n))hr=bt;else{Yr=O[se[bt]]&pt?T:U;break}for(var vr=Xr;vr<=hr;vr++)O[se[vr]]=pr===Yr?pr:at;Qe=hr}}}for(var Ie=ie.start;Ie<=ie.end;Ie++){var Ga=K[Ie],Lt=O[Ie];if(Ga&1?Lt&(U|L|b)&&K[Ie]++:Lt&T?K[Ie]++:Lt&(b|L)&&(K[Ie]+=2),Lt&n&&(K[Ie]=Ie===0?ie.level:K[Ie-1]),Ie===ie.end||d(V[Ie])&(X|F))for(var Gt=Ie;Gt>=0&&d(V[Gt])&i;Gt--)K[Gt]=ie.level}}return{levels:K,paragraphs:ne};function Kr(Le,Ve){for(var Ge=Le;Ge<V.length;Ge++){var Ze=O[Ge];if(Ze&(T|G))return 1;if(Ze&(F|U)||Ve&&Ze===I)return 0;if(Ze&e){var Jr=Ia(Ge);Ge=Jr===-1?V.length:Jr}}return 0}function Ia(Le){for(var Ve=1,Ge=Le+1;Ge<V.length;Ge++){var Ze=O[Ge];if(Ze&F)break;if(Ze&I){if(--Ve===0)return Ge}else Ze&e&&Ve++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function z(){if(!H){var V=x(ee,!0),re=V.map,$=V.reverseMap;$.forEach(function(O,pe){re.set(pe,O)}),H=re}}function me(V){return z(),H.get(V)||null}function fe(V,re,$,O){var pe=V.length;$=Math.max(0,$==null?0:+$),O=Math.min(pe-1,O==null?pe-1:+O);for(var q=new Map,oe=$;oe<=O;oe++)if(re[oe]&1){var K=me(V[oe]);K!==null&&q.set(oe,K)}return q}function Q(V,re,$,O){var pe=V.length;$=Math.max(0,$==null?0:+$),O=Math.min(pe-1,O==null?pe-1:+O);var q=[];return re.paragraphs.forEach(function(oe){var K=Math.max($,oe.start),_e=Math.min(O,oe.end);if(K<_e){for(var ne=re.levels.slice(K,_e+1),ie=_e;ie>=K&&d(V[ie])&i;ie--)ne[ie]=oe.level;for(var ue=oe.level,ve=1/0,Ue=0;Ue<ne.length;Ue++){var Fe=ne[Ue];Fe>ue&&(ue=Fe),Fe<ve&&(ve=Fe|1)}for(var xe=ue;xe>=ve;xe--)for(var ye=0;ye<ne.length;ye++)if(ne[ye]>=xe){for(var ce=ye;ye+1<ne.length&&ne[ye+1]>=xe;)ye++;ye>ce&&q.push([ce+K,ye+K])}}}),q}function te(V,re,$,O){var pe=le(V,re,$,O),q=[].concat(V);return pe.forEach(function(oe,K){q[K]=(re.levels[oe]&1?me(V[oe]):null)||V[oe]}),q.join("")}function le(V,re,$,O){for(var pe=Q(V,re,$,O),q=[],oe=0;oe<V.length;oe++)q[oe]=oe;return pe.forEach(function(K){for(var _e=K[0],ne=K[1],ie=q.slice(_e,ne+1),ue=ie.length;ue--;)q[ne-ue]=ie[ue]}),q}return r.closingToOpeningBracket=S,r.getBidiCharType=d,r.getBidiCharTypeName=h,r.getCanonicalBracket=M,r.getEmbeddingLevels=Y,r.getMirroredCharacter=me,r.getMirroredCharactersMap=fe,r.getReorderSegments=Q,r.getReorderedIndices=le,r.getReorderedString=te,r.openingToClosingBracket=m,Object.defineProperty(r,"__esModule",{value:!0}),r})({});return l}const Ua=/\bvoid\s+main\s*\(\s*\)\s*{/g;function _r(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function u(c,t){let e=Ha[t];return e?_r(e):c}return l.replace(r,u)}const Me=[];for(let l=0;l<256;l++)Me[l]=(l<16?"0":"")+l.toString(16);function yn(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,u=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return(Me[l&255]+Me[l>>8&255]+Me[l>>16&255]+Me[l>>24&255]+"-"+Me[r&255]+Me[r>>8&255]+"-"+Me[r>>16&15|64]+Me[r>>24&255]+"-"+Me[u&63|128]+Me[u>>8&255]+"-"+Me[u>>16&255]+Me[u>>24&255]+Me[c&255]+Me[c>>8&255]+Me[c>>16&255]+Me[c>>24&255]).toUpperCase()}const tt=Object.assign||function(){let l=arguments[0];for(let r=1,u=arguments.length;r<u;r++){let c=arguments[r];if(c)for(let t in c)Object.prototype.hasOwnProperty.call(c,t)&&(l[t]=c[t])}return l},bn=Date.now(),ea=new WeakMap,ta=new Map;let _n=1e10;function Sr(l,r){const u=kn(r);let c=ea.get(l);if(c||ea.set(l,c=Object.create(null)),c[u])return new c[u];const t=`_onBeforeCompile${u}`,e=function(i,s){l.onBeforeCompile.call(this,i,s);const f=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let d=ta[f];if(!d){const h=Sn(this,i,r,u);d=ta[f]=h}i.vertexShader=d.vertexShader,i.fragmentShader=d.fragmentShader,tt(i.uniforms,this.uniforms),r.timeUniform&&(i.uniforms[r.timeUniform]={get value(){return Date.now()-bn}}),this[t]&&this[t](i)},a=function(){return o(r.chained?l:l.clone())},o=function(i){const s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:_n++}),s.uuid=yn(),s.uniforms=tt({},i.uniforms,r.uniforms),s.defines=tt({},i.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${u}`]="",s.extensions=tt({},i.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:i=>{l.type=i}},isDerivedFrom:{writable:!0,configurable:!0,value:function(i){const s=this.baseMaterial;return i===s||s.isDerivedMaterial&&s.isDerivedFrom(i)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+u}},onBeforeCompile:{get(){return e},set(i){this[t]=i}},copy:{writable:!0,configurable:!0,value:function(i){return l.copy.call(this,i),!l.isShaderMaterial&&!l.isDerivedMaterial&&(tt(this.extensions,i.extensions),tt(this.defines,i.defines),tt(this.uniforms,Va.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new l.constructor;return o(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=Sr(l.isDerivedMaterial?l.getDepthMaterial():new za({depthPacking:Wa}),r),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=Sr(l.isDerivedMaterial?l.getDistanceMaterial():new Ba,r),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return c[u]=a,new a}function Sn(l,{vertexShader:r,fragmentShader:u},c,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:n,fragmentDefs:i,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:g}=c;if(e=e||"",a=a||"",o=o||"",i=i||"",s=s||"",f=f||"",(n||h)&&(r=_r(r)),(d||h)&&(u=u.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),u=_r(u)),h){let x=h({vertexShader:r,fragmentShader:u});r=x.vertexShader,u=x.fragmentShader}if(d){let x=[];u=u.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(x.push(y),"")),f=`${d}
${x.join(`
`)}
${f}`}if(g){const x=`
uniform float ${g};
`;e=x+e,i=x+i}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(x,y,R,C)=>/\battribute\s+vec[23]\s+$/.test(C.substr(0,R))?y:`troika_${y}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=ra(r,t,e,a,o),u=ra(u,t,i,s,f),{vertexShader:r,fragmentShader:u}}function ra(l,r,u,c,t){return(c||t||u)&&(l=l.replace(Ua,`
${u}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${c}
  troikaOrigMain${r}();
  ${t}
}`),l}function wn(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let Un=0;const aa=new Map;function kn(l){const r=JSON.stringify(l,wn);let u=aa.get(r);return u==null&&aa.set(r,u=++Un),u}function Cn(){return typeof window>"u"&&(self.window=self),(function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var o=4;e.readUshort(a,o),o+=2,e.readUshort(a,o),o+=2;var n=e.readUint(a,o);o+=4;for(var i=[],s=0;s<n;s++){var f=e.readUint(a,o);o+=4,i.push(r._readFont(a,f))}return i}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,o=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:o},f={},d=0;d<n;d++){var h=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var g=a.readUint(t,e);e+=4;var x=a.readUint(t,e);e+=4,f[h]={offset:g,length:x}}for(d=0;d<i.length;d++){var y=i[d];f[y]&&(s[y.trim()]=r[y.trim()].parse(t,f[y].offset,f[y].length,s))}return s},_tabOffset:function(t,e,a){for(var o=r._bin,n=o.readUshort(t,a+4),i=a+12,s=0;s<n;s++){var f=o.readASCII(t,i,4);i+=4,o.readUint(t,i),i+=4;var d=o.readUint(t,i);if(i+=4,o.readUint(t,i),i+=4,f==e)return d}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(r._bin.readUshort(t,e+2*n));return o},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var o="",n=0;n<a;n++)o+=String.fromCharCode(t[e+n]);return o},readUnicode:function(t,e,a){for(var o="",n=0;n<a;n++){var i=t[e++]<<8|t[e++];o+=String.fromCharCode(i)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var o=r._bin._tdec;return o&&e==0&&a==t.length?o.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(t[e+n]);return o},readASCIIArray:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(String.fromCharCode(t[e+n]));return o},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,o,n){var i=r._bin,s={},f=e;i.readFixed(t,e),e+=4;var d=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+d),s.featureList=r._lctf.readFeatureList(t,f+h),s.lookupList=r._lctf.readLookupList(t,f+g,n),s},r._lctf.readLookupList=function(t,e,a){var o=r._bin,n=e,i=[],s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var d=o.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+d,a);i.push(h)}return i},r._lctf.readLookupTable=function(t,e,a){var o=r._bin,n=e,i={tabs:[]};i.ltype=o.readUshort(t,e),e+=2,i.flag=o.readUshort(t,e),e+=2;var s=o.readUshort(t,e);e+=2;for(var f=i.ltype,d=0;d<s;d++){var h=o.readUshort(t,e);e+=2;var g=a(t,f,n+h,i);i.tabs.push(g)}return i},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)(t>>>a&1)!=0&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,o=[],n=a.readUshort(t,e);if(e+=2,n==1){var i=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++)o.push(i+f),o.push(i+f),o.push(a.readUshort(t,e)),e+=2}if(n==2){var d=a.readUshort(t,e);for(e+=2,f=0;f<d;f++)o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2}return o},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var o=t[a],n=t[a+1];if(t[a+2],o<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,o={};o.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.fmt==1&&(o.tab=a.readUshorts(t,e,n)),o.fmt==2&&(o.tab=a.readUshorts(t,e,3*n)),o},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var o=r._lctf.getInterval(a,e);if(o!=-1)return a[o+2]+(e-a[o])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,o+d);h.tag=f.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.featureParams=o+i);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(a.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,o+d)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.default=r._lctf.readLangSysTable(t,o+i));var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var d=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[d.trim()]=r._lctf.readLangSysTable(t,o+h)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,o={};a.readUshort(t,e),e+=2,o.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.features=a.readUshorts(t,e,n),o},r.CFF={},r.CFF.parse=function(t,e,a){var o=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var i=[],s=0;s<n.length-1;s++)i.push(o.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var d=[];for(s=0;s<f.length-1;s++)d.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var h=d[0],g=[];e=r.CFF.readIndex(t,e,g);var x=[];for(s=0;s<g.length-1;s++)x.push(o.readASCII(t,e+g[s],g[s+1]-g[s]));if(e+=g[g.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,g=[],e=r.CFF.readIndex(t,e,g);var y=[];for(s=0;s<g.length-1;s++)y.push(o.readBytes(t,e+g[s],g[s+1]-g[s]));h.CharStrings=y}if(h.ROS){e=h.FDArray;var R=[];for(e=r.CFF.readIndex(t,e,R),h.FDArray=[],s=0;s<R.length-1;s++){var C=r.CFF.readDict(t,e+R[s],e+R[s+1]);r.CFF._readFDict(t,C,x),h.FDArray.push(C)}e+=R[R.length-1],e=h.FDSelect,h.FDSelect=[];var _=t[e];if(e++,_!=3)throw _;var m=o.readUshort(t,e);for(e+=2,s=0;s<m+1;s++)h.FDSelect.push(o.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,x),h},r.CFF._readFDict=function(t,e,a){var o;for(var n in e.Private&&(o=e.Private[1],e.Private=r.CFF.readDict(t,o,o+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,o+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var o=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var f=0;f<n.length-1;f++)a.Subrs.push(o.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var o=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var i=t[e];e++;for(var s=0;s<i;s++)o.push(t[e+s]);return o},r.CFF.readCharset=function(t,e,a){var o=r._bin,n=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<a;s++){var f=o.readUshort(t,e);e+=2,n.push(f)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<a;){f=o.readUshort(t,e),e+=2;var d=0;for(i==1?(d=t[e],e++):(d=o.readUshort(t,e),e+=2),s=0;s<=d;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,a){var o=r._bin,n=o.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(i==2)for(s=0;s<n;s++)a.push(o.readUshort(t,e+2*s));else if(i==3)for(s=0;s<n;s++)a.push(16777215&o.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(e+=n*i)-1},r.CFF.getCharString=function(t,e,a){var o=r._bin,n=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,d=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+i,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(d=o.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(d=n-139,s=1),247<=n&&n<=250&&(d=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(d=256*-(n-251)-i-108,s=2),n==255&&(d=o.readInt(t,e+1)/65535,s=5),a.val=d??"o"+f,a.size=s},r.CFF.readCharString=function(t,e,a){for(var o=e+a,n=r._bin,i=[];e<o;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,g=null;s<=20&&(h=s,d=1),s==12&&(h=100*s+f,d=2),s!=19&&s!=20||(h=s,d=2),21<=s&&s<=27&&(h=s,d=1),s==28&&(g=n.readShort(t,e+1),d=3),29<=s&&s<=31&&(h=s,d=1),32<=s&&s<=246&&(g=s-139,d=1),247<=s&&s<=250&&(g=256*(s-247)+f+108,d=2),251<=s&&s<=254&&(g=256*-(s-251)-f-108,d=2),s==255&&(g=n.readInt(t,e+1)/65535,d=5),i.push(g??"o"+h),e+=d}return i},r.CFF.readDict=function(t,e,a){for(var o=r._bin,n={},i=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,g=null;if(s==28&&(g=o.readShort(t,e+1),d=3),s==29&&(g=o.readInt(t,e+1),d=5),32<=s&&s<=246&&(g=s-139,d=1),247<=s&&s<=250&&(g=256*(s-247)+f+108,d=2),251<=s&&s<=254&&(g=256*-(s-251)-f-108,d=2),s==255)throw g=o.readInt(t,e+1)/65535,d=5,"unknown number";if(s==30){var x=[];for(d=1;;){var y=t[e+d];d++;var R=y>>4,C=15&y;if(R!=15&&x.push(R),C!=15&&x.push(C),C==15)break}for(var _="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<x.length;S++)_+=m[x[S]];g=parseFloat(_)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],d=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],d=2)),h!=null?(n[h]=i.length==1?i[0]:i,i=[]):i.push(g),e+=d}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<i;f++){var d=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var g=o.readUint(t,e);e+=4;var x="p"+d+"e"+h,y=s.indexOf(g);if(y==-1){var R;y=n.tables.length,s.push(g);var C=o.readUshort(t,g);C==0?R=r.cmap.parse0(t,g):C==4?R=r.cmap.parse4(t,g):C==6?R=r.cmap.parse6(t,g):C==12?R=r.cmap.parse12(t,g):console.debug("unknown format: "+C,d,h,g),n.tables.push(R)}if(n[x]!=null)throw"multiple tables for one platform+encoding";n[x]=y}return n},r.cmap.parse0=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,o.map=[];for(var i=0;i<n-6;i++)o.map.push(t[e+i]);return o},r.cmap.parse4=function(t,e){var a=r._bin,o=e,n={};n.format=a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var f=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=a.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var d=0;d<f;d++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<o+i;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,o.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,o.glyphIdArray=[];for(var i=0;i<n;i++)o.glyphIdArray.push(a.readUshort(t,e)),e+=2;return o},r.cmap.parse12=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,o.groups=[];for(var i=0;i<n;i++){var s=e+12*i,f=a.readUint(t,s+0),d=a.readUint(t,s+4),h=a.readUint(t,s+8);o.groups.push([f,d,h])}return o},r.glyf={},r.glyf.parse=function(t,e,a,o){for(var n=[],i=0;i<o.maxp.numGlyphs;i++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,o=t._data,n=r._tabOffset(o,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=a.readShort(o,n),n+=2,i.xMin=a.readShort(o,n),n+=2,i.yMin=a.readShort(o,n),n+=2,i.xMax=a.readShort(o,n),n+=2,i.yMax=a.readShort(o,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(o,n)),n+=2;var f=a.readUshort(o,n);if(n+=2,o.length-n<f)return null;i.instructions=a.readBytes(o,n,f),n+=f;var d=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<d;s++){var h=o[n];if(n++,i.flags.push(h),(8&h)!=0){var g=o[n];n++;for(var x=0;x<g;x++)i.flags.push(h),s++}}for(i.xs=[],s=0;s<d;s++){var y=(2&i.flags[s])!=0,R=(16&i.flags[s])!=0;y?(i.xs.push(R?o[n]:-o[n]),n++):R?i.xs.push(0):(i.xs.push(a.readShort(o,n)),n+=2)}for(i.ys=[],s=0;s<d;s++)y=(4&i.flags[s])!=0,R=(32&i.flags[s])!=0,y?(i.ys.push(R?o[n]:-o[n]),n++):R?i.ys.push(0):(i.ys.push(a.readShort(o,n)),n+=2);var C=0,_=0;for(s=0;s<d;s++)C+=i.xs[s],_+=i.ys[s],i.xs[s]=C,i.ys[s]=_}else{var m;i.parts=[];do{m=a.readUshort(o,n),n+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(S),S.glyphIndex=a.readUshort(o,n),n+=2,1&m){var M=a.readShort(o,n);n+=2;var U=a.readShort(o,n);n+=2}else M=a.readInt8(o,n),n++,U=a.readInt8(o,n),n++;2&m?(S.m.tx=M,S.m.ty=U):(S.p1=M,S.p2=U),8&m?(S.m.a=S.m.d=a.readF2dot14(o,n),n+=2):64&m?(S.m.a=a.readF2dot14(o,n),n+=2,S.m.d=a.readF2dot14(o,n),n+=2):128&m&&(S.m.a=a.readF2dot14(o,n),n+=2,S.m.b=a.readF2dot14(o,n),n+=2,S.m.c=a.readF2dot14(o,n),n+=2,S.m.d=a.readF2dot14(o,n),n+=2)}while(32&m);if(256&m){var T=a.readUshort(o,n);for(n+=2,i.instr=[],s=0;s<T;s++)i.instr.push(o[n]),n++}}return i},r.GDEF={},r.GDEF.parse=function(t,e,a,o){var n=e;e+=4;var i=r._bin.readUshort(t,e);return{glyphClassDef:i===0?null:r._lctf.readClassDef(t,n+i)}},r.GPOS={},r.GPOS.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,f+i)}if(e==1&&s.fmt==1){var d=n.readUshort(t,a);a+=2,d!=0&&(s.pos=r.GPOS.readValueRecord(t,a,d))}else if(e==2&&s.fmt>=1&&s.fmt<=2){d=n.readUshort(t,a),a+=2;var h=n.readUshort(t,a);a+=2;var g=r._lctf.numOfOnes(d),x=r._lctf.numOfOnes(h);if(s.fmt==1){s.pairsets=[];var y=n.readUshort(t,a);a+=2;for(var R=0;R<y;R++){var C=i+n.readUshort(t,a);a+=2;var _=n.readUshort(t,C);C+=2;for(var m=[],S=0;S<_;S++){var M=n.readUshort(t,C);C+=2,d!=0&&(b=r.GPOS.readValueRecord(t,C,d),C+=2*g),h!=0&&(E=r.GPOS.readValueRecord(t,C,h),C+=2*x),m.push({gid2:M,val1:b,val2:E})}s.pairsets.push(m)}}if(s.fmt==2){var U=n.readUshort(t,a);a+=2;var T=n.readUshort(t,a);a+=2;var L=n.readUshort(t,a);a+=2;var N=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,i+U),s.classDef2=r._lctf.readClassDef(t,i+T),s.matrix=[],R=0;R<L;R++){var J=[];for(S=0;S<N;S++){var b=null,E=null;d!=0&&(b=r.GPOS.readValueRecord(t,a,d),a+=2*g),h!=0&&(E=r.GPOS.readValueRecord(t,a,h),a+=2*x),J.push({val1:b,val2:E})}s.matrix.push(J)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else{if(e==9&&s.fmt==1){var F=n.readUshort(t,a);a+=2;var X=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=F;else if(o.ltype!=F)throw"invalid extension substitution";return r.GPOS.subt(t,o.ltype,i+X)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var o=r._bin,n=[];return n.push(1&a?o.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?o.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?o.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?o.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var o=r._bin,n=[],i=e,s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){for(var d=[],h=0;h<a;h++)d.push(r.GPOS.readAnchorRecord(t,i+o.readUshort(t,e))),e+=2;n.push(d)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,o=[],n=e,i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);f.markClass=a.readUshort(t,e),o.push(f),e+=4}return o},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,o={};return o.fmt=a.readUshort(t,e),o.x=a.readShort(t,e+2),o.y=a.readShort(t,e+4),o},r.GSUB={},r.GSUB.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,i+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var d=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,d),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){d=n.readUshort(t,a),a+=2,s.seqs=[];for(var h=0;h<d;h++){var g=n.readUshort(t,a)+i;a+=2;var x=n.readUshort(t,g);s.seqs.push(n.readUshorts(t,g+2,x))}}else if(e==4)for(s.vals=[],d=n.readUshort(t,a),a+=2,h=0;h<d;h++){var y=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,i+y))}else if(e==5&&s.fmt==2){if(s.fmt==2){var R=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,i+R),s.scset=[];var C=n.readUshort(t,a);for(a+=2,h=0;h<C;h++){var _=n.readUshort(t,a);a+=2,s.scset.push(_==0?null:r.GSUB.readSubClassSet(t,i+_))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){d=n.readUshort(t,a),a+=2;for(var m=[],S=0;S<d;S++)m.push(r._lctf.readCoverage(t,i+n.readUshort(t,a+2*S)));a+=2*d,h==0&&(s.backCvg=m),h==1&&(s.inptCvg=m),h==2&&(s.ahedCvg=m)}d=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,d)}}else{if(e==7&&s.fmt==1){var M=n.readUshort(t,a);a+=2;var U=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=M;else if(o.ltype!=M)throw"invalid extension substitution";return r.GSUB.subt(t,o.ltype,i+U)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,o=e,n=[],i=a(t,e);e+=2;for(var s=0;s<i;s++){var f=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,o+f))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,o={},n=a(t,e),i=a(t,e+=2);e+=2,o.input=[];for(var s=0;s<n-1;s++)o.input.push(a(t,e)),e+=2;return o.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,i),o},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var o=r._bin.readUshort,n=[],i=0;i<a;i++)n.push(o(t,e),o(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,o+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,o={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=a.readUshort(t,e);e+=2,i==1&&s--,o[n[i]]=a.readUshorts(t,e,s),e+=2*o[n[i]].length}return s=a.readUshort(t,e),e+=2,o.subst=a.readUshorts(t,e,2*s),e+=2*o.subst.length,o},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,o+f))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,o={chain:[]};o.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var i=0;i<n-1;i++)o.chain.push(a.readUshort(t,e)),e+=2;return o},r.head={},r.head.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.fontRevision=o.readFixed(t,e),e+=4,o.readUint(t,e),e+=4,o.readUint(t,e),e+=4,n.flags=o.readUshort(t,e),e+=2,n.unitsPerEm=o.readUshort(t,e),e+=2,n.created=o.readUint64(t,e),e+=8,n.modified=o.readUint64(t,e),e+=8,n.xMin=o.readShort(t,e),e+=2,n.yMin=o.readShort(t,e),e+=2,n.xMax=o.readShort(t,e),e+=2,n.yMax=o.readShort(t,e),e+=2,n.macStyle=o.readUshort(t,e),e+=2,n.lowestRecPPEM=o.readUshort(t,e),e+=2,n.fontDirectionHint=o.readShort(t,e),e+=2,n.indexToLocFormat=o.readShort(t,e),e+=2,n.glyphDataFormat=o.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.ascender=o.readShort(t,e),e+=2,n.descender=o.readShort(t,e),e+=2,n.lineGap=o.readShort(t,e),e+=2,n.advanceWidthMax=o.readUshort(t,e),e+=2,n.minLeftSideBearing=o.readShort(t,e),e+=2,n.minRightSideBearing=o.readShort(t,e),e+=2,n.xMaxExtent=o.readShort(t,e),e+=2,n.caretSlopeRise=o.readShort(t,e),e+=2,n.caretSlopeRun=o.readShort(t,e),e+=2,n.caretOffset=o.readShort(t,e),e+=2,e+=8,n.metricDataFormat=o.readShort(t,e),e+=2,n.numberOfHMetrics=o.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,o){for(var n=r._bin,i={aWidth:[],lsBearing:[]},s=0,f=0,d=0;d<o.maxp.numGlyphs;d++)d<o.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(f);return i},r.kern={},r.kern.parse=function(t,e,a,o){var n=r._bin,i=n.readUshort(t,e);if(e+=2,i==1)return r.kern.parseV1(t,e-2,a,o);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},d=0;d<s;d++){e+=2,a=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var g=h>>>8;if((g&=15)!=0)throw"unknown kern table format: "+g;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,a,o){var n=r._bin;n.readFixed(t,e),e+=4;var i=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<i;f++){n.readUint(t,e),e+=4;var d=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var o=r._bin,n=-1,i=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var f=o.readUshort(t,e);e+=2;var d=o.readUshort(t,e);e+=2;var h=o.readShort(t,e);e+=2,f!=n&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var g=a.rval[a.rval.length-1];g.glyph2.push(d),g.vals.push(h),n=f}return e},r.loca={},r.loca.parse=function(t,e,a,o){var n=r._bin,i=[],s=o.head.indexToLocFormat,f=o.maxp.numGlyphs+1;if(s==0)for(var d=0;d<f;d++)i.push(n.readUshort(t,e+(d<<1))<<1);if(s==1)for(d=0;d<f;d++)i.push(n.readUint(t,e+(d<<2)));return i},r.maxp={},r.maxp.parse=function(t,e,a){var o=r._bin,n={},i=o.readUint(t,e);return e+=4,n.numGlyphs=o.readUshort(t,e),e+=2,i==65536&&(n.maxPoints=o.readUshort(t,e),e+=2,n.maxContours=o.readUshort(t,e),e+=2,n.maxCompositePoints=o.readUshort(t,e),e+=2,n.maxCompositeContours=o.readUshort(t,e),e+=2,n.maxZones=o.readUshort(t,e),e+=2,n.maxTwilightPoints=o.readUshort(t,e),e+=2,n.maxStorage=o.readUshort(t,e),e+=2,n.maxFunctionDefs=o.readUshort(t,e),e+=2,n.maxInstructionDefs=o.readUshort(t,e),e+=2,n.maxStackElements=o.readUshort(t,e),e+=2,n.maxSizeOfInstructions=o.readUshort(t,e),e+=2,n.maxComponentElements=o.readUshort(t,e),e+=2,n.maxComponentDepth=o.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2,o.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,h=0;h<i;h++){var g=o.readUshort(t,e);e+=2;var x=o.readUshort(t,e);e+=2;var y=o.readUshort(t,e);e+=2;var R=o.readUshort(t,e);e+=2;var C=o.readUshort(t,e);e+=2;var _=o.readUshort(t,e);e+=2;var m,S=f[R],M=d+12*i+_;if(g==0)m=o.readUnicode(t,M,C/2);else if(g==3&&x==0)m=o.readUnicode(t,M,C/2);else if(x==0)m=o.readASCII(t,M,C);else if(x==1)m=o.readUnicode(t,M,C/2);else if(x==3)m=o.readUnicode(t,M,C/2);else{if(g!=1)throw"unknown encoding "+x+", platformID: "+g;m=o.readASCII(t,M,C),console.debug("reading unknown MAC encoding "+x+" as ASCII")}var U="p"+g+","+y.toString(16);n[U]==null&&(n[U]={}),n[U][S!==void 0?S:R]=m,n[U]._lang=y}for(var T in n)if(n[T].postScriptName!=null&&n[T]._lang==1033)return n[T];for(var T in n)if(n[T].postScriptName!=null&&n[T]._lang==0)return n[T];for(var T in n)if(n[T].postScriptName!=null&&n[T]._lang==3084)return n[T];for(var T in n)if(n[T].postScriptName!=null)return n[T];for(var T in n){s=T;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var o=r._bin.readUshort(t,e);e+=2;var n={};if(o==0)r["OS/2"].version0(t,e,n);else if(o==1)r["OS/2"].version1(t,e,n);else if(o==2||o==3||o==4)r["OS/2"].version2(t,e,n);else{if(o!=5)throw"unknown OS/2 table version: "+o;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var o=r._bin;return a.xAvgCharWidth=o.readShort(t,e),e+=2,a.usWeightClass=o.readUshort(t,e),e+=2,a.usWidthClass=o.readUshort(t,e),e+=2,a.fsType=o.readUshort(t,e),e+=2,a.ySubscriptXSize=o.readShort(t,e),e+=2,a.ySubscriptYSize=o.readShort(t,e),e+=2,a.ySubscriptXOffset=o.readShort(t,e),e+=2,a.ySubscriptYOffset=o.readShort(t,e),e+=2,a.ySuperscriptXSize=o.readShort(t,e),e+=2,a.ySuperscriptYSize=o.readShort(t,e),e+=2,a.ySuperscriptXOffset=o.readShort(t,e),e+=2,a.ySuperscriptYOffset=o.readShort(t,e),e+=2,a.yStrikeoutSize=o.readShort(t,e),e+=2,a.yStrikeoutPosition=o.readShort(t,e),e+=2,a.sFamilyClass=o.readShort(t,e),e+=2,a.panose=o.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=o.readUint(t,e),e+=4,a.ulUnicodeRange2=o.readUint(t,e),e+=4,a.ulUnicodeRange3=o.readUint(t,e),e+=4,a.ulUnicodeRange4=o.readUint(t,e),e+=4,a.achVendID=[o.readInt8(t,e),o.readInt8(t,e+1),o.readInt8(t,e+2),o.readInt8(t,e+3)],e+=4,a.fsSelection=o.readUshort(t,e),e+=2,a.usFirstCharIndex=o.readUshort(t,e),e+=2,a.usLastCharIndex=o.readUshort(t,e),e+=2,a.sTypoAscender=o.readShort(t,e),e+=2,a.sTypoDescender=o.readShort(t,e),e+=2,a.sTypoLineGap=o.readShort(t,e),e+=2,a.usWinAscent=o.readUshort(t,e),e+=2,a.usWinDescent=o.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var o=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=o.readUint(t,e),e+=4,a.ulCodePageRange2=o.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var o=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=o.readShort(t,e),e+=2,a.sCapHeight=o.readShort(t,e),e+=2,a.usDefault=o.readUshort(t,e),e+=2,a.usBreak=o.readUshort(t,e),e+=2,a.usMaxContext=o.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var o=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=o.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=o.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var o=r._bin,n={};return n.version=o.readFixed(t,e),e+=4,n.italicAngle=o.readFixed(t,e),e+=4,n.underlinePosition=o.readShort(t,e),e+=2,n.underlineThickness=o.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var n=a.tables[o];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>e?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[e-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:e+n.idDelta[i])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var o=t.SVG.entries[e];return o==null?a:(typeof o=="string"&&(o=r.SVG.toPath(o),t.SVG.entries[e]=o),o)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var f=0;i.FDSelect[f+2]<=e;)f+=2;s=i.FDArray[i.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,i,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var o=e.glyf[t];o==null&&(o=e.glyf[t]=r.glyf._parseGlyf(e,t)),o!=null&&(o.noc>-1?r.U._simpleGlyph(o,a):r.U._compoGlyph(o,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var o=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],i=o;i<=n;i++){var s=i==o?n:i-1,f=i==n?o:i+1,d=1&t.flags[i],h=1&t.flags[s],g=1&t.flags[f],x=t.xs[i],y=t.ys[i];if(i==o)if(d){if(!h){r.U.P.moveTo(e,x,y);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+x)/2,(t.ys[s]+y)/2);d?h&&r.U.P.lineTo(e,x,y):g?r.U.P.qcurveTo(e,x,y,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,x,y,(x+t.xs[f])/2,(y+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var o=0;o<t.parts.length;o++){var n={cmds:[],crds:[]},i=t.parts[o];r.U._drawGlyf(i.glyphIndex,e,n);for(var s=i.m,f=0;f<n.crds.length;f+=2){var d=n.crds[f],h=n.crds[f+1];a.crds.push(d*s.a+h*s.b+s.tx),a.crds.push(d*s.c+h*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)a.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,o){for(var n=t.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,f=a.tabs[i];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(a.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(a.ltype==4)for(var d=f.vals[s],h=0;h<d.length;h++){var g=d[h],x=g.chain.length;if(!(x>n)){for(var y=!0,R=0,C=0;C<x;C++){for(;t[e+R+(1+C)]==-1;)R++;g.chain[C]!=t[e+R+(1+C)]&&(y=!1)}if(y){for(t[e]=g.nglyph,C=0;C<x+R;C++)t[e+C+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var _=r._lctf.getInterval(f.cDef,t[e]),m=f.cDef[_+2],S=f.scset[m],M=0;M<S.length;M++){var U=S[M],T=U.input;if(!(T.length>n)){for(y=!0,C=0;C<T.length;C++){var L=r._lctf.getInterval(f.cDef,t[e+1+C]);if(_==-1&&f.cDef[L+2]!=T[C]){y=!1;break}}if(y){var N=U.substLookupRecords;for(h=0;h<N.length;h+=2)N[h],N[h+1]}}}else if(a.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var J=f.lookupRec;for(M=0;M<J.length;M+=2){_=J[M];var b=o[J[M+1]];r.U._applySubs(t,e+_,b,o)}}}}},r.U._glsCovered=function(t,e,a){for(var o=0;o<e.length;o++)if(r._lctf.coverageIndex(e[o],t[a+o])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var o={cmds:[],crds:[]},n=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var f=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,d=r.U.glyphToPath(t,s),h=0;h<d.crds.length;h+=2)o.crds.push(d.crds[h]+n),o.crds.push(d.crds[h+1]);for(a&&o.cmds.push(a),h=0;h<d.cmds.length;h++)o.cmds.push(d.cmds[h]);a&&o.cmds.push("X"),n+=t.hmtx.aWidth[s],i<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return o},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,o,n,i,s){t.cmds.push("C"),t.crds.push(e,a,o,n,i,s)},r.U.P.qcurveTo=function(t,e,a,o,n){t.cmds.push("Q"),t.crds.push(e,a,o,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,o,n){for(var i=e.stack,s=e.nStems,f=e.haveWidth,d=e.width,h=e.open,g=0,x=e.x,y=e.y,R=0,C=0,_=0,m=0,S=0,M=0,U=0,T=0,L=0,N=0,J={val:0,size:0};g<t.length;){r.CFF.getCharString(t,g,J);var b=J.val;if(g+=J.size,b=="o1"||b=="o18")i.length%2!=0&&!f&&(d=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(b=="o3"||b=="o23")i.length%2!=0&&!f&&(d=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(b=="o4")i.length>1&&!f&&(d=i.shift()+o.nominalWidthX,f=!0),h&&r.U.P.closePath(n),y+=i.pop(),r.U.P.moveTo(n,x,y),h=!0;else if(b=="o5")for(;i.length>0;)x+=i.shift(),y+=i.shift(),r.U.P.lineTo(n,x,y);else if(b=="o6"||b=="o7")for(var E=i.length,F=b=="o6",X=0;X<E;X++){var W=i.shift();F?x+=W:y+=W,F=!F,r.U.P.lineTo(n,x,y)}else if(b=="o8"||b=="o24"){E=i.length;for(var Z=0;Z+6<=E;)R=x+i.shift(),C=y+i.shift(),_=R+i.shift(),m=C+i.shift(),x=_+i.shift(),y=m+i.shift(),r.U.P.curveTo(n,R,C,_,m,x,y),Z+=6;b=="o24"&&(x+=i.shift(),y+=i.shift(),r.U.P.lineTo(n,x,y))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(C=y,_=(R=x+i.shift())+i.shift(),N=m=C+i.shift(),M=m,T=y,x=(U=(S=(L=_+i.shift())+i.shift())+i.shift())+i.shift(),r.U.P.curveTo(n,R,C,_,m,L,N),r.U.P.curveTo(n,S,M,U,T,x,y)),b=="o1235"&&(R=x+i.shift(),C=y+i.shift(),_=R+i.shift(),m=C+i.shift(),L=_+i.shift(),N=m+i.shift(),S=L+i.shift(),M=N+i.shift(),U=S+i.shift(),T=M+i.shift(),x=U+i.shift(),y=T+i.shift(),i.shift(),r.U.P.curveTo(n,R,C,_,m,L,N),r.U.P.curveTo(n,S,M,U,T,x,y)),b=="o1236"&&(R=x+i.shift(),C=y+i.shift(),_=R+i.shift(),N=m=C+i.shift(),M=m,U=(S=(L=_+i.shift())+i.shift())+i.shift(),T=M+i.shift(),x=U+i.shift(),r.U.P.curveTo(n,R,C,_,m,L,N),r.U.P.curveTo(n,S,M,U,T,x,y)),b=="o1237"&&(R=x+i.shift(),C=y+i.shift(),_=R+i.shift(),m=C+i.shift(),L=_+i.shift(),N=m+i.shift(),S=L+i.shift(),M=N+i.shift(),U=S+i.shift(),T=M+i.shift(),Math.abs(U-x)>Math.abs(T-y)?x=U+i.shift():y=T+i.shift(),r.U.P.curveTo(n,R,C,_,m,L,N),r.U.P.curveTo(n,S,M,U,T,x,y));else if(b=="o14"){if(i.length>0&&!f&&(d=i.shift()+a.nominalWidthX,f=!0),i.length==4){var ae=i.shift(),G=i.shift(),P=i.shift(),v=i.shift(),w=r.CFF.glyphBySE(a,P),A=r.CFF.glyphBySE(a,v);r.U._drawCFF(a.CharStrings[w],e,a,o,n),e.x=ae,e.y=G,r.U._drawCFF(a.CharStrings[A],e,a,o,n)}h&&(r.U.P.closePath(n),h=!1)}else if(b=="o19"||b=="o20")i.length%2!=0&&!f&&(d=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0,g+=s+7>>3;else if(b=="o21")i.length>2&&!f&&(d=i.shift()+o.nominalWidthX,f=!0),y+=i.pop(),x+=i.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,x,y),h=!0;else if(b=="o22")i.length>1&&!f&&(d=i.shift()+o.nominalWidthX,f=!0),x+=i.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,x,y),h=!0;else if(b=="o25"){for(;i.length>6;)x+=i.shift(),y+=i.shift(),r.U.P.lineTo(n,x,y);R=x+i.shift(),C=y+i.shift(),_=R+i.shift(),m=C+i.shift(),x=_+i.shift(),y=m+i.shift(),r.U.P.curveTo(n,R,C,_,m,x,y)}else if(b=="o26")for(i.length%2&&(x+=i.shift());i.length>0;)R=x,C=y+i.shift(),x=_=R+i.shift(),y=(m=C+i.shift())+i.shift(),r.U.P.curveTo(n,R,C,_,m,x,y);else if(b=="o27")for(i.length%2&&(y+=i.shift());i.length>0;)C=y,_=(R=x+i.shift())+i.shift(),m=C+i.shift(),x=_+i.shift(),y=m,r.U.P.curveTo(n,R,C,_,m,x,y);else if(b=="o10"||b=="o29"){var D=b=="o10"?o:a;if(i.length==0)console.debug("error: empty stack");else{var k=i.pop(),B=D.Subrs[k+D.Bias];e.x=x,e.y=y,e.nStems=s,e.haveWidth=f,e.width=d,e.open=h,r.U._drawCFF(B,e,a,o,n),x=e.x,y=e.y,s=e.nStems,f=e.haveWidth,d=e.width,h=e.open}}else if(b=="o30"||b=="o31"){var j=i.length,I=(Z=0,b=="o31");for(Z+=j-(E=-3&j);Z<E;)I?(C=y,_=(R=x+i.shift())+i.shift(),y=(m=C+i.shift())+i.shift(),E-Z==5?(x=_+i.shift(),Z++):x=_,I=!1):(R=x,C=y+i.shift(),_=R+i.shift(),m=C+i.shift(),x=_+i.shift(),E-Z==5?(y=m+i.shift(),Z++):y=m,I=!0),r.U.P.curveTo(n,R,C,_,m,x,y),Z+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,t),b;i.push(b)}}}e.x=x,e.y=y,e.nStems=s,e.haveWidth=f,e.width=d,e.open=h};var u=r,c={Typr:u};return l.Typr=u,l.default=c,Object.defineProperty(l,"__esModule",{value:!0}),l})({}).Typr}function Tn(){return(function(l){var r=Uint8Array,u=Uint16Array,c=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(b,E){for(var F=new u(31),X=0;X<31;++X)F[X]=E+=1<<b[X-1];var W=new c(F[30]);for(X=1;X<30;++X)for(var Z=F[X];Z<F[X+1];++Z)W[Z]=Z-F[X]<<5|X;return[F,W]},n=o(t,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var f=o(e,0)[0],d=new u(32768),h=0;h<32768;++h){var g=(43690&h)>>>1|(21845&h)<<1;g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4,d[h]=((65280&g)>>>8|(255&g)<<8)>>>1}var x=function(b,E,F){for(var X=b.length,W=0,Z=new u(E);W<X;++W)++Z[b[W]-1];var ae,G=new u(E);for(W=0;W<E;++W)G[W]=G[W-1]+Z[W-1]<<1;{ae=new u(1<<E);var P=15-E;for(W=0;W<X;++W)if(b[W])for(var v=W<<4|b[W],w=E-b[W],A=G[b[W]-1]++<<w,D=A|(1<<w)-1;A<=D;++A)ae[d[A]>>>P]=v}return ae},y=new r(288);for(h=0;h<144;++h)y[h]=8;for(h=144;h<256;++h)y[h]=9;for(h=256;h<280;++h)y[h]=7;for(h=280;h<288;++h)y[h]=8;var R=new r(32);for(h=0;h<32;++h)R[h]=5;var C=x(y,9),_=x(R,5),m=function(b){for(var E=b[0],F=1;F<b.length;++F)b[F]>E&&(E=b[F]);return E},S=function(b,E,F){var X=E/8|0;return(b[X]|b[X+1]<<8)>>(7&E)&F},M=function(b,E){var F=E/8|0;return(b[F]|b[F+1]<<8|b[F+2]<<16)>>(7&E)},U=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(b,E,F){var X=new Error(E||U[b]);if(X.code=b,Error.captureStackTrace&&Error.captureStackTrace(X,T),!F)throw X;return X},L=function(b,E,F){var X=b.length;if(!X||F&&!F.l&&X<5)return E||new r(0);var W=!E||F,Z=!F||F.i;F||(F={}),E||(E=new r(3*X));var ae,G=function(ce){var De=E.length;if(ce>De){var Ce=new r(Math.max(2*De,ce));Ce.set(E),E=Ce}},P=F.f||0,v=F.p||0,w=F.b||0,A=F.l,D=F.d,k=F.m,B=F.n,j=8*X;do{if(!A){F.f=P=S(b,v,1);var I=S(b,v+1,3);if(v+=3,!I){var Y=b[($=((ae=v)/8|0)+(7&ae&&1)+4)-4]|b[$-3]<<8,ee=$+Y;if(ee>X){Z&&T(0);break}W&&G(w+Y),E.set(b.subarray($,ee),w),F.b=w+=Y,F.p=v=8*ee;continue}if(I==1)A=C,D=_,k=9,B=5;else if(I==2){var H=S(b,v,31)+257,z=S(b,v+10,15)+4,me=H+S(b,v+5,31)+1;v+=14;for(var fe=new r(me),Q=new r(19),te=0;te<z;++te)Q[a[te]]=S(b,v+3*te,7);v+=3*z;var le=m(Q),V=(1<<le)-1,re=x(Q,le);for(te=0;te<me;){var $,O=re[S(b,v,V)];if(v+=15&O,($=O>>>4)<16)fe[te++]=$;else{var pe=0,q=0;for($==16?(q=3+S(b,v,3),v+=2,pe=fe[te-1]):$==17?(q=3+S(b,v,7),v+=3):$==18&&(q=11+S(b,v,127),v+=7);q--;)fe[te++]=pe}}var oe=fe.subarray(0,H),K=fe.subarray(H);k=m(oe),B=m(K),A=x(oe,k),D=x(K,B)}else T(1);if(v>j){Z&&T(0);break}}W&&G(w+131072);for(var _e=(1<<k)-1,ne=(1<<B)-1,ie=v;;ie=v){var ue=(pe=A[M(b,v)&_e])>>>4;if((v+=15&pe)>j){Z&&T(0);break}if(pe||T(2),ue<256)E[w++]=ue;else{if(ue==256){ie=v,A=null;break}var ve=ue-254;if(ue>264){var Ue=t[te=ue-257];ve=S(b,v,(1<<Ue)-1)+i[te],v+=Ue}var Fe=D[M(b,v)&ne],xe=Fe>>>4;if(Fe||T(3),v+=15&Fe,K=f[xe],xe>3&&(Ue=e[xe],K+=M(b,v)&(1<<Ue)-1,v+=Ue),v>j){Z&&T(0);break}W&&G(w+131072);for(var ye=w+ve;w<ye;w+=4)E[w]=E[w-K],E[w+1]=E[w+1-K],E[w+2]=E[w+2-K],E[w+3]=E[w+3-K];w=ye}}F.l=A,F.p=ie,F.b=w,A&&(P=1,F.m=k,F.d=D,F.n=B)}while(!P);return w==E.length?E:(function(ce,De,Ce){(Ce==null||Ce>ce.length)&&(Ce=ce.length);var Oe=new(ce instanceof u?u:ce instanceof c?c:r)(Ce-De);return Oe.set(ce.subarray(De,Ce)),Oe})(E,0,w)},N=new r(0),J=typeof TextDecoder<"u"&&new TextDecoder;try{J.decode(N,{stream:!0})}catch{}return l.convert_streams=function(b){var E=new DataView(b),F=0;function X(){var H=E.getUint16(F);return F+=2,H}function W(){var H=E.getUint32(F);return F+=4,H}function Z(H){Y.setUint16(ee,H),ee+=2}function ae(H){Y.setUint32(ee,H),ee+=4}for(var G={signature:W(),flavor:W(),length:W(),numTables:X(),reserved:X(),totalSfntSize:W(),majorVersion:X(),minorVersion:X(),metaOffset:W(),metaLength:W(),metaOrigLength:W(),privOffset:W(),privLength:W()},P=0;Math.pow(2,P)<=G.numTables;)P++;P--;for(var v=16*Math.pow(2,P),w=16*G.numTables-v,A=12,D=[],k=0;k<G.numTables;k++)D.push({tag:W(),offset:W(),compLength:W(),origLength:W(),origChecksum:W()}),A+=16;var B,j=new Uint8Array(12+16*D.length+D.reduce((function(H,z){return H+z.origLength+4}),0)),I=j.buffer,Y=new DataView(I),ee=0;return ae(G.flavor),Z(G.numTables),Z(v),Z(P),Z(w),D.forEach((function(H){ae(H.tag),ae(H.origChecksum),ae(A),ae(H.origLength),H.outOffset=A,(A+=H.origLength)%4!=0&&(A+=4-A%4)})),D.forEach((function(H){var z,me=b.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var fe=new Uint8Array(H.origLength);z=new Uint8Array(me,2),L(z,fe)}else fe=new Uint8Array(me);j.set(fe,H.outOffset);var Q=0;(A=H.outOffset+H.origLength)%4!=0&&(Q=4-A%4),j.set(new Uint8Array(Q).buffer,H.outOffset+H.origLength),B=A+Q})),I.slice(0,B)},Object.defineProperty(l,"__esModule",{value:!0}),l})({}).convert_streams}function An(l,r){const u={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,o=8,n=16,i=32;let s;function f(U){if(!s){const T={R:e,L:t,D:a,C:n,U:i,T:o};s=new Map;for(let L in c){let N=0;c[L].split(",").forEach(J=>{let[b,E]=J.split("+");b=parseInt(b,36),E=E?parseInt(E,36):0,s.set(N+=b,T[L]);for(let F=E;F--;)s.set(++N,T[L])})}}return s.get(U)||i}const d=1,h=2,g=3,x=4,y=[null,"isol","init","fina","medi"];function R(U){const T=new Uint8Array(U.length);let L=i,N=d,J=-1;for(let b=0;b<U.length;b++){const E=U.codePointAt(b);let F=f(E)|0,X=d;F&o||(L&(t|a|n)?F&(e|a|n)?(X=g,(N===d||N===g)&&T[J]++):F&(t|i)&&(N===h||N===x)&&T[J]--:L&(e|i)&&(N===h||N===x)&&T[J]--,N=T[b]=X,L=F,J=b,E>65535&&b++)}return T}function C(U,T){const L=[];for(let J=0;J<T.length;J++){const b=T.codePointAt(J);b>65535&&J++,L.push(l.U.codeToGlyph(U,b))}const N=U.GSUB;if(N){const{lookupList:J,featureList:b}=N;let E;const F=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,X=[];b.forEach(W=>{if(F.test(W.tag))for(let Z=0;Z<W.tab.length;Z++){if(X[W.tab[Z]])continue;X[W.tab[Z]]=!0;const ae=J[W.tab[Z]],G=/^(isol|init|fina|medi)$/.test(W.tag);G&&!E&&(E=R(T));for(let P=0;P<L.length;P++)(!E||!G||y[E[P]]===W.tag)&&l.U._applySubs(L,P,ae,J)}})}return L}function _(U,T){const L=new Int16Array(T.length*3);let N=0;for(;N<T.length;N++){const F=T[N];if(F===-1)continue;L[N*3+2]=U.hmtx.aWidth[F];const X=U.GPOS;if(X){const W=X.lookupList;for(let Z=0;Z<W.length;Z++){const ae=W[Z];for(let G=0;G<ae.tabs.length;G++){const P=ae.tabs[G];if(ae.ltype===1){if(l._lctf.coverageIndex(P.coverage,F)!==-1&&P.pos){E(P.pos,N);break}}else if(ae.ltype===2){let v=null,w=J();if(w!==-1){const A=l._lctf.coverageIndex(P.coverage,T[w]);if(A!==-1){if(P.fmt===1){const D=P.pairsets[A];for(let k=0;k<D.length;k++)D[k].gid2===F&&(v=D[k])}else if(P.fmt===2){const D=l.U._getGlyphClass(T[w],P.classDef1),k=l.U._getGlyphClass(F,P.classDef2);v=P.matrix[D][k]}if(v){v.val1&&E(v.val1,w),v.val2&&E(v.val2,N);break}}}}else if(ae.ltype===4){const v=l._lctf.coverageIndex(P.markCoverage,F);if(v!==-1){const w=J(b),A=w===-1?-1:l._lctf.coverageIndex(P.baseCoverage,T[w]);if(A!==-1){const D=P.markArray[v],k=P.baseArray[A][D.markClass];L[N*3]=k.x-D.x+L[w*3]-L[w*3+2],L[N*3+1]=k.y-D.y+L[w*3+1];break}}}else if(ae.ltype===6){const v=l._lctf.coverageIndex(P.mark1Coverage,F);if(v!==-1){const w=J();if(w!==-1){const A=T[w];if(m(U,A)===3){const D=l._lctf.coverageIndex(P.mark2Coverage,A);if(D!==-1){const k=P.mark1Array[v],B=P.mark2Array[D][k.markClass];L[N*3]=B.x-k.x+L[w*3]-L[w*3+2],L[N*3+1]=B.y-k.y+L[w*3+1];break}}}}}}}}else if(U.kern&&!U.cff){const W=J();if(W!==-1){const Z=U.kern.glyph1.indexOf(T[W]);if(Z!==-1){const ae=U.kern.rval[Z].glyph2.indexOf(F);ae!==-1&&(L[W*3+2]+=U.kern.rval[Z].vals[ae])}}}}return L;function J(F){for(let X=N-1;X>=0;X--)if(T[X]!==-1&&(!F||F(T[X])))return X;return-1}function b(F){return m(U,F)===1}function E(F,X){for(let W=0;W<3;W++)L[X*3+W]+=F[W]||0}}function m(U,T){const L=U.GDEF&&U.GDEF.glyphClassDef;return L?l.U._getGlyphClass(T,L):0}function S(...U){for(let T=0;T<U.length;T++)if(typeof U[T]=="number")return U[T]}function M(U){const T=Object.create(null),L=U["OS/2"],N=U.hhea,J=U.head.unitsPerEm,b=S(L&&L.sTypoAscender,N&&N.ascender,J),E={unitsPerEm:J,ascender:b,descender:S(L&&L.sTypoDescender,N&&N.descender,0),capHeight:S(L&&L.sCapHeight,b),xHeight:S(L&&L.sxHeight,b),lineGap:S(L&&L.sTypoLineGap,N&&N.lineGap),supportsCodePoint(F){return l.U.codeToGlyph(U,F)>0},forEachGlyph(F,X,W,Z){let ae=0;const G=1/E.unitsPerEm*X,P=C(U,F);let v=0;const w=_(U,P);return P.forEach((A,D)=>{if(A!==-1){let k=T[A];if(!k){const{cmds:B,crds:j}=l.U.glyphToPath(U,A);let I="",Y=0;for(let fe=0,Q=B.length;fe<Q;fe++){const te=u[B[fe]];I+=B[fe];for(let le=1;le<=te;le++)I+=(le>1?",":"")+j[Y++]}let ee,H,z,me;if(j.length){ee=H=1/0,z=me=-1/0;for(let fe=0,Q=j.length;fe<Q;fe+=2){let te=j[fe],le=j[fe+1];te<ee&&(ee=te),le<H&&(H=le),te>z&&(z=te),le>me&&(me=le)}}else ee=z=H=me=0;k=T[A]={index:A,advanceWidth:U.hmtx.aWidth[A],xMin:ee,yMin:H,xMax:z,yMax:me,path:I}}Z.call(null,k,ae+w[D*3]*G,w[D*3+1]*G,v),ae+=w[D*3+2]*G,W&&(ae+=W*X)}v+=F.codePointAt(v)>65535?2:1}),ae}};return E}return function(T){const L=new Uint8Array(T,0,4),N=l._bin.readASCII(L,0,4);if(N==="wOFF")T=r(T);else if(N==="wOF2")throw new Error("woff2 fonts not supported");return M(l.parse(T)[0])}}const Fn=ut({name:"Typr Font Parser",dependencies:[Cn,Tn,An],init(l,r,u){const c=l(),t=r();return u(c,t)}});function Dn(){return(function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(_){var m=_>>5;this.buckets.set(m,(this.buckets.get(m)||0)|1<<(31&_))},r.prototype.has=function(_){var m=this.buckets.get(_>>5);return m!==void 0&&(m&1<<(31&_))!=0},r.prototype.serialize=function(){var _=[];return this.buckets.forEach((function(m,S){_.push((+S).toString(36)+":"+m.toString(36))})),_.join(",")},r.prototype.deserialize=function(_){var m=this;this.buckets.clear(),_.split(",").forEach((function(S){var M=S.split(":");m.buckets.set(parseInt(M[0],36),parseInt(M[1],36))}))};var u=Math.pow(2,8),c=u-1,t=~c;function e(_){var m=(function(M){return M&t})(_).toString(16),S=(function(M){return(M&t)+u-1})(_).toString(16);return"codepoint-index/plane"+(_>>16)+"/"+m+"-"+S+".json"}function a(_,m){var S=_&c,M=m.codePointAt(S/6|0);return((M=(M||48)-48)&1<<S%6)!=0}function o(_,m){var S;(S=_,S.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(M){return M.split("-").map((function(U){return parseInt(U.trim(),16)}))}))).forEach((function(M){var U=M[0],T=M[1];T===void 0&&(T=U),m(U,T)}))}function n(_,m){o(_,(function(S,M){for(var U=S;U<=M;U++)m(U)}))}var i={},s={},f=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(_){var m=f.get(_);return m||(m=new r,n(_.ranges,(function(S){return m.add(S)})),f.set(_,m)),m}var g,x=new Map;function y(_,m,S){return _[m]?m:_[S]?S:(function(M){for(var U in M)return U})(_)}function R(_,m){var S=m;if(!_.includes(S)){S=1/0;for(var M=0;M<_.length;M++)Math.abs(_[M]-m)<Math.abs(S-m)&&(S=_[M])}return S}function C(_){return g||(g=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(m){g.add(m)}))),g.has(_)}return l.CodePointSet=r,l.clearCache=function(){i={},s={}},l.getFontsForString=function(_,m){m===void 0&&(m={});var S,M=m.lang;M===void 0&&(M=new RegExp("\\p{Script=Hangul}","u").test(S=_)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(S)?"ja":"en");var U=m.category;U===void 0&&(U="sans-serif");var T=m.style;T===void 0&&(T="normal");var L=m.weight;L===void 0&&(L=400);var N=(m.dataUrl||d).replace(/\/$/g,""),J=new Map,b=new Uint8Array(_.length),E={},F={},X=new Array(_.length),W=new Map,Z=!1;function ae(v){var w=x.get(v);return w||(w=fetch(N+"/"+v).then((function(A){if(!A.ok)throw new Error(A.statusText);return A.json().then((function(D){if(!Array.isArray(D)||D[0]!==1)throw new Error("Incorrect schema version; need 1, got "+D[0]);return D[1]}))})).catch((function(A){if(N!==d)return Z||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+N+'", trying default CDN. '+A.message),Z=!0),N=d,x.delete(v),ae(v);throw A})),x.set(v,w)),w}for(var G=function(v){var w=_.codePointAt(v),A=e(w);X[v]=A,i[A]||W.has(A)||W.set(A,ae(A).then((function(D){i[A]=D}))),w>65535&&(v++,P=v)},P=0;P<_.length;P++)G(P);return Promise.all(W.values()).then((function(){W.clear();for(var v=function(A){var D=_.codePointAt(A),k=null,B=i[X[A]],j=void 0;for(var I in B){var Y=F[I];if(Y===void 0&&(Y=F[I]=new RegExp(I).test(M||"en")),Y){for(var ee in j=I,B[I])if(a(D,B[I][ee])){k=ee;break}break}}if(!k){e:for(var H in B)if(H!==j){for(var z in B[H])if(a(D,B[H][z])){k=z;break e}}}k||(console.debug("No font coverage for U+"+D.toString(16)),k="latin"),X[A]=k,s[k]||W.has(k)||W.set(k,ae("font-meta/"+k+".json").then((function(me){s[k]=me}))),D>65535&&(A++,w=A)},w=0;w<_.length;w++)v(w);return Promise.all(W.values())})).then((function(){for(var v,w=null,A=0;A<_.length;A++){var D=_.codePointAt(A);if(w&&(C(D)||h(w).has(D)))b[A]=b[A-1];else{w=s[X[A]];var k=E[w.id];if(!k){var B=w.typeforms,j=y(B,U,"sans-serif"),I=y(B[j],T,"normal"),Y=R((v=B[j])===null||v===void 0?void 0:v[I],L);k=E[w.id]=N+"/font-files/"+w.id+"/"+j+"."+I+"."+Y+".woff"}var ee=J.get(k);ee==null&&(ee=J.size,J.set(k,ee)),b[A]=ee}D>65535&&(A++,b[A]=b[A-1])}return{fontUrls:Array.from(J.keys()),chars:b}}))},Object.defineProperty(l,"__esModule",{value:!0}),l})({})}function En(l,r){const u=Object.create(null),c=Object.create(null);function t(a,o){const n=i=>{console.error(`Failure loading font ${a}`,i)};try{const i=new XMLHttpRequest;i.open("get",a,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)n(new Error(i.statusText));else if(i.status>0)try{const s=l(i.response);s.src=a,o(s)}catch(s){n(s)}},i.onerror=n,i.send()}catch(i){n(i)}}function e(a,o){let n=u[a];n?o(n):c[a]?c[a].push(o):(c[a]=[o],t(a,i=>{i.src=a,u[a]=i,c[a].forEach(s=>s(i)),delete c[a]}))}return function(a,o,{lang:n,fonts:i=[],style:s="normal",weight:f="normal",unicodeFontsURL:d}={}){const h=new Uint8Array(a.length),g=[];a.length||C();const x=new Map,y=[];if(s!=="italic"&&(s="normal"),typeof f!="number"&&(f=f==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(m=>!m.lang||m.lang.test(n)).reverse(),i.length){let U=0;(function T(L=0){for(let N=L,J=a.length;N<J;N++){const b=a.codePointAt(N);if(U===1&&g[h[N-1]].supportsCodePoint(b)||N>0&&/\s/.test(a[N]))h[N]=h[N-1],U===2&&(y[y.length-1][1]=N);else for(let E=h[N],F=i.length;E<=F;E++)if(E===F){const X=U===2?y[y.length-1]:y[y.length]=[N,N];X[1]=N,U=2}else{h[N]=E;const{src:X,unicodeRange:W}=i[E];if(!W||_(b,W)){const Z=u[X];if(!Z){e(X,()=>{T(N)});return}if(Z.supportsCodePoint(b)){let ae=x.get(Z);typeof ae!="number"&&(ae=g.length,g.push(Z),x.set(Z,ae)),h[N]=ae,U=1;break}}}b>65535&&N+1<J&&(h[N+1]=h[N],N++,U===2&&(y[y.length-1][1]=N))}R()})()}else y.push([0,a.length-1]),R();function R(){if(y.length){const m=y.map(S=>a.substring(S[0],S[1]+1)).join(`
`);r.getFontsForString(m,{lang:n||void 0,style:s,weight:f,dataUrl:d}).then(({fontUrls:S,chars:M})=>{const U=g.length;let T=0;y.forEach(N=>{for(let J=0,b=N[1]-N[0];J<=b;J++)h[N[0]+J]=M[T++]+U;T++});let L=0;S.forEach((N,J)=>{e(N,b=>{g[J+U]=b,++L===S.length&&C()})})})}else C()}function C(){o({chars:h,fonts:g})}function _(m,S){for(let M=0;M<S.length;M++){const[U,T=U]=S[M];if(U<=m&&m<=T)return!0}return!1}}}const jn=ut({name:"FontResolver",dependencies:[En,Fn,Dn],init(l,r,u){return l(r,u())}});function Mn(l,r){const c=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:g,lang:x,fonts:y,style:R,weight:C,preResolvedFonts:_,unicodeFontsURL:m},S){const M=({chars:U,fonts:T})=>{let L,N;const J=[];for(let b=0;b<U.length;b++)U[b]!==N?(N=U[b],J.push(L={start:b,end:b,fontObj:T[U[b]]})):L.end=b;S(J)};_?M(_):l(g,M,{lang:x,fonts:y,style:R,weight:C,unicodeFontsURL:m})}function o({text:g="",font:x,lang:y,sdfGlyphSize:R=64,fontSize:C=400,fontWeight:_=1,fontStyle:m="normal",letterSpacing:S=0,lineHeight:M="normal",maxWidth:U=1/0,direction:T,textAlign:L="left",textIndent:N=0,whiteSpace:J="normal",overflowWrap:b="normal",anchorX:E=0,anchorY:F=0,metricsOnly:X=!1,unicodeFontsURL:W,preResolvedFonts:Z=null,includeCaretPositions:ae=!1,chunkedBoundsSize:G=8192,colorRanges:P=null},v){const w=f(),A={fontLoad:0,typesetting:0};g.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),g=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),C=+C,S=+S,U=+U,M=M||"normal",N=+N,a({text:g,lang:y,style:m,weight:_,fonts:typeof x=="string"?[{src:x}]:x,unicodeFontsURL:W,preResolvedFonts:Z},D=>{A.fontLoad=f()-w;const k=isFinite(U);let B=null,j=null,I=null,Y=null,ee=null,H=null,z=null,me=null,fe=0,Q=0,te=J!=="nowrap";const le=new Map,V=f();let re=N,$=0,O=new d;const pe=[O];D.forEach(ne=>{const{fontObj:ie}=ne,{ascender:ue,descender:ve,unitsPerEm:Ue,lineGap:Fe,capHeight:xe,xHeight:ye}=ie;let ce=le.get(ie);if(!ce){const de=C/Ue,Se=M==="normal"?(ue-ve+Fe)*de:M*C,Ke=(Se-(ue-ve)*de)/2,we=Math.min(Se,(ue-ve)*de),be=(ue+ve)/2*de+we/2;ce={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:de,unitsPerEm:Ue,ascender:ue*de,descender:ve*de,capHeight:xe*de,xHeight:ye*de,lineHeight:Se,baseline:-Ke-ue*de,caretTop:be,caretBottom:be-we},le.set(ie,ce)}const{fontSizeMult:De}=ce,Ce=g.slice(ne.start,ne.end+1);let Oe,ke;ie.forEachGlyph(Ce,C,S,(de,Se,Ke,we)=>{Se+=$,we+=ne.start,Oe=Se,ke=de;const be=g.charAt(we),Ee=de.advanceWidth*De,Te=O.count;let ge;if("isEmpty"in de||(de.isWhitespace=!!be&&new RegExp(t).test(be),de.canBreakAfter=!!be&&e.test(be),de.isEmpty=de.xMin===de.xMax||de.yMin===de.yMax||c.test(be)),!de.isWhitespace&&!de.isEmpty&&Q++,te&&k&&!de.isWhitespace&&Se+Ee+re>U&&Te){if(O.glyphAt(Te-1).glyphObj.canBreakAfter)ge=new d,re=-Se;else for(let Pe=Te;Pe--;)if(Pe===0&&b==="break-word"){ge=new d,re=-Se;break}else if(O.glyphAt(Pe).glyphObj.canBreakAfter){ge=O.splitAt(Pe+1);const Ne=ge.glyphAt(0).x;re-=Ne;for(let je=ge.count;je--;)ge.glyphAt(je).x-=Ne;break}ge&&(O.isSoftWrapped=!0,O=ge,pe.push(O),fe=U)}let Ae=O.glyphAt(O.count);Ae.glyphObj=de,Ae.x=Se+re,Ae.y=Ke,Ae.width=Ee,Ae.charIndex=we,Ae.fontData=ce,be===`
`&&(O=new d,pe.push(O),re=-(Se+Ee+S*C)+N)}),$=Oe+ke.advanceWidth*De+S*C});let q=0;pe.forEach(ne=>{let ie=!0;for(let ue=ne.count;ue--;){const ve=ne.glyphAt(ue);ie&&!ve.glyphObj.isWhitespace&&(ne.width=ve.x+ve.width,ne.width>fe&&(fe=ne.width),ie=!1);let{lineHeight:Ue,capHeight:Fe,xHeight:xe,baseline:ye}=ve.fontData;Ue>ne.lineHeight&&(ne.lineHeight=Ue);const ce=ye-ne.baseline;ce<0&&(ne.baseline+=ce,ne.cap+=ce,ne.ex+=ce),ne.cap=Math.max(ne.cap,ne.baseline+Fe),ne.ex=Math.max(ne.ex,ne.baseline+xe)}ne.baseline-=q,ne.cap-=q,ne.ex-=q,q+=ne.lineHeight});let oe=0,K=0;if(E&&(typeof E=="number"?oe=-E:typeof E=="string"&&(oe=-fe*(E==="left"?0:E==="center"?.5:E==="right"?1:i(E)))),F&&(typeof F=="number"?K=-F:typeof F=="string"&&(K=F==="top"?0:F==="top-baseline"?-pe[0].baseline:F==="top-cap"?-pe[0].cap:F==="top-ex"?-pe[0].ex:F==="middle"?q/2:F==="bottom"?q:F==="bottom-baseline"?-pe[pe.length-1].baseline:i(F)*q)),!X){const ne=r.getEmbeddingLevels(g,T);B=new Uint16Array(Q),j=new Uint8Array(Q),I=new Float32Array(Q*2),Y={},z=[1/0,1/0,-1/0,-1/0],me=[],ae&&(H=new Float32Array(g.length*4)),P&&(ee=new Uint8Array(Q*3));let ie=0,ue=-1,ve=-1,Ue,Fe;if(pe.forEach((xe,ye)=>{let{count:ce,width:De}=xe;if(ce>0){let Ce=0;for(let we=ce;we--&&xe.glyphAt(we).glyphObj.isWhitespace;)Ce++;let Oe=0,ke=0;if(L==="center")Oe=(fe-De)/2;else if(L==="right")Oe=fe-De;else if(L==="justify"&&xe.isSoftWrapped){let we=0;for(let be=ce-Ce;be--;)xe.glyphAt(be).glyphObj.isWhitespace&&we++;ke=(fe-De)/we}if(ke||Oe){let we=0;for(let be=0;be<ce;be++){let Ee=xe.glyphAt(be);const Te=Ee.glyphObj;Ee.x+=Oe+we,ke!==0&&Te.isWhitespace&&be<ce-Ce&&(we+=ke,Ee.width+=ke)}}const de=r.getReorderSegments(g,ne,xe.glyphAt(0).charIndex,xe.glyphAt(xe.count-1).charIndex);for(let we=0;we<de.length;we++){const[be,Ee]=de[we];let Te=1/0,ge=-1/0;for(let Ae=0;Ae<ce;Ae++)if(xe.glyphAt(Ae).charIndex>=be){let Pe=Ae,Ne=Ae;for(;Ne<ce;Ne++){let je=xe.glyphAt(Ne);if(je.charIndex>Ee)break;Ne<ce-Ce&&(Te=Math.min(Te,je.x),ge=Math.max(ge,je.x+je.width))}for(let je=Pe;je<Ne;je++){const ze=xe.glyphAt(je);ze.x=ge-(ze.x+ze.width-Te)}break}}let Se;const Ke=we=>Se=we;for(let we=0;we<ce;we++){const be=xe.glyphAt(we);Se=be.glyphObj;const Ee=Se.index,Te=ne.levels[be.charIndex]&1;if(Te){const ge=r.getMirroredCharacter(g[be.charIndex]);ge&&be.fontData.fontObj.forEachGlyph(ge,0,0,Ke)}if(ae){const{charIndex:ge,fontData:Ae}=be,Pe=be.x+oe,Ne=be.x+be.width+oe;H[ge*4]=Te?Ne:Pe,H[ge*4+1]=Te?Pe:Ne,H[ge*4+2]=xe.baseline+Ae.caretBottom+K,H[ge*4+3]=xe.baseline+Ae.caretTop+K;const je=ge-ue;je>1&&s(H,ue,je),ue=ge}if(P){const{charIndex:ge}=be;for(;ge>ve;)ve++,P.hasOwnProperty(ve)&&(Fe=P[ve])}if(!Se.isWhitespace&&!Se.isEmpty){const ge=ie++,{fontSizeMult:Ae,src:Pe,index:Ne}=be.fontData,je=Y[Pe]||(Y[Pe]={});je[Ee]||(je[Ee]={path:Se.path,pathBounds:[Se.xMin,Se.yMin,Se.xMax,Se.yMax]});const ze=be.x+oe,Je=be.y+xe.baseline+K;I[ge*2]=ze,I[ge*2+1]=Je;const Xe=ze+Se.xMin*Ae,qe=Je+Se.yMin*Ae,$e=ze+Se.xMax*Ae,Ye=Je+Se.yMax*Ae;Xe<z[0]&&(z[0]=Xe),qe<z[1]&&(z[1]=qe),$e>z[2]&&(z[2]=$e),Ye>z[3]&&(z[3]=Ye),ge%G===0&&(Ue={start:ge,end:ge,rect:[1/0,1/0,-1/0,-1/0]},me.push(Ue)),Ue.end++;const Re=Ue.rect;if(Xe<Re[0]&&(Re[0]=Xe),qe<Re[1]&&(Re[1]=qe),$e>Re[2]&&(Re[2]=$e),Ye>Re[3]&&(Re[3]=Ye),B[ge]=Ee,j[ge]=Ne,P){const et=ge*3;ee[et]=Fe>>16&255,ee[et+1]=Fe>>8&255,ee[et+2]=Fe&255}}}}}),H){const xe=g.length-ue;xe>1&&s(H,ue,xe)}}const _e=[];le.forEach(({index:ne,src:ie,unitsPerEm:ue,ascender:ve,descender:Ue,lineHeight:Fe,capHeight:xe,xHeight:ye})=>{_e[ne]={src:ie,unitsPerEm:ue,ascender:ve,descender:Ue,lineHeight:Fe,capHeight:xe,xHeight:ye}}),A.typesetting=f()-V,v({glyphIds:B,glyphFontIndices:j,glyphPositions:I,glyphData:Y,fontData:_e,caretPositions:H,glyphColors:ee,chunkedBounds:me,fontSize:C,topBaseline:K+pe[0].baseline,blockBounds:[oe,K-q,oe+fe,K],visibleBounds:z,timings:A})})}function n(g,x){o({...g,metricsOnly:!0},y=>{const[R,C,_,m]=y.blockBounds;x({width:_-R,height:m-C})})}function i(g){let x=g.match(/^([\d.]+)%$/),y=x?parseFloat(x[1]):NaN;return isNaN(y)?0:y/100}function s(g,x,y){const R=g[x*4],C=g[x*4+1],_=g[x*4+2],m=g[x*4+3],S=(C-R)/y;for(let M=0;M<y;M++){const U=(x+M)*4;g[U]=R+S*M,g[U+1]=R+S*(M+1),g[U+2]=_,g[U+3]=m}}function f(){return(self.performance||Date).now()}function d(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(g){let x=d.flyweight;return x.data=this.data,x.index=g,x},splitAt(g){let x=new d;return x.data=this.data.splice(g*h.length),x}},d.flyweight=h.reduce((g,x,y,R)=>(Object.defineProperty(g,x,{get(){return this.data[this.index*h.length+y]},set(C){this.data[this.index*h.length+y]=C}}),g),{data:null,index:0}),{typeset:o,measure:n}}const rt=()=>(self.performance||Date).now(),Jt=wa();let na;function Nn(l,r,u,c,t,e,a,o,n,i,s=!0){return s?Rn(l,r,u,c,t,e,a,o,n,i).then(null,f=>(na||(console.warn("WebGL SDF generation failed, falling back to JS",f),na=!0),ia(l,r,u,c,t,e,a,o,n,i))):ia(l,r,u,c,t,e,a,o,n,i)}const Yt=[],Pn=5;let wr=0;function ka(){const l=rt();for(;Yt.length&&rt()-l<Pn;)Yt.shift()();wr=Yt.length?setTimeout(ka,0):0}const Rn=(...l)=>new Promise((r,u)=>{Yt.push(()=>{const c=rt();try{Jt.webgl.generateIntoCanvas(...l),r({timing:rt()-c})}catch(t){u(t)}}),wr||(wr=setTimeout(ka,0))}),On=4,Ln=2e3,oa={};let Gn=0;function ia(l,r,u,c,t,e,a,o,n,i){const s="TroikaTextSDFGenerator_JS_"+Gn++%On;let f=oa[s];return f||(f=oa[s]={workerModule:ut({name:s,workerId:s,dependencies:[wa,rt],init(d,h){const g=d().javascript.generate;return function(...x){const y=h();return{textureData:g(...x),timing:h()-y}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(l,r,u,c,t,e).then(({textureData:d,timing:h})=>{const g=rt(),x=new Uint8Array(d.length*4);for(let y=0;y<d.length;y++)x[y*4+i]=d[y];return Jt.webglUtils.renderImageData(a,x,o,n,l,r,1<<3-i),h+=rt()-g,--f.requests===0&&(f.idleTimer=setTimeout(()=>{gn(s)},Ln)),{timing:h}})}function In(l){l._warm||(Jt.webgl.isSupported(l),l._warm=!0)}const Bn=Jt.webglUtils.resizeWebGLCanvasWithoutClearing,Ut={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},zn=new ct;function st(){return(self.performance||Date).now()}const sa=Object.create(null);function Ca(l,r){l=Hn({},l);const u=st(),c=[];if(l.font&&c.push({label:"user",src:Xn(l.font)}),l.font=c,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||Ut.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||Ut.unicodeFontsURL,l.colorRanges!=null){let d={};for(let h in l.colorRanges)if(l.colorRanges.hasOwnProperty(h)){let g=l.colorRanges[h];typeof g!="number"&&(g=zn.set(g).getHex()),d[h]=g}l.colorRanges=d}Object.freeze(l);const{textureWidth:t,sdfExponent:e}=Ut,{sdfGlyphSize:a}=l,o=t/a*4;let n=sa[a];if(!n){const d=document.createElement("canvas");d.width=t,d.height=a*256/o,n=sa[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new Qa(d,void 0,void 0,void 0,qr,qr),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,Wn(n)}const{sdfTexture:i,sdfCanvas:s}=n;Fa(l).then(d=>{const{glyphIds:h,glyphFontIndices:g,fontData:x,glyphPositions:y,fontSize:R,timings:C}=d,_=[],m=new Float32Array(h.length*4);let S=0,M=0;const U=st(),T=x.map(E=>{let F=n.glyphsByFont.get(E.src);return F||n.glyphsByFont.set(E.src,F=new Map),F});h.forEach((E,F)=>{const X=g[F],{src:W,unitsPerEm:Z}=x[X];let ae=T[X].get(E);if(!ae){const{path:A,pathBounds:D}=d.glyphData[W][E],k=Math.max(D[2]-D[0],D[3]-D[1])/a*(Ut.sdfMargin*a+.5),B=n.glyphCount++,j=[D[0]-k,D[1]-k,D[2]+k,D[3]+k];T[X].set(E,ae={path:A,atlasIndex:B,sdfViewBox:j}),_.push(ae)}const{sdfViewBox:G}=ae,P=y[M++],v=y[M++],w=R/Z;m[S++]=P+G[0]*w,m[S++]=v+G[1]*w,m[S++]=P+G[2]*w,m[S++]=v+G[3]*w,h[F]=ae.atlasIndex}),C.quads=(C.quads||0)+(st()-U);const L=st();C.sdf={};const N=s.height,J=Math.ceil(n.glyphCount/o),b=Math.pow(2,Math.ceil(Math.log2(J*a)));b>N&&(console.info(`Increasing SDF texture size ${N}->${b}`),Bn(s,t,b),i.dispose()),Promise.all(_.map(E=>Ta(E,n,l.gpuAccelerateSDF).then(({timing:F})=>{C.sdf[E.atlasIndex]=F}))).then(()=>{_.length&&!n.contextLost&&(Aa(n),i.needsUpdate=!0),C.sdfTotal=st()-L,C.total=st()-u,r(Object.freeze({parameters:l,sdfTexture:i,sdfGlyphSize:a,sdfExponent:e,glyphBounds:m,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{n.contextLost||In(s)})}function Ta({path:l,atlasIndex:r,sdfViewBox:u},{sdfGlyphSize:c,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:n}=Ut,i=Math.max(u[2]-u[0],u[3]-u[1]),s=Math.floor(r/4),f=s%(o/c)*c,d=Math.floor(s/(o/c))*c,h=r%4;return Nn(c,c,l,u,i,n,t,f,d,h,a)}function Wn(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",u=>{console.log("Context Lost",u),u.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",u=>{console.log("Context Restored",u),l.contextLost=!1;const c=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{c.push(Ta(e,l,!0))})}),Promise.all(c).then(()=>{Aa(l),l.sdfTexture.needsUpdate=!0})})}function Vn({font:l,characters:r,sdfGlyphSize:u},c){let t=Array.isArray(r)?r.join(`
`):""+r;Ca({font:l,sdfGlyphSize:u,text:t},c)}function Hn(l,r){for(let u in r)r.hasOwnProperty(u)&&(l[u]=r[u]);return l}let zt;function Xn(l){return zt||(zt=typeof document>"u"?{}:document.createElement("a")),zt.href=l,zt.href}function Aa(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:u}=l,{width:c,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=u.image.data;(!a||a.length!==c*t*4)&&(a=new Uint8Array(c*t*4),u.image={width:c,height:t,data:a},u.flipY=!1,u.isDataTexture=!0),e.readPixels(0,0,c,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const Yn=ut({name:"Typesetter",dependencies:[Mn,jn,xn],init(l,r,u){return l(r,u())}}),Fa=ut({name:"Typesetter",dependencies:[Yn],init(l){return function(r){return new Promise(u=>{l.typeset(r,u)})}},getTransferables(l){const r=[];for(let u in l)l[u]&&l[u].buffer&&r.push(l[u].buffer);return r}});Fa.onMainThread;const la={};function Kn(l){let r=la[l];return r||(r=la[l]=new Cr(1,1,l,l).translate(.5,.5,0)),r}const Jn="aTroikaGlyphBounds",ca="aTroikaGlyphIndex",qn="aTroikaGlyphColor";class Qn extends Ka{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ja,this.boundingBox=new xa}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let u=Kn(r);["position","normal","uv"].forEach(c=>{this.attributes[c]=u.attributes[c].clone()}),this.setIndex(u.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,u,c,t,e){this.updateAttributeData(Jn,r,4),this.updateAttributeData(ca,u,1),this.updateAttributeData(qn,e,3),this._blockBounds=c,this._chunkedBounds=t,this.instanceCount=u.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:u,boundingBox:c}=this;if(u){const{PI:t,floor:e,min:a,max:o,sin:n,cos:i}=Math,s=t/2,f=t*2,d=Math.abs(u),h=r[0]/d,g=r[2]/d,x=e((h+s)/f)!==e((g+s)/f)?-d:a(n(h)*d,n(g)*d),y=e((h-s)/f)!==e((g-s)/f)?d:o(n(h)*d,n(g)*d),R=e((h+t)/f)!==e((g+t)/f)?d*2:o(d-i(h)*d,d-i(g)*d);c.min.set(x,r[1],u<0?-R:0),c.max.set(y,r[3],u<0?0:R)}else c.min.set(r[0],r[1],0),c.max.set(r[2],r[3],0);c.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let u=this.getAttribute(ca).count,c=this._chunkedBounds;if(c)for(let t=c.length;t--;){u=c[t].end;let e=c[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=u}updateAttributeData(r,u,c){const t=this.getAttribute(r);u?t&&t.array.length===u.length?(t.array.set(u),t.needsUpdate=!0):(this.setAttribute(r,new qa(u,c)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const Zn=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,$n=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,eo=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,to=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function ro(l){const r=Sr(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Kt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Qr(0,0,0,0)},uTroikaClipRect:{value:new Qr(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Kt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new ct},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Za},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Zn,vertexTransform:$n,fragmentDefs:eo,fragmentColorTransform:to,customRewriter({vertexShader:u,fragmentShader:c}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(c)&&(c=c.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(u)||(u=u.replace(Ua,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:u,fragmentShader:c}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const Tr=new Xa({color:16777215,side:$a,transparent:!0}),ua=8421504,fa=new Ya,Wt=new kr,mr=new kr,_t=[],ao=new kr,xr="+x+y";function da(l){return Array.isArray(l)?l[0]:l}let Da=()=>{const l=new Ur(new Cr(1,1),Tr);return Da=()=>l,l},Ea=()=>{const l=new Ur(new Cr(1,1,32,1),Tr);return Ea=()=>l,l};const no={type:"syncstart"},oo={type:"synccomplete"},ja=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],io=ja.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Ma=class extends Ur{constructor(){const r=new Qn;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=ua,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=xr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(no),Ca({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},u=>{this._isSyncing=!1,this._textRenderInfo=u,this.geometry.updateGlyphs(u.glyphBounds,u.glyphAtlasIndices,u.blockBounds,u.chunkedBounds,u.glyphColors);const c=this._queuedSyncs;c&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{c.forEach(t=>t&&t())})),this.dispatchEvent(oo),r&&r()})))}onBeforeRender(r,u,c,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return ro(r)}get material(){let r=this._derivedMaterial;const u=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Tr.clone());if((!r||!r.isDerivedFrom(u))&&(r=this._derivedMaterial=this.createDerivedMaterial(u),u.addEventListener("dispose",function c(){u.removeEventListener("dispose",c),r.dispose()})),this.hasOutline()){let c=r._outlineMtl;return c||(c=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),c.dispose()})),[c,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return da(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return da(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const u=r.isTextOutlineMaterial,c=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:o,blockBounds:n}=t;c.uTroikaSDFTexture.value=o,c.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),c.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,c.uTroikaSDFExponent.value=t.sdfExponent,c.uTroikaTotalBounds.value.fromArray(n),c.uTroikaUseGlyphColors.value=!u&&!!t.glyphColors;let i=0,s=0,f=0,d,h,g,x=0,y=0;if(u){let{outlineWidth:C,outlineOffsetX:_,outlineOffsetY:m,outlineBlur:S,outlineOpacity:M}=this;i=this._parsePercent(C)||0,s=Math.max(0,this._parsePercent(S)||0),d=M,x=this._parsePercent(_)||0,y=this._parsePercent(m)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(g=this.strokeColor,c.uTroikaStrokeColor.value.set(g??ua),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;c.uTroikaEdgeOffset.value=i,c.uTroikaPositionOffset.value.set(x,y),c.uTroikaBlurRadius.value=s,c.uTroikaStrokeWidth.value=f,c.uTroikaStrokeOpacity.value=h,c.uTroikaFillOpacity.value=d??1,c.uTroikaCurveRadius.value=this.curveRadius||0;let R=this.clipRect;if(R&&Array.isArray(R)&&R.length===4)c.uTroikaClipRect.value.fromArray(R);else{const C=(this.fontSize||.1)*100;c.uTroikaClipRect.value.set(n[0]-C,n[1]-C,n[2]+C,n[3]+C)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=u?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const o=r.hasOwnProperty("color")?r.color:r.color=new ct;(e!==o._input||typeof e=="object")&&o.set(o._input=e)}let a=this.orientation||xr;if(a!==r._orientation){let o=c.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==xr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,f,d]=n;Wt.set(0,0,0)[s]=i==="-"?1:-1,mr.set(0,0,0)[d]=f==="-"?-1:1,fa.lookAt(ao,Wt.cross(mr),mr),o.setFromMatrix4(fa)}else o.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let u=r.match(/^(-?[\d.]+)%$/),c=u?parseFloat(u[1]):NaN;r=(isNaN(c)?0:c/100)*this.fontSize}return r}localPositionToTextCoords(r,u=new Kt){u.copy(r);const c=this.curveRadius;return c&&(u.x=Math.atan2(r.x,Math.abs(c)-Math.abs(r.z))*Math.abs(c)),u}worldPositionToTextCoords(r,u=new Kt){return Wt.copy(r),this.localPositionToTextCoords(this.worldToLocal(Wt),u)}raycast(r,u){const{textRenderInfo:c,curveRadius:t}=this;if(c){const e=c.blockBounds,a=t?Ea():Da(),o=a.geometry,{position:n,uv:i}=o.attributes;for(let s=0;s<i.count;s++){let f=e[0]+i.getX(s)*(e[2]-e[0]);const d=e[1]+i.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,d,h)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,_t.length=0,a.raycast(r,_t);for(let s=0;s<_t.length;s++)_t[s].object=this,u.push(_t[s])}}copy(r){const u=this.geometry;return super.copy(r),this.geometry=u,io.forEach(c=>{this[c]=r[c]}),this}clone(){return new this.constructor().copy(this)}};ja.forEach(l=>{const r="_private_"+l;Object.defineProperty(Ma.prototype,l,{get(){return this[r]},set(u){u!==this[r]&&(this[r]=u,this._needsSync=!0)}})});new xa;new ct;const so=he.forwardRef(({sdfGlyphSize:l=64,anchorX:r="center",anchorY:u="middle",font:c,fontSize:t=1,children:e,characters:a,onSync:o,...n},i)=>{const s=en(({invalidate:g})=>g),[f]=he.useState(()=>new Ma),[d,h]=he.useMemo(()=>{const g=[];let x="";return he.Children.forEach(e,y=>{typeof y=="string"||typeof y=="number"?x+=y:g.push(y)}),[g,x]},[e]);return fn(()=>new Promise(g=>Vn({font:c,characters:a},g)),["troika-text",c,a]),he.useLayoutEffect(()=>void f.sync(()=>{s(),o&&o(f)})),he.useEffect(()=>()=>f.dispose(),[f]),he.createElement("primitive",tn({object:f,ref:i,font:c,text:h,anchorX:r,anchorY:u,fontSize:t,sdfGlyphSize:l},n),d)}),lo={data:[],async loadDataset(){if(this.data.length>0)return this.data;try{const l=await fetch("/data/dataset_sample.json");if(!l.ok)throw new Error("Failed to load dataset");return this.data=await l.json(),console.log(`Loaded ${this.data.length} items from dataset`),this.data}catch(l){return console.error("Error loading dataset:",l),[]}},getData(){return this.data},getStats(){if(this.data.length===0)return null;const l={};let r=0;return this.data.forEach(u=>{l[u.category]=(l[u.category]||0)+1,r+=u.tokens}),{totalItems:this.data.length,avgTokens:Math.round(r/this.data.length),categories:l}}};function co({data:l,onHover:r}){const u=he.useRef(),c=he.useMemo(()=>{if(!l||l.length===0)return{pos:new Float32Array(0),col:new Float32Array(0)};const t=new Float32Array(l.length*3),e=new Float32Array(l.length*3),a={coding:"#00f3ff",creative:"#7000ff",analysis:"#00ff9d",chat:"#ff0055"};return l.forEach((o,n)=>{const[i,s,f]=o.embedding||[0,0,0];t[n*3]=i,t[n*3+1]=s,t[n*3+2]=f;const d=new ct(a[o.category]||"#ffffff");e[n*3]=d.r,e[n*3+1]=d.g,e[n*3+2]=d.b}),{pos:t,col:e}},[l]);return ya(()=>{u.current&&(u.current.rotation.y+=.002)}),p.jsxs("points",{ref:u,onPointerOver:t=>{t.stopPropagation();const e=t.index;e!==void 0&&l[e]&&r(l[e])},onPointerOut:()=>r(null),children:[p.jsxs("bufferGeometry",{children:[p.jsx("bufferAttribute",{attach:"attributes-position",count:c.pos.length/3,array:c.pos,itemSize:3}),p.jsx("bufferAttribute",{attach:"attributes-color",count:c.col.length/3,array:c.col,itemSize:3})]}),p.jsx("pointsMaterial",{size:.8,vertexColors:!0,transparent:!0,opacity:1,sizeAttenuation:!0,blending:ba,depthWrite:!1})]})}function uo({count:l=5e3}){const r=he.useRef(),u=he.useMemo(()=>{const t=[],e=[{color:"#00f3ff",x:12,y:4,z:2},{color:"#7000ff",x:-12,y:-4,z:6},{color:"#00ff9d",x:4,y:-12,z:-6},{color:"#ff0055",x:-6,y:12,z:1}];for(let a=0;a<l;a++){const o=e[Math.floor(Math.random()*e.length)],n=6,i=o.x+(Math.random()-.5)*n*2,s=o.y+(Math.random()-.5)*n*2,f=o.z+(Math.random()-.5)*n*2;t.push({x:i,y:s,z:f,color:o.color})}return t},[l]),c=he.useMemo(()=>{const t=new Float32Array(l*3),e=new Float32Array(l*3);return u.forEach((a,o)=>{t[o*3]=a.x,t[o*3+1]=a.y,t[o*3+2]=a.z;const n=new ct(a.color);e[o*3]=n.r*.4,e[o*3+1]=n.g*.4,e[o*3+2]=n.b*.4}),{pos:t,col:e}},[u,l]);return ya(()=>{r.current&&(r.current.rotation.y+=5e-4)}),p.jsxs("points",{ref:r,children:[p.jsxs("bufferGeometry",{children:[p.jsx("bufferAttribute",{attach:"attributes-position",count:c.pos.length/3,array:c.pos,itemSize:3}),p.jsx("bufferAttribute",{attach:"attributes-color",count:c.col.length/3,array:c.col,itemSize:3})]}),p.jsx("pointsMaterial",{size:.2,vertexColors:!0,transparent:!0,opacity:.4,sizeAttenuation:!0,blending:ba,depthWrite:!1})]})}function fo(){const l=[{position:[12,4,2],label:"Coding",color:"#00f3ff"},{position:[-12,-4,6],label:"Creative",color:"#7000ff"},{position:[4,-12,-6],label:"Analysis",color:"#00ff9d"},{position:[-6,12,1],label:"Chat",color:"#ff0055"}];return p.jsx("group",{children:l.map((r,u)=>p.jsx(so,{position:r.position,fontSize:1.2,color:r.color,anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000",children:r.label},u))})}function ho(){const[l,r]=he.useState([]),[u,c]=he.useState(null);return he.useEffect(()=>{lo.loadDataset().then(r);const t=new EventSource("/api/stream/semantic");return t.onmessage=e=>{try{const a=JSON.parse(e.data);console.log("[NeuralGalaxy] New live point:",a),r(o=>{const n=[...o,a];return n.length>2e3?n.slice(n.length-2e3):n})}catch(a){console.error("[NeuralGalaxy] Error parsing live event:",a)}},t.onerror=e=>{console.error("[NeuralGalaxy] SSE Error:",e),t.close()},()=>{t.close()}},[]),p.jsxs("div",{style:{width:"100%",height:"100%",background:"#030508"},children:[p.jsxs(rn,{camera:{position:[0,0,35],fov:60},children:[p.jsx("color",{attach:"background",args:["#030508"]}),p.jsx("fog",{attach:"fog",args:["#030508",20,80]}),p.jsx("ambientLight",{intensity:.5}),p.jsx("pointLight",{position:[10,10,10]}),p.jsx(an,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:1}),p.jsx(uo,{count:8e3}),l.length>0&&p.jsx(co,{data:l,onHover:c}),p.jsx(fo,{}),p.jsx(nn,{enablePan:!0,enableZoom:!0,enableRotate:!0,autoRotate:!0,autoRotateSpeed:.5})]}),p.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"20px",color:"rgba(0, 243, 255, 0.8)",fontFamily:"Rajdhani, sans-serif",pointerEvents:"none",zIndex:10},children:[p.jsx("h3",{style:{margin:0,fontSize:"1.2rem",textTransform:"uppercase"},children:"Semantic Space"}),p.jsxs("p",{style:{margin:0,fontSize:"0.8rem",opacity:.7},children:[l.length," Active Nodes â€¢ 8,000+ Historical Vectors"]})]}),u&&p.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",background:"rgba(6, 11, 20, 0.9)",border:`1px solid ${u.category==="coding"?"#00f3ff":"#ffffff"}`,padding:"15px",borderRadius:"8px",maxWidth:"300px",color:"#fff",fontFamily:"Rajdhani, sans-serif",zIndex:20,backdropFilter:"blur(10px)",boxShadow:"0 0 20px rgba(0,0,0,0.5)"},children:[p.jsxs("div",{style:{fontSize:"0.8rem",textTransform:"uppercase",color:"#888",marginBottom:"5px"},children:[u.category," â€¢ ",u.tokens," tokens"]}),p.jsxs("div",{style:{fontSize:"1rem"},children:['"',u.text,'"']})]})]})}function po(){return p.jsxs("div",{className:"h-full flex flex-col",children:[p.jsxs("div",{className:"absolute top-6 left-6 z-10 pointer-events-none",children:[p.jsx("h2",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:"Swarm Intelligence"}),p.jsx("p",{className:"text-slate-200 drop-shadow-md",children:"Live visualization of agent coordination and semantic memory"})]}),p.jsx("div",{className:"flex-1 bg-black relative",children:p.jsx(ho,{})})]})}function vo(){const[l,r]=he.useState(""),[u,c]=he.useState(null),[t,e]=he.useState(!1),a=async()=>{if(l.trim()){e(!0),c(null);try{const o=localStorage.getItem("ac_api_key"),i=await(await fetch("/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":o||""},body:JSON.stringify({text:l})})).json();c(i)}catch(o){console.error(o),c({error:o.message})}finally{e(!1)}}};return p.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[p.jsxs("header",{className:"mb-8",children:[p.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Data Explorer"}),p.jsx("p",{className:"text-slate-400",children:"Inspect L3 Cache and test Embeddings"})]}),p.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 mb-8",children:[p.jsx("h3",{className:"text-lg font-bold mb-4",children:"Embedding Generator"}),p.jsxs("div",{className:"flex gap-4 mb-4",children:[p.jsx("input",{type:"text",value:l,onChange:o=>r(o.target.value),placeholder:"Enter text to vectorize...",className:"flex-1 bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500",onKeyDown:o=>o.key==="Enter"&&a()}),p.jsx("button",{onClick:a,disabled:t,className:"px-6 py-2 bg-green-600 hover:bg-green-500 text-white font-semibold rounded-lg disabled:opacity-50",children:t?"Generating...":"Generate"})]}),u&&p.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 border border-slate-800 overflow-hidden",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${u.cached?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:u.cached?"CACHE HIT":"CACHE MISS"}),p.jsx("span",{className:"text-xs text-slate-500",children:u.model})]}),u.embedding?p.jsxs("div",{children:[p.jsx("div",{className:"text-xs text-slate-400 mb-2",children:"Vector (first 5 dims):"}),p.jsxs("code",{className:"text-cyan-400 text-sm",children:["[",u.embedding.slice(0,5).map(o=>o.toFixed(4)).join(", "),", ...]"]}),p.jsxs("div",{className:"text-xs text-slate-500 mt-2",children:["Total dimensions: ",u.embedding.length]})]}):p.jsx("div",{className:"text-red-400",children:u.error})]})]})]})}function go(){const[l,r]=he.useState(null),[u,c]=he.useState(!0);return he.useEffect(()=>{setTimeout(()=>{r({name:"Acme Corp",id:"org_123456789",plan:"Professional",role:"Owner",members:[{id:"u_1",name:"Alice Admin",email:"alice@acme.com",role:"owner"},{id:"u_2",name:"Bob Builder",email:"bob@acme.com",role:"member"},{id:"u_3",name:"Charlie Cache",email:"charlie@acme.com",role:"viewer"}],apiKeys:[{prefix:"ac_live_",created:"2025-11-01",scopes:["cache:read","cache:write"]},{prefix:"ac_test_",created:"2025-11-15",scopes:["cache:read"]}]}),c(!1)},800)},[]),u?p.jsx("div",{className:"p-8 text-slate-400",children:"Loading governance data..."}):p.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[p.jsxs("header",{className:"mb-8",children:[p.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Governance"}),p.jsx("p",{className:"text-slate-400",children:"Organization settings, access control, and security policies"})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[p.jsxs("div",{className:"lg:col-span-2 bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[p.jsxs("div",{className:"flex justify-between items-start mb-6",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-bold text-white",children:l.name}),p.jsxs("div",{className:"text-sm text-slate-500 font-mono mt-1",children:["ID: ",l.id]})]}),p.jsxs("span",{className:"px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-xs font-bold border border-purple-500/30",children:[l.plan.toUpperCase()," PLAN"]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[p.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Your Role"}),p.jsx("div",{className:"font-semibold text-green-400",children:l.role})]}),p.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[p.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Region"}),p.jsx("div",{className:"font-semibold text-white",children:"US-East (N. Virginia)"})]})]})]}),p.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[p.jsx("h3",{className:"text-lg font-bold mb-4",children:"Compliance"}),p.jsxs("div",{className:"space-y-3",children:[p.jsx(yr,{label:"SOC 2 Type II",status:"active"}),p.jsx(yr,{label:"GDPR",status:"active"}),p.jsx(yr,{label:"HIPAA",status:"pending"})]})]})]}),p.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 mb-8",children:[p.jsxs("div",{className:"flex justify-between items-center mb-6",children:[p.jsx("h3",{className:"text-lg font-bold",children:"Team Members"}),p.jsx("button",{className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Invite Member"})]}),p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"w-full text-left text-sm",children:[p.jsx("thead",{children:p.jsxs("tr",{className:"border-b border-slate-800 text-slate-400",children:[p.jsx("th",{className:"pb-3 pl-2",children:"User"}),p.jsx("th",{className:"pb-3",children:"Role"}),p.jsx("th",{className:"pb-3",children:"2FA"}),p.jsx("th",{className:"pb-3 text-right pr-2",children:"Actions"})]})}),p.jsx("tbody",{className:"divide-y divide-slate-800",children:l.members.map(t=>p.jsxs("tr",{className:"group hover:bg-slate-800/30 transition-colors",children:[p.jsxs("td",{className:"py-3 pl-2",children:[p.jsx("div",{className:"font-medium text-white",children:t.name}),p.jsx("div",{className:"text-slate-500",children:t.email})]}),p.jsx("td",{className:"py-3",children:p.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize
                      ${t.role==="owner"?"bg-purple-500/10 text-purple-400":t.role==="admin"?"bg-blue-500/10 text-blue-400":"bg-slate-700/50 text-slate-400"}`,children:t.role})}),p.jsx("td",{className:"py-3",children:p.jsx("span",{className:"text-green-400",children:"Enabled"})}),p.jsx("td",{className:"py-3 text-right pr-2",children:p.jsx("button",{className:"text-slate-500 hover:text-white",children:"â€¢â€¢â€¢"})})]},t.id))})]})})]}),p.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[p.jsx("h3",{className:"text-lg font-bold mb-4",children:"Active API Keys"}),p.jsx("div",{className:"space-y-3",children:l.apiKeys.map((t,e)=>p.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950 rounded-lg border border-slate-800",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-8 h-8 rounded bg-slate-900 flex items-center justify-center text-slate-400",children:"ðŸ”‘"}),p.jsxs("div",{children:[p.jsxs("div",{className:"font-mono text-sm text-white",children:[t.prefix,"****************"]}),p.jsxs("div",{className:"text-xs text-slate-500",children:["Created ",t.created]})]})]}),p.jsx("div",{className:"flex gap-2",children:t.scopes.map(a=>p.jsx("span",{className:"px-2 py-1 bg-slate-800 text-slate-300 text-xs rounded border border-slate-700",children:a},a))})]},e))})]})]})}function yr({label:l,status:r}){const u={active:"bg-green-500",pending:"bg-yellow-500",inactive:"bg-slate-500"};return p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-sm text-slate-300",children:l}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:`w-2 h-2 rounded-full ${u[r]}`}),p.jsx("span",{className:"text-xs text-slate-500 capitalize",children:r})]})]})}const ha={healthcare:[{id:"patient_records",title:"âš•ï¸ Patient Records",description:"Cache medical records with HIPAA compliance",prompt:"Cache patient medical records with HIPAA compliance and PHI detection",nodes:["input","phi_filter","cache_l1","cache_l2","hipaa_audit","openai","output"]},{id:"clinical_decision",title:"ðŸ”¬ Clinical Decision Support",description:"AI-powered diagnosis with audit trails",prompt:"Cache clinical decision support AI with full audit logging",nodes:["input","phi_filter","cache_l1","anthropic","hipaa_audit","output"]},{id:"ehr_integration",title:"ðŸ¥ EHR Integration",description:"Electronic health record system caching",prompt:"Cache EHR system queries with encryption and compliance",nodes:["input","cache_l1","cache_l2","phi_filter","hipaa_audit","output"]},{id:"custom",title:"âœï¸ Custom Healthcare",description:"Describe your own healthcare use case",prompt:"",nodes:[]}],finance:[{id:"risk_analysis",title:"ðŸ“Š Risk Analysis",description:"Fraud detection and risk scoring",prompt:"Cache risk analysis and fraud detection for financial transactions",nodes:["input","fraud_detector","cache_l1","cache_l2","openai","pci_audit","output"]},{id:"transaction_processing",title:"ðŸ’³ Transaction Processing",description:"High-speed payment validation",prompt:"Cache transaction validation with PCI-DSS compliance",nodes:["input","transaction_validator","cache_l1","pci_audit","output"]},{id:"kyc_compliance",title:"ðŸ” KYC Compliance",description:"Know Your Customer verification",prompt:"Cache KYC verification results with audit trail",nodes:["input","cache_l1","cache_l2","anthropic","pci_audit","output"]},{id:"custom",title:"âœï¸ Custom Finance",description:"Describe your own financial use case",prompt:"",nodes:[]}],legal:[{id:"document_analysis",title:"ðŸ“„ Document Analysis",description:"Legal document review and search",prompt:"Cache legal document analysis with retention policies",nodes:["input","cache_l1","cache_l2","anthropic","retention_policy","output"]},{id:"case_research",title:"âš–ï¸ Case Research",description:"Case law and precedent lookup",prompt:"Cache case law research with audit logging",nodes:["input","semantic_dedup","cache_l2","cache_l3","openai","audit_logger","output"]},{id:"custom",title:"âœï¸ Custom Legal",description:"Describe your own legal use case",prompt:"",nodes:[]}],ecommerce:[{id:"product_search",title:"ðŸ” Product Search",description:"Fast product catalog search",prompt:"Cache product search and recommendations",nodes:["input","cache_l1","semantic_dedup","openai","output"]},{id:"inventory_sync",title:"ðŸ“¦ Inventory Sync",description:"Real-time inventory availability",prompt:"Cache inventory status with short TTL for freshness",nodes:["input","cache_l1","output"]},{id:"personalization",title:"âœ¨ Personalization",description:"User recommendations and preferences",prompt:"Cache personalized recommendations per user",nodes:["input","cache_l1","cache_l2","gemini","output"]},{id:"custom",title:"âœï¸ Custom E-commerce",description:"Describe your own e-commerce use case",prompt:"",nodes:[]}],saas:[{id:"api_caching",title:"ðŸ”Œ API Caching",description:"Multi-tenant API response caching",prompt:"Cache API responses with tenant isolation",nodes:["input","cache_l1","cache_l2","output"]},{id:"ai_features",title:"ðŸ¤– AI Features",description:"AI-powered product features",prompt:"Cache AI completions for SaaS features",nodes:["input","semantic_dedup","cache_l1","cache_l2","openai","output"]},{id:"analytics",title:"ðŸ“Š Analytics",description:"Dashboard data aggregation",prompt:"Cache analytics queries and dashboard data",nodes:["input","cache_l2","cache_l3","output"]},{id:"custom",title:"âœï¸ Custom SaaS",description:"Describe your own SaaS use case",prompt:"",nodes:[]}],general:[{id:"api_basic",title:"ðŸ”Œ API Caching",description:"Basic API response caching",prompt:"Cache API responses to reduce latency",nodes:["input","cache_l1","cache_l2","output"]},{id:"llm_caching",title:"ðŸ¤– LLM Caching",description:"Cache AI model responses",prompt:"Cache LLM completions to save costs",nodes:["input","semantic_dedup","cache_l1","cache_l2","openai","output"]},{id:"database",title:"ðŸ—„ï¸ Database Query",description:"Cache expensive database queries",prompt:"Cache database query results",nodes:["input","cache_l1","cache_l2","cache_l3","output"]},{id:"custom",title:"âœï¸ Custom",description:"Describe your own use case",prompt:"",nodes:[]}]},pa={healthcare:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup","phi_filter"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["hipaa_audit","encrypted_cache"]},{category:"output",types:["output"]}],finance:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup","fraud_detector","transaction_validator"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["pci_audit","sox_logger"]},{category:"output",types:["output"]}],legal:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["retention_policy","audit_logger"]},{category:"output",types:["output"]}],ecommerce:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}],saas:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}],general:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}]},va={healthcare:{required:["hipaa","phi"],autoAddNodes:["phi_filter","hipaa_audit"],retention:"7 years",encryption:"required"},finance:{required:["pci_dss","sox"],autoAddNodes:["pci_audit"],retention:"7 years",encryption:"required"},legal:{required:["data_retention"],autoAddNodes:["retention_policy","audit_logger"],retention:"10 years",encryption:"recommended"},ecommerce:{required:["pci_dss","gdpr"],autoAddNodes:[],retention:"2 years",encryption:"recommended"},saas:{required:["soc2"],autoAddNodes:[],retention:"1 year",encryption:"recommended"},general:{required:[],autoAddNodes:[],retention:"30 days",encryption:"optional"}};function ga(l){return{templates:ha[l]||ha.general,nodes:pa[l]||pa.general,compliance:va[l]||va.general}}const Na=he.createContext();function mo({children:l}){const[r,u]=he.useState(null),[c,t]=he.useState(null),[e,a]=he.useState(!1);he.useEffect(()=>{const i=localStorage.getItem("agentcache_sector");i?(u(i),t(ga(i))):a(!0)},[]);const o=i=>{u(i),t(ga(i)),localStorage.setItem("agentcache_sector",i),a(!1)},n=()=>{a(!0)};return p.jsx(Na.Provider,{value:{sector:r,config:c,selectSector:o,changeSector:n,showSectorModal:e,setShowSectorModal:a},children:l})}function xo(){const l=he.useContext(Na);if(!l)throw new Error("useSector must be used within SectorProvider");return l}class Be extends Error{constructor(r,u=null){super(r),this.name="ValidationError",this.field=u}}function ma(l){if(!l||typeof l!="object")throw new Be("Pipeline must be an object");if(!l.name||typeof l.name!="string")throw new Be("Pipeline must have a valid name","name");if(l.name.length>255)throw new Be("Pipeline name must be less than 255 characters","name");if(!Array.isArray(l.nodes))throw new Be("Pipeline must have a nodes array","nodes");if(l.nodes.length===0)throw new Be("Pipeline must have at least one node","nodes");if(!Array.isArray(l.edges))throw new Be("Pipeline must have an edges array","edges");const r=new Set;for(const c of l.nodes){if(!c.id)throw new Be("All nodes must have an ID","nodes");if(r.has(c.id))throw new Be(`Duplicate node ID found: ${c.id}`,"nodes");r.add(c.id)}for(const c of l.edges){if(!c.source||!c.target)throw new Be("All edges must have source and target","edges");if(!r.has(c.source))throw new Be(`Edge references non-existent source node: ${c.source}`,"edges");if(!r.has(c.target))throw new Be(`Edge references non-existent target node: ${c.target}`,"edges")}if(yo(l.nodes,l.edges))throw new Be("Pipeline contains circular dependencies","edges");const u=["healthcare","finance","legal","ecommerce","saas","general"];if(l.sector&&!u.includes(l.sector))throw new Be(`Invalid sector: ${l.sector}`,"sector");return!0}function yo(l,r){const u={};l.forEach(a=>{u[a.id]=[]}),r.forEach(a=>{u[a.source].push(a.target)});const c=new Set,t=new Set;function e(a){c.add(a),t.add(a);for(const o of u[a]||[])if(c.has(o)){if(t.has(o))return!0}else if(e(o))return!0;return t.delete(a),!1}for(const a of Object.keys(u))if(!c.has(a)&&e(a))return!0;return!1}function bo(l){return typeof l!="string"?"":l.replace(/<[^>]*>/g,"").replace(/[\x00-\x1F\x7F]/g,"").slice(0,255).trim()}const Vt=2,St="agentcache_",lt=5*1024*1024;class Ht{static save(r,u){try{const c=St+r,t=JSON.stringify(u);return t.length>lt?{success:!1,error:"quota",message:"Data exceeds 5MB storage limit. Consider deleting old pipelines.",size:t.length}:(localStorage.setItem(c,t),{success:!0,size:t.length})}catch(c){return c.name==="QuotaExceededError"?{success:!1,error:"quota",message:"Storage quota exceeded. Clear old data to continue.",cause:c}:{success:!1,error:"storage",message:`Failed to save data: ${c.message}`,cause:c}}}static load(r,u=null){try{const c=St+r,t=localStorage.getItem(c);return t===null?u:JSON.parse(t)}catch(c){return console.error(`Failed to load ${r}:`,c),u}}static remove(r){try{const u=St+r;return localStorage.removeItem(u),!0}catch(u){return console.error(`Failed to remove ${r}:`,u),!1}}static getStorageStats(){try{let r=0,u=0;for(let c=0;c<localStorage.length;c++){const t=localStorage.key(c);if(t.startsWith(St)){const e=localStorage.getItem(t);r+=e?e.length:0,u++}}return{totalSize:r,itemCount:u,percentUsed:r/lt*100,maxSize:lt,available:lt-r}}catch(r){return console.error("Failed to get storage stats:",r),{totalSize:0,itemCount:0,percentUsed:0,maxSize:lt,available:lt}}}static clearAll(){try{const r=[];for(let u=0;u<localStorage.length;u++){const c=localStorage.key(u);c.startsWith(St)&&r.push(c)}return r.forEach(u=>localStorage.removeItem(u)),!0}catch(r){return console.error("Failed to clear storage:",r),!1}}}class wt{static savePipeline(r){try{r.name=bo(r.name),ma(r);const u={...r,_v:Vt,savedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},c=this.loadAllPipelines(),t=c.findIndex(a=>a.name===r.name);t!==-1?c[t]={...u,savedAt:c[t].savedAt}:c.push(u);const e=Ht.save("pipelines",c);return e.success?{success:!0,pipeline:u,isNew:t===-1}:e}catch(u){return{success:!1,error:"validation",message:u.message,field:u.field||null}}}static loadAllPipelines(){return Ht.load("pipelines",[]).map(u=>this.migratePipeline(u))}static loadPipeline(r){return this.loadAllPipelines().find(c=>c.name===r)||null}static deletePipeline(r){try{const u=this.loadAllPipelines(),c=u.filter(e=>e.name!==r);return c.length===u.length?{success:!1,error:"not_found",message:`Pipeline "${r}" not found`}:Ht.save("pipelines",c)}catch(u){return{success:!1,error:"storage",message:u.message}}}static migratePipeline(r){return r._v?(r._v===Vt,r):{...r,_v:Vt,updatedAt:r.savedAt||new Date().toISOString()}}static getPipelineStats(){const r=this.loadAllPipelines(),u={total:r.length,active:r.filter(c=>c.isActive).length,inactive:r.filter(c=>!c.isActive).length,bySector:{}};return r.forEach(c=>{const t=c.sector||"general";u.bySector[t]=(u.bySector[t]||0)+1}),u}static exportPipelines(r=null){const u=this.loadAllPipelines(),c=r?u.filter(t=>r.includes(t.name)):u;return JSON.stringify({version:Vt,exportedAt:new Date().toISOString(),pipelines:c},null,2)}static importPipelines(r){try{const u=JSON.parse(r);if(!u.pipelines||!Array.isArray(u.pipelines))return{success:!1,error:"invalid_format",message:"Invalid import format"};const c=this.loadAllPipelines();let t=0,e=0;for(const o of u.pipelines)try{ma(o),c.find(n=>n.name===o.name)?e++:(c.push(this.migratePipeline(o)),t++)}catch(n){console.warn(`Skipping invalid pipeline: ${n.message}`),e++}const a=Ht.save("pipelines",c);return a.success?{success:!0,imported:t,skipped:e}:a}catch(u){return{success:!1,error:"parse_error",message:`Failed to parse JSON: ${u.message}`}}}}const _o=_a.memo(({pipeline:l,formatDate:r,onLoad:u,onToggleStatus:c,onDuplicate:t,onDelete:e})=>p.jsxs("div",{className:"pipeline-card",children:[p.jsxs("div",{className:`status-indicator ${l.isActive?"active":"inactive"}`,children:[p.jsx("div",{className:"status-dot"}),l.isActive?"Active":"Inactive"]}),p.jsxs("div",{className:"card-content",onClick:()=>u(l),children:[p.jsx("h3",{className:"pipeline-name",children:l.name}),p.jsxs("div",{className:"pipeline-stats",children:[p.jsxs("div",{className:"stat",children:[p.jsx("span",{className:"stat-label",children:"Nodes"}),p.jsx("span",{className:"stat-value",children:l.nodes?.length||0})]}),p.jsxs("div",{className:"stat",children:[p.jsx("span",{className:"stat-label",children:"Est. Savings"}),p.jsx("span",{className:"stat-value savings",children:l.estimatedSavings})]}),p.jsxs("div",{className:"stat",children:[p.jsx("span",{className:"stat-label",children:"Modified"}),p.jsx("span",{className:"stat-value",children:r(l.lastModified)})]})]}),p.jsxs("div",{className:"node-preview",children:[l.nodes?.slice(0,5).map((a,o)=>p.jsx("div",{className:`node-thumb ${a.type||"default"}`,children:a.type?.replace(/_/g," ").substring(0,3).toUpperCase()},o)),l.nodes?.length>5&&p.jsxs("div",{className:"node-thumb more",children:["+",l.nodes.length-5]})]})]}),p.jsxs("div",{className:"card-actions",children:[p.jsx("button",{className:`btn-toggle ${l.isActive?"active":""}`,onClick:a=>{a.stopPropagation(),c(l.name)},title:l.isActive?"Deactivate":"Activate",children:l.isActive?"â¸":"â–¶"}),p.jsx("button",{className:"btn-action",onClick:a=>{a.stopPropagation(),u(l)},title:"Edit",children:"âœï¸"}),p.jsx("button",{className:"btn-action",onClick:a=>{a.stopPropagation(),t(l)},title:"Duplicate",children:"ðŸ“‹"}),p.jsx("button",{className:"btn-action danger",onClick:a=>{a.stopPropagation(),e(l.name)},title:"Delete",children:"ðŸ—‘ï¸"})]})]}));function So({onLoadPipeline:l,onNewPipeline:r}){const{sector:u}=xo(),[c,t]=he.useState([]),[e,a]=he.useState("all"),[o,n]=he.useState("recent"),[i,s]=he.useState("grid");he.useEffect(()=>{f()},[u]);const f=he.useCallback(()=>{try{const m=wt.loadAllPipelines().filter(S=>S.sector===u).map(S=>({...S,isActive:S.isActive!==void 0?S.isActive:!1,lastModified:S.updatedAt||S.savedAt||new Date().toISOString()}));t(m)}catch(_){console.error("Failed to load pipelines:",_),alert("Error loading pipelines. Please refresh the page.")}},[u]);he.useMemo(()=>_=>`$${((_.nodes?.filter(S=>S.type?.includes("cache")||S.id?.includes("cache")).length||0)*800+400).toLocaleString()}/mo`,[]);const d=he.useCallback(_=>{try{const m=wt.loadPipeline(_);if(!m){alert("Pipeline not found");return}m.isActive=!m.isActive;const S=wt.savePipeline(m);if(!S.success){alert(`Failed to update pipeline: ${S.message}`);return}f()}catch(m){console.error("Failed to toggle pipeline status:",m),alert("Error updating pipeline status")}},[u,f]),h=he.useCallback(_=>{if(confirm(`Delete pipeline "${_}"? This cannot be undone.`))try{const m=wt.deletePipeline(_);if(!m.success){alert(`Failed to delete pipeline: ${m.message}`);return}f()}catch(m){console.error("Failed to delete pipeline:",m),alert("Error deleting pipeline")}},[f]),g=he.useCallback(_=>{try{const m={..._,name:`${_.name} (Copy)`,isActive:!1},S=wt.savePipeline(m);if(!S.success){S.error==="quota"?alert(`Storage quota exceeded: ${S.message}`):S.error==="validation"?alert(`Validation error: ${S.message}`):alert(`Failed to duplicate pipeline: ${S.message}`);return}f()}catch(m){console.error("Failed to duplicate pipeline:",m),alert("Error duplicating pipeline")}},[f]),x=he.useMemo(()=>{let _=[...c];return e==="active"?_=_.filter(m=>m.isActive):e==="inactive"&&(_=_.filter(m=>!m.isActive)),o==="name"?_.sort((m,S)=>m.name.localeCompare(S.name)):o==="savings"?_.sort((m,S)=>{const M=parseInt((m.estimatedSavings||"0").replace(/[^0-9]/g,""));return parseInt((S.estimatedSavings||"0").replace(/[^0-9]/g,""))-M}):_.sort((m,S)=>new Date(S.lastModified)-new Date(m.lastModified)),_},[c,e,o]),y=he.useCallback(_=>{const m=new Date(_),M=new Date-m,U=Math.floor(M/6e4),T=Math.floor(M/36e5),L=Math.floor(M/864e5);return U<1?"Just now":U<60?`${U}m ago`:T<24?`${T}h ago`:L<7?`${L}d ago`:m.toLocaleDateString()},[]),R=he.useMemo(()=>c.filter(_=>_.isActive).length,[c]),C=he.useMemo(()=>c.filter(_=>!_.isActive).length,[c]);return p.jsxs("div",{className:"workspace-dashboard",children:[p.jsxs("div",{className:"dashboard-header",children:[p.jsxs("div",{className:"dashboard-title-section",children:[p.jsx("h1",{children:"ðŸ—‚ï¸ My Workspaces"}),p.jsxs("p",{className:"dashboard-subtitle",children:[c.length," pipeline",c.length!==1?"s":""," in ",u," â€¢ ",R," active"]})]}),p.jsx("button",{className:"btn-new-pipeline",onClick:r,children:"âž• New Pipeline"})]}),p.jsxs("div",{className:"dashboard-controls",children:[p.jsxs("div",{className:"control-group",children:[p.jsx("label",{children:"Filter:"}),p.jsxs("div",{className:"button-group",children:[p.jsxs("button",{className:e==="all"?"active":"",onClick:()=>a("all"),children:["All (",c.length,")"]}),p.jsxs("button",{className:e==="active"?"active":"",onClick:()=>a("active"),children:["Active (",R,")"]}),p.jsxs("button",{className:e==="inactive"?"active":"",onClick:()=>a("inactive"),children:["Inactive (",C,")"]})]})]}),p.jsxs("div",{className:"control-group",children:[p.jsx("label",{children:"Sort by:"}),p.jsxs("div",{className:"button-group",children:[p.jsx("button",{className:o==="recent"?"active":"",onClick:()=>n("recent"),children:"ðŸ“… Recent"}),p.jsx("button",{className:o==="name"?"active":"",onClick:()=>n("name"),children:"ðŸ”¤ Name"}),p.jsx("button",{className:o==="savings"?"active":"",onClick:()=>n("savings"),children:"ðŸ’° Savings"})]})]}),p.jsxs("div",{className:"control-group",children:[p.jsx("label",{children:"View:"}),p.jsxs("div",{className:"button-group",children:[p.jsx("button",{className:i==="grid"?"active":"",onClick:()=>s("grid"),children:"âŠž Grid"}),p.jsx("button",{className:i==="list"?"active":"",onClick:()=>s("list"),children:"â˜° List"})]})]})]}),p.jsx("div",{className:`pipeline-container ${i}`,children:x.length===0?p.jsxs("div",{className:"empty-state",children:[p.jsx("div",{className:"empty-icon",children:"ðŸ“¦"}),p.jsx("h3",{children:"No pipelines found"}),p.jsx("p",{children:e!=="all"?`No ${e} pipelines. Try changing the filter.`:"Get started by creating a new pipeline or loading a preset."}),p.jsx("button",{className:"btn-primary",onClick:r,children:"âž• Create Your First Pipeline"})]}):x.map(_=>p.jsx(_o,{pipeline:_,formatDate:y,onLoad:l,onToggleStatus:d,onDuplicate:g,onDelete:h},_.name))})]})}function wo(){const[l,r]=he.useState("swarm"),u=()=>{switch(l){case"overview":return p.jsx(Zr,{});case"pipelines":return p.jsx(mo,{children:p.jsx(So,{onLoadPipeline:c=>console.log("Load",c),onNewPipeline:()=>console.log("New")})});case"swarm":return p.jsx(po,{});case"data":return p.jsx(vo,{});case"governance":return p.jsx(go,{});default:return p.jsx(Zr,{})}};return p.jsxs("div",{className:"flex h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[p.jsx(sn,{activeView:l,onViewChange:r}),p.jsx("main",{className:"flex-1 overflow-auto relative",children:u()})]})}on.createRoot(document.getElementById("root")).render(p.jsx(_a.StrictMode,{children:p.jsx(wo,{})}));
