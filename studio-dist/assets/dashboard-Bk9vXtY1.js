import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{r as E,j as b,R as K,a as SC,g as E_,b as NC}from"./client-DwJ0wxic.js";import{u as AC,C as Eu,R as C_,M as Ct,T as Sr,V as we,P as Cu,a as le,b as On,G as R_,c as kn,S as Zp,d as vn,e as M_,B as nc,f as pl,L as EC,g as P_,h as D_,i as CC,Q as RC,j as B_,k as MC,l as PC,w as se,H as $t,m as Jp,N as Oi,n as DC,o as Ru,p as ft,q as ie,r as pt,s as bo,t as Ln,v as Dn,x as et,F as BC,y as FC,z as Qt,A as ga,D as zi,W as Il,E as Xn,I as kC,J as F_,K as LC,O as em,U as k_,X as IC,Y as OC,Z as UC,_ as VC,$ as GC,a0 as $C,a1 as jC,a2 as zC,a3 as tm,a4 as L_,a5 as Zn,a6 as nm,a7 as u0,a8 as Ba,a9 as HC,aa as WC,ab as sn,ac as Zr,ad as mt,ae as Jr,af as ei,ag as Hr,ah as xa,ai as vr,aj as jr,ak as Zs,al as qC,am as rm,an as im,ao as tf,ap as sm,aq as om,ar as Ms,as as be,at as XC,au as rc,av as Mu,aw as Pu,ax as KC,ay as Ut,az as Du,aA as Fa,aB as Bu,aC as Hi,aD as nf,aE as ka,aF as I_,aG as Rn,aH as O_,aI as U_,aJ as V_,aK as G_,aL as $_,aM as am,aN as j_,aO as z_,aP as d0,aQ as Js,aR as dn,aS as YC,aT as H_,aU as W_,aV as q_,aW as X_,aX as K_,aY as Y_,aZ as Q_,a_ as Z_,a$ as J_,b0 as eT,b1 as tT,b2 as nT,b3 as QC,b4 as ZC,b5 as JC,b6 as eo,b7 as Ol,b8 as Ul,b9 as Vl,ba as Wi,bb as rT,bc as iT,bd as sT,be as oT,bf as aT,bg as cT,bh as lT,bi as uT,bj as e2,bk as t2,bl as dT,bm as hT,bn as ya,bo as ba,bp as Ps,bq as n2,br as cm,bs as lm,bt as um,bu as Kr,bv as dm,bw as hm,bx as ml,by as gl,bz as xl,bA as yl,bB as h0,bC as f0,bD as p0,bE as m0,bF as rf,bG as sf,bH as of,bI as af,bJ as cf,bK as lf,bL as uf,bM as df,bN as hf,bO as ff,bP as pf,bQ as mf,bR as gf,bS as xf,bT as yf,bU as bf,bV as vf,bW as _f,bX as Tf,bY as wf,bZ as Sf,b_ as Nf,b$ as fT,c0 as r2,c1 as i2,c2 as s2,c3 as o2,c4 as a2,c5 as c2,c6 as l2,c7 as u2,c8 as d2,c9 as h2,ca as Gl,cb as f2,cc as p2,cd as m2,ce as g2,cf as pT,cg as x2,ch as y2,ci as b2,cj as v2,ck as _2,cl as T2,cm as w2,cn as S2,co as N2,cp as A2,cq as E2,cr as C2,cs as R2,ct as M2,cu as P2,cv as D2,cw as B2,cx as F2,cy as mT,cz as k2,cA as L2,cB as I2,cC as O2,cD as $l,cE as U2,cF as gT,cG as V2,cH as xT,cI as G2,cJ as $2,cK as j2,cL as bl,cM as jl,cN as zl,cO as g0,cP as z2,cQ as H2,cR as W2,cS as q2,cT as X2,cU as K2,cV as Y2,cW as Q2,cX as Z2,cY as x0,cZ as J2,c_ as y0,c$ as eR,d0 as tR,d1 as yT,d2 as yn,d3 as nR,d4 as rR}from"./extends-EVGp5csO.js";const iR=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),sR=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),b0=n=>{const e=sR(n);return e.charAt(0).toUpperCase()+e.slice(1)},bT=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),oR=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var aR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const cR=E.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:o,...a},c)=>E.createElement("svg",{ref:c,...aR,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:bT("lucide",i),...!s&&!oR(a)&&{"aria-hidden":"true"},...a},[...o.map(([l,u])=>E.createElement(l,u)),...Array.isArray(s)?s:[s]]));const Ve=(n,e)=>{const t=E.forwardRef(({className:r,...i},s)=>E.createElement(cR,{ref:s,iconNode:e,className:bT(`lucide-${iR(b0(n))}`,`lucide-${n}`,r),...i}));return t.displayName=b0(n),t};const lR=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],si=Ve("activity",lR);const uR=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],vT=Ve("arrow-right",uR);const dR=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],hR=Ve("bell",dR);const fR=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],pR=Ve("box",fR);const mR=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],gR=Ve("clock",mR);const xR=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],yR=Ve("cpu",xR);const bR=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Hl=Ve("database",bR);const vR=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],_T=Ve("dollar-sign",vR);const _R=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],TT=Ve("flask-conical",_R);const TR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],v0=Ve("globe",TR);const wR=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],_0=Ve("layers",wR);const SR=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],NR=Ve("layout-grid",SR);const AR=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ER=Ve("lock",AR);const CR=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],RR=Ve("log-out",CR);const MR=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],PR=Ve("play",MR);const DR=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],BR=Ve("plus",DR);const FR=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],wT=Ve("radio",FR);const kR=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],LR=Ve("save",kR);const IR=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Af=Ve("search",IR);const OR=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],UR=Ve("server",OR);const VR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],GR=Ve("shield-alert",VR);const $R=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],fm=Ve("shield",$R);const jR=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],zR=Ve("timer",jR);const HR=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],WR=Ve("trophy",HR);const qR=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],XR=Ve("wand-sparkles",qR);const KR=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],YR=Ve("workflow",KR);const QR=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ZR=Ve("x",QR);const JR=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],pm=Ve("zap",JR),eM=({activeView:n,setActiveView:e,user:t})=>{const[r,i]=E.useState(!1),s=[{id:"swarm",label:"Neural Ops Center",icon:si},{id:"overview",label:"System Overview",icon:NR},{id:"pipeline",label:"Pipeline Studio",icon:YR},{id:"observability",label:"Observability",icon:Hl},{id:"lab",label:"Research Lab",icon:TT},{id:"data",label:"Data Explorer",icon:Hl},{id:"governance",label:"Governance",icon:fm}];return b.jsxs("div",{className:`fixed left-0 top-16 bottom-0 z-40 flex flex-col bg-[rgba(6,11,20,0.95)] border-r border-[rgba(0,243,255,0.2)] backdrop-blur-xl transition-all duration-300 ${r?"w-64":"w-16"}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[b.jsx("div",{className:"flex-1 py-6 flex flex-col gap-2",children:s.map(o=>{const a=o.icon,c=n===o.id;return b.jsxs("button",{onClick:()=>e(o.id),className:`relative flex items-center h-12 px-4 mx-2 rounded-lg transition-all duration-200 group ${c?"bg-[rgba(0,243,255,0.1)] text-[var(--hud-accent)] shadow-[0_0_15px_rgba(0,243,255,0.2)]":"text-[var(--hud-text-dim)] hover:bg-[rgba(255,255,255,0.05)] hover:text-white"}`,children:[b.jsx(a,{size:20,className:`min-w-[20px] transition-transform duration-300 ${c?"scale-110":"group-hover:scale-110"}`}),b.jsx("span",{className:`ml-4 font-['Rajdhani'] font-semibold tracking-wide whitespace-nowrap overflow-hidden transition-all duration-300 ${r?"opacity-100 w-auto":"opacity-0 w-0"}`,children:o.label}),c&&b.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-[var(--hud-accent)] rounded-r-full shadow-[0_0_10px_var(--hud-accent)]"})]},o.id)})}),b.jsxs("div",{className:"p-2 border-t border-[rgba(0,243,255,0.1)]",children:[b.jsxs("div",{className:`flex items-center p-2 rounded-lg bg-[rgba(0,0,0,0.3)] border border-[rgba(255,255,255,0.05)] ${r?"justify-start":"justify-center"}`,children:[b.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-[var(--hud-accent)] to-[var(--hud-accent-secondary)] flex items-center justify-center text-black font-bold text-xs shadow-[0_0_10px_rgba(0,243,255,0.3)]",children:t?.name?.charAt(0)||"G"}),b.jsxs("div",{className:`ml-3 overflow-hidden transition-all duration-300 ${r?"w-auto opacity-100":"w-0 opacity-0"}`,children:[b.jsx("div",{className:"text-sm font-bold text-white truncate",children:t?.name||"Guest"}),b.jsx("div",{className:"text-xs text-[var(--hud-accent)] font-mono",children:t?.role||"Viewer"})]})]}),b.jsxs("button",{onClick:()=>{localStorage.removeItem("agentcache_token"),localStorage.removeItem("agentcache_user"),window.location.href="/login.html"},className:`mt-2 w-full flex items-center justify-center h-10 rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors ${!r&&"hidden"}`,children:[b.jsx(RR,{size:16,className:"mr-2"}),b.jsx("span",{className:"font-['Rajdhani'] font-semibold",children:"LOGOUT"})]})]})]})},tM=()=>{const[n,e]=E.useState(new Date),[t,r]=E.useState(!1);return E.useEffect(()=>{const i=setInterval(()=>e(new Date),1e3),s=()=>r(window.scrollY>20);return window.addEventListener("scroll",s),()=>{clearInterval(i),window.removeEventListener("scroll",s)}},[]),b.jsx("header",{className:`fixed top-0 left-0 right-0 h-16 z-50 transition-all duration-300 ${t?"bg-[rgba(3,5,8,0.9)] backdrop-blur-md border-b border-[rgba(0,243,255,0.2)]":"bg-transparent border-b border-transparent"}`,children:b.jsxs("div",{className:"h-full px-6 flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsxs("div",{className:"relative group cursor-pointer",children:[b.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-[var(--hud-accent)] to-[var(--hud-accent-secondary)] rounded-lg blur opacity-40 group-hover:opacity-75 transition duration-500"}),b.jsx("div",{className:"relative w-10 h-10 bg-black border border-[var(--hud-accent)] rounded-lg flex items-center justify-center",children:b.jsx("div",{className:"w-4 h-4 bg-[var(--hud-accent)] rotate-45 group-hover:rotate-90 transition-transform duration-500"})})]}),b.jsxs("div",{children:[b.jsxs("h1",{className:"text-xl font-['Rajdhani'] font-bold tracking-widest text-white",children:["AGENT",b.jsx("span",{className:"text-[var(--hud-accent)]",children:"CACHE"})]}),b.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-mono text-[var(--hud-text-dim)]",children:[b.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),"SYSTEM ONLINE"]})]})]}),b.jsxs("div",{className:"hidden md:flex items-center gap-8 px-8 py-2 bg-[rgba(255,255,255,0.03)] rounded-full border border-[rgba(255,255,255,0.05)]",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Grid Status"}),b.jsx("span",{className:"text-xs font-mono text-[var(--hud-success)]",children:"OPTIMAL"})]}),b.jsx("div",{className:"w-px h-4 bg-[rgba(255,255,255,0.1)]"}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Latency"}),b.jsx("span",{className:"text-xs font-mono text-[var(--hud-accent)]",children:"42ms"})]}),b.jsx("div",{className:"w-px h-4 bg-[rgba(255,255,255,0.1)]"}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Active Agents"}),b.jsx("span",{className:"text-xs font-mono text-white",children:"8,492"})]})]}),b.jsxs("div",{className:"flex items-center gap-6",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("button",{className:"text-[var(--hud-text-dim)] hover:text-white transition-colors",children:b.jsx(Af,{size:20})}),b.jsxs("button",{className:"relative text-[var(--hud-text-dim)] hover:text-white transition-colors",children:[b.jsx(hR,{size:20}),b.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-[var(--hud-accent)] rounded-full animate-pulse"})]})]}),b.jsxs("div",{className:"text-right hidden sm:block",children:[b.jsx("div",{className:"text-sm font-mono font-bold text-white",children:n.toLocaleTimeString([],{hour12:!1})}),b.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:"UTC"})]})]})]})})},He=({title:n,children:e,className:t="",icon:r,action:i})=>b.jsxs("div",{className:`relative group bg-[var(--hud-panel-bg)] border border-[var(--hud-border)] rounded-lg overflow-hidden transition-all duration-300 hover:shadow-[0_0_20px_rgba(0,243,255,0.1)] hover:border-[var(--hud-accent)] ${t}`,children:[b.jsx("div",{className:"absolute top-0 left-0 w-2 h-2 border-t-2 border-l-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),b.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),b.jsx("div",{className:"absolute bottom-0 left-0 w-2 h-2 border-b-2 border-l-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),b.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 border-b-2 border-r-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),(n||r)&&b.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[var(--hud-border)] bg-[rgba(0,0,0,0.2)]",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[r&&b.jsx(r,{size:18,className:"text-[var(--hud-accent)]"}),b.jsxs("h3",{className:"font-['Rajdhani'] font-bold text-lg tracking-wider text-white uppercase",children:[b.jsx("span",{className:"text-[var(--hud-accent)] mr-2",children:"::"}),n]})]}),i&&b.jsx("div",{className:"text-sm",children:i})]}),b.jsx("div",{className:"p-6",children:e})]}),yc=({value:n,max:e=100,label:t,sublabel:r,color:i="var(--hud-accent)"})=>{const s=Math.min(100,Math.max(0,n/e*100)),o=36,a=2*Math.PI*o,c=a-s/100*a;return b.jsxs("div",{className:"flex flex-col items-center justify-center",children:[b.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[b.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[b.jsx("circle",{cx:"64",cy:"64",r:o,stroke:"rgba(255,255,255,0.1)",strokeWidth:"8",fill:"transparent"}),b.jsx("circle",{cx:"64",cy:"64",r:o,stroke:i,strokeWidth:"8",fill:"transparent",strokeDasharray:a,strokeDashoffset:c,strokeLinecap:"round",className:"transition-all duration-1000 ease-out",style:{filter:`drop-shadow(0 0 4px ${i})`}})]}),b.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:b.jsxs("span",{className:"text-2xl font-['Rajdhani'] font-bold text-white",children:[n,"%"]})})]}),b.jsxs("div",{className:"text-center mt-2",children:[b.jsx("div",{className:"text-sm font-bold text-white tracking-wide",children:t}),r&&b.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:r})]})]})},Wl=({columns:n,data:e,onRowClick:t})=>b.jsx("div",{className:"w-full overflow-x-auto",children:b.jsxs("table",{className:"w-full text-left border-collapse",children:[b.jsx("thead",{children:b.jsx("tr",{className:"border-b border-[var(--hud-border)]",children:n.map((r,i)=>b.jsx("th",{className:"py-3 px-4 text-xs font-['Rajdhani'] font-bold text-[var(--hud-text-dim)] uppercase tracking-wider whitespace-nowrap bg-[rgba(0,0,0,0.2)]",children:r.header},i))})}),b.jsx("tbody",{className:"font-mono text-sm",children:e.map((r,i)=>b.jsx("tr",{onClick:()=>t&&t(r),className:`
                border-b border-[rgba(255,255,255,0.05)] transition-colors duration-200
                ${t?"cursor-pointer hover:bg-[rgba(0,243,255,0.05)]":""}
                group
              `,children:n.map((s,o)=>b.jsx("td",{className:"py-3 px-4 text-white group-hover:text-[var(--hud-accent)] transition-colors",children:s.render?s.render(r):r[s.accessor]},o))},r.id||i))})]})}),T0=()=>{const[n,e]=E.useState({requests:0,bandwidth:0,latency:0,savings:0,hitRate:0,uptime:100}),[t,r]=E.useState([]),[i,s]=E.useState(!0);return E.useEffect(()=>{const o=async()=>{try{const u=await(await fetch("/api/admin-stats",{headers:{Authorization:`Bearer ${localStorage.getItem("agentcache_token")}`}})).json();u&&!u.error&&e({requests:u.total_requests_today||0,bandwidth:Math.round((u.tokens_saved_today||0)/1e3),latency:42,savings:u.cost_saved_today?parseFloat(u.cost_saved_today.replace("$","")):0,hitRate:u.hit_rate||0,uptime:99.9})}catch(l){console.error("Failed to fetch admin stats:",l)}finally{s(!1)}};o();const a=setInterval(o,3e4),c=new EventSource("/api/events/stream");return c.onmessage=l=>{const u=JSON.parse(l.data);if(u.type==="sys:connected")return;const d={id:Date.now(),type:u.type.toUpperCase(),source:u.agentId||"System",hash:u.hash?`${u.hash.substring(0,8)}...`:"-",time:new Date().toLocaleTimeString()};r(h=>[d,...h].slice(0,10))},()=>{clearInterval(a),c.close()}},[]),b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[b.jsx(He,{title:"Global Grid Status",icon:v0,className:"lg:col-span-2 min-h-[300px]",children:b.jsxs("div",{className:"w-full h-full flex items-center justify-center bg-[rgba(0,0,0,0.3)] rounded border border-[rgba(255,255,255,0.05)] relative overflow-hidden",children:[b.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--hud-accent)_0%,_transparent_70%)] opacity-10 animate-pulse"}),b.jsxs("div",{className:"text-center",children:[b.jsx(v0,{size:64,className:"mx-auto text-[var(--hud-accent)] opacity-50 mb-4"}),b.jsxs("p",{className:"text-[var(--hud-text-dim)] font-mono text-sm",children:["GRID VISUALIZATION ONLINE",b.jsx("br",{}),b.jsx("span",{className:"text-[var(--hud-success)]",children:"3 REGIONS ACTIVE"})]})]})]})}),b.jsx(He,{title:"System Health",icon:si,className:"flex flex-col justify-center",children:b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsx(yc,{value:n.uptime,label:"Uptime",sublabel:"30 Days",color:"var(--hud-success)"}),b.jsx(yc,{value:n.hitRate,label:"Cache Hit",sublabel:"Global",color:"var(--hud-accent)"}),b.jsx(yc,{value:42,max:100,label:"CPU Load",sublabel:"Cluster",color:"var(--hud-warning)"}),b.jsx(yc,{value:12,max:100,label:"Memory",sublabel:"Usage",color:"var(--hud-accent-secondary)"})]})})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[b.jsxs(He,{className:"p-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Total Requests"}),b.jsx("h3",{className:"text-2xl font-mono font-bold text-white",children:n.requests.toLocaleString()})]}),b.jsx(pm,{className:"text-[var(--hud-accent)] opacity-50",size:24})]}),b.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:b.jsx("span",{children:"Today"})})]}),b.jsxs(He,{className:"p-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Tokens Saved"}),b.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:[n.bandwidth.toLocaleString()," k"]})]}),b.jsx(UR,{className:"text-[var(--hud-accent-secondary)] opacity-50",size:24})]}),b.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:b.jsx("span",{children:"Est. Bandwidth"})})]}),b.jsxs(He,{className:"p-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Avg Latency"}),b.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:[n.latency,"ms"]})]}),b.jsx(si,{className:"text-[var(--hud-warning)] opacity-50",size:24})]}),b.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:b.jsx("span",{children:"Global Avg"})})]}),b.jsxs(He,{className:"p-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Cost Savings"}),b.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:["$",n.savings.toFixed(2)]})]}),b.jsx(fm,{className:"text-[var(--hud-success)] opacity-50",size:24})]}),b.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:b.jsx("span",{children:"Today"})})]})]}),b.jsxs(He,{title:"Live Event Stream",icon:gR,action:b.jsx("button",{className:"text-xs text-[var(--hud-accent)] hover:underline",children:"View All"}),children:[b.jsx(Wl,{columns:[{header:"Time",accessor:"time"},{header:"Type",accessor:"type",render:o=>b.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${o.type.includes("HIT")?"bg-green-500/10 text-green-400":o.type.includes("MISS")?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400"}`,children:o.type})},{header:"Source",accessor:"source"},{header:"Hash / ID",accessor:"hash",render:o=>b.jsx("span",{className:"font-mono text-[var(--hud-text-dim)]",children:o.hash})}],data:t}),t.length===0&&b.jsx("div",{className:"p-4 text-center text-[var(--hud-text-dim)] italic",children:"Waiting for events..."})]})]})};function Ht(n){if(typeof n=="string"||typeof n=="number")return""+n;let e="";if(Array.isArray(n))for(let t=0,r;t<n.length;t++)(r=Ht(n[t]))!==""&&(e+=(e&&" ")+r);else for(let t in n)n[t]&&(e+=(e&&" ")+t);return e}const nM={},w0=n=>{let e;const t=new Set,r=(u,d)=>{const h=typeof u=="function"?u(e):u;if(!Object.is(h,e)){const f=e;e=d??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(p=>p(e,f))}},i=()=>e,c={setState:r,getState:i,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(nM?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},l=e=n(r,i,c);return c},rM=n=>n?w0(n):w0,{useDebugValue:iM}=K,{useSyncExternalStoreWithSelector:sM}=AC,oM=n=>n;function ST(n,e=oM,t){const r=sM(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return iM(r),r}const S0=(n,e)=>{const t=rM(n),r=(i,s=e)=>ST(t,i,s);return Object.assign(r,t),r},aM=(n,e)=>n?S0(n,e):S0;function It(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(const[r,i]of n)if(!Object.is(i,e.get(r)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(const r of n)if(!e.has(r))return!1;return!0}const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(const r of t)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(n[r],e[r]))return!1;return!0}var cM={value:()=>{}};function ic(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new vl(t)}function vl(n){this._=n}function lM(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}vl.prototype=ic.prototype={constructor:vl,on:function(n,e){var t=this._,r=lM(n+"",t),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(n=r[s]).type)&&(i=uM(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(n=r[s]).type)t[i]=N0(t[i],n.name,e);else if(e==null)for(i in t)t[i]=N0(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new vl(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,s;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)}};function uM(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function N0(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=cM,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var Ef="http://www.w3.org/1999/xhtml";const A0={svg:"http://www.w3.org/2000/svg",xhtml:Ef,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Fu(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),A0.hasOwnProperty(e)?{space:A0[e],local:n}:n}function dM(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Ef&&e.documentElement.namespaceURI===Ef?e.createElement(n):e.createElementNS(t,n)}}function hM(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function NT(n){var e=Fu(n);return(e.local?hM:dM)(e)}function fM(){}function mm(n){return n==null?fM:function(){return this.querySelector(n)}}function pM(n){typeof n!="function"&&(n=mm(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),c,l,u=0;u<o;++u)(c=s[u])&&(l=n.call(c,c.__data__,u,s))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new on(r,this._parents)}function mM(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function gM(){return[]}function AT(n){return n==null?gM:function(){return this.querySelectorAll(n)}}function xM(n){return function(){return mM(n.apply(this,arguments))}}function yM(n){typeof n=="function"?n=xM(n):n=AT(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,c,l=0;l<a;++l)(c=o[l])&&(r.push(n.call(c,c.__data__,l,o)),i.push(c));return new on(r,i)}function ET(n){return function(){return this.matches(n)}}function CT(n){return function(e){return e.matches(n)}}var bM=Array.prototype.find;function vM(n){return function(){return bM.call(this.children,n)}}function _M(){return this.firstElementChild}function TM(n){return this.select(n==null?_M:vM(typeof n=="function"?n:CT(n)))}var wM=Array.prototype.filter;function SM(){return Array.from(this.children)}function NM(n){return function(){return wM.call(this.children,n)}}function AM(n){return this.selectAll(n==null?SM:NM(typeof n=="function"?n:CT(n)))}function EM(n){typeof n!="function"&&(n=ET(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,l=0;l<o;++l)(c=s[l])&&n.call(c,c.__data__,l,s)&&a.push(c);return new on(r,this._parents)}function RT(n){return new Array(n.length)}function CM(){return new on(this._enter||this._groups.map(RT),this._parents)}function ql(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}ql.prototype={constructor:ql,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function RM(n){return function(){return n}}function MM(n,e,t,r,i,s){for(var o=0,a,c=e.length,l=s.length;o<l;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new ql(n,s[o]);for(;o<c;++o)(a=e[o])&&(i[o]=a)}function PM(n,e,t,r,i,s,o){var a,c,l=new Map,u=e.length,d=s.length,h=new Array(u),f;for(a=0;a<u;++a)(c=e[a])&&(h[a]=f=o.call(c,c.__data__,a,e)+"",l.has(f)?i[a]=c:l.set(f,c));for(a=0;a<d;++a)f=o.call(n,s[a],a,s)+"",(c=l.get(f))?(r[a]=c,c.__data__=s[a],l.delete(f)):t[a]=new ql(n,s[a]);for(a=0;a<u;++a)(c=e[a])&&l.get(h[a])===c&&(i[a]=c)}function DM(n){return n.__data__}function BM(n,e){if(!arguments.length)return Array.from(this,DM);var t=e?PM:MM,r=this._parents,i=this._groups;typeof n!="function"&&(n=RM(n));for(var s=i.length,o=new Array(s),a=new Array(s),c=new Array(s),l=0;l<s;++l){var u=r[l],d=i[l],h=d.length,f=FM(n.call(u,u&&u.__data__,l,r)),p=f.length,m=a[l]=new Array(p),x=o[l]=new Array(p),g=c[l]=new Array(h);t(u,d,m,x,g,f,e);for(var y=0,v=0,_,T;y<p;++y)if(_=m[y]){for(y>=v&&(v=y+1);!(T=x[v])&&++v<p;);_._next=T||null}}return o=new on(o,r),o._enter=a,o._exit=c,o}function FM(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function kM(){return new on(this._exit||this._groups.map(RT),this._parents)}function LM(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function IM(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),a=new Array(i),c=0;c<o;++c)for(var l=t[c],u=r[c],d=l.length,h=a[c]=new Array(d),f,p=0;p<d;++p)(f=l[p]||u[p])&&(h[p]=f);for(;c<i;++c)a[c]=t[c];return new on(a,this._parents)}function OM(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function UM(n){n||(n=VM);function e(d,h){return d&&h?n(d.__data__,h.__data__):!d-!h}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,c=i[s]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(c[u]=l);c.sort(e)}return new on(i,this._parents).order()}function VM(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function GM(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function $M(){return Array.from(this)}function jM(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function zM(){let n=0;for(const e of this)++n;return n}function HM(){return!this.node()}function WM(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function qM(n){return function(){this.removeAttribute(n)}}function XM(n){return function(){this.removeAttributeNS(n.space,n.local)}}function KM(n,e){return function(){this.setAttribute(n,e)}}function YM(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function QM(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function ZM(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function JM(n,e){var t=Fu(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?XM:qM:typeof e=="function"?t.local?ZM:QM:t.local?YM:KM)(t,e))}function MT(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function e3(n){return function(){this.style.removeProperty(n)}}function t3(n,e,t){return function(){this.style.setProperty(n,e,t)}}function n3(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function r3(n,e,t){return arguments.length>1?this.each((e==null?e3:typeof e=="function"?n3:t3)(n,e,t??"")):to(this.node(),n)}function to(n,e){return n.style.getPropertyValue(e)||MT(n).getComputedStyle(n,null).getPropertyValue(e)}function i3(n){return function(){delete this[n]}}function s3(n,e){return function(){this[n]=e}}function o3(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function a3(n,e){return arguments.length>1?this.each((e==null?i3:typeof e=="function"?o3:s3)(n,e)):this.node()[n]}function PT(n){return n.trim().split(/^|\s+/)}function gm(n){return n.classList||new DT(n)}function DT(n){this._node=n,this._names=PT(n.getAttribute("class")||"")}DT.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function BT(n,e){for(var t=gm(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function FT(n,e){for(var t=gm(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function c3(n){return function(){BT(this,n)}}function l3(n){return function(){FT(this,n)}}function u3(n,e){return function(){(e.apply(this,arguments)?BT:FT)(this,n)}}function d3(n,e){var t=PT(n+"");if(arguments.length<2){for(var r=gm(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?u3:e?c3:l3)(t,e))}function h3(){this.textContent=""}function f3(n){return function(){this.textContent=n}}function p3(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function m3(n){return arguments.length?this.each(n==null?h3:(typeof n=="function"?p3:f3)(n)):this.node().textContent}function g3(){this.innerHTML=""}function x3(n){return function(){this.innerHTML=n}}function y3(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function b3(n){return arguments.length?this.each(n==null?g3:(typeof n=="function"?y3:x3)(n)):this.node().innerHTML}function v3(){this.nextSibling&&this.parentNode.appendChild(this)}function _3(){return this.each(v3)}function T3(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function w3(){return this.each(T3)}function S3(n){var e=typeof n=="function"?n:NT(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function N3(){return null}function A3(n,e){var t=typeof n=="function"?n:NT(n),r=e==null?N3:typeof e=="function"?e:mm(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function E3(){var n=this.parentNode;n&&n.removeChild(this)}function C3(){return this.each(E3)}function R3(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function M3(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function P3(n){return this.select(n?M3:R3)}function D3(n){return arguments.length?this.property("__data__",n):this.node().__data__}function B3(n){return function(e){n.call(this,e,this.__data__)}}function F3(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function k3(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function L3(n,e,t){return function(){var r=this.__on,i,s=B3(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function I3(n,e,t){var r=F3(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(i=0,u=a[c];i<s;++i)if((o=r[i]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?L3:k3,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function kT(n,e,t){var r=MT(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function O3(n,e){return function(){return kT(this,n,e)}}function U3(n,e){return function(){return kT(this,n,e.apply(this,arguments))}}function V3(n,e){return this.each((typeof e=="function"?U3:O3)(n,e))}function*G3(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var LT=[null];function on(n,e){this._groups=n,this._parents=e}function sc(){return new on([[document.documentElement]],LT)}function $3(){return this}on.prototype=sc.prototype={constructor:on,select:pM,selectAll:yM,selectChild:TM,selectChildren:AM,filter:EM,data:BM,enter:CM,exit:kM,join:LM,merge:IM,selection:$3,order:OM,sort:UM,call:GM,nodes:$M,node:jM,size:zM,empty:HM,each:WM,attr:JM,style:r3,property:a3,classed:d3,text:m3,html:b3,raise:_3,lower:w3,append:S3,insert:A3,remove:C3,clone:P3,datum:D3,on:I3,dispatch:V3,[Symbol.iterator]:G3};function gt(n){return typeof n=="string"?new on([[document.querySelector(n)]],[document.documentElement]):new on([[n]],LT)}function j3(n){let e;for(;e=n.sourceEvent;)n=e;return n}function Nn(n,e){if(n=j3(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}const z3={passive:!1},La={capture:!0,passive:!1};function Td(n){n.stopImmediatePropagation()}function Gs(n){n.preventDefault(),n.stopImmediatePropagation()}function IT(n){var e=n.document.documentElement,t=gt(n).on("dragstart.drag",Gs,La);"onselectstart"in e?t.on("selectstart.drag",Gs,La):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function OT(n,e){var t=n.document.documentElement,r=gt(n).on("dragstart.drag",null);e&&(r.on("click.drag",Gs,La),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const bc=n=>()=>n;function Cf(n,{sourceEvent:e,subject:t,target:r,identifier:i,active:s,x:o,y:a,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}Cf.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function H3(n){return!n.ctrlKey&&!n.button}function W3(){return this.parentNode}function q3(n,e){return e??{x:n.x,y:n.y}}function X3(){return navigator.maxTouchPoints||"ontouchstart"in this}function K3(){var n=H3,e=W3,t=q3,r=X3,i={},s=ic("start","drag","end"),o=0,a,c,l,u,d=0;function h(_){_.on("mousedown.drag",f).filter(r).on("touchstart.drag",x).on("touchmove.drag",g,z3).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(_,T){if(!(u||!n.call(this,_,T))){var w=v(this,e.call(this,_,T),_,T,"mouse");w&&(gt(_.view).on("mousemove.drag",p,La).on("mouseup.drag",m,La),IT(_.view),Td(_),l=!1,a=_.clientX,c=_.clientY,w("start",_))}}function p(_){if(Gs(_),!l){var T=_.clientX-a,w=_.clientY-c;l=T*T+w*w>d}i.mouse("drag",_)}function m(_){gt(_.view).on("mousemove.drag mouseup.drag",null),OT(_.view,l),Gs(_),i.mouse("end",_)}function x(_,T){if(n.call(this,_,T)){var w=_.changedTouches,N=e.call(this,_,T),S=w.length,C,B;for(C=0;C<S;++C)(B=v(this,N,_,T,w[C].identifier,w[C]))&&(Td(_),B("start",_,w[C]))}}function g(_){var T=_.changedTouches,w=T.length,N,S;for(N=0;N<w;++N)(S=i[T[N].identifier])&&(Gs(_),S("drag",_,T[N]))}function y(_){var T=_.changedTouches,w=T.length,N,S;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),N=0;N<w;++N)(S=i[T[N].identifier])&&(Td(_),S("end",_,T[N]))}function v(_,T,w,N,S,C){var B=s.copy(),D=Nn(C||w,T),U,$,A;if((A=t.call(_,new Cf("beforestart",{sourceEvent:w,target:h,identifier:S,active:o,x:D[0],y:D[1],dx:0,dy:0,dispatch:B}),N))!=null)return U=A.x-D[0]||0,$=A.y-D[1]||0,function O(k,R,L){var M=D,W;switch(k){case"start":i[S]=O,W=o++;break;case"end":delete i[S],--o;case"drag":D=Nn(L||R,T),W=o;break}B.call(k,_,new Cf(k,{sourceEvent:R,subject:A,target:h,identifier:S,active:W,x:D[0]+U,y:D[1]+$,dx:D[0]-M[0],dy:D[1]-M[1],dispatch:B}),N)}}return h.filter=function(_){return arguments.length?(n=typeof _=="function"?_:bc(!!_),h):n},h.container=function(_){return arguments.length?(e=typeof _=="function"?_:bc(_),h):e},h.subject=function(_){return arguments.length?(t=typeof _=="function"?_:bc(_),h):t},h.touchable=function(_){return arguments.length?(r=typeof _=="function"?_:bc(!!_),h):r},h.on=function(){var _=s.on.apply(s,arguments);return _===s?h:_},h.clickDistance=function(_){return arguments.length?(d=(_=+_)*_,h):Math.sqrt(d)},h}function ku(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function xm(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function vo(){}var es=.7,no=1/es,$s="\\s*([+-]?\\d+)\\s*",Ia="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Y3=/^#([0-9a-f]{3,8})$/,Q3=new RegExp(`^rgb\\(${$s},${$s},${$s}\\)$`),Z3=new RegExp(`^rgb\\(${Jn},${Jn},${Jn}\\)$`),J3=new RegExp(`^rgba\\(${$s},${$s},${$s},${Ia}\\)$`),eP=new RegExp(`^rgba\\(${Jn},${Jn},${Jn},${Ia}\\)$`),tP=new RegExp(`^hsl\\(${Ia},${Jn},${Jn}\\)$`),nP=new RegExp(`^hsla\\(${Ia},${Jn},${Jn},${Ia}\\)$`),E0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ku(vo,ts,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:C0,formatHex:C0,formatHex8:rP,formatHsl:iP,formatRgb:R0,toString:R0});function C0(){return this.rgb().formatHex()}function rP(){return this.rgb().formatHex8()}function iP(){return VT(this).formatHsl()}function R0(){return this.rgb().formatRgb()}function ts(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=Y3.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?M0(e):t===3?new kt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?vc(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?vc(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Q3.exec(n))?new kt(e[1],e[2],e[3],1):(e=Z3.exec(n))?new kt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=J3.exec(n))?vc(e[1],e[2],e[3],e[4]):(e=eP.exec(n))?vc(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=tP.exec(n))?B0(e[1],e[2]/100,e[3]/100,1):(e=nP.exec(n))?B0(e[1],e[2]/100,e[3]/100,e[4]):E0.hasOwnProperty(n)?M0(E0[n]):n==="transparent"?new kt(NaN,NaN,NaN,0):null}function M0(n){return new kt(n>>16&255,n>>8&255,n&255,1)}function vc(n,e,t,r){return r<=0&&(n=e=t=NaN),new kt(n,e,t,r)}function UT(n){return n instanceof vo||(n=ts(n)),n?(n=n.rgb(),new kt(n.r,n.g,n.b,n.opacity)):new kt}function Rf(n,e,t,r){return arguments.length===1?UT(n):new kt(n,e,t,r??1)}function kt(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}ku(kt,Rf,xm(vo,{brighter(n){return n=n==null?no:Math.pow(no,n),new kt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?es:Math.pow(es,n),new kt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new kt(qi(this.r),qi(this.g),qi(this.b),Xl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:P0,formatHex:P0,formatHex8:sP,formatRgb:D0,toString:D0}));function P0(){return`#${Ui(this.r)}${Ui(this.g)}${Ui(this.b)}`}function sP(){return`#${Ui(this.r)}${Ui(this.g)}${Ui(this.b)}${Ui((isNaN(this.opacity)?1:this.opacity)*255)}`}function D0(){const n=Xl(this.opacity);return`${n===1?"rgb(":"rgba("}${qi(this.r)}, ${qi(this.g)}, ${qi(this.b)}${n===1?")":`, ${n})`}`}function Xl(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function qi(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Ui(n){return n=qi(n),(n<16?"0":"")+n.toString(16)}function B0(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Mn(n,e,t,r)}function VT(n){if(n instanceof Mn)return new Mn(n.h,n.s,n.l,n.opacity);if(n instanceof vo||(n=ts(n)),!n)return new Mn;if(n instanceof Mn)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,a=s-i,c=(s+i)/2;return a?(e===s?o=(t-r)/a+(t<r)*6:t===s?o=(r-e)/a+2:o=(e-t)/a+4,a/=c<.5?s+i:2-s-i,o*=60):a=c>0&&c<1?0:o,new Mn(o,a,c,n.opacity)}function oP(n,e,t,r){return arguments.length===1?VT(n):new Mn(n,e,t,r??1)}function Mn(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}ku(Mn,oP,xm(vo,{brighter(n){return n=n==null?no:Math.pow(no,n),new Mn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?es:Math.pow(es,n),new Mn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new kt(wd(n>=240?n-240:n+120,i,r),wd(n,i,r),wd(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Mn(F0(this.h),_c(this.s),_c(this.l),Xl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Xl(this.opacity);return`${n===1?"hsl(":"hsla("}${F0(this.h)}, ${_c(this.s)*100}%, ${_c(this.l)*100}%${n===1?")":`, ${n})`}`}}));function F0(n){return n=(n||0)%360,n<0?n+360:n}function _c(n){return Math.max(0,Math.min(1,n||0))}function wd(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const aP=Math.PI/180,cP=180/Math.PI;var GT=-.14861,ym=1.78277,bm=-.29227,Lu=-.90649,Oa=1.97294,k0=Oa*Lu,L0=Oa*ym,I0=ym*bm-Lu*GT;function lP(n){if(n instanceof Xi)return new Xi(n.h,n.s,n.l,n.opacity);n instanceof kt||(n=UT(n));var e=n.r/255,t=n.g/255,r=n.b/255,i=(I0*r+k0*e-L0*t)/(I0+k0-L0),s=r-i,o=(Oa*(t-i)-bm*s)/Lu,a=Math.sqrt(o*o+s*s)/(Oa*i*(1-i)),c=a?Math.atan2(o,s)*cP-120:NaN;return new Xi(c<0?c+360:c,a,i,n.opacity)}function oi(n,e,t,r){return arguments.length===1?lP(n):new Xi(n,e,t,r??1)}function Xi(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}ku(Xi,oi,xm(vo,{brighter(n){return n=n==null?no:Math.pow(no,n),new Xi(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?es:Math.pow(es,n),new Xi(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*aP,e=+this.l,t=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(n),i=Math.sin(n);return new kt(255*(e+t*(GT*r+ym*i)),255*(e+t*(bm*r+Lu*i)),255*(e+t*(Oa*r)),this.opacity)}}));const Iu=n=>()=>n;function $T(n,e){return function(t){return n+t*e}}function uP(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function dP(n,e){var t=e-n;return t?$T(n,t>180||t<-180?t-360*Math.round(t/360):t):Iu(isNaN(n)?e:n)}function hP(n){return(n=+n)==1?js:function(e,t){return t-e?uP(e,t,n):Iu(isNaN(e)?t:e)}}function js(n,e){var t=e-n;return t?$T(n,t):Iu(isNaN(n)?e:n)}const Kl=(function n(e){var t=hP(e);function r(i,s){var o=t((i=Rf(i)).r,(s=Rf(s)).r),a=t(i.g,s.g),c=t(i.b,s.b),l=js(i.opacity,s.opacity);return function(u){return i.r=o(u),i.g=a(u),i.b=c(u),i.opacity=l(u),i+""}}return r.gamma=n,r})(1);function fP(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(s){for(i=0;i<t;++i)r[i]=n[i]*(1-s)+e[i]*s;return r}}function pP(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function mP(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),s=new Array(t),o;for(o=0;o<r;++o)i[o]=Ou(n[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function gP(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function Cn(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function xP(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=Ou(n[i],e[i]):r[i]=e[i];return function(s){for(i in t)r[i]=t[i](s);return r}}var Mf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sd=new RegExp(Mf.source,"g");function yP(n){return function(){return n}}function bP(n){return function(e){return n(e)+""}}function jT(n,e){var t=Mf.lastIndex=Sd.lastIndex=0,r,i,s,o=-1,a=[],c=[];for(n=n+"",e=e+"";(r=Mf.exec(n))&&(i=Sd.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:Cn(r,i)})),t=Sd.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?bP(c[0].x):yP(e):(e=c.length,function(l){for(var u=0,d;u<e;++u)a[(d=c[u]).i]=d.x(l);return a.join("")})}function Ou(n,e){var t=typeof e,r;return e==null||t==="boolean"?Iu(e):(t==="number"?Cn:t==="string"?(r=ts(e))?(e=r,Kl):jT:e instanceof ts?Kl:e instanceof Date?gP:pP(e)?fP:Array.isArray(e)?mP:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?xP:Cn)(n,e)}function zT(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var O0=180/Math.PI,Pf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function HT(n,e,t,r,i,s){var o,a,c;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(c=n*t+e*r)&&(t-=n*c,r-=e*c),(a=Math.sqrt(t*t+r*r))&&(t/=a,r/=a,c/=a),n*r<e*t&&(n=-n,e=-e,c=-c,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,n)*O0,skewX:Math.atan(c)*O0,scaleX:o,scaleY:a}}var Tc;function vP(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Pf:HT(e.a,e.b,e.c,e.d,e.e,e.f)}function _P(n){return n==null||(Tc||(Tc=document.createElementNS("http://www.w3.org/2000/svg","g")),Tc.setAttribute("transform",n),!(n=Tc.transform.baseVal.consolidate()))?Pf:(n=n.matrix,HT(n.a,n.b,n.c,n.d,n.e,n.f))}function WT(n,e,t,r){function i(l){return l.length?l.pop()+" ":""}function s(l,u,d,h,f,p){if(l!==d||u!==h){var m=f.push("translate(",null,e,null,t);p.push({i:m-4,x:Cn(l,d)},{i:m-2,x:Cn(u,h)})}else(d||h)&&f.push("translate("+d+e+h+t)}function o(l,u,d,h){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),h.push({i:d.push(i(d)+"rotate(",null,r)-2,x:Cn(l,u)})):u&&d.push(i(d)+"rotate("+u+r)}function a(l,u,d,h){l!==u?h.push({i:d.push(i(d)+"skewX(",null,r)-2,x:Cn(l,u)}):u&&d.push(i(d)+"skewX("+u+r)}function c(l,u,d,h,f,p){if(l!==d||u!==h){var m=f.push(i(f)+"scale(",null,",",null,")");p.push({i:m-4,x:Cn(l,d)},{i:m-2,x:Cn(u,h)})}else(d!==1||h!==1)&&f.push(i(f)+"scale("+d+","+h+")")}return function(l,u){var d=[],h=[];return l=n(l),u=n(u),s(l.translateX,l.translateY,u.translateX,u.translateY,d,h),o(l.rotate,u.rotate,d,h),a(l.skewX,u.skewX,d,h),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,d,h),l=u=null,function(f){for(var p=-1,m=h.length,x;++p<m;)d[(x=h[p]).i]=x.x(f);return d.join("")}}}var TP=WT(vP,"px, ","px)","deg)"),wP=WT(_P,", ",")",")"),SP=1e-12;function U0(n){return((n=Math.exp(n))+1/n)/2}function NP(n){return((n=Math.exp(n))-1/n)/2}function AP(n){return((n=Math.exp(2*n))-1)/(n+1)}const EP=(function n(e,t,r){function i(s,o){var a=s[0],c=s[1],l=s[2],u=o[0],d=o[1],h=o[2],f=u-a,p=d-c,m=f*f+p*p,x,g;if(m<SP)g=Math.log(h/l)/e,x=function(N){return[a+N*f,c+N*p,l*Math.exp(e*N*g)]};else{var y=Math.sqrt(m),v=(h*h-l*l+r*m)/(2*l*t*y),_=(h*h-l*l-r*m)/(2*h*t*y),T=Math.log(Math.sqrt(v*v+1)-v),w=Math.log(Math.sqrt(_*_+1)-_);g=(w-T)/e,x=function(N){var S=N*g,C=U0(T),B=l/(t*y)*(C*AP(e*S+T)-NP(T));return[a+B*f,c+B*p,l*C/U0(e*S+T)]}}return x.duration=g*1e3*e/Math.SQRT2,x}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,c=a*a;return n(o,a,c)},i})(Math.SQRT2,2,4);function qT(n){return(function e(t){t=+t;function r(i,s){var o=n((i=oi(i)).h,(s=oi(s)).h),a=js(i.s,s.s),c=js(i.l,s.l),l=js(i.opacity,s.opacity);return function(u){return i.h=o(u),i.s=a(u),i.l=c(Math.pow(u,t)),i.opacity=l(u),i+""}}return r.gamma=e,r})(1)}qT(dP);var XT=qT(js),ro=0,oa=0,ko=0,KT=1e3,Yl,aa,Ql=0,ns=0,Uu=0,Ua=typeof performance=="object"&&performance.now?performance:Date,YT=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function vm(){return ns||(YT(CP),ns=Ua.now()+Uu)}function CP(){ns=0}function Zl(){this._call=this._time=this._next=null}Zl.prototype=_m.prototype={constructor:Zl,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?vm():+t)+(e==null?0:+e),!this._next&&aa!==this&&(aa?aa._next=this:Yl=this,aa=this),this._call=n,this._time=t,Df()},stop:function(){this._call&&(this._call=null,this._time=1/0,Df())}};function _m(n,e,t){var r=new Zl;return r.restart(n,e,t),r}function RP(){vm(),++ro;for(var n=Yl,e;n;)(e=ns-n._time)>=0&&n._call.call(void 0,e),n=n._next;--ro}function V0(){ns=(Ql=Ua.now())+Uu,ro=oa=0;try{RP()}finally{ro=0,PP(),ns=0}}function MP(){var n=Ua.now(),e=n-Ql;e>KT&&(Uu-=e,Ql=n)}function PP(){for(var n,e=Yl,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Yl=t);aa=n,Df(r)}function Df(n){if(!ro){oa&&(oa=clearTimeout(oa));var e=n-ns;e>24?(n<1/0&&(oa=setTimeout(V0,n-Ua.now()-Uu)),ko&&(ko=clearInterval(ko))):(ko||(Ql=Ua.now(),ko=setInterval(MP,KT)),ro=1,YT(V0))}}function G0(n,e,t){var r=new Zl;return e=e==null?0:+e,r.restart(i=>{r.stop(),n(i+e)},e,t),r}var DP=ic("start","end","cancel","interrupt"),BP=[],QT=0,$0=1,Bf=2,_l=3,j0=4,Ff=5,Tl=6;function Vu(n,e,t,r,i,s){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;FP(n,t,{name:e,index:r,group:i,on:DP,tween:BP,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:QT})}function Tm(n,e){var t=Un(n,e);if(t.state>QT)throw new Error("too late; already scheduled");return t}function ar(n,e){var t=Un(n,e);if(t.state>_l)throw new Error("too late; already running");return t}function Un(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function FP(n,e,t){var r=n.__transition,i;r[e]=t,t.timer=_m(s,0,t.time);function s(l){t.state=$0,t.timer.restart(o,t.delay,t.time),t.delay<=l&&o(l-t.delay)}function o(l){var u,d,h,f;if(t.state!==$0)return c();for(u in r)if(f=r[u],f.name===t.name){if(f.state===_l)return G0(o);f.state===j0?(f.state=Tl,f.timer.stop(),f.on.call("interrupt",n,n.__data__,f.index,f.group),delete r[u]):+u<e&&(f.state=Tl,f.timer.stop(),f.on.call("cancel",n,n.__data__,f.index,f.group),delete r[u])}if(G0(function(){t.state===_l&&(t.state=j0,t.timer.restart(a,t.delay,t.time),a(l))}),t.state=Bf,t.on.call("start",n,n.__data__,t.index,t.group),t.state===Bf){for(t.state=_l,i=new Array(h=t.tween.length),u=0,d=-1;u<h;++u)(f=t.tween[u].value.call(n,n.__data__,t.index,t.group))&&(i[++d]=f);i.length=d+1}}function a(l){for(var u=l<t.duration?t.ease.call(null,l/t.duration):(t.timer.restart(c),t.state=Ff,1),d=-1,h=i.length;++d<h;)i[d].call(n,u);t.state===Ff&&(t.on.call("end",n,n.__data__,t.index,t.group),c())}function c(){t.state=Tl,t.timer.stop(),delete r[e];for(var l in r)return;delete n.__transition}}function wl(n,e){var t=n.__transition,r,i,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((r=t[o]).name!==e){s=!1;continue}i=r.state>Bf&&r.state<Ff,r.state=Tl,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[o]}s&&delete n.__transition}}function kP(n){return this.each(function(){wl(this,n)})}function LP(n,e){var t,r;return function(){var i=ar(this,n),s=i.tween;if(s!==t){r=t=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function IP(n,e,t){var r,i;if(typeof t!="function")throw new Error;return function(){var s=ar(this,n),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:t},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=a;break}c===l&&i.push(a)}s.tween=i}}function OP(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=Un(this.node(),t).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===n)return o.value;return null}return this.each((e==null?LP:IP)(t,n,e))}function wm(n,e,t){var r=n._id;return n.each(function(){var i=ar(this,r);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return Un(i,r).value[e]}}function ZT(n,e){var t;return(typeof e=="number"?Cn:e instanceof ts?Kl:(t=ts(e))?(e=t,Kl):jT)(n,e)}function UP(n){return function(){this.removeAttribute(n)}}function VP(n){return function(){this.removeAttributeNS(n.space,n.local)}}function GP(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttribute(n);return o===i?null:o===r?s:s=e(r=o,t)}}function $P(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttributeNS(n.space,n.local);return o===i?null:o===r?s:s=e(r=o,t)}}function jP(n,e,t){var r,i,s;return function(){var o,a=t(this),c;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),c=a+"",o===c?null:o===r&&c===i?s:(i=c,s=e(r=o,a)))}}function zP(n,e,t){var r,i,s;return function(){var o,a=t(this),c;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),c=a+"",o===c?null:o===r&&c===i?s:(i=c,s=e(r=o,a)))}}function HP(n,e){var t=Fu(n),r=t==="transform"?wP:ZT;return this.attrTween(n,typeof e=="function"?(t.local?zP:jP)(t,r,wm(this,"attr."+n,e)):e==null?(t.local?VP:UP)(t):(t.local?$P:GP)(t,r,e))}function WP(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function qP(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function XP(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&qP(n,s)),t}return i._value=e,i}function KP(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&WP(n,s)),t}return i._value=e,i}function YP(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=Fu(n);return this.tween(t,(r.local?XP:KP)(r,e))}function QP(n,e){return function(){Tm(this,n).delay=+e.apply(this,arguments)}}function ZP(n,e){return e=+e,function(){Tm(this,n).delay=e}}function JP(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?QP:ZP)(e,n)):Un(this.node(),e).delay}function eD(n,e){return function(){ar(this,n).duration=+e.apply(this,arguments)}}function tD(n,e){return e=+e,function(){ar(this,n).duration=e}}function nD(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?eD:tD)(e,n)):Un(this.node(),e).duration}function rD(n,e){if(typeof e!="function")throw new Error;return function(){ar(this,n).ease=e}}function iD(n){var e=this._id;return arguments.length?this.each(rD(e,n)):Un(this.node(),e).ease}function sD(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;ar(this,n).ease=t}}function oD(n){if(typeof n!="function")throw new Error;return this.each(sD(this._id,n))}function aD(n){typeof n!="function"&&(n=ET(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,l=0;l<o;++l)(c=s[l])&&n.call(c,c.__data__,l,s)&&a.push(c);return new Pr(r,this._parents,this._name,this._id)}function cD(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,i=t.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var c=e[a],l=t[a],u=c.length,d=o[a]=new Array(u),h,f=0;f<u;++f)(h=c[f]||l[f])&&(d[f]=h);for(;a<r;++a)o[a]=e[a];return new Pr(o,this._parents,this._name,this._id)}function lD(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function uD(n,e,t){var r,i,s=lD(e)?Tm:ar;return function(){var o=s(this,n),a=o.on;a!==r&&(i=(r=a).copy()).on(e,t),o.on=i}}function dD(n,e){var t=this._id;return arguments.length<2?Un(this.node(),t).on.on(n):this.each(uD(t,n,e))}function hD(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function fD(){return this.on("end.remove",hD(this._id))}function pD(n){var e=this._name,t=this._id;typeof n!="function"&&(n=mm(n));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],c=a.length,l=s[o]=new Array(c),u,d,h=0;h<c;++h)(u=a[h])&&(d=n.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d,Vu(l[h],e,t,h,l,Un(u,t)));return new Pr(s,this._parents,e,t)}function mD(n){var e=this._name,t=this._id;typeof n!="function"&&(n=AT(n));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var c=r[a],l=c.length,u,d=0;d<l;++d)if(u=c[d]){for(var h=n.call(u,u.__data__,d,c),f,p=Un(u,t),m=0,x=h.length;m<x;++m)(f=h[m])&&Vu(f,e,t,m,h,p);s.push(h),o.push(u)}return new Pr(s,o,e,t)}var gD=sc.prototype.constructor;function xD(){return new gD(this._groups,this._parents)}function yD(n,e){var t,r,i;return function(){var s=to(this,n),o=(this.style.removeProperty(n),to(this,n));return s===o?null:s===t&&o===r?i:i=e(t=s,r=o)}}function JT(n){return function(){this.style.removeProperty(n)}}function bD(n,e,t){var r,i=t+"",s;return function(){var o=to(this,n);return o===i?null:o===r?s:s=e(r=o,t)}}function vD(n,e,t){var r,i,s;return function(){var o=to(this,n),a=t(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(n),to(this,n))),o===c?null:o===r&&c===i?s:(i=c,s=e(r=o,a))}}function _D(n,e){var t,r,i,s="style."+e,o="end."+s,a;return function(){var c=ar(this,n),l=c.on,u=c.value[s]==null?a||(a=JT(e)):void 0;(l!==t||i!==u)&&(r=(t=l).copy()).on(o,i=u),c.on=r}}function TD(n,e,t){var r=(n+="")=="transform"?TP:ZT;return e==null?this.styleTween(n,yD(n,r)).on("end.style."+n,JT(n)):typeof e=="function"?this.styleTween(n,vD(n,r,wm(this,"style."+n,e))).each(_D(this._id,n)):this.styleTween(n,bD(n,r,e),t).on("end.style."+n,null)}function wD(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function SD(n,e,t){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&wD(n,o,t)),r}return s._value=e,s}function ND(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,SD(n,e,t??""))}function AD(n){return function(){this.textContent=n}}function ED(n){return function(){var e=n(this);this.textContent=e??""}}function CD(n){return this.tween("text",typeof n=="function"?ED(wm(this,"text",n)):AD(n==null?"":n+""))}function RD(n){return function(e){this.textContent=n.call(this,e)}}function MD(n){var e,t;function r(){var i=n.apply(this,arguments);return i!==t&&(e=(t=i)&&RD(i)),e}return r._value=n,r}function PD(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,MD(n))}function DD(){for(var n=this._name,e=this._id,t=ew(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,c,l=0;l<a;++l)if(c=o[l]){var u=Un(c,e);Vu(c,n,t,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Pr(r,this._parents,n,t)}function BD(){var n,e,t=this,r=t._id,i=t.size();return new Promise(function(s,o){var a={value:o},c={value:function(){--i===0&&s()}};t.each(function(){var l=ar(this,r),u=l.on;u!==n&&(e=(n=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),l.on=e}),i===0&&s()})}var FD=0;function Pr(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function ew(){return++FD}var dr=sc.prototype;Pr.prototype={constructor:Pr,select:pD,selectAll:mD,selectChild:dr.selectChild,selectChildren:dr.selectChildren,filter:aD,merge:cD,selection:xD,transition:DD,call:dr.call,nodes:dr.nodes,node:dr.node,size:dr.size,empty:dr.empty,each:dr.each,on:dD,attr:HP,attrTween:YP,style:TD,styleTween:ND,text:CD,textTween:PD,remove:fD,tween:OP,delay:JP,duration:nD,ease:iD,easeVarying:oD,end:BD,[Symbol.iterator]:dr[Symbol.iterator]};function kD(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var LD={time:null,delay:0,duration:250,ease:kD};function ID(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function OD(n){var e,t;n instanceof Pr?(e=n._id,n=n._name):(e=ew(),(t=LD).time=vm(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,c,l=0;l<a;++l)(c=o[l])&&Vu(c,n,e,l,o,t||ID(c,e));return new Pr(r,this._parents,n,e)}sc.prototype.interrupt=kP;sc.prototype.transition=OD;const wc=n=>()=>n;function UD(n,{sourceEvent:e,target:t,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Nr(n,e,t){this.k=n,this.x=e,this.y=t}Nr.prototype={constructor:Nr,scale:function(n){return n===1?this:new Nr(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Nr(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ti=new Nr(1,0,0);Nr.prototype;function Nd(n){n.stopImmediatePropagation()}function Lo(n){n.preventDefault(),n.stopImmediatePropagation()}function VD(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function GD(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function z0(){return this.__zoom||ti}function $D(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function jD(){return navigator.maxTouchPoints||"ontouchstart"in this}function zD(n,e,t){var r=n.invertX(e[0][0])-t[0][0],i=n.invertX(e[1][0])-t[1][0],s=n.invertY(e[0][1])-t[0][1],o=n.invertY(e[1][1])-t[1][1];return n.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function tw(){var n=VD,e=GD,t=zD,r=$D,i=jD,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,c=EP,l=ic("start","zoom","end"),u,d,h,f=500,p=150,m=0,x=10;function g(A){A.property("__zoom",z0).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",B).filter(i).on("touchstart.zoom",D).on("touchmove.zoom",U).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(A,O,k,R){var L=A.selection?A.selection():A;L.property("__zoom",z0),A!==L?T(A,O,k,R):L.interrupt().each(function(){w(this,arguments).event(R).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},g.scaleBy=function(A,O,k,R){g.scaleTo(A,function(){var L=this.__zoom.k,M=typeof O=="function"?O.apply(this,arguments):O;return L*M},k,R)},g.scaleTo=function(A,O,k,R){g.transform(A,function(){var L=e.apply(this,arguments),M=this.__zoom,W=k==null?_(L):typeof k=="function"?k.apply(this,arguments):k,I=M.invert(W),j=typeof O=="function"?O.apply(this,arguments):O;return t(v(y(M,j),W,I),L,o)},k,R)},g.translateBy=function(A,O,k,R){g.transform(A,function(){return t(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof k=="function"?k.apply(this,arguments):k),e.apply(this,arguments),o)},null,R)},g.translateTo=function(A,O,k,R,L){g.transform(A,function(){var M=e.apply(this,arguments),W=this.__zoom,I=R==null?_(M):typeof R=="function"?R.apply(this,arguments):R;return t(ti.translate(I[0],I[1]).scale(W.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof k=="function"?-k.apply(this,arguments):-k),M,o)},R,L)};function y(A,O){return O=Math.max(s[0],Math.min(s[1],O)),O===A.k?A:new Nr(O,A.x,A.y)}function v(A,O,k){var R=O[0]-k[0]*A.k,L=O[1]-k[1]*A.k;return R===A.x&&L===A.y?A:new Nr(A.k,R,L)}function _(A){return[(+A[0][0]+ +A[1][0])/2,(+A[0][1]+ +A[1][1])/2]}function T(A,O,k,R){A.on("start.zoom",function(){w(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event(R).end()}).tween("zoom",function(){var L=this,M=arguments,W=w(L,M).event(R),I=e.apply(L,M),j=k==null?_(I):typeof k=="function"?k.apply(L,M):k,Z=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),ee=L.__zoom,V=typeof O=="function"?O.apply(L,M):O,Q=c(ee.invert(j).concat(Z/ee.k),V.invert(j).concat(Z/V.k));return function(te){if(te===1)te=V;else{var ce=Q(te),ye=Z/ce[2];te=new Nr(ye,j[0]-ce[0]*ye,j[1]-ce[1]*ye)}W.zoom(null,te)}})}function w(A,O,k){return!k&&A.__zooming||new N(A,O)}function N(A,O){this.that=A,this.args=O,this.active=0,this.sourceEvent=null,this.extent=e.apply(A,O),this.taps=0}N.prototype={event:function(A){return A&&(this.sourceEvent=A),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(A,O){return this.mouse&&A!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&A!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&A!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(A){var O=gt(this.that).datum();l.call(A,this.that,new UD(A,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:l}),O)}};function S(A,...O){if(!n.apply(this,arguments))return;var k=w(this,O).event(A),R=this.__zoom,L=Math.max(s[0],Math.min(s[1],R.k*Math.pow(2,r.apply(this,arguments)))),M=Nn(A);if(k.wheel)(k.mouse[0][0]!==M[0]||k.mouse[0][1]!==M[1])&&(k.mouse[1]=R.invert(k.mouse[0]=M)),clearTimeout(k.wheel);else{if(R.k===L)return;k.mouse=[M,R.invert(M)],wl(this),k.start()}Lo(A),k.wheel=setTimeout(W,p),k.zoom("mouse",t(v(y(R,L),k.mouse[0],k.mouse[1]),k.extent,o));function W(){k.wheel=null,k.end()}}function C(A,...O){if(h||!n.apply(this,arguments))return;var k=A.currentTarget,R=w(this,O,!0).event(A),L=gt(A.view).on("mousemove.zoom",j,!0).on("mouseup.zoom",Z,!0),M=Nn(A,k),W=A.clientX,I=A.clientY;IT(A.view),Nd(A),R.mouse=[M,this.__zoom.invert(M)],wl(this),R.start();function j(ee){if(Lo(ee),!R.moved){var V=ee.clientX-W,Q=ee.clientY-I;R.moved=V*V+Q*Q>m}R.event(ee).zoom("mouse",t(v(R.that.__zoom,R.mouse[0]=Nn(ee,k),R.mouse[1]),R.extent,o))}function Z(ee){L.on("mousemove.zoom mouseup.zoom",null),OT(ee.view,R.moved),Lo(ee),R.event(ee).end()}}function B(A,...O){if(n.apply(this,arguments)){var k=this.__zoom,R=Nn(A.changedTouches?A.changedTouches[0]:A,this),L=k.invert(R),M=k.k*(A.shiftKey?.5:2),W=t(v(y(k,M),R,L),e.apply(this,O),o);Lo(A),a>0?gt(this).transition().duration(a).call(T,W,R,A):gt(this).call(g.transform,W,R,A)}}function D(A,...O){if(n.apply(this,arguments)){var k=A.touches,R=k.length,L=w(this,O,A.changedTouches.length===R).event(A),M,W,I,j;for(Nd(A),W=0;W<R;++W)I=k[W],j=Nn(I,this),j=[j,this.__zoom.invert(j),I.identifier],L.touch0?!L.touch1&&L.touch0[2]!==j[2]&&(L.touch1=j,L.taps=0):(L.touch0=j,M=!0,L.taps=1+!!u);u&&(u=clearTimeout(u)),M&&(L.taps<2&&(d=j[0],u=setTimeout(function(){u=null},f)),wl(this),L.start())}}function U(A,...O){if(this.__zooming){var k=w(this,O).event(A),R=A.changedTouches,L=R.length,M,W,I,j;for(Lo(A),M=0;M<L;++M)W=R[M],I=Nn(W,this),k.touch0&&k.touch0[2]===W.identifier?k.touch0[0]=I:k.touch1&&k.touch1[2]===W.identifier&&(k.touch1[0]=I);if(W=k.that.__zoom,k.touch1){var Z=k.touch0[0],ee=k.touch0[1],V=k.touch1[0],Q=k.touch1[1],te=(te=V[0]-Z[0])*te+(te=V[1]-Z[1])*te,ce=(ce=Q[0]-ee[0])*ce+(ce=Q[1]-ee[1])*ce;W=y(W,Math.sqrt(te/ce)),I=[(Z[0]+V[0])/2,(Z[1]+V[1])/2],j=[(ee[0]+Q[0])/2,(ee[1]+Q[1])/2]}else if(k.touch0)I=k.touch0[0],j=k.touch0[1];else return;k.zoom("touch",t(v(W,I,j),k.extent,o))}}function $(A,...O){if(this.__zooming){var k=w(this,O).event(A),R=A.changedTouches,L=R.length,M,W;for(Nd(A),h&&clearTimeout(h),h=setTimeout(function(){h=null},f),M=0;M<L;++M)W=R[M],k.touch0&&k.touch0[2]===W.identifier?delete k.touch0:k.touch1&&k.touch1[2]===W.identifier&&delete k.touch1;if(k.touch1&&!k.touch0&&(k.touch0=k.touch1,delete k.touch1),k.touch0)k.touch0[1]=this.__zoom.invert(k.touch0[0]);else if(k.end(),k.taps===2&&(W=Nn(W,this),Math.hypot(d[0]-W[0],d[1]-W[1])<x)){var I=gt(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return g.wheelDelta=function(A){return arguments.length?(r=typeof A=="function"?A:wc(+A),g):r},g.filter=function(A){return arguments.length?(n=typeof A=="function"?A:wc(!!A),g):n},g.touchable=function(A){return arguments.length?(i=typeof A=="function"?A:wc(!!A),g):i},g.extent=function(A){return arguments.length?(e=typeof A=="function"?A:wc([[+A[0][0],+A[0][1]],[+A[1][0],+A[1][1]]]),g):e},g.scaleExtent=function(A){return arguments.length?(s[0]=+A[0],s[1]=+A[1],g):[s[0],s[1]]},g.translateExtent=function(A){return arguments.length?(o[0][0]=+A[0][0],o[1][0]=+A[1][0],o[0][1]=+A[0][1],o[1][1]=+A[1][1],g):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},g.constrain=function(A){return arguments.length?(t=A,g):t},g.duration=function(A){return arguments.length?(a=+A,g):a},g.interpolate=function(A){return arguments.length?(c=A,g):c},g.on=function(){var A=l.on.apply(l,arguments);return A===l?g:A},g.clickDistance=function(A){return arguments.length?(m=(A=+A)*A,g):Math.sqrt(m)},g.tapDistance=function(A){return arguments.length?(x=+A,g):x},g}SC();const Gu=E.createContext(null),HD=Gu.Provider,Dr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:n=>`Node type "${n}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:n=>`The old edge with id=${n} does not exist.`,error009:n=>`Marker type "${n}" doesn't exist.`,error008:(n,e)=>`Couldn't create edge for ${n?"target":"source"} handle id: "${n?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:n=>`Edge type "${n}" not found. Using fallback type "default".`,error012:n=>`Node with id "${n}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},nw=Dr.error001();function it(n,e){const t=E.useContext(Gu);if(t===null)throw new Error(nw);return ST(t,n,e)}const wt=()=>{const n=E.useContext(Gu);if(n===null)throw new Error(nw);return E.useMemo(()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe,destroy:n.destroy}),[n])},WD=n=>n.userSelectionActive?"none":"all";function rw({position:n,children:e,className:t,style:r,...i}){const s=it(WD),o=`${n}`.split("-");return K.createElement("div",{className:Ht(["react-flow__panel",t,...o]),style:{...r,pointerEvents:s},...i},e)}function qD({proOptions:n,position:e="bottom-right"}){return n?.hideAttribution?null:K.createElement(rw,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},K.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const XD=({x:n,y:e,label:t,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:s={},labelBgPadding:o=[2,4],labelBgBorderRadius:a=2,children:c,className:l,...u})=>{const d=E.useRef(null),[h,f]=E.useState({x:0,y:0,width:0,height:0}),p=Ht(["react-flow__edge-textwrapper",l]);return E.useEffect(()=>{if(d.current){const m=d.current.getBBox();f({x:m.x,y:m.y,width:m.width,height:m.height})}},[t]),typeof t>"u"||!t?null:K.createElement("g",{transform:`translate(${n-h.width/2} ${e-h.height/2})`,className:p,visibility:h.width?"visible":"hidden",...u},i&&K.createElement("rect",{width:h.width+2*o[0],x:-o[0],y:-o[1],height:h.height+2*o[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),K.createElement("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:d,style:r},t),c)};var KD=E.memo(XD);const Sm=n=>({width:n.offsetWidth,height:n.offsetHeight}),io=(n,e=0,t=1)=>Math.min(Math.max(n,e),t),Nm=(n={x:0,y:0},e)=>({x:io(n.x,e[0][0],e[1][0]),y:io(n.y,e[0][1],e[1][1])}),H0=(n,e,t)=>n<e?io(Math.abs(n-e),1,50)/50:n>t?-io(Math.abs(n-t),1,50)/50:0,iw=(n,e)=>{const t=H0(n.x,35,e.width-35)*20,r=H0(n.y,35,e.height-35)*20;return[t,r]},sw=n=>n.getRootNode?.()||window?.document,YD=(n,e)=>({x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}),Am=({x:n,y:e,width:t,height:r})=>({x:n,y:e,x2:n+t,y2:e+r}),QD=({x:n,y:e,x2:t,y2:r})=>({x:n,y:e,width:t-n,height:r-e}),W0=n=>({...n.positionAbsolute||{x:0,y:0},width:n.width||0,height:n.height||0}),kf=(n,e)=>{const t=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),r=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(t*r)},ZD=n=>fn(n.width)&&fn(n.height)&&fn(n.x)&&fn(n.y),fn=n=>!isNaN(n)&&isFinite(n),at=Symbol.for("internals"),ow=["Enter"," ","Escape"],JD=(n,e)=>{},eB=n=>"nativeEvent"in n;function Lf(n){const t=(eB(n)?n.nativeEvent:n).composedPath?.()?.[0]||n.target;return["INPUT","SELECT","TEXTAREA"].includes(t?.nodeName)||t?.hasAttribute("contenteditable")||!!t?.closest(".nokey")}const aw=n=>"clientX"in n,ni=(n,e)=>{const t=aw(n),r=t?n.clientX:n.touches?.[0].clientX,i=t?n.clientY:n.touches?.[0].clientY;return{x:r-(e?.left??0),y:i-(e?.top??0)}},Jl=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,oc=({id:n,path:e,labelX:t,labelY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:d,markerStart:h,interactionWidth:f=20})=>K.createElement(K.Fragment,null,K.createElement("path",{id:n,style:u,d:e,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:h}),f&&K.createElement("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),i&&fn(t)&&fn(r)?K.createElement(KD,{x:t,y:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l}):null);oc.displayName="BaseEdge";function Io(n,e,t){return t===void 0?t:r=>{const i=e().edges.find(s=>s.id===n);i&&t(r,{...i})}}function cw({sourceX:n,sourceY:e,targetX:t,targetY:r}){const i=Math.abs(t-n)/2,s=t<n?t+i:t-i,o=Math.abs(r-e)/2,a=r<e?r+o:r-o;return[s,a,i,o]}function lw({sourceX:n,sourceY:e,targetX:t,targetY:r,sourceControlX:i,sourceControlY:s,targetControlX:o,targetControlY:a}){const c=n*.125+i*.375+o*.375+t*.125,l=e*.125+s*.375+a*.375+r*.125,u=Math.abs(c-n),d=Math.abs(l-e);return[c,l,u,d]}var rs;(function(n){n.Strict="strict",n.Loose="loose"})(rs||(rs={}));var Vi;(function(n){n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal"})(Vi||(Vi={}));var Va;(function(n){n.Partial="partial",n.Full="full"})(Va||(Va={}));var Wr;(function(n){n.Bezier="default",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n.SimpleBezier="simplebezier"})(Wr||(Wr={}));var eu;(function(n){n.Arrow="arrow",n.ArrowClosed="arrowclosed"})(eu||(eu={}));var he;(function(n){n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom"})(he||(he={}));function q0({pos:n,x1:e,y1:t,x2:r,y2:i}){return n===he.Left||n===he.Right?[.5*(e+r),t]:[e,.5*(t+i)]}function uw({sourceX:n,sourceY:e,sourcePosition:t=he.Bottom,targetX:r,targetY:i,targetPosition:s=he.Top}){const[o,a]=q0({pos:t,x1:n,y1:e,x2:r,y2:i}),[c,l]=q0({pos:s,x1:r,y1:i,x2:n,y2:e}),[u,d,h,f]=lw({sourceX:n,sourceY:e,targetX:r,targetY:i,sourceControlX:o,sourceControlY:a,targetControlX:c,targetControlY:l});return[`M${n},${e} C${o},${a} ${c},${l} ${r},${i}`,u,d,h,f]}const Em=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,sourcePosition:i=he.Bottom,targetPosition:s=he.Top,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,interactionWidth:m})=>{const[x,g,y]=uw({sourceX:n,sourceY:e,sourcePosition:i,targetX:t,targetY:r,targetPosition:s});return K.createElement(oc,{path:x,labelX:g,labelY:y,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,interactionWidth:m})});Em.displayName="SimpleBezierEdge";const X0={[he.Left]:{x:-1,y:0},[he.Right]:{x:1,y:0},[he.Top]:{x:0,y:-1},[he.Bottom]:{x:0,y:1}},tB=({source:n,sourcePosition:e=he.Bottom,target:t})=>e===he.Left||e===he.Right?n.x<t.x?{x:1,y:0}:{x:-1,y:0}:n.y<t.y?{x:0,y:1}:{x:0,y:-1},K0=(n,e)=>Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));function nB({source:n,sourcePosition:e=he.Bottom,target:t,targetPosition:r=he.Top,center:i,offset:s}){const o=X0[e],a=X0[r],c={x:n.x+o.x*s,y:n.y+o.y*s},l={x:t.x+a.x*s,y:t.y+a.y*s},u=tB({source:c,sourcePosition:e,target:l}),d=u.x!==0?"x":"y",h=u[d];let f=[],p,m;const x={x:0,y:0},g={x:0,y:0},[y,v,_,T]=cw({sourceX:n.x,sourceY:n.y,targetX:t.x,targetY:t.y});if(o[d]*a[d]===-1){p=i.x??y,m=i.y??v;const N=[{x:p,y:c.y},{x:p,y:l.y}],S=[{x:c.x,y:m},{x:l.x,y:m}];o[d]===h?f=d==="x"?N:S:f=d==="x"?S:N}else{const N=[{x:c.x,y:l.y}],S=[{x:l.x,y:c.y}];if(d==="x"?f=o.x===h?S:N:f=o.y===h?N:S,e===r){const $=Math.abs(n[d]-t[d]);if($<=s){const A=Math.min(s-1,s-$);o[d]===h?x[d]=(c[d]>n[d]?-1:1)*A:g[d]=(l[d]>t[d]?-1:1)*A}}if(e!==r){const $=d==="x"?"y":"x",A=o[d]===a[$],O=c[$]>l[$],k=c[$]<l[$];(o[d]===1&&(!A&&O||A&&k)||o[d]!==1&&(!A&&k||A&&O))&&(f=d==="x"?N:S)}const C={x:c.x+x.x,y:c.y+x.y},B={x:l.x+g.x,y:l.y+g.y},D=Math.max(Math.abs(C.x-f[0].x),Math.abs(B.x-f[0].x)),U=Math.max(Math.abs(C.y-f[0].y),Math.abs(B.y-f[0].y));D>=U?(p=(C.x+B.x)/2,m=f[0].y):(p=f[0].x,m=(C.y+B.y)/2)}return[[n,{x:c.x+x.x,y:c.y+x.y},...f,{x:l.x+g.x,y:l.y+g.y},t],p,m,_,T]}function rB(n,e,t,r){const i=Math.min(K0(n,e)/2,K0(e,t)/2,r),{x:s,y:o}=e;if(n.x===s&&s===t.x||n.y===o&&o===t.y)return`L${s} ${o}`;if(n.y===o){const l=n.x<t.x?-1:1,u=n.y<t.y?1:-1;return`L ${s+i*l},${o}Q ${s},${o} ${s},${o+i*u}`}const a=n.x<t.x?1:-1,c=n.y<t.y?-1:1;return`L ${s},${o+i*c}Q ${s},${o} ${s+i*a},${o}`}function If({sourceX:n,sourceY:e,sourcePosition:t=he.Bottom,targetX:r,targetY:i,targetPosition:s=he.Top,borderRadius:o=5,centerX:a,centerY:c,offset:l=20}){const[u,d,h,f,p]=nB({source:{x:n,y:e},sourcePosition:t,target:{x:r,y:i},targetPosition:s,center:{x:a,y:c},offset:l});return[u.reduce((x,g,y)=>{let v="";return y>0&&y<u.length-1?v=rB(u[y-1],g,u[y+1],o):v=`${y===0?"M":"L"}${g.x} ${g.y}`,x+=v,x},""),d,h,f,p]}const $u=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,sourcePosition:d=he.Bottom,targetPosition:h=he.Top,markerEnd:f,markerStart:p,pathOptions:m,interactionWidth:x})=>{const[g,y,v]=If({sourceX:n,sourceY:e,sourcePosition:d,targetX:t,targetY:r,targetPosition:h,borderRadius:m?.borderRadius,offset:m?.offset});return K.createElement(oc,{path:g,labelX:y,labelY:v,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:f,markerStart:p,interactionWidth:x})});$u.displayName="SmoothStepEdge";const Cm=E.memo(n=>K.createElement($u,{...n,pathOptions:E.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])}));Cm.displayName="StepEdge";function iB({sourceX:n,sourceY:e,targetX:t,targetY:r}){const[i,s,o,a]=cw({sourceX:n,sourceY:e,targetX:t,targetY:r});return[`M ${n},${e}L ${t},${r}`,i,s,o,a]}const Rm=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:d,markerStart:h,interactionWidth:f})=>{const[p,m,x]=iB({sourceX:n,sourceY:e,targetX:t,targetY:r});return K.createElement(oc,{path:p,labelX:m,labelY:x,label:i,labelStyle:s,labelShowBg:o,labelBgStyle:a,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:d,markerStart:h,interactionWidth:f})});Rm.displayName="StraightEdge";function Sc(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function Y0({pos:n,x1:e,y1:t,x2:r,y2:i,c:s}){switch(n){case he.Left:return[e-Sc(e-r,s),t];case he.Right:return[e+Sc(r-e,s),t];case he.Top:return[e,t-Sc(t-i,s)];case he.Bottom:return[e,t+Sc(i-t,s)]}}function dw({sourceX:n,sourceY:e,sourcePosition:t=he.Bottom,targetX:r,targetY:i,targetPosition:s=he.Top,curvature:o=.25}){const[a,c]=Y0({pos:t,x1:n,y1:e,x2:r,y2:i,c:o}),[l,u]=Y0({pos:s,x1:r,y1:i,x2:n,y2:e,c:o}),[d,h,f,p]=lw({sourceX:n,sourceY:e,targetX:r,targetY:i,sourceControlX:a,sourceControlY:c,targetControlX:l,targetControlY:u});return[`M${n},${e} C${a},${c} ${l},${u} ${r},${i}`,d,h,f,p]}const tu=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,sourcePosition:i=he.Bottom,targetPosition:s=he.Top,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,pathOptions:m,interactionWidth:x})=>{const[g,y,v]=dw({sourceX:n,sourceY:e,sourcePosition:i,targetX:t,targetY:r,targetPosition:s,curvature:m?.curvature});return K.createElement(oc,{path:g,labelX:y,labelY:v,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,interactionWidth:x})});tu.displayName="BezierEdge";const Mm=E.createContext(null),sB=Mm.Provider;Mm.Consumer;const oB=()=>E.useContext(Mm),aB=n=>"id"in n&&"source"in n&&"target"in n,cB=({source:n,sourceHandle:e,target:t,targetHandle:r})=>`reactflow__edge-${n}${e||""}-${t}${r||""}`,Of=(n,e)=>typeof n>"u"?"":typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(r=>`${r}=${n[r]}`).join("&")}`,lB=(n,e)=>e.some(t=>t.source===n.source&&t.target===n.target&&(t.sourceHandle===n.sourceHandle||!t.sourceHandle&&!n.sourceHandle)&&(t.targetHandle===n.targetHandle||!t.targetHandle&&!n.targetHandle)),hw=(n,e)=>{if(!n.source||!n.target)return e;let t;return aB(n)?t={...n}:t={...n,id:cB(n)},lB(t,e)?e:e.concat(t)},Uf=({x:n,y:e},[t,r,i],s,[o,a])=>{const c={x:(n-t)/i,y:(e-r)/i};return s?{x:o*Math.round(c.x/o),y:a*Math.round(c.y/a)}:c},fw=({x:n,y:e},[t,r,i])=>({x:n*i+t,y:e*i+r}),zs=(n,e=[0,0])=>{if(!n)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const t=(n.width??0)*e[0],r=(n.height??0)*e[1],i={x:n.position.x-t,y:n.position.y-r};return{...i,positionAbsolute:n.positionAbsolute?{x:n.positionAbsolute.x-t,y:n.positionAbsolute.y-r}:i}},Pm=(n,e=[0,0])=>{if(n.length===0)return{x:0,y:0,width:0,height:0};const t=n.reduce((r,i)=>{const{x:s,y:o}=zs(i,e).positionAbsolute;return YD(r,Am({x:s,y:o,width:i.width||0,height:i.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return QD(t)},pw=(n,e,[t,r,i]=[0,0,1],s=!1,o=!1,a=[0,0])=>{const c={x:(e.x-t)/i,y:(e.y-r)/i,width:e.width/i,height:e.height/i},l=[];return n.forEach(u=>{const{width:d,height:h,selectable:f=!0,hidden:p=!1}=u;if(o&&!f||p)return!1;const{positionAbsolute:m}=zs(u,a),x={x:m.x,y:m.y,width:d||0,height:h||0},g=kf(c,x),y=typeof d>"u"||typeof h>"u"||d===null||h===null,v=s&&g>0,_=(d||0)*(h||0);(y||v||g>=_||u.dragging)&&l.push(u)}),l},mw=(n,e)=>{const t=n.map(r=>r.id);return e.filter(r=>t.includes(r.source)||t.includes(r.target))},gw=(n,e,t,r,i,s=.1)=>{const o=e/(n.width*(1+s)),a=t/(n.height*(1+s)),c=Math.min(o,a),l=io(c,r,i),u=n.x+n.width/2,d=n.y+n.height/2,h=e/2-u*l,f=t/2-d*l;return{x:h,y:f,zoom:l}},Ci=(n,e=0)=>n.transition().duration(e);function Q0(n,e,t,r){return(e[t]||[]).reduce((i,s)=>(`${n.id}-${s.id}-${t}`!==r&&i.push({id:s.id||null,type:t,nodeId:n.id,x:(n.positionAbsolute?.x??0)+s.x+s.width/2,y:(n.positionAbsolute?.y??0)+s.y+s.height/2}),i),[])}function uB(n,e,t,r,i,s){const{x:o,y:a}=ni(n),l=e.elementsFromPoint(o,a).find(p=>p.classList.contains("react-flow__handle"));if(l){const p=l.getAttribute("data-nodeid");if(p){const m=Dm(void 0,l),x=l.getAttribute("data-handleid"),g=s({nodeId:p,id:x,type:m});if(g){const y=i.find(v=>v.nodeId===p&&v.type===m&&v.id===x);return{handle:{id:x,type:m,nodeId:p,x:y?.x||t.x,y:y?.y||t.y},validHandleResult:g}}}}let u=[],d=1/0;if(i.forEach(p=>{const m=Math.sqrt((p.x-t.x)**2+(p.y-t.y)**2);if(m<=r){const x=s(p);m<=d&&(m<d?u=[{handle:p,validHandleResult:x}]:m===d&&u.push({handle:p,validHandleResult:x}),d=m)}}),!u.length)return{handle:null,validHandleResult:xw()};if(u.length===1)return u[0];const h=u.some(({validHandleResult:p})=>p.isValid),f=u.some(({handle:p})=>p.type==="target");return u.find(({handle:p,validHandleResult:m})=>f?p.type==="target":h?m.isValid:!0)||u[0]}const dB={source:null,target:null,sourceHandle:null,targetHandle:null},xw=()=>({handleDomNode:null,isValid:!1,connection:dB,endHandle:null});function yw(n,e,t,r,i,s,o){const a=i==="target",c=o.querySelector(`.react-flow__handle[data-id="${n?.nodeId}-${n?.id}-${n?.type}"]`),l={...xw(),handleDomNode:c};if(c){const u=Dm(void 0,c),d=c.getAttribute("data-nodeid"),h=c.getAttribute("data-handleid"),f=c.classList.contains("connectable"),p=c.classList.contains("connectableend"),m={source:a?d:t,sourceHandle:a?h:r,target:a?t:d,targetHandle:a?r:h};l.connection=m,f&&p&&(e===rs.Strict?a&&u==="source"||!a&&u==="target":d!==t||h!==r)&&(l.endHandle={nodeId:d,handleId:h,type:u},l.isValid=s(m))}return l}function hB({nodes:n,nodeId:e,handleId:t,handleType:r}){return n.reduce((i,s)=>{if(s[at]){const{handleBounds:o}=s[at];let a=[],c=[];o&&(a=Q0(s,o,"source",`${e}-${t}-${r}`),c=Q0(s,o,"target",`${e}-${t}-${r}`)),i.push(...a,...c)}return i},[])}function Dm(n,e){return n||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function Ad(n){n?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function fB(n,e){let t=null;return e?t="valid":n&&!e&&(t="invalid"),t}function bw({event:n,handleId:e,nodeId:t,onConnect:r,isTarget:i,getState:s,setState:o,isValidConnection:a,edgeUpdaterType:c,onReconnectEnd:l}){const u=sw(n.target),{connectionMode:d,domNode:h,autoPanOnConnect:f,connectionRadius:p,onConnectStart:m,panBy:x,getNodes:g,cancelConnection:y}=s();let v=0,_;const{x:T,y:w}=ni(n),N=u?.elementFromPoint(T,w),S=Dm(c,N),C=h?.getBoundingClientRect();if(!C||!S)return;let B,D=ni(n,C),U=!1,$=null,A=!1,O=null;const k=hB({nodes:g(),nodeId:t,handleId:e,handleType:S}),R=()=>{if(!f)return;const[W,I]=iw(D,C);x({x:W,y:I}),v=requestAnimationFrame(R)};o({connectionPosition:D,connectionStatus:null,connectionNodeId:t,connectionHandleId:e,connectionHandleType:S,connectionStartHandle:{nodeId:t,handleId:e,type:S},connectionEndHandle:null}),m?.(n,{nodeId:t,handleId:e,handleType:S});function L(W){const{transform:I}=s();D=ni(W,C);const{handle:j,validHandleResult:Z}=uB(W,u,Uf(D,I,!1,[1,1]),p,k,ee=>yw(ee,d,t,e,i?"target":"source",a,u));if(_=j,U||(R(),U=!0),O=Z.handleDomNode,$=Z.connection,A=Z.isValid,o({connectionPosition:_&&A?fw({x:_.x,y:_.y},I):D,connectionStatus:fB(!!_,A),connectionEndHandle:Z.endHandle}),!_&&!A&&!O)return Ad(B);$.source!==$.target&&O&&(Ad(B),B=O,O.classList.add("connecting","react-flow__handle-connecting"),O.classList.toggle("valid",A),O.classList.toggle("react-flow__handle-valid",A))}function M(W){(_||O)&&$&&A&&r?.($),s().onConnectEnd?.(W),c&&l?.(W),Ad(B),y(),cancelAnimationFrame(v),U=!1,A=!1,$=null,O=null,u.removeEventListener("mousemove",L),u.removeEventListener("mouseup",M),u.removeEventListener("touchmove",L),u.removeEventListener("touchend",M)}u.addEventListener("mousemove",L),u.addEventListener("mouseup",M),u.addEventListener("touchmove",L),u.addEventListener("touchend",M)}const Z0=()=>!0,pB=n=>({connectionStartHandle:n.connectionStartHandle,connectOnClick:n.connectOnClick,noPanClassName:n.noPanClassName}),mB=(n,e,t)=>r=>{const{connectionStartHandle:i,connectionEndHandle:s,connectionClickStartHandle:o}=r;return{connecting:i?.nodeId===n&&i?.handleId===e&&i?.type===t||s?.nodeId===n&&s?.handleId===e&&s?.type===t,clickConnecting:o?.nodeId===n&&o?.handleId===e&&o?.type===t}},vw=E.forwardRef(({type:n="source",position:e=he.Top,isValidConnection:t,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:s=!0,id:o,onConnect:a,children:c,className:l,onMouseDown:u,onTouchStart:d,...h},f)=>{const p=o||null,m=n==="target",x=wt(),g=oB(),{connectOnClick:y,noPanClassName:v}=it(pB,It),{connecting:_,clickConnecting:T}=it(mB(g,p,n),It);g||x.getState().onError?.("010",Dr.error010());const w=C=>{const{defaultEdgeOptions:B,onConnect:D,hasDefaultEdges:U}=x.getState(),$={...B,...C};if(U){const{edges:A,setEdges:O}=x.getState();O(hw($,A))}D?.($),a?.($)},N=C=>{if(!g)return;const B=aw(C);i&&(B&&C.button===0||!B)&&bw({event:C,handleId:p,nodeId:g,onConnect:w,isTarget:m,getState:x.getState,setState:x.setState,isValidConnection:t||x.getState().isValidConnection||Z0}),B?u?.(C):d?.(C)},S=C=>{const{onClickConnectStart:B,onClickConnectEnd:D,connectionClickStartHandle:U,connectionMode:$,isValidConnection:A}=x.getState();if(!g||!U&&!i)return;if(!U){B?.(C,{nodeId:g,handleId:p,handleType:n}),x.setState({connectionClickStartHandle:{nodeId:g,type:n,handleId:p}});return}const O=sw(C.target),k=t||A||Z0,{connection:R,isValid:L}=yw({nodeId:g,id:p,type:n},$,U.nodeId,U.handleId||null,U.type,k,O);L&&w(R),D?.(C),x.setState({connectionClickStartHandle:null})};return K.createElement("div",{"data-handleid":p,"data-nodeid":g,"data-handlepos":e,"data-id":`${g}-${p}-${n}`,className:Ht(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",v,l,{source:!m,target:m,connectable:r,connectablestart:i,connectableend:s,connecting:T,connectionindicator:r&&(i&&!_||s&&_)}]),onMouseDown:N,onTouchStart:N,onClick:y?S:void 0,ref:f,...h},c)});vw.displayName="Handle";var so=E.memo(vw);const _w=({data:n,isConnectable:e,targetPosition:t=he.Top,sourcePosition:r=he.Bottom})=>K.createElement(K.Fragment,null,K.createElement(so,{type:"target",position:t,isConnectable:e}),n?.label,K.createElement(so,{type:"source",position:r,isConnectable:e}));_w.displayName="DefaultNode";var Vf=E.memo(_w);const Tw=({data:n,isConnectable:e,sourcePosition:t=he.Bottom})=>K.createElement(K.Fragment,null,n?.label,K.createElement(so,{type:"source",position:t,isConnectable:e}));Tw.displayName="InputNode";var ww=E.memo(Tw);const Sw=({data:n,isConnectable:e,targetPosition:t=he.Top})=>K.createElement(K.Fragment,null,K.createElement(so,{type:"target",position:t,isConnectable:e}),n?.label);Sw.displayName="OutputNode";var Nw=E.memo(Sw);const Bm=()=>null;Bm.displayName="GroupNode";const gB=n=>({selectedNodes:n.getNodes().filter(e=>e.selected),selectedEdges:n.edges.filter(e=>e.selected).map(e=>({...e}))}),Nc=n=>n.id;function xB(n,e){return It(n.selectedNodes.map(Nc),e.selectedNodes.map(Nc))&&It(n.selectedEdges.map(Nc),e.selectedEdges.map(Nc))}const Aw=E.memo(({onSelectionChange:n})=>{const e=wt(),{selectedNodes:t,selectedEdges:r}=it(gB,xB);return E.useEffect(()=>{const i={nodes:t,edges:r};n?.(i),e.getState().onSelectionChange.forEach(s=>s(i))},[t,r,n]),null});Aw.displayName="SelectionListener";const yB=n=>!!n.onSelectionChange;function bB({onSelectionChange:n}){const e=it(yB);return n||e?K.createElement(Aw,{onSelectionChange:n}):null}const vB=n=>({setNodes:n.setNodes,setEdges:n.setEdges,setDefaultNodesAndEdges:n.setDefaultNodesAndEdges,setMinZoom:n.setMinZoom,setMaxZoom:n.setMaxZoom,setTranslateExtent:n.setTranslateExtent,setNodeExtent:n.setNodeExtent,reset:n.reset});function fs(n,e){E.useEffect(()=>{typeof n<"u"&&e(n)},[n])}function Se(n,e,t){E.useEffect(()=>{typeof e<"u"&&t({[n]:e})},[e])}const _B=({nodes:n,edges:e,defaultNodes:t,defaultEdges:r,onConnect:i,onConnectStart:s,onConnectEnd:o,onClickConnectStart:a,onClickConnectEnd:c,nodesDraggable:l,nodesConnectable:u,nodesFocusable:d,edgesFocusable:h,edgesUpdatable:f,elevateNodesOnSelect:p,minZoom:m,maxZoom:x,nodeExtent:g,onNodesChange:y,onEdgesChange:v,elementsSelectable:_,connectionMode:T,snapGrid:w,snapToGrid:N,translateExtent:S,connectOnClick:C,defaultEdgeOptions:B,fitView:D,fitViewOptions:U,onNodesDelete:$,onEdgesDelete:A,onNodeDrag:O,onNodeDragStart:k,onNodeDragStop:R,onSelectionDrag:L,onSelectionDragStart:M,onSelectionDragStop:W,noPanClassName:I,nodeOrigin:j,rfId:Z,autoPanOnConnect:ee,autoPanOnNodeDrag:V,onError:Q,connectionRadius:te,isValidConnection:ce,nodeDragThreshold:ye})=>{const{setNodes:ge,setEdges:Re,setDefaultNodesAndEdges:nt,setMinZoom:yt,setMaxZoom:ct,setTranslateExtent:ze,setNodeExtent:St,reset:Me}=it(vB,It),ue=wt();return E.useEffect(()=>{const en=r?.map(gi=>({...gi,...B}));return nt(t,en),()=>{Me()}},[]),Se("defaultEdgeOptions",B,ue.setState),Se("connectionMode",T,ue.setState),Se("onConnect",i,ue.setState),Se("onConnectStart",s,ue.setState),Se("onConnectEnd",o,ue.setState),Se("onClickConnectStart",a,ue.setState),Se("onClickConnectEnd",c,ue.setState),Se("nodesDraggable",l,ue.setState),Se("nodesConnectable",u,ue.setState),Se("nodesFocusable",d,ue.setState),Se("edgesFocusable",h,ue.setState),Se("edgesUpdatable",f,ue.setState),Se("elementsSelectable",_,ue.setState),Se("elevateNodesOnSelect",p,ue.setState),Se("snapToGrid",N,ue.setState),Se("snapGrid",w,ue.setState),Se("onNodesChange",y,ue.setState),Se("onEdgesChange",v,ue.setState),Se("connectOnClick",C,ue.setState),Se("fitViewOnInit",D,ue.setState),Se("fitViewOnInitOptions",U,ue.setState),Se("onNodesDelete",$,ue.setState),Se("onEdgesDelete",A,ue.setState),Se("onNodeDrag",O,ue.setState),Se("onNodeDragStart",k,ue.setState),Se("onNodeDragStop",R,ue.setState),Se("onSelectionDrag",L,ue.setState),Se("onSelectionDragStart",M,ue.setState),Se("onSelectionDragStop",W,ue.setState),Se("noPanClassName",I,ue.setState),Se("nodeOrigin",j,ue.setState),Se("rfId",Z,ue.setState),Se("autoPanOnConnect",ee,ue.setState),Se("autoPanOnNodeDrag",V,ue.setState),Se("onError",Q,ue.setState),Se("connectionRadius",te,ue.setState),Se("isValidConnection",ce,ue.setState),Se("nodeDragThreshold",ye,ue.setState),fs(n,ge),fs(e,Re),fs(m,yt),fs(x,ct),fs(S,ze),fs(g,St),null},J0={display:"none"},TB={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ew="react-flow__node-desc",Cw="react-flow__edge-desc",wB="react-flow__aria-live",SB=n=>n.ariaLiveMessage;function NB({rfId:n}){const e=it(SB);return K.createElement("div",{id:`${wB}-${n}`,"aria-live":"assertive","aria-atomic":"true",style:TB},e)}function AB({rfId:n,disableKeyboardA11y:e}){return K.createElement(K.Fragment,null,K.createElement("div",{id:`${Ew}-${n}`,style:J0},"Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),K.createElement("div",{id:`${Cw}-${n}`,style:J0},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!e&&K.createElement(NB,{rfId:n}))}var Ga=(n=null,e={actInsideInputWithModifier:!0})=>{const[t,r]=E.useState(!1),i=E.useRef(!1),s=E.useRef(new Set([])),[o,a]=E.useMemo(()=>{if(n!==null){const l=(Array.isArray(n)?n:[n]).filter(d=>typeof d=="string").map(d=>d.split("+")),u=l.reduce((d,h)=>d.concat(...h),[]);return[l,u]}return[[],[]]},[n]);return E.useEffect(()=>{const c=typeof document<"u"?document:null,l=e?.target||c;if(n!==null){const u=f=>{if(i.current=f.ctrlKey||f.metaKey||f.shiftKey,(!i.current||i.current&&!e.actInsideInputWithModifier)&&Lf(f))return!1;const m=tx(f.code,a);s.current.add(f[m]),ex(o,s.current,!1)&&(f.preventDefault(),r(!0))},d=f=>{if((!i.current||i.current&&!e.actInsideInputWithModifier)&&Lf(f))return!1;const m=tx(f.code,a);ex(o,s.current,!0)?(r(!1),s.current.clear()):s.current.delete(f[m]),f.key==="Meta"&&s.current.clear(),i.current=!1},h=()=>{s.current.clear(),r(!1)};return l?.addEventListener("keydown",u),l?.addEventListener("keyup",d),window.addEventListener("blur",h),()=>{l?.removeEventListener("keydown",u),l?.removeEventListener("keyup",d),window.removeEventListener("blur",h)}}},[n,r]),t};function ex(n,e,t){return n.filter(r=>t||r.length===e.size).some(r=>r.every(i=>e.has(i)))}function tx(n,e){return e.includes(n)?"code":"key"}function Rw(n,e,t,r){const i=n.parentNode||n.parentId;if(!i)return t;const s=e.get(i),o=zs(s,r);return Rw(s,e,{x:(t.x??0)+o.x,y:(t.y??0)+o.y,z:(s[at]?.z??0)>(t.z??0)?s[at]?.z??0:t.z??0},r)}function Mw(n,e,t){n.forEach(r=>{const i=r.parentNode||r.parentId;if(i&&!n.has(i))throw new Error(`Parent node ${i} not found`);if(i||t?.[r.id]){const{x:s,y:o,z:a}=Rw(r,n,{...r.position,z:r[at]?.z??0},e);r.positionAbsolute={x:s,y:o},r[at].z=a,t?.[r.id]&&(r[at].isParent=!0)}})}function Ed(n,e,t,r){const i=new Map,s={},o=r?1e3:0;return n.forEach(a=>{const c=(fn(a.zIndex)?a.zIndex:0)+(a.selected?o:0),l=e.get(a.id),u={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},d=a.parentNode||a.parentId;d&&(s[d]=!0);const h=l?.type&&l?.type!==a.type;Object.defineProperty(u,at,{enumerable:!1,value:{handleBounds:h?void 0:l?.[at]?.handleBounds,z:c}}),i.set(a.id,u)}),Mw(i,t,s),i}function Pw(n,e={}){const{getNodes:t,width:r,height:i,minZoom:s,maxZoom:o,d3Zoom:a,d3Selection:c,fitViewOnInitDone:l,fitViewOnInit:u,nodeOrigin:d}=n(),h=e.initial&&!l&&u;if(a&&c&&(h||!e.initial)){const p=t().filter(x=>{const g=e.includeHiddenNodes?x.width&&x.height:!x.hidden;return e.nodes?.length?g&&e.nodes.some(y=>y.id===x.id):g}),m=p.every(x=>x.width&&x.height);if(p.length>0&&m){const x=Pm(p,d),{x:g,y,zoom:v}=gw(x,r,i,e.minZoom??s,e.maxZoom??o,e.padding??.1),_=ti.translate(g,y).scale(v);return typeof e.duration=="number"&&e.duration>0?a.transform(Ci(c,e.duration),_):a.transform(c,_),!0}}return!1}function EB(n,e){return n.forEach(t=>{const r=e.get(t.id);r&&e.set(r.id,{...r,[at]:r[at],selected:t.selected})}),new Map(e)}function CB(n,e){return e.map(t=>{const r=n.find(i=>i.id===t.id);return r&&(t.selected=r.selected),t})}function Ac({changedNodes:n,changedEdges:e,get:t,set:r}){const{nodeInternals:i,edges:s,onNodesChange:o,onEdgesChange:a,hasDefaultNodes:c,hasDefaultEdges:l}=t();n?.length&&(c&&r({nodeInternals:EB(n,i)}),o?.(n)),e?.length&&(l&&r({edges:CB(e,s)}),a?.(e))}const ps=()=>{},RB={zoomIn:ps,zoomOut:ps,zoomTo:ps,getZoom:()=>1,setViewport:ps,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:ps,fitBounds:ps,project:n=>n,screenToFlowPosition:n=>n,flowToScreenPosition:n=>n,viewportInitialized:!1},MB=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection}),PB=()=>{const n=wt(),{d3Zoom:e,d3Selection:t}=it(MB,It);return E.useMemo(()=>t&&e?{zoomIn:i=>e.scaleBy(Ci(t,i?.duration),1.2),zoomOut:i=>e.scaleBy(Ci(t,i?.duration),1/1.2),zoomTo:(i,s)=>e.scaleTo(Ci(t,s?.duration),i),getZoom:()=>n.getState().transform[2],setViewport:(i,s)=>{const[o,a,c]=n.getState().transform,l=ti.translate(i.x??o,i.y??a).scale(i.zoom??c);e.transform(Ci(t,s?.duration),l)},getViewport:()=>{const[i,s,o]=n.getState().transform;return{x:i,y:s,zoom:o}},fitView:i=>Pw(n.getState,i),setCenter:(i,s,o)=>{const{width:a,height:c,maxZoom:l}=n.getState(),u=typeof o?.zoom<"u"?o.zoom:l,d=a/2-i*u,h=c/2-s*u,f=ti.translate(d,h).scale(u);e.transform(Ci(t,o?.duration),f)},fitBounds:(i,s)=>{const{width:o,height:a,minZoom:c,maxZoom:l}=n.getState(),{x:u,y:d,zoom:h}=gw(i,o,a,c,l,s?.padding??.1),f=ti.translate(u,d).scale(h);e.transform(Ci(t,s?.duration),f)},project:i=>{const{transform:s,snapToGrid:o,snapGrid:a}=n.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),Uf(i,s,o,a)},screenToFlowPosition:i=>{const{transform:s,snapToGrid:o,snapGrid:a,domNode:c}=n.getState();if(!c)return i;const{x:l,y:u}=c.getBoundingClientRect(),d={x:i.x-l,y:i.y-u};return Uf(d,s,o,a)},flowToScreenPosition:i=>{const{transform:s,domNode:o}=n.getState();if(!o)return i;const{x:a,y:c}=o.getBoundingClientRect(),l=fw(i,s);return{x:l.x+a,y:l.y+c}},viewportInitialized:!0}:RB,[e,t])};function Fm(){const n=PB(),e=wt(),t=E.useCallback(()=>e.getState().getNodes().map(m=>({...m})),[]),r=E.useCallback(m=>e.getState().nodeInternals.get(m),[]),i=E.useCallback(()=>{const{edges:m=[]}=e.getState();return m.map(x=>({...x}))},[]),s=E.useCallback(m=>{const{edges:x=[]}=e.getState();return x.find(g=>g.id===m)},[]),o=E.useCallback(m=>{const{getNodes:x,setNodes:g,hasDefaultNodes:y,onNodesChange:v}=e.getState(),_=x(),T=typeof m=="function"?m(_):m;if(y)g(T);else if(v){const w=T.length===0?_.map(N=>({type:"remove",id:N.id})):T.map(N=>({item:N,type:"reset"}));v(w)}},[]),a=E.useCallback(m=>{const{edges:x=[],setEdges:g,hasDefaultEdges:y,onEdgesChange:v}=e.getState(),_=typeof m=="function"?m(x):m;if(y)g(_);else if(v){const T=_.length===0?x.map(w=>({type:"remove",id:w.id})):_.map(w=>({item:w,type:"reset"}));v(T)}},[]),c=E.useCallback(m=>{const x=Array.isArray(m)?m:[m],{getNodes:g,setNodes:y,hasDefaultNodes:v,onNodesChange:_}=e.getState();if(v){const w=[...g(),...x];y(w)}else if(_){const T=x.map(w=>({item:w,type:"add"}));_(T)}},[]),l=E.useCallback(m=>{const x=Array.isArray(m)?m:[m],{edges:g=[],setEdges:y,hasDefaultEdges:v,onEdgesChange:_}=e.getState();if(v)y([...g,...x]);else if(_){const T=x.map(w=>({item:w,type:"add"}));_(T)}},[]),u=E.useCallback(()=>{const{getNodes:m,edges:x=[],transform:g}=e.getState(),[y,v,_]=g;return{nodes:m().map(T=>({...T})),edges:x.map(T=>({...T})),viewport:{x:y,y:v,zoom:_}}},[]),d=E.useCallback(({nodes:m,edges:x})=>{const{nodeInternals:g,getNodes:y,edges:v,hasDefaultNodes:_,hasDefaultEdges:T,onNodesDelete:w,onEdgesDelete:N,onNodesChange:S,onEdgesChange:C}=e.getState(),B=(m||[]).map(O=>O.id),D=(x||[]).map(O=>O.id),U=y().reduce((O,k)=>{const R=k.parentNode||k.parentId,L=!B.includes(k.id)&&R&&O.find(W=>W.id===R);return(typeof k.deletable=="boolean"?k.deletable:!0)&&(B.includes(k.id)||L)&&O.push(k),O},[]),$=v.filter(O=>typeof O.deletable=="boolean"?O.deletable:!0),A=$.filter(O=>D.includes(O.id));if(U||A){const O=mw(U,$),k=[...A,...O],R=k.reduce((L,M)=>(L.includes(M.id)||L.push(M.id),L),[]);if((T||_)&&(T&&e.setState({edges:v.filter(L=>!R.includes(L.id))}),_&&(U.forEach(L=>{g.delete(L.id)}),e.setState({nodeInternals:new Map(g)}))),R.length>0&&(N?.(k),C&&C(R.map(L=>({id:L,type:"remove"})))),U.length>0&&(w?.(U),S)){const L=U.map(M=>({id:M.id,type:"remove"}));S(L)}}},[]),h=E.useCallback(m=>{const x=ZD(m),g=x?null:e.getState().nodeInternals.get(m.id);return!x&&!g?[null,null,x]:[x?m:W0(g),g,x]},[]),f=E.useCallback((m,x=!0,g)=>{const[y,v,_]=h(m);return y?(g||e.getState().getNodes()).filter(T=>{if(!_&&(T.id===v.id||!T.positionAbsolute))return!1;const w=W0(T),N=kf(w,y);return x&&N>0||N>=y.width*y.height}):[]},[]),p=E.useCallback((m,x,g=!0)=>{const[y]=h(m);if(!y)return!1;const v=kf(y,x);return g&&v>0||v>=y.width*y.height},[]);return E.useMemo(()=>({...n,getNodes:t,getNode:r,getEdges:i,getEdge:s,setNodes:o,setEdges:a,addNodes:c,addEdges:l,toObject:u,deleteElements:d,getIntersectingNodes:f,isNodeIntersecting:p}),[n,t,r,i,s,o,a,c,l,u,d,f,p])}const DB={actInsideInputWithModifier:!1};var BB=({deleteKeyCode:n,multiSelectionKeyCode:e})=>{const t=wt(),{deleteElements:r}=Fm(),i=Ga(n,DB),s=Ga(e);E.useEffect(()=>{if(i){const{edges:o,getNodes:a}=t.getState(),c=a().filter(u=>u.selected),l=o.filter(u=>u.selected);r({nodes:c,edges:l}),t.setState({nodesSelectionActive:!1})}},[i]),E.useEffect(()=>{t.setState({multiSelectionActive:s})},[s])};function FB(n){const e=wt();E.useEffect(()=>{let t;const r=()=>{if(!n.current)return;const i=Sm(n.current);(i.height===0||i.width===0)&&e.getState().onError?.("004",Dr.error004()),e.setState({width:i.width||500,height:i.height||500})};return r(),window.addEventListener("resize",r),n.current&&(t=new ResizeObserver(()=>r()),t.observe(n.current)),()=>{window.removeEventListener("resize",r),t&&n.current&&t.unobserve(n.current)}},[])}const km={position:"absolute",width:"100%",height:"100%",top:0,left:0},kB=(n,e)=>n.x!==e.x||n.y!==e.y||n.zoom!==e.k,Ec=n=>({x:n.x,y:n.y,zoom:n.k}),ms=(n,e)=>n.target.closest(`.${e}`),nx=(n,e)=>e===2&&Array.isArray(n)&&n.includes(2),rx=n=>{const e=n.ctrlKey&&Jl()?10:1;return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*e},LB=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection,d3ZoomHandler:n.d3ZoomHandler,userSelectionActive:n.userSelectionActive}),IB=({onMove:n,onMoveStart:e,onMoveEnd:t,onPaneContextMenu:r,zoomOnScroll:i=!0,zoomOnPinch:s=!0,panOnScroll:o=!1,panOnScrollSpeed:a=.5,panOnScrollMode:c=Vi.Free,zoomOnDoubleClick:l=!0,elementsSelectable:u,panOnDrag:d=!0,defaultViewport:h,translateExtent:f,minZoom:p,maxZoom:m,zoomActivationKeyCode:x,preventScrolling:g=!0,children:y,noWheelClassName:v,noPanClassName:_})=>{const T=E.useRef(),w=wt(),N=E.useRef(!1),S=E.useRef(!1),C=E.useRef(null),B=E.useRef({x:0,y:0,zoom:0}),{d3Zoom:D,d3Selection:U,d3ZoomHandler:$,userSelectionActive:A}=it(LB,It),O=Ga(x),k=E.useRef(0),R=E.useRef(!1),L=E.useRef();return FB(C),E.useEffect(()=>{if(C.current){const M=C.current.getBoundingClientRect(),W=tw().scaleExtent([p,m]).translateExtent(f),I=gt(C.current).call(W),j=ti.translate(h.x,h.y).scale(io(h.zoom,p,m)),Z=[[0,0],[M.width,M.height]],ee=W.constrain()(j,Z,f);W.transform(I,ee),W.wheelDelta(rx),w.setState({d3Zoom:W,d3Selection:I,d3ZoomHandler:I.on("wheel.zoom"),transform:[ee.x,ee.y,ee.k],domNode:C.current.closest(".react-flow")})}},[]),E.useEffect(()=>{U&&D&&(o&&!O&&!A?U.on("wheel.zoom",M=>{if(ms(M,v))return!1;M.preventDefault(),M.stopImmediatePropagation();const W=U.property("__zoom").k||1;if(M.ctrlKey&&s){const ce=Nn(M),ye=rx(M),ge=W*Math.pow(2,ye);D.scaleTo(U,ge,ce,M);return}const I=M.deltaMode===1?20:1;let j=c===Vi.Vertical?0:M.deltaX*I,Z=c===Vi.Horizontal?0:M.deltaY*I;!Jl()&&M.shiftKey&&c!==Vi.Vertical&&(j=M.deltaY*I,Z=0),D.translateBy(U,-(j/W)*a,-(Z/W)*a,{internal:!0});const ee=Ec(U.property("__zoom")),{onViewportChangeStart:V,onViewportChange:Q,onViewportChangeEnd:te}=w.getState();clearTimeout(L.current),R.current||(R.current=!0,e?.(M,ee),V?.(ee)),R.current&&(n?.(M,ee),Q?.(ee),L.current=setTimeout(()=>{t?.(M,ee),te?.(ee),R.current=!1},150))},{passive:!1}):typeof $<"u"&&U.on("wheel.zoom",function(M,W){if(!g&&M.type==="wheel"&&!M.ctrlKey||ms(M,v))return null;M.preventDefault(),$.call(this,M,W)},{passive:!1}))},[A,o,c,U,D,$,O,s,g,v,e,n,t]),E.useEffect(()=>{D&&D.on("start",M=>{if(!M.sourceEvent||M.sourceEvent.internal)return null;k.current=M.sourceEvent?.button;const{onViewportChangeStart:W}=w.getState(),I=Ec(M.transform);N.current=!0,B.current=I,M.sourceEvent?.type==="mousedown"&&w.setState({paneDragging:!0}),W?.(I),e?.(M.sourceEvent,I)})},[D,e]),E.useEffect(()=>{D&&(A&&!N.current?D.on("zoom",null):A||D.on("zoom",M=>{const{onViewportChange:W}=w.getState();if(w.setState({transform:[M.transform.x,M.transform.y,M.transform.k]}),S.current=!!(r&&nx(d,k.current??0)),(n||W)&&!M.sourceEvent?.internal){const I=Ec(M.transform);W?.(I),n?.(M.sourceEvent,I)}}))},[A,D,n,d,r]),E.useEffect(()=>{D&&D.on("end",M=>{if(!M.sourceEvent||M.sourceEvent.internal)return null;const{onViewportChangeEnd:W}=w.getState();if(N.current=!1,w.setState({paneDragging:!1}),r&&nx(d,k.current??0)&&!S.current&&r(M.sourceEvent),S.current=!1,(t||W)&&kB(B.current,M.transform)){const I=Ec(M.transform);B.current=I,clearTimeout(T.current),T.current=setTimeout(()=>{W?.(I),t?.(M.sourceEvent,I)},o?150:0)}})},[D,o,d,t,r]),E.useEffect(()=>{D&&D.filter(M=>{const W=O||i,I=s&&M.ctrlKey;if((d===!0||Array.isArray(d)&&d.includes(1))&&M.button===1&&M.type==="mousedown"&&(ms(M,"react-flow__node")||ms(M,"react-flow__edge")))return!0;if(!d&&!W&&!o&&!l&&!s||A||!l&&M.type==="dblclick"||ms(M,v)&&M.type==="wheel"||ms(M,_)&&(M.type!=="wheel"||o&&M.type==="wheel"&&!O)||!s&&M.ctrlKey&&M.type==="wheel"||!W&&!o&&!I&&M.type==="wheel"||!d&&(M.type==="mousedown"||M.type==="touchstart")||Array.isArray(d)&&!d.includes(M.button)&&M.type==="mousedown")return!1;const j=Array.isArray(d)&&d.includes(M.button)||!M.button||M.button<=1;return(!M.ctrlKey||M.type==="wheel")&&j})},[A,D,i,s,o,l,d,u,O]),K.createElement("div",{className:"react-flow__renderer",ref:C,style:km},y)},OB=n=>({userSelectionActive:n.userSelectionActive,userSelectionRect:n.userSelectionRect});function UB(){const{userSelectionActive:n,userSelectionRect:e}=it(OB,It);return n&&e?K.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}function ix(n,e){const t=e.parentNode||e.parentId,r=n.find(i=>i.id===t);if(r){const i=e.position.x+e.width-r.width,s=e.position.y+e.height-r.height;if(i>0||s>0||e.position.x<0||e.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,i>0&&(r.style.width+=i),s>0&&(r.style.height+=s),e.position.x<0){const o=Math.abs(e.position.x);r.position.x=r.position.x-o,r.style.width+=o,e.position.x=0}if(e.position.y<0){const o=Math.abs(e.position.y);r.position.y=r.position.y-o,r.style.height+=o,e.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function Dw(n,e){if(n.some(r=>r.type==="reset"))return n.filter(r=>r.type==="reset").map(r=>r.item);const t=n.filter(r=>r.type==="add").map(r=>r.item);return e.reduce((r,i)=>{const s=n.filter(a=>a.id===i.id);if(s.length===0)return r.push(i),r;const o={...i};for(const a of s)if(a)switch(a.type){case"select":{o.selected=a.selected;break}case"position":{typeof a.position<"u"&&(o.position=a.position),typeof a.positionAbsolute<"u"&&(o.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(o.dragging=a.dragging),o.expandParent&&ix(r,o);break}case"dimensions":{typeof a.dimensions<"u"&&(o.width=a.dimensions.width,o.height=a.dimensions.height),typeof a.updateStyle<"u"&&(o.style={...o.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(o.resizing=a.resizing),o.expandParent&&ix(r,o);break}case"remove":return r}return r.push(o),r},t)}function Bw(n,e){return Dw(n,e)}function VB(n,e){return Dw(n,e)}const zr=(n,e)=>({id:n,type:"select",selected:e});function Ds(n,e){return n.reduce((t,r)=>{const i=e.includes(r.id);return!r.selected&&i?(r.selected=!0,t.push(zr(r.id,!0))):r.selected&&!i&&(r.selected=!1,t.push(zr(r.id,!1))),t},[])}const Cd=(n,e)=>t=>{t.target===e.current&&n?.(t)},GB=n=>({userSelectionActive:n.userSelectionActive,elementsSelectable:n.elementsSelectable,dragging:n.paneDragging}),Fw=E.memo(({isSelecting:n,selectionMode:e=Va.Full,panOnDrag:t,onSelectionStart:r,onSelectionEnd:i,onPaneClick:s,onPaneContextMenu:o,onPaneScroll:a,onPaneMouseEnter:c,onPaneMouseMove:l,onPaneMouseLeave:u,children:d})=>{const h=E.useRef(null),f=wt(),p=E.useRef(0),m=E.useRef(0),x=E.useRef(),{userSelectionActive:g,elementsSelectable:y,dragging:v}=it(GB,It),_=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),p.current=0,m.current=0},T=$=>{s?.($),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},w=$=>{if(Array.isArray(t)&&t?.includes(2)){$.preventDefault();return}o?.($)},N=a?$=>a($):void 0,S=$=>{const{resetSelectedElements:A,domNode:O}=f.getState();if(x.current=O?.getBoundingClientRect(),!y||!n||$.button!==0||$.target!==h.current||!x.current)return;const{x:k,y:R}=ni($,x.current);A(),f.setState({userSelectionRect:{width:0,height:0,startX:k,startY:R,x:k,y:R}}),r?.($)},C=$=>{const{userSelectionRect:A,nodeInternals:O,edges:k,transform:R,onNodesChange:L,onEdgesChange:M,nodeOrigin:W,getNodes:I}=f.getState();if(!n||!x.current||!A)return;f.setState({userSelectionActive:!0,nodesSelectionActive:!1});const j=ni($,x.current),Z=A.startX??0,ee=A.startY??0,V={...A,x:j.x<Z?j.x:Z,y:j.y<ee?j.y:ee,width:Math.abs(j.x-Z),height:Math.abs(j.y-ee)},Q=I(),te=pw(O,V,R,e===Va.Partial,!0,W),ce=mw(te,k).map(ge=>ge.id),ye=te.map(ge=>ge.id);if(p.current!==ye.length){p.current=ye.length;const ge=Ds(Q,ye);ge.length&&L?.(ge)}if(m.current!==ce.length){m.current=ce.length;const ge=Ds(k,ce);ge.length&&M?.(ge)}f.setState({userSelectionRect:V})},B=$=>{if($.button!==0)return;const{userSelectionRect:A}=f.getState();!g&&A&&$.target===h.current&&T?.($),f.setState({nodesSelectionActive:p.current>0}),_(),i?.($)},D=$=>{g&&(f.setState({nodesSelectionActive:p.current>0}),i?.($)),_()},U=y&&(n||g);return K.createElement("div",{className:Ht(["react-flow__pane",{dragging:v,selection:n}]),onClick:U?void 0:Cd(T,h),onContextMenu:Cd(w,h),onWheel:Cd(N,h),onMouseEnter:U?void 0:c,onMouseDown:U?S:void 0,onMouseMove:U?C:l,onMouseUp:U?B:void 0,onMouseLeave:U?D:u,ref:h,style:km},d,K.createElement(UB,null))});Fw.displayName="Pane";function kw(n,e){const t=n.parentNode||n.parentId;if(!t)return!1;const r=e.get(t);return r?r.selected?!0:kw(r,e):!1}function sx(n,e,t){let r=n;do{if(r?.matches(e))return!0;if(r===t.current)return!1;r=r.parentElement}while(r);return!1}function $B(n,e,t,r){return Array.from(n.values()).filter(i=>(i.selected||i.id===r)&&(!i.parentNode||i.parentId||!kw(i,n))&&(i.draggable||e&&typeof i.draggable>"u")).map(i=>({id:i.id,position:i.position||{x:0,y:0},positionAbsolute:i.positionAbsolute||{x:0,y:0},distance:{x:t.x-(i.positionAbsolute?.x??0),y:t.y-(i.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:i.extent,parentNode:i.parentNode||i.parentId,parentId:i.parentNode||i.parentId,width:i.width,height:i.height,expandParent:i.expandParent}))}function jB(n,e){return!e||e==="parent"?e:[e[0],[e[1][0]-(n.width||0),e[1][1]-(n.height||0)]]}function Lw(n,e,t,r,i=[0,0],s){const o=jB(n,n.extent||r);let a=o;const c=n.parentNode||n.parentId;if(n.extent==="parent"&&!n.expandParent)if(c&&n.width&&n.height){const d=t.get(c),{x:h,y:f}=zs(d,i).positionAbsolute;a=d&&fn(h)&&fn(f)&&fn(d.width)&&fn(d.height)?[[h+n.width*i[0],f+n.height*i[1]],[h+d.width-n.width+n.width*i[0],f+d.height-n.height+n.height*i[1]]]:a}else s?.("005",Dr.error005()),a=o;else if(n.extent&&c&&n.extent!=="parent"){const d=t.get(c),{x:h,y:f}=zs(d,i).positionAbsolute;a=[[n.extent[0][0]+h,n.extent[0][1]+f],[n.extent[1][0]+h,n.extent[1][1]+f]]}let l={x:0,y:0};if(c){const d=t.get(c);l=zs(d,i).positionAbsolute}const u=a&&a!=="parent"?Nm(e,a):e;return{position:{x:u.x-l.x,y:u.y-l.y},positionAbsolute:u}}function Rd({nodeId:n,dragItems:e,nodeInternals:t}){const r=e.map(i=>({...t.get(i.id),position:i.position,positionAbsolute:i.positionAbsolute}));return[n?r.find(i=>i.id===n):r[0],r]}const ox=(n,e,t,r)=>{const i=e.querySelectorAll(n);if(!i||!i.length)return null;const s=Array.from(i),o=e.getBoundingClientRect(),a={x:o.width*r[0],y:o.height*r[1]};return s.map(c=>{const l=c.getBoundingClientRect();return{id:c.getAttribute("data-handleid"),position:c.getAttribute("data-handlepos"),x:(l.left-o.left-a.x)/t,y:(l.top-o.top-a.y)/t,...Sm(c)}})};function Oo(n,e,t){return t===void 0?t:r=>{const i=e().nodeInternals.get(n);i&&t(r,{...i})}}function Gf({id:n,store:e,unselect:t=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:s,multiSelectionActive:o,nodeInternals:a,onError:c}=e.getState(),l=a.get(n);if(!l){c?.("012",Dr.error012(n));return}e.setState({nodesSelectionActive:!1}),l.selected?(t||l.selected&&o)&&(s({nodes:[l],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):i([n])}function zB(){const n=wt();return E.useCallback(({sourceEvent:t})=>{const{transform:r,snapGrid:i,snapToGrid:s}=n.getState(),o=t.touches?t.touches[0].clientX:t.clientX,a=t.touches?t.touches[0].clientY:t.clientY,c={x:(o-r[0])/r[2],y:(a-r[1])/r[2]};return{xSnapped:s?i[0]*Math.round(c.x/i[0]):c.x,ySnapped:s?i[1]*Math.round(c.y/i[1]):c.y,...c}},[])}function Md(n){return(e,t,r)=>n?.(e,r)}function Iw({nodeRef:n,disabled:e=!1,noDragClassName:t,handleSelector:r,nodeId:i,isSelectable:s,selectNodesOnDrag:o}){const a=wt(),[c,l]=E.useState(!1),u=E.useRef([]),d=E.useRef({x:null,y:null}),h=E.useRef(0),f=E.useRef(null),p=E.useRef({x:0,y:0}),m=E.useRef(null),x=E.useRef(!1),g=E.useRef(!1),y=E.useRef(!1),v=zB();return E.useEffect(()=>{if(n?.current){const _=gt(n.current),T=({x:S,y:C})=>{const{nodeInternals:B,onNodeDrag:D,onSelectionDrag:U,updateNodePositions:$,nodeExtent:A,snapGrid:O,snapToGrid:k,nodeOrigin:R,onError:L}=a.getState();d.current={x:S,y:C};let M=!1,W={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&A){const j=Pm(u.current,R);W=Am(j)}if(u.current=u.current.map(j=>{const Z={x:S-j.distance.x,y:C-j.distance.y};k&&(Z.x=O[0]*Math.round(Z.x/O[0]),Z.y=O[1]*Math.round(Z.y/O[1]));const ee=[[A[0][0],A[0][1]],[A[1][0],A[1][1]]];u.current.length>1&&A&&!j.extent&&(ee[0][0]=j.positionAbsolute.x-W.x+A[0][0],ee[1][0]=j.positionAbsolute.x+(j.width??0)-W.x2+A[1][0],ee[0][1]=j.positionAbsolute.y-W.y+A[0][1],ee[1][1]=j.positionAbsolute.y+(j.height??0)-W.y2+A[1][1]);const V=Lw(j,Z,B,ee,R,L);return M=M||j.position.x!==V.position.x||j.position.y!==V.position.y,j.position=V.position,j.positionAbsolute=V.positionAbsolute,j}),!M)return;$(u.current,!0,!0),l(!0);const I=i?D:Md(U);if(I&&m.current){const[j,Z]=Rd({nodeId:i,dragItems:u.current,nodeInternals:B});I(m.current,j,Z)}},w=()=>{if(!f.current)return;const[S,C]=iw(p.current,f.current);if(S!==0||C!==0){const{transform:B,panBy:D}=a.getState();d.current.x=(d.current.x??0)-S/B[2],d.current.y=(d.current.y??0)-C/B[2],D({x:S,y:C})&&T(d.current)}h.current=requestAnimationFrame(w)},N=S=>{const{nodeInternals:C,multiSelectionActive:B,nodesDraggable:D,unselectNodesAndEdges:U,onNodeDragStart:$,onSelectionDragStart:A}=a.getState();g.current=!0;const O=i?$:Md(A);(!o||!s)&&!B&&i&&(C.get(i)?.selected||U()),i&&s&&o&&Gf({id:i,store:a,nodeRef:n});const k=v(S);if(d.current=k,u.current=$B(C,D,k,i),O&&u.current){const[R,L]=Rd({nodeId:i,dragItems:u.current,nodeInternals:C});O(S.sourceEvent,R,L)}};if(e)_.on(".drag",null);else{const S=K3().on("start",C=>{const{domNode:B,nodeDragThreshold:D}=a.getState();D===0&&N(C),y.current=!1;const U=v(C);d.current=U,f.current=B?.getBoundingClientRect()||null,p.current=ni(C.sourceEvent,f.current)}).on("drag",C=>{const B=v(C),{autoPanOnNodeDrag:D,nodeDragThreshold:U}=a.getState();if(C.sourceEvent.type==="touchmove"&&C.sourceEvent.touches.length>1&&(y.current=!0),!y.current){if(!x.current&&g.current&&D&&(x.current=!0,w()),!g.current){const $=B.xSnapped-(d?.current?.x??0),A=B.ySnapped-(d?.current?.y??0);Math.sqrt($*$+A*A)>U&&N(C)}(d.current.x!==B.xSnapped||d.current.y!==B.ySnapped)&&u.current&&g.current&&(m.current=C.sourceEvent,p.current=ni(C.sourceEvent,f.current),T(B))}}).on("end",C=>{if(!(!g.current||y.current)&&(l(!1),x.current=!1,g.current=!1,cancelAnimationFrame(h.current),u.current)){const{updateNodePositions:B,nodeInternals:D,onNodeDragStop:U,onSelectionDragStop:$}=a.getState(),A=i?U:Md($);if(B(u.current,!1,!1),A){const[O,k]=Rd({nodeId:i,dragItems:u.current,nodeInternals:D});A(C.sourceEvent,O,k)}}}).filter(C=>{const B=C.target;return!C.button&&(!t||!sx(B,`.${t}`,n))&&(!r||sx(B,r,n))});return _.call(S),()=>{_.on(".drag",null)}}}},[n,e,t,r,s,a,i,o,v]),c}function Ow(){const n=wt();return E.useCallback(t=>{const{nodeInternals:r,nodeExtent:i,updateNodePositions:s,getNodes:o,snapToGrid:a,snapGrid:c,onError:l,nodesDraggable:u}=n.getState(),d=o().filter(y=>y.selected&&(y.draggable||u&&typeof y.draggable>"u")),h=a?c[0]:5,f=a?c[1]:5,p=t.isShiftPressed?4:1,m=t.x*h*p,x=t.y*f*p,g=d.map(y=>{if(y.positionAbsolute){const v={x:y.positionAbsolute.x+m,y:y.positionAbsolute.y+x};a&&(v.x=c[0]*Math.round(v.x/c[0]),v.y=c[1]*Math.round(v.y/c[1]));const{positionAbsolute:_,position:T}=Lw(y,v,r,i,void 0,l);y.position=T,y.positionAbsolute=_}return y});s(g,!0,!1)},[])}const Hs={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Uo=n=>{const e=({id:t,type:r,data:i,xPos:s,yPos:o,xPosOrigin:a,yPosOrigin:c,selected:l,onClick:u,onMouseEnter:d,onMouseMove:h,onMouseLeave:f,onContextMenu:p,onDoubleClick:m,style:x,className:g,isDraggable:y,isSelectable:v,isConnectable:_,isFocusable:T,selectNodesOnDrag:w,sourcePosition:N,targetPosition:S,hidden:C,resizeObserver:B,dragHandle:D,zIndex:U,isParent:$,noDragClassName:A,noPanClassName:O,initialized:k,disableKeyboardA11y:R,ariaLabel:L,rfId:M,hasHandleBounds:W})=>{const I=wt(),j=E.useRef(null),Z=E.useRef(null),ee=E.useRef(N),V=E.useRef(S),Q=E.useRef(r),te=v||y||u||d||h||f,ce=Ow(),ye=Oo(t,I.getState,d),ge=Oo(t,I.getState,h),Re=Oo(t,I.getState,f),nt=Oo(t,I.getState,p),yt=Oo(t,I.getState,m),ct=Me=>{const{nodeDragThreshold:ue}=I.getState();if(v&&(!w||!y||ue>0)&&Gf({id:t,store:I,nodeRef:j}),u){const en=I.getState().nodeInternals.get(t);en&&u(Me,{...en})}},ze=Me=>{if(!Lf(Me)&&!R)if(ow.includes(Me.key)&&v){const ue=Me.key==="Escape";Gf({id:t,store:I,unselect:ue,nodeRef:j})}else y&&l&&Object.prototype.hasOwnProperty.call(Hs,Me.key)&&(I.setState({ariaLiveMessage:`Moved selected node ${Me.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~o}`}),ce({x:Hs[Me.key].x,y:Hs[Me.key].y,isShiftPressed:Me.shiftKey}))};E.useEffect(()=>()=>{Z.current&&(B?.unobserve(Z.current),Z.current=null)},[]),E.useEffect(()=>{if(j.current&&!C){const Me=j.current;(!k||!W||Z.current!==Me)&&(Z.current&&B?.unobserve(Z.current),B?.observe(Me),Z.current=Me)}},[C,k,W]),E.useEffect(()=>{const Me=Q.current!==r,ue=ee.current!==N,en=V.current!==S;j.current&&(Me||ue||en)&&(Me&&(Q.current=r),ue&&(ee.current=N),en&&(V.current=S),I.getState().updateNodeDimensions([{id:t,nodeElement:j.current,forceUpdate:!0}]))},[t,r,N,S]);const St=Iw({nodeRef:j,disabled:C||!y,noDragClassName:A,handleSelector:D,nodeId:t,isSelectable:v,selectNodesOnDrag:w});return C?null:K.createElement("div",{className:Ht(["react-flow__node",`react-flow__node-${r}`,{[O]:y},g,{selected:l,selectable:v,parent:$,dragging:St}]),ref:j,style:{zIndex:U,transform:`translate(${a}px,${c}px)`,pointerEvents:te?"all":"none",visibility:k?"visible":"hidden",...x},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:ye,onMouseMove:ge,onMouseLeave:Re,onContextMenu:nt,onClick:ct,onDoubleClick:yt,onKeyDown:T?ze:void 0,tabIndex:T?0:void 0,role:T?"button":void 0,"aria-describedby":R?void 0:`${Ew}-${M}`,"aria-label":L},K.createElement(sB,{value:t},K.createElement(n,{id:t,data:i,type:r,xPos:s,yPos:o,selected:l,isConnectable:_,sourcePosition:N,targetPosition:S,dragging:St,dragHandle:D,zIndex:U})))};return e.displayName="NodeWrapper",E.memo(e)};const HB=n=>{const e=n.getNodes().filter(t=>t.selected);return{...Pm(e,n.nodeOrigin),transformString:`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`,userSelectionActive:n.userSelectionActive}};function WB({onSelectionContextMenu:n,noPanClassName:e,disableKeyboardA11y:t}){const r=wt(),{width:i,height:s,x:o,y:a,transformString:c,userSelectionActive:l}=it(HB,It),u=Ow(),d=E.useRef(null);if(E.useEffect(()=>{t||d.current?.focus({preventScroll:!0})},[t]),Iw({nodeRef:d}),l||!i||!s)return null;const h=n?p=>{const m=r.getState().getNodes().filter(x=>x.selected);n(p,m)}:void 0,f=p=>{Object.prototype.hasOwnProperty.call(Hs,p.key)&&u({x:Hs[p.key].x,y:Hs[p.key].y,isShiftPressed:p.shiftKey})};return K.createElement("div",{className:Ht(["react-flow__nodesselection","react-flow__container",e]),style:{transform:c}},K.createElement("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:t?void 0:-1,onKeyDown:t?void 0:f,style:{width:i,height:s,top:a,left:o}}))}var qB=E.memo(WB);const XB=n=>n.nodesSelectionActive,Uw=({children:n,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:o,deleteKeyCode:a,onMove:c,onMoveStart:l,onMoveEnd:u,selectionKeyCode:d,selectionOnDrag:h,selectionMode:f,onSelectionStart:p,onSelectionEnd:m,multiSelectionKeyCode:x,panActivationKeyCode:g,zoomActivationKeyCode:y,elementsSelectable:v,zoomOnScroll:_,zoomOnPinch:T,panOnScroll:w,panOnScrollSpeed:N,panOnScrollMode:S,zoomOnDoubleClick:C,panOnDrag:B,defaultViewport:D,translateExtent:U,minZoom:$,maxZoom:A,preventScrolling:O,onSelectionContextMenu:k,noWheelClassName:R,noPanClassName:L,disableKeyboardA11y:M})=>{const W=it(XB),I=Ga(d),j=Ga(g),Z=j||B,ee=j||w,V=I||h&&Z!==!0;return BB({deleteKeyCode:a,multiSelectionKeyCode:x}),K.createElement(IB,{onMove:c,onMoveStart:l,onMoveEnd:u,onPaneContextMenu:s,elementsSelectable:v,zoomOnScroll:_,zoomOnPinch:T,panOnScroll:ee,panOnScrollSpeed:N,panOnScrollMode:S,zoomOnDoubleClick:C,panOnDrag:!I&&Z,defaultViewport:D,translateExtent:U,minZoom:$,maxZoom:A,zoomActivationKeyCode:y,preventScrolling:O,noWheelClassName:R,noPanClassName:L},K.createElement(Fw,{onSelectionStart:p,onSelectionEnd:m,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:o,panOnDrag:Z,isSelecting:!!V,selectionMode:f},n,W&&K.createElement(qB,{onSelectionContextMenu:k,noPanClassName:L,disableKeyboardA11y:M})))};Uw.displayName="FlowRenderer";var KB=E.memo(Uw);function YB(n){return it(E.useCallback(t=>n?pw(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[n]))}function QB(n){const e={input:Uo(n.input||ww),default:Uo(n.default||Vf),output:Uo(n.output||Nw),group:Uo(n.group||Bm)},t={},r=Object.keys(n).filter(i=>!["input","default","output","group"].includes(i)).reduce((i,s)=>(i[s]=Uo(n[s]||Vf),i),t);return{...e,...r}}const ZB=({x:n,y:e,width:t,height:r,origin:i})=>!t||!r?{x:n,y:e}:i[0]<0||i[1]<0||i[0]>1||i[1]>1?{x:n,y:e}:{x:n-t*i[0],y:e-r*i[1]},JB=n=>({nodesDraggable:n.nodesDraggable,nodesConnectable:n.nodesConnectable,nodesFocusable:n.nodesFocusable,elementsSelectable:n.elementsSelectable,updateNodeDimensions:n.updateNodeDimensions,onError:n.onError}),Vw=n=>{const{nodesDraggable:e,nodesConnectable:t,nodesFocusable:r,elementsSelectable:i,updateNodeDimensions:s,onError:o}=it(JB,It),a=YB(n.onlyRenderVisibleElements),c=E.useRef(),l=E.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const u=new ResizeObserver(d=>{const h=d.map(f=>({id:f.target.getAttribute("data-id"),nodeElement:f.target,forceUpdate:!0}));s(h)});return c.current=u,u},[]);return E.useEffect(()=>()=>{c?.current?.disconnect()},[]),K.createElement("div",{className:"react-flow__nodes",style:km},a.map(u=>{let d=u.type||"default";n.nodeTypes[d]||(o?.("003",Dr.error003(d)),d="default");const h=n.nodeTypes[d]||n.nodeTypes.default,f=!!(u.draggable||e&&typeof u.draggable>"u"),p=!!(u.selectable||i&&typeof u.selectable>"u"),m=!!(u.connectable||t&&typeof u.connectable>"u"),x=!!(u.focusable||r&&typeof u.focusable>"u"),g=n.nodeExtent?Nm(u.positionAbsolute,n.nodeExtent):u.positionAbsolute,y=g?.x??0,v=g?.y??0,_=ZB({x:y,y:v,width:u.width??0,height:u.height??0,origin:n.nodeOrigin});return K.createElement(h,{key:u.id,id:u.id,className:u.className,style:u.style,type:d,data:u.data,sourcePosition:u.sourcePosition||he.Bottom,targetPosition:u.targetPosition||he.Top,hidden:u.hidden,xPos:y,yPos:v,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:n.selectNodesOnDrag,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,selected:!!u.selected,isDraggable:f,isSelectable:p,isConnectable:m,isFocusable:x,resizeObserver:l,dragHandle:u.dragHandle,zIndex:u[at]?.z??0,isParent:!!u[at]?.isParent,noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,initialized:!!u.width&&!!u.height,rfId:n.rfId,disableKeyboardA11y:n.disableKeyboardA11y,ariaLabel:u.ariaLabel,hasHandleBounds:!!u[at]?.handleBounds})}))};Vw.displayName="NodeRenderer";var eF=E.memo(Vw);const tF=(n,e,t)=>t===he.Left?n-e:t===he.Right?n+e:n,nF=(n,e,t)=>t===he.Top?n-e:t===he.Bottom?n+e:n,ax="react-flow__edgeupdater",cx=({position:n,centerX:e,centerY:t,radius:r=10,onMouseDown:i,onMouseEnter:s,onMouseOut:o,type:a})=>K.createElement("circle",{onMouseDown:i,onMouseEnter:s,onMouseOut:o,className:Ht([ax,`${ax}-${a}`]),cx:tF(e,r,n),cy:nF(t,r,n),r,stroke:"transparent",fill:"transparent"}),rF=()=>!0;var gs=n=>{const e=({id:t,className:r,type:i,data:s,onClick:o,onEdgeDoubleClick:a,selected:c,animated:l,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,style:x,source:g,target:y,sourceX:v,sourceY:_,targetX:T,targetY:w,sourcePosition:N,targetPosition:S,elementsSelectable:C,hidden:B,sourceHandleId:D,targetHandleId:U,onContextMenu:$,onMouseEnter:A,onMouseMove:O,onMouseLeave:k,reconnectRadius:R,onReconnect:L,onReconnectStart:M,onReconnectEnd:W,markerEnd:I,markerStart:j,rfId:Z,ariaLabel:ee,isFocusable:V,isReconnectable:Q,pathOptions:te,interactionWidth:ce,disableKeyboardA11y:ye})=>{const ge=E.useRef(null),[Re,nt]=E.useState(!1),[yt,ct]=E.useState(!1),ze=wt(),St=E.useMemo(()=>`url('#${Of(j,Z)}')`,[j,Z]),Me=E.useMemo(()=>`url('#${Of(I,Z)}')`,[I,Z]);if(B)return null;const ue=Pt=>{const{edges:Vn,addSelectedEdges:bi,unselectNodesAndEdges:vi,multiSelectionActive:hs}=ze.getState(),Gn=Vn.find(_i=>_i.id===t);Gn&&(C&&(ze.setState({nodesSelectionActive:!1}),Gn.selected&&hs?(vi({nodes:[],edges:[Gn]}),ge.current?.blur()):bi([t])),o&&o(Pt,Gn))},en=Io(t,ze.getState,a),gi=Io(t,ze.getState,$),Do=Io(t,ze.getState,A),as=Io(t,ze.getState,O),cs=Io(t,ze.getState,k),ur=(Pt,Vn)=>{if(Pt.button!==0)return;const{edges:bi,isValidConnection:vi}=ze.getState(),hs=Vn?y:g,Gn=(Vn?U:D)||null,_i=Vn?"target":"source",yd=vi||rF,bd=Vn,Fo=bi.find(Ti=>Ti.id===t);ct(!0),M?.(Pt,Fo,_i);const vd=Ti=>{ct(!1),W?.(Ti,Fo,_i)};bw({event:Pt,handleId:Gn,nodeId:hs,onConnect:Ti=>L?.(Fo,Ti),isTarget:bd,getState:ze.getState,setState:ze.setState,isValidConnection:yd,edgeUpdaterType:_i,onReconnectEnd:vd})},ls=Pt=>ur(Pt,!0),xi=Pt=>ur(Pt,!1),yi=()=>nt(!0),us=()=>nt(!1),ds=!C&&!o,Bo=Pt=>{if(!ye&&ow.includes(Pt.key)&&C){const{unselectNodesAndEdges:Vn,addSelectedEdges:bi,edges:vi}=ze.getState();Pt.key==="Escape"?(ge.current?.blur(),Vn({edges:[vi.find(Gn=>Gn.id===t)]})):bi([t])}};return K.createElement("g",{className:Ht(["react-flow__edge",`react-flow__edge-${i}`,r,{selected:c,animated:l,inactive:ds,updating:Re}]),onClick:ue,onDoubleClick:en,onContextMenu:gi,onMouseEnter:Do,onMouseMove:as,onMouseLeave:cs,onKeyDown:V?Bo:void 0,tabIndex:V?0:void 0,role:V?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":ee===null?void 0:ee||`Edge from ${g} to ${y}`,"aria-describedby":V?`${Cw}-${Z}`:void 0,ref:ge},!yt&&K.createElement(n,{id:t,source:g,target:y,selected:c,animated:l,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,data:s,style:x,sourceX:v,sourceY:_,targetX:T,targetY:w,sourcePosition:N,targetPosition:S,sourceHandleId:D,targetHandleId:U,markerStart:St,markerEnd:Me,pathOptions:te,interactionWidth:ce}),Q&&K.createElement(K.Fragment,null,(Q==="source"||Q===!0)&&K.createElement(cx,{position:N,centerX:v,centerY:_,radius:R,onMouseDown:ls,onMouseEnter:yi,onMouseOut:us,type:"source"}),(Q==="target"||Q===!0)&&K.createElement(cx,{position:S,centerX:T,centerY:w,radius:R,onMouseDown:xi,onMouseEnter:yi,onMouseOut:us,type:"target"})))};return e.displayName="EdgeWrapper",E.memo(e)};function iF(n){const e={default:gs(n.default||tu),straight:gs(n.bezier||Rm),step:gs(n.step||Cm),smoothstep:gs(n.step||$u),simplebezier:gs(n.simplebezier||Em)},t={},r=Object.keys(n).filter(i=>!["default","bezier"].includes(i)).reduce((i,s)=>(i[s]=gs(n[s]||tu),i),t);return{...e,...r}}function lx(n,e,t=null){const r=(t?.x||0)+e.x,i=(t?.y||0)+e.y,s=t?.width||e.width,o=t?.height||e.height;switch(n){case he.Top:return{x:r+s/2,y:i};case he.Right:return{x:r+s,y:i+o/2};case he.Bottom:return{x:r+s/2,y:i+o};case he.Left:return{x:r,y:i+o/2}}}function ux(n,e){return n?n.length===1||!e?n[0]:e&&n.find(t=>t.id===e)||null:null}const sF=(n,e,t,r,i,s)=>{const o=lx(t,n,e),a=lx(s,r,i);return{sourceX:o.x,sourceY:o.y,targetX:a.x,targetY:a.y}};function oF({sourcePos:n,targetPos:e,sourceWidth:t,sourceHeight:r,targetWidth:i,targetHeight:s,width:o,height:a,transform:c}){const l={x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x+t,e.x+i),y2:Math.max(n.y+r,e.y+s)};l.x===l.x2&&(l.x2+=1),l.y===l.y2&&(l.y2+=1);const u=Am({x:(0-c[0])/c[2],y:(0-c[1])/c[2],width:o/c[2],height:a/c[2]}),d=Math.max(0,Math.min(u.x2,l.x2)-Math.max(u.x,l.x)),h=Math.max(0,Math.min(u.y2,l.y2)-Math.max(u.y,l.y));return Math.ceil(d*h)>0}function dx(n){const e=n?.[at]?.handleBounds||null,t=e&&n?.width&&n?.height&&typeof n?.positionAbsolute?.x<"u"&&typeof n?.positionAbsolute?.y<"u";return[{x:n?.positionAbsolute?.x||0,y:n?.positionAbsolute?.y||0,width:n?.width||0,height:n?.height||0},e,!!t]}const aF=[{level:0,isMaxLevel:!0,edges:[]}];function cF(n,e,t=!1){let r=-1;const i=n.reduce((o,a)=>{const c=fn(a.zIndex);let l=c?a.zIndex:0;if(t){const u=e.get(a.target),d=e.get(a.source),h=a.selected||u?.selected||d?.selected,f=Math.max(d?.[at]?.z||0,u?.[at]?.z||0,1e3);l=(c?a.zIndex:0)+(h?f:0)}return o[l]?o[l].push(a):o[l]=[a],r=l>r?l:r,o},{}),s=Object.entries(i).map(([o,a])=>{const c=+o;return{edges:a,level:c,isMaxLevel:c===r}});return s.length===0?aF:s}function lF(n,e,t){const r=it(E.useCallback(i=>n?i.edges.filter(s=>{const o=e.get(s.source),a=e.get(s.target);return o?.width&&o?.height&&a?.width&&a?.height&&oF({sourcePos:o.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:o.width,sourceHeight:o.height,targetWidth:a.width,targetHeight:a.height,width:i.width,height:i.height,transform:i.transform})}):i.edges,[n,e]));return cF(r,e,t)}const uF=({color:n="none",strokeWidth:e=1})=>K.createElement("polyline",{style:{stroke:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),dF=({color:n="none",strokeWidth:e=1})=>K.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),hx={[eu.Arrow]:uF,[eu.ArrowClosed]:dF};function hF(n){const e=wt();return E.useMemo(()=>Object.prototype.hasOwnProperty.call(hx,n)?hx[n]:(e.getState().onError?.("009",Dr.error009(n)),null),[n])}const fF=({id:n,type:e,color:t,width:r=12.5,height:i=12.5,markerUnits:s="strokeWidth",strokeWidth:o,orient:a="auto-start-reverse"})=>{const c=hF(e);return c?K.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0"},K.createElement(c,{color:t,strokeWidth:o})):null},pF=({defaultColor:n,rfId:e})=>t=>{const r=[];return t.edges.reduce((i,s)=>([s.markerStart,s.markerEnd].forEach(o=>{if(o&&typeof o=="object"){const a=Of(o,e);r.includes(a)||(i.push({id:a,color:o.color||n,...o}),r.push(a))}}),i),[]).sort((i,s)=>i.id.localeCompare(s.id))},Gw=({defaultColor:n,rfId:e})=>{const t=it(E.useCallback(pF({defaultColor:n,rfId:e}),[n,e]),(r,i)=>!(r.length!==i.length||r.some((s,o)=>s.id!==i[o].id)));return K.createElement("defs",null,t.map(r=>K.createElement(fF,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient})))};Gw.displayName="MarkerDefinitions";var mF=E.memo(Gw);const gF=n=>({nodesConnectable:n.nodesConnectable,edgesFocusable:n.edgesFocusable,edgesUpdatable:n.edgesUpdatable,elementsSelectable:n.elementsSelectable,width:n.width,height:n.height,connectionMode:n.connectionMode,nodeInternals:n.nodeInternals,onError:n.onError}),$w=({defaultMarkerColor:n,onlyRenderVisibleElements:e,elevateEdgesOnSelect:t,rfId:r,edgeTypes:i,noPanClassName:s,onEdgeContextMenu:o,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:l,onEdgeClick:u,onEdgeDoubleClick:d,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,reconnectRadius:m,children:x,disableKeyboardA11y:g})=>{const{edgesFocusable:y,edgesUpdatable:v,elementsSelectable:_,width:T,height:w,connectionMode:N,nodeInternals:S,onError:C}=it(gF,It),B=lF(e,S,t);return T?K.createElement(K.Fragment,null,B.map(({level:D,edges:U,isMaxLevel:$})=>K.createElement("svg",{key:D,style:{zIndex:D},width:T,height:w,className:"react-flow__edges react-flow__container"},$&&K.createElement(mF,{defaultColor:n,rfId:r}),K.createElement("g",null,U.map(A=>{const[O,k,R]=dx(S.get(A.source)),[L,M,W]=dx(S.get(A.target));if(!R||!W)return null;let I=A.type||"default";i[I]||(C?.("011",Dr.error011(I)),I="default");const j=i[I]||i.default,Z=N===rs.Strict?M.target:(M.target??[]).concat(M.source??[]),ee=ux(k.source,A.sourceHandle),V=ux(Z,A.targetHandle),Q=ee?.position||he.Bottom,te=V?.position||he.Top,ce=!!(A.focusable||y&&typeof A.focusable>"u"),ye=A.reconnectable||A.updatable,ge=typeof h<"u"&&(ye||v&&typeof ye>"u");if(!ee||!V)return C?.("008",Dr.error008(ee,A)),null;const{sourceX:Re,sourceY:nt,targetX:yt,targetY:ct}=sF(O,ee,Q,L,V,te);return K.createElement(j,{key:A.id,id:A.id,className:Ht([A.className,s]),type:I,data:A.data,selected:!!A.selected,animated:!!A.animated,hidden:!!A.hidden,label:A.label,labelStyle:A.labelStyle,labelShowBg:A.labelShowBg,labelBgStyle:A.labelBgStyle,labelBgPadding:A.labelBgPadding,labelBgBorderRadius:A.labelBgBorderRadius,style:A.style,source:A.source,target:A.target,sourceHandleId:A.sourceHandle,targetHandleId:A.targetHandle,markerEnd:A.markerEnd,markerStart:A.markerStart,sourceX:Re,sourceY:nt,targetX:yt,targetY:ct,sourcePosition:Q,targetPosition:te,elementsSelectable:_,onContextMenu:o,onMouseEnter:a,onMouseMove:c,onMouseLeave:l,onClick:u,onEdgeDoubleClick:d,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,reconnectRadius:m,rfId:r,ariaLabel:A.ariaLabel,isFocusable:ce,isReconnectable:ge,pathOptions:"pathOptions"in A?A.pathOptions:void 0,interactionWidth:A.interactionWidth,disableKeyboardA11y:g})})))),x):null};$w.displayName="EdgeRenderer";var xF=E.memo($w);const yF=n=>`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`;function bF({children:n}){const e=it(yF);return K.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:e}},n)}function vF(n){const e=Fm(),t=E.useRef(!1);E.useEffect(()=>{!t.current&&e.viewportInitialized&&n&&(setTimeout(()=>n(e),1),t.current=!0)},[n,e.viewportInitialized])}const _F={[he.Left]:he.Right,[he.Right]:he.Left,[he.Top]:he.Bottom,[he.Bottom]:he.Top},jw=({nodeId:n,handleType:e,style:t,type:r=Wr.Bezier,CustomComponent:i,connectionStatus:s})=>{const{fromNode:o,handleId:a,toX:c,toY:l,connectionMode:u}=it(E.useCallback(w=>({fromNode:w.nodeInternals.get(n),handleId:w.connectionHandleId,toX:(w.connectionPosition.x-w.transform[0])/w.transform[2],toY:(w.connectionPosition.y-w.transform[1])/w.transform[2],connectionMode:w.connectionMode}),[n]),It),d=o?.[at]?.handleBounds;let h=d?.[e];if(u===rs.Loose&&(h=h||d?.[e==="source"?"target":"source"]),!o||!h)return null;const f=a?h.find(w=>w.id===a):h[0],p=f?f.x+f.width/2:(o.width??0)/2,m=f?f.y+f.height/2:o.height??0,x=(o.positionAbsolute?.x??0)+p,g=(o.positionAbsolute?.y??0)+m,y=f?.position,v=y?_F[y]:null;if(!y||!v)return null;if(i)return K.createElement(i,{connectionLineType:r,connectionLineStyle:t,fromNode:o,fromHandle:f,fromX:x,fromY:g,toX:c,toY:l,fromPosition:y,toPosition:v,connectionStatus:s});let _="";const T={sourceX:x,sourceY:g,sourcePosition:y,targetX:c,targetY:l,targetPosition:v};return r===Wr.Bezier?[_]=dw(T):r===Wr.Step?[_]=If({...T,borderRadius:0}):r===Wr.SmoothStep?[_]=If(T):r===Wr.SimpleBezier?[_]=uw(T):_=`M${x},${g} ${c},${l}`,K.createElement("path",{d:_,fill:"none",className:"react-flow__connection-path",style:t})};jw.displayName="ConnectionLine";const TF=n=>({nodeId:n.connectionNodeId,handleType:n.connectionHandleType,nodesConnectable:n.nodesConnectable,connectionStatus:n.connectionStatus,width:n.width,height:n.height});function wF({containerStyle:n,style:e,type:t,component:r}){const{nodeId:i,handleType:s,nodesConnectable:o,width:a,height:c,connectionStatus:l}=it(TF,It);return!(i&&s&&a&&o)?null:K.createElement("svg",{style:n,width:a,height:c,className:"react-flow__edges react-flow__connectionline react-flow__container"},K.createElement("g",{className:Ht(["react-flow__connection",l])},K.createElement(jw,{nodeId:i,handleType:s,style:e,type:t,CustomComponent:r,connectionStatus:l})))}function fx(n,e){return E.useRef(null),wt(),E.useMemo(()=>e(n),[n])}const zw=({nodeTypes:n,edgeTypes:e,onMove:t,onMoveStart:r,onMoveEnd:i,onInit:s,onNodeClick:o,onEdgeClick:a,onNodeDoubleClick:c,onEdgeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:f,onSelectionContextMenu:p,onSelectionStart:m,onSelectionEnd:x,connectionLineType:g,connectionLineStyle:y,connectionLineComponent:v,connectionLineContainerStyle:_,selectionKeyCode:T,selectionOnDrag:w,selectionMode:N,multiSelectionKeyCode:S,panActivationKeyCode:C,zoomActivationKeyCode:B,deleteKeyCode:D,onlyRenderVisibleElements:U,elementsSelectable:$,selectNodesOnDrag:A,defaultViewport:O,translateExtent:k,minZoom:R,maxZoom:L,preventScrolling:M,defaultMarkerColor:W,zoomOnScroll:I,zoomOnPinch:j,panOnScroll:Z,panOnScrollSpeed:ee,panOnScrollMode:V,zoomOnDoubleClick:Q,panOnDrag:te,onPaneClick:ce,onPaneMouseEnter:ye,onPaneMouseMove:ge,onPaneMouseLeave:Re,onPaneScroll:nt,onPaneContextMenu:yt,onEdgeContextMenu:ct,onEdgeMouseEnter:ze,onEdgeMouseMove:St,onEdgeMouseLeave:Me,onReconnect:ue,onReconnectStart:en,onReconnectEnd:gi,reconnectRadius:Do,noDragClassName:as,noWheelClassName:cs,noPanClassName:ur,elevateEdgesOnSelect:ls,disableKeyboardA11y:xi,nodeOrigin:yi,nodeExtent:us,rfId:ds})=>{const Bo=fx(n,QB),Pt=fx(e,iF);return vF(s),K.createElement(KB,{onPaneClick:ce,onPaneMouseEnter:ye,onPaneMouseMove:ge,onPaneMouseLeave:Re,onPaneContextMenu:yt,onPaneScroll:nt,deleteKeyCode:D,selectionKeyCode:T,selectionOnDrag:w,selectionMode:N,onSelectionStart:m,onSelectionEnd:x,multiSelectionKeyCode:S,panActivationKeyCode:C,zoomActivationKeyCode:B,elementsSelectable:$,onMove:t,onMoveStart:r,onMoveEnd:i,zoomOnScroll:I,zoomOnPinch:j,zoomOnDoubleClick:Q,panOnScroll:Z,panOnScrollSpeed:ee,panOnScrollMode:V,panOnDrag:te,defaultViewport:O,translateExtent:k,minZoom:R,maxZoom:L,onSelectionContextMenu:p,preventScrolling:M,noDragClassName:as,noWheelClassName:cs,noPanClassName:ur,disableKeyboardA11y:xi},K.createElement(bF,null,K.createElement(xF,{edgeTypes:Pt,onEdgeClick:a,onEdgeDoubleClick:l,onlyRenderVisibleElements:U,onEdgeContextMenu:ct,onEdgeMouseEnter:ze,onEdgeMouseMove:St,onEdgeMouseLeave:Me,onReconnect:ue,onReconnectStart:en,onReconnectEnd:gi,reconnectRadius:Do,defaultMarkerColor:W,noPanClassName:ur,elevateEdgesOnSelect:!!ls,disableKeyboardA11y:xi,rfId:ds},K.createElement(wF,{style:y,type:g,component:v,containerStyle:_})),K.createElement("div",{className:"react-flow__edgelabel-renderer"}),K.createElement(eF,{nodeTypes:Bo,onNodeClick:o,onNodeDoubleClick:c,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:f,selectNodesOnDrag:A,onlyRenderVisibleElements:U,noPanClassName:ur,noDragClassName:as,disableKeyboardA11y:xi,nodeOrigin:yi,nodeExtent:us,rfId:ds})))};zw.displayName="GraphView";var SF=E.memo(zw);const $f=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Or={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:$f,nodeExtent:$f,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:rs.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:JD,isValidConnection:void 0},NF=()=>aM((n,e)=>({...Or,setNodes:t=>{const{nodeInternals:r,nodeOrigin:i,elevateNodesOnSelect:s}=e();n({nodeInternals:Ed(t,r,i,s)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:t=>{const{defaultEdgeOptions:r={}}=e();n({edges:t.map(i=>({...r,...i}))})},setDefaultNodesAndEdges:(t,r)=>{const i=typeof t<"u",s=typeof r<"u",o=i?Ed(t,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;n({nodeInternals:o,edges:s?r:[],hasDefaultNodes:i,hasDefaultEdges:s})},updateNodeDimensions:t=>{const{onNodesChange:r,nodeInternals:i,fitViewOnInit:s,fitViewOnInitDone:o,fitViewOnInitOptions:a,domNode:c,nodeOrigin:l}=e(),u=c?.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:h}=new window.DOMMatrixReadOnly(d.transform),f=t.reduce((m,x)=>{const g=i.get(x.id);if(g?.hidden)i.set(g.id,{...g,[at]:{...g[at],handleBounds:void 0}});else if(g){const y=Sm(x.nodeElement);!!(y.width&&y.height&&(g.width!==y.width||g.height!==y.height||x.forceUpdate))&&(i.set(g.id,{...g,[at]:{...g[at],handleBounds:{source:ox(".source",x.nodeElement,h,l),target:ox(".target",x.nodeElement,h,l)}},...y}),m.push({id:g.id,type:"dimensions",dimensions:y}))}return m},[]);Mw(i,l);const p=o||s&&!o&&Pw(e,{initial:!0,...a});n({nodeInternals:new Map(i),fitViewOnInitDone:p}),f?.length>0&&r?.(f)},updateNodePositions:(t,r=!0,i=!1)=>{const{triggerNodeChanges:s}=e(),o=t.map(a=>{const c={id:a.id,type:"position",dragging:i};return r&&(c.positionAbsolute=a.positionAbsolute,c.position=a.position),c});s(o)},triggerNodeChanges:t=>{const{onNodesChange:r,nodeInternals:i,hasDefaultNodes:s,nodeOrigin:o,getNodes:a,elevateNodesOnSelect:c}=e();if(t?.length){if(s){const l=Bw(t,a()),u=Ed(l,i,o,c);n({nodeInternals:u})}r?.(t)}},addSelectedNodes:t=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let o,a=null;r?o=t.map(c=>zr(c,!0)):(o=Ds(s(),t),a=Ds(i,[])),Ac({changedNodes:o,changedEdges:a,get:e,set:n})},addSelectedEdges:t=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let o,a=null;r?o=t.map(c=>zr(c,!0)):(o=Ds(i,t),a=Ds(s(),[])),Ac({changedNodes:a,changedEdges:o,get:e,set:n})},unselectNodesAndEdges:({nodes:t,edges:r}={})=>{const{edges:i,getNodes:s}=e(),o=t||s(),a=r||i,c=o.map(u=>(u.selected=!1,zr(u.id,!1))),l=a.map(u=>zr(u.id,!1));Ac({changedNodes:c,changedEdges:l,get:e,set:n})},setMinZoom:t=>{const{d3Zoom:r,maxZoom:i}=e();r?.scaleExtent([t,i]),n({minZoom:t})},setMaxZoom:t=>{const{d3Zoom:r,minZoom:i}=e();r?.scaleExtent([i,t]),n({maxZoom:t})},setTranslateExtent:t=>{e().d3Zoom?.translateExtent(t),n({translateExtent:t})},resetSelectedElements:()=>{const{edges:t,getNodes:r}=e(),s=r().filter(a=>a.selected).map(a=>zr(a.id,!1)),o=t.filter(a=>a.selected).map(a=>zr(a.id,!1));Ac({changedNodes:s,changedEdges:o,get:e,set:n})},setNodeExtent:t=>{const{nodeInternals:r}=e();r.forEach(i=>{i.positionAbsolute=Nm(i.position,t)}),n({nodeExtent:t,nodeInternals:new Map(r)})},panBy:t=>{const{transform:r,width:i,height:s,d3Zoom:o,d3Selection:a,translateExtent:c}=e();if(!o||!a||!t.x&&!t.y)return!1;const l=ti.translate(r[0]+t.x,r[1]+t.y).scale(r[2]),u=[[0,0],[i,s]],d=o?.constrain()(l,u,c);return o.transform(a,d),r[0]!==d.x||r[1]!==d.y||r[2]!==d.k},cancelConnection:()=>n({connectionNodeId:Or.connectionNodeId,connectionHandleId:Or.connectionHandleId,connectionHandleType:Or.connectionHandleType,connectionStatus:Or.connectionStatus,connectionStartHandle:Or.connectionStartHandle,connectionEndHandle:Or.connectionEndHandle}),reset:()=>n({...Or})}),Object.is),Hw=({children:n})=>{const e=E.useRef(null);return e.current||(e.current=NF()),K.createElement(HD,{value:e.current},n)};Hw.displayName="ReactFlowProvider";const Ww=({children:n})=>E.useContext(Gu)?K.createElement(K.Fragment,null,n):K.createElement(Hw,null,n);Ww.displayName="ReactFlowWrapper";const AF={input:ww,default:Vf,output:Nw,group:Bm},EF={default:tu,straight:Rm,step:Cm,smoothstep:$u,simplebezier:Em},CF=[0,0],RF=[15,15],MF={x:0,y:0,zoom:1},PF={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},qw=E.forwardRef(({nodes:n,edges:e,defaultNodes:t,defaultEdges:r,className:i,nodeTypes:s=AF,edgeTypes:o=EF,onNodeClick:a,onEdgeClick:c,onInit:l,onMove:u,onMoveStart:d,onMoveEnd:h,onConnect:f,onConnectStart:p,onConnectEnd:m,onClickConnectStart:x,onClickConnectEnd:g,onNodeMouseEnter:y,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:T,onNodeDoubleClick:w,onNodeDragStart:N,onNodeDrag:S,onNodeDragStop:C,onNodesDelete:B,onEdgesDelete:D,onSelectionChange:U,onSelectionDragStart:$,onSelectionDrag:A,onSelectionDragStop:O,onSelectionContextMenu:k,onSelectionStart:R,onSelectionEnd:L,connectionMode:M=rs.Strict,connectionLineType:W=Wr.Bezier,connectionLineStyle:I,connectionLineComponent:j,connectionLineContainerStyle:Z,deleteKeyCode:ee="Backspace",selectionKeyCode:V="Shift",selectionOnDrag:Q=!1,selectionMode:te=Va.Full,panActivationKeyCode:ce="Space",multiSelectionKeyCode:ye=Jl()?"Meta":"Control",zoomActivationKeyCode:ge=Jl()?"Meta":"Control",snapToGrid:Re=!1,snapGrid:nt=RF,onlyRenderVisibleElements:yt=!1,selectNodesOnDrag:ct=!0,nodesDraggable:ze,nodesConnectable:St,nodesFocusable:Me,nodeOrigin:ue=CF,edgesFocusable:en,edgesUpdatable:gi,elementsSelectable:Do,defaultViewport:as=MF,minZoom:cs=.5,maxZoom:ur=2,translateExtent:ls=$f,preventScrolling:xi=!0,nodeExtent:yi,defaultMarkerColor:us="#b1b1b7",zoomOnScroll:ds=!0,zoomOnPinch:Bo=!0,panOnScroll:Pt=!1,panOnScrollSpeed:Vn=.5,panOnScrollMode:bi=Vi.Free,zoomOnDoubleClick:vi=!0,panOnDrag:hs=!0,onPaneClick:Gn,onPaneMouseEnter:_i,onPaneMouseMove:yd,onPaneMouseLeave:bd,onPaneScroll:Fo,onPaneContextMenu:vd,children:o0,onEdgeContextMenu:Ti,onEdgeDoubleClick:HE,onEdgeMouseEnter:WE,onEdgeMouseMove:qE,onEdgeMouseLeave:XE,onEdgeUpdate:KE,onEdgeUpdateStart:YE,onEdgeUpdateEnd:QE,onReconnect:ZE,onReconnectStart:JE,onReconnectEnd:eC,reconnectRadius:tC=10,edgeUpdaterRadius:nC=10,onNodesChange:rC,onEdgesChange:iC,noDragClassName:sC="nodrag",noWheelClassName:oC="nowheel",noPanClassName:a0="nopan",fitView:aC=!1,fitViewOptions:cC,connectOnClick:lC=!0,attributionPosition:uC,proOptions:dC,defaultEdgeOptions:hC,elevateNodesOnSelect:fC=!0,elevateEdgesOnSelect:pC=!1,disableKeyboardA11y:c0=!1,autoPanOnConnect:mC=!0,autoPanOnNodeDrag:gC=!0,connectionRadius:xC=20,isValidConnection:yC,onError:bC,style:vC,id:l0,nodeDragThreshold:_C,...TC},wC)=>{const _d=l0||"1";return K.createElement("div",{...TC,style:{...vC,...PF},ref:wC,className:Ht(["react-flow",i]),"data-testid":"rf__wrapper",id:l0},K.createElement(Ww,null,K.createElement(SF,{onInit:l,onMove:u,onMoveStart:d,onMoveEnd:h,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:y,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:T,onNodeDoubleClick:w,nodeTypes:s,edgeTypes:o,connectionLineType:W,connectionLineStyle:I,connectionLineComponent:j,connectionLineContainerStyle:Z,selectionKeyCode:V,selectionOnDrag:Q,selectionMode:te,deleteKeyCode:ee,multiSelectionKeyCode:ye,panActivationKeyCode:ce,zoomActivationKeyCode:ge,onlyRenderVisibleElements:yt,selectNodesOnDrag:ct,defaultViewport:as,translateExtent:ls,minZoom:cs,maxZoom:ur,preventScrolling:xi,zoomOnScroll:ds,zoomOnPinch:Bo,zoomOnDoubleClick:vi,panOnScroll:Pt,panOnScrollSpeed:Vn,panOnScrollMode:bi,panOnDrag:hs,onPaneClick:Gn,onPaneMouseEnter:_i,onPaneMouseMove:yd,onPaneMouseLeave:bd,onPaneScroll:Fo,onPaneContextMenu:vd,onSelectionContextMenu:k,onSelectionStart:R,onSelectionEnd:L,onEdgeContextMenu:Ti,onEdgeDoubleClick:HE,onEdgeMouseEnter:WE,onEdgeMouseMove:qE,onEdgeMouseLeave:XE,onReconnect:ZE??KE,onReconnectStart:JE??YE,onReconnectEnd:eC??QE,reconnectRadius:tC??nC,defaultMarkerColor:us,noDragClassName:sC,noWheelClassName:oC,noPanClassName:a0,elevateEdgesOnSelect:pC,rfId:_d,disableKeyboardA11y:c0,nodeOrigin:ue,nodeExtent:yi}),K.createElement(_B,{nodes:n,edges:e,defaultNodes:t,defaultEdges:r,onConnect:f,onConnectStart:p,onConnectEnd:m,onClickConnectStart:x,onClickConnectEnd:g,nodesDraggable:ze,nodesConnectable:St,nodesFocusable:Me,edgesFocusable:en,edgesUpdatable:gi,elementsSelectable:Do,elevateNodesOnSelect:fC,minZoom:cs,maxZoom:ur,nodeExtent:yi,onNodesChange:rC,onEdgesChange:iC,snapToGrid:Re,snapGrid:nt,connectionMode:M,translateExtent:ls,connectOnClick:lC,defaultEdgeOptions:hC,fitView:aC,fitViewOptions:cC,onNodesDelete:B,onEdgesDelete:D,onNodeDragStart:N,onNodeDrag:S,onNodeDragStop:C,onSelectionDrag:A,onSelectionDragStart:$,onSelectionDragStop:O,noPanClassName:a0,nodeOrigin:ue,rfId:_d,autoPanOnConnect:mC,autoPanOnNodeDrag:gC,onError:bC,connectionRadius:xC,isValidConnection:yC,nodeDragThreshold:_C}),K.createElement(bB,{onSelectionChange:U}),o0,K.createElement(qD,{proOptions:dC,position:uC}),K.createElement(AB,{rfId:_d,disableKeyboardA11y:c0})))});qw.displayName="ReactFlow";function DF(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},K.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function BF(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},K.createElement("path",{d:"M0 0h32v4.2H0z"}))}function FF(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},K.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function kF(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},K.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function LF(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},K.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const ca=({children:n,className:e,...t})=>K.createElement("button",{type:"button",className:Ht(["react-flow__controls-button",e]),...t},n);ca.displayName="ControlButton";const IF=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom}),Xw=({style:n,showZoom:e=!0,showFitView:t=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:s,onZoomOut:o,onFitView:a,onInteractiveChange:c,className:l,children:u,position:d="bottom-left"})=>{const h=wt(),[f,p]=E.useState(!1),{isInteractive:m,minZoomReached:x,maxZoomReached:g}=it(IF,It),{zoomIn:y,zoomOut:v,fitView:_}=Fm();if(E.useEffect(()=>{p(!0)},[]),!f)return null;const T=()=>{y(),s?.()},w=()=>{v(),o?.()},N=()=>{_(i),a?.()},S=()=>{h.setState({nodesDraggable:!m,nodesConnectable:!m,elementsSelectable:!m}),c?.(!m)};return K.createElement(rw,{className:Ht(["react-flow__controls",l]),position:d,style:n,"data-testid":"rf__controls"},e&&K.createElement(K.Fragment,null,K.createElement(ca,{onClick:T,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:g},K.createElement(DF,null)),K.createElement(ca,{onClick:w,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:x},K.createElement(BF,null))),t&&K.createElement(ca,{className:"react-flow__controls-fitview",onClick:N,title:"fit view","aria-label":"fit view"},K.createElement(FF,null)),r&&K.createElement(ca,{className:"react-flow__controls-interactive",onClick:S,title:"toggle interactivity","aria-label":"toggle interactivity"},m?K.createElement(LF,null):K.createElement(kF,null)),u)};Xw.displayName="Controls";var OF=E.memo(Xw),Fn;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(Fn||(Fn={}));function UF({color:n,dimensions:e,lineWidth:t}){return K.createElement("path",{stroke:n,strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function VF({color:n,radius:e}){return K.createElement("circle",{cx:e,cy:e,r:e,fill:n})}const GF={[Fn.Dots]:"#91919a",[Fn.Lines]:"#eee",[Fn.Cross]:"#e2e2e2"},$F={[Fn.Dots]:1,[Fn.Lines]:1,[Fn.Cross]:6},jF=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function Kw({id:n,variant:e=Fn.Dots,gap:t=20,size:r,lineWidth:i=1,offset:s=2,color:o,style:a,className:c}){const l=E.useRef(null),{transform:u,patternId:d}=it(jF,It),h=o||GF[e],f=r||$F[e],p=e===Fn.Dots,m=e===Fn.Cross,x=Array.isArray(t)?t:[t,t],g=[x[0]*u[2]||1,x[1]*u[2]||1],y=f*u[2],v=m?[y,y]:g,_=p?[y/s,y/s]:[v[0]/s,v[1]/s];return K.createElement("svg",{className:Ht(["react-flow__background",c]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:l,"data-testid":"rf__background"},K.createElement("pattern",{id:d+n,x:u[0]%g[0],y:u[1]%g[1],width:g[0],height:g[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`},p?K.createElement(VF,{color:h,radius:y/s}):K.createElement(UF,{dimensions:v,color:h,lineWidth:i})),K.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${d+n})`}))}Kw.displayName="Background";var zF=E.memo(Kw);const HF=({data:n,type:e})=>{const r={source:"var(--hud-accent)",cache:"var(--hud-success)",llm:"var(--hud-accent-secondary)",sector:"#f59e0b"}[n.type]||"var(--hud-text)";return b.jsxs("div",{className:"px-4 py-2 rounded bg-black border border-[var(--hud-border)] shadow-[0_0_15px_rgba(0,0,0,0.5)] min-w-[150px]",children:[b.jsx(so,{type:"target",position:he.Top,className:"!bg-[var(--hud-text-dim)]"}),b.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[b.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:r}}),b.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-white",children:n.label})]}),b.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:n.details}),b.jsx(so,{type:"source",position:he.Bottom,className:"!bg-[var(--hud-text-dim)]"})]})},WF={cyber:HF};function qF(){const[n,e]=E.useState([]),[t,r]=E.useState([]),[i,s]=E.useState(!0),[o,a]=E.useState(1),[c,l]=E.useState({useCase:"",performance:"balanced"}),u=E.useCallback(m=>e(x=>Bw(m,x)),[]),d=E.useCallback(m=>r(x=>VB(m,x)),[]),h=E.useCallback(m=>r(x=>hw(m,x)),[]),f=()=>{const m=[{id:"1",type:"cyber",position:{x:250,y:0},data:{label:"HTTP API",type:"source",details:"Ingress"}},{id:"2",type:"cyber",position:{x:250,y:100},data:{label:"L1 Cache",type:"cache",details:"Redis (In-Memory)"}},{id:"3",type:"cyber",position:{x:250,y:200},data:{label:"Semantic Router",type:"sector",details:"Healthcare Model"}},{id:"4",type:"cyber",position:{x:250,y:300},data:{label:"GPT-4o",type:"llm",details:"Fallback"}}],x=[{id:"e1-2",source:"1",target:"2",animated:!0,style:{stroke:"var(--hud-accent)"}},{id:"e2-3",source:"2",target:"3",animated:!0,style:{stroke:"var(--hud-accent)"}},{id:"e3-4",source:"3",target:"4",animated:!0,style:{stroke:"var(--hud-accent)"}}];e(m),r(x),s(!1)},p=async()=>{try{const m=localStorage.getItem("agentcache_token");if(!m){alert("Authentication required. Please log in.");return}const x={name:`Pipeline ${new Date().toLocaleTimeString()}`,sector:c.useCase||"custom",nodes:n,connections:t,description:`Generated via Wizard (${c.performance})`,complexity:{tier:"moderate",score:n.length*10},monthlyCost:0,features:["cache","llm"]},y=await(await fetch("/api/pipelines/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(x)})).json();if(y.success)alert(`Pipeline Saved! ID: ${y.pipeline.id}`);else throw new Error(y.error||"Unknown error")}catch(m){console.error("Save failed",m),alert(`Failed to save: ${m.message}`)}};return b.jsxs("div",{className:"h-[calc(100vh-8rem)] flex gap-6 relative",children:[b.jsx("div",{className:"w-64 flex flex-col gap-4",children:b.jsx(He,{title:"Node Palette",icon:BR,className:"flex-1",children:b.jsx("div",{className:"space-y-2",children:["Source","Cache","LLM","Sector"].map(m=>b.jsx("div",{className:"p-3 rounded bg-[rgba(255,255,255,0.05)] border border-transparent hover:border-[var(--hud-accent)] cursor-grab active:cursor-grabbing transition-colors",children:b.jsxs("span",{className:"text-sm font-bold text-white",children:[m," Node"]})},m))})})}),b.jsxs("div",{className:"flex-1 rounded-lg border border-[var(--hud-border)] bg-black/50 overflow-hidden relative",children:[b.jsxs(qw,{nodes:n,edges:t,onNodesChange:u,onEdgesChange:d,onConnect:h,nodeTypes:WF,fitView:!0,children:[b.jsx(zF,{color:"#333",gap:20}),b.jsx(OF,{className:"!bg-black !border-[var(--hud-border)] !fill-white"})]}),b.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[b.jsxs("button",{onClick:()=>s(!0),className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs",children:[b.jsx(XR,{size:14})," Wizard"]}),b.jsxs("button",{onClick:p,className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs",children:[b.jsx(LR,{size:14})," Save"]}),b.jsxs("button",{className:"btn-cyber btn-cyber-primary px-4 py-2 flex items-center gap-2 text-xs",children:[b.jsx(PR,{size:14})," Deploy"]})]})]}),i&&b.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:b.jsxs(He,{className:"w-[600px] max-h-[80vh] overflow-y-auto relative",children:[b.jsx("button",{onClick:()=>s(!1),className:"absolute top-4 right-4 text-[var(--hud-text-dim)] hover:text-white",children:b.jsx(ZR,{size:20})}),b.jsxs("div",{className:"mb-6",children:[b.jsx("h2",{className:"text-xl font-bold text-[var(--hud-accent)] tracking-widest mb-1",children:"PIPELINE WIZARD"}),b.jsx("p",{className:"text-xs font-mono text-[var(--hud-text-dim)]",children:"CONFIGURE ORCHESTRATION PARAMETERS"})]}),o===1&&b.jsxs("div",{className:"space-y-4",children:[b.jsx("h3",{className:"text-sm font-bold text-white",children:"SELECT USE CASE"}),b.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{id:"clinical",label:"Clinical Decision",icon:""},{id:"trading",label:"Trading Assistant",icon:""},{id:"legal",label:"Contract Review",icon:""},{id:"custom",label:"Custom",icon:""}].map(m=>b.jsxs("button",{onClick:()=>{l({...c,useCase:m.id}),a(2)},className:"p-4 rounded border border-[var(--hud-border)] hover:border-[var(--hud-accent)] hover:bg-[var(--hud-accent)]/10 text-left transition-all",children:[b.jsx("div",{className:"text-2xl mb-2",children:m.icon}),b.jsx("div",{className:"font-bold text-sm text-white",children:m.label})]},m.id))})]}),o===2&&b.jsxs("div",{className:"space-y-6",children:[b.jsx("h3",{className:"text-sm font-bold text-white",children:"OPTIMIZATION TARGET"}),b.jsx("div",{className:"space-y-3",children:[{id:"fast",label:"Low Latency",desc:"Minimize response time"},{id:"balanced",label:"Balanced",desc:"Good speed + cost savings"},{id:"cost",label:"Cost Optimized",desc:"Maximum savings"}].map(m=>b.jsxs("button",{onClick:()=>l({...c,performance:m.id}),className:`w-full p-4 rounded border text-left transition-all ${c.performance===m.id?"border-[var(--hud-accent)] bg-[var(--hud-accent)]/10":"border-[var(--hud-border)] hover:bg-[rgba(255,255,255,0.05)]"}`,children:[b.jsx("div",{className:"font-bold text-sm text-white",children:m.label}),b.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:m.desc})]},m.id))}),b.jsxs("div",{className:"flex justify-between pt-4 border-t border-[var(--hud-border)]",children:[b.jsx("button",{onClick:()=>a(1),className:"text-xs text-[var(--hud-text-dim)] hover:text-white",children:"BACK"}),b.jsx("button",{onClick:f,className:"btn-cyber btn-cyber-primary px-6 py-2 text-sm font-bold",children:"GENERATE"})]})]})]})})]})}function XF(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function KF(n,e,t){return e=rk(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function px(n,e){return ZF(n)||XF(n,e)||Yw(n,e)||tk()}function YF(n){return QF(n)||JF(n)||Yw(n)||ek()}function QF(n){if(Array.isArray(n))return jf(n)}function ZF(n){if(Array.isArray(n))return n}function JF(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Yw(n,e){if(n){if(typeof n=="string")return jf(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jf(n,e)}}function jf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function ek(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nk(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function rk(n){var e=nk(n,"string");return typeof e=="symbol"?e:String(e)}var ik=function(e,t){var r=new Set(t);return Object.assign.apply(Object,[{}].concat(YF(Object.entries(e).filter(function(i){var s=px(i,1),o=s[0];return!r.has(o)}).map(function(i){var s=px(i,2),o=s[0],a=s[1];return KF({},o,a)}))))};function zf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function sk(n){if(Array.isArray(n))return n}function ok(n){if(Array.isArray(n))return zf(n)}function ak(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ck(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function lk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uk(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dk(n,e){return sk(n)||ck(n,e)||Qw(n,e)||lk()}function mx(n){return ok(n)||ak(n)||Qw(n)||uk()}function Qw(n,e){if(n){if(typeof n=="string")return zf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?zf(n,e):void 0}}function hk(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,r=t===void 0?"div":t,i=e.nodeMapper,s=i===void 0?function(u){return u}:i,o=e.methodNames,a=o===void 0?[]:o,c=e.initPropNames,l=c===void 0?[]:c;return E.forwardRef(function(u,d){var h=E.useRef(),f=E.useMemo(function(){var x=Object.fromEntries(l.filter(function(g){return u.hasOwnProperty(g)}).map(function(g){return[g,u[g]]}));return n(x)},[]);gx(function(){f(s(h.current))},E.useLayoutEffect),gx(function(){return f._destructor instanceof Function?f._destructor:void 0});var p=E.useCallback(function(x){for(var g=arguments.length,y=new Array(g>1?g-1:0),v=1;v<g;v++)y[v-1]=arguments[v];return f[x]instanceof Function?f[x].apply(f,y):void 0},[f]),m=E.useRef({});return Object.keys(ik(u,[].concat(mx(a),mx(l)))).filter(function(x){return m.current[x]!==u[x]}).forEach(function(x){return p(x,u[x])}),m.current=u,E.useImperativeHandle(d,function(){return Object.fromEntries(a.map(function(x){return[x,function(){for(var g=arguments.length,y=new Array(g),v=0;v<g;v++)y[v]=arguments[v];return p.apply(void 0,[x].concat(y))}]}))},[p]),K.createElement(r,{ref:h})})}function gx(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.useEffect,t=E.useRef(),r=E.useRef(!1),i=E.useRef(!1),s=E.useState(0),o=dk(s,2);o[0];var a=o[1];r.current&&(i.current=!0),e(function(){return r.current||(t.current=n(),r.current=!0),a(function(c){return c+1}),function(){i.current&&t.current&&t.current()}},[])}const Ws=new Cu,_r=new we,Zw=new le,Pd=new we,Sl=new we,nu=new le,Hf=new le,Jw=new On,e1=new le,t1=new le;let Bt=null,Wn=null;const Tr=[],ri={NONE:-1,PAN:0,ROTATE:1};class fk extends Eu{constructor(e,t,r=null){super(t,r),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new C_,this.mouseButtons={LEFT:Ct.PAN,MIDDLE:Ct.PAN,RIGHT:Ct.ROTATE},this.touches={ONE:Sr.PAN},this._onPointerMove=pk.bind(this),this._onPointerDown=mk.bind(this),this._onPointerCancel=gk.bind(this),this._onContextMenu=xk.bind(this),r!==null&&this.connect(r)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();_r.x=(e.clientX-t.left)/t.width*2-1,_r.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Ct.PAN:case Sr.PAN:this.state=ri.PAN;break;case Ct.ROTATE:case Sr.ROTATE:this.state=ri.ROTATE;break;default:this.state=ri.NONE}}}function pk(n){const e=this.object,t=this.domElement,r=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),r.setFromCamera(_r,e),Bt)this.state===ri.PAN?r.ray.intersectPlane(Ws,nu)&&(Bt.position.copy(nu.sub(Zw).applyMatrix4(Jw)),this.dispatchEvent({type:"drag",object:Bt})):this.state===ri.ROTATE&&(Pd.subVectors(_r,Sl).multiplyScalar(this.rotateSpeed),Bt.rotateOnWorldAxis(e1,Pd.x),Bt.rotateOnWorldAxis(t1.normalize(),-Pd.y),this.dispatchEvent({type:"drag",object:Bt})),Sl.copy(_r);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(Tr.length=0,r.setFromCamera(_r,e),r.intersectObjects(this.objects,this.recursive,Tr),Tr.length>0){const i=Tr[0].object;Ws.setFromNormalAndCoplanarPoint(e.getWorldDirection(Ws.normal),Hf.setFromMatrixPosition(i.matrixWorld)),Wn!==i&&Wn!==null&&(this.dispatchEvent({type:"hoveroff",object:Wn}),t.style.cursor="auto",Wn=null),Wn!==i&&(this.dispatchEvent({type:"hoveron",object:i}),t.style.cursor="pointer",Wn=i)}else Wn!==null&&(this.dispatchEvent({type:"hoveroff",object:Wn}),t.style.cursor="auto",Wn=null);Sl.copy(_r)}}function mk(n){const e=this.object,t=this.domElement,r=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),Tr.length=0,r.setFromCamera(_r,e),r.intersectObjects(this.objects,this.recursive,Tr),Tr.length>0&&(this.transformGroup===!0?Bt=n1(Tr[0].object):Bt=Tr[0].object,Ws.setFromNormalAndCoplanarPoint(e.getWorldDirection(Ws.normal),Hf.setFromMatrixPosition(Bt.matrixWorld)),r.ray.intersectPlane(Ws,nu)&&(this.state===ri.PAN?(Jw.copy(Bt.parent.matrixWorld).invert(),Zw.copy(nu).sub(Hf.setFromMatrixPosition(Bt.matrixWorld)),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Bt})):this.state===ri.ROTATE&&(e1.set(0,1,0).applyQuaternion(e.quaternion).normalize(),t1.set(1,0,0).applyQuaternion(e.quaternion).normalize(),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Bt})))),Sl.copy(_r))}function gk(){this.enabled!==!1&&(Bt&&(this.dispatchEvent({type:"dragend",object:Bt}),Bt=null),this.domElement.style.cursor=Wn?"pointer":"auto",this.state=ri.NONE)}function xk(n){this.enabled!==!1&&n.preventDefault()}function n1(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:n1(n.parent,e)}function yk(n,e,t){var r,i=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function s(){var o,a=r.length,c,l=0,u=0,d=0;for(o=0;o<a;++o)c=r[o],l+=c.x||0,u+=c.y||0,d+=c.z||0;for(l=(l/a-n)*i,u=(u/a-e)*i,d=(d/a-t)*i,o=0;o<a;++o)c=r[o],l&&(c.x-=l),u&&(c.y-=u),d&&(c.z-=d)}return s.initialize=function(o){r=o},s.x=function(o){return arguments.length?(n=+o,s):n},s.y=function(o){return arguments.length?(e=+o,s):e},s.z=function(o){return arguments.length?(t=+o,s):t},s.strength=function(o){return arguments.length?(i=+o,s):i},s}function bk(n){const e=+this._x.call(null,n);return r1(this.cover(e),e,n)}function r1(n,e,t){if(isNaN(e))return n;var r,i=n._root,s={data:t},o=n._x0,a=n._x1,c,l,u,d,h;if(!i)return n._root=s,n;for(;i.length;)if((u=e>=(c=(o+a)/2))?o=c:a=c,r=i,!(i=i[d=+u]))return r[d]=s,n;if(l=+n._x.call(null,i.data),e===l)return s.next=i,r?r[d]=s:n._root=s,n;do r=r?r[d]=new Array(2):n._root=new Array(2),(u=e>=(c=(o+a)/2))?o=c:a=c;while((d=+u)==(h=+(l>=c)));return r[h]=i,r[d]=s,n}function vk(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let r=1/0,i=-1/0;for(let s=0,o;s<e;++s)isNaN(o=+this._x.call(null,n[s]))||(t[s]=o,o<r&&(r=o),o>i&&(i=o));if(r>i)return this;this.cover(r).cover(i);for(let s=0;s<e;++s)r1(this,t[s],n[s]);return this}function _k(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var r=t-e||1,i=this._root,s,o;e>n||n>=t;)switch(o=+(n<e),s=new Array(2),s[o]=i,i=s,r*=2,o){case 0:t=e+r;break;case 1:e=t-r;break}this._root&&this._root.length&&(this._root=i)}return this._x0=e,this._x1=t,this}function Tk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function wk(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Cr(n,e,t){this.node=n,this.x0=e,this.x1=t}function Sk(n,e){var t,r=this._x0,i,s,o=this._x1,a=[],c=this._root,l,u;for(c&&a.push(new Cr(c,r,o)),e==null?e=1/0:(r=n-e,o=n+e);l=a.pop();)if(!(!(c=l.node)||(i=l.x0)>o||(s=l.x1)<r))if(c.length){var d=(i+s)/2;a.push(new Cr(c[1],d,s),new Cr(c[0],i,d)),(u=+(n>=d))&&(l=a[a.length-1],a[a.length-1]=a[a.length-1-u],a[a.length-1-u]=l)}else{var h=Math.abs(n-+this._x.call(null,c.data));h<e&&(e=h,r=n-h,o=n+h,t=c.data)}return t}function Nk(n){if(isNaN(c=+this._x.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,a=this._x1,c,l,u,d,h;if(!t)return this;if(t.length)for(;;){if((u=c>=(l=(o+a)/2))?o=l:a=l,e=t,!(t=t[d=+u]))return this;if(!t.length)break;e[d+1&1]&&(r=e,h=d)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[d]=s:delete e[d],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(r?r[h]=t:this._root=t),this):(this._root=s,this)}function Ak(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function Ek(){return this._root}function Ck(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function Rk(n){var e=[],t,r=this._root,i,s,o;for(r&&e.push(new Cr(r,this._x0,this._x1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.x1)&&r.length){var a=(s+o)/2;(i=r[1])&&e.push(new Cr(i,a,o)),(i=r[0])&&e.push(new Cr(i,s,a))}return this}function Mk(n){var e=[],t=[],r;for(this._root&&e.push(new Cr(this._root,this._x0,this._x1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.x1,c=(o+a)/2;(s=i[0])&&e.push(new Cr(s,o,c)),(s=i[1])&&e.push(new Cr(s,c,a))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.x1);return this}function Pk(n){return n[0]}function Dk(n){return arguments.length?(this._x=n,this):this._x}function i1(n,e){var t=new Lm(e??Pk,NaN,NaN);return n==null?t:t.addAll(n)}function Lm(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function xx(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Jt=i1.prototype=Lm.prototype;Jt.copy=function(){var n=new Lm(this._x,this._x0,this._x1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=xx(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var i=0;i<2;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(2)}):e.target[i]=xx(r));return n};Jt.add=bk;Jt.addAll=vk;Jt.cover=_k;Jt.data=Tk;Jt.extent=wk;Jt.find=Sk;Jt.remove=Nk;Jt.removeAll=Ak;Jt.root=Ek;Jt.size=Ck;Jt.visit=Rk;Jt.visitAfter=Mk;Jt.x=Dk;function Bk(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return s1(this.cover(e,t),e,t,n)}function s1(n,e,t,r){if(isNaN(e)||isNaN(t))return n;var i,s=n._root,o={data:r},a=n._x0,c=n._y0,l=n._x1,u=n._y1,d,h,f,p,m,x,g,y;if(!s)return n._root=o,n;for(;s.length;)if((m=e>=(d=(a+l)/2))?a=d:l=d,(x=t>=(h=(c+u)/2))?c=h:u=h,i=s,!(s=s[g=x<<1|m]))return i[g]=o,n;if(f=+n._x.call(null,s.data),p=+n._y.call(null,s.data),e===f&&t===p)return o.next=s,i?i[g]=o:n._root=o,n;do i=i?i[g]=new Array(4):n._root=new Array(4),(m=e>=(d=(a+l)/2))?a=d:l=d,(x=t>=(h=(c+u)/2))?c=h:u=h;while((g=x<<1|m)===(y=(p>=h)<<1|f>=d));return i[y]=s,i[g]=o,n}function Fk(n){var e,t,r=n.length,i,s,o=new Array(r),a=new Array(r),c=1/0,l=1/0,u=-1/0,d=-1/0;for(t=0;t<r;++t)isNaN(i=+this._x.call(null,e=n[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=i,a[t]=s,i<c&&(c=i),i>u&&(u=i),s<l&&(l=s),s>d&&(d=s));if(c>u||l>d)return this;for(this.cover(c,l).cover(u,d),t=0;t<r;++t)s1(this,o[t],a[t],n[t]);return this}function kk(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(t))i=(t=Math.floor(n))+1,s=(r=Math.floor(e))+1;else{for(var o=i-t||1,a=this._root,c,l;t>n||n>=i||r>e||e>=s;)switch(l=(e<r)<<1|n<t,c=new Array(4),c[l]=a,a=c,o*=2,l){case 0:i=t+o,s=r+o;break;case 1:t=i-o,s=r+o;break;case 2:i=t+o,r=s-o;break;case 3:t=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=t,this._y0=r,this._x1=i,this._y1=s,this}function Lk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function Ik(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Gt(n,e,t,r,i){this.node=n,this.x0=e,this.y0=t,this.x1=r,this.y1=i}function Ok(n,e,t){var r,i=this._x0,s=this._y0,o,a,c,l,u=this._x1,d=this._y1,h=[],f=this._root,p,m;for(f&&h.push(new Gt(f,i,s,u,d)),t==null?t=1/0:(i=n-t,s=e-t,u=n+t,d=e+t,t*=t);p=h.pop();)if(!(!(f=p.node)||(o=p.x0)>u||(a=p.y0)>d||(c=p.x1)<i||(l=p.y1)<s))if(f.length){var x=(o+c)/2,g=(a+l)/2;h.push(new Gt(f[3],x,g,c,l),new Gt(f[2],o,g,x,l),new Gt(f[1],x,a,c,g),new Gt(f[0],o,a,x,g)),(m=(e>=g)<<1|n>=x)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-m],h[h.length-1-m]=p)}else{var y=n-+this._x.call(null,f.data),v=e-+this._y.call(null,f.data),_=y*y+v*v;if(_<t){var T=Math.sqrt(t=_);i=n-T,s=e-T,u=n+T,d=e+T,r=f.data}}return r}function Uk(n){if(isNaN(u=+this._x.call(null,n))||isNaN(d=+this._y.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,a=this._y0,c=this._x1,l=this._y1,u,d,h,f,p,m,x,g;if(!t)return this;if(t.length)for(;;){if((p=u>=(h=(o+c)/2))?o=h:c=h,(m=d>=(f=(a+l)/2))?a=f:l=f,e=t,!(t=t[x=m<<1|p]))return this;if(!t.length)break;(e[x+1&3]||e[x+2&3]||e[x+3&3])&&(r=e,g=x)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[x]=s:delete e[x],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[g]=t:this._root=t),this):(this._root=s,this)}function Vk(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function Gk(){return this._root}function $k(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function jk(n){var e=[],t,r=this._root,i,s,o,a,c;for(r&&e.push(new Gt(r,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.y0,a=t.x1,c=t.y1)&&r.length){var l=(s+a)/2,u=(o+c)/2;(i=r[3])&&e.push(new Gt(i,l,u,a,c)),(i=r[2])&&e.push(new Gt(i,s,u,l,c)),(i=r[1])&&e.push(new Gt(i,l,o,a,u)),(i=r[0])&&e.push(new Gt(i,s,o,l,u))}return this}function zk(n){var e=[],t=[],r;for(this._root&&e.push(new Gt(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,c=r.x1,l=r.y1,u=(o+c)/2,d=(a+l)/2;(s=i[0])&&e.push(new Gt(s,o,a,u,d)),(s=i[1])&&e.push(new Gt(s,u,a,c,d)),(s=i[2])&&e.push(new Gt(s,o,d,u,l)),(s=i[3])&&e.push(new Gt(s,u,d,c,l))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Hk(n){return n[0]}function Wk(n){return arguments.length?(this._x=n,this):this._x}function qk(n){return n[1]}function Xk(n){return arguments.length?(this._y=n,this):this._y}function o1(n,e,t){var r=new Im(e??Hk,t??qk,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function Im(n,e,t,r,i,s){this._x=n,this._y=e,this._x0=t,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function yx(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Wt=o1.prototype=Im.prototype;Wt.copy=function(){var n=new Im(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=yx(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=yx(r));return n};Wt.add=Bk;Wt.addAll=Fk;Wt.cover=kk;Wt.data=Lk;Wt.extent=Ik;Wt.find=Ok;Wt.remove=Uk;Wt.removeAll=Vk;Wt.root=Gk;Wt.size=$k;Wt.visit=jk;Wt.visitAfter=zk;Wt.x=Wk;Wt.y=Xk;function Kk(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),r=+this._z.call(null,n);return a1(this.cover(e,t,r),e,t,r,n)}function a1(n,e,t,r,i){if(isNaN(e)||isNaN(t)||isNaN(r))return n;var s,o=n._root,a={data:i},c=n._x0,l=n._y0,u=n._z0,d=n._x1,h=n._y1,f=n._z1,p,m,x,g,y,v,_,T,w,N,S;if(!o)return n._root=a,n;for(;o.length;)if((_=e>=(p=(c+d)/2))?c=p:d=p,(T=t>=(m=(l+h)/2))?l=m:h=m,(w=r>=(x=(u+f)/2))?u=x:f=x,s=o,!(o=o[N=w<<2|T<<1|_]))return s[N]=a,n;if(g=+n._x.call(null,o.data),y=+n._y.call(null,o.data),v=+n._z.call(null,o.data),e===g&&t===y&&r===v)return a.next=o,s?s[N]=a:n._root=a,n;do s=s?s[N]=new Array(8):n._root=new Array(8),(_=e>=(p=(c+d)/2))?c=p:d=p,(T=t>=(m=(l+h)/2))?l=m:h=m,(w=r>=(x=(u+f)/2))?u=x:f=x;while((N=w<<2|T<<1|_)===(S=(v>=x)<<2|(y>=m)<<1|g>=p));return s[S]=o,s[N]=a,n}function Yk(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0;for(let d=0,h,f,p,m;d<e;++d)isNaN(f=+this._x.call(null,h=n[d]))||isNaN(p=+this._y.call(null,h))||isNaN(m=+this._z.call(null,h))||(t[d]=f,r[d]=p,i[d]=m,f<s&&(s=f),f>c&&(c=f),p<o&&(o=p),p>l&&(l=p),m<a&&(a=m),m>u&&(u=m));if(s>c||o>l||a>u)return this;this.cover(s,o,a).cover(c,l,u);for(let d=0;d<e;++d)a1(this,t[d],r[d],i[d],n[d]);return this}function Qk(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,c=this._z1;if(isNaN(r))o=(r=Math.floor(n))+1,a=(i=Math.floor(e))+1,c=(s=Math.floor(t))+1;else{for(var l=o-r||1,u=this._root,d,h;r>n||n>=o||i>e||e>=a||s>t||t>=c;)switch(h=(t<s)<<2|(e<i)<<1|n<r,d=new Array(8),d[h]=u,u=d,l*=2,h){case 0:o=r+l,a=i+l,c=s+l;break;case 1:r=o-l,a=i+l,c=s+l;break;case 2:o=r+l,i=a-l,c=s+l;break;case 3:r=o-l,i=a-l,c=s+l;break;case 4:o=r+l,a=i+l,s=c-l;break;case 5:r=o-l,a=i+l,s=c-l;break;case 6:o=r+l,i=a-l,s=c-l;break;case 7:r=o-l,i=a-l,s=c-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this}function Zk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function Jk(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function $e(n,e,t,r,i,s,o){this.node=n,this.x0=e,this.y0=t,this.z0=r,this.x1=i,this.y1=s,this.z1=o}function eL(n,e,t,r){var i,s=this._x0,o=this._y0,a=this._z0,c,l,u,d,h,f,p=this._x1,m=this._y1,x=this._z1,g=[],y=this._root,v,_;for(y&&g.push(new $e(y,s,o,a,p,m,x)),r==null?r=1/0:(s=n-r,o=e-r,a=t-r,p=n+r,m=e+r,x=t+r,r*=r);v=g.pop();)if(!(!(y=v.node)||(c=v.x0)>p||(l=v.y0)>m||(u=v.z0)>x||(d=v.x1)<s||(h=v.y1)<o||(f=v.z1)<a))if(y.length){var T=(c+d)/2,w=(l+h)/2,N=(u+f)/2;g.push(new $e(y[7],T,w,N,d,h,f),new $e(y[6],c,w,N,T,h,f),new $e(y[5],T,l,N,d,w,f),new $e(y[4],c,l,N,T,w,f),new $e(y[3],T,w,u,d,h,N),new $e(y[2],c,w,u,T,h,N),new $e(y[1],T,l,u,d,w,N),new $e(y[0],c,l,u,T,w,N)),(_=(t>=N)<<2|(e>=w)<<1|n>=T)&&(v=g[g.length-1],g[g.length-1]=g[g.length-1-_],g[g.length-1-_]=v)}else{var S=n-+this._x.call(null,y.data),C=e-+this._y.call(null,y.data),B=t-+this._z.call(null,y.data),D=S*S+C*C+B*B;if(D<r){var U=Math.sqrt(r=D);s=n-U,o=e-U,a=t-U,p=n+U,m=e+U,x=t+U,i=y.data}}return i}const tL=(n,e,t,r,i,s)=>Math.sqrt((n-r)**2+(e-i)**2+(t-s)**2);function nL(n,e,t,r){const i=[],s=n-r,o=e-r,a=t-r,c=n+r,l=e+r,u=t+r;return this.visit((d,h,f,p,m,x,g)=>{if(!d.length)do{const y=d.data;tL(n,e,t,this._x(y),this._y(y),this._z(y))<=r&&i.push(y)}while(d=d.next);return h>c||f>l||p>u||m<s||x<o||g<a}),i}function rL(n){if(isNaN(h=+this._x.call(null,n))||isNaN(f=+this._y.call(null,n))||isNaN(p=+this._z.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,a=this._y0,c=this._z0,l=this._x1,u=this._y1,d=this._z1,h,f,p,m,x,g,y,v,_,T,w;if(!t)return this;if(t.length)for(;;){if((y=h>=(m=(o+l)/2))?o=m:l=m,(v=f>=(x=(a+u)/2))?a=x:u=x,(_=p>=(g=(c+d)/2))?c=g:d=g,e=t,!(t=t[T=_<<2|v<<1|y]))return this;if(!t.length)break;(e[T+1&7]||e[T+2&7]||e[T+3&7]||e[T+4&7]||e[T+5&7]||e[T+6&7]||e[T+7&7])&&(r=e,w=T)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[T]=s:delete e[T],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[w]=t:this._root=t),this):(this._root=s,this)}function iL(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function sL(){return this._root}function oL(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function aL(n){var e=[],t,r=this._root,i,s,o,a,c,l,u;for(r&&e.push(new $e(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.y0,a=t.z0,c=t.x1,l=t.y1,u=t.z1)&&r.length){var d=(s+c)/2,h=(o+l)/2,f=(a+u)/2;(i=r[7])&&e.push(new $e(i,d,h,f,c,l,u)),(i=r[6])&&e.push(new $e(i,s,h,f,d,l,u)),(i=r[5])&&e.push(new $e(i,d,o,f,c,h,u)),(i=r[4])&&e.push(new $e(i,s,o,f,d,h,u)),(i=r[3])&&e.push(new $e(i,d,h,a,c,l,f)),(i=r[2])&&e.push(new $e(i,s,h,a,d,l,f)),(i=r[1])&&e.push(new $e(i,d,o,a,c,h,f)),(i=r[0])&&e.push(new $e(i,s,o,a,d,h,f))}return this}function cL(n){var e=[],t=[],r;for(this._root&&e.push(new $e(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,c=r.z0,l=r.x1,u=r.y1,d=r.z1,h=(o+l)/2,f=(a+u)/2,p=(c+d)/2;(s=i[0])&&e.push(new $e(s,o,a,c,h,f,p)),(s=i[1])&&e.push(new $e(s,h,a,c,l,f,p)),(s=i[2])&&e.push(new $e(s,o,f,c,h,u,p)),(s=i[3])&&e.push(new $e(s,h,f,c,l,u,p)),(s=i[4])&&e.push(new $e(s,o,a,p,h,f,d)),(s=i[5])&&e.push(new $e(s,h,a,p,l,f,d)),(s=i[6])&&e.push(new $e(s,o,f,p,h,u,d)),(s=i[7])&&e.push(new $e(s,h,f,p,l,u,d))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function lL(n){return n[0]}function uL(n){return arguments.length?(this._x=n,this):this._x}function dL(n){return n[1]}function hL(n){return arguments.length?(this._y=n,this):this._y}function fL(n){return n[2]}function pL(n){return arguments.length?(this._z=n,this):this._z}function c1(n,e,t,r){var i=new Om(e??lL,t??dL,r??fL,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function Om(n,e,t,r,i,s,o,a,c){this._x=n,this._y=e,this._z=t,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this._root=void 0}function bx(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Mt=c1.prototype=Om.prototype;Mt.copy=function(){var n=new Om(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=bx(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(8)}):e.target[i]=bx(r));return n};Mt.add=Kk;Mt.addAll=Yk;Mt.cover=Qk;Mt.data=Zk;Mt.extent=Jk;Mt.find=eL;Mt.findAllWithinRadius=nL;Mt.remove=rL;Mt.removeAll=iL;Mt.root=sL;Mt.size=oL;Mt.visit=aL;Mt.visitAfter=cL;Mt.x=uL;Mt.y=hL;Mt.z=pL;function Ar(n){return function(){return n}}function xr(n){return(n()-.5)*1e-6}function mL(n){return n.index}function vx(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function gL(n){var e=mL,t=h,r,i=Ar(30),s,o,a,c,l,u,d=1;n==null&&(n=[]);function h(g){return 1/Math.min(c[g.source.index],c[g.target.index])}function f(g){for(var y=0,v=n.length;y<d;++y)for(var _=0,T,w,N,S=0,C=0,B=0,D,U;_<v;++_)T=n[_],w=T.source,N=T.target,S=N.x+N.vx-w.x-w.vx||xr(u),a>1&&(C=N.y+N.vy-w.y-w.vy||xr(u)),a>2&&(B=N.z+N.vz-w.z-w.vz||xr(u)),D=Math.sqrt(S*S+C*C+B*B),D=(D-s[_])/D*g*r[_],S*=D,C*=D,B*=D,N.vx-=S*(U=l[_]),a>1&&(N.vy-=C*U),a>2&&(N.vz-=B*U),w.vx+=S*(U=1-U),a>1&&(w.vy+=C*U),a>2&&(w.vz+=B*U)}function p(){if(o){var g,y=o.length,v=n.length,_=new Map(o.map((w,N)=>[e(w,N,o),w])),T;for(g=0,c=new Array(y);g<v;++g)T=n[g],T.index=g,typeof T.source!="object"&&(T.source=vx(_,T.source)),typeof T.target!="object"&&(T.target=vx(_,T.target)),c[T.source.index]=(c[T.source.index]||0)+1,c[T.target.index]=(c[T.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)T=n[g],l[g]=c[T.source.index]/(c[T.source.index]+c[T.target.index]);r=new Array(v),m(),s=new Array(v),x()}}function m(){if(o)for(var g=0,y=n.length;g<y;++g)r[g]=+t(n[g],g,n)}function x(){if(o)for(var g=0,y=n.length;g<y;++g)s[g]=+i(n[g],g,n)}return f.initialize=function(g,...y){o=g,u=y.find(v=>typeof v=="function")||Math.random,a=y.find(v=>[1,2,3].includes(v))||2,p()},f.links=function(g){return arguments.length?(n=g,p(),f):n},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(d=+g,f):d},f.strength=function(g){return arguments.length?(t=typeof g=="function"?g:Ar(+g),m(),f):t},f.distance=function(g){return arguments.length?(i=typeof g=="function"?g:Ar(+g),x(),f):i},f}const xL=1664525,yL=1013904223,_x=4294967296;function bL(){let n=1;return()=>(n=(xL*n+yL)%_x)/_x}var Tx=3;function Dd(n){return n.x}function wx(n){return n.y}function vL(n){return n.z}var _L=10,TL=Math.PI*(3-Math.sqrt(5)),wL=Math.PI*20/(9+Math.sqrt(221));function SL(n,e){e=e||2;var t=Math.min(Tx,Math.max(1,Math.round(e))),r,i=1,s=.001,o=1-Math.pow(s,1/300),a=0,c=.6,l=new Map,u=_m(f),d=ic("tick","end"),h=bL();n==null&&(n=[]);function f(){p(),d.call("tick",r),i<s&&(u.stop(),d.call("end",r))}function p(g){var y,v=n.length,_;g===void 0&&(g=1);for(var T=0;T<g;++T)for(i+=(a-i)*o,l.forEach(function(w){w(i)}),y=0;y<v;++y)_=n[y],_.fx==null?_.x+=_.vx*=c:(_.x=_.fx,_.vx=0),t>1&&(_.fy==null?_.y+=_.vy*=c:(_.y=_.fy,_.vy=0)),t>2&&(_.fz==null?_.z+=_.vz*=c:(_.z=_.fz,_.vz=0));return r}function m(){for(var g=0,y=n.length,v;g<y;++g){if(v=n[g],v.index=g,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),v.fz!=null&&(v.z=v.fz),isNaN(v.x)||t>1&&isNaN(v.y)||t>2&&isNaN(v.z)){var _=_L*(t>2?Math.cbrt(.5+g):t>1?Math.sqrt(.5+g):g),T=g*TL,w=g*wL;t===1?v.x=_:t===2?(v.x=_*Math.cos(T),v.y=_*Math.sin(T)):(v.x=_*Math.sin(T)*Math.cos(w),v.y=_*Math.cos(T),v.z=_*Math.sin(T)*Math.sin(w))}(isNaN(v.vx)||t>1&&isNaN(v.vy)||t>2&&isNaN(v.vz))&&(v.vx=0,t>1&&(v.vy=0),t>2&&(v.vz=0))}}function x(g){return g.initialize&&g.initialize(n,h,t),g}return m(),r={tick:p,restart:function(){return u.restart(f),r},stop:function(){return u.stop(),r},numDimensions:function(g){return arguments.length?(t=Math.min(Tx,Math.max(1,Math.round(g))),l.forEach(x),r):t},nodes:function(g){return arguments.length?(n=g,m(),l.forEach(x),r):n},alpha:function(g){return arguments.length?(i=+g,r):i},alphaMin:function(g){return arguments.length?(s=+g,r):s},alphaDecay:function(g){return arguments.length?(o=+g,r):+o},alphaTarget:function(g){return arguments.length?(a=+g,r):a},velocityDecay:function(g){return arguments.length?(c=1-g,r):1-c},randomSource:function(g){return arguments.length?(h=g,l.forEach(x),r):h},force:function(g,y){return arguments.length>1?(y==null?l.delete(g):l.set(g,x(y)),r):l.get(g)},find:function(){var g=Array.prototype.slice.call(arguments),y=g.shift()||0,v=(t>1?g.shift():null)||0,_=(t>2?g.shift():null)||0,T=g.shift()||1/0,w=0,N=n.length,S,C,B,D,U,$;for(T*=T,w=0;w<N;++w)U=n[w],S=y-U.x,C=v-(U.y||0),B=_-(U.z||0),D=S*S+C*C+B*B,D<T&&($=U,T=D);return $},on:function(g,y){return arguments.length>1?(d.on(g,y),r):d.on(g)}}}function NL(){var n,e,t,r,i,s=Ar(-30),o,a=1,c=1/0,l=.81;function u(p){var m,x=n.length,g=(e===1?i1(n,Dd):e===2?o1(n,Dd,wx):e===3?c1(n,Dd,wx,vL):null).visitAfter(h);for(i=p,m=0;m<x;++m)t=n[m],g.visit(f)}function d(){if(n){var p,m=n.length,x;for(o=new Array(m),p=0;p<m;++p)x=n[p],o[x.index]=+s(x,p,n)}}function h(p){var m=0,x,g,y=0,v,_,T,w,N=p.length;if(N){for(v=_=T=w=0;w<N;++w)(x=p[w])&&(g=Math.abs(x.value))&&(m+=x.value,y+=g,v+=g*(x.x||0),_+=g*(x.y||0),T+=g*(x.z||0));m*=Math.sqrt(4/N),p.x=v/y,e>1&&(p.y=_/y),e>2&&(p.z=T/y)}else{x=p,x.x=x.data.x,e>1&&(x.y=x.data.y),e>2&&(x.z=x.data.z);do m+=o[x.data.index];while(x=x.next)}p.value=m}function f(p,m,x,g,y){if(!p.value)return!0;var v=[x,g,y][e-1],_=p.x-t.x,T=e>1?p.y-t.y:0,w=e>2?p.z-t.z:0,N=v-m,S=_*_+T*T+w*w;if(N*N/l<S)return S<c&&(_===0&&(_=xr(r),S+=_*_),e>1&&T===0&&(T=xr(r),S+=T*T),e>2&&w===0&&(w=xr(r),S+=w*w),S<a&&(S=Math.sqrt(a*S)),t.vx+=_*p.value*i/S,e>1&&(t.vy+=T*p.value*i/S),e>2&&(t.vz+=w*p.value*i/S)),!0;if(p.length||S>=c)return;(p.data!==t||p.next)&&(_===0&&(_=xr(r),S+=_*_),e>1&&T===0&&(T=xr(r),S+=T*T),e>2&&w===0&&(w=xr(r),S+=w*w),S<a&&(S=Math.sqrt(a*S)));do p.data!==t&&(N=o[p.data.index]*i/S,t.vx+=_*N,e>1&&(t.vy+=T*N),e>2&&(t.vz+=w*N));while(p=p.next)}return u.initialize=function(p,...m){n=p,r=m.find(x=>typeof x=="function")||Math.random,e=m.find(x=>[1,2,3].includes(x))||2,d()},u.strength=function(p){return arguments.length?(s=typeof p=="function"?p:Ar(+p),d(),u):s},u.distanceMin=function(p){return arguments.length?(a=p*p,u):Math.sqrt(a)},u.distanceMax=function(p){return arguments.length?(c=p*p,u):Math.sqrt(c)},u.theta=function(p){return arguments.length?(l=p*p,u):Math.sqrt(l)},u}function AL(n,e,t,r){var i,s,o=Ar(.1),a,c;typeof n!="function"&&(n=Ar(+n)),e==null&&(e=0),t==null&&(t=0),r==null&&(r=0);function l(d){for(var h=0,f=i.length;h<f;++h){var p=i[h],m=p.x-e||1e-6,x=(p.y||0)-t||1e-6,g=(p.z||0)-r||1e-6,y=Math.sqrt(m*m+x*x+g*g),v=(c[h]-y)*a[h]*d/y;p.vx+=m*v,s>1&&(p.vy+=x*v),s>2&&(p.vz+=g*v)}}function u(){if(i){var d,h=i.length;for(a=new Array(h),c=new Array(h),d=0;d<h;++d)c[d]=+n(i[d],d,i),a[d]=isNaN(c[d])?0:+o(i[d],d,i)}}return l.initialize=function(d,...h){i=d,s=h.find(f=>[1,2,3].includes(f))||2,u()},l.strength=function(d){return arguments.length?(o=typeof d=="function"?d:Ar(+d),u(),l):o},l.radius=function(d){return arguments.length?(n=typeof d=="function"?d:Ar(+d),u(),l):n},l.x=function(d){return arguments.length?(e=+d,l):e},l.y=function(d){return arguments.length?(t=+d,l):t},l.z=function(d){return arguments.length?(r=+d,l):r},l}function EL(n){RL(n);const e=CL(n);return n.on=e.on,n.off=e.off,n.fire=e.fire,n}function CL(n){let e=Object.create(null);return{on:function(t,r,i){if(typeof r!="function")throw new Error("callback is expected to be a function");let s=e[t];return s||(s=e[t]=[]),s.push({callback:r,ctx:i}),n},off:function(t,r){if(typeof t>"u")return e=Object.create(null),n;if(e[t])if(typeof r!="function")delete e[t];else{const o=e[t];for(let a=0;a<o.length;++a)o[a].callback===r&&o.splice(a,1)}return n},fire:function(t){const r=e[t];if(!r)return n;let i;arguments.length>1&&(i=Array.prototype.slice.call(arguments,1));for(let s=0;s<r.length;++s){const o=r[s];o.callback.apply(o.ctx,i)}return n}}}function RL(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");const e=["on","fire","off"];for(let t=0;t<e.length;++t)if(n.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}function ML(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,r={},i=0,s=n.multigraph?_:v,o=[],a=R,c=R,l=R,u=R,d={version:20,addNode:m,addLink:y,removeLink:S,removeNode:g,getNode:x,getNodeCount:T,getLinkCount:w,getEdgeCount:w,getLinksCount:w,getNodesCount:T,getLinks:N,forEachNode:W,forEachLinkedNode:A,forEachLink:$,beginUpdate:l,endUpdate:u,clear:U,hasLink:B,hasNode:x,getLink:B,getLinkById:D};return EL(d),h(),d;function h(){var I=d.on;d.on=j;function j(){return d.beginUpdate=l=L,d.endUpdate=u=M,a=f,c=p,d.on=I,I.apply(d,arguments)}}function f(I,j){o.push({link:I,changeType:j})}function p(I,j){o.push({node:I,changeType:j})}function m(I,j){if(I===void 0)throw new Error("Invalid node identifier");l();var Z=x(I);return Z?(Z.data=j,c(Z,"update")):(Z=new PL(I,j),c(Z,"add")),e.set(I,Z),u(),Z}function x(I){return e.get(I)}function g(I){var j=x(I);if(!j)return!1;l();var Z=j.links;return Z&&(Z.forEach(C),j.links=null),e.delete(I),c(j,"remove"),u(),!0}function y(I,j,Z){l();var ee=x(I)||m(I),V=x(j)||m(j),Q=s(I,j,Z),te=t.has(Q.id);return t.set(Q.id,Q),Sx(ee,Q),I!==j&&Sx(V,Q),a(Q,te?"update":"add"),u(),Q}function v(I,j,Z){var ee=Cc(I,j),V=t.get(ee);return V?(V.data=Z,V):new Nx(I,j,Z,ee)}function _(I,j,Z){var ee=Cc(I,j),V=r.hasOwnProperty(ee);if(V||B(I,j)){V||(r[ee]=0);var Q="@"+ ++r[ee];ee=Cc(I+Q,j+Q)}return new Nx(I,j,Z,ee)}function T(){return e.size}function w(){return t.size}function N(I){var j=x(I);return j?j.links:null}function S(I,j){return j!==void 0&&(I=B(I,j)),C(I)}function C(I){if(!I||!t.get(I.id))return!1;l(),t.delete(I.id);var j=x(I.fromId),Z=x(I.toId);return j&&j.links.delete(I),Z&&Z.links.delete(I),a(I,"remove"),u(),!0}function B(I,j){if(!(I===void 0||j===void 0))return t.get(Cc(I,j))}function D(I){if(I!==void 0)return t.get(I)}function U(){l(),W(function(I){g(I.id)}),u()}function $(I){if(typeof I=="function")for(var j=t.values(),Z=j.next();!Z.done;){if(I(Z.value))return!0;Z=j.next()}}function A(I,j,Z){var ee=x(I);if(ee&&ee.links&&typeof j=="function")return Z?k(ee.links,I,j):O(ee.links,I,j)}function O(I,j,Z){for(var ee,V=I.values(),Q=V.next();!Q.done;){var te=Q.value,ce=te.fromId===j?te.toId:te.fromId;if(ee=Z(e.get(ce),te),ee)return!0;Q=V.next()}}function k(I,j,Z){for(var ee,V=I.values(),Q=V.next();!Q.done;){var te=Q.value;if(te.fromId===j&&(ee=Z(e.get(te.toId),te),ee))return!0;Q=V.next()}}function R(){}function L(){i+=1}function M(){i-=1,i===0&&o.length>0&&(d.fire("changed",o),o.length=0)}function W(I){if(typeof I!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+I);for(var j=e.values(),Z=j.next();!Z.done;){if(I(Z.value))return!0;Z=j.next()}}}function PL(n,e){this.id=n,this.links=null,this.data=e}function Sx(n,e){n.links?n.links.add(e):n.links=new Set([e])}function Nx(n,e,t,r){this.fromId=n,this.toId=e,this.data=t,this.id=r}function Cc(n,e){return n.toString()+" "+e.toString()}var Rc={exports:{}},xs={exports:{}},Bd,Ax;function l1(){return Ax||(Ax=1,Bd=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),Bd}var Fd,Ex;function _o(){if(Ex)return Fd;Ex=1;const n=l1();return Fd=function(t){return r;function r(i,s){let o=s&&s.indent||0,a=s&&s.join!==void 0?s.join:`
`,c=Array(o+1).join(" "),l=[];for(let u=0;u<t;++u){let d=n(u),h=u===0?"":c;l.push(h+i.replace(/{var}/g,d))}return l.join(a)}},Fd}var Cx;function DL(){if(Cx)return xs.exports;Cx=1;const n=_o();xs.exports=e,xs.exports.generateCreateBodyFunctionBody=t,xs.exports.getVectorCode=i,xs.exports.getBodyCode=r;function e(s,o){let a=t(s,o),{Body:c}=new Function(a)();return c}function t(s,o){return`
${i(s,o)}
${r(s)}
return {Body: Body, Vector: Vector};
`}function r(s){let o=n(s),a=o("{var}",{join:", "});return`
function Body(${a}) {
  this.isPinned = false;
  this.pos = new Vector(${a});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${a}) {
  ${o("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function i(s,o){let a=n(s),c="";return o&&(c=`${a(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${a("{var}",{join:", "})}) {
  ${c}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${a('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${a("this.{var} = v.{var};",{indent:4})}
    } else {
      ${a('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${a("this.{var} = ",{join:""})}0;
  };`}return xs.exports}var hr={exports:{}},Rx;function BL(){if(Rx)return hr.exports;Rx=1;const n=_o(),e=l1();hr.exports=t,hr.exports.generateQuadTreeFunctionBody=r,hr.exports.getInsertStackCode=c,hr.exports.getQuadNodeCode=a,hr.exports.isSamePosition=i,hr.exports.getChildBodyCode=o,hr.exports.setChildBodyCode=s;function t(l){let u=r(l);return new Function(u)()}function r(l){let u=n(l),d=Math.pow(2,l);return`
${c()}
${a(l)}
${i(l)}
${o(l)}
${s(l)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${m("      node.")}
      node.body = null;
      node.mass = ${u("node.mass_{var} = ",{join:""})}0;
      ${u("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${u("var d{var};",{indent:4})}
    var r; 
    ${u("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${u("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${u("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${u("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${u("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${u("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${u("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${p()}
        }
      }
    }

    ${u("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${u("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${u("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${u("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${u("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${u("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${u("root.min_{var} = {var}min;",{indent:4})}
    ${u("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${u("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${u("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${u("var min_{var} = node.min_{var};",{indent:8})}
        ${u("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${f(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${u("child.min_{var} = min_{var};",{indent:10})}
          ${u("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${u("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${u("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function f(x){let g=[],y=Array(x+1).join(" ");for(let v=0;v<l;++v)g.push(y+`if (${e(v)} > max_${e(v)}) {`),g.push(y+`  quadIdx = quadIdx + ${Math.pow(2,v)};`),g.push(y+`  min_${e(v)} = max_${e(v)};`),g.push(y+`  max_${e(v)} = node.max_${e(v)};`),g.push(y+"}");return g.join(`
`)}function p(){let x=Array(11).join(" "),g=[];for(let y=0;y<d;++y)g.push(x+`if (node.quad${y}) {`),g.push(x+`  queue[pushIdx] = node.quad${y};`),g.push(x+"  queueLength += 1;"),g.push(x+"  pushIdx += 1;"),g.push(x+"}");return g.join(`
`)}function m(x){let g=[];for(let y=0;y<d;++y)g.push(`${x}quad${y} = null;`);return g.join(`
`)}}function i(l){let u=n(l);return`
  function isSamePosition(point1, point2) {
    ${u("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${u("d{var} < 1e-8",{join:" && "})};
  }  
`}function s(l){var u=Math.pow(2,l);return`
function setChild(node, idx, child) {
  ${d()}
}`;function d(){let h=[];for(let f=0;f<u;++f){let p=f===0?"  ":"  else ";h.push(`${p}if (idx === ${f}) node.quad${f} = child;`)}return h.join(`
`)}}function o(l){return`function getChild(node, idx) {
${u()}
  return null;
}`;function u(){let d=[],h=Math.pow(2,l);for(let f=0;f<h;++f)d.push(`  if (idx === ${f}) return node.quad${f};`);return d.join(`
`)}}function a(l){let u=n(l),d=Math.pow(2,l);var h=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${f("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${u("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${u("this.min_{var} = 0;",{indent:2})}
  ${u("this.max_{var} = 0;",{indent:2})}
}
`;return h;function f(p){let m=[];for(let x=0;x<d;++x)m.push(`${p}quad${x} = null;`);return m.join(`
`)}}function c(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return hr.exports}var Mc={exports:{}},Mx;function FL(){if(Mx)return Mc.exports;Mx=1,Mc.exports=e,Mc.exports.generateFunctionBody=t;const n=_o();function e(r){let i=t(r);return new Function("bodies","settings","random",i)}function t(r){let i=n(r);return`
  var boundingBox = {
    ${i("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${i("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${i("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${i("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${i("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${i("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${i("var max_{var} = -Infinity;",{indent:4})}
    ${i("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${i("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${i("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${i("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${i("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${i("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return Mc.exports}var Pc={exports:{}},Px;function kL(){if(Px)return Pc.exports;Px=1;const n=_o();Pc.exports=e,Pc.exports.generateCreateDragForceFunctionBody=t;function e(r){let i=t(r);return new Function("options",i)}function t(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${n(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return Pc.exports}var Dc={exports:{}},Dx;function LL(){if(Dx)return Dc.exports;Dx=1;const n=_o();Dc.exports=e,Dc.exports.generateCreateSpringForceFunctionBody=t;function e(r){let i=t(r);return new Function("options","random",i)}function t(r){let i=n(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${i("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${i("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${i("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${i("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return Dc.exports}var Bc={exports:{}},Bx;function IL(){if(Bx)return Bc.exports;Bx=1;const n=_o();Bc.exports=e,Bc.exports.generateIntegratorFunctionBody=t;function e(r){let i=t(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",i)}function t(r){let i=n(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${i("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${i("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${i("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${i("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${i("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${i("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${i("body.pos.{var} += d{var};",{indent:4})}

    ${i("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${i("t{var} * t{var}",{join:" + "})})/length;
`}return Bc.exports}var kd,Fx;function OL(){if(Fx)return kd;Fx=1,kd=n;function n(e,t,r,i){this.from=e,this.to=t,this.length=r,this.coefficient=i}return kd}var Ld,kx;function UL(){if(kx)return Ld;kx=1,Ld=n;function n(e,t){var r;if(e||(e={}),t){for(r in t)if(t.hasOwnProperty(r)){var i=e.hasOwnProperty(r),s=typeof t[r],o=!i||typeof e[r]!==s;o?e[r]=t[r]:s==="object"&&(e[r]=n(e[r],t[r]))}}return e}return Ld}var Id,Lx;function u1(){if(Lx)return Id;Lx=1;function n(r){t(r);const i=e(r);return r.on=i.on,r.off=i.off,r.fire=i.fire,r}function e(r){let i=Object.create(null);return{on:function(s,o,a){if(typeof o!="function")throw new Error("callback is expected to be a function");let c=i[s];return c||(c=i[s]=[]),c.push({callback:o,ctx:a}),r},off:function(s,o){if(typeof s>"u")return i=Object.create(null),r;if(i[s])if(typeof o!="function")delete i[s];else{const a=i[s];for(let c=0;c<a.length;++c)a[c].callback===o&&a.splice(c,1)}return r},fire:function(s){const o=i[s];if(!o)return r;let a;arguments.length>1&&(a=Array.prototype.slice.call(arguments,1));for(let c=0;c<o.length;++c){const l=o[c];l.callback.apply(l.ctx,a)}return r}}}function t(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");const i=["on","fire","off"];for(let s=0;s<i.length;++s)if(r.hasOwnProperty(i[s]))throw new Error("Subject cannot be eventified, since it already has property '"+i[s]+"'")}return Id=n,Id}var Vo={exports:{}},Ix;function VL(){if(Ix)return Vo.exports;Ix=1,Vo.exports=n,Vo.exports.random=n,Vo.exports.randomIterator=a;function n(c){var l=typeof c=="number"?c:+new Date;return new e(l)}function e(c){this.seed=c}e.prototype.next=o,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t,e.prototype.random=s;function t(){var c,l,u;do l=this.nextDouble()*2-1,u=this.nextDouble()*2-1,c=l*l+u*u;while(c>=1||c===0);return l*Math.sqrt(-2*Math.log(c)/c)}e.prototype.levy=r;function r(){var c=1.5,l=Math.pow(i(1+c)*Math.sin(Math.PI*c/2)/(i((1+c)/2)*c*Math.pow(2,(c-1)/2)),1/c);return this.gaussian()*l/Math.pow(Math.abs(this.gaussian()),1/c)}function i(c){return Math.sqrt(2*Math.PI/c)*Math.pow(1/Math.E*(c+1/(12*c-1/(10*c))),c)}function s(){var c=this.seed;return c=c+2127912214+(c<<12)&4294967295,c=(c^3345072700^c>>>19)&4294967295,c=c+374761393+(c<<5)&4294967295,c=(c+3550635116^c<<9)&4294967295,c=c+4251993797+(c<<3)&4294967295,c=(c^3042594569^c>>>16)&4294967295,this.seed=c,(c&268435455)/268435456}function o(c){return Math.floor(this.nextDouble()*c)}function a(c,l){var u=l||n();if(typeof u.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:h,shuffle:d};function d(){var f,p,m;for(f=c.length-1;f>0;--f)p=u.next(f+1),m=c[p],c[p]=c[f],c[f]=m;return c}function h(f){var p,m,x;for(p=c.length-1;p>0;--p)m=u.next(p+1),x=c[m],c[m]=c[p],c[p]=x,f(x);c.length&&f(c[0])}}return Vo.exports}var Od,Ox;function Ux(){if(Ox)return Od;Ox=1,Od=a;var n=DL(),e=BL(),t=FL(),r=kL(),i=LL(),s=IL(),o={};function a(u){var d=OL(),h=UL(),f=u1();if(u){if(u.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(u.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}u=h(u,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var p=o[u.dimensions];if(!p){var m=u.dimensions;p={Body:n(m,u.debug),createQuadTree:e(m),createBounds:t(m),createDragForce:r(m),createSpringForce:i(m),integrate:s(m)},o[m]=p}var x=p.Body,g=p.createQuadTree,y=p.createBounds,v=p.createDragForce,_=p.createSpringForce,T=p.integrate,w=V=>new x(V),N=VL().random(42),S=[],C=[],B=g(u,N),D=y(S,u,N),U=_(u,N),$=v(u),A=0,O=[],k=new Map,R=0;W("nbody",Z),W("spring",ee);var L={bodies:S,quadTree:B,springs:C,settings:u,addForce:W,removeForce:I,getForces:j,step:function(){for(var V=0;V<O.length;++V)O[V](R);var Q=T(S,u.timeStep,u.adaptiveTimeStepWeight);return R+=1,Q},addBody:function(V){if(!V)throw new Error("Body is required");return S.push(V),V},addBodyAt:function(V){if(!V)throw new Error("Body position is required");var Q=w(V);return S.push(Q),Q},removeBody:function(V){if(V){var Q=S.indexOf(V);if(!(Q<0))return S.splice(Q,1),S.length===0&&D.reset(),!0}},addSpring:function(V,Q,te,ce){if(!V||!Q)throw new Error("Cannot add null spring to force simulator");typeof te!="number"&&(te=-1);var ye=new d(V,Q,te,ce>=0?ce:-1);return C.push(ye),ye},getTotalMovement:function(){return A},removeSpring:function(V){if(V){var Q=C.indexOf(V);if(Q>-1)return C.splice(Q,1),!0}},getBestNewBodyPosition:function(V){return D.getBestNewPosition(V)},getBBox:M,getBoundingBox:M,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(V){return V!==void 0?(u.gravity=V,B.options({gravity:V}),this):u.gravity},theta:function(V){return V!==void 0?(u.theta=V,B.options({theta:V}),this):u.theta},random:N};return c(u,L),f(L),L;function M(){return D.update(),D.box}function W(V,Q){if(k.has(V))throw new Error("Force "+V+" is already added");k.set(V,Q),O.push(Q)}function I(V){var Q=O.indexOf(k.get(V));Q<0||(O.splice(Q,1),k.delete(V))}function j(){return k}function Z(){if(S.length!==0){B.insertBodies(S);for(var V=S.length;V--;){var Q=S[V];Q.isPinned||(Q.reset(),B.updateBodyForce(Q),$.update(Q))}}}function ee(){for(var V=C.length;V--;)U.update(C[V])}}function c(u,d){for(var h in u)l(u,d,h)}function l(u,d,h){if(u.hasOwnProperty(h)&&typeof d[h]!="function"){var f=Number.isFinite(u[h]);f?d[h]=function(p){if(p!==void 0){if(!Number.isFinite(p))throw new Error("Value of "+h+" should be a valid number.");return u[h]=p,d}return u[h]}:d[h]=function(p){return p!==void 0?(u[h]=p,d):u[h]}}}return Od}var Vx;function GL(){if(Vx)return Rc.exports;Vx=1,Rc.exports=e,Rc.exports.simulator=Ux();var n=u1();function e(r,i){if(!r)throw new Error("Graph structure cannot be undefined");var s=i&&i.createSimulator||Ux(),o=s(i);if(Array.isArray(i))throw new Error("Physics settings is expected to be an object");var a=r.version>19?k:O;i&&typeof i.nodeMass=="function"&&(a=i.nodeMass);var c=new Map,l={},u=0,d=o.settings.springTransform||t;w(),v();var h=!1,f={step:function(){if(u===0)return p(!0),!0;var R=o.step();f.lastMove=R,f.fire("step");var L=R/u,M=L<=.01;return p(M),M},getNodePosition:function(R){return A(R).pos},setNodePosition:function(R){var L=A(R);L.setPosition.apply(L,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(R){var L=l[R];if(L)return{from:L.from.pos,to:L.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:m,pinNode:function(R,L){var M=A(R.id);M.isPinned=!!L},isNodePinned:function(R){return A(R.id).isPinned},dispose:function(){r.off("changed",T),f.fire("disposed")},getBody:y,getSpring:g,getForceVectorLength:x,simulator:o,graph:r,lastMove:0};return n(f),f;function p(R){h!==R&&(h=R,_(R))}function m(R){c.forEach(R)}function x(){var R=0,L=0;return m(function(M){R+=Math.abs(M.force.x),L+=Math.abs(M.force.y)}),Math.sqrt(R*R+L*L)}function g(R,L){var M;if(L===void 0)typeof R!="object"?M=R:M=R.id;else{var W=r.hasLink(R,L);if(!W)return;M=W.id}return l[M]}function y(R){return c.get(R)}function v(){r.on("changed",T)}function _(R){f.fire("stable",R)}function T(R){for(var L=0;L<R.length;++L){var M=R[L];M.changeType==="add"?(M.node&&N(M.node.id),M.link&&C(M.link)):M.changeType==="remove"&&(M.node&&S(M.node),M.link&&B(M.link))}u=r.getNodesCount()}function w(){u=0,r.forEachNode(function(R){N(R.id),u+=1}),r.forEachLink(C)}function N(R){var L=c.get(R);if(!L){var M=r.getNode(R);if(!M)throw new Error("initBody() was called with unknown node id");var W=M.position;if(!W){var I=D(M);W=o.getBestNewBodyPosition(I)}L=o.addBodyAt(W),L.id=R,c.set(R,L),U(R),$(M)&&(L.isPinned=!0)}}function S(R){var L=R.id,M=c.get(L);M&&(c.delete(L),o.removeBody(M))}function C(R){U(R.fromId),U(R.toId);var L=c.get(R.fromId),M=c.get(R.toId),W=o.addSpring(L,M,R.length);d(R,W),l[R.id]=W}function B(R){var L=l[R.id];if(L){var M=r.getNode(R.fromId),W=r.getNode(R.toId);M&&U(M.id),W&&U(W.id),delete l[R.id],o.removeSpring(L)}}function D(R){var L=[];if(!R.links)return L;for(var M=Math.min(R.links.length,2),W=0;W<M;++W){var I=R.links[W],j=I.fromId!==R.id?c.get(I.fromId):c.get(I.toId);j&&j.pos&&L.push(j)}return L}function U(R){var L=c.get(R);if(L.mass=a(R),Number.isNaN(L.mass))throw new Error("Node mass should be a number")}function $(R){return R&&(R.isPinned||R.data&&R.data.isPinned)}function A(R){var L=c.get(R);return L||(N(R),L=c.get(R)),L}function O(R){var L=r.getLinks(R);return L?1+L.length/3:1}function k(R){var L=r.getLinks(R);return L?1+L.size/3:1}}function t(){}return Rc.exports}var $L=GL();const jL=E_($L);function Wf(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var zL=typeof global=="object"&&global&&global.Object===Object&&global,HL=typeof self=="object"&&self&&self.Object===Object&&self,d1=zL||HL||Function("return this")(),Ud=function(){return d1.Date.now()},WL=/\s/;function qL(n){for(var e=n.length;e--&&WL.test(n.charAt(e)););return e}var XL=/^\s+/;function KL(n){return n&&n.slice(0,qL(n)+1).replace(XL,"")}var ru=d1.Symbol,h1=Object.prototype,YL=h1.hasOwnProperty,QL=h1.toString,Go=ru?ru.toStringTag:void 0;function ZL(n){var e=YL.call(n,Go),t=n[Go];try{n[Go]=void 0;var r=!0}catch{}var i=QL.call(n);return r&&(e?n[Go]=t:delete n[Go]),i}var JL=Object.prototype,eI=JL.toString;function tI(n){return eI.call(n)}var nI="[object Null]",rI="[object Undefined]",Gx=ru?ru.toStringTag:void 0;function iI(n){return n==null?n===void 0?rI:nI:Gx&&Gx in Object(n)?ZL(n):tI(n)}function sI(n){return n!=null&&typeof n=="object"}var oI="[object Symbol]";function aI(n){return typeof n=="symbol"||sI(n)&&iI(n)==oI}var $x=NaN,cI=/^[-+]0x[0-9a-f]+$/i,lI=/^0b[01]+$/i,uI=/^0o[0-7]+$/i,dI=parseInt;function jx(n){if(typeof n=="number")return n;if(aI(n))return $x;if(Wf(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Wf(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=KL(n);var t=lI.test(n);return t||uI.test(n)?dI(n.slice(2),t?2:8):cI.test(n)?$x:+n}var hI="Expected a function",fI=Math.max,pI=Math.min;function mI(n,e,t){var r,i,s,o,a,c,l=0,u=!1,d=!1,h=!0;if(typeof n!="function")throw new TypeError(hI);e=jx(e)||0,Wf(t)&&(u=!!t.leading,d="maxWait"in t,s=d?fI(jx(t.maxWait)||0,e):s,h="trailing"in t?!!t.trailing:h);function f(w){var N=r,S=i;return r=i=void 0,l=w,o=n.apply(S,N),o}function p(w){return l=w,a=setTimeout(g,e),u?f(w):o}function m(w){var N=w-c,S=w-l,C=e-N;return d?pI(C,s-S):C}function x(w){var N=w-c,S=w-l;return c===void 0||N>=e||N<0||d&&S>=s}function g(){var w=Ud();if(x(w))return y(w);a=setTimeout(g,m(w))}function y(w){return a=void 0,h&&r?f(w):(r=i=void 0,o)}function v(){a!==void 0&&clearTimeout(a),l=0,r=c=i=a=void 0}function _(){return a===void 0?o:y(Ud())}function T(){var w=Ud(),N=x(w);if(r=arguments,i=this,c=w,N){if(a===void 0)return p(c);if(d)return clearTimeout(a),a=setTimeout(g,e),f(c)}return a===void 0&&(a=setTimeout(g,e)),o}return T.cancel=v,T.flush=_,T}function zx(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function gI(n){if(Array.isArray(n))return n}function xI(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function yI(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function bI(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function vI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _I(n,e){return gI(n)||bI(n,e)||TI(n,e)||vI()}function TI(n,e){if(n){if(typeof n=="string")return zx(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?zx(n,e):void 0}}var wI=yI(function n(e,t){var r=t.default,i=r===void 0?null:r,s=t.triggerUpdate,o=s===void 0?!0:s,a=t.onChange,c=a===void 0?function(l,u){}:a;xI(this,n),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=c});function ju(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,r=n.props,i=r===void 0?{}:r,s=n.methods,o=s===void 0?{}:s,a=n.aliases,c=a===void 0?{}:a,l=n.init,u=l===void 0?function(){}:l,d=n.update,h=d===void 0?function(){}:d,f=Object.keys(i).map(function(p){return new wI(p,i[p])});return function p(){for(var m=arguments.length,x=new Array(m),g=0;g<m;g++)x[g]=arguments[g];var y=!!(this instanceof p&&this.constructor),v=y?x.shift():void 0,_=x[0],T=_===void 0?{}:_,w=Object.assign({},t instanceof Function?t(T):t,{initialised:!1}),N={};function S(D){return C(D,T),B(),S}var C=function(U,$){u.call(S,U,w,$),w.initialised=!0},B=mI(function(){w.initialised&&(h.call(S,w,N),N={})},1);return f.forEach(function(D){S[D.name]=U(D);function U($){var A=$.name,O=$.triggerUpdate,k=O===void 0?!1:O,R=$.onChange,L=R===void 0?function(I,j){}:R,M=$.defaultVal,W=M===void 0?null:M;return function(I){var j=w[A];if(!arguments.length)return j;var Z=I===void 0?W:I;return w[A]=Z,L.call(S,Z,w,j),!N.hasOwnProperty(A)&&(N[A]=j),k&&B(),S}}}),Object.keys(o).forEach(function(D){S[D]=function(){for(var U,$=arguments.length,A=new Array($),O=0;O<$;O++)A[O]=arguments[O];return(U=o[D]).call.apply(U,[S,w].concat(A))}}),Object.entries(c).forEach(function(D){var U=_I(D,2),$=U[0],A=U[1];return S[$]=S[A]}),S.resetProps=function(){return f.forEach(function(D){S[D.name](D.defaultVal)}),S},S.resetProps(),w._rerender=B,y&&v&&S(v),S}}var Ae=(function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}});function Nl(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function SI(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function f1(n){let e,t,r;n.length!==2?(e=Nl,t=(a,c)=>Nl(n(a),c),r=(a,c)=>n(a)-c):(e=n===Nl||n===SI?n:NI,t=n,r=n);function i(a,c,l=0,u=a.length){if(l<u){if(e(c,c)!==0)return u;do{const d=l+u>>>1;t(a[d],c)<0?l=d+1:u=d}while(l<u)}return l}function s(a,c,l=0,u=a.length){if(l<u){if(e(c,c)!==0)return u;do{const d=l+u>>>1;t(a[d],c)<=0?l=d+1:u=d}while(l<u)}return l}function o(a,c,l=0,u=a.length){const d=i(a,c,l,u-1);return d>l&&r(a[d-1],c)>-r(a[d],c)?d-1:d}return{left:i,center:o,right:s}}function NI(){return 0}function AI(n){return n===null?NaN:+n}const EI=f1(Nl),CI=EI.right;f1(AI).center;function Hx(n,e){let t,r;if(e===void 0)for(const i of n)i!=null&&(t===void 0?i>=i&&(t=r=i):(t>i&&(t=i),r<i&&(r=i)));else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(t===void 0?s>=s&&(t=r=s):(t>s&&(t=s),r<s&&(r=s)))}return[t,r]}class Wx extends Map{constructor(e,t=PI){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(qx(this,e))}has(e){return super.has(qx(this,e))}set(e,t){return super.set(RI(this,e),t)}delete(e){return super.delete(MI(this,e))}}function qx({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):t}function RI({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):(n.set(r,t),t)}function MI({_intern:n,_key:e},t){const r=e(t);return n.has(r)&&(t=n.get(r),n.delete(r)),t}function PI(n){return n!==null&&typeof n=="object"?n.valueOf():n}const DI=Math.sqrt(50),BI=Math.sqrt(10),FI=Math.sqrt(2);function iu(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=DI?10:s>=BI?5:s>=FI?2:1;let a,c,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(n*l),c=Math.round(e*l),a/l<n&&++a,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*o,a=Math.round(n/l),c=Math.round(e/l),a*l<n&&++a,c*l>e&&--c),c<a&&.5<=t&&t<2?iu(n,e,t*2):[a,c,l]}function kI(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,s,o]=r?iu(e,n,t):iu(n,e,t);if(!(s>=i))return[];const a=s-i+1,c=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)c[l]=(s-l)/-o;else for(let l=0;l<a;++l)c[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)c[l]=(i+l)/-o;else for(let l=0;l<a;++l)c[l]=(i+l)*o;return c}function qf(n,e,t){return e=+e,n=+n,t=+t,iu(n,e,t)[2]}function LI(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?qf(e,n,t):qf(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function II(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t<i||t===void 0&&i>=i)&&(t=i)}return t}function OI(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t>i||t===void 0&&i>=i)&&(t=i)}return t}function UI(n,e,t){n=+n,e=+e,t=(i=arguments.length)<2?(e=n,n=0,1):i<3?1:+t;for(var r=-1,i=Math.max(0,Math.ceil((e-n)/t))|0,s=new Array(i);++r<i;)s[r]=n+r*t;return s}function Xf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function VI(n){if(Array.isArray(n))return n}function GI(n){if(Array.isArray(n))return Xf(n)}function p1(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function $I(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function jI(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Dt(n,e){return n.get(p1(n,e))}function ys(n,e,t){$I(n,e),e.set(n,t)}function Fc(n,e,t){return n.set(p1(n,e),t),t}function zI(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,JI(r.key),r)}}function HI(n,e,t){return e&&zI(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function WI(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function qI(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function XI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KI(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YI(n,e){return VI(n)||qI(n,e)||m1(n,e)||XI()}function QI(n){return GI(n)||WI(n)||m1(n)||KI()}function ZI(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function JI(n){var e=ZI(n,"string");return typeof e=="symbol"?e:e+""}function m1(n,e){if(n){if(typeof n=="string")return Xf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Xf(n,e):void 0}}var bs=new WeakMap,$o=new WeakMap,vs=new WeakMap,Vd=new WeakMap,Gd=new WeakMap,$d=new WeakMap,eO=(function(){function n(){jI(this,n),ys(this,bs,new Map),ys(this,$o,new Map),ys(this,vs,function(e){return e}),ys(this,Vd,function(){return{}}),ys(this,Gd,function(){}),ys(this,$d,function(){})}return HI(n,[{key:"getObj",value:function(t){return Dt(bs,this).get(Dt(vs,this).call(this,t))}},{key:"getData",value:function(t){return Dt($o,this).get(t)}},{key:"entries",value:function(){return QI(Dt($o,this).entries()).map(function(t){var r=YI(t,2),i=r[0],s=r[1];return[s,i]})}},{key:"id",value:function(t){return Fc(vs,this,Ae(t)),this}},{key:"onCreateObj",value:function(t){return Fc(Vd,this,t),this}},{key:"onUpdateObj",value:function(t){return Fc(Gd,this,t),this}},{key:"onRemoveObj",value:function(t){return Fc($d,this,t),this}},{key:"digest",value:function(t){var r=this;t.filter(function(s){return!Dt(bs,r).has(Dt(vs,r).call(r,s))}).forEach(function(s){var o=Dt(Vd,r).call(r,s);Dt(bs,r).set(Dt(vs,r).call(r,s),o),Dt($o,r).set(o,s)});var i=new Map(t.map(function(s){return[Dt(vs,r).call(r,s),s]}));return Dt(bs,this).forEach(function(s,o){i.has(o)?Dt(Gd,r).call(r,s,i.get(o)):(Dt($d,r).call(r,s,o),Dt(bs,r).delete(o),Dt($o,r).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])})();function Um(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function tO(n,e){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const Xx=Symbol("implicit");function zu(){var n=new Wx,e=[],t=[],r=Xx;function i(s){let o=n.get(s);if(o===void 0){if(r!==Xx)return r;n.set(s,o=e.push(s)-1)}return t[o%t.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],n=new Wx;for(const o of s)n.has(o)||n.set(o,e.push(o)-1);return i},i.range=function(s){return arguments.length?(t=Array.from(s),i):t.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return zu(e,t).unknown(r)},Um.apply(i,arguments),i}function g1(){var n=zu().unknown(void 0),e=n.domain,t=n.range,r=0,i=1,s,o,a=!1,c=0,l=0,u=.5;delete n.unknown;function d(){var h=e().length,f=i<r,p=f?i:r,m=f?r:i;s=(m-p)/Math.max(1,h-c+l*2),a&&(s=Math.floor(s)),p+=(m-p-s*(h-c))*u,o=s*(1-c),a&&(p=Math.round(p),o=Math.round(o));var x=UI(h).map(function(g){return p+s*g});return t(f?x.reverse():x)}return n.domain=function(h){return arguments.length?(e(h),d()):e()},n.range=function(h){return arguments.length?([r,i]=h,r=+r,i=+i,d()):[r,i]},n.rangeRound=function(h){return[r,i]=h,r=+r,i=+i,a=!0,d()},n.bandwidth=function(){return o},n.step=function(){return s},n.round=function(h){return arguments.length?(a=!!h,d()):a},n.padding=function(h){return arguments.length?(c=Math.min(1,l=+h),d()):c},n.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),d()):c},n.paddingOuter=function(h){return arguments.length?(l=+h,d()):l},n.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),d()):u},n.copy=function(){return g1(e(),[r,i]).round(a).paddingInner(c).paddingOuter(l).align(u)},Um.apply(d(),arguments)}function x1(n){var e=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return x1(e())},n}function nO(){return x1(g1.apply(null,arguments).paddingInner(1))}function rO(n){return function(){return n}}function iO(n){return+n}var Kx=[0,1];function Yr(n){return n}function Kf(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:rO(isNaN(e)?NaN:.5)}function sO(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function oO(n,e,t){var r=n[0],i=n[1],s=e[0],o=e[1];return i<r?(r=Kf(i,r),s=t(o,s)):(r=Kf(r,i),s=t(s,o)),function(a){return s(r(a))}}function aO(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=Kf(n[o],n[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var c=CI(n,a,1,r)-1;return s[c](i[c](a))}}function cO(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function lO(){var n=Kx,e=Kx,t=Ou,r,i,s,o=Yr,a,c,l;function u(){var h=Math.min(n.length,e.length);return o!==Yr&&(o=sO(n[0],n[h-1])),a=h>2?aO:oO,c=l=null,d}function d(h){return h==null||isNaN(h=+h)?s:(c||(c=a(n.map(r),e,t)))(r(o(h)))}return d.invert=function(h){return o(i((l||(l=a(e,n.map(r),Cn)))(h)))},d.domain=function(h){return arguments.length?(n=Array.from(h,iO),u()):n.slice()},d.range=function(h){return arguments.length?(e=Array.from(h),u()):e.slice()},d.rangeRound=function(h){return e=Array.from(h),t=zT,u()},d.clamp=function(h){return arguments.length?(o=h?!0:Yr,u()):o!==Yr},d.interpolate=function(h){return arguments.length?(t=h,u()):t},d.unknown=function(h){return arguments.length?(s=h,d):s},function(h,f){return r=h,i=f,u()}}function uO(){return lO()(Yr,Yr)}function dO(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function su(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function oo(n){return n=su(Math.abs(n)),n?n[1]:NaN}function hO(n,e){return function(t,r){for(var i=t.length,s=[],o=0,a=n[0],c=0;i>0&&a>0&&(c+a+1>r&&(a=Math.max(1,r-c)),s.push(t.substring(i-=a,i+a)),!((c+=a+1)>r));)a=n[o=(o+1)%n.length];return s.reverse().join(e)}}function fO(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var pO=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ou(n){if(!(e=pO.exec(n)))throw new Error("invalid format: "+n);var e;return new Vm({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ou.prototype=Vm.prototype;function Vm(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Vm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function mO(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var y1;function gO(n,e){var t=su(n,e);if(!t)return n+"";var r=t[0],i=t[1],s=i-(y1=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+su(n,Math.max(0,e+s-1))[0]}function Yx(n,e){var t=su(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Qx={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:dO,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>Yx(n*100,e),r:Yx,s:gO,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Zx(n){return n}var Jx=Array.prototype.map,ey=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function xO(n){var e=n.grouping===void 0||n.thousands===void 0?Zx:hO(Jx.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",s=n.numerals===void 0?Zx:fO(Jx.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"":n.minus+"",c=n.nan===void 0?"NaN":n.nan+"";function l(d){d=ou(d);var h=d.fill,f=d.align,p=d.sign,m=d.symbol,x=d.zero,g=d.width,y=d.comma,v=d.precision,_=d.trim,T=d.type;T==="n"?(y=!0,T="g"):Qx[T]||(v===void 0&&(v=12),_=!0,T="g"),(x||h==="0"&&f==="=")&&(x=!0,h="0",f="=");var w=m==="$"?t:m==="#"&&/[boxX]/.test(T)?"0"+T.toLowerCase():"",N=m==="$"?r:/[%p]/.test(T)?o:"",S=Qx[T],C=/[defgprs%]/.test(T);v=v===void 0?6:/[gprs]/.test(T)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function B(D){var U=w,$=N,A,O,k;if(T==="c")$=S(D)+$,D="";else{D=+D;var R=D<0||1/D<0;if(D=isNaN(D)?c:S(Math.abs(D),v),_&&(D=mO(D)),R&&+D==0&&p!=="+"&&(R=!1),U=(R?p==="("?p:a:p==="-"||p==="("?"":p)+U,$=(T==="s"?ey[8+y1/3]:"")+$+(R&&p==="("?")":""),C){for(A=-1,O=D.length;++A<O;)if(k=D.charCodeAt(A),48>k||k>57){$=(k===46?i+D.slice(A+1):D.slice(A))+$,D=D.slice(0,A);break}}}y&&!x&&(D=e(D,1/0));var L=U.length+D.length+$.length,M=L<g?new Array(g-L+1).join(h):"";switch(y&&x&&(D=e(M+D,M.length?g-$.length:1/0),M=""),f){case"<":D=U+D+$+M;break;case"=":D=U+M+D+$;break;case"^":D=M.slice(0,L=M.length>>1)+U+D+$+M.slice(L);break;default:D=M+U+D+$;break}return s(D)}return B.toString=function(){return d+""},B}function u(d,h){var f=l((d=ou(d),d.type="f",d)),p=Math.max(-8,Math.min(8,Math.floor(oo(h)/3)))*3,m=Math.pow(10,-p),x=ey[8+p/3];return function(g){return f(m*g)+x}}return{format:l,formatPrefix:u}}var kc,b1,v1;yO({thousands:",",grouping:[3],currency:["$",""]});function yO(n){return kc=xO(n),b1=kc.format,v1=kc.formatPrefix,kc}function bO(n){return Math.max(0,-oo(Math.abs(n)))}function vO(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(oo(e)/3)))*3-oo(Math.abs(n)))}function _O(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,oo(e)-oo(n))+1}function TO(n,e,t,r){var i=LI(n,e,t),s;switch(r=ou(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(s=vO(i,o))&&(r.precision=s),v1(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=_O(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=bO(i))&&(r.precision=s-(r.type==="%")*2);break}}return b1(r)}function _1(n){var e=n.domain;return n.ticks=function(t){var r=e();return kI(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return TO(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],c,l,u=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);u-- >0;){if(l=qf(o,a,t),l===c)return r[i]=o,r[s]=a,e(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;c=l}return n},n}function T1(){var n=uO();return n.copy=function(){return cO(n,T1())},Um.apply(n,arguments),_1(n)}function wO(){var n=0,e=1,t,r,i,s,o=Yr,a=!1,c;function l(d){return d==null||isNaN(d=+d)?c:o(i===0?.5:(d=(s(d)-t)*i,a?Math.max(0,Math.min(1,d)):d))}l.domain=function(d){return arguments.length?([n,e]=d,t=s(n=+n),r=s(e=+e),i=t===r?0:1/(r-t),l):[n,e]},l.clamp=function(d){return arguments.length?(a=!!d,l):a},l.interpolator=function(d){return arguments.length?(o=d,l):o};function u(d){return function(h){var f,p;return arguments.length?([f,p]=h,o=d(f,p),l):[o(0),o(1)]}}return l.range=u(Ou),l.rangeRound=u(zT),l.unknown=function(d){return arguments.length?(c=d,l):c},function(d){return s=d,t=d(n),r=d(e),i=t===r?0:1/(r-t),l}}function SO(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function w1(){var n=_1(wO()(Yr));return n.copy=function(){return SO(n,w1())},tO.apply(n,arguments)}function S1(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}const NO=S1("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),AO=S1("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");XT(oi(-100,.75,.35),oi(80,1.5,.8));var EO=XT(oi(260,.75,.35),oi(80,1.5,.8));oi();function au(n){"@babel/helpers - typeof";return au=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},au(n)}var CO=/^\s+/,RO=/\s+$/;function de(n,e){if(n=n||"",e=e||{},n instanceof de)return n;if(!(this instanceof de))return new de(n,e);var t=MO(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}de.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,r,i,s,o,a;return t=e.r/255,r=e.g/255,i=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),i<=.03928?a=i/12.92:a=Math.pow((i+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a},setAlpha:function(e){return this._a=N1(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=ny(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=ny(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+i+"%)":"hsva("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=ty(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=ty(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+i+"%)":"hsla("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return ry(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return FO(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ye(this._r,255)*100)+"%",g:Math.round(Ye(this._g,255)*100)+"%",b:Math.round(Ye(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ye(this._r,255)*100)+"%, "+Math.round(Ye(this._g,255)*100)+"%, "+Math.round(Ye(this._b,255)*100)+"%)":"rgba("+Math.round(Ye(this._r,255)*100)+"%, "+Math.round(Ye(this._g,255)*100)+"%, "+Math.round(Ye(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:WO[ry(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+iy(this._r,this._g,this._b,this._a),r=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var s=de(e);r="#"+iy(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,i=this._a<1&&this._a>=0,s=!t&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return de(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(OO,arguments)},brighten:function(){return this._applyModification(UO,arguments)},darken:function(){return this._applyModification(VO,arguments)},desaturate:function(){return this._applyModification(kO,arguments)},saturate:function(){return this._applyModification(LO,arguments)},greyscale:function(){return this._applyModification(IO,arguments)},spin:function(){return this._applyModification(GO,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(zO,arguments)},complement:function(){return this._applyCombination($O,arguments)},monochromatic:function(){return this._applyCombination(HO,arguments)},splitcomplement:function(){return this._applyCombination(jO,arguments)},triad:function(){return this._applyCombination(sy,[3])},tetrad:function(){return this._applyCombination(sy,[4])}};de.fromRatio=function(n,e){if(au(n)=="object"){var t={};for(var r in n)n.hasOwnProperty(r)&&(r==="a"?t[r]=n[r]:t[r]=la(n[r]));n=t}return de(n,e)};function MO(n){var e={r:0,g:0,b:0},t=1,r=null,i=null,s=null,o=!1,a=!1;return typeof n=="string"&&(n=YO(n)),au(n)=="object"&&(fr(n.r)&&fr(n.g)&&fr(n.b)?(e=PO(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):fr(n.h)&&fr(n.s)&&fr(n.v)?(r=la(n.s),i=la(n.v),e=BO(n.h,r,i),o=!0,a="hsv"):fr(n.h)&&fr(n.s)&&fr(n.l)&&(r=la(n.s),s=la(n.l),e=DO(n.h,r,s),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=N1(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function PO(n,e,t){return{r:Ye(n,255)*255,g:Ye(e,255)*255,b:Ye(t,255)*255}}function ty(n,e,t){n=Ye(n,255),e=Ye(e,255),t=Ye(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=(r+i)/2;if(r==i)s=o=0;else{var c=r-i;switch(o=a>.5?c/(2-r-i):c/(r+i),r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,l:a}}function DO(n,e,t){var r,i,s;n=Ye(n,360),e=Ye(e,100),t=Ye(t,100);function o(l,u,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?l+(u-l)*6*d:d<1/2?u:d<2/3?l+(u-l)*(2/3-d)*6:l}if(e===0)r=i=s=t;else{var a=t<.5?t*(1+e):t+e-t*e,c=2*t-a;r=o(c,a,n+1/3),i=o(c,a,n),s=o(c,a,n-1/3)}return{r:r*255,g:i*255,b:s*255}}function ny(n,e,t){n=Ye(n,255),e=Ye(e,255),t=Ye(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=r,c=r-i;if(o=r===0?0:c/r,r==i)s=0;else{switch(r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,v:a}}function BO(n,e,t){n=Ye(n,360)*6,e=Ye(e,100),t=Ye(t,100);var r=Math.floor(n),i=n-r,s=t*(1-e),o=t*(1-i*e),a=t*(1-(1-i)*e),c=r%6,l=[t,o,s,s,a,t][c],u=[a,t,t,o,s,s][c],d=[s,s,a,t,t,o][c];return{r:l*255,g:u*255,b:d*255}}function ry(n,e,t,r){var i=[Bn(Math.round(n).toString(16)),Bn(Math.round(e).toString(16)),Bn(Math.round(t).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function FO(n,e,t,r,i){var s=[Bn(Math.round(n).toString(16)),Bn(Math.round(e).toString(16)),Bn(Math.round(t).toString(16)),Bn(A1(r))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function iy(n,e,t,r){var i=[Bn(A1(r)),Bn(Math.round(n).toString(16)),Bn(Math.round(e).toString(16)),Bn(Math.round(t).toString(16))];return i.join("")}de.equals=function(n,e){return!n||!e?!1:de(n).toRgbString()==de(e).toRgbString()};de.random=function(){return de.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function kO(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.s-=e/100,t.s=Hu(t.s),de(t)}function LO(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.s+=e/100,t.s=Hu(t.s),de(t)}function IO(n){return de(n).desaturate(100)}function OO(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.l+=e/100,t.l=Hu(t.l),de(t)}function UO(n,e){e=e===0?0:e||10;var t=de(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),de(t)}function VO(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.l-=e/100,t.l=Hu(t.l),de(t)}function GO(n,e){var t=de(n).toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,de(t)}function $O(n){var e=de(n).toHsl();return e.h=(e.h+180)%360,de(e)}function sy(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=de(n).toHsl(),r=[de(n)],i=360/e,s=1;s<e;s++)r.push(de({h:(t.h+s*i)%360,s:t.s,l:t.l}));return r}function jO(n){var e=de(n).toHsl(),t=e.h;return[de(n),de({h:(t+72)%360,s:e.s,l:e.l}),de({h:(t+216)%360,s:e.s,l:e.l})]}function zO(n,e,t){e=e||6,t=t||30;var r=de(n).toHsl(),i=360/t,s=[de(n)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(de(r));return s}function HO(n,e){e=e||6;for(var t=de(n).toHsv(),r=t.h,i=t.s,s=t.v,o=[],a=1/e;e--;)o.push(de({h:r,s:i,v:s})),s=(s+a)%1;return o}de.mix=function(n,e,t){t=t===0?0:t||50;var r=de(n).toRgb(),i=de(e).toRgb(),s=t/100,o={r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a};return de(o)};de.readability=function(n,e){var t=de(n),r=de(e);return(Math.max(t.getLuminance(),r.getLuminance())+.05)/(Math.min(t.getLuminance(),r.getLuminance())+.05)};de.isReadable=function(n,e,t){var r=de.readability(n,e),i,s;switch(s=!1,i=QO(t),i.level+i.size){case"AAsmall":case"AAAlarge":s=r>=4.5;break;case"AAlarge":s=r>=3;break;case"AAAsmall":s=r>=7;break}return s};de.mostReadable=function(n,e,t){var r=null,i=0,s,o,a,c;t=t||{},o=t.includeFallbackColors,a=t.level,c=t.size;for(var l=0;l<e.length;l++)s=de.readability(n,e[l]),s>i&&(i=s,r=de(e[l]));return de.isReadable(n,r,{level:a,size:c})||!o?r:(t.includeFallbackColors=!1,de.mostReadable(n,["#fff","#000"],t))};var Yf=de.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},WO=de.hexNames=qO(Yf);function qO(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function N1(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function Ye(n,e){XO(n)&&(n="100%");var t=KO(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function Hu(n){return Math.min(1,Math.max(0,n))}function nn(n){return parseInt(n,16)}function XO(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function KO(n){return typeof n=="string"&&n.indexOf("%")!=-1}function Bn(n){return n.length==1?"0"+n:""+n}function la(n){return n<=1&&(n=n*100+"%"),n}function A1(n){return Math.round(parseFloat(n)*255).toString(16)}function oy(n){return nn(n)/255}var wn=(function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function fr(n){return!!wn.CSS_UNIT.exec(n)}function YO(n){n=n.replace(CO,"").replace(RO,"").toLowerCase();var e=!1;if(Yf[n])n=Yf[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=wn.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=wn.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=wn.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=wn.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=wn.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=wn.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=wn.hex8.exec(n))?{r:nn(t[1]),g:nn(t[2]),b:nn(t[3]),a:oy(t[4]),format:e?"name":"hex8"}:(t=wn.hex6.exec(n))?{r:nn(t[1]),g:nn(t[2]),b:nn(t[3]),format:e?"name":"hex"}:(t=wn.hex4.exec(n))?{r:nn(t[1]+""+t[1]),g:nn(t[2]+""+t[2]),b:nn(t[3]+""+t[3]),a:oy(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=wn.hex3.exec(n))?{r:nn(t[1]+""+t[1]),g:nn(t[2]+""+t[2]),b:nn(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function QO(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Qf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function ZO(n){if(Array.isArray(n))return n}function JO(n){if(Array.isArray(n))return Qf(n)}function E1(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function eU(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function C1(n,e,t){return e=ao(e),cU(n,Gm()?Reflect.construct(e,t||[],ao(n).constructor):e.apply(n,t))}function tU(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function R1(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function jd(n,e){return n.get(E1(n,e))}function ay(n,e,t){tU(n,e),e.set(n,t)}function cy(n,e,t){return n.set(E1(n,e),t),t}function M1(n,e,t){if(Gm())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return i}function nU(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,B1(r.key),r)}}function P1(n,e,t){return e&&nU(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function Wu(n,e,t){return(e=B1(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Zf(){return Zf=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=lU(n,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?n:t):i.value}},Zf.apply(null,arguments)}function ao(n){return ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ao(n)}function D1(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Jf(n,e)}function Gm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gm=function(){return!!n})()}function rU(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function iU(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function sU(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oU(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ly(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function aU(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ly(Object(t),!0).forEach(function(r){Wu(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ly(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function cU(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eU(n)}function Jf(n,e){return Jf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Jf(n,e)}function va(n,e){return ZO(n)||iU(n,e)||F1(n,e)||sU()}function lU(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=ao(n))!==null;);return n}function zd(n,e,t,r){var i=Zf(ao(n.prototype),e,t);return typeof i=="function"?function(s){return i.apply(t,s)}:i}function An(n){return JO(n)||rU(n)||F1(n)||oU()}function uU(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function B1(n){var e=uU(n,"string");return typeof e=="symbol"?e:e+""}function ep(n){"@babel/helpers - typeof";return ep=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ep(n)}function F1(n,e){if(n){if(typeof n=="string")return Qf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Qf(n,e):void 0}}var k1=function(e){e instanceof Array?e.forEach(k1):(e.map&&e.map.dispose(),e.dispose())},L1=function(e){e.geometry&&e.geometry.dispose(),e.material&&k1(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(L1)},tp=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),L1(t)}},Hd=new WeakMap,Lc=new WeakMap,jo=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.dataBindAttr,o=s===void 0?"__data":s,a=i.objBindAttr,c=a===void 0?"__threeObj":a;return R1(this,e),r=C1(this,e),Wu(r,"scene",void 0),ay(r,Hd,void 0),ay(r,Lc,void 0),r.scene=t,cy(Hd,r,o),cy(Lc,r,c),r.onRemoveObj(function(){}),r}return D1(e,n),P1(e,[{key:"onCreateObj",value:function(r){var i=this;return zd(e,"onCreateObj",this)([function(s){var o=r(s);return s[jd(Lc,i)]=o,o[jd(Hd,i)]=s,i.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(r){var i=this;return zd(e,"onRemoveObj",this)([function(s,o){var a=zd(e,"getData",i)([s]);r(s,o),i.scene.remove(s),tp(s),delete a[jd(Lc,i)]}]),this}}])})(eO),zo=function(e){return isNaN(e)?parseInt(de(e).toHex(),16):e},Wd=function(e){return isNaN(e)?de(e).getAlpha():1},dU=zu(AO);function uy(n,e,t){!e||typeof t!="string"||n.filter(function(r){return!r[t]}).forEach(function(r){r[t]=dU(e(r))})}function hU(n,e){var t=n.nodes,r=n.links,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.nodeFilter,o=s===void 0?function(){return!0}:s,a=i.onLoopError,c=a===void 0?function(f){throw"Invalid DAG structure! Found cycle in node path: ".concat(f.join(" -> "),".")}:a,l={};t.forEach(function(f){return l[e(f)]={data:f,out:[],depth:-1,skip:!o(f)}}),r.forEach(function(f){var p=f.source,m=f.target,x=_(p),g=_(m);if(!l.hasOwnProperty(x))throw"Missing source node with id: ".concat(x);if(!l.hasOwnProperty(g))throw"Missing target node with id: ".concat(g);var y=l[x],v=l[g];y.out.push(v);function _(T){return ep(T)==="object"?e(T):T}});var u=[];h(Object.values(l));var d=Object.assign.apply(Object,[{}].concat(An(Object.entries(l).filter(function(f){var p=va(f,2),m=p[1];return!m.skip}).map(function(f){var p=va(f,2),m=p[0],x=p[1];return Wu({},m,x.depth)}))));return d;function h(f){for(var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,x=function(){var _=f[g];if(p.indexOf(_)!==-1){var T=[].concat(An(p.slice(p.indexOf(_))),[_]).map(function(w){return e(w.data)});return u.some(function(w){return w.length===T.length&&w.every(function(N,S){return N===T[S]})})||(u.push(T),c(T)),1}m>_.depth&&(_.depth=m,h(_.out,[].concat(An(p),[_]),m+(_.skip?0:1)))},g=0,y=f.length;g<y;g++)x()}}var me=window.THREE?window.THREE:{Group:R_,Mesh:kn,MeshLambertMaterial:M_,Color:vn,BufferGeometry:nc,BufferAttribute:pl,Matrix4:On,Vector3:le,SphereGeometry:Zp,CylinderGeometry:P_,TubeGeometry:PC,ConeGeometry:MC,Line:EC,LineBasicMaterial:B_,QuadraticBezierCurve3:RC,CubicBezierCurve3:CC,Box3:D_},dy={graph:ML,forcelayout:jL},fU=2,qd=new me.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Ic=new me.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",pU=ju({props:{jsonUrl:{onChange:function(e,t){var r=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(i){return i.json()}).then(function(i){t.fetchingJson=!1,t.onFinishLoading(i),r.graphData(i)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var r=t.d3ForceLayout.force("charge");r&&r.strength(e>2?-60:-30),e<3&&i(t.graphData.nodes,"z"),e<2&&i(t.graphData.nodes,"y");function i(s,o){s.forEach(function(a){delete a[o],delete a["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(r){return r.fx=r.fy=r.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},linkDirectionalParticleThreeObject:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,r){return r===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,r),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&r(),i(),s(),this;function r(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=Ae(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(h){var f=va(h,2),p=f[0],m=f[1];if(m){var x=t?p:e.layout.getNodePosition(p[e.nodeId]),g=o(p);(!e.nodePositionUpdate||!e.nodePositionUpdate(g?m.children[0]:m,{x:x.x,y:x.y,z:x.z},p)||g)&&(m.position.x=x.x,m.position.y=x.y||0,m.position.z=x.z||0)}});var a=Ae(e.linkWidth),c=Ae(e.linkCurvature),l=Ae(e.linkCurveRotation),u=Ae(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(h){var f=va(h,2),p=f[0],m=f[1];if(m){var x=t?p:e.layout.getLinkPosition(e.layout.graph.getLink(p.source,p.target).id),g=x[t?"source":"from"],y=x[t?"target":"to"];if(!(!g||!y||!g.hasOwnProperty("x")||!y.hasOwnProperty("x"))){d(p);var v=u(p);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(v?m.children[1]:m,{start:{x:g.x,y:g.y,z:g.z},end:{x:y.x,y:y.y,z:y.z}},p)&&!v)){var _=30,T=p.__curve,w=m.children.length?m.children[0]:m;if(w.type==="Line"){if(T){var S=T.getPoints(_);w.geometry.getAttribute("position").array.length!==S.length*3&&w.geometry[qd]("position",new me.BufferAttribute(new Float32Array(S.length*3),3)),w.geometry.setFromPoints(S)}else{var N=w.geometry.getAttribute("position");(!N||!N.array||N.array.length!==6)&&w.geometry[qd]("position",N=new me.BufferAttribute(new Float32Array(6),3)),N.array[0]=g.x,N.array[1]=g.y||0,N.array[2]=g.z||0,N.array[3]=y.x,N.array[4]=y.y||0,N.array[5]=y.z||0,N.needsUpdate=!0}w.geometry.computeBoundingSphere()}else if(w.type==="Mesh")if(T){w.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(w.position.set(0,0,0),w.rotation.set(0,0,0),w.scale.set(1,1,1));var O=Math.ceil(a(p)*10)/10,k=O/2,R=new me.TubeGeometry(T,_,k,e.linkResolution,!1);w.geometry.dispose(),w.geometry=R}else{if(!w.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var C=Math.ceil(a(p)*10)/10,B=C/2,D=new me.CylinderGeometry(B,B,1,e.linkResolution,1,!1);D[Ic](new me.Matrix4().makeTranslation(0,1/2,0)),D[Ic](new me.Matrix4().makeRotationX(Math.PI/2)),w.geometry.dispose(),w.geometry=D}var U=new me.Vector3(g.x,g.y||0,g.z||0),$=new me.Vector3(y.x,y.y||0,y.z||0),A=U.distanceTo($);w.position.x=U.x,w.position.y=U.y,w.position.z=U.z,w.scale.z=A,w.parent.localToWorld($),w.lookAt($)}}}}});function d(h){var f=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),p=f[t?"source":"from"],m=f[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var x=c(h);if(!x)h.__curve=null;else{var g=new me.Vector3(p.x,p.y||0,p.z||0),y=new me.Vector3(m.x,m.y||0,m.z||0),v=g.distanceTo(y),_,T=l(h);if(v>0){var w=m.x-p.x,N=m.y-p.y||0,S=new me.Vector3().subVectors(y,g),C=S.clone().multiplyScalar(x).cross(w!==0||N!==0?new me.Vector3(0,0,1):new me.Vector3(0,1,0)).applyAxisAngle(S.normalize(),T).add(new me.Vector3().addVectors(g,y).divideScalar(2));_=new me.QuadraticBezierCurve3(g,C,y)}else{var B=x*70,D=-T,U=D+Math.PI/2;_=new me.CubicBezierCurve3(g,new me.Vector3(B*Math.cos(U),B*Math.sin(U),0).add(g),new me.Vector3(B*Math.cos(D),B*Math.sin(D),0).add(g),y)}h.__curve=_}}}}function i(){var o=Ae(e.linkDirectionalArrowRelPos),a=Ae(e.linkDirectionalArrowLength),c=Ae(e.nodeVal);e.arrowDataMapper.entries().forEach(function(l){var u=va(l,2),d=u[0],h=u[1];if(h){var f=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),p=f[t?"source":"from"],m=f[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var x=Math.cbrt(Math.max(0,c(p)||1))*e.nodeRelSize,g=Math.cbrt(Math.max(0,c(m)||1))*e.nodeRelSize,y=a(d),v=o(d),_=d.__curve?function(B){return d.__curve.getPoint(B)}:function(B){var D=function($,A,O,k){return A[$]+(O[$]-A[$])*k||0};return{x:D("x",p,m,B),y:D("y",p,m,B),z:D("z",p,m,B)}},T=d.__curve?d.__curve.getLength():Math.sqrt(["x","y","z"].map(function(B){return Math.pow((m[B]||0)-(p[B]||0),2)}).reduce(function(B,D){return B+D},0)),w=x+y+(T-x-g-y)*v,N=_(w/T),S=_((w-y)/T);["x","y","z"].forEach(function(B){return h.position[B]=S[B]});var C=M1(me.Vector3,An(["x","y","z"].map(function(B){return N[B]})));h.parent.localToWorld(C),h.lookAt(C)}}})}function s(){var o=Ae(e.linkDirectionalParticleSpeed),a=Ae(e.linkDirectionalParticleOffset);e.graphData.links.forEach(function(c){var l=e.particlesDataMapper.getObj(c),u=l&&l.children,d=c.__singleHopPhotonsObj&&c.__singleHopPhotonsObj.children;if(!((!d||!d.length)&&(!u||!u.length))){var h=t?c:e.layout.getLinkPosition(e.layout.graph.getLink(c.source,c.target).id),f=h[t?"source":"from"],p=h[t?"target":"to"];if(!(!f||!p||!f.hasOwnProperty("x")||!p.hasOwnProperty("x"))){var m=o(c),x=Math.abs(a(c)),g=c.__curve?function(v){return c.__curve.getPoint(v)}:function(v){var _=function(w,N,S,C){return N[w]+(S[w]-N[w])*C||0};return{x:_("x",f,p,v),y:_("y",f,p,v),z:_("z",f,p,v)}},y=[].concat(An(u||[]),An(d||[]));y.forEach(function(v,_){var T=v.parent.__linkThreeObjType==="singleHopPhotons";if(v.hasOwnProperty("__progressRatio")||(v.__progressRatio=T?0:(_+x)/u.length),v.__progressRatio+=m,v.__progressRatio>=1)if(!T)v.__progressRatio=v.__progressRatio%1;else{v.parent.remove(v),tp(v);return}var w=v.__progressRatio,N=g(w);v.geometry.type!=="SphereGeometry"&&v.lookAt(N.x,N.y,N.z),["x","y","z"].forEach(function(S){return v.position[S]=N[S]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var r=new me.Group;r.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=r,e.graphScene.add(r)}var i=Ae(e.linkDirectionalParticleThreeObject)(t);if(i&&e.linkDirectionalParticleThreeObject===i&&(i=i.clone()),!i){var s=Ae(e.linkDirectionalParticleWidth),o=Math.ceil(s(t)*10)/10/2,a=e.linkDirectionalParticleResolution,c=new me.SphereGeometry(o,a,a),l=Ae(e.linkColor),u=Ae(e.linkDirectionalParticleColor),d=u(t)||l(t)||"#f0f0f0",h=new me.Color(zo(d)),f=e.linkOpacity*3,p=new me.MeshLambertMaterial({color:h,transparent:!0,opacity:f});i=new me.Mesh(c,p)}t.__singleHopPhotonsObj.add(i)}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var r=(function i(s){var o=[];if(s.geometry){s.geometry.computeBoundingBox();var a=new me.Box3;a.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),o.push(a)}return o.concat.apply(o,An((s.children||[]).filter(function(c){return!c.hasOwnProperty("__graphObjType")||c.__graphObjType==="node"&&t(c.__data)}).map(i)))})(e.graphScene);return r.length?Object.assign.apply(Object,An(["x","y","z"].map(function(i){return Wu({},i,[OI(r,function(s){return s.min[i]}),II(r,function(s){return s.max[i]})])}))):null}},stateInit:function(){return{d3ForceLayout:SL().force("link",gL()).force("charge",NL()).force("center",yk()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new jo(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new jo(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new jo(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new jo(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var r=function(Q){return Q.some(function(te){return t.hasOwnProperty(te)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&r(["nodeAutoColorBy","graphData","nodeColor"])&&uy(e.graphData.nodes,Ae(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&r(["linkAutoColorBy","graphData","linkColor"])&&uy(e.graphData.links,Ae(e.linkAutoColorBy),e.linkColor),e._flushObjects||r(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var i=Ae(e.nodeThreeObject),s=Ae(e.nodeThreeObjectExtend),o=Ae(e.nodeVal),a=Ae(e.nodeColor),c=Ae(e.nodeVisibility),l={},u={};(e._flushObjects||r(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(V){var Q=i(V),te=s(V);Q&&e.nodeThreeObject===Q&&(Q=Q.clone());var ce;return Q&&!te?ce=Q:(ce=new me.Mesh,ce.__graphDefaultObj=!0,Q&&te&&ce.add(Q)),ce.__graphObjType="node",ce}).onUpdateObj(function(V,Q){if(V.__graphDefaultObj){var te=o(Q)||1,ce=Math.cbrt(te)*e.nodeRelSize,ye=e.nodeResolution;(!V.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||V.geometry.parameters.radius!==ce||V.geometry.parameters.widthSegments!==ye)&&(l.hasOwnProperty(te)||(l[te]=new me.SphereGeometry(ce,ye,ye)),V.geometry.dispose(),V.geometry=l[te]);var ge=a(Q),Re=new me.Color(zo(ge||"#ffffaa")),nt=e.nodeOpacity*Wd(ge);(V.material.type!=="MeshLambertMaterial"||!V.material.color.equals(Re)||V.material.opacity!==nt)&&(u.hasOwnProperty(ge)||(u[ge]=new me.MeshLambertMaterial({color:Re,transparent:!0,opacity:nt})),V.material.dispose(),V.material=u[ge])}}).digest(e.graphData.nodes.filter(c))}if(e._flushObjects||r(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject"])){var d=Ae(e.linkThreeObject),h=Ae(e.linkThreeObjectExtend),f=Ae(e.linkMaterial),p=Ae(e.linkVisibility),m=Ae(e.linkColor),x=Ae(e.linkWidth),g={},y={},v={},_=e.graphData.links.filter(p);if((e._flushObjects||r(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(V){var Q=V.__data&&V.__data.__singleHopPhotonsObj;Q&&(Q.parent.remove(Q),tp(Q),delete V.__data.__singleHopPhotonsObj)}).onCreateObj(function(V){var Q=d(V),te=h(V);Q&&e.linkThreeObject===Q&&(Q=Q.clone());var ce;if(!Q||te){var ye=!!x(V);if(ye)ce=new me.Mesh;else{var ge=new me.BufferGeometry;ge[qd]("position",new me.BufferAttribute(new Float32Array(6),3)),ce=new me.Line(ge)}}var Re;return Q?te?(Re=new me.Group,Re.__graphDefaultObj=!0,Re.add(ce),Re.add(Q)):Re=Q:(Re=ce,Re.__graphDefaultObj=!0),Re.renderOrder=10,Re.__graphObjType="link",Re}).onUpdateObj(function(V,Q){if(V.__graphDefaultObj){var te=V.children.length?V.children[0]:V,ce=Math.ceil(x(Q)*10)/10,ye=!!ce;if(ye){var ge=ce/2,Re=e.linkResolution;if(!te.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||te.geometry.parameters.radiusTop!==ge||te.geometry.parameters.radialSegments!==Re){if(!g.hasOwnProperty(ce)){var nt=new me.CylinderGeometry(ge,ge,1,Re,1,!1);nt[Ic](new me.Matrix4().makeTranslation(0,1/2,0)),nt[Ic](new me.Matrix4().makeRotationX(Math.PI/2)),g[ce]=nt}te.geometry.dispose(),te.geometry=g[ce]}}var yt=f(Q);if(yt)te.material=yt;else{var ct=m(Q),ze=new me.Color(zo(ct||"#f0f0f0")),St=e.linkOpacity*Wd(ct),Me=ye?"MeshLambertMaterial":"LineBasicMaterial";if(te.material.type!==Me||!te.material.color.equals(ze)||te.material.opacity!==St){var ue=ye?y:v;ue.hasOwnProperty(ct)||(ue[ct]=new me[Me]({color:ze,transparent:St<1,opacity:St,depthWrite:St>=1})),te.material.dispose(),te.material=ue[ct]}}}}).digest(_),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var T=Ae(e.linkDirectionalArrowLength),w=Ae(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var V=new me.Mesh(void 0,new me.MeshLambertMaterial({transparent:!0}));return V.__linkThreeObjType="arrow",V}).onUpdateObj(function(V,Q){var te=T(Q),ce=e.linkDirectionalArrowResolution;if(!V.geometry.type.match(/^Cone(Buffer)?Geometry$/)||V.geometry.parameters.height!==te||V.geometry.parameters.radialSegments!==ce){var ye=new me.ConeGeometry(te*.25,te,ce);ye.translate(0,te/2,0),ye.rotateX(Math.PI/2),V.geometry.dispose(),V.geometry=ye}var ge=w(Q)||m(Q)||"#f0f0f0";V.material.color=new me.Color(zo(ge)),V.material.opacity=e.linkOpacity*3*Wd(ge)}).digest(_.filter(T))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var N=Ae(e.linkDirectionalParticles),S=Ae(e.linkDirectionalParticleWidth),C=Ae(e.linkDirectionalParticleColor),B=Ae(e.linkDirectionalParticleThreeObject),D={},U={};e.particlesDataMapper.onCreateObj(function(){var V=new me.Group;return V.__linkThreeObjType="photons",V.__photonDataMapper=new jo(V),V}).onUpdateObj(function(V,Q){var te=!!V.children.length&&V.children[0],ce=B(Q),ye,ge;if(ce)ye=ce.geometry,ge=ce.material;else{var Re=Math.ceil(S(Q)*10)/10/2,nt=e.linkDirectionalParticleResolution;te&&te.geometry.parameters.radius===Re&&te.geometry.parameters.widthSegments===nt?ye=te.geometry:(U.hasOwnProperty(Re)||(U[Re]=new me.SphereGeometry(Re,nt,nt)),ye=U[Re]);var yt=C(Q)||m(Q)||"#f0f0f0",ct=new me.Color(zo(yt)),ze=e.linkOpacity*3;te&&te.material.color.equals(ct)&&te.material.opacity===ze?ge=te.material:(D.hasOwnProperty(yt)||(D[yt]=new me.MeshLambertMaterial({color:ct,transparent:!0,opacity:ze})),ge=D[yt])}te&&(te.geometry!==ye&&te.geometry.dispose(),te.material!==ge&&te.material.dispose());var St=Math.round(Math.abs(N(Q)));V.__photonDataMapper.id(function(Me){return Me.idx}).onCreateObj(function(){return new me.Mesh(ye,ge)}).onUpdateObj(function(Me){Me.geometry=ye,Me.material=ge}).digest(An(new Array(St)).map(function(Me,ue){return{idx:ue}}))}).digest(_.filter(N))}}if(e._flushObjects=!1,r(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(V){V.source=V[e.linkSource],V.target=V[e.linkTarget]});var $=e.forceEngine!=="ngraph",A;if($){(A=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var O=e.d3ForceLayout.force("link");O&&O.id(function(V){return V[e.nodeId]}).links(e.graphData.links);var k=e.dagMode&&hU(e.graphData,function(V){return V[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),R=Math.max.apply(Math,An(Object.values(k||[]))),L=e.dagLevelDistance||e.graphData.nodes.length/(R||1)*fU*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var M=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(V){return delete V[M]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var W=["rl","td","zout"].includes(e.dagMode),I=function(Q){return(k[Q[e.nodeId]]-R/2)*L*(W?-1:1)},j=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(V){return V[j]=I(V)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?AL(function(V){var Q=k[V[e.nodeId]]||-1;return(e.dagMode==="radialin"?R-Q:Q)*L}).strength(function(V){return e.dagNodeFilter(V)?1:0}):null)}else{var Z=dy.graph();e.graphData.nodes.forEach(function(V){Z.addNode(V[e.nodeId])}),e.graphData.links.forEach(function(V){Z.addLink(V.source,V.target)}),A=dy.forcelayout(Z,aU({dimensions:e.numDimensions},e.ngraphPhysics)),A.graph=Z}for(var ee=0;ee<e.warmupTicks&&!($&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);ee++)A[$?"tick":"step"]();e.layout=A,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function mU(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=(function(i){function s(){var o;R1(this,s);for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return o=C1(this,s,[].concat(c)),o.__kapsuleInstance=M1(n,[].concat(An(t?[o]:[]),c)),o}return D1(s,i),P1(s)})(e);return Object.keys(n()).forEach(function(i){return r.prototype[i]=function(){var s,o=(s=this.__kapsuleInstance)[i].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),r}var gU=window.THREE?window.THREE:{Group:R_},I1=mU(pU,gU.Group,!0);const xU=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Xd=new WeakMap;class yU{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=xU,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:r,material:i,object:s}=e;if(t={material:this.getMaterialData(i),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const i=e[r];t[r]={version:i.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const i=e[r];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[r]={id:i.id,version:i.version}:t[r]=i.clone():t[r]=i)}return t}equals(e,t){const{object:r,material:i,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(r.matrixWorld)!==!0)return o.worldMatrix.copy(r.matrixWorld),!1;const a=o.material;for(const x in a){const g=a[x],y=i[x];if(g.equals!==void 0){if(g.equals(y)===!1)return g.copy(y),!1}else if(y.isTexture===!0){if(g.id!==y.id||g.version!==y.version)return g.id=y.id,g.version=y.version,!1}else if(g!==y)return a[x]=y,!1}if(a.transmission>0){const{width:x,height:g}=e.context;if(o.bufferWidth!==x||o.bufferHeight!==g)return o.bufferWidth=x,o.bufferHeight=g,!1}const c=o.geometry,l=s.attributes,u=c.attributes,d=Object.keys(u),h=Object.keys(l);if(c.id!==s.id)return c.id=s.id,!1;if(d.length!==h.length)return o.geometry.attributes=this.getAttributesData(l),!1;for(const x of d){const g=u[x],y=l[x];if(y===void 0)return delete u[x],!1;if(g.version!==y.version)return g.version=y.version,!1}const f=s.index,p=c.indexVersion,m=f?f.version:null;if(p!==m)return c.indexVersion=m,!1;if(c.drawRange.start!==s.drawRange.start||c.drawRange.count!==s.drawRange.count)return c.drawRange.start=s.drawRange.start,c.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let x=!1;for(let g=0;g<o.morphTargetInfluences.length;g++)o.morphTargetInfluences[g]!==r.morphTargetInfluences[g]&&(o.morphTargetInfluences[g]=r.morphTargetInfluences[g],x=!0);if(x)return!1}if(o.lights){for(let x=0;x<t.length;x++)if(o.lights[x].map!==t[x].map)return!1}return o.center&&o.center.equals(r.center)===!1?(o.center.copy(r.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const r of e)r.isSpotLight===!0&&r.map!==null&&t.push({map:r.map.version});return t}getLights(e,t){if(Xd.has(e)){const i=Xd.get(e);if(i.renderId===t)return i.lightsData}const r=this.getLightsData(e.getLights());return Xd.set(e,{renderId:t,lightsData:r}),r}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const i=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(i||s)return!1;const o=this.getLights(e.lightsNode,r);return this.equals(e,o)!==!0}}function $m(n,e=0){let t=3735928559^e,r=1103547991^e;if(n instanceof Array)for(let i=0,s;i<n.length;i++)s=n[i],t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);else for(let i=0,s;i<n.length;i++)s=n.charCodeAt(i),t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&r)+(t>>>0)}const qu=n=>$m(n),ac=n=>$m(n),_a=(...n)=>$m(n),bU=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),hy=new WeakMap;function vU(n){return bU.get(n)}function cu(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function jm(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new vn(...e):t==="vec2"?new we(...e):t==="vec3"?new le(...e):t==="vec4"?new et(...e):t==="mat2"?new pT(...e):t==="mat3"?new rc(...e):t==="mat4"?new On(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?TU(e[0]):null}function O1(n){let e=hy.get(n);return e===void 0&&(e={},hy.set(n,e)),e}function _U(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function TU(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const Oc={VERTEX:"vertex"},_e={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Kn={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},wU=["fragment","vertex"],fy=["setup","analyze","generate"],py=[...wU,"compute"],To=["x","y","z","w"],SU={analyze:"setup",generate:"analyze"};let NU=0;class ae extends tm{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=_e.NONE,this.updateBeforeType=_e.NONE,this.updateAfterType=_e.NONE,this.uuid=$l.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:NU++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,_e.FRAME)}onRenderUpdate(e){return this.onUpdate(e,_e.RENDER)}onObjectUpdate(e){return this.onUpdate(e,_e.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const r of Object.getOwnPropertyNames(this)){const i=this[r];if(!(r.startsWith("_")===!0||e.has(i))){if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}else if(i&&i.isNode===!0)t.push({property:r,childNode:i});else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const s in i){if(s.startsWith("_")===!0)continue;const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const r=[];for(const{property:i,childNode:s}of this._getChildren(t))r.push(qu(i.slice(0,-4)),s.getCacheKey(e,t));this._cacheKey=_a(ac(r),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())t["node"+r++]=i;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(r===1){const i=e.getNodeProperties(this);for(const s of Object.values(i))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){se("Abstract function.")}updateAfter(){se("Abstract function.")}update(){se("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const l of c)l.build(e,t);this._beforeNodes=c}const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const s=SU[e.buildStage];if(s&&i.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const l of Object.values(c))if(l&&l.isNode===!0){if(l.parents===!0){const u=e.getNodeProperties(l);u.parents=u.parents||[],u.parents.push(this)}l.build(e)}}o=c.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length<2){const l=this.getNodeType(e),u=e.getDataFromNode(this);o=u.snippet,o===void 0?u.generated===void 0?(u.generated=!0,o=this.generate(e)||"",u.snippet=o):(se("Node: Recursion detected.",this),o="/* Recursion detected. */"):u.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,l,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(ie(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:i,index:s,childNode:o}of t)s!==void 0?(r[i]===void 0&&(r[i]=Number.isInteger(s)?[]:{}),r[i][s]=o.toJSON(e.meta).uuid):r[i]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const i=[];for(const s of e.inputNodes[r])i.push(t[s]);this[r]=i}else if(typeof e.inputNodes[r]=="object"){const i={};for(const s in e.inputNodes[r]){const o=e.inputNodes[r][s];i[s]=t[o]}this[r]=i}else{const i=e.inputNodes[r];this[r]=t[i]}}}toJSON(e){const{uuid:t,type:r}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}if(i){const a=o(e.textures),c=o(e.images),l=o(e.nodes);a.length>0&&(s.textures=a),c.length>0&&(s.images=c),l.length>0&&(s.nodes=l)}return s}}class cc extends ae{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),r=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${r}[ ${i} ]`}}class U1 extends ae{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const i of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(i))&&(r=i);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,i=this.getNodeType(e),s=r.build(e,i);return e.format(s,i,t)}}class Tt extends ae{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,i),a=e.getVarFromNode(this,null,i),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,i,t)}}return super.build(e,t)}}class AU extends Tt{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),i=e.getTypeLength(r),s=this.nodes,o=e.getComponentType(r),a=[];let c=0;for(const u of s){if(c>=i){ie(`TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let d=u.getNodeType(e),h=e.getTypeLength(d),f;if(c+h>i&&(ie(`TSL: Length of '${r}()' data exceeds maximum length of output type.`),h=i-c,d=e.getTypeFromLength(h)),c+=h,f=u.build(e,d),e.getComponentType(d)!==o){const m=e.getTypeFromLength(h,o);f=e.format(f,d,m)}a.push(f)}const l=`${e.getType(r)}( ${a.join(", ")} )`;return e.format(l,r,t)}}const EU=To.join("");class CU extends ae{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(To.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const r=this.node,i=e.getTypeLength(r.getNodeType(e));let s=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=r.build(e,o);this.components.length===i&&this.components===EU.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=r.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class RU extends Tt{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:i}=this,s=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),a=e.getTypeFromLength(r.length,o),c=i.build(e,a),l=t.build(e,s),u=e.getTypeLength(s),d=[];for(let h=0;h<u;h++){const f=To[h];f===r[0]?(d.push(c),h+=r.length-1):d.push(l+"."+f)}return`${e.getType(s)}( ${d.join(", ")} )`}}class MU extends Tt{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,i=this.getNodeType(e),s=r.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const c=e.getTypeLength(i),l=[];let u=0;for(let d=0;d<c;d++){const h=To[d];h===t[u]?(l.push("1.0 - "+(a+"."+h)),u++):l.push(a+"."+h)}return`${e.getType(i)}( ${l.join(", ")} )`}}class zm extends ae{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?cu(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=cu(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=_U(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?jm(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){se("Abstract function.")}}const my=/float|u?int/;class cr extends zm{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return my.test(r)&&my.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class PU extends ae{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){se(`TSL: Member "${this.property}" does not exist in struct.`);const r=this.getNodeType(e);return e.generateConst(r)}return this.structNode.build(e)+"."+this.property}}let is=null;const np=new Map;function H(n,e){if(np.has(n)){se(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);np.set(n,e),n!=="assign"&&(ae.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},ae.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const DU=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),gy=n=>DU(n).split("").sort().join("");ae.prototype.assign=function(...n){if(this.isStackNode!==!0)return is!==null?is.assign(this,...n):ie("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=np.get("assign");return this.addToStack(e(...n))}};ae.prototype.toVarIntent=function(){return this};ae.prototype.get=function(n){return new PU(this,n)};const Ta={};function Uc(n,e,t){Ta[n]=Ta[e]=Ta[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new CU(this,n),this._cache[n]=o),o},set(o){this[n].assign(J(o))}};const r=n.toUpperCase(),i=e.toUpperCase(),s=t.toUpperCase();ae.prototype["set"+r]=ae.prototype["set"+i]=ae.prototype["set"+s]=function(o){const a=gy(n);return new RU(this,a,J(o))},ae.prototype["flip"+r]=ae.prototype["flip"+i]=ae.prototype["flip"+s]=function(){const o=gy(n);return new MU(this,o)}}const $n=["x","y","z","w"],jn=["r","g","b","a"],zn=["s","t","p","q"];for(let n=0;n<4;n++){let e=$n[n],t=jn[n],r=zn[n];Uc(e,t,r);for(let i=0;i<4;i++){e=$n[n]+$n[i],t=jn[n]+jn[i],r=zn[n]+zn[i],Uc(e,t,r);for(let s=0;s<4;s++){e=$n[n]+$n[i]+$n[s],t=jn[n]+jn[i]+jn[s],r=zn[n]+zn[i]+zn[s],Uc(e,t,r);for(let o=0;o<4;o++)e=$n[n]+$n[i]+$n[s]+$n[o],t=jn[n]+jn[i]+jn[s]+jn[o],r=zn[n]+zn[i]+zn[s]+zn[o],Uc(e,t,r)}}}for(let n=0;n<32;n++)Ta[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new cc(this,new cr(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(J(e))}};Object.defineProperties(ae.prototype,Ta);const xy=new WeakMap,BU=function(n,e=null){const t=cu(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?J(rp(n,e)):t==="shader"?n.isFn?n:Y(n):n},FU=function(n,e=null){for(const t in n)n[t]=J(n[t],e);return n},kU=function(n,e=null){const t=n.length;for(let r=0;r<t;r++)n[r]=J(n[r],e);return n},V1=function(n,e=null,t=null,r=null){function i(u){return r!==null?(u=J(Object.assign(u,r)),r.intent===!0&&(u=u.toVarIntent())):u=J(u),u}let s,o=e,a,c;function l(u){let d;return o?d=/[a-z]/i.test(o)?o+"()":o:d=n.type,a!==void 0&&u.length<a?(ie(`TSL: "${d}" parameter length is less than minimum required.`),u.concat(new Array(a-u.length).fill(0))):c!==void 0&&u.length>c?(ie(`TSL: "${d}" parameter length exceeds limit.`),u.slice(0,c)):u}return e===null?s=(...u)=>i(new n(...qs(l(u)))):t!==null?(t=J(t),s=(...u)=>i(new n(e,...qs(l(u)),t))):s=(...u)=>i(new n(e,...qs(l(u)))),s.setParameterLength=(...u)=>(u.length===1?a=c=u[0]:u.length===2&&([a,c]=u),s),s.setName=u=>(o=u,s),s},LU=function(n,...e){return J(new n(...qs(e)))};class IU extends ae{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:r}=this,i=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",o=s||"default";if(i[o])return i[o];const a=e.subBuildFn,c=e.fnCall;e.subBuildFn=s,e.fnCall=this;let l=null;if(t.layout){let u=xy.get(e.constructor);u===void 0&&(u=new WeakMap,xy.set(e.constructor,u));let d=u.get(t);d===void 0&&(d=J(e.buildFunctionNode(t)),u.set(t,d)),e.addInclude(d);const h=r?OU(r):null;l=J(d.call(h))}else{const u=new Proxy(e,{get:(m,x,g)=>{let y;return Symbol.iterator===x?y=function*(){yield void 0}:y=Reflect.get(m,x,g),y}}),d=r?UU(r):null,h=Array.isArray(r)?r.length>0:r!==null,f=t.jsFunc,p=h||f.length>1?f(d,u):f(u);l=J(p)}return e.subBuildFn=a,e.fnCall=c,t.once&&(i[o]=l),l}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getSubBuildOutput(this);return t[r]=t[r]||this.setupOutput(e),t[r].subBuild=e.getClosestSubBuild(this),t[r]}build(e,t=null){let r=null;const i=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,i==="setup"){const l=e.getSubBuildProperty("initialized",this);if(s[l]!==!0&&(s[l]=!0,s[o]=this.getOutputNode(e),s[o].build(e),this.shaderNode.subBuilds))for(const u of e.chaining){const d=e.getDataFromNode(u,"any");d.subBuilds=d.subBuilds||new Set;for(const h of this.shaderNode.subBuilds)d.subBuilds.add(h)}r=s[o]}else i==="analyze"?a.build(e,t):i==="generate"&&(r=a.build(e,t)||"");return e.fnCall=c,r}}function OU(n){let e;return Xm(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function UU(n){let e=0;return Xm(n),new Proxy(n,{get:(t,r,i)=>{let s;if(r==="length")return s=n.length,s;if(Symbol.iterator===r)s=function*(){for(const o of n)yield J(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[r]===void 0?s=o[e++]:s=Reflect.get(o,r,i)}else n[0]instanceof ae&&(n[r]===void 0?s=n[e++]:s=Reflect.get(n,r,i));else s=Reflect.get(t,r,i);s=J(s)}return s}})}class VU extends ae{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new IU(this,e)}setup(){return this.call()}}const GU=[!1,!0],$U=[0,1,2,3],jU=[-1,-2],G1=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Hm=new Map;for(const n of GU)Hm.set(n,new cr(n));const Wm=new Map;for(const n of $U)Wm.set(n,new cr(n,"uint"));const qm=new Map([...Wm].map(n=>new cr(n.value,"int")));for(const n of jU)qm.set(n,new cr(n,"int"));const Xu=new Map([...qm].map(n=>new cr(n.value)));for(const n of G1)Xu.set(n,new cr(n));for(const n of G1)Xu.set(-n,new cr(-n));const Ku={bool:Hm,uint:Wm,ints:qm,float:Xu},yy=new Map([...Hm,...Xu]),rp=(n,e)=>yy.has(n)?yy.get(n):n.isNode===!0?n:new cr(n,e),xt=function(n,e=null){return(...t)=>{for(const i of t)if(i===void 0)return ie(`TSL: Invalid parameter for the type "${n}".`),J(new cr(0,n));if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(i=>{const s=typeof i;return s!=="object"&&s!=="function"}))&&(t=[jm(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Vc(e.get(t[0]));if(t.length===1){const i=rp(t[0],n);return i.nodeType===n?Vc(i):Vc(new U1(i,n))}const r=t.map(i=>rp(i));return Vc(new AU(r,n))}},by=n=>typeof n=="object"&&n!==null?n.value:n,zU=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function ua(n,e){return new VU(n,e)}const J=(n,e=null)=>BU(n,e),Vc=(n,e=null)=>J(n,e).toVarIntent(),Xm=(n,e=null)=>new FU(n,e),qs=(n,e=null)=>new kU(n,e),De=(n,e=null,t=null,r=null)=>new V1(n,e,t,r),re=(n,...e)=>new LU(n,...e),oe=(n,e=null,t=null,r={})=>new V1(n,e,t,{...r,intent:!0});let HU=0;class WU extends ae{constructor(e,t=null){super();let r=null;t!==null&&(typeof t=="object"?r=t.return:(typeof t=="string"?r=t:ie("TSL: Invalid layout type."),t=null)),this.shaderNode=new ua(e,r),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const r={name:"fn"+HU++,type:t,inputs:[]};for(const i in e)i!=="return"&&r.inputs.push({name:i,type:e[i]});e=r}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return ie('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function Y(n,e=null){const t=new WU(n,e);return new Proxy(()=>{},{apply(r,i,s){return t.call(...s)},get(r,i,s){return Reflect.get(t,i,s)},set(r,i,s,o){return Reflect.set(t,i,s,o)}})}const lu=n=>{is=n},$1=()=>is,Xe=(...n)=>is.If(...n);function j1(n){return is&&is.addToStack(n),n}H("toStack",j1);const qU=new xt("color"),z=new xt("float",Ku.float),je=new xt("int",Ku.ints),st=new xt("uint",Ku.uint),Km=new xt("bool",Ku.bool),ne=new xt("vec2"),yr=new xt("ivec2"),XU=new xt("uvec2"),KU=new xt("bvec2"),X=new xt("vec3"),YU=new xt("ivec3"),QU=new xt("uvec3"),ZU=new xt("bvec3"),ve=new xt("vec4"),JU=new xt("ivec4"),e5=new xt("uvec4"),t5=new xt("bvec4"),Ym=new xt("mat2"),zt=new xt("mat3"),Xs=new xt("mat4");H("toColor",qU);H("toFloat",z);H("toInt",je);H("toUint",st);H("toBool",Km);H("toVec2",ne);H("toIVec2",yr);H("toUVec2",XU);H("toBVec2",KU);H("toVec3",X);H("toIVec3",YU);H("toUVec3",QU);H("toBVec3",ZU);H("toVec4",ve);H("toIVec4",JU);H("toUVec4",e5);H("toBVec4",t5);H("toMat2",Ym);H("toMat3",zt);H("toMat4",Xs);const n5=De(cc).setParameterLength(2),r5=(n,e)=>J(new U1(J(n),e));H("element",n5);H("convert",r5);H("append",n=>(se("TSL: .append() has been renamed to .toStack()."),j1(n)));class Le extends ae{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return qu(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const ii=(n,e)=>J(new Le(n,e)),uu=(n,e)=>J(new Le(n,e,!0)),Ce=re(Le,"vec4","DiffuseColor"),vy=re(Le,"vec3","EmissiveColor"),wr=re(Le,"float","Roughness"),du=re(Le,"float","Metalness"),ip=re(Le,"float","Clearcoat"),hu=re(Le,"float","ClearcoatRoughness"),Bs=re(Le,"vec3","Sheen"),Qm=re(Le,"float","SheenRoughness"),Zm=re(Le,"float","Iridescence"),z1=re(Le,"float","IridescenceIOR"),H1=re(Le,"float","IridescenceThickness"),sp=re(Le,"float","AlphaT"),Ri=re(Le,"float","Anisotropy"),Al=re(Le,"vec3","AnisotropyT"),Ks=re(Le,"vec3","AnisotropyB"),En=re(Le,"color","SpecularColor"),fu=re(Le,"float","SpecularF90"),op=re(Le,"float","Shininess"),wa=re(Le,"vec4","Output"),Kd=re(Le,"float","dashSize"),_y=re(Le,"float","gapSize"),El=re(Le,"float","IOR"),ap=re(Le,"float","Transmission"),W1=re(Le,"float","Thickness"),q1=re(Le,"float","AttenuationDistance"),X1=re(Le,"color","AttenuationColor"),K1=re(Le,"float","Dispersion");class Y1 extends ae{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const i5=n=>new Y1(n),Jm=(n,e=0)=>new Y1(n,!0,e),s5=Jm("frame"),fe=Jm("render"),Q1=i5("object");class lc extends zm{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=Q1}setName(e){return this.name=e,this}label(e){return se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(r=>{const i=e(r,this);i!==void 0&&(this.value=i)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const r=this.getNodeType(e),i=this.getUniformHash(e);let s=e.getNodeFromHash(i);s===void 0&&(e.setHashNode(this,i),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let l=c;if(r==="bool"){const u=e.getDataFromNode(this);let d=u.propertyName;if(d===void 0){const h=e.getVarFromNode(this,null,"bool");d=e.getPropertyName(h),u.propertyName=d,l=e.format(c,o,r),e.addLineFlowCode(`${d} = ${l}`,this)}l=d}return e.format(l,r,t)}}const pe=(n,e)=>{const t=zU(e||n);return t===n&&(n=jm(t)),n=n&&n.isNode===!0?n.node&&n.node.value||n.value:n,J(new lc(n,t))};class Ty extends Tt{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const o5=(...n)=>{let e;if(n.length===1){const t=n[0];e=new Ty(null,t.length,t)}else{const t=n[0],r=n[1];e=new Ty(t,r)}return J(e)};H("toArray",(n,e)=>o5(Array(e).fill(n)));class a5 extends Tt{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return To.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,i=t.getScope(),s=e.getNodeProperties(i);s.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=r,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:i}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=r.build(e),a=r.getNodeType(e),c=i.build(e,a),l=i.getNodeType(e),u=e.getDataFromNode(this);let d;if(u.initialized===!0)t!=="void"&&(d=o);else if(s){const h=e.getVarFromNode(this,null,a),f=e.getPropertyName(h);e.addLineFlowCode(`${f} = ${c}`,this);const p=r.node,x=p.node.context({assign:!0}).build(e);for(let g=0;g<p.components.length;g++){const y=p.components[g];e.addLineFlowCode(`${x}.${y} = ${f}[ ${g} ]`,this)}t!=="void"&&(d=o)}else d=`${o} = ${c}`,(t==="void"||l==="void")&&(e.addLineFlowCode(d,this),t!=="void"&&(d=o));return u.initialized=!0,e.format(d,a,t)}}const c5=De(a5).setParameterLength(2);H("assign",c5);class l5 extends Tt{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],r=this.functionNode,i=r.getInputs(e),s=this.parameters,o=(c,l)=>{const u=l.type,d=u==="pointer";let h;return d?h="&"+c.build(e):h=c.build(e,u),h};if(Array.isArray(s)){if(s.length>i.length)ie("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=i.length;else if(s.length<i.length)for(ie("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<i.length;)s.push(z(0));for(let c=0;c<s.length;c++)t.push(o(s[c],i[c]))}else for(const c of i){const l=s[c.name];l!==void 0?t.push(o(l,c)):(ie(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(z(0),c)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const u5=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?qs(e):Xm(e[0]),new l5(J(n),e));H("call",u5);const d5={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class tt extends Tt{static get type(){return"OperatorNode"}constructor(e,t,r,...i){if(super(),i.length>0){let s=new tt(e,t,r);for(let o=0;o<i.length-1;o++)s=new tt(e,s,i[o]);t=s,r=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(d5[this.op],t)}getNodeType(e,t=null){const r=this.op,i=this.aNode,s=this.bNode,o=i.getNodeType(e),a=s?s.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(r==="%")return o;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(o);if(r==="!"||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const r=this.op,{aNode:i,bNode:s}=this,o=this.getNodeType(e,t);let a=null,c=null;o!=="void"?(a=i.getNodeType(e),c=s?s.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="||r==="!="?e.isVector(a)?c=a:e.isVector(c)?a=c:a!==c&&(a=c="float"):r===">>"||r==="<<"?(a=o,c=e.changeComponentType(c,"uint")):r==="%"?(a=o,c=e.isInteger(a)&&e.isInteger(c)?c:a):e.isMatrix(a)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(a):e.isMatrix(c)||(a=c=o):e.isMatrix(c)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(c):a=c=o:a=c=o):a=c=o;const l=i.build(e,a),u=s?s.build(e,c):null,d=e.getFunctionOperator(r);if(t!=="void"){const h=e.renderer.coordinateSystem===Il;if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">=")return h?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${l}, ${u} )`,o,t):e.format(`( ${l} ${r} ${u} )`,o,t):e.format(`( ${l} ${r} ${u} )`,o,t);if(r==="%")return e.isInteger(c)?e.format(`( ${l} % ${u} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${l}, ${u} )`,o,t);if(r==="!"||r==="~")return e.format(`(${r}${l})`,a,t);if(d)return e.format(`${d}( ${l}, ${u} )`,o,t);if(e.isMatrix(a)&&c==="float")return e.format(`( ${u} ${r} ${l} )`,o,t);if(a==="float"&&e.isMatrix(c))return e.format(`${l} ${r} ${u}`,o,t);{let f=`( ${l} ${r} ${u} )`;return!h&&o==="bool"&&e.isVector(a)&&e.isVector(c)&&(f=`all${f}`),e.format(f,o,t)}}else if(a!=="void")return d?e.format(`${d}( ${l}, ${u} )`,o,t):e.isMatrix(a)&&c==="float"?e.format(`${u} ${r} ${l}`,o,t):e.format(`${l} ${r} ${u}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Zt=oe(tt,"+").setParameterLength(2,1/0).setName("add"),Vt=oe(tt,"-").setParameterLength(2,1/0).setName("sub"),Te=oe(tt,"*").setParameterLength(2,1/0).setName("mul"),rr=oe(tt,"/").setParameterLength(2,1/0).setName("div"),eg=oe(tt,"%").setParameterLength(2).setName("mod"),Z1=oe(tt,"==").setParameterLength(2).setName("equal"),h5=oe(tt,"!=").setParameterLength(2).setName("notEqual"),f5=oe(tt,"<").setParameterLength(2).setName("lessThan"),p5=oe(tt,">").setParameterLength(2).setName("greaterThan"),m5=oe(tt,"<=").setParameterLength(2).setName("lessThanEqual"),g5=oe(tt,">=").setParameterLength(2).setName("greaterThanEqual"),x5=oe(tt,"&&").setParameterLength(2,1/0).setName("and"),y5=oe(tt,"||").setParameterLength(2,1/0).setName("or"),b5=oe(tt,"!").setParameterLength(1).setName("not"),v5=oe(tt,"^^").setParameterLength(2).setName("xor"),_5=oe(tt,"&").setParameterLength(2).setName("bitAnd"),T5=oe(tt,"~").setParameterLength(1).setName("bitNot"),w5=oe(tt,"|").setParameterLength(2).setName("bitOr"),S5=oe(tt,"^").setParameterLength(2).setName("bitXor"),N5=oe(tt,"<<").setParameterLength(2).setName("shiftLeft"),A5=oe(tt,">>").setParameterLength(2).setName("shiftRight"),E5=Y(([n])=>(n.addAssign(1),n)),C5=Y(([n])=>(n.subAssign(1),n)),R5=Y(([n])=>{const e=je(n).toConst();return n.addAssign(1),e}),M5=Y(([n])=>{const e=je(n).toConst();return n.subAssign(1),e});H("add",Zt);H("sub",Vt);H("mul",Te);H("div",rr);H("mod",eg);H("equal",Z1);H("notEqual",h5);H("lessThan",f5);H("greaterThan",p5);H("lessThanEqual",m5);H("greaterThanEqual",g5);H("and",x5);H("or",y5);H("not",b5);H("xor",v5);H("bitAnd",_5);H("bitNot",T5);H("bitOr",w5);H("bitXor",S5);H("shiftLeft",N5);H("shiftRight",A5);H("incrementBefore",E5);H("decrementBefore",C5);H("increment",R5);H("decrement",M5);const P5=(n,e)=>(se('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),eg(je(n),je(e)));H("modInt",P5);class G extends Tt{static get type(){return"MathNode"}constructor(e,t,r=null,i=null){if(super(),(e===G.MAX||e===G.MIN)&&arguments.length>3){let s=new G(e,t,r);for(let o=2;o<arguments.length-1;o++)s=new G(e,s,arguments[o]);t=s,r=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(r)?0:e.getTypeLength(r),a=e.isMatrix(i)?0:e.getTypeLength(i);return s>o&&s>a?t:o>a?r:a>s?i:t}getNodeType(e){const t=this.method;return t===G.LENGTH||t===G.DISTANCE||t===G.DOT?"float":t===G.CROSS?"vec3":t===G.ALL||t===G.ANY?"bool":t===G.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:i}=this;let s=null;if(i===G.ONE_MINUS)s=Vt(1,t);else if(i===G.RECIPROCAL)s=rr(1,t);else if(i===G.DIFFERENCE)s=rn(Vt(t,r));else if(i===G.TRANSFORM_DIRECTION){let o=t,a=r;e.isMatrix(o.getNodeType(e))?a=ve(X(a),0):o=ve(X(o),0);const c=Te(o,a).xyz;s=er(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const s=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,c=this.bNode,l=this.cNode,u=e.renderer.coordinateSystem;if(i===G.NEGATE)return e.format("( - "+a.build(e,o)+" )",s,t);{const d=[];return i===G.CROSS?d.push(a.build(e,s),c.build(e,s)):u===Il&&i===G.STEP?d.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),c.build(e,o)):u===Il&&(i===G.MIN||i===G.MAX)?d.push(a.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):i===G.REFRACT?d.push(a.build(e,o),c.build(e,o),l.build(e,"float")):i===G.MIX?d.push(a.build(e,o),c.build(e,o),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o)):(u===Pu&&i===G.ATAN&&c!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===G.DFDX||i===G.DFDY)&&(se(`TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),d.push(a.build(e,o)),c!==null&&d.push(c.build(e,o)),l!==null&&d.push(l.build(e,o))),e.format(`${e.getMethod(i,s)}( ${d.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}G.ALL="all";G.ANY="any";G.RADIANS="radians";G.DEGREES="degrees";G.EXP="exp";G.EXP2="exp2";G.LOG="log";G.LOG2="log2";G.SQRT="sqrt";G.INVERSE_SQRT="inversesqrt";G.FLOOR="floor";G.CEIL="ceil";G.NORMALIZE="normalize";G.FRACT="fract";G.SIN="sin";G.COS="cos";G.TAN="tan";G.ASIN="asin";G.ACOS="acos";G.ATAN="atan";G.ABS="abs";G.SIGN="sign";G.LENGTH="length";G.NEGATE="negate";G.ONE_MINUS="oneMinus";G.DFDX="dFdx";G.DFDY="dFdy";G.ROUND="round";G.RECIPROCAL="reciprocal";G.TRUNC="trunc";G.FWIDTH="fwidth";G.TRANSPOSE="transpose";G.DETERMINANT="determinant";G.INVERSE="inverse";G.EQUALS="equals";G.MIN="min";G.MAX="max";G.STEP="step";G.REFLECT="reflect";G.DISTANCE="distance";G.DIFFERENCE="difference";G.DOT="dot";G.CROSS="cross";G.POW="pow";G.TRANSFORM_DIRECTION="transformDirection";G.MIX="mix";G.CLAMP="clamp";G.REFRACT="refract";G.SMOOTHSTEP="smoothstep";G.FACEFORWARD="faceforward";const J1=z(1e-6),D5=z(Math.PI),B5=oe(G,G.ALL).setParameterLength(1),F5=oe(G,G.ANY).setParameterLength(1),k5=oe(G,G.RADIANS).setParameterLength(1),L5=oe(G,G.DEGREES).setParameterLength(1),eS=oe(G,G.EXP).setParameterLength(1),$a=oe(G,G.EXP2).setParameterLength(1),tS=oe(G,G.LOG).setParameterLength(1),Rr=oe(G,G.LOG2).setParameterLength(1),Gi=oe(G,G.SQRT).setParameterLength(1),I5=oe(G,G.INVERSE_SQRT).setParameterLength(1),Ki=oe(G,G.FLOOR).setParameterLength(1),tg=oe(G,G.CEIL).setParameterLength(1),er=oe(G,G.NORMALIZE).setParameterLength(1),ir=oe(G,G.FRACT).setParameterLength(1),un=oe(G,G.SIN).setParameterLength(1),br=oe(G,G.COS).setParameterLength(1),O5=oe(G,G.TAN).setParameterLength(1),U5=oe(G,G.ASIN).setParameterLength(1),nS=oe(G,G.ACOS).setParameterLength(1),rS=oe(G,G.ATAN).setParameterLength(1,2),rn=oe(G,G.ABS).setParameterLength(1),pu=oe(G,G.SIGN).setParameterLength(1),Mr=oe(G,G.LENGTH).setParameterLength(1),V5=oe(G,G.NEGATE).setParameterLength(1),G5=oe(G,G.ONE_MINUS).setParameterLength(1),iS=oe(G,G.DFDX).setParameterLength(1),sS=oe(G,G.DFDY).setParameterLength(1),$5=oe(G,G.ROUND).setParameterLength(1),j5=oe(G,G.RECIPROCAL).setParameterLength(1),z5=oe(G,G.TRUNC).setParameterLength(1),oS=oe(G,G.FWIDTH).setParameterLength(1),H5=oe(G,G.TRANSPOSE).setParameterLength(1),W5=oe(G,G.DETERMINANT).setParameterLength(1),q5=oe(G,G.INVERSE).setParameterLength(1),X5=(n,e)=>(se('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),Z1(n,e)),co=oe(G,G.MIN).setParameterLength(2,1/0),_t=oe(G,G.MAX).setParameterLength(2,1/0),aS=oe(G,G.STEP).setParameterLength(2),K5=oe(G,G.REFLECT).setParameterLength(2),Y5=oe(G,G.DISTANCE).setParameterLength(2),Q5=oe(G,G.DIFFERENCE).setParameterLength(2),lo=oe(G,G.DOT).setParameterLength(2),ja=oe(G,G.CROSS).setParameterLength(2),Yu=oe(G,G.POW).setParameterLength(2),cS=n=>Te(n,n),Z5=n=>Te(n,n,n),lS=n=>Te(n,n,n,n),J5=oe(G,G.TRANSFORM_DIRECTION).setParameterLength(2),eV=n=>Te(pu(n),Yu(rn(n),1/3)),uS=n=>lo(n,n),We=oe(G,G.MIX).setParameterLength(3),Br=(n,e=0,t=1)=>J(new G(G.CLAMP,J(n),J(e),J(t))),dS=n=>Br(n),hS=oe(G,G.REFRACT).setParameterLength(3),Fr=oe(G,G.SMOOTHSTEP).setParameterLength(3),tV=oe(G,G.FACEFORWARD).setParameterLength(3),nV=Y(([n])=>{const r=43758.5453,i=lo(n.xy,ne(12.9898,78.233)),s=eg(i,D5);return ir(un(s).mul(r))}),rV=(n,e,t)=>We(e,t,n),iV=(n,e,t)=>Fr(e,t,n),sV=(n,e)=>aS(e,n),oV=(n,e)=>(se('TSL: "atan2" is overloaded. Use "atan" instead.'),rS(n,e));H("all",B5);H("any",F5);H("equals",X5);H("radians",k5);H("degrees",L5);H("exp",eS);H("exp2",$a);H("log",tS);H("log2",Rr);H("sqrt",Gi);H("inverseSqrt",I5);H("floor",Ki);H("ceil",tg);H("normalize",er);H("fract",ir);H("sin",un);H("cos",br);H("tan",O5);H("asin",U5);H("acos",nS);H("atan",rS);H("abs",rn);H("sign",pu);H("length",Mr);H("lengthSq",uS);H("negate",V5);H("oneMinus",G5);H("dFdx",iS);H("dFdy",sS);H("round",$5);H("reciprocal",j5);H("trunc",z5);H("fwidth",oS);H("atan2",oV);H("min",co);H("max",_t);H("step",sV);H("reflect",K5);H("distance",Y5);H("dot",lo);H("cross",ja);H("pow",Yu);H("pow2",cS);H("pow3",Z5);H("pow4",lS);H("transformDirection",J5);H("mix",rV);H("clamp",Br);H("refract",hS);H("smoothstep",iV);H("faceForward",tV);H("difference",Q5);H("saturate",dS);H("cbrt",eV);H("transpose",H5);H("determinant",W5);H("inverse",q5);H("rand",nV);class aV extends ae{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const i=t.getNodeType(e);if(r!==null){const s=r.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const t=this.condNode,r=this.ifNode.isolate(),i=this.elseNode?this.elseNode.isolate():null,s=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=s,i!==null&&(e.getDataFromNode(i).parentNodeBlock=s);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?r:r.context({nodeBlock:r}),a.elseNode=i?o?i:i.context({nodeBlock:i}):null}generate(e,t){const r=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),c=e.currentFunctionNode,l=t!=="void",u=l?ii(r).build(e):"";i.nodeProperty=u;const d=s.build(e,"bool");if(e.context.uniformFlow&&a!==null){const p=o.build(e,r),m=a.build(e,r),x=e.getTernary(d,p,m);return e.format(x,r,t)}e.addFlowCode(`
${e.tab}if ( ${d} ) {

`).addFlowTab();let f=o.build(e,r);if(f&&(l?f=u+" = "+f+";":(f="return "+f+";",c===null&&(se("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),f="// "+f))),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let p=a.build(e,r);p&&(l?p=u+" = "+p+";":(p="return "+p+";",c===null&&(se("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),p="// "+p))),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,r,t)}}const Rt=De(aV).setParameterLength(2,3);H("select",Rt);class fS extends ae{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const r=e.addContext(this.value),i=this.node.build(e,t);return e.setContext(r),i}}const Qu=De(fS).setParameterLength(1,2),cV=n=>Qu(n,{uniformFlow:!0}),pS=(n,e)=>Qu(n,{nodeName:e});function lV(n,e){return se('TSL: "label()" has been deprecated. Use "setName()" instead.'),pS(n,e)}H("context",Qu);H("label",lV);H("uniformFlow",cV);H("setName",pS);class Cl extends ae{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){let r=e.getNodeProperties(this).assign;return r!==!0&&this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop&&(r=!0),r}build(...e){const t=e[0];return this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)&&t.getBaseStack().addToStack(this),this.intent===!0&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:r,readOnly:i}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let a=!1,c=!1;i&&(a=e.isDeterministic(t),c=o?i:a);const l=this.getNodeType(e);if(l=="void")return this.intent!==!0&&ie('TSL: ".toVar()" can not be used with void type.'),t.build(e);const u=e.getVectorType(l),d=t.build(e,u),h=e.getVarFromNode(this,r,u,void 0,c),f=e.getPropertyName(h);let p=f;if(c)if(o)p=a?`const ${f}`:`let ${f}`;else{const m=t.getArrayCount(e);p=`const ${e.getVar(h.type,f,m)}`}return e.addLineFlowCode(`${p} = ${d}`,this),f}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const ng=De(Cl),uV=(n,e=null)=>ng(n,e).toStack(),dV=(n,e=null)=>ng(n,e,!0).toStack(),hV=n=>ng(n).setIntent(!0).toStack();H("toVar",uV);H("toConst",dV);H("toVarIntent",hV);class fV extends ae{static get type(){return"SubBuild"}constructor(e,t,r=null){super(r),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const r=this.node.build(e,...t);return e.removeSubBuild(),r}}const Sa=(n,e,t=null)=>J(new fV(J(n),e,t));class pV extends ae{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(r===void 0){const i=this.name,s=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,i,s,o,a),t.node=Sa(this.node,"VERTEX")}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Oc.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Oc.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),r=e.getNodeProperties(this),i=this.setupVarying(e);if(r[t]===void 0){const s=this.getNodeType(e),o=e.getPropertyName(i,Oc.VERTEX);e.flowNodeFromShaderStage(Oc.VERTEX,r.node,s,o),r[t]=o}return e.getPropertyName(i)}}const ui=De(pV).setParameterLength(1,2),mV=n=>ui(n);H("toVarying",ui);H("toVertexStage",mV);H("varying",(...n)=>(se("TSL: .varying() has been renamed to .toVarying()."),ui(...n)));H("vertexStage",(...n)=>(se("TSL: .vertexStage() has been renamed to .toVertexStage()."),ui(...n)));const gV=Y(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),r=n.lessThanEqual(.04045);return We(e,t,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),xV=Y(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),r=n.lessThanEqual(.0031308);return We(e,t,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),rg="WorkingColorSpace",yV="OutputColorSpace";class mS extends Tt{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===rg?pt.workingColorSpace:t===yV?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let s=t;return pt.enabled===!1||r===i||!r||!i||(pt.getTransfer(r)===be&&(s=ve(gV(s.rgb),s.a)),pt.getPrimaries(r)!==pt.getPrimaries(i)&&(s=ve(zt(pt._getMatrix(new rc,r,i)).mul(s.rgb),s.a)),pt.getTransfer(i)===be&&(s=ve(xV(s.rgb),s.a))),s}}const bV=(n,e)=>J(new mS(J(n),rg,e)),ig=(n,e)=>J(new mS(J(n),e,rg));H("workingToColorSpace",bV);H("colorSpaceToWorking",ig);let vV=class extends cc{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}};class gS extends ae{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=_e.OBJECT}setGroup(e){return this.group=e,this}element(e){return J(new vV(this,J(e)))}setNodeType(e){const t=pe(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const _V=(n,e,t)=>J(new gS(n,e,t));class TV extends gS{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(fe)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const wV=(n,e,t=null)=>J(new TV(n,e,t));class SV extends Tt{static get type(){return"ToneMappingNode"}constructor(e,t=AV,r=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return _a(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,r=this._toneMapping;if(r===Oi)return t;let i=null;const s=e.renderer.library.getToneMappingFunction(r);return s!==null?i=ve(s(t.rgb,this.exposureNode),t.a):(ie("ToneMappingNode: Unsupported Tone Mapping configuration.",r),i=t),i}}const NV=(n,e,t)=>J(new SV(n,J(e),J(t))),AV=wV("toneMappingExposure","float");H("toneMapping",(n,e,t)=>NV(e,t,n));class EV extends zm{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=i,this.usage=K2,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),r=this.value,i=e.getTypeLength(t),s=this.bufferStride||i,o=this.bufferOffset,a=r.isInterleavedBuffer===!0?r:new Y2(r,s),c=new Q2(a,i,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(r);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,s=i):s=ui(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const sg=(n,e=null,t=0,r=0)=>J(new EV(n,e,t,r)),CV=(n,e=null,t=0,r=0)=>sg(n,e,t,r).setUsage(Ms),wy=(n,e=null,t=0,r=0)=>sg(n,e,t,r).setInstanced(!0),Sy=(n,e=null,t=0,r=0)=>CV(n,e,t,r).setInstanced(!0);H("toAttribute",n=>sg(n.value));class RV extends ae{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=_e.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const r=e.getNodeProperties(this);r.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if(r==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const xS=(n,e=[64])=>{(e.length===0||e.length>3)&&ie("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const r=e[t];(typeof r!="number"||r<=0||!Number.isInteger(r))&&ie(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return J(new RV(J(n),e))},MV=(n,e,t)=>xS(n,t).setCount(e);H("compute",MV);H("computeKernel",xS);class PV extends ae{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const r=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.build(e,...t);return e.setCache(r),s}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const Na=n=>new PV(J(n));function DV(n,e=!0){return se('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Na(n).setParent(e)}H("cache",DV);H("isolate",Na);class BV extends ae{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const FV=De(BV).setParameterLength(2);H("bypass",FV);class yS extends ae{static get type(){return"RemapNode"}constructor(e,t,r,i=z(0),s=z(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=i,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:i,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(r.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(i)).add(i)}}const kV=De(yS,null,null,{doClamp:!1}).setParameterLength(3,5),LV=De(yS).setParameterLength(3,5);H("remap",kV);H("remapClamp",LV);class Rl extends ae{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),i=this.snippet;if(r==="void")e.addLineFlowCode(i,this);else return e.format(i,r,t)}}const uo=De(Rl).setParameterLength(1,2),IV=n=>(n?Rt(n,uo("discard")):uo("discard")).toStack();H("discard",IV);class OV extends Tt{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const r=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Oi,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Js;return r!==Oi&&(t=t.toneMapping(r)),i!==Js&&i!==pt.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const UV=(n,e=null,t=null)=>J(new OV(J(n),e,t));H("renderOutput",UV);class VV extends Tt{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(i.length);let o="";return o+="// #"+i+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+r+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):Z2(o),r}}const GV=(n,e=null)=>J(new VV(J(n),e)).toStack();H("debug",GV);class bS{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class $V extends ae{static get type(){return"InspectorNode"}constructor(e,t="",r=null){super(),this.node=e,this.name=t,this.callback=r,this.updateType=_e.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==bS&&ft('TSL: ".toInspector()" is only available with WebGPU.'),t}}function jV(n,e="",t=null){return n=J(n),n.before(new $V(n,e,t))}H("toInspector",jV);class vS extends ae{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const i=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,r):ui(this).build(e,r)}else return se(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ai=(n,e=null)=>J(new vS(n,e)),wo=(n=0)=>ai("uv"+(n>0?n:""),"vec2");class zV extends ae{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${i} )`,this.getNodeType(e),t)}}const Yi=De(zV).setParameterLength(1,2);class HV extends lc{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=_e.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&r.width!==void 0){const{width:i,height:s}=r;this.value=Math.log2(Math.max(i,s))}}}const WV=De(HV).setParameterLength(1),_S=new om;class So extends lc{static get type(){return"TextureNode"}constructor(e=_S,t=null,r=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=_e.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===mt?"uvec4":this.value.type===Ut?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return wo(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=pe(this.value.matrix)),this._matrixUniform.mul(X(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=pe(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(je(Yi(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||r.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const i=Y(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?_e.OBJECT:_e.NONE,o})();let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,r,i,s,o,a,c,l){const u=this.value;let d;return s?d=e.generateTextureBias(u,t,r,s,o,l):c?d=e.generateTextureGrad(u,t,r,c,o,l):a?d=e.generateTextureCompare(u,t,r,a,o,l):this.sampler===!1?d=e.generateTextureLoad(u,t,r,i,o,l):i?d=e.generateTextureLevel(u,t,r,i,o,l):d=e.generateTexture(u,t,r,o,l),d}generate(e,t){const r=this.value,i=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:u,levelNode:d,biasNode:h,compareNode:f,depthNode:p,gradNode:m,offsetNode:x}=i,g=this.generateUV(e,u),y=d?d.build(e,"float"):null,v=h?h.build(e,"float"):null,_=p?p.build(e,"int"):null,T=f?f.build(e,"float"):null,w=m?[m[0].build(e,"vec2"),m[1].build(e,"vec2")]:null,N=x?this.generateOffset(e,x):null,S=e.getVarFromNode(this);a=e.getPropertyName(S);const C=this.generateSnippet(e,s,g,y,v,_,T,w,N);e.addLineFlowCode(`${a} = ${C}`,this),o.snippet=C,o.propertyName=a}let c=a;const l=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(c=ig(uo(c,l),r.colorSpace).setup(e).build(e,l)),e.format(c,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return se("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=J(e),t.referenceNode=this.getBase(),J(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=J(e).mul(WV(t)),t.referenceNode=this.getBase();const r=t.value;return t.generateMipmaps===!1&&(r&&r.generateMipmaps===!1||r.minFilter===Rn||r.magFilter===Rn)&&(se("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),J(t)}level(e){const t=this.clone();return t.levelNode=J(e),t.referenceNode=this.getBase(),J(t)}size(e){return Yi(this,e)}bias(e){const t=this.clone();return t.biasNode=J(e),t.referenceNode=this.getBase(),J(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=J(e),t.referenceNode=this.getBase(),J(t)}grad(e,t){const r=this.clone();return r.gradNode=[J(e),J(t)],r.referenceNode=this.getBase(),J(r)}depth(e){const t=this.clone();return t.depthNode=J(e),t.referenceNode=this.getBase(),J(t)}offset(e){const t=this.clone();return t.offsetNode=J(e),t.referenceNode=this.getBase(),J(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const r=this._flipYUniform;r!==null&&(r.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const qV=De(So).setParameterLength(1,4).setName("texture"),Ee=(n=_S,e=null,t=null,r=null)=>{let i;return n&&n.isTextureNode===!0?(i=J(n.clone()),i.referenceNode=n.getBase(),e!==null&&(i.uvNode=J(e)),t!==null&&(i.levelNode=J(t)),r!==null&&(i.biasNode=J(r))):i=qV(n,e,t,r),i},ln=(...n)=>Ee(...n).setSampler(!1);class TS extends lc{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const wS=(n,e,t)=>J(new TS(n,e,t));class XV extends cc{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,r)}}class KV extends TS{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?cu(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=_e.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if(r==="float"||r==="int"||r==="uint")for(let i=0;i<e.length;i++){const s=i*4;t[s]=e[i]}else if(r==="color")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(r==="mat2")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(r==="mat3")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(r==="mat4")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,r=this.elementType;let i=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return r.charAt(0)==="i"&&(i=Int32Array),r.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return J(new XV(this,J(e)))}}const Pn=(n,e)=>J(new KV(n,e));class YV extends ae{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const uc=De(YV).setParameterLength(1);let Ho,Wo;class Ge extends ae{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Ge.DPR?"float":this.scope===Ge.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=_e.NONE;return(this.scope===Ge.SIZE||this.scope===Ge.VIEWPORT||this.scope===Ge.DPR)&&(e=_e.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Ge.VIEWPORT?t!==null?Wo.copy(t.viewport):(e.getViewport(Wo),Wo.multiplyScalar(e.getPixelRatio())):this.scope===Ge.DPR?this._output.value=e.getPixelRatio():t!==null?(Ho.width=t.width,Ho.height=t.height):e.getDrawingBufferSize(Ho)}setup(){const e=this.scope;let t=null;return e===Ge.SIZE?t=pe(Ho||(Ho=new we)):e===Ge.VIEWPORT?t=pe(Wo||(Wo=new et)):e===Ge.DPR?t=pe(1):t=ne(Zu.div(cp)),this._output=t,t}generate(e){if(this.scope===Ge.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(cp).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}Ge.COORDINATE="coordinate";Ge.VIEWPORT="viewport";Ge.SIZE="size";Ge.UV="uv";Ge.DPR="dpr";const QV=re(Ge,Ge.DPR),Ys=re(Ge,Ge.UV),cp=re(Ge,Ge.SIZE),Zu=re(Ge,Ge.COORDINATE),SS=re(Ge,Ge.VIEWPORT),ZV=SS.zw;SS.xy;const og=pe(0,"uint").setName("u_cameraIndex").setGroup(Jm("cameraIndex")).toVarying("v_cameraIndex"),Bi=pe("float").setName("cameraNear").setGroup(fe).onRenderUpdate(({camera:n})=>n.near),Fi=pe("float").setName("cameraFar").setGroup(fe).onRenderUpdate(({camera:n})=>n.far),NS=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrix);e=Pn(t).setGroup(fe).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?uc("gl_ViewID_OVR"):og).toConst("cameraProjectionMatrix")}else e=pe("mat4").setName("cameraProjectionMatrix").setGroup(fe).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),Ir=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorldInverse);e=Pn(t).setGroup(fe).setName("cameraViewMatrices").element(n.isMultiViewCamera?uc("gl_ViewID_OVR"):og).toConst("cameraViewMatrix")}else e=pe("mat4").setName("cameraViewMatrix").setGroup(fe).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),JV=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let i=0,s=n.cameras.length;i<s;i++)t.push(new le);e=Pn(t).setGroup(fe).setName("cameraPositions").onRenderUpdate(({camera:i},s)=>{const o=i.cameras,a=s.array;for(let c=0,l=o.length;c<l;c++)a[c].setFromMatrixPosition(o[c].matrixWorld)}).element(n.isMultiViewCamera?uc("gl_ViewID_OVR"):og).toConst("cameraPosition")}else e=pe(new le).setName("cameraPosition").setGroup(fe).onRenderUpdate(({camera:t},r)=>r.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),Ny=new j2;class Ie extends ae{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=_e.OBJECT,this.uniformNode=new lc(null)}getNodeType(){const e=this.scope;if(e===Ie.WORLD_MATRIX)return"mat4";if(e===Ie.POSITION||e===Ie.VIEW_POSITION||e===Ie.DIRECTION||e===Ie.SCALE)return"vec3";if(e===Ie.RADIUS)return"float"}update(e){const t=this.object3d,r=this.uniformNode,i=this.scope;if(i===Ie.WORLD_MATRIX)r.value=t.matrixWorld;else if(i===Ie.POSITION)r.value=r.value||new le,r.value.setFromMatrixPosition(t.matrixWorld);else if(i===Ie.SCALE)r.value=r.value||new le,r.value.setFromMatrixScale(t.matrixWorld);else if(i===Ie.DIRECTION)r.value=r.value||new le,t.getWorldDirection(r.value);else if(i===Ie.VIEW_POSITION){const s=e.camera;r.value=r.value||new le,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(s.matrixWorldInverse)}else if(i===Ie.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),Ny.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),r.value=Ny.radius}}generate(e){const t=this.scope;return t===Ie.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Ie.POSITION||t===Ie.VIEW_POSITION||t===Ie.DIRECTION||t===Ie.SCALE?this.uniformNode.nodeType="vec3":t===Ie.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Ie.WORLD_MATRIX="worldMatrix";Ie.POSITION="position";Ie.SCALE="scale";Ie.VIEW_POSITION="viewPosition";Ie.DIRECTION="direction";Ie.RADIUS="radius";const e4=De(Ie,Ie.POSITION).setParameterLength(1);class bn extends Ie{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}bn.DIRECTION;const ss=re(bn,bn.WORLD_MATRIX);bn.POSITION;bn.SCALE;bn.VIEW_POSITION;bn.RADIUS;const t4=pe(new rc).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),Ju=Y(n=>n.renderer.overrideNodes.modelViewMatrix||n4).once()().toVar("modelViewMatrix"),n4=Ir.mul(ss),Ay=Y(n=>(n.context.isHighPrecisionModelViewMatrix=!0,pe("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),Ey=Y(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return pe("mat3").onObjectUpdate(({object:t,camera:r})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),ed=ai("position","vec3"),Ft=ed.toVarying("positionLocal"),Cy=ed.toVarying("positionPrevious"),ho=Y(n=>ss.mul(Ft).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),AS=Y(()=>Ft.transformDirection(ss).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),lt=Y(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Qe=Y(n=>{let e;return n.camera.isOrthographicCamera?e=X(0,0,1):e=lt.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class r4 extends ae{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Qt?"false":e.getFrontFacing()}}const i4=re(r4),ES=z(i4).mul(2).sub(1),dc=Y(([n],{material:e})=>{const t=e.side;return t===Qt?n=n.mul(-1):t===zi&&(n=n.mul(ES)),n}),CS=ai("normal","vec3"),sr=Y(n=>n.geometry.hasAttribute("normal")===!1?(se('TSL: Vertex attribute "normal" not found on geometry.'),X(0,1,0)):CS,"vec3").once()().toVar("normalLocal"),s4=lt.dFdx().cross(lt.dFdy()).normalize().toVar("normalFlat"),za=Y(n=>{let e;return n.material.flatShading===!0?e=s4:e=RS(sr).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),o4=Y(n=>{let e=za.transformDirection(Ir);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),ke=Y(({subBuildFn:n,material:e,context:t})=>{let r;return n==="NORMAL"||n==="VERTEX"?(r=za,e.flatShading!==!0&&(r=dc(r))):r=t.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),No=ke.transformDirection(Ir).toVar("normalWorld"),Fs=Y(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=ke:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),a4=Y(([n,e=ss])=>{const t=zt(e),r=n.div(X(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(r).xyz}),RS=Y(([n],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const r=t4.mul(n);return Ir.transformDirection(r)});Y(()=>(se('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),ke)).once(["NORMAL","VERTEX"])();Y(()=>(se('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),No)).once(["NORMAL","VERTEX"])();Y(()=>(se('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Fs)).once(["NORMAL","VERTEX"])();const Ry=new gT,Yd=new On,c4=pe(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),Qd=pe(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),MS=pe(new On).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(Ry.copy(t),Yd.makeRotationFromEuler(Ry)):Yd.identity(),Yd}),l4=Qe.negate().reflect(ke),u4=Qe.negate().refract(ke,c4),d4=l4.transformDirection(Ir).toVar("reflectVector"),h4=u4.transformDirection(Ir).toVar("reflectVector"),f4=new sm;class p4 extends So{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,i=null){super(e,t,r,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===jl?d4:e.mapping===zl?h4:(ie('CubeTextureNode: Mapping "%s" not supported.',e.mapping),X(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return(e.renderer.coordinateSystem===Pu||!r.isRenderTargetTexture)&&(t=X(t.x.negate(),t.yz)),MS.mul(t)}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const m4=De(p4).setParameterLength(1,4).setName("cubeTexture"),Ha=(n=f4,e=null,t=null,r=null)=>{let i;return n&&n.isCubeTextureNode===!0?(i=J(n.clone()),i.referenceNode=n,e!==null&&(i.uvNode=J(e)),t!==null&&(i.levelNode=J(t)),r!==null&&(i.biasNode=J(r))):i=m4(n,e,t,r),i};class g4 extends cc{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}}class ag extends ae{static get type(){return"ReferenceNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=_e.OBJECT}element(e){return J(new g4(this,J(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return se('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=wS(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Pn(null,e):e==="texture"?t=Ee(null):e==="cubeTexture"?t=Ha(null):t=pe(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Oe=(n,e,t)=>J(new ag(n,e,t)),My=(n,e,t,r)=>J(new ag(n,e,r,t));class x4 extends ag{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const qr=(n,e,t=null)=>J(new x4(n,e,t)),PS=wo(),y4=lt.dFdx(),b4=lt.dFdy(),DS=PS.dFdx(),BS=PS.dFdy(),FS=ke,kS=b4.cross(FS),LS=FS.cross(y4),lp=kS.mul(DS.x).add(LS.mul(BS.x)),up=kS.mul(DS.y).add(LS.mul(BS.y)),Py=lp.dot(lp).max(up.dot(up)),IS=Py.equal(0).select(0,Py.inverseSqrt()),v4=lp.mul(IS).toVar("tangentViewFrame"),_4=up.mul(IS).toVar("bitangentViewFrame"),OS=Y(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),ai("tangent","vec4")))(),cg=OS.xyz.toVar("tangentLocal"),US=Y(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Ju.mul(ve(cg,0)).xyz.toVarying("v_tangentView").normalize():r=v4,t.flatShading!==!0&&(r=dc(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),T4=Y(([n,e],{subBuildFn:t,material:r})=>{let i=n.mul(OS.w).xyz;return t==="NORMAL"&&r.flatShading!==!0&&(i=i.toVarying(e)),i}).once(["NORMAL"]),w4=Y(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=T4(ke.cross(US),"v_bitangentView").normalize():r=_4,t.flatShading!==!0&&(r=dc(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),da=zt(US,w4,ke).toVar("TBNViewMatrix"),S4=Y(()=>{let n=Ks.cross(Qe);return n=n.cross(Ks).normalize(),n=We(n,ke,Ri.mul(wr.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()();class N4 extends Tt{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=g0}setup({material:e}){const{normalMapType:t,scaleNode:r}=this;let i=this.node.mul(2).sub(1);if(r!==null){let o=r;e.flatShading===!0&&(o=dc(o)),i=X(i.xy.mul(o),i.z)}let s=null;return t===z2?s=RS(i):t===g0?s=da.mul(i).normalize():(ie(`NodeMaterial: Unsupported normal map type: ${t}`),s=ke),s}}const Dy=De(N4).setParameterLength(1,2),A4=Y(({textureNode:n,bumpScale:e})=>{const t=i=>n.isolate().context({getUV:s=>i(s.uvNode||wo()),forceUVContext:!0}),r=z(t(i=>i));return ne(z(t(i=>i.add(i.dFdx()))).sub(r),z(t(i=>i.add(i.dFdy()))).sub(r)).mul(e)}),E4=Y(n=>{const{surf_pos:e,surf_norm:t,dHdxy:r}=n,i=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),c=o.cross(i),l=i.dot(a).mul(ES),u=l.sign().mul(r.x.mul(a).add(r.y.mul(c)));return l.abs().mul(t).sub(u).normalize()});class C4 extends Tt{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=A4({textureNode:this.textureNode,bumpScale:e});return E4({surf_pos:lt,surf_norm:ke,dHdxy:t})}}const R4=De(C4).setParameterLength(1,2),By=new Map;class q extends ae{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=By.get(e);return r===void 0&&(r=qr(e,t),By.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let i=null;if(r===q.COLOR){const s=t.color!==void 0?this.getColor(r):X();t.map&&t.map.isTexture===!0?i=s.mul(this.getTexture("map")):i=s}else if(r===q.OPACITY){const s=this.getFloat(r);t.alphaMap&&t.alphaMap.isTexture===!0?i=s.mul(this.getTexture("alpha")):i=s}else if(r===q.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=z(1);else if(r===q.SPECULAR_INTENSITY){const s=this.getFloat(r);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s}else if(r===q.SPECULAR_COLOR){const s=this.getColor(r);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=s.mul(this.getTexture(r).rgb):i=s}else if(r===q.ROUGHNESS){const s=this.getFloat(r);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).g):i=s}else if(r===q.METALNESS){const s=this.getFloat(r);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=s.mul(this.getTexture(r).b):i=s}else if(r===q.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(r).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(r)):i=o}else if(r===q.NORMAL)t.normalMap?(i=Dy(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType):t.bumpMap?i=R4(this.getTexture("bump").r,this.getFloat("bumpScale")):i=ke;else if(r===q.CLEARCOAT){const s=this.getFloat(r);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===q.CLEARCOAT_ROUGHNESS){const s=this.getFloat(r);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===q.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=Dy(this.getTexture(r),this.getCache(r+"Scale","vec2")):i=ke;else if(r===q.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=s.mul(this.getTexture("sheenColor").rgb):i=s}else if(r===q.SHEEN_ROUGHNESS){const s=this.getFloat(r);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s,i=i.clamp(.07,1)}else if(r===q.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(r);i=Ym(qo.x,qo.y,qo.y.negate(),qo.x).mul(s.rg.mul(2).sub(ne(1)).normalize().mul(s.b))}else i=qo;else if(r===q.IRIDESCENCE_THICKNESS){const s=Oe("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Oe("0","float",t.iridescenceThicknessRange);i=s.sub(o).mul(this.getTexture(r).g).add(o)}else i=s}else if(r===q.TRANSMISSION){const s=this.getFloat(r);t.transmissionMap?i=s.mul(this.getTexture(r).r):i=s}else if(r===q.THICKNESS){const s=this.getFloat(r);t.thicknessMap?i=s.mul(this.getTexture(r).g):i=s}else if(r===q.IOR)i=this.getFloat(r);else if(r===q.LIGHT_MAP)i=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===q.AO)i=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===q.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(r):z(0);else{const s=this.getNodeType(e);i=this.getCache(r,s)}return i}}q.ALPHA_TEST="alphaTest";q.COLOR="color";q.OPACITY="opacity";q.SHININESS="shininess";q.SPECULAR="specular";q.SPECULAR_STRENGTH="specularStrength";q.SPECULAR_INTENSITY="specularIntensity";q.SPECULAR_COLOR="specularColor";q.REFLECTIVITY="reflectivity";q.ROUGHNESS="roughness";q.METALNESS="metalness";q.NORMAL="normal";q.CLEARCOAT="clearcoat";q.CLEARCOAT_ROUGHNESS="clearcoatRoughness";q.CLEARCOAT_NORMAL="clearcoatNormal";q.EMISSIVE="emissive";q.ROTATION="rotation";q.SHEEN="sheen";q.SHEEN_ROUGHNESS="sheenRoughness";q.ANISOTROPY="anisotropy";q.IRIDESCENCE="iridescence";q.IRIDESCENCE_IOR="iridescenceIOR";q.IRIDESCENCE_THICKNESS="iridescenceThickness";q.IOR="ior";q.TRANSMISSION="transmission";q.THICKNESS="thickness";q.ATTENUATION_DISTANCE="attenuationDistance";q.ATTENUATION_COLOR="attenuationColor";q.LINE_SCALE="scale";q.LINE_DASH_SIZE="dashSize";q.LINE_GAP_SIZE="gapSize";q.LINE_WIDTH="linewidth";q.LINE_DASH_OFFSET="dashOffset";q.POINT_SIZE="size";q.DISPERSION="dispersion";q.LIGHT_MAP="light";q.AO="ao";const M4=re(q,q.ALPHA_TEST),P4=re(q,q.COLOR),D4=re(q,q.SHININESS),B4=re(q,q.EMISSIVE),VS=re(q,q.OPACITY),F4=re(q,q.SPECULAR),Fy=re(q,q.SPECULAR_INTENSITY),k4=re(q,q.SPECULAR_COLOR),Ml=re(q,q.SPECULAR_STRENGTH),Zd=re(q,q.REFLECTIVITY),L4=re(q,q.ROUGHNESS),I4=re(q,q.METALNESS),O4=re(q,q.NORMAL),U4=re(q,q.CLEARCOAT),V4=re(q,q.CLEARCOAT_ROUGHNESS),G4=re(q,q.CLEARCOAT_NORMAL),$4=re(q,q.ROTATION),j4=re(q,q.SHEEN),z4=re(q,q.SHEEN_ROUGHNESS),H4=re(q,q.ANISOTROPY),W4=re(q,q.IRIDESCENCE),q4=re(q,q.IRIDESCENCE_IOR),X4=re(q,q.IRIDESCENCE_THICKNESS),K4=re(q,q.TRANSMISSION),Y4=re(q,q.THICKNESS),Q4=re(q,q.IOR),Z4=re(q,q.ATTENUATION_DISTANCE),J4=re(q,q.ATTENUATION_COLOR),eG=re(q,q.LINE_SCALE),tG=re(q,q.LINE_DASH_SIZE),nG=re(q,q.LINE_GAP_SIZE);q.LINE_WIDTH;const rG=re(q,q.LINE_DASH_OFFSET),iG=re(q,q.POINT_SIZE),sG=re(q,q.DISPERSION),GS=re(q,q.LIGHT_MAP),oG=re(q,q.AO),qo=pe(new we).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),$S=Y(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class qe extends ae{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let i;if(r===qe.VERTEX)i=e.getVertexIndex();else if(r===qe.INSTANCE)i=e.getInstanceIndex();else if(r===qe.DRAW)i=e.getDrawIndex();else if(r===qe.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(r===qe.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(r===qe.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=i:s=ui(this).build(e,t),s}}qe.VERTEX="vertex";qe.INSTANCE="instance";qe.SUBGROUP="subgroup";qe.INVOCATION_LOCAL="invocationLocal";qe.INVOCATION_SUBGROUP="invocationSubgroup";qe.DRAW="draw";const aG=re(qe,qe.VERTEX),lg=re(qe,qe.INSTANCE);qe.SUBGROUP;qe.INVOCATION_SUBGROUP;qe.INVOCATION_LOCAL;const cG=re(qe,qe.DRAW);class lG extends ae{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=_e.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{instanceMatrix:t,instanceColor:r}=this,{count:i}=t;let{instanceMatrixNode:s,instanceColorNode:o}=this;if(s===null){if(i<=1e3)s=wS(t.array,"mat4",Math.max(i,1)).element(lg);else{const c=new H2(t.array,16,1);this.buffer=c;const l=t.usage===Ms?Sy:wy,u=[l(c,"vec4",16,0),l(c,"vec4",16,4),l(c,"vec4",16,8),l(c,"vec4",16,12)];s=Xs(...u)}this.instanceMatrixNode=s}if(r&&o===null){const c=new W2(r.array,3),l=r.usage===Ms?Sy:wy;this.bufferColor=c,o=X(l(c,"vec3",3,0)),this.instanceColorNode=o}const a=s.mul(Ft).xyz;if(Ft.assign(a),e.hasGeometryAttribute("normal")){const c=a4(sr,s);sr.assign(c)}this.instanceColorNode!==null&&uu("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Ms&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Ms&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}class uG extends lG{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:i}=e;super(t,r,i),this.instancedMesh=e}}const dG=De(uG).setParameterLength(1);class hG extends ae{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=lg:this.batchingIdNode=cG);const r=Y(([p])=>{const m=je(Yi(ln(this.batchMesh._indirectTexture),0).x),x=je(p).mod(m),g=je(p).div(m);return ln(this.batchMesh._indirectTexture,yr(x,g)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(je(this.batchingIdNode)),i=this.batchMesh._matricesTexture,s=je(Yi(ln(i),0).x),o=z(r).mul(4).toInt().toVar(),a=o.mod(s),c=o.div(s),l=Xs(ln(i,yr(a,c)),ln(i,yr(a.add(1),c)),ln(i,yr(a.add(2),c)),ln(i,yr(a.add(3),c))),u=this.batchMesh._colorsTexture;if(u!==null){const m=Y(([x])=>{const g=je(Yi(ln(u),0).x),y=x,v=y.mod(g),_=y.div(g);return ln(u,yr(v,_)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(r);uu("vec3","vBatchColor").assign(m)}const d=zt(l);Ft.assign(l.mul(Ft));const h=sr.div(X(d[0].dot(d[0]),d[1].dot(d[1]),d[2].dot(d[2]))),f=d.mul(h).xyz;sr.assign(f),e.hasGeometryAttribute("tangent")&&cg.mulAssign(d)}}const fG=De(hG).setParameterLength(1),ky=new WeakMap;class pG extends ae{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=_e.OBJECT,this.skinIndexNode=ai("skinIndex","uvec4"),this.skinWeightNode=ai("skinWeight","vec4"),this.bindMatrixNode=Oe("bindMatrix","mat4"),this.bindMatrixInverseNode=Oe("bindMatrixInverse","mat4"),this.boneMatricesNode=My("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Ft,this.toPositionNode=Ft,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),l=e.element(r.z),u=e.element(r.w),d=s.mul(t),h=Zt(a.mul(i.x).mul(d),c.mul(i.y).mul(d),l.mul(i.z).mul(d),u.mul(i.w).mul(d));return o.mul(h).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=sr){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),l=e.element(r.z),u=e.element(r.w);let d=Zt(i.x.mul(a),i.y.mul(c),i.z.mul(l),i.w.mul(u));return d=o.mul(d).mul(s),d.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=My("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Cy)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||O1(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&Cy.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const r=this.getSkinnedNormal();sr.assign(r),e.hasGeometryAttribute("tangent")&&cg.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;ky.get(t)!==e.frameId&&(ky.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const mG=n=>J(new pG(n));class gG extends ae{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const r={};for(let a=0,c=this.params.length-1;a<c;a++){const l=this.params[a],u=l.isNode!==!0&&l.name||this.getVarName(a),d=l.isNode!==!0&&l.type||"int";r[u]=uo(u,d)}const i=e.addStack(),s=this.params[this.params.length-1](r);t.returnsNode=s.context({nodeLoop:s}),t.stackNode=i;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const a=Y(this.params[0].update)(r);t.updateNode=a.context({nodeLoop:a})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),r=this.params,i=t.stackNode;for(let o=0,a=r.length-1;o<a;o++){const c=r[o];let l=!1,u=null,d=null,h=null,f=null,p=null,m=null;c.isNode?c.getNodeType(e)==="bool"?(l=!0,f="bool",d=c.build(e,f)):(f="int",h=this.getVarName(o),u="0",d=c.build(e,f),p="<"):(f=c.type||"int",h=c.name||this.getVarName(o),u=c.start,d=c.end,p=c.condition,m=c.update,typeof u=="number"?u=e.generateConst(f,u):u&&u.isNode&&(u=u.build(e,f)),typeof d=="number"?d=e.generateConst(f,d):d&&d.isNode&&(d=d.build(e,f)),u!==void 0&&d===void 0?(u=u+" - 1",d="0",p=">="):d!==void 0&&u===void 0&&(u="0",p="<"),p===void 0&&(Number(u)>Number(d)?p=">=":p="<"));let x;if(l)x=`while ( ${d} )`;else{const g={start:u,end:d},y=g.start,v=g.end;let _;const T=()=>p.includes("<")?"+=":"-=";if(m!=null)switch(typeof m){case"function":_=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":_=h+" "+T()+" "+e.generateConst(f,m);break;case"string":_=h+" "+m;break;default:m.isNode?_=h+" "+T()+" "+m.build(e):(ie("TSL: 'Loop( { update: ... } )' is not a function, string or number."),_="break /* invalid update */")}else f==="int"||f==="uint"?m=p.includes("<")?"++":"--":m=T()+" 1.",_=h+" "+m;const w=e.getVar(f,h)+" = "+y,N=h+" "+p+" "+v;x=`for ( ${w}; ${N}; ${_} )`}e.addFlowCode((o===0?`
`:"")+e.tab+x+` {

`).addFlowTab()}const s=i.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,a=this.params.length-1;o<a;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const hn=(...n)=>new gG(qs(n,"int")).toStack(),xG=()=>uo("break").toStack(),Jd=new WeakMap,tn=new et,Ly=Y(({bufferMap:n,influence:e,stride:t,width:r,depth:i,offset:s})=>{const o=je(aG).mul(t).add(s),a=o.div(r),c=o.sub(a.mul(r));return ln(n,yr(c,a)).depth(i).xyz.mul(e)});function yG(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,r=n.morphAttributes.color!==void 0,i=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=i!==void 0?i.length:0;let o=Jd.get(n);if(o===void 0||o.count!==s){let g=function(){m.dispose(),Jd.delete(n),n.removeEventListener("dispose",g)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],l=n.morphAttributes.color||[];let u=0;e===!0&&(u=1),t===!0&&(u=2),r===!0&&(u=3);let d=n.attributes.position.count*u,h=1;const f=4096;d>f&&(h=Math.ceil(d/f),d=f);const p=new Float32Array(d*h*4*s),m=new q2(p,d,h,s);m.type=dn,m.needsUpdate=!0;const x=u*4;for(let y=0;y<s;y++){const v=a[y],_=c[y],T=l[y],w=d*h*4*y;for(let N=0;N<v.count;N++){const S=N*x;e===!0&&(tn.fromBufferAttribute(v,N),p[w+S+0]=tn.x,p[w+S+1]=tn.y,p[w+S+2]=tn.z,p[w+S+3]=0),t===!0&&(tn.fromBufferAttribute(_,N),p[w+S+4]=tn.x,p[w+S+5]=tn.y,p[w+S+6]=tn.z,p[w+S+7]=0),r===!0&&(tn.fromBufferAttribute(T,N),p[w+S+8]=tn.x,p[w+S+9]=tn.y,p[w+S+10]=tn.z,p[w+S+11]=T.itemSize===4?tn.w:1)}}o={count:s,texture:m,stride:u,size:new we(d,h)},Jd.set(n,o),n.addEventListener("dispose",g)}return o}class bG extends ae{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=pe(1),this.updateType=_e.OBJECT}setup(e){const{geometry:t}=e,r=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:c,size:l}=yG(t);r===!0&&Ft.mulAssign(this.morphBaseInfluence),i===!0&&sr.mulAssign(this.morphBaseInfluence);const u=je(l.width);hn(o,({i:d})=>{const h=z(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?h.assign(ln(this.mesh.morphTexture,yr(je(d).add(1),je(lg))).r):h.assign(Oe("morphTargetInfluences","float").element(d).toVar()),Xe(h.notEqual(0),()=>{r===!0&&Ft.addAssign(Ly({bufferMap:a,influence:h,stride:c,width:u,depth:d,offset:je(0)})),i===!0&&sr.addAssign(Ly({bufferMap:a,influence:h,stride:c,width:u,depth:d,offset:je(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,r)=>t+r,0)}}const vG=De(bG).setParameterLength(1);class Ao extends ae{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class _G extends Ao{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class TG extends fS{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,i=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r=X().toVar("directDiffuse"),i=X().toVar("directSpecular"),s=X().toVar("indirectDiffuse"),o=X().toVar("indirectSpecular"),a={directDiffuse:r,directSpecular:i,indirectDiffuse:s,indirectSpecular:o};return{radiance:X().toVar("radiance"),irradiance:X().toVar("irradiance"),iblIrradiance:X().toVar("iblIrradiance"),ambientOcclusion:z(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const wG=De(TG);class SG extends Ao{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const _s=new we;class jS extends So{static get type(){return"ViewportTextureNode"}constructor(e=Ys,t=null,r=null){let i=null;r===null?(i=new L_,i.minFilter=Hi,r=i):i=r,super(r,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=i,this.isOutputTextureNode=!0,this.updateBeforeType=_e.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,r;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,r=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,r=this._cacheTextures),e===null)return t;if(r.has(e)===!1){const i=t.clone();r.set(e,i)}return r.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,r=t.getRenderTarget();r===null?t.getDrawingBufferSize(_s):_s.set(r.width,r.height);const i=this.getTextureForReference(r);(i.image.width!==_s.width||i.image.height!==_s.height)&&(i.image.width=_s.width,i.image.height=_s.height,i.needsUpdate=!0);const s=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const zS=De(jS,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Gc=null;class NG extends jS{static get type(){return"ViewportDepthTextureNode"}constructor(e=Ys,t=null){Gc===null&&(Gc=new Zn),super(e,t,Gc)}getTextureForReference(){return Gc}}const AG=De(NG).setParameterLength(0,2);class Xt extends ae{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Xt.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let i=null;if(t===Xt.DEPTH_BASE)r!==null&&(i=qS().assign(r));else if(t===Xt.DEPTH)e.isPerspectiveCamera?i=EG(lt.z,Bi,Fi):i=Aa(lt.z,Bi,Fi);else if(t===Xt.LINEAR_DEPTH)if(r!==null)if(e.isPerspectiveCamera){const s=HS(r,Bi,Fi);i=Aa(s,Bi,Fi)}else i=r;else i=Aa(lt.z,Bi,Fi);return i}}Xt.DEPTH_BASE="depthBase";Xt.DEPTH="depth";Xt.LINEAR_DEPTH="linearDepth";const Aa=(n,e,t)=>n.add(e).div(e.sub(t)),EG=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),HS=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),WS=(n,e,t)=>{e=e.max(1e-6).toVar();const r=Rr(n.negate().div(e)),i=Rr(t.div(e));return r.div(i)},qS=De(Xt,Xt.DEPTH_BASE),XS=re(Xt,Xt.DEPTH),CG=De(Xt,Xt.LINEAR_DEPTH).setParameterLength(0,1);AG();XS.assign=n=>qS(n);class gn extends ae{static get type(){return"ClippingNode"}constructor(e=gn.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===gn.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,i):this.scope===gn.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(r,i)}setupAlphaToCoverage(e,t){return Y(()=>{const r=z().toVar("distanceToPlane"),i=z().toVar("distanceToGradient"),s=z(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=Pn(t).setGroup(fe);hn(o,({i:l})=>{const u=c.element(l);r.assign(lt.dot(u.xyz).negate().add(u.w)),i.assign(r.fwidth().div(2)),s.mulAssign(Fr(i.negate(),i,r))})}const a=e.length;if(a>0){const c=Pn(e).setGroup(fe),l=z(1).toVar("intersectionClipOpacity");hn(a,({i:u})=>{const d=c.element(u);r.assign(lt.dot(d.xyz).negate().add(d.w)),i.assign(r.fwidth().div(2)),l.mulAssign(Fr(i.negate(),i,r).oneMinus())}),s.mulAssign(l.oneMinus())}Ce.a.mulAssign(s),Ce.a.equal(0).discard()})()}setupDefault(e,t){return Y(()=>{const r=t.length;if(this.hardwareClipping===!1&&r>0){const s=Pn(t).setGroup(fe);hn(r,({i:o})=>{const a=s.element(o);lt.dot(a.xyz).greaterThan(a.w).discard()})}const i=e.length;if(i>0){const s=Pn(e).setGroup(fe),o=Km(!0).toVar("clipped");hn(i,({i:a})=>{const c=s.element(a);o.assign(lt.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),Y(()=>{const i=Pn(e).setGroup(fe),s=uc(t.getClipDistance());hn(r,({i:o})=>{const a=i.element(o),c=lt.dot(a.xyz).sub(a.w).negate();s.element(o).assign(c)})})()}}gn.ALPHA_TO_COVERAGE="alphaToCoverage";gn.DEFAULT="default";gn.HARDWARE="hardware";const RG=()=>J(new gn),MG=()=>J(new gn(gn.ALPHA_TO_COVERAGE)),PG=()=>J(new gn(gn.HARDWARE)),DG=.05,Iy=Y(([n])=>ir(Te(1e4,un(Te(17,n.x).add(Te(.1,n.y)))).mul(Zt(.1,rn(un(Te(13,n.y).add(n.x))))))),Oy=Y(([n])=>Iy(ne(Iy(n.xy),n.z))),BG=Y(([n])=>{const e=_t(Mr(iS(n.xyz)),Mr(sS(n.xyz))),t=z(1).div(z(DG).mul(e)).toVar("pixScale"),r=ne($a(Ki(Rr(t))),$a(tg(Rr(t)))),i=ne(Oy(Ki(r.x.mul(n.xyz))),Oy(Ki(r.y.mul(n.xyz)))),s=ir(Rr(t)),o=Zt(Te(s.oneMinus(),i.x),Te(s,i.y)),a=co(s,s.oneMinus()),c=X(o.mul(o).div(Te(2,a).mul(Vt(1,a))),o.sub(Te(.5,a)).div(Vt(1,a)),Vt(1,Vt(1,o).mul(Vt(1,o)).div(Te(2,a).mul(Vt(1,a))))),l=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return Br(l,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class FG extends vS{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),r=e.hasGeometryAttribute(t);let i;return r===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new et(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const kG=(n=0)=>J(new FG(n)),LG=Y(([n])=>ve(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"});class ut extends u0{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{se('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const r=this[t];r&&r.isNode===!0&&e.push({property:t,childNode:r})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:r}of this._getNodeChildren())e.push(qu(t.slice(0,-4)),r.getCacheKey());return this.type+ac(e)}build(e){this.setup(e)}setupObserver(e){return new yU(e)}setup(e){e.context.setupNormal=()=>Sa(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();e.addStack();const i=Sa(this.setupVertex(e),"VERTEX"),s=this.vertexNode||i;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(r!==null?r.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);a!==null&&e.stack.addToStack(a);const l=ve(c,Ce.a).max(0);o=this.setupOutput(e,l),wa.assign(o);const u=this.outputNode!==null;if(u&&(o=this.outputNode),r!==null){const d=t.getMRT(),h=this.mrtNode;d!==null?(u&&wa.assign(o),o=d,h!==null&&(o=d.merge(h))):h!==null&&(o=h)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=ve(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let i=null;if(t.length>0||r.length>0){const s=e.renderer.currentSamples;this.alphaToCoverage&&s>1?i=MG():e.stack.addToStack(RG())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(PG()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let i=this.depthNode;if(i===null){const s=t.getMRT();s&&s.has("depth")?i=s.get("depth"):t.logarithmicDepthBuffer===!0&&(r.isPerspectiveCamera?i=WS(lt.z,Bi,Fi):i=Aa(lt.z,Bi,Fi))}i!==null&&XS.assign(i).toStack()}setupPositionView(){return Ju.mul(Ft).xyz}setupModelViewProjection(){return NS.mul(lt)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),$S}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&vG(t).toStack(),t.isSkinnedMesh===!0&&mG(t).toStack(),this.displacementMap){const i=qr("displacementMap","texture"),s=qr("displacementScale","float"),o=qr("displacementBias","float");Ft.addAssign(sr.normalize().mul(i.x.mul(s).add(o)))}return t.isBatchedMesh&&fG(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&dG(t).toStack(),this.positionNode!==null&&Ft.assign(Sa(this.positionNode,"POSITION","vec3")),Ft}setupDiffuseColor(e){const{object:t,geometry:r}=e;this.maskNode!==null&&Km(this.maskNode).not().discard();let i=this.colorNode?ve(this.colorNode):P4;this.vertexColors===!0&&r.hasAttribute("color")&&(i=i.mul(kG())),t.instanceColor&&(i=uu("vec3","vInstanceColor").mul(i)),t.isBatchedMesh&&t._colorsTexture&&(i=uu("vec3","vBatchColor").mul(i)),Ce.assign(i);const s=this.opacityNode?z(this.opacityNode):VS;Ce.a.assign(Ce.a.mul(s));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?z(this.alphaTestNode):M4,this.alphaToCoverage===!0?(Ce.a=Fr(o,o.add(oS(Ce.a)),Ce.a),Ce.a.lessThanEqual(0).discard()):Ce.a.lessThanEqual(o).discard()),this.alphaHash===!0&&Ce.a.lessThan(BG(Ft)).discard(),e.isOpaque()&&Ce.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?X(0):Ce.rgb}setupNormal(){return this.normalNode?X(this.normalNode):O4}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?qr("envMap","cubeTexture"):qr("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new SG(GS)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const i=this.setupLightMap(e);if(i&&i.isLightingNode&&t.push(i),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:oG;t.push(new _G(o))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:i,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const l=this.setupLightingModel(e)||null;c=wG(a,l,r,i)}else r!==null&&(c=X(i!==null?We(c,r,i):r));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(vy.assign(X(s||B4)),c=c.add(vy)),c}setupFog(e,t){const r=e.fogNode;return r&&(wa.assign(t),t=ve(r.toVar())),t}setupPremultipliedAlpha(e,t){return LG(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const r in e){const i=e[r];this[r]===void 0&&(this[r]=i,i&&i.clone&&(this[r]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&t[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const r=u0.prototype.toJSON.call(this,e);r.inputNodes={};for(const{property:s,childNode:o}of this._getNodeChildren())r.inputNodes[s]=o.toJSON(e).uuid;function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images),a=i(e.nodes);s.length>0&&(r.textures=s),o.length>0&&(r.images=o),a.length>0&&(r.nodes=a)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const IG=new B_;class OG extends ut{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(IG),this.setValues(e)}}const UG=new l2;class VG extends ut{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(UG),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?z(this.offsetNode):rG,t=this.dashScaleNode?z(this.dashScaleNode):eG,r=this.dashSizeNode?z(this.dashSizeNode):tG,i=this.gapSizeNode?z(this.gapSizeNode):nG;Kd.assign(r),_y.assign(i);const s=ui(ai("lineDistance").mul(t));(e?s.add(e):s).mod(Kd.add(_y)).greaterThan(Kd).discard()}}const GG=n=>J(n).mul(.5).add(.5),$G=new a2;class jG extends ut{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues($G),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?z(this.opacityNode):VS;Ce.assign(ig(ve(GG(ke),e),Jp))}}const KS=Y(([n=AS])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ne(e,t)});class YS extends V2{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new xT(5,5,5),o=KS(AS),a=new ut;a.colorNode=Ee(t,o,0),a.side=Qt,a.blending=eo;const c=new kn(s,a),l=new Ru;l.add(c),t.minFilter===Hi&&(t.minFilter=Ln);const u=new G2(1,10,this),d=e.getMRT();return e.setMRT(null),u.update(e,l),e.setMRT(d),t.minFilter=r,t.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const Ea=new WeakMap;class zG extends Tt{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Ha(null);const t=new sm;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=_e.RENDER}updateBefore(e){const{renderer:t,material:r}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const s=i.isTextureNode?i.value:r[i.property];if(s&&s.isTexture){const o=s.mapping;if(o===rm||o===im){if(Ea.has(s)){const a=Ea.get(s);Uy(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(HG(a)){const c=new YS(a.height);c.fromEquirectangularTexture(t,s),Uy(c.texture,s.mapping),this._cubeTexture=c.texture,Ea.set(s,c.texture),s.addEventListener("dispose",QS)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function HG(n){return n==null?!1:n.height>0}function QS(n){const e=n.target;e.removeEventListener("dispose",QS);const t=Ea.get(e);t!==void 0&&(Ea.delete(e),t.dispose())}function Uy(n,e){e===rm?n.mapping=jl:e===im&&(n.mapping=zl)}const ZS=De(zG).setParameterLength(1);class ug extends Ao{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=ZS(this.envNode)}}class WG extends Ao{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=z(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class td{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class JS extends td{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,i=e.irradianceLightMap;r.indirectDiffuse.assign(ve(0)),i?r.indirectDiffuse.addAssign(i):r.indirectDiffuse.addAssign(ve(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(Ce.rgb)}finish(e){const{material:t,context:r}=e,i=r.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case O2:i.rgb.assign(We(i.rgb,i.rgb.mul(s.rgb),Ml.mul(Zd)));break;case I2:i.rgb.assign(We(i.rgb,s.rgb,Ml.mul(Zd)));break;case L2:i.rgb.addAssign(s.rgb.mul(Ml.mul(Zd)));break;default:se("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const qG=new Hr;class XG extends ut{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(qG),this.setValues(e)}setupNormal(){return dc(za)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ug(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new WG(GS)),t}setupOutgoingLight(){return Ce.rgb}setupLightingModel(){return new JS}}const Wa=Y(({f0:n,f90:e,dotVH:t})=>{const r=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(r.oneMinus()).add(e.mul(r))}),fo=Y(n=>n.diffuseColor.mul(1/Math.PI)),KG=()=>z(.25),YG=Y(({dotNH:n})=>op.mul(z(.5)).add(1).mul(z(1/Math.PI)).mul(n.pow(op))),QG=Y(({lightDirection:n})=>{const e=n.add(Qe).normalize(),t=ke.dot(e).clamp(),r=Qe.dot(e).clamp(),i=Wa({f0:En,f90:1,dotVH:r}),s=KG(),o=YG({dotNH:t});return i.mul(s).mul(o)});class eN extends JS{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=ke.dot(e).clamp().mul(t);r.directDiffuse.addAssign(s.mul(fo({diffuseColor:Ce.rgb}))),this.specular===!0&&r.directSpecular.addAssign(s.mul(QG({lightDirection:e})).mul(Ml))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul(fo({diffuseColor:Ce}))),i.indirectDiffuse.mulAssign(t)}}const ZG=new M_;class JG extends ut{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(ZG),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ug(t):null}setupLightingModel(){return new eN(!1)}}const e$=new r2;class t$ extends ut{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(e$),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ug(t):null}setupLightingModel(){return new eN}setupVariants(){const e=(this.shininessNode?z(this.shininessNode):D4).max(1e-4);op.assign(e);const t=this.specularNode||F4;En.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const n$=Y(n=>{if(n.geometry.hasAttribute("normal")===!1)return z(0);const e=za.dFdx().abs().max(za.dFdy().abs());return e.x.max(e.y).max(e.z)}),tN=Y(n=>{const{roughness:e}=n,t=n$();let r=e.max(.0525);return r=r.add(t),r=r.min(1),r}),r$=Y(({alpha:n,dotNL:e,dotNV:t})=>{const r=n.pow2(),i=e.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return rr(.5,i.add(s).max(J1))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),i$=Y(({alphaT:n,alphaB:e,dotTV:t,dotBV:r,dotTL:i,dotBL:s,dotNV:o,dotNL:a})=>{const c=a.mul(X(n.mul(t),e.mul(r),o).length()),l=o.mul(X(n.mul(i),e.mul(s),a).length());return rr(.5,c.add(l)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),s$=Y(({alpha:n,dotNH:e})=>{const t=n.pow2(),r=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),o$=z(1/Math.PI),a$=Y(({alphaT:n,alphaB:e,dotNH:t,dotTH:r,dotBH:i})=>{const s=n.mul(e),o=X(e.mul(r),n.mul(i),s.mul(t)),a=o.dot(o),c=s.div(a);return o$.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),nN=Y(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,normalView:s=ke,USE_IRIDESCENCE:o,USE_ANISOTROPY:a})=>{const c=r.pow2(),l=n.add(Qe).normalize(),u=s.dot(n).clamp(),d=s.dot(Qe).clamp(),h=s.dot(l).clamp(),f=Qe.dot(l).clamp();let p=Wa({f0:e,f90:t,dotVH:f}),m,x;if(by(o)&&(p=Zm.mix(p,i)),by(a)){const g=Al.dot(n),y=Al.dot(Qe),v=Al.dot(l),_=Ks.dot(n),T=Ks.dot(Qe),w=Ks.dot(l);m=i$({alphaT:sp,alphaB:c,dotTV:y,dotBV:T,dotTL:g,dotBL:_,dotNV:d,dotNL:u}),x=a$({alphaT:sp,alphaB:c,dotNH:h,dotTH:v,dotBH:w})}else m=r$({alpha:c,dotNL:u,dotNV:d}),x=s$({alpha:c,dotNH:h});return p.mul(m).mul(x)}),c$=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let pr=null;const mu=Y(({roughness:n,dotNV:e})=>{pr===null&&(pr=new fT(c$,32,32,Kr,$t),pr.minFilter=Ln,pr.magFilter=Ln,pr.wrapS=Fa,pr.wrapT=Fa,pr.generateMipmaps=!1,pr.needsUpdate=!0);const t=ne(n,e);return Ee(pr,t).rg}),l$=Y(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o})=>{const a=nN({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o}),c=ke.dot(n).clamp(),l=ke.dot(Qe).clamp(),u=mu({roughness:r,dotNV:l}),d=mu({roughness:r,dotNV:c}),h=e.mul(u.x).add(t.mul(u.y)),f=e.mul(d.x).add(t.mul(d.y)),p=u.x.add(u.y),m=d.x.add(d.y),x=z(1).sub(p),g=z(1).sub(m),y=e.add(e.oneMinus().mul(.047619)),v=h.mul(f).mul(y).div(z(1).sub(x.mul(g).mul(y).mul(y)).add(J1)),_=x.mul(g),T=v.mul(_);return a.add(T)}),rN=Y(n=>{const{dotNV:e,specularColor:t,specularF90:r,roughness:i}=n,s=mu({dotNV:e,roughness:i});return t.mul(s.x).add(r.mul(s.y))}),u$=Y(({f:n,f90:e,dotVH:t})=>{const r=t.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return n.sub(X(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),d$=Y(({roughness:n,dotNH:e})=>{const t=n.pow2(),r=z(1).div(t),s=e.pow2().oneMinus().max(.0078125);return z(2).add(r).mul(s.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),h$=Y(({dotNV:n,dotNL:e})=>z(1).div(z(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),f$=Y(({lightDirection:n})=>{const e=n.add(Qe).normalize(),t=ke.dot(n).clamp(),r=ke.dot(Qe).clamp(),i=ke.dot(e).clamp(),s=d$({roughness:Qm,dotNH:i}),o=h$({dotNV:r,dotNL:t});return Bs.mul(s).mul(o)}),p$=Y(({N:n,V:e,roughness:t})=>{const s=.0078125,o=n.dot(e).saturate(),a=ne(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),m$=Y(({f:n})=>{const e=n.length();return _t(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),$c=Y(({v1:n,v2:e})=>{const t=n.dot(e),r=t.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(s),a=t.greaterThan(0).select(o,_t(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),Vy=Y(({N:n,V:e,P:t,mInv:r,p0:i,p1:s,p2:o,p3:a})=>{const c=s.sub(i).toVar(),l=a.sub(i).toVar(),u=c.cross(l),d=X().toVar();return Xe(u.dot(t.sub(i)).greaterThanEqual(0),()=>{const h=e.sub(n.mul(e.dot(n))).normalize(),f=n.cross(h).negate(),p=r.mul(zt(h,f,n).transpose()).toVar(),m=p.mul(i.sub(t)).normalize().toVar(),x=p.mul(s.sub(t)).normalize().toVar(),g=p.mul(o.sub(t)).normalize().toVar(),y=p.mul(a.sub(t)).normalize().toVar(),v=X(0).toVar();v.addAssign($c({v1:m,v2:x})),v.addAssign($c({v1:x,v2:g})),v.addAssign($c({v1:g,v2:y})),v.addAssign($c({v1:y,v2:m})),d.assign(X(m$({f:v})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),nd=1/6,iN=n=>Te(nd,Te(n,Te(n,n.negate().add(3)).sub(3)).add(1)),dp=n=>Te(nd,Te(n,Te(n,Te(3,n).sub(6))).add(4)),sN=n=>Te(nd,Te(n,Te(n,Te(-3,n).add(3)).add(3)).add(1)),hp=n=>Te(nd,Yu(n,3)),Gy=n=>iN(n).add(dp(n)),$y=n=>sN(n).add(hp(n)),jy=n=>Zt(-1,dp(n).div(iN(n).add(dp(n)))),zy=n=>Zt(1,hp(n).div(sN(n).add(hp(n)))),Hy=(n,e,t)=>{const r=n.uvNode,i=Te(r,e.zw).add(.5),s=Ki(i),o=ir(i),a=Gy(o.x),c=$y(o.x),l=jy(o.x),u=zy(o.x),d=jy(o.y),h=zy(o.y),f=ne(s.x.add(l),s.y.add(d)).sub(.5).mul(e.xy),p=ne(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),m=ne(s.x.add(l),s.y.add(h)).sub(.5).mul(e.xy),x=ne(s.x.add(u),s.y.add(h)).sub(.5).mul(e.xy),g=Gy(o.y).mul(Zt(a.mul(n.sample(f).level(t)),c.mul(n.sample(p).level(t)))),y=$y(o.y).mul(Zt(a.mul(n.sample(m).level(t)),c.mul(n.sample(x).level(t))));return g.add(y)},g$=Y(([n,e])=>{const t=ne(n.size(je(e))),r=ne(n.size(je(e.add(1)))),i=rr(1,t),s=rr(1,r),o=Hy(n,ve(i,t),Ki(e)),a=Hy(n,ve(s,r),tg(e));return ir(e).mix(o,a)}),Wy=Y(([n,e,t,r,i])=>{const s=X(hS(e.negate(),er(n),rr(1,r))),o=X(Mr(i[0].xyz),Mr(i[1].xyz),Mr(i[2].xyz));return er(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),x$=Y(([n,e])=>n.mul(Br(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),y$=zS(),b$=zS(),qy=Y(([n,e,t],{material:r})=>{const s=(r.side===Qt?y$:b$).sample(n),o=Rr(cp.x).mul(x$(e,t));return g$(s,o)}),Xy=Y(([n,e,t])=>(Xe(t.notEqual(0),()=>{const r=tS(e).negate().div(t);return eS(r.negate().mul(n))}),X(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),v$=Y(([n,e,t,r,i,s,o,a,c,l,u,d,h,f,p])=>{let m,x;if(p){m=ve().toVar(),x=X().toVar();const T=u.sub(1).mul(p.mul(.025)),w=X(u.sub(T),u,u.add(T));hn({start:0,end:3},({i:N})=>{const S=w.element(N),C=Wy(n,e,d,S,a),B=o.add(C),D=l.mul(c.mul(ve(B,1))),U=ne(D.xy.div(D.w)).toVar();U.addAssign(1),U.divAssign(2),U.assign(ne(U.x,U.y.oneMinus()));const $=qy(U,t,S);m.element(N).assign($.element(N)),m.a.addAssign($.a),x.element(N).assign(r.element(N).mul(Xy(Mr(C),h,f).element(N)))}),m.a.divAssign(3)}else{const T=Wy(n,e,d,u,a),w=o.add(T),N=l.mul(c.mul(ve(w,1))),S=ne(N.xy.div(N.w)).toVar();S.addAssign(1),S.divAssign(2),S.assign(ne(S.x,S.y.oneMinus())),m=qy(S,t,u),x=r.mul(Xy(Mr(T),h,f))}const g=x.rgb.mul(m.rgb),y=n.dot(e).clamp(),v=X(rN({dotNV:y,specularColor:i,specularF90:s,roughness:t})),_=x.r.add(x.g,x.b).div(3);return ve(v.oneMinus().mul(g),m.a.oneMinus().mul(_).oneMinus())}),_$=zt(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),T$=n=>{const e=n.sqrt();return X(1).add(e).div(X(1).sub(e))},Ky=(n,e)=>n.sub(e).div(n.add(e)).pow2(),w$=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),r=X(54856e-17,44201e-17,52481e-17),i=X(1681e3,1795300,2208400),s=X(43278e5,93046e5,66121e5),o=z(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=X(a.x.add(o),a.y,a.z).div(10685e-11),_$.mul(a)},S$=Y(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:r,baseF0:i})=>{const s=We(n,e,Fr(0,.03,r)),a=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Xe(a.lessThan(0),()=>X(1));const c=a.sqrt(),l=Ky(s,n),u=Wa({f0:l,f90:1,dotVH:t}),d=u.oneMinus(),h=s.lessThan(n).select(Math.PI,0),f=z(Math.PI).sub(h),p=T$(i.clamp(0,.9999)),m=Ky(p,s.toVec3()),x=Wa({f0:m,f90:1,dotVH:c}),g=X(p.x.lessThan(s).select(Math.PI,0),p.y.lessThan(s).select(Math.PI,0),p.z.lessThan(s).select(Math.PI,0)),y=s.mul(r,c,2),v=X(f).add(g),_=u.mul(x).clamp(1e-5,.9999),T=_.sqrt(),w=d.pow2().mul(x).div(X(1).sub(_)),S=u.add(w).toVar(),C=w.sub(d).toVar();return hn({start:1,end:2,condition:"<=",name:"m"},({m:B})=>{C.mulAssign(T);const D=w$(z(B).mul(y),z(B).mul(v)).mul(2);S.addAssign(C.mul(D))}),S.max(X(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),N$=Y(({normal:n,viewDir:e,roughness:t})=>{const r=n.dot(e).saturate(),i=t.pow2(),s=Rt(t.lessThan(.25),z(-339.2).mul(i).add(z(161.4).mul(t)).sub(25.9),z(-8.48).mul(i).add(z(14.3).mul(t)).sub(9.95)),o=Rt(t.lessThan(.25),z(44).mul(i).sub(z(23.7).mul(t)).add(3.26),z(1.97).mul(i).sub(z(3.27).mul(t)).add(.72));return Rt(t.lessThan(.25),0,z(.1).mul(t).sub(.025)).add(s.mul(r).add(o).exp()).mul(1/Math.PI).saturate()}),eh=X(.04),th=z(1);class oN extends td{constructor(e=!1,t=!1,r=!1,i=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=i,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=X().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=X().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=X().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=X().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=X().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=ke.dot(Qe).clamp();this.iridescenceFresnel=S$({outsideIOR:z(1),eta2:z1,cosTheta1:t,thinFilmThickness:H1,baseF0:En}),this.iridescenceF0=u$({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=ho,r=JV.sub(ho).normalize(),i=No,s=e.context;s.backdrop=v$(i,r,wr,Ce,En,fu,t,ss,Ir,NS,El,W1,X1,q1,this.dispersion?K1:null),s.backdropAlpha=ap,Ce.a.mulAssign(We(1,s.backdrop.a,ap))}super.start(e)}computeMultiscattering(e,t,r){const i=ke.dot(Qe).clamp(),s=mu({roughness:wr,dotNV:i}),o=this.iridescenceF0?Zm.mix(En,this.iridescenceF0):En,a=o.mul(s.x).add(r.mul(s.y)),l=s.x.add(s.y).oneMinus(),u=o.add(o.oneMinus().mul(.047619)),d=a.mul(u).div(l.mul(u).oneMinus());e.addAssign(a),t.addAssign(d.mul(l))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=ke.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(f$({lightDirection:e}))),this.clearcoat===!0){const a=Fs.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(nN({lightDirection:e,f0:eh,f90:th,roughness:hu,normalView:Fs})))}r.directDiffuse.addAssign(s.mul(fo({diffuseColor:Ce.rgb}))),r.directSpecular.addAssign(s.mul(l$({lightDirection:e,f0:En,f90:1,roughness:wr,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:i,reflectedLight:s,ltc_1:o,ltc_2:a}){const c=t.add(r).sub(i),l=t.sub(r).sub(i),u=t.sub(r).add(i),d=t.add(r).add(i),h=ke,f=Qe,p=lt.toVar(),m=p$({N:h,V:f,roughness:wr}),x=o.sample(m).toVar(),g=a.sample(m).toVar(),y=zt(X(x.x,0,x.y),X(0,1,0),X(x.z,0,x.w)).toVar(),v=En.mul(g.x).add(En.oneMinus().mul(g.y)).toVar();s.directSpecular.addAssign(e.mul(v).mul(Vy({N:h,V:f,P:p,mInv:y,p0:c,p1:l,p2:u,p3:d}))),s.directDiffuse.addAssign(e.mul(Ce).mul(Vy({N:h,V:f,P:p,mInv:zt(1,0,0,0,1,0,0,0,1),p0:c,p1:l,p2:u,p3:d})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(t.mul(fo({diffuseColor:Ce})))}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(r.mul(Bs,N$({normal:ke,viewDir:Qe,roughness:Qm}))),this.clearcoat===!0){const u=Fs.dot(Qe).clamp(),d=rN({dotNV:u,specularColor:eh,specularF90:th,roughness:hu});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(d))}const s=X().toVar("singleScattering"),o=X().toVar("multiScattering"),a=r.mul(1/Math.PI);this.computeMultiscattering(s,o,fu);const c=s.add(o),l=Ce.mul(c.r.max(c.g).max(c.b).oneMinus());i.indirectSpecular.addAssign(t.mul(s)),i.indirectSpecular.addAssign(o.mul(a)),i.indirectDiffuse.addAssign(l.mul(a))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,s=ke.dot(Qe).clamp().add(t),o=wr.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const r=Fs.dot(Qe).clamp(),i=Wa({dotVH:r,f0:eh,f90:th}),s=t.mul(ip.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(ip));t.assign(s)}if(this.sheen===!0){const r=Bs.r.max(Bs.g).max(Bs.b).mul(.157).oneMinus(),i=t.mul(r).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(i)}}}const Yy=z(1),fp=z(-2),jc=z(.8),nh=z(-1),zc=z(.4),rh=z(2),Hc=z(.305),ih=z(3),Qy=z(.21),A$=z(4),Zy=z(4),E$=z(16),C$=Y(([n])=>{const e=X(rn(n)).toVar(),t=z(-1).toVar();return Xe(e.x.greaterThan(e.z),()=>{Xe(e.x.greaterThan(e.y),()=>{t.assign(Rt(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Rt(n.y.greaterThan(0),1,4))})}).Else(()=>{Xe(e.z.greaterThan(e.y),()=>{t.assign(Rt(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Rt(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),R$=Y(([n,e])=>{const t=ne().toVar();return Xe(e.equal(0),()=>{t.assign(ne(n.z,n.y).div(rn(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(ne(n.x.negate(),n.z.negate()).div(rn(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(ne(n.x.negate(),n.y).div(rn(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(ne(n.z.negate(),n.y).div(rn(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(ne(n.x.negate(),n.z).div(rn(n.y)))}).Else(()=>{t.assign(ne(n.x,n.y).div(rn(n.z)))}),Te(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),M$=Y(([n])=>{const e=z(0).toVar();return Xe(n.greaterThanEqual(jc),()=>{e.assign(Yy.sub(n).mul(nh.sub(fp)).div(Yy.sub(jc)).add(fp))}).ElseIf(n.greaterThanEqual(zc),()=>{e.assign(jc.sub(n).mul(rh.sub(nh)).div(jc.sub(zc)).add(nh))}).ElseIf(n.greaterThanEqual(Hc),()=>{e.assign(zc.sub(n).mul(ih.sub(rh)).div(zc.sub(Hc)).add(rh))}).ElseIf(n.greaterThanEqual(Qy),()=>{e.assign(Hc.sub(n).mul(A$.sub(ih)).div(Hc.sub(Qy)).add(ih))}).Else(()=>{e.assign(z(-2).mul(Rr(Te(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),P$=Y(([n,e])=>{const t=n.toVar();t.assign(Te(2,t).sub(1));const r=X(t,1).toVar();return Xe(e.equal(0),()=>{r.assign(r.zyx)}).ElseIf(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),D$=Y(([n,e,t,r,i,s])=>{const o=z(t),a=X(e),c=Br(M$(o),fp,s),l=ir(c),u=Ki(c),d=X(qa(n,a,u,r,i,s)).toVar();return Xe(l.notEqual(0),()=>{const h=X(qa(n,a,u.add(1),r,i,s)).toVar();d.assign(We(d,h,l))}),d}),qa=Y(([n,e,t,r,i,s])=>{const o=z(t).toVar(),a=X(e),c=z(C$(a)).toVar(),l=z(_t(Zy.sub(o),0)).toVar();o.assign(_t(o,Zy));const u=z($a(o)).toVar(),d=ne(R$(a,c).mul(u.sub(2)).add(1)).toVar();return Xe(c.greaterThan(2),()=>{d.y.addAssign(u),c.subAssign(3)}),d.x.addAssign(c.mul(u)),d.x.addAssign(l.mul(Te(3,E$))),d.y.addAssign(Te(4,$a(s).sub(u))),d.x.mulAssign(r),d.y.mulAssign(i),n.sample(d).grad(ne(),ne())}),sh=Y(({envMap:n,mipInt:e,outputDirection:t,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=br(r),l=t.mul(c).add(i.cross(t).mul(un(r))).add(i.mul(i.dot(t).mul(c.oneMinus())));return qa(n,l,e,s,o,a)}),B$=Y(({n,latitudinal:e,poleAxis:t,outputDirection:r,weights:i,samples:s,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})=>{const h=X(Rt(e,t,ja(t,r))).toVar();Xe(h.equal(X(0)),()=>{h.assign(X(r.z,0,r.x.negate()))}),h.assign(er(h));const f=X().toVar();return f.addAssign(i.element(0).mul(sh({theta:0,axis:h,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),hn({start:je(1),end:n},({i:p})=>{Xe(p.greaterThanEqual(s),()=>{xG()});const m=z(o.mul(z(p))).toVar();f.addAssign(i.element(p).mul(sh({theta:m.mul(-1),axis:h,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),f.addAssign(i.element(p).mul(sh({theta:m,axis:h,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})))}),ve(f,1)}),F$=Y(([n])=>{const e=st(n).toVar();return e.assign(e.shiftLeft(st(16)).bitOr(e.shiftRight(st(16)))),e.assign(e.bitAnd(st(1431655765)).shiftLeft(st(1)).bitOr(e.bitAnd(st(2863311530)).shiftRight(st(1)))),e.assign(e.bitAnd(st(858993459)).shiftLeft(st(2)).bitOr(e.bitAnd(st(3435973836)).shiftRight(st(2)))),e.assign(e.bitAnd(st(252645135)).shiftLeft(st(4)).bitOr(e.bitAnd(st(4042322160)).shiftRight(st(4)))),e.assign(e.bitAnd(st(16711935)).shiftLeft(st(8)).bitOr(e.bitAnd(st(4278255360)).shiftRight(st(8)))),z(e).mul(23283064365386963e-26)}),k$=Y(([n,e])=>ne(z(n).div(z(e)),F$(n))),L$=Y(([n,e,t])=>{const r=X(e).toVar(),i=z(t),s=i.mul(i).toVar(),o=er(X(s.mul(r.x),s.mul(r.y),r.z)).toVar(),a=o.x.mul(o.x).add(o.y.mul(o.y)),c=Rt(a.greaterThan(0),X(o.y.negate(),o.x,0).div(Gi(a)),X(1,0,0)).toVar(),l=ja(o,c).toVar(),u=Gi(n.x),d=Te(2,3.14159265359).mul(n.y),h=u.mul(br(d)).toVar(),f=u.mul(un(d)).toVar(),p=Te(.5,o.z.add(1));f.assign(p.oneMinus().mul(Gi(h.mul(h).oneMinus())).add(p.mul(f)));const m=c.mul(h).add(l.mul(f)).add(o.mul(Gi(_t(0,h.mul(h).add(f.mul(f)).oneMinus()))));return er(X(s.mul(m.x),s.mul(m.y),_t(0,m.z)))}),I$=Y(({roughness:n,mipInt:e,envMap:t,N_immutable:r,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=X(r).toVar(),l=X(0).toVar(),u=z(0).toVar();return Xe(n.lessThan(.001),()=>{l.assign(qa(t,c,e,s,o,a))}).Else(()=>{const d=Rt(rn(c.z).lessThan(.999),X(0,0,1),X(1,0,0)),h=er(ja(d,c)).toVar(),f=ja(c,h).toVar();hn({start:st(0),end:i},({i:p})=>{const m=k$(p,i),x=L$(m,X(0,0,1),n),g=er(h.mul(x.x).add(f.mul(x.y)).add(c.mul(x.z))),y=er(g.mul(lo(c,g).mul(2)).sub(c)),v=_t(lo(c,y),0);Xe(v.greaterThan(0),()=>{const _=qa(t,y,e,s,o,a);l.addAssign(_.mul(v)),u.addAssign(v)})}),Xe(u.greaterThan(0),()=>{l.assign(l.div(u))})}),ve(l,1)}),Qr=4,Jy=[.125,.215,.35,.446,.526,.582],ki=20,O$=512,Xo=new nm(-1,1,1,-1,0,1),U$=new Ba(90,1),eb=new vn;let oh=null,ah=0,ch=0;const V$=new le,gu=new WeakMap,G$=[3,1,5,0,4,2],lh=P$(wo(),ai("faceIndex")).normalize(),rd=X(lh.x,lh.y,lh.z);class $${constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,i=100,s={}){const{size:o=256,position:a=V$,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){se('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const u=c||this._allocateTarget();return s.renderTarget=u,this.fromSceneAsync(e,t,r,i,s),u}oh=this._renderer.getRenderTarget(),ah=this._renderer.getActiveCubeFace(),ch=this._renderer.getActiveMipmapLevel();const l=c||this._allocateTarget();return l.depthBuffer=!0,this._init(l),this._sceneToCubeUV(e,r,i,l,a),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}async fromSceneAsync(e,t=0,r=.1,i=100,s={}){return ft('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,r,i,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){se('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return ft('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){se("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return ft('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=nb(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=rb(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===jl||e.mapping===zl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(oh,ah,ch),e.scissorTest=!1,Ts(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),oh=this._renderer.getRenderTarget(),ah=this._renderer.getActiveCubeFace(),ch=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return tb(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=tb(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=j$(t)),this._blurMaterial=z$(t,e.width,e.height),this._ggxMaterial=H$(t,e.width,e.height)}}async _compileMaterial(e){const t=new kn(new nc,e);await this._renderer.compile(t,Xo)}_sceneToCubeUV(e,t,r,i,s){const o=U$;o.near=t,o.far=r;const a=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],l=this._renderer,u=l.autoClear;l.getClearColor(eb),l.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new kn(new xT,new Hr({name:"PMREM.Background",side:Qt,depthWrite:!1,depthTest:!1})));const d=this._backgroundBox,h=d.material;let f=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,f=!0):(h.color.copy(eb),f=!0),l.setRenderTarget(i),l.clear(),f&&l.render(d,o);for(let m=0;m<6;m++){const x=m%3;x===0?(o.up.set(0,a[m],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[m],s.y,s.z)):x===1?(o.up.set(0,0,a[m]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[m],s.z)):(o.up.set(0,a[m],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[m]));const g=this._cubeSize;Ts(i,x*g,m>2?g:0,g,g),l.render(e,o)}l.autoClear=u,e.background=p}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===jl||e.mapping===zl;i?this._cubemapMaterial===null&&(this._cubemapMaterial=nb(e)):this._equirectMaterial===null&&(this._equirectMaterial=rb(e));const s=i?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;Ts(t,0,0,3*a,2*a),r.setRenderTarget(t),r.render(o,Xo)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=r}_applyGGXFilter(e,t,r){const i=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[r];a.material=o;const c=gu.get(o),l=r/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),d=Math.sqrt(l*l-u*u),h=.05+l*.95,f=d*h,{_lodMax:p}=this,m=this._sizeLods[r],x=3*m*(r>p-Qr?r-p+Qr:0),g=4*(this._cubeSize-m);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=f,c.mipInt.value=p-t,Ts(s,x,g,3*m,2*m),i.setRenderTarget(s),i.render(a,Xo),s.texture.frame=(s.texture.frame||0)+1,c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=p-r,Ts(e,x,g,3*m,2*m),i.setRenderTarget(e),i.render(a,Xo)}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&ie("blur direction must be either latitudinal or longitudinal!");const u=3,d=this._lodMeshes[i];d.material=l;const h=gu.get(l),f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*ki-1),m=s/p,x=isFinite(s)?1+Math.floor(u*m):ki;x>ki&&se(`sigmaRadians, ${s}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${ki}`);const g=[];let y=0;for(let N=0;N<ki;++N){const S=N/m,C=Math.exp(-S*S/2);g.push(C),N===0?y+=C:N<x&&(y+=2*C)}for(let N=0;N<g.length;N++)g[N]=g[N]/y;e.texture.frame=(e.texture.frame||0)+1,h.envMap.value=e.texture,h.samples.value=x,h.weights.array=g,h.latitudinal.value=o==="latitudinal"?1:0,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=p,h.mipInt.value=v-r;const _=this._sizeLods[i],T=3*_*(i>v-Qr?i-v+Qr:0),w=4*(this._cubeSize-_);Ts(t,T,w,3*_,2*_),c.setRenderTarget(t),c.render(d,Xo)}}function j$(n){const e=[],t=[],r=[];let i=n;const s=n-Qr+1+Jy.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);e.push(a);let c=1/a;o>n-Qr?c=Jy[o-n+Qr-1]:o===0&&(c=0),t.push(c);const l=1/(a-2),u=-l,d=1+l,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,m=3,x=2,g=1,y=new Float32Array(m*p*f),v=new Float32Array(x*p*f),_=new Float32Array(g*p*f);for(let w=0;w<f;w++){const N=w%3*2/3-1,S=w>2?0:-1,C=[N,S,0,N+2/3,S,0,N+2/3,S+1,0,N,S,0,N+2/3,S+1,0,N,S+1,0],B=G$[w];y.set(C,m*p*B),v.set(h,x*p*B);const D=[B,B,B,B,B,B];_.set(D,g*p*B)}const T=new nc;T.setAttribute("position",new pl(y,m)),T.setAttribute("uv",new pl(v,x)),T.setAttribute("faceIndex",new pl(_,g)),r.push(new kn(T,null)),i>Qr&&i--}return{lodMeshes:r,sizeLods:e,sigmas:t}}function tb(n,e){const t={magFilter:Ln,minFilter:Ln,generateMipmaps:!1,type:$t,format:Dn,colorSpace:X2},r=new bo(n,e,t);return r.texture.mapping=tf,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function Ts(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function id(n){const e=new ut;return e.depthTest=!1,e.depthWrite=!1,e.blending=eo,e.name=`PMREM_${n}`,e}function z$(n,e,t){const r=Pn(new Array(ki).fill(0)),i=pe(new le(0,1,0)),s=pe(0),o=z(ki),a=pe(0),c=pe(1),l=Ee(),u=pe(0),d=z(1/e),h=z(1/t),f=z(n),p={n:o,latitudinal:a,weights:r,poleAxis:i,outputDirection:rd,dTheta:s,samples:c,envMap:l,mipInt:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:f},m=id("blur");return m.fragmentNode=B$({...p,latitudinal:a.equal(1)}),gu.set(m,p),m}function H$(n,e,t){const r=Ee(),i=pe(0),s=pe(0),o=z(1/e),a=z(1/t),c=z(n),l={envMap:r,roughness:i,mipInt:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c},u=id("ggx");return u.fragmentNode=I$({...l,N_immutable:rd,GGX_SAMPLES:st(O$)}),gu.set(u,l),u}function nb(n){const e=id("cubemap");return e.fragmentNode=Ha(n,rd),e}function rb(n){const e=id("equirect");return e.fragmentNode=Ee(n,KS(rd),0),e}const ib=new WeakMap;function W$(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function q$(n,e,t){const r=X$(e);let i=r.get(n);if((i!==void 0?i.pmremVersion:-1)!==n.pmremVersion){const o=n.image;if(n.isCubeTexture)if(Y$(o))i=t.fromCubemap(n,i);else return null;else if(Q$(o))i=t.fromEquirectangular(n,i);else return null;i.pmremVersion=n.pmremVersion,r.set(n,i)}return i.texture}function X$(n){let e=ib.get(n);return e===void 0&&(e=new WeakMap,ib.set(n,e)),e}class K$ extends Tt{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const i=new om;i.isRenderTargetTexture=!0,this._texture=Ee(i),this._width=pe(0),this._height=pe(0),this._maxMip=pe(0),this.updateBeforeType=_e.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=W$(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,i=this._value;r!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=q$(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new $$(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=MS.mul(X(t.x,t.y.negate(),t.z));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),D$(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function Y$(n){if(n==null)return!1;let e=0;const t=6;for(let r=0;r<t;r++)n[r]!==void 0&&e++;return e===t}function Q$(n){return n==null?!1:n.height>0}const aN=De(K$).setParameterLength(1,3),sb=new WeakMap;class Z$ extends Ao{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const d=r.isTextureNode?r.value:t[r.property];let h=sb.get(d);h===void 0&&(h=aN(d),sb.set(d,h)),r=h}const s=t.useAnisotropy===!0||t.anisotropy>0?S4:ke,o=r.context(ob(wr,s)).mul(Qd),a=r.context(J$(No)).mul(Math.PI).mul(Qd),c=Na(o),l=Na(a);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(l);const u=e.context.lightingModel.clearcoatRadiance;if(u){const d=r.context(ob(hu,Fs)).mul(Qd),h=Na(d);u.addAssign(h)}}}const ob=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Qe.negate().reflect(e),t=lS(n).mix(t,e).normalize(),t=t.transformDirection(Ir)),t),getTextureLevel:()=>n}},J$=n=>({getUV:()=>n,getTextureLevel:()=>z(1)}),ej=new i2;class cN extends ut{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(ej),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new Z$(t):null}setupLightingModel(){return new oN}setupSpecular(){const e=We(X(.04),Ce.rgb,du);En.assign(e),fu.assign(1)}setupVariants(){const e=this.metalnessNode?z(this.metalnessNode):I4;du.assign(e);let t=this.roughnessNode?z(this.roughnessNode):L4;t=tN({roughness:t}),wr.assign(t),this.setupSpecular(),Ce.assign(ve(Ce.rgb.mul(e.oneMinus()),Ce.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const tj=new s2;class nj extends cN{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(tj),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?z(this.iorNode):Q4;El.assign(e),En.assign(We(co(cS(El.sub(1).div(El.add(1))).mul(k4),X(1)).mul(Fy),Ce.rgb,du)),fu.assign(We(Fy,1,du))}setupLightingModel(){return new oN(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?z(this.clearcoatNode):U4,r=this.clearcoatRoughnessNode?z(this.clearcoatRoughnessNode):V4;ip.assign(t),hu.assign(tN({roughness:r}))}if(this.useSheen){const t=this.sheenNode?X(this.sheenNode):j4,r=this.sheenRoughnessNode?z(this.sheenRoughnessNode):z4;Bs.assign(t),Qm.assign(r)}if(this.useIridescence){const t=this.iridescenceNode?z(this.iridescenceNode):W4,r=this.iridescenceIORNode?z(this.iridescenceIORNode):q4,i=this.iridescenceThicknessNode?z(this.iridescenceThicknessNode):X4;Zm.assign(t),z1.assign(r),H1.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?ne(this.anisotropyNode):H4).toVar();Ri.assign(t.length()),Xe(Ri.equal(0),()=>{t.assign(ne(1,0))}).Else(()=>{t.divAssign(ne(Ri)),Ri.assign(Ri.saturate())}),sp.assign(Ri.pow2().mix(wr.pow2(),1)),Al.assign(da[0].mul(t.x).add(da[1].mul(t.y))),Ks.assign(da[1].mul(t.x).sub(da[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?z(this.transmissionNode):K4,r=this.thicknessNode?z(this.thicknessNode):Y4,i=this.attenuationDistanceNode?z(this.attenuationDistanceNode):Z4,s=this.attenuationColorNode?X(this.attenuationColorNode):J4;if(ap.assign(t),W1.assign(r),q1.assign(i),X1.assign(s),this.useDispersion){const o=this.dispersionNode?z(this.dispersionNode):sG;K1.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?X(this.clearcoatNormalNode):G4}setup(e){e.context.setupClearcoatNormal=()=>Sa(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const rj=Y(({normal:n,lightDirection:e,builder:t})=>{const r=n.dot(e),i=ne(r.mul(.5).add(.5),0);if(t.material.gradientMap){const s=qr("gradientMap","texture").context({getUV:()=>i});return X(s.r)}else{const s=i.fwidth().mul(.5);return We(X(.7),X(1),Fr(z(.7).sub(s.x),z(.7).add(s.x),i.x))}});class ij extends td{direct({lightDirection:e,lightColor:t,reflectedLight:r},i){const s=rj({normal:CS,lightDirection:e,builder:i}).mul(t);r.directDiffuse.addAssign(s.mul(fo({diffuseColor:Ce.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul(fo({diffuseColor:Ce}))),i.indirectDiffuse.mulAssign(t)}}const sj=new o2;class oj extends ut{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(sj),this.setValues(e)}setupLightingModel(){return new ij}}const aj=Y(()=>{const n=X(Qe.z,0,Qe.x.negate()).normalize(),e=Qe.cross(n);return ne(n.dot(ke),e.dot(ke)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),cj=new c2;class lj extends ut{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(cj),this.setValues(e)}setupVariants(e){const t=aj;let r;e.material.matcap?r=qr("matcap","texture").context({getUV:()=>t}):r=X(We(.2,.8,t.y)),Ce.rgb.mulAssign(r.rgb)}}class uj extends Tt{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return Ym(s,o,o.negate(),s).mul(r)}else{const s=t,o=Xs(ve(1,0,0,0),ve(0,br(s.x),un(s.x).negate(),0),ve(0,un(s.x),br(s.x),0),ve(0,0,0,1)),a=Xs(ve(br(s.y),0,un(s.y),0),ve(0,1,0,0),ve(un(s.y).negate(),0,br(s.y),0),ve(0,0,0,1)),c=Xs(ve(br(s.z),un(s.z).negate(),0,0),ve(un(s.z),br(s.z),0,0),ve(0,0,1,0),ve(0,0,0,1));return o.mul(a).mul(c).mul(ve(r,1)).xyz}}}const lN=De(uj).setParameterLength(2),dj=new d2;class uN extends ut{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(dj),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,{positionNode:i,rotationNode:s,scaleNode:o,sizeAttenuation:a}=this,c=Ju.mul(X(i||0));let l=ne(ss[0].xyz.length(),ss[1].xyz.length());o!==null&&(l=l.mul(ne(o))),r.isPerspectiveCamera&&a===!1&&(l=l.mul(c.z.negate()));let u=ed.xy;if(t.center&&t.center.isVector2===!0){const f=_V("center","vec2",t);u=u.sub(f.sub(.5))}u=u.mul(l);const d=z(s||$4),h=lN(u,d);return ve(c.xy.add(h),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const hj=new u2,fj=new we;class pj extends uN{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(hj),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Ju.mul(X(e||Ft)).xyz}setupVertexSprite(e){const{material:t,camera:r}=e,{rotationNode:i,scaleNode:s,sizeNode:o,sizeAttenuation:a}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let l=o!==null?ne(o):iG;l=l.mul(QV),r.isPerspectiveCamera&&a===!0&&(l=l.mul(mj.div(lt.z.negate()))),s&&s.isNode&&(l=l.mul(ne(s)));let u=ed.xy;if(i&&i.isNode){const d=z(i);u=lN(u,d)}return u=u.mul(l),u=u.div(ZV.div(2)),u=u.mul(c.w),c=c.add(ve(u,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const mj=pe(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(fj);this.value=.5*e.y});class gj extends td{constructor(){super(),this.shadowNode=z(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Ce.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Ce.rgb)}}const xj=new h2;class yj extends ut{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(xj),this.setValues(e)}setupLightingModel(){return new gj}}ii("vec3");ii("vec3");ii("vec3");class bj{constructor(e,t,r){this.renderer=e,this.nodes=t,this.info=r,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,r),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class In{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let r=this.weakMap;for(let i=0;i<e.length-1;i++){const s=e[i];r.has(s)===!1&&r.set(s,new WeakMap),r=r.get(s)}return r.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return!1;return t.delete(e[e.length-1])}}let vj=0;function _j(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptors(t);for(const i in r)if(r[i]!==void 0){const s=r[i];s&&typeof s.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class Tj{constructor(e,t,r,i,s,o,a,c,l,u){this.id=vj++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=i,this.material=s,this.scene=o,this.camera=a,this.lightsNode=c,this.context=l,this.geometry=i.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=u!==null?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],i=new Set,s={};for(const o of e){let a;if(o.node&&o.node.attribute?a=o.node.attribute:(a=t.getAttribute(o.name),s[o.name]=a.version),a===void 0)continue;r.push(a);const c=a.isInterleavedBufferAttribute?a.data:a;i.add(c)}return this.attributes=r,this.attributesId=s,this.vertexBuffers=Array.from(i.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:i,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null;let l=1;if(r.isInstancedBufferGeometry===!0?l=r.instanceCount:e.count!==void 0&&(l=Math.max(0,e.count)),l===0)return null;if(o.instanceCount=l,e.isBatchedMesh===!0)return o;let u=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(u=2);let d=s.start*u,h=(s.start+s.count)*u;i!==null&&(d=Math.max(d,i.start*u),h=Math.min(h,(i.start+i.count)*u));const f=r.attributes.position;let p=1/0;c?p=a.count:f!=null&&(p=f.count),d=Math.max(d,0),h=Math.min(h,p);const m=h-d;return m<0||m===1/0?null:(o.vertexCount=m,o.firstVertex=d,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const i=e.attributes[r];t+=r+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[r];t+="morph-"+r+",";for(let s=0,o=i.length;s<o;s++){const a=i[s];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:r}=this;let i=t.customProgramCacheKey();for(const s of _j(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=t[s];let a;if(o!==null){const c=typeof o;c==="number"?a=o!==0?"1":"0":c==="object"?(a="{",o.isTexture&&(a+=o.mapping,r.backend.isWebGPUBackend===!0&&(a+=o.magFilter,a+=o.minFilter,a+=o.wrapS,a+=o.wrapT,a+=o.wrapR)),a+="}"):a=String(o)}else a=String(o);i+=a+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(i+=e.uuid+","),i+=e.receiveShadow+",",qu(i)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const r=this.geometry.getAttribute(t);if(r===void 0||e[t]!==r.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=_a(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=_a(e,1)),e=_a(e,this.camera.id),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const wi=[];class wj{constructor(e,t,r,i,s,o){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=i,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,r,i,s,o,a,c){const l=this.getChainMap(c);wi[0]=e,wi[1]=t,wi[2]=o,wi[3]=s;let u=l.get(wi);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,i,s,o,a,c),l.set(wi,u)):(u.updateClipping(a),u.needsGeometryUpdate&&u.setGeometry(e.geometry),(u.version!==t.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,t,r,i,s,o,a,c)):u.version=t.version)),wi.length=0,u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new In)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,i,s,o,a,c,l,u,d){const h=this.getChainMap(d),f=new Tj(e,t,r,i,s,o,a,c,l,u);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.deleteForRender(f),this.nodes.delete(f),h.delete(f.getChainArray())},f}}class di{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const pn={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Xr=16,Sj=211,Nj=212;class Aj extends di{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(r.version===void 0)t===pn.VERTEX?this.backend.createAttribute(e):t===pn.INDEX?this.backend.createIndexAttribute(e):t===pn.STORAGE?this.backend.createStorageAttribute(e):t===pn.INDIRECT&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(r.version<i.version||i.usage===Ms)&&(this.backend.updateAttribute(e),r.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function dN(n){return n.index!==null?n.index.version:n.attributes.position.version}function ab(n){const e=[],t=n.index,r=n.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const c=s[o+0],l=s[o+1],u=s[o+2];e.push(c,l,l,u,u,c)}}else{const s=r.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const c=o+0,l=o+1,u=o+2;e.push(c,l,l,u,u,c)}}const i=new(g2(e)?p2:m2)(e,1);return i.version=dN(n),i}class Ej extends di{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,r=this.get(t);r.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",i),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",i),this._geometryDisposeListeners.set(t,i)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,pn.STORAGE):this.updateAttribute(s,pn.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,pn.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,pn.INDIRECT)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:r}=e;let i=t.index;if(r.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=ab(t),s.set(t,o)):o.version!==dN(t)&&(this.attributes.delete(o),o=ab(t),s.set(t,o)),i=o}return i}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class Cj{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):ie("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class hN{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Rj extends hN{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class Mj extends hN{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let Pj=0;class uh{constructor(e,t,r,i=null,s=null){this.id=Pj++,this.code=e,this.stage=t,this.name=r,this.transforms=i,this.attributes=s,this.usedTimes=0}}class Dj extends di{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new uh(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),r.createProgram(a));const c=this._getComputeCacheKey(e,a);let l=this.caches.get(c);l===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),l=this._getComputePipeline(e,a,c,t)),l.usedTimes++,a.usedTimes++,i.version=e.version,i.pipeline=l}return i.pipeline}getForRender(e,t=null){const{backend:r}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new uh(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,c),r.createProgram(c));let l=this.programs.fragment.get(o.fragmentShader);l===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),l=new uh(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,l),r.createProgram(l));const u=this._getRenderCacheKey(e,c,l);let d=this.caches.get(u);d===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),d=this._getRenderPipeline(e,c,l,u,t)):e.pipeline=d,d.usedTimes++,c.usedTimes++,l.usedTimes++,i.pipeline=d}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,i){r=r||this._getComputeCacheKey(e,t);let s=this.caches.get(r);return s===void 0&&(s=new Mj(r,t),this.caches.set(r,s),this.backend.createComputePipeline(s,i)),s}_getRenderPipeline(e,t,r,i,s){i=i||this._getRenderCacheKey(e,t,r);let o=this.caches.get(i);return o===void 0&&(o=new Rj(i,t,r),this.caches.set(i,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Bj extends di{constructor(e,t,r,i,s,o){super(),this.backend=e,this.textures=r,this.pipelines=s,this.attributes=i,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t)this.delete(r)}deleteForRender(e){const t=e.getBindings();for(const r of t)this.delete(r)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const r=t.attribute,i=r.isIndirectStorageBufferAttribute?pn.INDIRECT:pn.STORAGE;this.attributes.update(r,i)}}_update(e,t){const{backend:r}=this;let i=!1,s=!0,o=0,a=0;for(const c of e.bindings)if(!(c.isNodeUniformsGroup&&this.nodes.updateGroup(c)===!1)){if(c.isStorageBuffer){const l=c.attribute,u=l.isIndirectStorageBufferAttribute?pn.INDIRECT:pn.STORAGE;this.attributes.update(l,u)}if(c.isUniformBuffer)c.update()&&r.updateBinding(c);else if(c.isSampledTexture){const l=c.update(),u=c.texture,d=this.textures.get(u);if(l&&(this.textures.updateTexture(u),c.generation!==d.generation&&(c.generation=d.generation,i=!0,s=!1)),r.get(u).externalTexture!==void 0||d.isDefaultTexture?s=!1:(o=o*10+u.id,a+=u.version),u.isStorageTexture===!0&&u.mipmapsAutoUpdate===!0){const f=this.get(u);c.store===!0?f.needsMipmap=!0:this.textures.needsMipmaps(u)&&f.needsMipmap===!0&&(this.backend.generateMipmaps(u),f.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const u=this.textures.updateSampler(c.texture);c.samplerKey!==u&&(c.samplerKey=u,i=!0,s=!1)}}i===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function Fj(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function cb(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function lb(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===zi&&n.forceSinglePass===!1}class kj{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,i,s,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:r,groupOrder:i,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=r,c.groupOrder=i,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(lb(r)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(lb(r)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Fj),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||cb),this.transparent.length>1&&this.transparent.sort(t||cb)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}const Ko=[];class Lj{constructor(e){this.lighting=e,this.lists=new In}get(e,t){const r=this.lists;Ko[0]=e,Ko[1]=t;let i=r.get(Ko);return i===void 0&&(i=new kj(this.lighting,e,t),r.set(Ko,i)),Ko.length=0,i}dispose(){this.lists=new In}}let Ij=0;class Oj{constructor(){this.id=Ij++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new et,this.scissor=!1,this.scissorValue=new et,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return fN(this)}}function fN(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:r}=n,i=[t,r];for(const s of e)i.push(s.id);return ac(i)}const Yo=[],Uj=new Ru,Vj=new XC;class Gj{constructor(){this.chainMaps={}}get(e,t,r=null){Yo[0]=e,Yo[1]=t;let i;if(r===null)i="default";else{const a=r.texture.format;i=`${r.textures.length}:${a}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const s=this._getChainMap(i);let o=s.get(Yo);return o===void 0&&(o=new Oj,s.set(Yo,o)),Yo.length=0,r!==null&&(o.sampleCount=r.samples===0?1:r.samples),o}getForClear(e=null){return this.get(Uj,Vj,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new In)}dispose(){this.chainMaps={}}}const $j=new le;class jj extends di{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),i=e.samples===0?1:e.samples,s=r.depthTextureMips||(r.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),c=a.width>>t,l=a.height>>t;let u=e.depthTexture||s[t];const d=e.depthBuffer===!0||e.stencilBuffer===!0;let h=!1;u===void 0&&d&&(u=new Zn,u.format=e.stencilBuffer?Jr:ei,u.type=e.stencilBuffer?Zr:mt,u.image.width=c,u.image.height=l,u.image.depth=a.depth,u.renderTarget=e,u.isArrayTexture=e.multiview===!0&&a.depth>1,s[t]=u),(r.width!==a.width||a.height!==r.height)&&(h=!0,u&&(u.needsUpdate=!0,u.image.width=c,u.image.height=l,u.image.depth=u.isArrayTexture?u.image.depth:1)),r.width=a.width,r.height=a.height,r.textures=o,r.depthTexture=u||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==i&&(h=!0,u&&(u.needsUpdate=!0),r.sampleCount=i);const f={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let p=0;p<o.length;p++){const m=o[p];h&&(m.needsUpdate=!0),this.updateTexture(m,f)}u&&this.updateTexture(u,f)}r.initialized!==!0&&(r.initialized=!0,r.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",r.onDispose))}updateTexture(e,t={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(i&&r.initialized===!0&&s.destroyTexture(e),e.isFramebufferTexture){const l=this.renderer.getRenderTarget();l?e.type=l.texture.type:e.type=sn}const{width:o,height:a,depth:c}=this.getSize(e);if(t.width=o,t.height=a,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,i||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createTexture(e,t),r.generation=e.version;else if(e.version>0){const l=e.image;if(l===void 0)se("Renderer: Texture marked for update but image is undefined.");else if(l.complete===!1)se("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const d=[];for(const h of e.images)d.push(h);t.images=d}else t.image=l;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(s.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t);const u=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!u&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version;r.initialized!==!0&&(r.initialized=!0,r.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&pt.getTransfer(e.colorSpace)!==be&&se("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),r.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",r.onDispose)),r.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=$j){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement?(t.width=r.videoWidth||1,t.height=r.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&r instanceof VideoFrame?(t.width=r.displayWidth||1,t.height=r.displayHeight||1,t.depth=1):(t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let i;return e.mipmaps.length>0?i=e.mipmaps.length:e.isCompressedTexture===!0?i=1:i=Math.floor(Math.log2(Math.max(t,r)))+1,i}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),r=t.textures,i=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let s=0;s<r.length;s++)this._destroyTexture(r[s]);i&&this._destroyTexture(i),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const r=t.isDefaultTexture;this.backend.destroyTexture(e,r),this.delete(e),this.info.memory.textures--}}}class dg extends vn{constructor(e,t,r,i=1){super(e,t,r),this.a=i}set(e,t,r,i=1){return this.a=i,super.set(e,t,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class zj extends Le{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const r=this.getNodeType(e),i=e.getStructTypeNode(r);let s;return i!==null?s=i.getMemberType(e,t):(ie(`TSL: Member "${t}" not found in struct "${r}".`),s="float"),s}getHash(){return this.uuid}generate(){return this.name}}class Hj extends ae{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e){return e.isNode!==!0?(ie("TSL: Invalid node added to stack."),this):(this.nodes.push(e),this)}If(e,t){const r=new ua(t);return this._currentCond=Rt(e,r),this.addToStack(this._currentCond)}ElseIf(e,t){const r=new ua(t),i=Rt(e,r);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new ua(e),this}Switch(e){return this._expressionNode=J(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(J(e[a])));else ie("TSL: Invalid parameter length. Case() requires at least two parameters.");const r=e[e.length-1],i=new ua(r);let s=t[0];for(let a=1;a<t.length;a++)s=s.or(t[a]);const o=Rt(s,i);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())i.isVarNode&&i.intent===!0&&i.isAssign(e)!==!0||(t["node"+r++]=i);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const r=$1();lu(this),e.setActiveStack(this);const i=e.buildStage;for(const o of this.nodes)if(!(o.isVarNode&&o.intent===!0&&o.isAssign(e)!==!0)){if(i==="setup")o.build(e);else if(i==="analyze")o.build(e,this);else if(i==="generate"){const a=e.getDataFromNode(o,"any").stages,c=a&&a[e.shaderStage];if(o.isVarNode&&c&&c.length===1&&c[0]&&c[0].isStackNode)continue;o.build(e,"void")}}let s;return this.hasOutput?s=this.outputNode.build(e,...t):s=super.build(e,...t),lu(r),e.removeActiveStack(this),s}}const dh=De(Hj).setParameterLength(0,1);new Cu;new le;new le;new le;new On;new le(0,0,-1);new et;new le;new le;new et;new we;const Wj=new bo;Ys.flipX();Wj.depthTexture=new Zn(1,1);const hh=new nm(-1,1,1,-1,0,1);class qj extends nc{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Gl([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Gl(t,2))}}const Xj=new qj;class hg extends kn{constructor(e=null){super(Xj,e),this.camera=hh,this.isQuadMesh=!0}async renderAsync(e){ft('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,hh)}render(e){e.render(this,hh)}}Y(([n])=>ir(z(52.9829189).mul(ir(lo(n,ne(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]});class Er extends ae{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Er.OBJECT?this.updateType=_e.OBJECT:e===Er.MATERIAL?this.updateType=_e.RENDER:e===Er.BEFORE_OBJECT?this.updateBeforeType=_e.OBJECT:e===Er.BEFORE_MATERIAL&&(this.updateBeforeType=_e.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Er.OBJECT="object";Er.MATERIAL="material";Er.BEFORE_OBJECT="beforeObject";Er.BEFORE_MATERIAL="beforeMaterial";const Qo=new gT,fh=new On;class Kt extends ae{static get type(){return"SceneNode"}constructor(e=Kt.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=this.scene!==null?this.scene:e.scene;let i;return t===Kt.BACKGROUND_BLURRINESS?i=Oe("backgroundBlurriness","float",r):t===Kt.BACKGROUND_INTENSITY?i=Oe("backgroundIntensity","float",r):t===Kt.BACKGROUND_ROTATION?i=pe("mat4").setName("backgroundRotation").setGroup(fe).onRenderUpdate(()=>{const s=r.background;return s!==null&&s.isTexture&&s.mapping!==U2?(Qo.copy(r.backgroundRotation),Qo.x*=-1,Qo.y*=-1,Qo.z*=-1,fh.makeRotationFromEuler(Qo)):fh.identity(),fh}):ie("SceneNode: Unknown scope:",t),i}}Kt.BACKGROUND_BLURRINESS="backgroundBlurriness";Kt.BACKGROUND_INTENSITY="backgroundIntensity";Kt.BACKGROUND_ROTATION="backgroundRotation";const Kj=re(Kt,Kt.BACKGROUND_BLURRINESS),ub=re(Kt,Kt.BACKGROUND_INTENSITY),Yj=re(Kt,Kt.BACKGROUND_ROTATION),Qj=Y(({texture:n,uv:e})=>{const r=X().toVar();return Xe(e.x.lessThan(1e-4),()=>{r.assign(X(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{r.assign(X(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{r.assign(X(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{r.assign(X(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{r.assign(X(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{r.assign(X(0,0,-1))}).Else(()=>{const s=n.sample(e.add(X(-.01,0,0))).r.sub(n.sample(e.add(X(.01,0,0))).r),o=n.sample(e.add(X(0,-.01,0))).r.sub(n.sample(e.add(X(0,.01,0))).r),a=n.sample(e.add(X(0,0,-.01))).r.sub(n.sample(e.add(X(0,0,.01))).r);r.assign(X(s,o,a))}),r.normalize()});class Zj extends So{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return X(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(je(Yi(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return Qj({texture:this,uv:e})}}const Jj=De(Zj).setParameterLength(1,3),Wc=new we;class e8 extends So{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class db extends e8{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class sd extends Tt{static get type(){return"PassNode"}constructor(e,t,r,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new Zn;s.isRenderTargetTexture=!0,s.name="depth";const o=new bo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:$t,...i});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=pe(0),this._cameraFar=pe(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=_e.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return se("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return se("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const r=this._textures[e],i=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=J(new db(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=J(new db(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=HS(this.getTextureNode(e),r,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Aa(s,r,i)}return t}async compileAsync(e){const t=e.getRenderTarget(),r=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(r)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getColorBufferType(),this.scope===sd.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let i,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,i=t.xr.getCamera(),t.xr.updateCamera(i),Wc.set(o.width,o.height)):(i=this.camera,s=t.getPixelRatio(),t.getSize(Wc)),this._pixelRatio=s,this.setSize(Wc.width,Wc.height);const a=t.getRenderTarget(),c=t.getMRT(),l=t.autoClear,u=i.layers.mask;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const h in this._previousTextures)this.toggleTexture(h);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0;const d=r.name;r.name=this.name?this.name:r.name,t.render(r,i),r.name=d,t.setRenderTarget(a),t.setMRT(c),t.autoClear=l,i.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const r=Math.floor(this._width*this._pixelRatio*this._resolutionScale),i=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(r,i),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,r,i){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new et),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,r,i),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,r,i){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new et),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,r,i),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}sd.COLOR="color";sd.DEPTH="depth";const t8=Y(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),n8=Y(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),r8=Y(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),r=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),i8=Y(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),s8=Y(([n,e])=>{const t=zt(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=zt(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=i8(n),n=r.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),o8=zt(X(1.6605,-.1246,-.0182),X(-.5876,1.1329,-.1006),X(-.0728,-.0083,1.1187)),a8=zt(X(.6274,.0691,.0164),X(.3293,.9195,.088),X(.0433,.0113,.8956)),c8=Y(([n])=>{const e=X(n).toVar(),t=X(e.mul(e)).toVar(),r=X(t.mul(t)).toVar();return z(15.5).mul(r.mul(t)).sub(Te(40.14,r.mul(e))).add(Te(31.96,r).sub(Te(6.868,t.mul(e))).add(Te(.4298,t).add(Te(.1191,e).sub(.00232))))}),l8=Y(([n,e])=>{const t=X(n).toVar(),r=zt(X(.856627153315983,.137318972929847,.11189821299995),X(.0951212405381588,.761241990602591,.0767994186031903),X(.0482516061458583,.101439036467562,.811302368396859)),i=zt(X(1.1271005818144368,-.1413297634984383,-.14132976349843826),X(-.11060664309660323,1.157823702216272,-.11060664309660294),X(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=z(-12.47393),o=z(4.026069);return t.mulAssign(e),t.assign(a8.mul(t)),t.assign(r.mul(t)),t.assign(_t(t,1e-10)),t.assign(Rr(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Br(t,0,1)),t.assign(c8(t)),t.assign(i.mul(t)),t.assign(Yu(_t(X(0),t),X(2.2))),t.assign(o8.mul(t)),t.assign(Br(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),u8=Y(([n,e])=>{const t=z(.76),r=z(.15);n=n.mul(e);const i=co(n.r,co(n.g,n.b)),s=Rt(i.lessThan(.08),i.sub(Te(6.25,i.mul(i))),.04);n.subAssign(s);const o=_t(n.r,_t(n.g,n.b));Xe(o.lessThan(t),()=>n);const a=Vt(1,t),c=Vt(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(c.div(o));const l=Vt(1,rr(1,r.mul(o.sub(c)).add(1)));return We(n,X(c),l)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class At extends ae{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class d8 extends At{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),i=r.name,s=r.type,o=e.getCodeFromNode(this,s);i!==""&&(o.name=i);const a=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(a);return o.code=c+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}function pN(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||lt.z).negate()}const h8=Y(([n,e],t)=>{const r=pN(t);return Fr(n,e,r)}),f8=Y(([n],e)=>{const t=pN(e);return n.mul(n,t,t).negate().exp().oneMinus()}),hb=Y(([n,e])=>ve(e.toFloat().mix(wa.rgb,n.toVec3()),wa.a));class p8 extends ae{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;r.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}De(p8);class lr extends ae{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,i=this.method,s=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,c=this.valueNode,l=[];l.push(`&${a.build(e,o)}`),c!==null&&l.push(c.build(e,o));const u=`${e.getMethod(i,s)}( ${l.join(", ")} )`;if(r?r.length===1&&r[0].isStackNode===!0:!1)e.addLineFlowCode(u,this);else return t.constNode===void 0&&(t.constNode=uo(u,s).toConst()),t.constNode.build(e)}}lr.ATOMIC_LOAD="atomicLoad";lr.ATOMIC_STORE="atomicStore";lr.ATOMIC_ADD="atomicAdd";lr.ATOMIC_SUB="atomicSub";lr.ATOMIC_MAX="atomicMax";lr.ATOMIC_MIN="atomicMin";lr.ATOMIC_AND="atomicAnd";lr.ATOMIC_OR="atomicOr";lr.ATOMIC_XOR="atomicXor";De(lr);class Pe extends Tt{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=r}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,r=this.bNode?this.bNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(r)?0:e.getTypeLength(r);return i>s?t:r}getNodeType(e){const t=this.method;return t===Pe.SUBGROUP_ELECT?"bool":t===Pe.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const r=this.method,i=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,a=this.bNode,c=[];if(r===Pe.SUBGROUP_BROADCAST||r===Pe.SUBGROUP_SHUFFLE||r===Pe.QUAD_BROADCAST){const u=a.getNodeType(e);c.push(o.build(e,i),a.build(e,u==="float"?"int":i))}else r===Pe.SUBGROUP_SHUFFLE_XOR||r===Pe.SUBGROUP_SHUFFLE_DOWN||r===Pe.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,i),a.build(e,"uint")):(o!==null&&c.push(o.build(e,s)),a!==null&&c.push(a.build(e,s)));const l=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(r,i)}${l}`,i,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Pe.SUBGROUP_ELECT="subgroupElect";Pe.SUBGROUP_BALLOT="subgroupBallot";Pe.SUBGROUP_ADD="subgroupAdd";Pe.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Pe.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Pe.SUBGROUP_MUL="subgroupMul";Pe.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Pe.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Pe.SUBGROUP_AND="subgroupAnd";Pe.SUBGROUP_OR="subgroupOr";Pe.SUBGROUP_XOR="subgroupXor";Pe.SUBGROUP_MIN="subgroupMin";Pe.SUBGROUP_MAX="subgroupMax";Pe.SUBGROUP_ALL="subgroupAll";Pe.SUBGROUP_ANY="subgroupAny";Pe.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Pe.QUAD_SWAP_X="quadSwapX";Pe.QUAD_SWAP_Y="quadSwapY";Pe.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Pe.SUBGROUP_BROADCAST="subgroupBroadcast";Pe.SUBGROUP_SHUFFLE="subgroupShuffle";Pe.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Pe.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Pe.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Pe.QUAD_BROADCAST="quadBroadcast";let qc;function od(n){qc=qc||new WeakMap;let e=qc.get(n);return e===void 0&&qc.set(n,e={}),e}function fg(n){const e=od(n);return e.shadowMatrix||(e.shadowMatrix=pe("mat4").setGroup(fe).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function m8(n,e=ho){const t=fg(n).mul(e);return t.xyz.div(t.w)}function mN(n){const e=od(n);return e.position||(e.position=pe(new le).setGroup(fe).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.matrixWorld)))}function g8(n){const e=od(n);return e.targetPosition||(e.targetPosition=pe(new le).setGroup(fe).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.target.matrixWorld)))}function gN(n){const e=od(n);return e.viewPosition||(e.viewPosition=pe(new le).setGroup(fe).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new le,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const xN=n=>Ir.transformDirection(mN(n).sub(g8(n))),x8=n=>n.sort((e,t)=>e.id-t.id),y8=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},ph=new WeakMap,Zo=[];class yN extends ae{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ii("vec3","totalDiffuse"),this.totalSpecularNode=ii("vec3","totalSpecular"),this.outgoingLightNode=ii("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const i=e[r];if(Zo.push(i.id),Zo.push(i.castShadow?1:0),i.isSpotLight===!0){const s=i.map!==null?i.map.id:-1,o=i.colorNode?i.colorNode.getCacheKey():-1;Zo.push(s,o)}}const t=ac(Zo);return Zo.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const r of this._lightNodes)t.push(r.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,i=x8(this._lights),s=e.renderer.library;for(const o of i)if(o.isNode)t.push(J(o));else{let a=null;if(r!==null&&(a=y8(o.id,r)),a===null){const c=s.getLightNodeClass(o.constructor);if(c===null){se(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let l=null;ph.has(o)?l=ph.get(o):(l=J(new c(o)),ph.set(o,l)),t.push(l)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.direct({...r,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.directRectArea({...r,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const i=e.context,s=i.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:a,totalSpecularNode:c}=this;i.outgoingLight=r;const l=e.addStack();o.nodes=l.nodes,s.start(e);const{backdrop:u,backdropAlpha:d}=i,{directDiffuse:h,directSpecular:f,indirectDiffuse:p,indirectSpecular:m}=i.reflectedLight;let x=h.add(p);u!==null&&(d!==null?x=X(d.mix(x,u)):x=X(u)),a.assign(x),c.assign(f.add(m)),r.assign(a.add(c)),s.finish(e),r=r.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class b8 extends ae{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=_e.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){bN.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||ho)}}const bN=ii("vec3","shadowPositionWorld");function v8(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new vn),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function _8(n,e){return e=v8(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function T8(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function w8(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function S8(n,e){return e=w8(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function N8(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function A8(n,e,t){return t=_8(n,t),t=S8(e,t),t}function E8(n,e,t){T8(n,t),N8(e,t)}const fb=new WeakMap,C8=Y(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Ee(n,e.xy).setName("t_basic");return n.isArrayTexture&&(r=r.depth(t)),r.compare(e.z)}),R8=Y(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(x,g)=>{let y=Ee(n,x);return n.isArrayTexture&&(y=y.depth(r)),y.compare(g)},s=Oe("mapSize","vec2",t).setGroup(fe),o=Oe("radius","float",t).setGroup(fe),a=ne(1).div(s),c=a.x.negate().mul(o),l=a.y.negate().mul(o),u=a.x.mul(o),d=a.y.mul(o),h=c.div(2),f=l.div(2),p=u.div(2),m=d.div(2);return Zt(i(e.xy.add(ne(c,l)),e.z),i(e.xy.add(ne(0,l)),e.z),i(e.xy.add(ne(u,l)),e.z),i(e.xy.add(ne(h,f)),e.z),i(e.xy.add(ne(0,f)),e.z),i(e.xy.add(ne(p,f)),e.z),i(e.xy.add(ne(c,0)),e.z),i(e.xy.add(ne(h,0)),e.z),i(e.xy,e.z),i(e.xy.add(ne(p,0)),e.z),i(e.xy.add(ne(u,0)),e.z),i(e.xy.add(ne(h,m)),e.z),i(e.xy.add(ne(0,m)),e.z),i(e.xy.add(ne(p,m)),e.z),i(e.xy.add(ne(c,d)),e.z),i(e.xy.add(ne(0,d)),e.z),i(e.xy.add(ne(u,d)),e.z)).mul(1/17)}),M8=Y(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(d,h)=>{let f=Ee(n,d);return n.isArrayTexture&&(f=f.depth(r)),f.compare(h)},s=Oe("mapSize","vec2",t).setGroup(fe),o=ne(1).div(s),a=o.x,c=o.y,l=e.xy,u=ir(l.mul(s).add(.5));return l.subAssign(u.mul(o)),Zt(i(l,e.z),i(l.add(ne(a,0)),e.z),i(l.add(ne(0,c)),e.z),i(l.add(o),e.z),We(i(l.add(ne(a.negate(),0)),e.z),i(l.add(ne(a.mul(2),0)),e.z),u.x),We(i(l.add(ne(a.negate(),c)),e.z),i(l.add(ne(a.mul(2),c)),e.z),u.x),We(i(l.add(ne(0,c.negate())),e.z),i(l.add(ne(0,c.mul(2))),e.z),u.y),We(i(l.add(ne(a,c.negate())),e.z),i(l.add(ne(a,c.mul(2))),e.z),u.y),We(We(i(l.add(ne(a.negate(),c.negate())),e.z),i(l.add(ne(a.mul(2),c.negate())),e.z),u.x),We(i(l.add(ne(a.negate(),c.mul(2))),e.z),i(l.add(ne(a.mul(2),c.mul(2))),e.z),u.x),u.y)).mul(1/9)}),P8=Y(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{const r=z(1).toVar();let i=Ee(n).sample(e.xy);n.isArrayTexture&&(i=i.depth(t)),i=i.rg;const s=aS(e.z,i.x);return Xe(s.notEqual(z(1)),()=>{const o=e.z.sub(i.x),a=_t(0,i.y.mul(i.y));let c=a.div(a.add(o.mul(o)));c=Br(Vt(c,.3).div(.95-.3)),r.assign(Br(_t(s,c)))}),r}),D8=Y(([n,e,t])=>{let r=ho.sub(n).length();return r=r.sub(e).div(t.sub(e)),r=r.saturate(),r}),B8=n=>{const e=n.shadow.camera,t=Oe("near","float",e).setGroup(fe),r=Oe("far","float",e).setGroup(fe),i=e4(n);return D8(i,t,r)},F8=n=>{let e=fb.get(n);if(e===void 0){const t=n.isPointLight?B8(n):null;e=new ut,e.colorNode=ve(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,fb.set(n,e)}return e},pb=new In,ws=[],k8=(n,e,t,r)=>{ws[0]=n,ws[1]=e;let i=pb.get(ws);return(i===void 0||i.shadowType!==t||i.useVelocity!==r)&&(i=(s,o,a,c,l,u,...d)=>{(s.castShadow===!0||s.receiveShadow&&t===bl)&&(r&&(O1(s).useVelocity=!0),s.onBeforeShadow(n,s,a,e.camera,c,o.overrideMaterial,u),n.renderObject(s,o,a,c,l,u,...d),s.onAfterShadow(n,s,a,e.camera,c,o.overrideMaterial,u))},i.shadowType=t,i.useVelocity=r,pb.set(ws,i)),ws[0]=null,ws[1]=null,i},L8=Y(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=z(0).toVar("meanVertical"),o=z(0).toVar("squareMeanVertical"),a=n.lessThanEqual(z(1)).select(z(0),z(2).div(n.sub(1))),c=n.lessThanEqual(z(1)).select(z(0),z(-1));hn({start:je(0),end:je(n),type:"int",condition:"<"},({i:u})=>{const d=c.add(z(u).mul(a));let h=r.sample(Zt(Zu.xy,ne(0,d).mul(e)).div(t));r.value.isArrayTexture&&(h=h.depth(i)),h=h.x,s.addAssign(h),o.addAssign(h.mul(h))}),s.divAssign(n),o.divAssign(n);const l=Gi(o.sub(s.mul(s)));return ne(s,l)}),I8=Y(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=z(0).toVar("meanHorizontal"),o=z(0).toVar("squareMeanHorizontal"),a=n.lessThanEqual(z(1)).select(z(0),z(2).div(n.sub(1))),c=n.lessThanEqual(z(1)).select(z(0),z(-1));hn({start:je(0),end:je(n),type:"int",condition:"<"},({i:u})=>{const d=c.add(z(u).mul(a));let h=r.sample(Zt(Zu.xy,ne(d,0).mul(e)).div(t));r.value.isArrayTexture&&(h=h.depth(i)),s.addAssign(h.x),o.addAssign(Zt(h.y.mul(h.y),h.x.mul(h.x)))}),s.divAssign(n),o.divAssign(n);const l=Gi(o.sub(s.mul(s)));return ne(s,l)}),O8=[C8,R8,M8,P8];let mh;const Xc=new hg;class vN extends b8{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o}){const a=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),c=t({depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o});return a.select(c,z(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:i}=e,s=Oe("bias","float",r).setGroup(fe);let o=t,a;if(r.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,i.coordinateSystem===Pu&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const l=Oe("near","float",r.camera).setGroup(fe),u=Oe("far","float",r.camera).setGroup(fe);a=WS(c.negate(),l,u)}return o=X(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return O8[e]}setupRenderTarget(e,t){const r=new Zn(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=am;const i=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return i.texture.name="ShadowMap",i.texture.type=e.mapType,i.depthTexture=r,{shadowMap:i,depthTexture:r}}setupShadow(e){const{renderer:t,camera:r}=e,{light:i,shadow:s}=this,o=t.shadowMap.type,{depthTexture:a,shadowMap:c}=this.setupRenderTarget(s,e);if(s.camera.coordinateSystem=r.coordinateSystem,s.camera.updateProjectionMatrix(),o===bl&&s.isPointLightShadow!==!0){a.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Kr,type:$t,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Kr,type:$t,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Kr,type:$t,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Kr,type:$t,depthBuffer:!1}));let v=Ee(a);a.isArrayTexture&&(v=v.depth(this.depthLayer));let _=Ee(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(_=_.depth(this.depthLayer));const T=Oe("blurSamples","float",s).setGroup(fe),w=Oe("radius","float",s).setGroup(fe),N=Oe("mapSize","vec2",s).setGroup(fe);let S=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ut);S.fragmentNode=L8({samples:T,radius:w,size:N,shadowPass:v,depthLayer:this.depthLayer}).context(e.getSharedContext()),S.name="VSMVertical",S=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ut),S.fragmentNode=I8({samples:T,radius:w,size:N,shadowPass:_,depthLayer:this.depthLayer}).context(e.getSharedContext()),S.name="VSMHorizontal"}const l=Oe("intensity","float",s).setGroup(fe),u=Oe("normalBias","float",s).setGroup(fe),d=fg(i).mul(bN.add(No.mul(u))),h=this.setupShadowCoord(e,d),f=s.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(f===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const p=o===bl&&s.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,m=this.setupShadowFilter(e,{filterFn:f,shadowTexture:c.texture,depthTexture:p,shadowCoord:h,shadow:s,depthLayer:this.depthLayer});let x=Ee(c.texture,h);a.isArrayTexture&&(x=x.depth(this.depthLayer));const g=We(1,m.rgb.mix(x,1),l.mul(x.a)).toVar();this.shadowMap=c,this.shadow.map=c;const y=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return g.toInspector(`${y} / Color`,()=>Ee(this.shadowMap.texture)).toInspector(`${y} / Depth`,()=>ln(this.shadowMap.depthTexture,wo().mul(Yi(Ee(this.shadowMap.depthTexture)))).x.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Y(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let r=this._node;return this.setupShadowPosition(e),r===null&&(this._node=r=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&se('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(r=e.material.receivedShadowNode(r)),r})()}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e;t.updateMatrices(i),r.setSize(t.mapSize.width,t.mapSize.height,r.depth);const a=o.name;o.name=`Shadow Map [ ${i.name||"ID: "+i.id} ]`,s.render(o,t.camera),o.name=a}updateShadow(e){const{shadowMap:t,light:r,shadow:i}=this,{renderer:s,scene:o,camera:a}=e,c=s.shadowMap.type,l=t.depthTexture.version;this._depthVersionCached=l;const u=i.camera.layers.mask;(i.camera.layers.mask&4294967294)===0&&(i.camera.layers.mask=a.layers.mask);const d=s.getRenderObjectFunction(),h=s.getMRT(),f=h?h.has("velocity"):!1;mh=A8(s,o,mh),o.overrideMaterial=F8(r),s.setRenderObjectFunction(k8(s,i,c,f)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(d),c===bl&&i.isPointLightShadow!==!0&&this.vsmPass(s),i.camera.layers.mask=u,E8(s,o,mh)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),Xc.material=this.vsmMaterialVertical,Xc.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Xc.material=this.vsmMaterialHorizontal,Xc.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const U8=(n,e)=>J(new vN(n,e)),V8=new vn,qn=Y(([n,e])=>{const t=n.toVar(),r=rn(t),i=rr(1,_t(r.x,_t(r.y,r.z)));r.mulAssign(i),t.mulAssign(i.mul(e.mul(2).oneMinus()));const s=ne(t.xy).toVar(),a=e.mul(1.5).oneMinus();return Xe(r.z.greaterThanEqual(a),()=>{Xe(t.z.greaterThan(0),()=>{s.x.assign(Vt(4,t.x))})}).ElseIf(r.x.greaterThanEqual(a),()=>{const c=pu(t.x);s.x.assign(t.z.mul(c).add(c.mul(2)))}).ElseIf(r.y.greaterThanEqual(a),()=>{const c=pu(t.y);s.x.assign(t.x.add(c.mul(2)).add(2)),s.y.assign(t.z.mul(c).sub(2))}),ne(.125,.25).mul(s).add(ne(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),G8=Y(({depthTexture:n,bd3D:e,dp:t,texelSize:r})=>Ee(n,qn(e,r.y)).compare(t)),$8=Y(({depthTexture:n,bd3D:e,dp:t,texelSize:r,shadow:i})=>{const s=Oe("radius","float",i).setGroup(fe),o=ne(-1,1).mul(s).mul(r.y);return Ee(n,qn(e.add(o.xyy),r.y)).compare(t).add(Ee(n,qn(e.add(o.yyy),r.y)).compare(t)).add(Ee(n,qn(e.add(o.xyx),r.y)).compare(t)).add(Ee(n,qn(e.add(o.yyx),r.y)).compare(t)).add(Ee(n,qn(e,r.y)).compare(t)).add(Ee(n,qn(e.add(o.xxy),r.y)).compare(t)).add(Ee(n,qn(e.add(o.yxy),r.y)).compare(t)).add(Ee(n,qn(e.add(o.xxx),r.y)).compare(t)).add(Ee(n,qn(e.add(o.yxx),r.y)).compare(t)).mul(1/9)}),j8=Y(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:r})=>{const i=t.xyz.toVar(),s=i.length(),o=pe("float").setGroup(fe).onRenderUpdate(()=>r.camera.near),a=pe("float").setGroup(fe).onRenderUpdate(()=>r.camera.far),c=Oe("bias","float",r).setGroup(fe),l=pe(r.mapSize).setGroup(fe),u=z(1).toVar();return Xe(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const d=s.sub(o).div(a.sub(o)).toVar();d.addAssign(c);const h=i.normalize(),f=ne(1).div(l.mul(ne(4,2)));u.assign(n({depthTexture:e,bd3D:h,dp:d,texelSize:f,shadow:r}))}),u}),mb=new et,Ss=new we,Jo=new we;class z8 extends vN{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===$2?G8:$8}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:r,depthTexture:i,shadowCoord:s,shadow:o}){return j8({filterFn:t,shadowTexture:r,depthTexture:i,shadowCoord:s,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e,a=t.getFrameExtents();Jo.copy(t.mapSize),Jo.multiply(a),r.setSize(Jo.width,Jo.height),Ss.copy(t.mapSize);const c=s.autoClear,l=s.getClearColor(V8),u=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const d=t.getViewportCount();for(let h=0;h<d;h++){const f=t.getViewport(h),p=Ss.x*f.x,m=Jo.y-Ss.y-Ss.y*f.y;mb.set(p,m,Ss.x*f.z,Ss.y*f.w),r.viewport.copy(mb),t.updateMatrices(i,h);const x=o.name;o.name=`Point Light Shadow [ ${i.name||"ID: "+i.id} ] - Face ${h+1}`,s.render(o,t.camera),o.name=x}s.autoClear=c,s.setClearColor(l,u)}}const H8=(n,e)=>J(new z8(n,e));class os extends Ao{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new vn,this.colorNode=e&&e.colorNode||pe(this.color).setGroup(fe),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=_e.FRAME}getHash(){return this.light.uuid}getLightVector(e){return gN(this.light).sub(e.context.positionView||lt)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return U8(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){const i=this.light.shadow.shadowNode;let s;i!==void 0?s=J(i):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=r=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const _N=Y(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const r=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(n.div(e).pow4().oneMinus().clamp().pow2()),r)}),W8=({color:n,lightVector:e,cutoffDistance:t,decayExponent:r})=>{const i=e.normalize(),s=e.length(),o=_N({lightDistance:s,cutoffDistance:t,decayExponent:r}),a=n.mul(o);return{lightDirection:i,lightColor:a}};class q8 extends os{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=pe(0).setGroup(fe),this.decayExponentNode=pe(2).setGroup(fe)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return H8(this.light)}setupDirect(e){return W8({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Y(([n=wo()],{renderer:e,material:t})=>{const r=uS(n.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.currentSamples>0){const s=z(r.fwidth()).toVar();i=Fr(s.oneMinus(),s.add(1),r).oneMinus()}else i=Rt(r.greaterThan(1),0,1);return i});const X8=Y(([n,e])=>{const t=n.x,r=n.y,i=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(r)),s=s.add(e.element(2).mul(2*.511664).mul(i)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(5).mul(2*.429043).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(8).mul(.429043).mul(Te(t,t).sub(Te(r,r)))),s}),_n=new dg;class K8 extends di{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const i=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)i._clearColor.getRGB(_n),_n.a=i._clearColor.a;else if(s.isColor===!0)s.getRGB(_n),_n.a=1,o=!0;else if(s.isNode===!0){const c=this.get(e),l=s;_n.copy(i._clearColor);let u=c.backgroundMesh;if(u===void 0){let m=function(){s.removeEventListener("dispose",m),u.material.dispose(),u.geometry.dispose()};const h=Qu(ve(l).mul(ub),{getUV:()=>Yj.mul(o4),getTextureLevel:()=>Kj});let f=$S;f=f.setZ(f.w);const p=new ut;p.name="Background.material",p.side=Qt,p.depthTest=!1,p.depthWrite=!1,p.allowOverride=!1,p.fog=!1,p.lights=!1,p.vertexNode=f,p.colorNode=h,c.backgroundMeshNode=h,c.backgroundMesh=u=new kn(new Zp(1,32,32),p),u.frustumCulled=!1,u.name="Background.mesh",u.onBeforeRender=function(x,g,y){this.matrixWorld.copyPosition(y.matrixWorld)},s.addEventListener("dispose",m)}const d=l.getCacheKey();c.backgroundCacheKey!==d&&(c.backgroundMeshNode.node=ve(l).mul(ub),c.backgroundMeshNode.needsUpdate=!0,u.material.needsUpdate=!0,c.backgroundCacheKey=d),t.unshift(u,u.geometry,u.material,0,0,null,null)}else ie("Renderer: Unsupported background configuration.",s);const a=i.xr.getEnvironmentBlendMode();if(a==="additive"?_n.set(0,0,0,1):a==="alpha-blend"&&_n.set(0,0,0,0),i.autoClear===!0||o===!0){const c=r.clearColorValue;c.r=_n.r,c.g=_n.g,c.b=_n.b,c.a=_n.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),r.depthClearValue=i._clearDepth,r.stencilClearValue=i._clearStencil,r.clearColor=i.autoClearColor===!0,r.clearDepth=i.autoClearDepth===!0,r.clearStencil=i.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let Y8=0;class pp{constructor(e="",t=[],r=0,i=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=i,this.id=Y8++}}class Q8{constructor(e,t,r,i,s,o,a,c,l,u=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=u,this.nodeAttributes=i,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.observer=l,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new pp(t.name,[],t.index,t.bindingsReference);e.push(i);for(const s of t.bindings)i.bindings.push(s.clone())}else e.push(t);return e}}class gb{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class Z8{constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class TN{constructor(e,t,r=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=i}}class J8 extends TN{constructor(e,t,r=null,i=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=i}}class ez{constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let tz=0;class gh{constructor(e=null){this.id=tz++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class nz{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class hi{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class rz extends hi{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class iz extends hi{constructor(e,t=new we){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class sz extends hi{constructor(e,t=new le){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class oz extends hi{constructor(e,t=new et){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class az extends hi{constructor(e,t=new vn){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class cz extends hi{constructor(e,t=new pT){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class lz extends hi{constructor(e,t=new rc){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class uz extends hi{constructor(e,t=new On){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class dz extends rz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class hz extends iz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class fz extends sz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class pz extends oz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class mz extends az{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class gz extends cz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class xz extends lz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class yz extends uz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let bz=0;const xb=new WeakMap,vz=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Kc=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class wN{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=dh(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new gh,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:bz++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===Wi&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=xb.get(this.renderer);return e===void 0&&(e=new In,xb.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new bo(e,t,r)}createCubeRenderTarget(e,t){return new YS(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),i=[];let s=!0;for(const a of t)i.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=r.get(i),o===void 0&&(o=new pp(e,i,this.bindingsIndexes[e].group,i),r.set(i,o))):o=new pp(e,i,this.bindingsIndexes[e].group,i),o}getBindGroupArray(e,t){const r=this.bindings[t];let i=r[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},r=this.bindings;for(const i of py)for(const s in r[i]){const o=r[i][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const i in t){const s=t[i],o=this._getBindGroup(i,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,r)=>t.bindings[0].groupNode.order-r.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==_e.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==_e.NONE&&this.updateBeforeNodes.push(e),r!==_e.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Ln||e.magFilter===nf||e.magFilter===ka||e.magFilter===Hi||e.minFilter===Ln||e.minFilter===nf||e.minFilter===ka||e.minFilter===Hi}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return r.cache===void 0&&(r.cache=new gh(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){se("Abstract function.")}getInstanceIndex(){se("Abstract function.")}getDrawIndex(){se("Abstract function.")}getFrontFacing(){se("Abstract function.")}getFragCoord(){se("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){se("Abstract function.")}generateTextureLod(){se("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=r?r[s]:null;o!==null?i+=o.build(this,e):i+=this.generateConst(e),s<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,r=null){const i=[];for(const s of t){const{name:o,type:a}=s;r&&r[o]&&r[o].isNode?i.push(r[o].build(this,a)):i.push(this.generateConst(a))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new vn:e==="vec2"?t=new we:e==="vec3"?t=new le:e==="vec4"&&(t=new et)),e==="float")return Kc(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Kc(t.r)}, ${Kc(t.g)}, ${Kc(t.b)} )`;const r=this.getTypeLength(e),i=this.getComponentType(e),s=o=>this.generateConst(i,o);if(r===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(r===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(r===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const r=this.attributes;for(const s of r)if(s.name===e)return s;const i=new gb(e,t);return this.registerDeclaration(i),r.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ut)return"int";if(t===mt)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let r=vU(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(r=r.replace("vec","mat")),i+r}getTypeFromArray(e){return vz.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,i=e.itemSize,s=e.normalized;let o;return!(e instanceof mT)&&s!==!0&&(o=this.getTypeFromArray(r)),this.getTypeFromLength(i,o)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return r!==null?Number(r[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=dh(this.stack);const e=$1();return this.stacks.push(e),lu(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const r=this.getDataFromNode(t);r.stack=e}return this.stack=e.parent,lu(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let i=r.getData(e);i===void 0&&(i={},r.setData(e,i)),i[t]===void 0&&(i[t]={});let s=i[t];const o=i.any?i.any.subBuilds:null,a=this.getClosestSubBuild(o);return a&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[a]||(s.subBuildsCache[a]={}),s.subBuilds=o),s}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e);let i=r.bufferAttribute;if(i===void 0){const s=this.uniforms.index++;i=new gb("nodeAttribute"+s,t,e),this.bufferAttributes.push(i),r.bufferAttribute=i}return i}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,r=null,i=this.shaderStage){const s=this.getDataFromNode(e,i,this.globalCache);let o=s.structType;if(o===void 0){const a=this.structs.index++;r===null&&(r="StructType"+a),o=new nz(r,t),this.structs[i].push(o),this.types[i][r]=e,s.structType=o}return o}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,i=null){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new Z8(i||"nodeUniform"+a,t,e),this.uniforms[r].push(o),this.registerDeclaration(o),s.uniform=o}return o}getVarFromNode(e,t=null,r=e.getNodeType(this),i=this.shaderStage,s=!1){const o=this.getDataFromNode(e,i),a=this.getSubBuildProperty("variable",o.subBuilds);let c=o[a];if(c===void 0){const l=s?"_const":"_var",u=this.vars[i]||(this.vars[i]=[]),d=this.vars[l]||(this.vars[l]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+d,this.vars[l]++),a!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const h=e.getArrayCount(this);c=new TN(t,r,s,h),s||u.push(c),this.registerDeclaration(c),o[a]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,r=e.getNodeType(this),i=null,s=null){const o=this.getDataFromNode(e,"any"),a=this.getSubBuildProperty("varying",o.subBuilds);let c=o[a];if(c===void 0){const l=this.varyings,u=l.length;t===null&&(t="nodeVarying"+u),a!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new J8(t,r,i,s),l.push(c),this.registerDeclaration(c),o[a]=c}return c}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let s=1,o=i;for(;r[o]!==void 0;)o=i+"_"+s++;s>1&&(e.name=o,se(`TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${o}'.`)),r[o]=e}getCodeFromNode(e,t,r=this.shaderStage){const i=this.getDataFromNode(e);let s=i.code;if(s===void 0){const o=this.codes[r]||(this.codes[r]=[]),a=o.length;s=new ez("nodeCode"+a,t),o.push(s),i.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:i}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(i.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of r)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,r){const i=this.getDataFromNode(e),s=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);s.push(t),o.set(r,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new d8,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)r[o.name]=new zj(o.type,o.name);e.layout=null;const i=e.call(r),s=this.flowStagesNode(i,t.type);return e.layout=t,s}flowBuildStage(e,t,r=null){const i=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,r);return this.setBuildStage(i),s}flowStagesNode(e,t=null){const r=this.flow,i=this.vars,s=this.declarations,o=this.cache,a=this.buildStage,c=this.stack,l={code:""};this.flow=l,this.vars={},this.declarations={},this.cache=new gh,this.stack=dh();for(const u of fy)this.setBuildStage(u),l.result=e.build(this,t);return l.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=i,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(a),l}getFunctionOperator(){return null}buildFunctionCode(){se("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=r,i}flowNodeFromShaderStage(e,t,r=null,i=null){const s=this.tab,o=this.cache,a=this.shaderStage,c=this.context;this.setShaderStage(e);const l={...this.context};delete l.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=l;let u=null;if(this.buildStage==="generate"){const d=this.flowChildNode(t,r);i!==null&&(d.code+=`${this.tab+i} = ${d.result};
`),this.flowCode[e]=this.flowCode[e]+d.code,u=d}else u=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=s,this.context=c,u}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){se("Abstract function.")}getVaryings(){se("Abstract function.")}getVar(e,t,r=null){return`${r!==null?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(r!==void 0)for(const i of r)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){se("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(t!==void 0)for(const i of t)r+=i.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){se("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const r=this.subBuildLayers;for(let i=t.length-1;i>=0;i--){const s=t[i];if(r.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let r;t!==null?r=this.getClosestSubBuild(t):r=this.subBuildFn;let i;return r?i=e?r+"_"+e:r:i=e,i}build(){const{object:e,material:t,renderer:r}=this;if(t!==null){let i=r.library.fromMaterial(t);i===null&&(ie(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new ut),i.build(this)}else this.addFlow("compute",e);for(const i of fy){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of py){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)i==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new dz(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new hz(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new fz(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new pz(e);if(t==="color")return new mz(e);if(t==="mat2")return new gz(e);if(t==="mat3")return new xz(e);if(t==="mat4")return new yz(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,r){if(t=this.getVectorType(t),r=this.getVectorType(r),t===r||r===null||this.isReference(r))return e;const i=this.getTypeLength(t),s=this.getTypeLength(r);return i===16&&s===9?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&s===4?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||s>4||s===0?e:i===s?`${this.getType(r)}( ${e} )`:i>s?(e=r==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),r)):s===4&&i>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&s>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${Mu} - Node System
`}}class yb{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return r===void 0&&(r={renderId:0,frameId:0},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===_e.FRAME){const i=this._getMaps(this.updateBeforeMap,r);i.frameId!==this.frameId&&e.updateBefore(this)!==!1&&(i.frameId=this.frameId)}else if(t===_e.RENDER){const i=this._getMaps(this.updateBeforeMap,r);i.renderId!==this.renderId&&e.updateBefore(this)!==!1&&(i.renderId=this.renderId)}else t===_e.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===_e.FRAME){const i=this._getMaps(this.updateAfterMap,r);i.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(i.frameId=this.frameId)}else if(t===_e.RENDER){const i=this._getMaps(this.updateAfterMap,r);i.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(i.renderId=this.renderId)}else t===_e.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===_e.FRAME){const i=this._getMaps(this.updateMap,r);i.frameId!==this.frameId&&e.update(this)!==!1&&(i.frameId=this.frameId)}else if(t===_e.RENDER){const i=this._getMaps(this.updateMap,r);i.renderId!==this.renderId&&e.update(this)!==!1&&(i.renderId=this.renderId)}else t===_e.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class pg{constructor(e,t,r=null,i="",s=!1){this.type=e,this.name=t,this.count=r,this.qualifier=i,this.isConst=s}}pg.isNodeFunctionInput=!0;class _z extends os{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:xN(this.light),lightColor:e}}}const xh=new On,Yc=new On;let ea=null;class Tz extends os{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=pe(new le).setGroup(fe),this.halfWidth=pe(new le).setGroup(fe),this.updateType=_e.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;Yc.identity(),xh.copy(t.matrixWorld),xh.premultiply(r),Yc.extractRotation(xh),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Yc),this.halfHeight.value.applyMatrix4(Yc)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=Ee(ea.LTC_FLOAT_1),r=Ee(ea.LTC_FLOAT_2)):(t=Ee(ea.LTC_HALF_1),r=Ee(ea.LTC_HALF_2));const{colorNode:i,light:s}=this,o=gN(s);return{lightColor:i,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){ea=e}}class mg extends os{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=pe(0).setGroup(fe),this.penumbraCosNode=pe(0).setGroup(fe),this.cutoffDistanceNode=pe(0).setGroup(fe),this.decayExponentNode=pe(0).setGroup(fe),this.colorNode=pe(this.color).setGroup(fe)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:i}=this;return Fr(r,i,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return r===void 0&&(r=m8(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,o=this.getLightVector(e),a=o.normalize(),c=a.dot(xN(s)),l=this.getSpotAttenuation(e,c),u=o.length(),d=_N({lightDistance:u,cutoffDistance:r,decayExponent:i});let h=t.mul(l).mul(d),f,p;return s.colorNode?(p=this.getLightCoord(e),f=s.colorNode(p)):s.map&&(p=this.getLightCoord(e),f=Ee(s.map,p.xy).onRenderUpdate(()=>s.map)),f&&(h=p.mul(2).sub(1).abs().lessThan(1).all().select(h.mul(f),h)),{lightColor:h,lightDirection:a}}}class wz extends mg{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let i=null;if(r&&r.isTexture===!0){const s=t.acos().mul(1/Math.PI);i=Ee(r,ne(s,0),0).r}else i=super.getSpotAttenuation(t);return i}}const Sz=Y(([n,e])=>{const t=n.abs().sub(e);return Mr(_t(t,0)).add(co(_t(t.x,t.y),0))});class Nz extends mg{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let r=1;t.map!==null&&(r=t.map.width/t.map.height),t.shadow.aspect=r}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=z(0),r=this.penumbraCosNode,i=fg(this.light).mul(e.context.positionWorld||ho);return Xe(i.w.greaterThan(0),()=>{const s=i.xyz.div(i.w),o=Sz(s.xy.sub(ne(.5)),ne(.5)),a=rr(-1,Vt(1,nS(r)).sub(1));t.assign(dS(o.mul(-2).mul(a)))}),t}}class Az extends os{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Ez extends os{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=mN(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=pe(new vn).setGroup(fe)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:i}=this,o=No.dot(i).mul(.5).add(.5),a=We(r,t,o);e.context.irradiance.addAssign(a)}}class Cz extends os{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new le);this.lightProbe=Pn(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=X8(No,this.lightProbe);e.context.irradiance.addAssign(t)}}class SN{parseFunction(){se("Abstract function.")}}class gg{constructor(e,t,r="",i=""){this.type=e,this.inputs=t,this.name=r,this.precision=i}getCode(){se("Abstract function.")}}gg.isNodeFunction=!0;const Rz=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Mz=/[a-z_0-9]+/ig,bb="#pragma main",Pz=n=>{n=n.trim();const e=n.indexOf(bb),t=e!==-1?n.slice(e+bb.length):n,r=t.match(Rz);if(r!==null&&r.length===5){const i=r[4],s=[];let o=null;for(;(o=Mz.exec(i))!==null;)s.push(o);const a=[];let c=0;for(;c<s.length;){const p=s[c][0]==="const";p===!0&&c++;let m=s[c][0];m==="in"||m==="out"||m==="inout"?c++:m="";const x=s[c++][0];let g=Number.parseInt(s[c][0]);Number.isNaN(g)===!1?c++:g=null;const y=s[c++][0];a.push(new pg(x,y,g,m,p))}const l=t.substring(r[0].length),u=r[3]!==void 0?r[3]:"",d=r[2],h=r[1]!==void 0?r[1]:"",f=e!==-1?n.slice(0,e):"";return{type:d,inputs:a,name:u,precision:h,inputsCode:i,blockCode:l,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class Dz extends gg{constructor(e){const{type:t,inputs:r,name:i,precision:s,inputsCode:o,blockCode:a,headerCode:c}=Pz(e);super(t,r,i,s),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(e=this.name){let t;const r=this.blockCode;if(r!==""){const{type:i,inputsCode:s,headerCode:o,precision:a}=this;let c=`${i} ${e} ( ${s.trim()} )`;a!==""&&(c=`${a} ${c}`),t=o+c+r}else t="";return t}}class Bz extends SN{parseFunction(e){return new Dz(e)}}const vb=new WeakMap,Hn=[],Ur=[];class Fz extends di{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new yb,this.nodeBuilderCache=new Map,this.callHashCache=new In,this.groupsData=new In,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===Q1.name)return!0;if(r===fe.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(r===s5.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}Hn[0]=t,Hn[1]=e;let i=this.groupsData.get(Hn);return i===void 0&&this.groupsData.set(Hn,i={}),Hn.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:i}=this,s=this.getForRenderCacheKey(e);if(r=i.get(s),r===void 0){const o=c=>{const l=this.backend.createNodeBuilder(e.object,this.renderer);return l.scene=e.scene,l.material=c,l.camera=e.camera,l.context.material=c,l.lightsNode=e.lightsNode,l.environmentNode=this.getEnvironmentNode(e.scene),l.fogNode=this.getFogNode(e.scene),l.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&l.enableMultiview(),l};let a=o(e.material);try{a.build()}catch(c){a=o(new ut),a.build(),ie("TSL: "+c)}r=this._createNodeBuilderState(a),i.set(s,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),r=this._createNodeBuilderState(i),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new Q8(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Hn[0]=e,Hn[1]=t;const r=this.renderer.info.calls,i=this.callHashCache.get(Hn)||{};if(i.callId!==r){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Ur.push(t.getCacheKey(!0)),s&&Ur.push(s.getCacheKey()),o&&Ur.push(o.getCacheKey()),Ur.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Ur.push(this.renderer.shadowMap.enabled?1:0),Ur.push(this.renderer.shadowMap.type),i.callId=r,i.cacheKey=ac(Ur),this.callHashCache.set(Hn,i),Ur.length=0}return Hn.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==r||i){const s=this.getCacheNode("background",r,()=>{if(r.isCubeTexture===!0||r.mapping===rm||r.mapping===im||r.mapping===tf){if(e.backgroundBlurriness>0||r.mapping===tf)return aN(r);{let o;return r.isCubeTexture===!0?o=Ha(r):o=Ee(r),ZS(o)}}else{if(r.isTexture===!0)return Ee(r,Ys.flipY()).setUpdateMatrix(!0);r.isColor!==!0&&ie("WebGPUNodes: Unsupported background configuration.",r)}},i);t.backgroundNode=s,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,i=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||i)&&(o=r(),s.set(t,o)),o}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const i=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const s=Oe("color","color",r).setGroup(fe),o=Oe("density","float",r).setGroup(fe);return hb(s,f8(o))}else if(r.isFog){const s=Oe("color","color",r).setGroup(fe),o=Oe("near","float",r).setGroup(fe),a=Oe("far","float",r).setGroup(fe);return hb(s,h8(o,a))}else ie("Renderer: Unsupported fog configuration.",r)});t.fogNode=i,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const i=this.getCacheNode("environment",r,()=>{if(r.isCubeTexture===!0)return Ha(r);if(r.isTexture===!0)return Ee(r);ie("Nodes: Unsupported environment configuration.",r)});t.environmentNode=i,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,i=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=r,o.camera=i,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return vb.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),i=e.isArrayTexture?Jj(e,X(Ys,uc("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Ee(e,Ys).renderOutput(t.toneMapping,t.currentColorSpace);return vb.set(e,r),i}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const i of r.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const i of r.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new yb,this.nodeBuilderCache=new Map,this.cacheLib={}}}const yh=new Cu;class xu{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new rc,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const i=e.length;for(let s=0;s<i;s++){yh.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[r+s],a=yh.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=yh.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,s=i.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let c=0;c<s;c++)o[a+c]=new et;r=!0}this.projectPlanes(i,o,a),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new xu(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class kz{constructor(e,t){this.bundleGroup=e,this.camera=t}}const ta=[];class Lz{constructor(){this.bundles=new In}get(e,t){const r=this.bundles;ta[0]=e,ta[1]=t;let i=r.get(ta);return i===void 0&&(i=new kz(e,t),r.set(ta,i)),ta.length=0,i}dispose(){this.bundles=new In}}class NN{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(r!==null){t=new r;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t)){se(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}addClass(e,t,r){if(r.has(t)){se(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}const Iz=new yN,na=[];class Oz extends In{constructor(){super()}createNode(e=[]){return new yN().setLights(e)}getNode(e,t){if(e.isQuadMesh)return Iz;na[0]=e,na[1]=t;let r=this.get(na);return r===void 0&&(r=this.createNode(),this.set(na,r)),na.length=0,r}}class ha extends bo{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const _b=new le,Tb=new le;class Uz extends tm{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ba,this._cameraL.viewport=new et,this._cameraR=new Ba,this._cameraR.viewport=new et,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new HC,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=Hz.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new we,this._onSessionEvent=$z.bind(this),this._onSessionEnd=jz.bind(this),this._onInputSourcesChange=zz.bind(this),this._onAnimationFrame=Wz.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&se("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&se("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,i,s,o,a,c={}){const l=new WC(e,t),u=new ha(s,o,{format:Dn,type:sn,depthTexture:new Zn(s,o,c.stencil?Zr:mt,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?Jr:ei),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});u._autoAllocateDepthBuffer=!0;const d=new Hr({color:16777215,side:ga});d.map=u.texture,d.map.offset.y=1,d.map.repeat.y=-1;const h=new kn(l,d);h.position.copy(r),h.quaternion.copy(i);const f={type:"quad",width:e,height:t,translation:r,quaternion:i,pixelwidth:s,pixelheight:o,plane:h,material:d,rendercall:a,renderTarget:u};if(this._layers.push(f),this._session!==null){f.plane.material=new Hr({color:16777215,side:ga}),f.plane.material.blending=xa,f.plane.material.blendEquation=vr,f.plane.material.blendSrc=jr,f.plane.material.blendDst=jr,f.xrlayer=this._createXRLayer(f);const p=this._session.renderState.layers;p.unshift(f.xrlayer),this._session.updateRenderState({layers:p})}else u.isXRRenderTarget=!1;return h}createCylinderLayer(e,t,r,i,s,o,a,c,l={}){const u=new P_(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),d=new ha(o,a,{format:Dn,type:sn,depthTexture:new Zn(o,a,l.stencil?Zr:mt,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?Jr:ei),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});d._autoAllocateDepthBuffer=!0;const h=new Hr({color:16777215,side:Qt});h.map=d.texture,h.map.offset.y=1,h.map.repeat.y=-1;const f=new kn(u,h);f.position.copy(i),f.quaternion.copy(s);const p={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:i,quaternion:s,pixelwidth:o,pixelheight:a,plane:f,material:h,rendercall:c,renderTarget:d};if(this._layers.push(p),this._session!==null){p.plane.material=new Hr({color:16777215,side:Qt}),p.plane.material.blending=xa,p.plane.material.blendEquation=vr,p.plane.material.blendSrc=jr,p.plane.material.blendDst=jr,p.xrlayer=this._createXRLayer(p);const m=this._session.renderState.layers;m.unshift(p.xrlayer),this._session.updateRenderState({layers:m})}else d.isXRRenderTarget=!1;return f}renderLayers(){const e=new le,t=new Zs,r=this._renderer,i=this.isPresenting,s=r.getOutputRenderTarget(),o=r._frameBufferTarget;this.isPresenting=!1;const a=new we;r.getSize(a);const c=r._quad;for(const l of this._layers)if(l.renderTarget.isXRRenderTarget=this._session!==null,l.renderTarget._hasExternalTextures=l.renderTarget.isXRRenderTarget,l.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){l.xrlayer.transform=new XRRigidTransform(l.plane.getWorldPosition(e),l.plane.getWorldQuaternion(t));const u=this._glBinding.getSubImage(l.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(l.renderTarget,u.colorTexture,void 0),r._setXRLayerSize(l.renderTarget.width,l.renderTarget.height),r.setOutputRenderTarget(l.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:d,quad:h}=this._frameBufferTargets.get(l.renderTarget)||{frameBufferTarget:null,quad:null};d?(r._frameBufferTarget=d,r._quad=h):(r._quad=new hg(new ut),this._frameBufferTargets.set(l.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),l.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(l.renderTarget),l.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(s),r._frameBufferTarget=o,r._setXRLayerSize(a.x,a.y),r._quad=c,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const i=this._gl,s=i.getContextAttributes();if(this._session=e,e!==null){if(r.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,a=null,c=null;t.depth&&(c=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,o=t.stencil?Jr:ei,a=t.stencil?Zr:mt);const l={colorFormat:i.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(l.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const u=this._glBinding.createProjectionLayer(l),d=[u];this._glProjLayer=u,t.setPixelRatio(1),t._setXRLayerSize(u.textureWidth,u.textureHeight);const h=this._useMultiview?2:1,f=new Zn(u.textureWidth,u.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,h);if(this._xrRenderTarget=new ha(u.textureWidth,u.textureHeight,{format:Dn,type:sn,colorSpace:t.outputColorSpace,depthTexture:f,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const p of this._layers)p.plane.material=new Hr({color:16777215,side:p.type==="cylinder"?Qt:ga}),p.plane.material.blending=xa,p.plane.material.blendEquation=vr,p.plane.material.blendSrc=jr,p.plane.material.blendDst=jr,p.xrlayer=this._createXRLayer(p),d.unshift(p.xrlayer);e.updateRenderState({layers:d})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,i,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new ha(a.framebufferWidth,a.framebufferHeight,{format:Dn,type:sn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const r=e.near,i=e.far,s=this._cameraXR,o=this._cameraL,a=this._cameraR;s.near=a.near=o.near=r,s.far=a.far=o.far=i,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,o.layers.mask=s.layers.mask&3,a.layers.mask=s.layers.mask&5;const c=e.parent,l=s.cameras;wb(s,c);for(let u=0;u<l.length;u++)wb(l[u],c);l.length===2?Vz(s,o,a):s.projectionMatrix.copy(o.projectionMatrix),Gz(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new qC,this._controllers[e]=t),t}}function Vz(n,e,t){_b.setFromMatrixPosition(e.matrixWorld),Tb.setFromMatrixPosition(t.matrixWorld);const r=_b.distanceTo(Tb),i=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(s[8]+1)/s[0],h=o*u,f=o*d,p=r/(-u+d),m=p*-u;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(m),n.translateZ(p),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),i[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const x=o+p,g=a+p,y=h-m,v=f+(r-m),_=c*a/g*x,T=l*a/g*x;n.projectionMatrix.makePerspective(y,v,_,T,x,g),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function wb(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function Gz(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=f2*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function $z(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const r=this.getReferenceSpace();t.update(n.inputSource,n.frame,r),t.dispatchEvent({type:n.type,data:n.inputSource})}}function jz(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const r=this._controllerInputSources[t];r!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(r))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new ha(t.pixelwidth,t.pixelheight,{format:Dn,type:sn,depthTexture:new Zn(t.pixelwidth,t.pixelheight,t.stencilBuffer?Zr:mt,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?Jr:ei),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function zz(n){const e=this._controllers,t=this._controllerInputSources;for(let r=0;r<n.removed.length;r++){const i=n.removed[r],s=t.indexOf(i);s>=0&&(t[s]=null,e[s].disconnect(i))}for(let r=0;r<n.added.length;r++){const i=n.added[r];let s=t.indexOf(i);if(s===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(i),s=a;break}else if(t[a]===null){t[a]=i,s=a;break}if(s===-1)break}const o=e[s];o&&o.connect(i)}}function Hz(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function Wz(n,e){if(e===void 0)return;const t=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const c=a.views;this._glBaseLayer!==null&&i.setXRTarget(s.framebuffer);let l=!1;c.length!==t.cameras.length&&(t.cameras.length=0,l=!0);for(let u=0;u<c.length;u++){const d=c[u];let h;if(this._supportsLayers===!0){const p=this._glBinding.getViewSubImage(this._glProjLayer,d);h=p.viewport,u===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,p.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:p.depthStencilTexture)}else h=s.getViewport(d);let f=this._cameras[u];f===void 0&&(f=new Ba,f.layers.enable(u),f.viewport=new et,this._cameras[u]=f),f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.quaternion,f.scale),f.projectionMatrix.fromArray(d.projectionMatrix),f.projectionMatrixInverse.copy(f.projectionMatrix).invert(),f.viewport.set(h.x,h.y,h.width,h.height),u===0&&(t.matrix.copy(f.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),l===!0&&t.cameras.push(f)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const l=this._controllerInputSources[c],u=this._controllers[c];l!==null&&u!==void 0&&u.update(l,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class qz extends tm{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new et(0,0,this._width,this._height),this._scissor=new et(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new L_,this.depthTexture=new Zn}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,i){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,r,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,i,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,r,i),a.minDepth=s,a.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const Sb=new Ru,Ns=new we,bh=new et,vh=new FC,_h=new BC,Qc=new On,mr=new et;class Xz{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:i=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:l=null,colorBufferType:u=$t,multiview:d=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=r,this.outputColorSpace=Jp,this.toneMapping=Oi,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new Cj,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new NN,this.lighting=new Oz,this._samples=c||a===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new qz(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new bS,this._inspector.setRenderer(this),this._getFallback=l,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new hg(new ut),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const h=this.alpha===!0?0:1;this._clearColor=new dg(0,0,0,h),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=u,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:DC},this.xr=new Uz(this,d),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(f,p,m)=>{await this.compileAsync(f,p);const x=this._renderLists.get(f,p),g=this._renderContexts.get(f,p,this._renderTarget),y=f.overrideMaterial||m.material,v=this._objects.get(m,y,f,p,x.lightsNode,g,g.clippingContext),{fragmentShader:_,vertexShader:T}=v.getNodeBuilderState();return{fragmentShader:_,vertexShader:T}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=r=this._getFallback(i),await r.init(this)}catch(s){t(s);return}else{t(i);return}}this._nodes=new Fz(this,r),this._animation=new bj(this,this._nodes,this.info),this._attributes=new Aj(r),this._background=new K8(this,this._nodes),this._geometries=new Ej(this._attributes,this.info),this._textures=new jj(this,r,this.info),this._pipelines=new Dj(r,this._nodes),this._bindings=new Bj(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new wj(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Lj(this.lighting),this._bundles=new Lz,this._renderContexts=new Gj,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,s=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,l=e.isScene===!0?e:Sb;r===null&&(r=e);const u=this._renderTarget,d=this._renderContexts.get(r,t,u),h=this._activeMipmapLevel,f=[];this._currentRenderContext=d,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,i.renderId++,i.update(),d.depth=this.depth,d.stencil=this.stencil,d.clippingContext||(d.clippingContext=new xu),d.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,u);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,d.clippingContext),r!==e&&r.traverseVisible(function(v){v.isLight&&v.layers.test(t.layers)&&p.pushLight(v)}),p.finish(),u!==null){this._textures.updateRenderTarget(u,h);const v=this._textures.get(u);d.textures=v.textures,d.depthTexture=v.depthTexture}else d.textures=null,d.depthTexture=null;this._background.update(l,p,d);const m=p.opaque,x=p.transparent,g=p.transparentDoublePass,y=p.lightsNode;this.opaque===!0&&m.length>0&&this._renderObjects(m,t,l,y),this.transparent===!0&&x.length>0&&this._renderTransparents(x,g,t,l,y),i.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){ft('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){ie("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=Ay,this.overrideNodes.modelNormalViewMatrix=Ey):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===Ay&&this.overrideNodes.modelNormalViewMatrix===Ey}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),ie(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:i,camera:s,renderList:o}=e,a=this._currentRenderContext,c=this._bundles.get(i,s),l=this.backend.get(c);l.renderContexts===void 0&&(l.renderContexts=new Set);const u=i.version!==l.version,d=l.renderContexts.has(a)===!1||u;if(l.renderContexts.add(a),d){this.backend.beginBundle(a),(l.renderObjects===void 0||u)&&(l.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:h,transparent:f,opaque:p}=o;this.opaque===!0&&p.length>0&&this._renderObjects(p,s,t,r),this.transparent===!0&&f.length>0&&this._renderTransparents(f,h,s,t,r),this._currentRenderBundle=null,this.backend.finishBundle(a,c),l.version=i.version}else{const{renderObjects:h}=l;for(let f=0,p=h.length;f<p;f++){const m=h[f];this._nodes.needsRefresh(m)&&(this._nodes.updateBefore(m),this._nodes.updateForRender(m),this._bindings.updateForRender(m),this._nodes.updateAfter(m))}}this.backend.addBundle(a,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,r=e!==Oi,i=t!==pt.workingColorSpace;if(r===!1&&i===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(Ns),{depth:a,stencil:c}=this;let l=this._frameBufferTarget;l===null&&(l=new bo(s,o,{depthBuffer:a,stencilBuffer:c,type:this._colorBufferType,format:Dn,colorSpace:pt.workingColorSpace,generateMipmaps:!1,minFilter:Ln,magFilter:Ln,samples:this.samples}),l.isPostProcessingRenderTarget=!0,this._frameBufferTarget=l);const u=this.getOutputRenderTarget();l.depthBuffer=a,l.stencilBuffer=c,u!==null?l.setSize(u.width,u.height,u.depth):l.setSize(s,o,1);const d=this._canvasTarget;return l.viewport.copy(d._viewport),l.scissor.copy(d._scissor),l.viewport.multiplyScalar(d._pixelRatio),l.scissor.multiplyScalar(d._pixelRatio),l.scissorTest=d._scissorTest,l.multiview=u!==null?u.multiview:!1,l.resolveDepthBuffer=u!==null?u.resolveDepthBuffer:!0,l._autoAllocateDepthBuffer=u!==null?u._autoAllocateDepthBuffer:!1,l}_renderScene(e,t,r=!0){if(this._isDeviceLost===!0)return;const i=r?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,l=e.isScene===!0?e:Sb,u=this._renderTarget||this._outputRenderTarget,d=this._activeCubeFace,h=this._activeMipmapLevel;let f;i!==null?(f=i,this.setRenderTarget(f)):f=u;const p=this._renderContexts.get(e,t,f);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(p),this.inspector.beginRender(this.backend.getTimestampUID(p),e,t,f);const m=this.coordinateSystem,x=this.xr;if(t.coordinateSystem!==m&&x.isPresenting===!1&&(t.coordinateSystem=m,t.updateProjectionMatrix(),t.isArrayCamera))for(const A of t.cameras)A.coordinateSystem=m,A.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),x.enabled===!0&&x.isPresenting===!0&&(x.cameraAutoUpdate===!0&&x.updateCamera(t),t=x.getCamera());const g=this._canvasTarget;let y=g._viewport,v=g._scissor,_=g._pixelRatio;f!==null&&(y=f.viewport,v=f.scissor,_=1),this.getDrawingBufferSize(Ns),bh.set(0,0,Ns.width,Ns.height);const T=y.minDepth===void 0?0:y.minDepth,w=y.maxDepth===void 0?1:y.maxDepth;p.viewportValue.copy(y).multiplyScalar(_).floor(),p.viewportValue.width>>=h,p.viewportValue.height>>=h,p.viewportValue.minDepth=T,p.viewportValue.maxDepth=w,p.viewport=p.viewportValue.equals(bh)===!1,p.scissorValue.copy(v).multiplyScalar(_).floor(),p.scissor=g._scissorTest&&p.scissorValue.equals(bh)===!1,p.scissorValue.width>>=h,p.scissorValue.height>>=h,p.clippingContext||(p.clippingContext=new xu),p.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,f);const N=t.isArrayCamera?_h:vh;t.isArrayCamera||(Qc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(Qc,t.coordinateSystem,t.reversedDepth));const S=this._renderLists.get(e,t);if(S.begin(),this._projectObject(e,t,0,S,p.clippingContext),S.finish(),this.sortObjects===!0&&S.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,h);const A=this._textures.get(f);p.textures=A.textures,p.depthTexture=A.depthTexture,p.width=A.width,p.height=A.height,p.renderTarget=f,p.depth=f.depthBuffer,p.stencil=f.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=Ns.width,p.height=Ns.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=h,p.height>>=h,p.activeCubeFace=d,p.activeMipmapLevel=h,p.occlusionQueryCount=S.occlusionQueryCount,p.scissorValue.max(mr.set(0,0,0,0)),p.scissorValue.x+p.scissorValue.width>p.width&&(p.scissorValue.width=Math.max(p.width-p.scissorValue.x,0)),p.scissorValue.y+p.scissorValue.height>p.height&&(p.scissorValue.height=Math.max(p.height-p.scissorValue.y,0)),this._background.update(l,S,p),p.camera=t,this.backend.beginRender(p);const{bundles:C,lightsNode:B,transparentDoublePass:D,transparent:U,opaque:$}=S;return C.length>0&&this._renderBundles(C,l,B),this.opaque===!0&&$.length>0&&this._renderObjects($,t,l,B),this.transparent===!0&&U.length>0&&this._renderTransparents(U,D,t,l,B),this.backend.finishRender(p),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,i!==null&&(this.setRenderTarget(u,d,h),this._renderOutput(f)),l.onAfterRender(this,e,t,f),this.inspector.finishRender(this.backend.getTimestampUID(p)),p}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,r)}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,r)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,r,i){this._canvasTarget.setScissor(e,t,r,i)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,r,i,s=0,o=1){this._canvasTarget.setViewport(e,t,r,i,s,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const i=this._renderTarget||this._getFrameBufferTarget();let s=null;if(i!==null){this._textures.updateRenderTarget(i);const o=this._textures.get(i);s=this._renderContexts.getForClear(i),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=i,s.depth=i.depthBuffer,s.stencil=i.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,s),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){ft('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,r)}async clearColorAsync(){ft('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){ft('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){ft('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Oi,t=this.currentColorSpace!==pt.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Oi}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:pt.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return se("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const r=this._nodes.nodeFrame,i=r.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const s=this.backend,o=this._pipelines,a=this._bindings,c=this._nodes,l=Array.isArray(e)?e:[e];if(l[0]===void 0||l[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const u of l){if(o.has(u)===!1){const f=()=>{u.removeEventListener("dispose",f),o.delete(u),a.deleteForCompute(u),c.delete(u)};u.addEventListener("dispose",f);const p=u.onInitFunction;p!==null&&p.call(u,{renderer:this})}c.updateForCompute(u),a.updateForCompute(u);const d=a.getForCompute(u),h=o.getForCompute(u,d);s.compute(e,u,d,h,t)}s.finishCompute(e),r.renderId=i,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return ft('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){ft('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=mr.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=mr.copy(t).floor();else{ie("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=mr.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext,i;r!==null?i=r.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),r=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,r,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,i,s,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,r,i,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,r,i,s,a)}_projectObject(e,t,r,i,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?_h:vh;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&mr.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Qc);const{geometry:l,material:u}=e;u.visible&&i.push(e,l,u,r,mr.z,null,s)}}else if(e.isLineLoop)ie("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?_h:vh;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),mr.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Qc)),Array.isArray(u)){const d=l.groups;for(let h=0,f=d.length;h<f;h++){const p=d[h],m=u[p.materialIndex];m&&m.visible&&i.push(e,l,m,r,mr.z,p,s)}}else u.visible&&i.push(e,l,u,r,mr.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(e,t),i.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const a=e.children;for(let c=0,l=a.length;c<l;c++)this._projectObject(a[c],t,r,i,s)}_renderBundles(e,t,r){for(const i of e)this._renderBundle(i,t,r)}_renderTransparents(e,t,r,i,s){if(t.length>0){for(const{material:o}of t)o.side=Qt;this._renderObjects(t,r,i,s,"backSide");for(const{material:o}of t)o.side=ga;this._renderObjects(e,r,i,s);for(const{material:o}of t)o.side=zi}else this._renderObjects(e,r,i,s)}_renderObjects(e,t,r,i,s=null){for(let o=0,a=e.length;o<a;o++){const{object:c,geometry:l,material:u,group:d,clippingContext:h}=e[o];this._currentRenderObjectFunction(c,r,t,l,u,d,i,h,s)}}_getShadowNodes(e){const t=e.version;let r=this._cacheShadowNodes.get(e);if(r===void 0||r.version!==t){const i=e.map!==null,s=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let a=null,c=null,l=null;if(i||s||o){let u,d;o?(u=e.castShadowNode.rgb,d=e.castShadowNode.a):(u=X(0),d=z(1)),i&&(d=d.mul(Oe("map","texture",e).a)),s&&(d=d.mul(e.colorNode.a)),c=ve(u,d)}e.depthNode&&e.depthNode.isNode&&(l=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?a=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(a=e.positionNode),r={version:t,colorNode:c,depthNode:l,positionNode:a},this._cacheShadowNodes.set(e,r)}return r}renderObject(e,t,r,i,s,o,a,c=null,l=null){let u=!1,d,h,f,p;if(e.onBeforeRender(this,t,r,i,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const m=t.overrideMaterial;if(u=!0,d=t.overrideMaterial.colorNode,h=t.overrideMaterial.depthNode,f=t.overrideMaterial.positionNode,p=t.overrideMaterial.side,s.positionNode&&s.positionNode.isNode&&(m.positionNode=s.positionNode),m.alphaTest=s.alphaTest,m.alphaMap=s.alphaMap,m.transparent=s.transparent||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode,m.isShadowPassMaterial){const{colorNode:x,depthNode:g,positionNode:y}=this._getShadowNodes(s);m.side=s.shadowSide===null?s.side:s.shadowSide,x!==null&&(m.colorNode=x),g!==null&&(m.depthNode=g),y!==null&&(m.positionNode=y)}s=m}s.transparent===!0&&s.side===zi&&s.forceSinglePass===!1?(s.side=Qt,this._handleObjectFunction(e,s,t,r,a,o,c,"backSide"),s.side=ga,this._handleObjectFunction(e,s,t,r,a,o,c,l),s.side=zi):this._handleObjectFunction(e,s,t,r,a,o,c,l),u&&(t.overrideMaterial.colorNode=d,t.overrideMaterial.depthNode=h,t.overrideMaterial.positionNode=f,t.overrideMaterial.side=p),e.onAfterRender(this,t,r,i,s,o)}_renderObjectDirect(e,t,r,i,s,o,a,c){const l=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);l.drawRange=e.geometry.drawRange,l.group=o;const u=this._nodes.needsRefresh(l);u&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(l,this.info),u&&this._nodes.updateAfter(l)}_createObjectPipeline(e,t,r,i,s,o,a,c){const l=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);l.drawRange=e.geometry.drawRange,l.group=o,this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l),this._pipelines.getForRender(l,this._compilationPromises),this._nodes.updateAfter(l)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class AN{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function Kz(n){return n+(Xr-n%Xr)%Xr}class EN extends AN{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return Kz(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class CN extends EN{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let Yz=0;class RN extends CN{constructor(e,t){super("UniformBuffer_"+Yz++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Qz extends CN{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,i=this.uniforms.length;r<i;r++){const s=this.uniforms[r],o=s.boundary,a=s.itemSize*e,c=t%Xr,l=c%o,u=c+l;t+=l,u!==0&&Xr-u<a&&(t+=Xr-u),s.offset=t/e,t+=a}return Math.ceil(t/Xr)*Xr}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);ie("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s]!==i){const a=this._getBufferForType(o);a[s]=r[s]=i,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z||r[s+4]!==i.w){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,a[s+3]=r[s+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset;if(r[s+0]!==i.r||r[s+1]!==i.g||r[s+2]!==i.b){const o=this.buffer;o[s+0]=r[s+0]=i.r,o[s+1]=r[s+1]=i.g,o[s+2]=r[s+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;if(r[s+0]!==i[0]||r[s+1]!==i[1]||r[s+2]!==i[2]||r[s+4]!==i[3]||r[s+5]!==i[4]||r[s+6]!==i[5]||r[s+8]!==i[6]||r[s+9]!==i[7]||r[s+10]!==i[8]){const o=this.buffer;o[s+0]=r[s+0]=i[0],o[s+1]=r[s+1]=i[1],o[s+2]=r[s+2]=i[2],o[s+4]=r[s+4]=i[3],o[s+5]=r[s+5]=i[4],o[s+6]=r[s+6]=i[5],o[s+8]=r[s+8]=i[6],o[s+9]=r[s+9]=i[7],o[s+10]=r[s+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;return Jz(r,i,s)===!1&&(this.buffer.set(i,s),Zz(r,i,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Zz(n,e,t){for(let r=0,i=e.length;r<i;r++)n[t+r]=e[r]}function Jz(n,e,t){for(let r=0,i=e.length;r<i;r++)if(n[t+r]!==e[r])return!1;return!0}let e6=0;class MN extends Qz{constructor(e,t){super(e),this.id=e6++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class PN extends AN{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let t6=0;class n6 extends PN{constructor(e,t){super(e,t),this.id=t6++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class ad extends n6{constructor(e,t,r,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=i}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class DN extends ad{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledCubeTexture=!0}}class mp extends ad{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledTexture3D=!0}}const Nb={bitcast_int_uint:new At("uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }"),bitcast_uint_int:new At("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }")},r6={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint"},i6={low:"lowp",medium:"mediump",high:"highp"},Ab={swizzleAssign:!0,storageBuffer:!1},Eb={perspective:"smooth",linear:"noperspective"},Cb={centroid:"centroid"},Rb=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class s6 extends wN{constructor(e,t){super(e,t,new Bz),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Js}_include(e){const t=Nb[e];return t.build(this),this.addInclude(t),t}getMethod(e){return Nb[e]!==void 0&&this._include(e),r6[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getTernary(e,t,r){return`${e} ? ${t} : ${r}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const r=t.array,i=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?um:lm;s===2?a=o?dm:Kr:s===3?a=o?k2:cm:s===4&&(a=o?hm:Dn);const c={Float32Array:dn,Uint8Array:sn,Uint16Array:Ps,Uint32Array:mt,Int8Array:ya,Int16Array:ba,Int32Array:Ut,Uint8ClampedArray:sn},l=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/s))));let u=Math.ceil(i/s/l);l*u*s<i&&u++;const d=l*u*s,h=new r.constructor(d);h.set(r,0),t.array=h;const f=new fT(t.array,l,u,a,c[t.array.constructor.name]||dn);f.needsUpdate=!0,f.isPBOTexture=!0;const p=new So(f,null,null);p.setPrecision("high"),t.pboNode=p,t.pbo=p.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,i=t.value;if(this.renderer.backend.has(i)){const u=this.renderer.backend.get(i);u.pbo=i.pbo}const s=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(s);this.increaseUsage(r);const a=r.build(this,"uint"),c=this.getDataFromNode(e);let l=c.propertyName;if(l===void 0){const u=this.getVarFromNode(e);l=this.getPropertyName(u);const d=this.getDataFromNode(t);let h=d.propertySizeName;h===void 0&&(h=l+"Size",this.getVarFromNode(t,h,"uint"),this.addLineFlowCode(`${h} = uint( textureSize( ${o}, 0 ).x )`,e),d.propertySizeName=h);const{itemSize:f}=i,p="."+To.join("").slice(0,f),m=`ivec2(${a} % ${h}, ${a} / ${h})`,x=this.generateTextureLoad(null,o,m,"0",null,null);let g="vec4";i.pbo.type===mt?g="uvec4":i.pbo.type===Ut&&(g="ivec4"),this.addLineFlowCode(`${l} = ${g}(${x})${p}`,e),c.propertyName=l}return l}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0");let a;return s?o?a=`texelFetchOffset( ${t}, ivec3( ${r}, ${s} ), ${i}, ${o} )`:a=`texelFetch( ${t}, ivec3( ${r}, ${s} ), ${i} )`:o?a=`texelFetchOffset( ${t}, ${r}, ${i}, ${o} )`:a=`texelFetch( ${t}, ${r}, ${i} )`,e!==null&&e.isDepthTexture&&(a+=".x"),a}generateTexture(e,t,r,i,s){return i&&(r=`vec3( ${r}, ${i} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${r}, ${s} ).x`:`texture( ${t}, ${r} ).x`:s?`textureOffset( ${t}, ${r}, ${s} )`:`texture( ${t}, ${r} )`}generateTextureLevel(e,t,r,i,s){return s?`textureLodOffset( ${t}, ${r}, ${i}, ${s} )`:`textureLod( ${t}, ${r}, ${i} )`}generateTextureBias(e,t,r,i,s){return s?`textureOffset( ${t}, ${r}, ${s}, ${i} )`:`texture( ${t}, ${r}, ${i} )`}generateTextureGrad(e,t,r,i,s){return s?`textureGradOffset( ${t}, ${r}, ${i[0]}, ${i[1]}, ${s} )`:`textureGrad( ${t}, ${r}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return s?o?`textureOffset( ${t}, vec4( ${r}, ${s}, ${i} ), ${o} )`:`texture( ${t}, vec4( ${r}, ${s}, ${i} ) )`:o?`textureOffset( ${t}, vec3( ${r}, ${i} ), ${o} )`:`texture( ${t}, vec3( ${r}, ${i} ) )`;ie(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],r=[],i={};for(const o of t){let a=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const u=o.node.value;let d="";(u.isDataTexture===!0||u.isData3DTexture===!0)&&(u.type===mt?d="u":u.type===Ut&&(d="i")),o.type==="texture3D"&&u.isArrayTexture===!1?a=`${d}sampler3D ${o.name};`:u.compareFunction?u.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:u.isArrayTexture===!0||u.isDataArrayTexture===!0||u.isCompressedArrayTexture===!0?a=`${d}sampler2DArray ${o.name};`:a=`${d}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="buffer"){const u=o.node,d=this.getType(u.bufferType),h=u.bufferCount,f=h>0?h:"";a=`${u.name} {
	${d} ${o.name}[${f}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const l=o.node.precision;if(l!==null&&(a=i6[l]+" "+a),c){a="	"+a;const u=o.groupNode.name;(i[u]||(i[u]=[])).push(a)}else a="uniform "+a,r.push(a)}let s="";for(const o in i){const a=i[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=r.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ut){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const i=r.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let i=0;for(const s of r)t+=`layout( location = ${i++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`	${r.type} ${r.name};`);return t.join(`
`)}getStructs(e){const t=[],r=this.structs[e],i=[];for(const s of r)if(s.output)for(const o of s.members)i.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const i of r){e==="compute"&&(i.needsInterpolation=!0);const s=this.getType(i.type);if(i.needsInterpolation)if(i.interpolationType){const o=Eb[i.interpolationType]||i.interpolationType,a=Cb[i.interpolationSampling]||"";t+=`${o} ${a} out ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${i.name};
`}else t+=`${s} ${i.name};
`}else if(e==="fragment"){for(const i of r)if(i.needsInterpolation){const s=this.getType(i.type);if(i.interpolationType){const o=Eb[i.interpolationType]||i.interpolationType,a=Cb[i.interpolationSampling]||"";t+=`${o} ${a} in ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${i.name};
`}}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((r,i)=>r*i,1)}u`}getSubgroupSize(){ie("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){ie("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){ie("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const i=this.extensions[r]||(this.extensions[r]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(r!==void 0)for(const{name:i,behavior:s}of r.values())t.push(`#extension ${i} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=Ab[e];if(t===void 0){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance";break}if(r!==void 0){const i=this.renderer.backend.extensions;i.has(r)&&(i.get(r),t=!0)}Ab[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const i=e[r],s=this.getPropertyName(i.attributeNode);s&&(t+=`${i.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Rb}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Rb}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1];for(const a of i){const c=this.getFlowData(a),l=a.name;l&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${l}
	`),r+=`${c.code}
	`,a===s&&t!=="compute"&&(r+=`// result
	`,t==="vertex"?(r+="gl_Position = ",r+=`${c.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=e.groupNode,l=c.name,u=this.getBindGroupArray(l,r);if(t==="texture")a=new ad(s.name,s.node,c),u.push(a);else if(t==="cubeTexture")a=new DN(s.name,s.node,c),u.push(a);else if(t==="texture3D")a=new mp(s.name,s.node,c),u.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const d=new RN(e,c);d.name=e.name,u.push(d),a=d}else{const d=this.uniformGroups[r]||(this.uniformGroups[r]={});let h=d[l];h===void 0&&(h=new MN(r+"_"+l,c),d[l]=h,u.push(h)),a=this.getNodeUniform(s,t),h.addUniform(a)}o.uniformGPU=a}return s}}let Th=null,As=null;class BN{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[Xn.RENDER]:null,[Xn.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),r=this.renderer.info.frame;let i;e.isComputeNode===!0?i="c:"+this.renderer.info.compute.frameCalls:i="r:"+this.renderer.info.render.frameCalls,t.timestampUID=i+":"+e.id+":f"+r}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?Xn.COMPUTE:Xn.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){ft("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return Th=Th||new we,this.renderer.getDrawingBufferSize(Th)}setScissorTest(){}getClearColor(){const e=this.renderer;return As=As||new dg,e.getClearColor(As),As.getRGB(As),As}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:KC(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Mu} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let o6=0;class a6{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class c6{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:i}=r,s=e.array,o=e.usage||i.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,c=r.get(a);let l=c.bufferGPU;l===void 0&&(l=this._createBuffer(i,t,s,o),c.bufferGPU=l,c.bufferType=t,c.version=a.version);let u;if(s instanceof Float32Array)u=i.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)u=i.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?u=i.HALF_FLOAT:u=i.UNSIGNED_SHORT;else if(s instanceof Int16Array)u=i.SHORT;else if(s instanceof Uint32Array)u=i.UNSIGNED_INT;else if(s instanceof Int32Array)u=i.INT;else if(s instanceof Int8Array)u=i.BYTE;else if(s instanceof Uint8Array)u=i.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)u=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let d={bufferGPU:l,bufferType:t,type:u,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:u===i.INT||u===i.UNSIGNED_INT||e.gpuType===Ut,id:o6++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const h=this._createBuffer(i,t,s,o);d=new a6(d,h)}r.set(e,d)}updateAttribute(e){const t=this.backend,{gl:r}=t,i=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(a,o.bufferGPU),c.length===0)r.bufferSubData(a,0,i);else{for(let l=0,u=c.length;l<u;l++){const d=c[l];r.bufferSubData(a,d.start*i.BYTES_PER_ELEMENT,i,d.start,d.count)}s.clearUpdateRanges()}r.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);r.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(i),o=e.array,a=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,s);const c=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.bufferData(r.COPY_WRITE_BUFFER,a,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const l=new e.array.constructor(o.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,l),r.deleteBuffer(c),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(e,t,r,i){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,r,i),e.bindBuffer(t,null),s}}let wh,ra;class l6{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;wh={[vr]:e.FUNC_ADD,[W_]:e.FUNC_SUBTRACT,[H_]:e.FUNC_REVERSE_SUBTRACT},ra={[jr]:e.ZERO,[nT]:e.ONE,[tT]:e.SRC_COLOR,[eT]:e.SRC_ALPHA,[J_]:e.SRC_ALPHA_SATURATE,[Z_]:e.DST_COLOR,[Q_]:e.DST_ALPHA,[Y_]:e.ONE_MINUS_SRC_COLOR,[K_]:e.ONE_MINUS_SRC_ALPHA,[X_]:e.ONE_MINUS_DST_COLOR,[q_]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=new et().fromArray(t),this.currentViewport=new et().fromArray(r),this._tempVec4=new et}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==QC?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===ZC?t.cullFace(t.BACK):e===JC?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,r,i,s,o,a,c){const{gl:l}=this;if(e===eo){this.currentBlendingEnabled===!0&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),e!==xa){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==vr||this.currentBlendEquationAlpha!==vr)&&(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=vr,this.currentBlendEquationAlpha=vr),c)switch(e){case Wi:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case Vl:l.blendFunc(l.ONE,l.ONE);break;case Ul:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case Ol:l.blendFuncSeparate(l.DST_COLOR,l.ONE_MINUS_SRC_ALPHA,l.ZERO,l.ONE);break;default:ie("WebGLState: Invalid blending: ",e);break}else switch(e){case Wi:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case Vl:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE,l.ONE,l.ONE);break;case Ul:ie("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ol:ie("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:ie("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||r,a=a||i,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(l.blendEquationSeparate(wh[t],wh[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(r!==this.currentBlendSrc||i!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(l.blendFuncSeparate(ra[r],ra[i],ra[o],ra[a]),this.currentBlendSrc=r,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case uT:t.depthFunc(t.NEVER);break;case lT:t.depthFunc(t.ALWAYS);break;case cT:t.depthFunc(t.LESS);break;case aT:t.depthFunc(t.LEQUAL);break;case oT:t.depthFunc(t.EQUAL);break;case sT:t.depthFunc(t.GEQUAL);break;case iT:t.depthFunc(t.GREATER);break;case rT:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:i}=this;e.side===zi?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let s=e.side===Qt;t&&(s=!s),this.setFlipSided(s),e.blending===Wi&&e.transparent===!1?this.setBlending(eo):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r)for(let c=0;c<8;c++)c<r?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,r){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==r)&&(i.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const r=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(r.bindVertexArray(e),t!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:i}=this;return i[e]!==t?(r.bindFramebuffer(e,t),i[e]=t,e===r.DRAW_FRAMEBUFFER&&(i[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(i[r.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:r}=this;let i=[],s=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const o=e.textures;if(i.length!==o.length||i[0]!==r.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)i[a]=r.COLOR_ATTACHMENT0+a;i.length=o.length,s=!0}}else i[0]!==r.BACK&&(i[0]=r.BACK,s=!0);s&&r.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:i,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;r===void 0&&(s===null?r=i.TEXTURE0+a-1:r=s);let c=o[r];c===void 0&&(c={type:void 0,texture:void 0},o[r]=c),(c.type!==e||c.texture!==t)&&(s!==r&&(i.activeTexture(r),this.currentTextureSlot=r),i.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,r){const{gl:i}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==r?(i.bindBufferBase(e,t,r),this.currentBoundBufferBases[s]=r,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,i=r[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class u6{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Js){const{gl:r,extensions:i}=this;let s;const o=pt.getTransfer(t);if(e===sn)return r.UNSIGNED_BYTE;if(e===e2)return r.UNSIGNED_SHORT_4_4_4_4;if(e===t2)return r.UNSIGNED_SHORT_5_5_5_1;if(e===dT)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===hT)return r.UNSIGNED_INT_10F_11F_11F_REV;if(e===ya)return r.BYTE;if(e===ba)return r.SHORT;if(e===Ps)return r.UNSIGNED_SHORT;if(e===Ut)return r.INT;if(e===mt)return r.UNSIGNED_INT;if(e===dn)return r.FLOAT;if(e===$t)return r.HALF_FLOAT;if(e===n2)return r.ALPHA;if(e===cm)return r.RGB;if(e===Dn)return r.RGBA;if(e===ei)return r.DEPTH_COMPONENT;if(e===Jr)return r.DEPTH_STENCIL;if(e===lm)return r.RED;if(e===um)return r.RED_INTEGER;if(e===Kr)return r.RG;if(e===dm)return r.RG_INTEGER;if(e===hm)return r.RGBA_INTEGER;if(e===ml||e===gl||e===xl||e===yl)if(o===be)if(s=i.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===ml)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===gl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===xl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===yl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=i.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===ml)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===gl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===xl)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===yl)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===h0||e===f0||e===p0||e===m0)if(s=i.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===h0)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===f0)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===p0)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===m0)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===rf||e===sf||e===of)if(s=i.get("WEBGL_compressed_texture_etc"),s!==null){if(e===rf||e===sf)return o===be?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===of)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===af||e===cf||e===lf||e===uf||e===df||e===hf||e===ff||e===pf||e===mf||e===gf||e===xf||e===yf||e===bf||e===vf)if(s=i.get("WEBGL_compressed_texture_astc"),s!==null){if(e===af)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===cf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===lf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===uf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===df)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===hf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===ff)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===pf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===mf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===gf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===xf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===yf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===bf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===vf)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===_f)if(s=i.get("EXT_texture_compression_bptc"),s!==null){if(e===_f)return o===be?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Tf||e===wf||e===Sf||e===Nf)if(s=i.get("EXT_texture_compression_rgtc"),s!==null){if(e===Tf)return s.COMPRESSED_RED_RGTC1_EXT;if(e===wf)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Sf)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Nf)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Zr?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,i)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),i();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),r()}s()})}}let Mb=!1,Zc,Sh,Pb;class d6{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,Mb===!1&&(this._init(),Mb=!0)}_init(){const e=this.gl;Zc={[Bu]:e.REPEAT,[Fa]:e.CLAMP_TO_EDGE,[Du]:e.MIRRORED_REPEAT},Sh={[Rn]:e.NEAREST,[I_]:e.NEAREST_MIPMAP_NEAREST,[ka]:e.NEAREST_MIPMAP_LINEAR,[Ln]:e.LINEAR,[nf]:e.LINEAR_MIPMAP_NEAREST,[Hi]:e.LINEAR_MIPMAP_LINEAR},Pb={[z_]:e.NEVER,[j_]:e.ALWAYS,[am]:e.LESS,[$_]:e.LEQUAL,[G_]:e.EQUAL,[V_]:e.GEQUAL,[U_]:e.GREATER,[O_]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return e.isCubeTexture===!0?r=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?r=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=t.TEXTURE_3D:r=t.TEXTURE_2D,r}getInternalFormat(e,t,r,i,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];se("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(r===o.FLOAT&&(c=o.R32F),r===o.HALF_FLOAT&&(c=o.R16F),r===o.UNSIGNED_BYTE&&(c=o.R8),r===o.UNSIGNED_SHORT&&(c=o.R16),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.R8UI),r===o.UNSIGNED_SHORT&&(c=o.R16UI),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RG&&(r===o.FLOAT&&(c=o.RG32F),r===o.HALF_FLOAT&&(c=o.RG16F),r===o.UNSIGNED_BYTE&&(c=o.RG8),r===o.UNSIGNED_SHORT&&(c=o.RG16),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RG8UI),r===o.UNSIGNED_SHORT&&(c=o.RG16UI),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RGB){const l=s?d0:pt.getTransfer(i);r===o.FLOAT&&(c=o.RGB32F),r===o.HALF_FLOAT&&(c=o.RGB16F),r===o.UNSIGNED_BYTE&&(c=o.RGB8),r===o.UNSIGNED_SHORT&&(c=o.RGB16),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I),r===o.UNSIGNED_BYTE&&(c=l===be?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),r===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGB8UI),r===o.UNSIGNED_SHORT&&(c=o.RGB16UI),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I)),t===o.RGBA){const l=s?d0:pt.getTransfer(i);r===o.FLOAT&&(c=o.RGBA32F),r===o.HALF_FLOAT&&(c=o.RGBA16F),r===o.UNSIGNED_BYTE&&(c=o.RGBA8),r===o.UNSIGNED_SHORT&&(c=o.RGBA16),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I),r===o.UNSIGNED_BYTE&&(c=l===be?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),r===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),r===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),r===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:r,extensions:i,backend:s}=this,o=pt.getPrimaries(pt.workingColorSpace),a=t.colorSpace===Js?null:pt.getPrimaries(t.colorSpace),c=t.colorSpace===Js||o===a?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),r.texParameteri(e,r.TEXTURE_WRAP_S,Zc[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,Zc[t.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,Zc[t.wrapR])),r.texParameteri(e,r.TEXTURE_MAG_FILTER,Sh[t.magFilter]);const l=t.mipmaps!==void 0&&t.mipmaps.length>0,u=t.minFilter===Ln&&l?Hi:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,Sh[u]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,Pb[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Rn||t.minFilter!==ka&&t.minFilter!==Hi||t.type===dn&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const d=i.get("EXT_texture_filter_anisotropic");r.texParameterf(e,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:i}=this,s=this.getGLTextureType(e);let o=i[s];o===void 0&&(o=t.createTexture(),r.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),i[s]=o),r.set(e,{textureGPU:o,glTextureType:s})}createTexture(e,t){const{gl:r,backend:i}=this,{levels:s,width:o,height:a,depth:c}=t,l=i.utils.convert(e.format,e.colorSpace),u=i.utils.convert(e.type),d=this.getInternalFormat(e.internalFormat,l,u,e.colorSpace,e.isVideoTexture),h=r.createTexture(),f=this.getGLTextureType(e);i.state.bindTexture(f,h),this.setTextureParameters(f,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,s,d,o,a,c):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,s,d,o,a,c):e.isVideoTexture||r.texStorage2D(f,s,d,o,a),i.set(e,{textureGPU:h,glTextureType:f,glFormat:l,glType:u,glInternalFormat:d})}copyBufferToTexture(e,t){const{gl:r,backend:i}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:c}=i.get(t),{width:l,height:u}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(o,s),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,l,u,a,c,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:i,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:c,glType:l,glInternalFormat:u}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const d=e.mipmaps,h=t.image;for(let f=0;f<d.length;f++){const p=d[f];e.isCompressedArrayTexture?e.format!==r.RGBA?c!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,f,0,0,0,p.width,p.height,h.depth,c,p.data):se("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,f,0,0,0,p.width,p.height,h.depth,c,l,p.data):c!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,f,0,0,p.width,p.height,c,p.data):se("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images,h=e.mipmaps;for(let f=0;f<6;f++){const p=Jc(d[f]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,i,s,c,l,p);for(let m=0;m<h.length;m++){const x=h[m],g=Jc(x.images[f]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+f,m+1,0,0,g.width,g.height,c,l,g)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const d=t.image;if(e.layerUpdates.size>0){const h=YC(d.width,d.height,e.format,e.type);for(const f of e.layerUpdates){const p=d.data.subarray(f*h/d.data.BYTES_PER_ELEMENT,(f+1)*h/d.data.BYTES_PER_ELEMENT);r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,f,d.width,d.height,1,c,l,p)}e.clearLayerUpdates()}else r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,c,l,d.data)}else if(e.isData3DTexture){const d=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,c,l,d.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(a,0,u,c,l,t.image);else{const d=e.mipmaps;if(d.length>0)for(let h=0,f=d.length;h<f;h++){const p=d[h],m=Jc(p);r.texSubImage2D(a,h,0,0,p.width,p.height,c,l,m)}else{const h=Jc(t.image);r.texSubImage2D(a,0,0,0,i,s,c,l,h)}}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:i,glTextureType:s}=r.get(e);r.state.bindTexture(s,i),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const i=r.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const s in i.framebuffers)t.deleteFramebuffer(i.framebuffers[s]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let s=0;s<i.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(i.msaaRenderbuffers[s]);delete i.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:r,backend:i}=this,{textureGPU:s,renderTarget:o}=i.get(e);this.deallocateRenderBuffers(o),t===!1&&r.deleteTexture(s),i.delete(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){const{gl:a,backend:c}=this,{state:l}=this.backend,{textureGPU:u,glTextureType:d,glType:h,glFormat:f}=c.get(t);l.bindTexture(d,u);let p,m,x,g,y,v,_,T,w;const N=e.isCompressedTexture?e.mipmaps[o]:e.image;if(r!==null)p=r.max.x-r.min.x,m=r.max.y-r.min.y,x=r.isBox3?r.max.z-r.min.z:1,g=r.min.x,y=r.min.y,v=r.isBox3?r.min.z:0;else{const O=Math.pow(2,-s);p=Math.floor(N.width*O),m=Math.floor(N.height*O),e.isDataArrayTexture||e.isArrayTexture?x=N.depth:e.isData3DTexture?x=Math.floor(N.depth*O):x=1,g=0,y=0,v=0}i!==null?(_=i.x,T=i.y,w=i.z):(_=0,T=0,w=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const S=a.getParameter(a.UNPACK_ROW_LENGTH),C=a.getParameter(a.UNPACK_IMAGE_HEIGHT),B=a.getParameter(a.UNPACK_SKIP_PIXELS),D=a.getParameter(a.UNPACK_SKIP_ROWS),U=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,N.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,N.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,g),a.pixelStorei(a.UNPACK_SKIP_ROWS,y),a.pixelStorei(a.UNPACK_SKIP_IMAGES,v);const $=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,A=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const O=c.get(e),k=c.get(t),R=c.get(O.renderTarget),L=c.get(k.renderTarget),M=R.framebuffers[O.cacheKey],W=L.framebuffers[k.cacheKey];l.bindFramebuffer(a.READ_FRAMEBUFFER,M),l.bindFramebuffer(a.DRAW_FRAMEBUFFER,W);for(let I=0;I<x;I++)$&&(a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,O.textureGPU,s,v+I),a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,o,w+I)),a.blitFramebuffer(g,y,p,m,_,T,p,m,a.DEPTH_BUFFER_BIT,a.NEAREST);l.bindFramebuffer(a.READ_FRAMEBUFFER,null),l.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else if(s!==0||e.isRenderTargetTexture||c.has(e)){const O=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=a.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=a.createFramebuffer()),l.bindFramebuffer(a.READ_FRAMEBUFFER,this._srcFramebuffer),l.bindFramebuffer(a.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let k=0;k<x;k++)$?a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,O.textureGPU,s,v+k):a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,O.textureGPU,s),A?a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,o,w+k):a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,u,o),s!==0?a.blitFramebuffer(g,y,p,m,_,T,p,m,a.COLOR_BUFFER_BIT,a.NEAREST):A?a.copyTexSubImage3D(d,o,_,T,w+k,g,y,p,m):a.copyTexSubImage2D(d,o,_,T,g,y,p,m);l.bindFramebuffer(a.READ_FRAMEBUFFER,null),l.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else A?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(d,o,_,T,w,p,m,x,f,h,N.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(d,o,_,T,w,p,m,x,f,N.data):a.texSubImage3D(d,o,_,T,w,p,m,x,f,h,N):e.isDataTexture?a.texSubImage2D(a.TEXTURE_2D,o,_,T,p,m,f,h,N.data):e.isCompressedTexture?a.compressedTexSubImage2D(a.TEXTURE_2D,o,_,T,N.width,N.height,f,N.data):a.texSubImage2D(a.TEXTURE_2D,o,_,T,p,m,f,h,N);a.pixelStorei(a.UNPACK_ROW_LENGTH,S),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,C),a.pixelStorei(a.UNPACK_SKIP_PIXELS,B),a.pixelStorei(a.UNPACK_SKIP_ROWS,D),a.pixelStorei(a.UNPACK_SKIP_IMAGES,U),o===0&&t.generateMipmaps&&a.generateMipmap(d),l.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:i}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:c,z:l,w:u}=r,d=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,h=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(d){const f=a!==0||c!==0;let p,m;if(e.isDepthTexture===!0?(p=i.DEPTH_BUFFER_BIT,m=i.DEPTH_ATTACHMENT,t.stencil&&(p|=i.STENCIL_BUFFER_BIT)):(p=i.COLOR_BUFFER_BIT,m=i.COLOR_ATTACHMENT0),f){const x=this.backend.get(t.renderTarget),g=x.framebuffers[t.getCacheKey()],y=x.msaaFrameBuffer;s.bindFramebuffer(i.DRAW_FRAMEBUFFER,g),s.bindFramebuffer(i.READ_FRAMEBUFFER,y);const v=h-c-u;i.blitFramebuffer(a,v,a+l,v+u,a,v,a+l,v+u,p,i.NEAREST),s.bindFramebuffer(i.READ_FRAMEBUFFER,g),s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,v,l,u),s.unbindTexture()}else{const x=i.createFramebuffer();s.bindFramebuffer(i.DRAW_FRAMEBUFFER,x),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,m,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,l,u,0,0,l,u,p,i.NEAREST),i.deleteFramebuffer(x)}}else s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,h-u-c,l,u),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,i=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:c,stencilBuffer:l,width:u,height:d}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!l){let h=s.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,h,u,d):r>0?(a&&a.isDepthTexture&&a.type===s.FLOAT&&(h=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,r,h,u,d)):s.renderbufferStorage(s.RENDERBUFFER,h,u,d),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&l&&(r>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,r,s.DEPTH24_STENCIL8,u,d):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,u,d),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,r,i,s,o){const{backend:a,gl:c}=this,{textureGPU:l,glFormat:u,glType:d}=this.backend.get(e),h=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,h);const f=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,f,l,0);const p=this._getTypedArrayType(d),m=this._getBytesPerTexel(d,u),g=i*s*m,y=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,y),c.bufferData(c.PIXEL_PACK_BUFFER,g,c.STREAM_READ),c.readPixels(t,r,i,s,u,d,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const v=new p(g/p.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,y),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,v),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(h),v}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let i=0;if(e===r.UNSIGNED_BYTE&&(i=1),(e===r.UNSIGNED_SHORT_4_4_4_4||e===r.UNSIGNED_SHORT_5_5_5_1||e===r.UNSIGNED_SHORT_5_6_5||e===r.UNSIGNED_SHORT||e===r.HALF_FLOAT)&&(i=2),(e===r.UNSIGNED_INT||e===r.FLOAT)&&(i=4),t===r.RGBA)return i*4;if(t===r.RGB)return i*3;if(t===r.ALPHA)return i}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function Jc(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class h6{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class f6{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const Db={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class p6{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:i,object:s,type:o,info:a,index:c}=this;c!==0?r.drawElements(i,t,o,e):r.drawArrays(i,e,t),a.update(s,t,1)}renderInstances(e,t,r){const{gl:i,mode:s,type:o,index:a,object:c,info:l}=this;r!==0&&(a!==0?i.drawElementsInstanced(s,t,o,e,r):i.drawArraysInstanced(s,e,t,r),l.update(c,t,r))}renderMultiDraw(e,t,r){const{extensions:i,mode:s,object:o,info:a}=this;if(r===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let l=0;l<r;l++)this.render(e[l],t[l]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,r):c.multiDrawArraysWEBGL(s,e,0,t,0,r);let l=0;for(let u=0;u<r;u++)l+=t[u];a.update(o,l,1)}}renderMultiDrawInstances(e,t,r,i){const{extensions:s,mode:o,object:a,info:c}=this;if(r===0)return;const l=s.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<r;u++)this.renderInstances(e[u],t[u],i[u]);else{this.index!==0?l.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,i,0,r):l.multiDrawArraysInstancedWEBGL(o,e,0,t,0,i,0,r);let u=0;for(let d=0;d<r;d++)u+=t[d]*i[d];c.update(a,u,1)}}}class FN{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(se(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class m6 extends FN{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){se("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const r=this.queries[t];if(r)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){i("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){r("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[s,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(s,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},r=[];for(const[s,o]of e){const a=s.match(/^(.*):f(\d+)$/),c=parseInt(a[2]);r.includes(c)===!1&&r.push(c),t[c]===void 0&&(t[c]=0);const l=await o;this.timestamps.set(s,l),t[c]+=l}const i=t[r[r.length-1]];return this.lastValue=i,this.frames=r,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,i}catch(e){return e("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let r,i=!1;const s=()=>{r&&(clearTimeout(r),r=null)},o=c=>{i||(i=!0,s(),t(c))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){r=setTimeout(a,1);return}const u=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(u)/1e6)}catch(c){c("Error checking query:",c),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class Bb extends BN{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",r);function s(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=i,this.extensions=new h6(this),this.capabilities=new f6(this),this.attributeUtils=new c6(this),this.textureUtils=new d6(this),this.bufferRenderer=new p6(this),this.state=new l6(this),this.utils=new u6(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return Il}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),r!==null){const s=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&se("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new m6(this.gl,e,2048));const r=this.timestampQueryPool[e];r.allocateQueriesForContext(t)!==null&&r.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize();t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:a,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,a,c)}this.initTimestampQuery(Xn.RENDER,this.getTimestampUID(e)),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,i=this.get(e),s=i.previousContext;r.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let c=0;c<a.length;c++){const l=a[c];l.generateMipmaps&&this.generateMipmaps(l)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:l}=this.getDrawingBufferSize();r.viewport(0,0,c,l)}this.prepareTimestampBuffer(Xn.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let c=0;for(let l=0;l<r.length;l++){const u=r[l];u!==null&&o.getQueryParameter(u,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(u,o.QUERY_RESULT)===0&&s.add(i[l]),r[l]=null,o.deleteQuery(u),c++)}c<r.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:i,width:s,height:o}=e.viewportValue;t.viewport(r,e.height-o-i,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,i=null,s=!0,o=!0){const{gl:a,renderer:c}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let l=0;if(e&&(l|=a.COLOR_BUFFER_BIT),t&&(l|=a.DEPTH_BUFFER_BIT),r&&(l|=a.STENCIL_BUFFER_BIT),l!==0){let u;i.clearColorValue?u=i.clearColorValue:u=this.getClearColor();const d=c.getClearDepth(),h=c.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)a.clearColor(u.r,u.g,u.b,u.a),a.clear(l);else{if(s&&this._setFramebuffer(i),e)for(let f=0;f<i.textures.length;f++)f===0?a.clearBufferfv(a.COLOR,f,[u.r,u.g,u.b,u.a]):a.clearBufferfv(a.COLOR,f,[0,0,0,1]);t&&r?a.clearBufferfi(a.DEPTH_STENCIL,0,d,h):t?a.clearBufferfv(a.DEPTH,0,[d]):r&&a.clearBufferiv(a.STENCIL,0,[h]),s&&o&&this._resolveRenderTarget(i)}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(Xn.COMPUTE,this.getTimestampUID(e))}compute(e,t,r,i,s=null){const{state:o,gl:a}=this;this.discard===!1&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:l,attributes:u}=this.get(i),d=this._getVaoKey(u),h=this.vaoCache[d];h===void 0?this.vaoCache[d]=this._createVao(u):o.setVertexState(h),o.useProgram(c),this._bindUniforms(r);const f=this._getTransformFeedback(l);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,f),a.beginTransformFeedback(a.POINTS),s=s!==null?s:t.count,Array.isArray(s)?(ft("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]):s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute&&(ft("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),s=t.count),u[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,s):a.drawArrays(a.POINTS,0,s),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let p=0;p<l.length;p++){const m=l[p];m.pbo&&this.has(m.pbo)&&this.textureUtils.copyBufferToTexture(m.transformBuffer,m.pbo),m.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Xn.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:i,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(r),{gl:c,state:l}=this,u=this.get(s),d=e.getDrawParameters();if(d===null)return;this._bindUniforms(e.getBindings());const h=t.isMesh&&t.matrixWorld.determinant()<0;l.setMaterial(i,h,o),l.useProgram(a);const f=e.getAttributes(),p=this.get(f);let m=p.vaoGPU;if(m===void 0){const S=this._getVaoKey(f);m=this.vaoCache[S],m===void 0&&(m=this._createVao(f),this.vaoCache[S]=m,p.vaoGPU=m)}const x=e.getIndex(),g=x!==null?this.get(x).bufferGPU:null;l.setVertexState(m,g);const y=u.lastOcclusionObject;if(y!==t&&y!==void 0){if(y!==null&&y.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),t.occlusionTest===!0){const S=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,S),u.occlusionQueries[u.occlusionQueryIndex]=S,u.occlusionQueryObjects[u.occlusionQueryIndex]=t}u.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=c.POINTS:t.isLineSegments?v.mode=c.LINES:t.isLine?v.mode=c.LINE_STRIP:t.isLineLoop?v.mode=c.LINE_LOOP:i.wireframe===!0?(l.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=c.LINES):v.mode=c.TRIANGLES;const{vertexCount:_,instanceCount:T}=d;let{firstVertex:w}=d;if(v.object=t,x!==null){w*=x.array.BYTES_PER_ELEMENT;const S=this.get(x);v.index=x.count,v.type=S.type}else v.index=0;const N=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(ft("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):ft("WebGLBackend: WEBGL_multi_draw not supported."):T>1?v.renderInstances(w,_,T):v.render(w,_)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const S=this.get(e.camera),C=e.camera.cameras,B=e.getBindingGroup("cameraIndex").bindings[0];if(S.indexesGPU===void 0||S.indexesGPU.length!==C.length){const k=new Uint32Array([0,0,0,0]),R=[];for(let L=0,M=C.length;L<M;L++){const W=c.createBuffer();k[0]=L,c.bindBuffer(c.UNIFORM_BUFFER,W),c.bufferData(c.UNIFORM_BUFFER,k,c.STATIC_DRAW),R.push(W)}S.indexesGPU=R}const D=this.get(B),U=this.renderer.getPixelRatio(),$=this._currentContext.renderTarget,A=this._isRenderCameraDepthArray(this._currentContext),O=this._currentContext.activeCubeFace;if(A){const k=this.get($.depthTexture);if(k.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){k.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:R}=$;for(let L=0,M=C.length;L<M;L++)this.renderer._activeCubeFace=L,this._currentContext.activeCubeFace=L,this._setFramebuffer(this._currentContext),this.clear(!1,!0,R,this._currentContext,!1,!1);this.renderer._activeCubeFace=O,this._currentContext.activeCubeFace=O}}for(let k=0,R=C.length;k<R;k++){const L=C[k];if(t.layers.test(L.layers)){A&&(this.renderer._activeCubeFace=k,this._currentContext.activeCubeFace=k,this._setFramebuffer(this._currentContext));const M=L.viewport;if(M!==void 0){const W=M.x*U,I=M.y*U,j=M.width*U,Z=M.height*U;l.viewport(Math.floor(W),Math.floor(e.context.height-Z-I),Math.floor(j),Math.floor(Z))}l.bindBufferBase(c.UNIFORM_BUFFER,D.index,S.indexesGPU[k]),N()}this._currentContext.activeCubeFace=O,this.renderer._activeCubeFace=O}}else N()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}updateSampler(){return""}createNodeBuilder(e,t){return new s6(e,t)}createProgram(e){const t=this.gl,{stage:r,code:i}=e,s=r==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,i=e.pipeline,{fragmentProgram:s,vertexProgram:o}=i,a=r.createProgram(),c=this.get(s).shaderGPU,l=this.get(o).shaderGPU;if(r.attachShader(a,c),r.attachShader(a,l),r.linkProgram(a),this.set(i,{programGPU:a,fragmentShader:c,vertexShader:l}),t!==null&&this.parallel){const u=new Promise(d=>{const h=this.parallel,f=()=>{r.getProgramParameter(a,h.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),d()):requestAnimationFrame(f)};f()});t.push(u);return}this._completeCompile(e,i)}_handleSource(e,t){const r=e.split(`
`),i=[],s=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let a=s;a<o;a++){const c=a+1;i.push(`${c===t?">":" "} ${c}: ${r[a]}`)}return i.join(`
`)}_getShaderErrors(e,t,r){const i=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(i&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const c=parseInt(a[1]);return r.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const i=this.gl,o=(i.getProgramInfoLog(e)||"").trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,r,t);else{const a=this._getShaderErrors(i,r,"vertex"),c=this._getShaderErrors(i,t,"fragment");ie("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+a+`
`+c)}else o!==""&&se("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:r,gl:i}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:c}=s;i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,a,c),r.useProgram(o);const l=e.getBindings();this._setupBindings(l,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:r,gl:i}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=i.createProgram(),c=this.get(s).shaderGPU,l=this.get(o).shaderGPU,u=o.transforms,d=[],h=[];for(let x=0;x<u.length;x++){const g=u[x];d.push(g.varyingName),h.push(g.attributeNode)}i.attachShader(a,c),i.attachShader(a,l),i.transformFeedbackVaryings(a,d,i.SEPARATE_ATTRIBS),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,c,l),r.useProgram(a),this._setupBindings(t,a);const f=o.attributes,p=[],m=[];for(let x=0;x<f.length;x++){const g=f[x].node.attribute;p.push(g),this.has(g)||this.attributeUtils.createAttribute(g,i.ARRAY_BUFFER)}for(let x=0;x<h.length;x++){const g=h[x].attribute;this.has(g)||this.attributeUtils.createAttribute(g,i.ARRAY_BUFFER);const y=this.get(g);m.push(y)}this.set(e,{programGPU:a,transformBuffers:m,attributes:p})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let r=0,i=0;for(const s of t){this.set(s,{textures:i,uniformBuffers:r});for(const o of s.bindings)o.isUniformBuffer&&r++,o.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let i=r.uniformBuffers,s=r.textures;for(const o of e.bindings){const a=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:l}=this.get(c);l===void 0?(l=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,l),t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:l})):(t.bindBuffer(t.UNIFORM_BUFFER,l),t.bufferSubData(t.UNIFORM_BUFFER,0,c)),a.index=i++,a.bufferGPU=l,this.set(o,a)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:l}=this.get(o.texture);a.index=s++,a.textureGPU=c,a.glTextureType=l,this.set(o,a)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(Db).filter(i=>Db[i]===e),r=this.extensions;for(let i=0;i<t.length;i++)if(r.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,r,i,s,o)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let i=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:c,stencilBuffer:l}=s,u=s.isWebGLCubeRenderTarget===!0,d=s.isRenderTarget3D===!0,h=s.depth>1,f=s.isXRRenderTarget===!0,p=f===!0&&s._hasExternalTextures===!0;let m=o.msaaFrameBuffer,x=o.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),y=this.extensions.get("OVR_multiview2"),v=this._useMultisampledExtension(s),_=fN(e);let T;if(u?(o.cubeFramebuffers||(o.cubeFramebuffers={}),T=o.cubeFramebuffers[_]):f&&p===!1?T=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),T=o.framebuffers[_]),T===void 0){T=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,T);const w=e.textures,N=[];if(u){o.cubeFramebuffers[_]=T;const{textureGPU:C}=this.get(w[0]),B=this.renderer._activeCubeFace,D=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+B,C,D)}else{o.framebuffers[_]=T;for(let C=0;C<w.length;C++){const B=w[C],D=this.get(B);D.renderTarget=e.renderTarget,D.cacheKey=_;const U=t.COLOR_ATTACHMENT0+C;if(s.multiview)y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,D.textureGPU,0,a,0,2);else if(d||h){const $=this.renderer._activeCubeFace,A=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,U,D.textureGPU,A,$)}else if(v)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,D.textureGPU,0,a);else{const $=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,D.textureGPU,$)}}}const S=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const C=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(C,e,0,v),o.xrDepthRenderbuffer=C,N.push(l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,C),t.framebufferRenderbuffer(t.FRAMEBUFFER,S,t.RENDERBUFFER,C)}else if(e.depthTexture!==null){N.push(l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const C=this.get(e.depthTexture);if(C.renderTarget=e.renderTarget,C.cacheKey=_,s.multiview)y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,S,C.textureGPU,0,a,0,2);else if(p&&v)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const B=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,S,C.textureGPU,0,B)}else t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0)}o.depthInvalidationArray=N}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,T);const N=this.renderer._activeCubeFace,S=this.get(e.depthTexture),C=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,C,S.textureGPU,0,N)}if((f||v||s.multiview)&&s._isOpaqueFramebuffer!==!0){r.bindFramebuffer(t.FRAMEBUFFER,T);const N=this.get(e.textures[0]);s.multiview?y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,N.textureGPU,0,a,0,2):v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,N.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,N.textureGPU,0);const S=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const C=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,C),t.framebufferRenderbuffer(t.FRAMEBUFFER,S,t.RENDERBUFFER,C)}else{const C=this.get(e.depthTexture);s.multiview?y.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,S,C.textureGPU,0,a,0,2):v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0)}}}if(a>0&&v===!1&&!s.multiview){if(m===void 0){const w=[];m=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,m);const N=[],S=e.textures;for(let C=0;C<S.length;C++){N[C]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,N[C]),w.push(t.COLOR_ATTACHMENT0+C);const B=e.textures[C],D=this.get(B);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,D.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+C,t.RENDERBUFFER,N[C])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=m,o.msaaRenderbuffers=N,c&&x===void 0){x=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(x,e,a),o.depthRenderbuffer=x;const C=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;w.push(C)}o.invalidationArray=w}i=o.msaaFrameBuffer}else i=T;r.drawBuffers(e,T)}r.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){const i=this.get(e[r]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();t.bindVertexArray(r);for(let i=0;i<e.length;i++){const s=e[i],o=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(i);let a,c;s.isInterleavedBufferAttribute===!0?(a=s.data.stride*o.bytesPerElement,c=s.offset*o.bytesPerElement):(a=0,c=0),o.isInteger?t.vertexAttribIPointer(i,s.itemSize,o.type,a,c):t.vertexAttribPointer(i,s.itemSize,o.type,s.normalized,a,c),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(i,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(i,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),r}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let r=this.transformFeedbackCache[t];if(r!==void 0)return r;const{gl:i}=this;r=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r);for(let s=0;s<e.length;s++){const o=e[s];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const i of e)for(const s of i.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=r.getUniformBlockIndex(t,s.name);r.uniformBlockBinding(t,c,a)}else if(s.isSampledTexture){const c=r.getUniformLocation(t,s.name);r.uniform1i(c,a)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const i of e)for(const s of i.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&r.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_resolveRenderTarget(e){const{gl:t,state:r}=this,i=e.renderTarget;if(e.textures!==null&&i){const s=this.get(i);if(i.samples>0&&this._useMultisampledExtension(i)===!1){const o=s.framebuffers[e.getCacheKey()];let a=t.COLOR_BUFFER_BIT;i.resolveDepthBuffer&&(i.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT));const c=s.msaaFrameBuffer,l=s.msaaRenderbuffers,u=e.textures,d=u.length>1;if(r.bindFramebuffer(t.READ_FRAMEBUFFER,c),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),d)for(let h=0;h<u.length;h++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.TEXTURE_2D,null,0);for(let h=0;h<u.length;h++){if(d){const{textureGPU:f}=this.get(u[h]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,l[h]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0)}if(e.scissor){const{x:f,y:p,width:m,height:x}=e.scissorValue,g=e.height-x-p;t.blitFramebuffer(f,g,f+m,g+x,f,g,f+m,g+x,a,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST)}if(d)for(let h=0;h<u.length;h++){const{textureGPU:f}=this.get(u[h]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.RENDERBUFFER,l[h]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.TEXTURE_2D,f,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(i.resolveDepthBuffer===!1&&s.framebuffers){const o=s.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const ks={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Nt={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Ot={Store:"store"},Be={Load:"load",Clear:"clear"},Fb={CCW:"ccw",CW:"cw"},kb={None:"none",Back:"back"},po={Uint16:"uint16",Uint32:"uint32"},P={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},Nh={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Li={Linear:"linear",Nearest:"nearest"},Ne={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Si={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},Lb={None:0,All:15},Vr={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},Ah={Storage:"storage",ReadOnlyStorage:"read-only-storage"},Eh={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},Ib={NonFiltering:"non-filtering",Comparison:"comparison"},Ni={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},Ob={TwoD:"2d",ThreeD:"3d"},ht={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},g6={All:"all"},el={Vertex:"vertex",Instance:"instance"},gp={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},Ub={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class x6 extends PN{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class y6 extends EN{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let b6=0;class v6 extends y6{constructor(e,t){super("StorageBuffer_"+b6++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Kn.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class _6 extends di{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Li.Linear}),this.flipYSampler=e.createSampler({minFilter:Li.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:ks.TriangleStrip,stripIndexFormat:po.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:ks.TriangleStrip,stripIndexFormat:po.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const i=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),l=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:r}),d=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),f=(p,m,x)=>{const g=p.getBindGroupLayout(0),y=this.device.createBindGroup({layout:g,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:m}]}),v=h.beginRenderPass({colorAttachments:[{view:x,loadOp:Be.Clear,storeOp:Ot.Store,clearValue:[0,0,0,0]}]});v.setPipeline(p),v.setBindGroup(0,y),v.draw(4,1,0,0),v.end()};f(a,u,d),f(c,d,u),this.device.queue.submit([h.finish()]),l.destroy()}generateMipmaps(e,t,r=0,i=null){const s=this.get(e);s.layers===void 0&&(s.layers=[]);const o=s.layers[r]||this._mipmapCreateBundles(e,t,r),a=i||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,o),i===null&&this.device.queue.submit([a.finish()]),s.layers[r]=o}_mipmapCreateBundles(e,t,r){const i=this.getTransferPipeline(t.format),s=i.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:r});const a=[];for(let c=1;c<t.mipLevelCount;c++){const l=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),u=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:r}),d={colorAttachments:[{view:u,loadOp:Be.Clear,storeOp:Ot.Store,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[t.format]});h.setPipeline(i),h.setBindGroup(0,l),h.draw(4,1,0,0),a.push({renderBundles:[h.finish()],passDescriptor:d}),o=u}return a}_mipmapRunBundles(e,t){const r=t.length;for(let i=0;i<r;i++){const s=t[i],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const T6={[z_]:"never",[am]:"less",[G_]:"equal",[$_]:"less-equal",[U_]:"greater",[V_]:"greater-equal",[j_]:"always",[O_]:"not-equal"},w6=[0,1,3,2,4,5];class S6{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,r=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let i=this._samplerCache.get(r);if(i===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Li.Linear&&o.minFilter===Li.Linear&&o.mipmapFilter===Li.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=T6[e.compareFunction]),i={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(r,i)}const s=t.get(e);if(s.sampler!==i.sampler){if(s.sampler!==void 0){const o=this._samplerCache.get(s.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(s.samplerKey)}s.samplerKey=r,s.sampler=i.sampler,i.usedTimes++}return r}createDefaultTexture(e){let t;const r=xp(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,i=r.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){i.texture=e.sourceTexture,i.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(e),u=e.internalFormat||t.format||xp(e,r.device);i.format=u;const{samples:d,primarySamples:h,isMSAA:f}=r.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(p|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&u!==P.RGB9E5UFloat&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const m={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:h,dimension:l,format:u,usage:p};if(u===void 0){se("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(m.textureBindingViewDimension=ht.Cube),i.texture=r.device.createTexture(m),f){const x=Object.assign({},m);x.label=x.label+"-msaa",x.sampleCount=d,x.mipLevelCount=1,i.msaaTexture=r.device.createTexture(x)}i.initialized=!0,i.textureDescriptorGPU=m}destroyTexture(e,t=!1){const r=this.backend,i=r.get(e);i.texture!==void 0&&t===!1&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),r.delete(e)}generateMipmaps(e,t=null){const r=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,i,t);else{const i=e.image.depth||1;for(let s=0;s<i;s++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,s,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:r,height:i}=e.getDrawingBufferSize(),s=e.renderer.currentSamples,o=t.colorTexture,a=e.get(o);if(o.width===r&&o.height===i&&o.samples===s)return a.texture;let c=a.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:r,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=r,o.source.height=i,o.samples=s,a.texture=c,c}getDepthBuffer(e=!0,t=!1){const r=this.backend,i=r.renderer.getCanvasTarget(),{width:s,height:o}=r.getDrawingBufferSize(),a=r.renderer.currentSamples,c=i.depthTexture;if(c.width===s&&c.height===o&&c.samples===a&&c.depth===e&&c.stencil===t)return r.get(c).texture;const l=r.get(c).texture;let u,d;if(t?(u=Jr,d=Zr):e&&(u=ei,d=mt),l!==void 0){if(c.image.width===s&&c.image.height===o&&c.format===u&&c.type===d&&c.samples===a)return l;this.destroyTexture(c)}return c.name="depthBuffer",c.format=u,c.type=d,c.image.width=s,c.image.height=o,c.samples=a,this.createTexture(c,{width:s,height:o}),r.get(c).texture}updateTexture(e,t){const r=this.backend.get(e),i=e.mipmaps,{textureDescriptorGPU:s}=r;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyBufferToTexture(c,r.texture,s,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,r.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,r.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,r.texture,s);else if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyImageToTexture(c,r.texture,s,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,r.texture,s,0,e.flipY,e.premultiplyAlpha);r.version=e.version}}async copyTextureToBuffer(e,t,r,i,s,o){const a=this.backend.device,c=this.backend.get(e),l=c.texture,u=c.textureDescriptorGPU.format,d=this._getBytesPerTexel(u);let h=i*d;h=Math.ceil(h/256)*256;const f=a.createBuffer({size:(s-1)*h+i*d,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=a.createCommandEncoder();p.copyTextureToBuffer({texture:l,origin:{x:t,y:r,z:o}},{buffer:f,bytesPerRow:h},{width:i,height:s});const m=this._getTypedArrayType(u);a.queue.submit([p.finish()]),await f.mapAsync(GPUMapMode.READ);const x=f.getMappedRange();return new m(x)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new om;r.minFilter=Rn,r.magFilter=Rn,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new sm;r.minFilter=Rn,r.magFilter=Rn,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,r){const i=e.images,s=e.mipmaps;for(let o=0;o<6;o++){const a=i[o],c=e.flipY===!0?w6[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,r,c,e.flipY):this._copyImageToTexture(a,t,r,c,e.flipY,e.premultiplyAlpha);for(let l=0;l<s.length;l++){const d=s[l].images[o];d.isDataTexture?this._copyBufferToTexture(d.image,t,r,c,e.flipY,0,l+1):this._copyImageToTexture(d,t,r,c,e.flipY,e.premultiplyAlpha,l+1)}}}_copyImageToTexture(e,t,r,i,s,o,a=0){const c=this.backend.device,l=a>0?e.width:r.size.width,u=a>0?e.height:r.size.height;c.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:a,origin:{x:0,y:0,z:i},premultipliedAlpha:o},{width:l,height:u,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new _6(this.backend.device)),e}_generateMipmaps(e,t,r=0,i=null){this._getPassUtils().generateMipmaps(e,t,r,i)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,i,s,o=0,a=0){const c=this.backend.device,l=e.data,u=this._getBytesPerTexel(r.format),d=e.width*u;c.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:i}},l,{offset:e.width*e.height*u*o,bytesPerRow:d},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,r,i)}_copyCompressedBufferToTexture(e,t,r){const i=this.backend.device,s=this._getBlockData(r.format),o=r.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const c=e[a],l=c.width,u=c.height,d=o?r.size.depthOrArrayLayers:1,h=Math.ceil(l/s.width)*s.byteLength,f=h*Math.ceil(u/s.height);for(let p=0;p<d;p++)i.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:p}},c.data,{offset:p*f,bytesPerRow:h,rowsPerImage:Math.ceil(u/s.height)},{width:Math.ceil(l/s.width)*s.width,height:Math.ceil(u/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===P.BC1RGBAUnorm||e===P.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===P.BC2RGBAUnorm||e===P.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===P.BC3RGBAUnorm||e===P.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===P.BC4RUnorm||e===P.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===P.BC5RGUnorm||e===P.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===P.BC6HRGBUFloat||e===P.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===P.BC7RGBAUnorm||e===P.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===P.ETC2RGB8Unorm||e===P.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===P.ETC2RGB8A1Unorm||e===P.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===P.ETC2RGBA8Unorm||e===P.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===P.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===P.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===P.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===P.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===P.ASTC4x4Unorm||e===P.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===P.ASTC5x4Unorm||e===P.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===P.ASTC5x5Unorm||e===P.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===P.ASTC6x5Unorm||e===P.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===P.ASTC6x6Unorm||e===P.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===P.ASTC8x5Unorm||e===P.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===P.ASTC8x6Unorm||e===P.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===P.ASTC8x8Unorm||e===P.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===P.ASTC10x5Unorm||e===P.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===P.ASTC10x6Unorm||e===P.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===P.ASTC10x8Unorm||e===P.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===P.ASTC10x10Unorm||e===P.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===P.ASTC12x10Unorm||e===P.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===P.ASTC12x12Unorm||e===P.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=Nh.ClampToEdge;return e===Bu?t=Nh.Repeat:e===Du&&(t=Nh.MirrorRepeat),t}_convertFilterMode(e){let t=Li.Linear;return(e===Rn||e===I_||e===ka)&&(t=Li.Nearest),t}_getBytesPerTexel(e){if(e===P.R8Unorm||e===P.R8Snorm||e===P.R8Uint||e===P.R8Sint)return 1;if(e===P.R16Uint||e===P.R16Sint||e===P.R16Float||e===P.RG8Unorm||e===P.RG8Snorm||e===P.RG8Uint||e===P.RG8Sint)return 2;if(e===P.R32Uint||e===P.R32Sint||e===P.R32Float||e===P.RG16Uint||e===P.RG16Sint||e===P.RG16Float||e===P.RGBA8Unorm||e===P.RGBA8UnormSRGB||e===P.RGBA8Snorm||e===P.RGBA8Uint||e===P.RGBA8Sint||e===P.BGRA8Unorm||e===P.BGRA8UnormSRGB||e===P.RGB9E5UFloat||e===P.RGB10A2Unorm||e===P.RG11B10UFloat||e===P.Depth32Float||e===P.Depth24Plus||e===P.Depth24PlusStencil8||e===P.Depth32FloatStencil8)return 4;if(e===P.RG32Uint||e===P.RG32Sint||e===P.RG32Float||e===P.RGBA16Uint||e===P.RGBA16Sint||e===P.RGBA16Float)return 8;if(e===P.RGBA32Uint||e===P.RGBA32Sint||e===P.RGBA32Float)return 16}_getTypedArrayType(e){if(e===P.R8Uint)return Uint8Array;if(e===P.R8Sint)return Int8Array;if(e===P.R8Unorm)return Uint8Array;if(e===P.R8Snorm)return Int8Array;if(e===P.RG8Uint)return Uint8Array;if(e===P.RG8Sint)return Int8Array;if(e===P.RG8Unorm)return Uint8Array;if(e===P.RG8Snorm)return Int8Array;if(e===P.RGBA8Uint)return Uint8Array;if(e===P.RGBA8Sint)return Int8Array;if(e===P.RGBA8Unorm||e===P.RGBA8UnormSRGB)return Uint8Array;if(e===P.RGBA8Snorm)return Int8Array;if(e===P.R16Uint)return Uint16Array;if(e===P.R16Sint)return Int16Array;if(e===P.RG16Uint)return Uint16Array;if(e===P.RG16Sint)return Int16Array;if(e===P.RGBA16Uint)return Uint16Array;if(e===P.RGBA16Sint)return Int16Array;if(e===P.R16Float||e===P.RG16Float||e===P.RGBA16Float)return Uint16Array;if(e===P.R32Uint)return Uint32Array;if(e===P.R32Sint)return Int32Array;if(e===P.R32Float)return Float32Array;if(e===P.RG32Uint)return Uint32Array;if(e===P.RG32Sint)return Int32Array;if(e===P.RG32Float)return Float32Array;if(e===P.RGBA32Uint)return Uint32Array;if(e===P.RGBA32Sint)return Int32Array;if(e===P.RGBA32Float)return Float32Array;if(e===P.BGRA8Unorm||e===P.BGRA8UnormSRGB)return Uint8Array;if(e===P.RGB10A2Unorm||e===P.RGB9E5UFloat||e===P.RG11B10UFloat)return Uint32Array;if(e===P.Depth32Float)return Float32Array;if(e===P.Depth24Plus||e===P.Depth24PlusStencil8)return Uint32Array;if(e===P.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=Ob.ThreeD:t=Ob.TwoD,t}}function xp(n,e=null){const t=n.format,r=n.type,i=n.colorSpace,s=pt.getTransfer(i);let o;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case ml:case gl:o=s===be?P.BC1RGBAUnormSRGB:P.BC1RGBAUnorm;break;case xl:o=s===be?P.BC2RGBAUnormSRGB:P.BC2RGBAUnorm;break;case yl:o=s===be?P.BC3RGBAUnormSRGB:P.BC3RGBAUnorm;break;case Tf:o=P.BC4RUnorm;break;case wf:o=P.BC4RSnorm;break;case Sf:o=P.BC5RGUnorm;break;case Nf:o=P.BC5RGSnorm;break;case _f:o=s===be?P.BC7RGBAUnormSRGB:P.BC7RGBAUnorm;break;case sf:case rf:o=s===be?P.ETC2RGB8UnormSRGB:P.ETC2RGB8Unorm;break;case of:o=s===be?P.ETC2RGBA8UnormSRGB:P.ETC2RGBA8Unorm;break;case af:o=s===be?P.ASTC4x4UnormSRGB:P.ASTC4x4Unorm;break;case cf:o=s===be?P.ASTC5x4UnormSRGB:P.ASTC5x4Unorm;break;case lf:o=s===be?P.ASTC5x5UnormSRGB:P.ASTC5x5Unorm;break;case uf:o=s===be?P.ASTC6x5UnormSRGB:P.ASTC6x5Unorm;break;case df:o=s===be?P.ASTC6x6UnormSRGB:P.ASTC6x6Unorm;break;case hf:o=s===be?P.ASTC8x5UnormSRGB:P.ASTC8x5Unorm;break;case ff:o=s===be?P.ASTC8x6UnormSRGB:P.ASTC8x6Unorm;break;case pf:o=s===be?P.ASTC8x8UnormSRGB:P.ASTC8x8Unorm;break;case mf:o=s===be?P.ASTC10x5UnormSRGB:P.ASTC10x5Unorm;break;case gf:o=s===be?P.ASTC10x6UnormSRGB:P.ASTC10x6Unorm;break;case xf:o=s===be?P.ASTC10x8UnormSRGB:P.ASTC10x8Unorm;break;case yf:o=s===be?P.ASTC10x10UnormSRGB:P.ASTC10x10Unorm;break;case bf:o=s===be?P.ASTC12x10UnormSRGB:P.ASTC12x10Unorm;break;case vf:o=s===be?P.ASTC12x12UnormSRGB:P.ASTC12x12Unorm;break;case Dn:o=s===be?P.RGBA8UnormSRGB:P.RGBA8Unorm;break;default:ie("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Dn:switch(r){case ya:o=P.RGBA8Snorm;break;case ba:o=P.RGBA16Sint;break;case Ps:o=P.RGBA16Uint;break;case mt:o=P.RGBA32Uint;break;case Ut:o=P.RGBA32Sint;break;case sn:o=s===be?P.RGBA8UnormSRGB:P.RGBA8Unorm;break;case $t:o=P.RGBA16Float;break;case dn:o=P.RGBA32Float;break;default:ie("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case cm:switch(r){case dT:o=P.RGB9E5UFloat;break;case hT:o=P.RG11B10UFloat;break;default:ie("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case lm:switch(r){case ya:o=P.R8Snorm;break;case ba:o=P.R16Sint;break;case Ps:o=P.R16Uint;break;case mt:o=P.R32Uint;break;case Ut:o=P.R32Sint;break;case sn:o=P.R8Unorm;break;case $t:o=P.R16Float;break;case dn:o=P.R32Float;break;default:ie("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case Kr:switch(r){case ya:o=P.RG8Snorm;break;case ba:o=P.RG16Sint;break;case Ps:o=P.RG16Uint;break;case mt:o=P.RG32Uint;break;case Ut:o=P.RG32Sint;break;case sn:o=P.RG8Unorm;break;case $t:o=P.RG16Float;break;case dn:o=P.RG32Float;break;default:ie("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case ei:switch(r){case Ps:o=P.Depth16Unorm;break;case mt:o=P.Depth24Plus;break;case dn:o=P.Depth32Float;break;default:ie("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case Jr:switch(r){case Zr:o=P.Depth24PlusStencil8;break;case dn:e&&e.features.has(gp.Depth32FloatStencil8)===!1&&ie('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=P.Depth32FloatStencil8;break;default:ie("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case um:switch(r){case Ut:o=P.R32Sint;break;case mt:o=P.R32Uint;break;default:ie("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case dm:switch(r){case Ut:o=P.RG32Sint;break;case mt:o=P.RG32Uint;break;default:ie("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case hm:switch(r){case Ut:o=P.RGBA32Sint;break;case mt:o=P.RGBA32Uint;break;default:ie("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:ie("WebGPURenderer: Unsupported texture format.",t)}return o}const N6=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,A6=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,Vb={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},E6=n=>{n=n.trim();const e=n.match(N6);if(e!==null&&e.length===4){const t=e[2],r=[];let i=null;for(;(i=A6.exec(t))!==null;)r.push({name:i[1],type:i[2]});const s=[];for(let u=0;u<r.length;u++){const{name:d,type:h}=r[u];let f=h;f.startsWith("ptr")?f="pointer":(f.startsWith("texture")&&(f=h.split("<")[0]),f=Vb[f]),s.push(new pg(f,d))}const o=n.substring(e[0].length),a=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:Vb[a]||a,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class C6 extends gg{constructor(e){const{type:t,inputs:r,name:i,inputsCode:s,blockCode:o,outputType:a}=E6(e);super(t,r,i),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class R6 extends SN{parseFunction(e){return new C6(e)}}const Es=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},M6={[Kn.READ_ONLY]:"read",[Kn.WRITE_ONLY]:"write",[Kn.READ_WRITE]:"read_write"},Gb={[Bu]:"repeat",[Fa]:"clamp",[Du]:"mirror"},tl={vertex:Es?Es.VERTEX:1,fragment:Es?Es.FRAGMENT:2,compute:Es?Es.COMPUTE:4},$b={instance:!0,swizzleAssign:!1,storageBuffer:!0},P6={"^^":"tsl_xor"},D6={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},jb={},ia={tsl_xor:new At("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new At("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new At("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new At("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new At("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new At("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new At("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new At("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new At("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new At("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new At("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new At("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new At(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},B6={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};let kN="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(kN+=`diagnostic( off, derivative_uniformity );
`);class F6 extends wN{constructor(e,t){super(e,t,new R6),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,r,i,s,o=this.shaderStage){return o==="fragment"?i?s?`textureSample( ${t}, ${t}_sampler, ${r}, ${i}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r}, ${i} )`:s?`textureSample( ${t}, ${t}_sampler, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this.generateTextureSampleLevel(e,t,r,"0",i)}generateTextureSampleLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateWrapFunction(e){const t=`tsl_coord_${Gb[e.wrapS]}S_${Gb[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let r=jb[t];if(r===void 0){const i=[],s=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(c,l)=>{c===Bu?(i.push(ia.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${l} )`):c===Fa?(i.push(ia.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${l} )`):c===Du?(i.push(ia.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${l} )`):(o+=`		coord.${l}`,se(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,jb[t]=r=new At(o,i)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let s=i.dimensionsSnippet[r];if(i.dimensionsSnippet[r]===void 0){let o,a;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),l=c>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",l||e.isStorageTexture?o=t:o=`${t}${r?`, u32( ${r} )`:""}`,s=new Cl(new Rl(`textureDimensions( ${o} )`,a)),i.dimensionsSnippet[r]=s,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(i.arrayLayerCount=new Cl(new Rl(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new Cl(new Rl("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,r,i,s="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s);return i&&(r=`${r} + vec2<f32>(${i}) / ${a}`),`tsl_biquadraticTexture( ${t}, ${o}( ${r} ), ${a}, u32( ${s} ) )`}generateTextureLod(e,t,r,i,s,o="0u"){const a=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),l=e.isData3DTexture?"vec3":"vec2";s&&(r=`${r} + ${l}<f32>(${s}) / ${l}<f32>( ${c} )`);const u=`${l}<u32>( ${a}( ${r} ) * ${l}<f32>( ${c} ) )`;return this.generateTextureLoad(e,t,u,o,i,null)}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0u"),o&&(r=`${r} + ${o}`);let a;return s?a=`textureLoad( ${t}, ${r}, ${s}, u32( ${i} ) )`:(a=`textureLoad( ${t}, ${r}, u32( ${i} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,r,i,s){let o;return i?o=`textureStore( ${t}, ${r}, ${i}, ${s} )`:o=`textureStore( ${t}, ${r}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===dn||this.isSampleCompare(e)===!1&&e.minFilter===Rn&&e.magFilter===Rn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,i,s,o=this.shaderStage){let a=null;return this.isUnfilterable(e)?a=this.generateTextureLod(e,t,r,i,s,"0",o):a=this._generateTextureSample(e,t,r,i,s,o),a}generateTextureGrad(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]} )`;ie(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i} )`;ie(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateTextureBias(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i} )`;ie(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"?r:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?r:r+".value":e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=P6[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(se("WebGPURenderer: Atomic operations are only supported in compute shaders."),Kn.READ_WRITE):Kn.READ_ONLY:e.access}getStorageAccess(e,t){return M6[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);if(o.uniformGPU===void 0){let a;const c=e.groupNode,l=c.name,u=this.getBindGroupArray(l,r);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let d=null;const h=this.getNodeAccess(e,r);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?d=new mp(s.name,s.node,c,h):d=new ad(s.name,s.node,c,h):t==="cubeTexture"?d=new DN(s.name,s.node,c,h):t==="texture3D"&&(d=new mp(s.name,s.node,c,h)),d.store=e.isStorageTextureNode===!0,d.mipLevel=d.store?e.mipLevel:0,d.setVisibility(tl[r]),this.isUnfilterable(e.value)===!1&&d.store===!1){const f=new x6(`${s.name}_sampler`,s.node,c);f.setVisibility(tl[r]),u.push(f,d),a=[f,d]}else u.push(d),a=[d]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const d=t==="buffer"?RN:v6,h=new d(e,c);h.setVisibility(tl[r]),u.push(h),a=h,s.name=i||"NodeBuffer_"+s.id}else{const d=this.uniformGroups[r]||(this.uniformGroups[r]={});let h=d[l];h===void 0&&(h=new MN(l,c),h.setVisibility(tl[r]),d[l]=h,u.push(h)),a=this.getNodeUniform(s,t),h.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,r,i=this.shaderStage){const s=this.builtins[i]||(this.builtins[i]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${r.vars}
${r.code}
`;return r.result&&(s+=`	return ${r.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(r!==void 0)for(const i of r)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(r!==void 0)for(const{name:i,property:s,type:o}of r.values())t.push(`@builtin( ${i} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,r,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:r,scope:i,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${i}> ${r}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&t.push(r);const i=this.getAttributesArray();for(let s=0,o=i.length;s<o;s++){const a=i[s],c=a.name,l=this.getType(a.type);t.push(`@location( ${s} ) ${c} : ${l}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const r of e.members){const i=e.output?"@location( "+r.index+" ) ":"";let s=this.getType(r.type);r.atomic&&(s="atomic< "+s+" >"),t.push(`	${i+r.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const i=[];for(const s of r){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,i.push(o)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,r=null){let i=`var ${t} : `;return r!==null?i+=this.generateArrayDeclaration(e,r):i+=this.getType(e),i}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const c=s[a];if(c.needsInterpolation){let l=`@location( ${a} )`;if(c.interpolationType){const u=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";l+=` @interpolate( ${c.interpolationType}${u}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(l+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${l} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const r=this.getBuiltins(e);r&&t.push(r);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){const t=e.value,r=e.node,i=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&r.structTypeNode!==null,s=r.value&&r.value.array&&typeof r.value.itemSize=="number"&&r.value.array.length>r.value.itemSize;return i&&!s}getUniforms(e){const t=this.uniforms[e],r=[],i=[],s=[],o={};for(const c of t){const l=c.groupNode.name,u=this.bindingsIndexes[l];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const d=c.node.value;this.isUnfilterable(d)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(d)?r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name}_sampler : sampler_comparison;`):r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name}_sampler : sampler;`));let h,f="";const{primarySamples:p}=this.renderer.backend.utils.getTextureSampleData(d);if(p>1&&(f="_multisampled"),d.isCubeTexture===!0)h="texture_cube<f32>";else if(d.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&d.compareFunction===null?h=`texture${f}_2d<f32>`:h=`texture_depth${f}_2d${d.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const m=xp(d),x=this.getStorageAccess(c.node,e),g=c.node.value.is3DTexture,y=c.node.value.isArrayTexture;h=`texture_storage_${g?"3d":`2d${y?"_array":""}`}<${m}, ${x}>`}else if(d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0)h="texture_2d_array<f32>";else if(d.is3DTexture===!0||d.isData3DTexture===!0)h="texture_3d<f32>";else{const m=this.getComponentTypeFromTexture(d).charAt(0);h=`texture${f}_2d<${m}32>`}r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name} : ${h};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const d=c.node,h=this.getType(d.getNodeType(this)),f=d.bufferCount,p=f>0&&c.type==="buffer"?", "+f:"",m=d.isStorageBufferNode?`storage, ${this.getStorageAccess(d,e)}`:"uniform";if(this.isCustomStruct(c))i.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var<${m}> ${c.name} : ${h};`);else{const g=`	value : array< ${d.isAtomic?`atomic<${h}>`:`${h}`}${p} >`;i.push(this._getWGSLStructBinding(c.name,g,m,u.binding++,u.group))}}else{const d=this.getType(this.getVectorType(c.type)),h=c.groupNode.name;(o[h]||(o[h]={index:u.binding++,id:u.group,snippets:[]})).snippets.push(`	${c.name} : ${d}`)}}for(const c in o){const l=o[c];s.push(this._getWGSLStructBinding(c,l.snippets.join(`,
`),"uniform",l.index,l.id))}let a=r.join(`
`);return a+=i.join(`
`),a+=s.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const l of s){const u=this.getFlowData(l),d=l.name;if(d&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${d}
`),i+=`${u.code}
	`,l===o&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${u.result};`;else if(t==="fragment")if(c)r.returnType=a.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",i+=`return ${u.result};`;else{let h="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(h+=`,
	`+f),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",h),r.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${u.result};

	return output;`}}}r.flow=i}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let r;return t!==null&&(r=this._getWGSLMethod(e+"_"+t)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getTernary(e,t,r){return`select( ${r}, ${t}, ${e} )`}getType(e){return D6[e]||e}isAvailable(e){let t=$b[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),$b[e]=t),t}_getWGSLMethod(e){return ia[e]!==void 0&&this._include(e),B6[e]}_include(e){const t=ia[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${kN}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[r,i,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${r}, ${i}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${r} * numWorkgroups.x )
		+ globalId.z * ( ${r} * numWorkgroups.x ) * ( ${i} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,r,i=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${i} ) @group( ${s} )
var<${r}> ${e} : ${o};`}}class k6{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=P.Depth24PlusStencil8:e.depth&&(t=P.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return ks.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return ks.LineList;if(e.isLine)return ks.LineStrip;if(e.isMesh)return ks.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===sn)return P.BGRA8Unorm;if(e===$t)return P.RGBA16Float;throw new Error("Unsupported outputType")}}const LN=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&LN.set(Float16Array,["float16"]);const L6=new Map([[mT,["float16"]]]),I6=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class O6{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),i=this.backend,s=i.get(r);let o=s.buffer;if(o===void 0){const a=i.device;let c=r.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let d=0;d<c.length;d++)c[d]===65535&&(c[d]=4294967295)}if(r.array=c,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){c=new c.constructor(r.count*4);for(let d=0;d<r.count;d++)c.set(r.array.subarray(d*3,d*3+3),d*4);r.itemSize=4,r.array=c,s._force3to4BytesAlignment=!0}const l=c.byteLength,u=l+(4-l%4)%4;o=a.createBuffer({label:r.name,size:u,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,i=r.device,s=r.get(t),o=r.get(t).buffer;let a=t.array;if(s._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let u=0;u<t.count;u++)a.set(t.array.subarray(u*3,u*3+3),u*4);t.array=a}const c=this._isTypedArray(a),l=t.updateRanges;if(l.length===0)i.queue.writeBuffer(o,0,a,0);else{const u=c?1:a.BYTES_PER_ELEMENT;for(let d=0,h=l.length;d<h;d++){const f=l[d];let p,m;if(s._force3to4BytesAlignment===!0){const g=Math.floor(f.start/3),y=Math.ceil(f.count/3);p=g*4*u,m=y*4*u}else p=f.start*u,m=f.count*u;const x=p*(c?a.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(o,x,a,p,m)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let i=0;i<t.length;i++){const s=t[i],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let c=r.get(a);if(c===void 0){let d,h;s.isInterleavedBufferAttribute===!0?(d=s.data.stride*o,h=s.data.isInstancedInterleavedBuffer?el.Instance:el.Vertex):(d=s.itemSize*o,h=s.isInstancedBufferAttribute?el.Instance:el.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(d=4),c={arrayStride:d,attributes:[],stepMode:h},r.set(a,c)}const l=this._getVertexFormat(s),u=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:i,offset:u,format:l})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=r.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=r.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,a,0,o);const l=c.finish();r.queue.submit([l]),await a.mapAsync(GPUMapMode.READ);const u=a.getMappedRange(),d=new e.array.constructor(u.slice(0));return a.unmap(),d.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,i=e.array.constructor,s=e.constructor;let o;if(t===1)o=I6.get(i);else{const c=(L6.get(s)||LN.get(i))[r?1:0];if(c){const l=i.BYTES_PER_ELEMENT*t,d=Math.floor((l+3)/4)*4/i.BYTES_PER_ELEMENT;if(d%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${d}`}}return o||ie("WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class U6{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,r=t.device,i=[];let s=0;for(const o of e.bindings){const a={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const c={};o.isStorageBuffer&&(o.visibility&4&&(o.access===Kn.READ_WRITE||o.access===Kn.WRITE_ONLY)?c.type=Ah.Storage:c.type=Ah.ReadOnlyStorage),a.buffer=c}else if(o.isSampledTexture&&o.store){const c={};c.format=this.backend.get(o.texture).texture.format;const l=o.access;l===Kn.READ_WRITE?c.access=Eh.ReadWrite:l===Kn.WRITE_ONLY?c.access=Eh.WriteOnly:c.access=Eh.ReadOnly,o.texture.isArrayTexture?c.viewDimension=ht.TwoDArray:o.texture.is3DTexture&&(c.viewDimension=ht.ThreeD),a.storageTexture=c}else if(o.isSampledTexture){const c={},{primarySamples:l}=t.utils.getTextureSampleData(o.texture);if(l>1&&(c.multisampled=!0,o.texture.isDepthTexture||(c.sampleType=Ni.UnfilterableFloat)),o.texture.isDepthTexture)t.compatibilityMode&&o.texture.compareFunction===null?c.sampleType=Ni.UnfilterableFloat:c.sampleType=Ni.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const u=o.texture.type;u===Ut?c.sampleType=Ni.SInt:u===mt?c.sampleType=Ni.UInt:u===dn&&(this.backend.hasFeature("float32-filterable")?c.sampleType=Ni.Float:c.sampleType=Ni.UnfilterableFloat)}o.isSampledCubeTexture?c.viewDimension=ht.Cube:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?c.viewDimension=ht.TwoDArray:o.isSampledTexture3D&&(c.viewDimension=ht.ThreeD),a.texture=c}else if(o.isSampler){const c={};o.texture.isDepthTexture&&(o.texture.compareFunction!==null?c.type=Ib.Comparison:t.compatibilityMode&&(c.type=Ib.NonFiltering)),a.sampler=c}else ie(`WebGPUBindingUtils: Unsupported binding "${o}".`);i.push(a)}return r.createBindGroupLayout({entries:i})}createBindings(e,t,r,i=0){const{backend:s,bindGroupLayoutCache:o}=this,a=s.get(e);let c=o.get(e.bindingsReference);c===void 0&&(c=this.createBindingsLayout(e),o.set(e.bindingsReference,c));let l;r>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[r]===i&&(l=a.groups[r])),l===void 0&&(l=this.createBindGroup(e,c),r>0&&(a.groups[r]=l,a.versions[r]=i)),a.group=l,a.layout=c}updateBinding(e){const t=this.backend,r=t.device,i=e.buffer,s=t.get(e).buffer;r.queue.writeBuffer(s,0,i,0)}createBindGroupIndex(e,t){const i=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=i.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});i.queue.writeBuffer(a,0,e,0);const c=[{binding:0,resource:{buffer:a}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const r=this.backend,i=r.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const c=r.get(a);if(c.buffer===void 0){const l=a.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,d=i.createBuffer({label:"bindingBuffer_"+a.name,size:l,usage:u});c.buffer=d}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=r.get(a);if(c.buffer===void 0){const l=a.attribute;c.buffer=r.get(l).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isSampledTexture){const c=r.get(a.texture);let l;if(c.externalTexture!==void 0)l=i.importExternalTexture({source:c.externalTexture});else{const u=a.store?1:c.texture.mipLevelCount,d=a.store?a.mipLevel:0;let h=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(h+=`-${c.texture.depthOrArrayLayers}`),h+=`-${u}-${d}`,l=c[h],l===void 0){const f=g6.All;let p;a.isSampledCubeTexture?p=ht.Cube:a.isSampledTexture3D?p=ht.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?p=ht.TwoDArray:p=ht.TwoD,l=c[h]=c.texture.createView({aspect:f,dimension:p,mipLevelCount:u,baseMipLevel:d})}}o.push({binding:s,resource:l})}else if(a.isSampler){const c=r.get(a.texture);o.push({binding:s,resource:c.sampler})}s++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class V6{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:i,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:c}=o,l=this.backend,u=l.device,d=l.utils,h=l.get(o),f=[];for(const $ of e.getBindings()){const A=l.get($);f.push(A.layout)}const p=l.attributeUtils.createShaderVertexBuffers(e);let m;i.blending!==eo&&(i.blending!==Wi||i.transparent!==!1)&&(m=this._getBlending(i));let x={};i.stencilWrite===!0&&(x={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const g=this._getColorWriteMask(i),y=[];if(e.context.textures!==null){const $=e.context.textures;for(let A=0;A<$.length;A++){const O=d.getTextureFormatGPU($[A]);y.push({format:O,blend:m,writeMask:g})}}else{const $=d.getCurrentColorFormat(e.context);y.push({format:$,blend:m,writeMask:g})}const v=l.get(a).module,_=l.get(c).module,T=this._getPrimitiveState(r,s,i),w=this._getDepthCompare(i),N=d.getCurrentDepthStencilFormat(e.context),S=this._getSampleCount(e.context),C={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},v,{buffers:p}),fragment:Object.assign({},_,{targets:y}),primitive:T,multisample:{count:S,alphaToCoverageEnabled:i.alphaToCoverage&&S>1},layout:u.createPipelineLayout({bindGroupLayouts:f})},B={},D=e.context.depth,U=e.context.stencil;if((D===!0||U===!0)&&(D===!0&&(B.format=N,B.depthWriteEnabled=i.depthWrite,B.depthCompare=w),U===!0&&(B.stencilFront=x,B.stencilBack={},B.stencilReadMask=i.stencilFuncMask,B.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(B.depthBias=i.polygonOffsetUnits,B.depthBiasSlopeScale=i.polygonOffsetFactor,B.depthBiasClamp=0),C.depthStencil=B),u.pushErrorScope("validation"),t===null)h.pipeline=u.createRenderPipeline(C),u.popErrorScope().then($=>{$!==null&&(h.error=!0,ie($.message))});else{const $=new Promise(async A=>{try{h.pipeline=await u.createRenderPipelineAsync(C)}catch{}const O=await u.popErrorScope();O!==null&&(h.error=!0,ie(O.message)),A()});t.push($)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:i,device:s}=r,o=i.getCurrentDepthStencilFormat(e),a=i.getCurrentColorFormats(e),c=this._getSampleCount(e),l={label:t,colorFormats:a,depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(l)}createComputePipeline(e,t){const r=this.backend,i=r.device,s=r.get(e.computeProgram).module,o=r.get(e),a=[];for(const c of t){const l=r.get(c);a.push(l.layout)}o.pipeline=i.createComputePipeline({compute:s,layout:i.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,r;const i=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(i===xa){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,l=e.blendDstAlpha!==null?e.blendDstAlpha:o,u=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},r={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)}}else{const c=e.premultipliedAlpha,l=(u,d,h,f)=>{t={srcFactor:u,dstFactor:d,operation:Si.Add},r={srcFactor:h,dstFactor:f,operation:Si.Add}};if(c)switch(i){case Wi:l(Ne.One,Ne.OneMinusSrcAlpha,Ne.One,Ne.OneMinusSrcAlpha);break;case Vl:l(Ne.One,Ne.One,Ne.One,Ne.One);break;case Ul:l(Ne.Zero,Ne.OneMinusSrc,Ne.Zero,Ne.One);break;case Ol:l(Ne.Dst,Ne.OneMinusSrcAlpha,Ne.Zero,Ne.One);break}else switch(i){case Wi:l(Ne.SrcAlpha,Ne.OneMinusSrcAlpha,Ne.One,Ne.OneMinusSrcAlpha);break;case Vl:l(Ne.SrcAlpha,Ne.One,Ne.One,Ne.One);break;case Ul:ie("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ol:ie("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&r!==void 0)return{color:t,alpha:r};ie("WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case jr:t=Ne.Zero;break;case nT:t=Ne.One;break;case tT:t=Ne.Src;break;case Y_:t=Ne.OneMinusSrc;break;case eT:t=Ne.SrcAlpha;break;case K_:t=Ne.OneMinusSrcAlpha;break;case Z_:t=Ne.Dst;break;case X_:t=Ne.OneMinusDst;break;case Q_:t=Ne.DstAlpha;break;case q_:t=Ne.OneMinusDstAlpha;break;case J_:t=Ne.SrcAlphaSaturated;break;case Sj:t=Ne.Constant;break;case Nj:t=Ne.OneMinusConstant;break;default:ie("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case S2:t=Nt.Never;break;case w2:t=Nt.Always;break;case T2:t=Nt.Less;break;case _2:t=Nt.LessEqual;break;case v2:t=Nt.Equal;break;case b2:t=Nt.GreaterEqual;break;case y2:t=Nt.Greater;break;case x2:t=Nt.NotEqual;break;default:ie("WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case D2:t=Vr.Keep;break;case P2:t=Vr.Zero;break;case M2:t=Vr.Replace;break;case R2:t=Vr.Invert;break;case C2:t=Vr.IncrementClamp;break;case E2:t=Vr.DecrementClamp;break;case A2:t=Vr.IncrementWrap;break;case N2:t=Vr.DecrementWrap;break;default:ie("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case vr:t=Si.Add;break;case W_:t=Si.Subtract;break;case H_:t=Si.ReverseSubtract;break;case F2:t=Si.Min;break;case B2:t=Si.Max;break;default:ie("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const i={},s=this.backend.utils;i.topology=s.getPrimitiveTopology(e,r),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?po.Uint16:po.Uint32);let o=r.side===Qt;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),i.frontFace=o===!0?Fb.CW:Fb.CCW,i.cullMode=r.side===zi?kb.None:kb.Back,i}_getColorWriteMask(e){return e.colorWrite===!0?Lb.All:Lb.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Nt.Always;else{const r=e.depthFunc;switch(r){case uT:t=Nt.Never;break;case lT:t=Nt.Always;break;case cT:t=Nt.Less;break;case aT:t=Nt.LessEqual;break;case oT:t=Nt.Equal;break;case sT:t=Nt.GreaterEqual;break;case iT:t=Nt.Greater;break;case rT:t=Nt.NotEqual;break;default:ie("WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class G6 extends FN{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const s=i.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,r)),a={},c=[];for(const[u,d]of e){const h=u.match(/^(.*):f(\d+)$/),f=parseInt(h[2]);c.includes(f)===!1&&c.push(f),a[f]===void 0&&(a[f]=0);const p=o[d],m=o[d+1],x=Number(m-p)/1e6;this.timestamps.set(u,x),a[f]+=x}const l=a[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=l,this.frames=c,l}catch(e){return e("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){e("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){e("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class $6 extends BN{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new k6(this),this.attributeUtils=new O6(this),this.bindingUtils=new U6(this),this.pipelineUtils=new V6(this),this.textureUtils=new S6(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(t.device===void 0){const i={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},s=typeof navigator<"u"?await navigator.gpu.requestAdapter(i):null;if(s===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(gp),a=[];for(const l of o)s.features.has(l)&&a.push(l);const c={requiredFeatures:a,requiredLimits:t.requiredLimits};r=await s.requestDevice(c)}else r=t.device;r.lost.then(i=>{const s={api:"WebGPU",message:i.message||"Unknown reason",reason:i.reason||null,originalEvent:i};e.onDeviceLost(s)}),this.device=r,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(gp.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let r=t.context;if(r===void 0){const i=this.parameters;e.isDefaultCanvasTarget===!0&&i.context!==void 0?r=i.context:r=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${Mu} webgpu`);const s=i.alpha?"premultiplied":"opaque",o=i.outputType===$t?"extended":"standard";r.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:o}}),t.context=r}return r}get coordinateSystem(){return Pu}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),r=this.get(t),i=e.currentSamples;let s=r.descriptor;if(s===void 0||r.samples!==i){s={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(s.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const a=s.colorAttachments[0];i>0?a.view=this.textureUtils.getColorBuffer().createView():a.resolveTarget=void 0,r.descriptor=s,r.samples=i}const o=s.colorAttachments[0];return i>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),s}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,i=this.get(r);let s=i.descriptors;(s===void 0||i.width!==r.width||i.height!==r.height||i.samples!==r.samples)&&(s={},i.descriptors=s);const o=e.getCacheKey();let a=s[o];if(a===void 0){const l=e.textures,u=[];let d;const h=this._isRenderCameraDepthArray(e);for(let f=0;f<l.length;f++){const p=this.get(l[f]),m={label:`colorAttachment_${f}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:ht.TwoD};if(r.isRenderTarget3D)d=e.activeCubeFace,m.baseArrayLayer=0,m.dimension=ht.ThreeD,m.depthOrArrayLayers=l[f].image.depth;else if(r.isRenderTarget&&l[f].image.depth>1)if(h===!0){const x=e.camera.cameras;for(let g=0;g<x.length;g++){const y={...m,baseArrayLayer:g,arrayLayerCount:1,dimension:ht.TwoD},v=p.texture.createView(y);u.push({view:v,resolveTarget:void 0,depthSlice:void 0})}}else m.dimension=ht.TwoDArray,m.depthOrArrayLayers=l[f].image.depth;if(h!==!0){const x=p.texture.createView(m);let g,y;p.msaaTexture!==void 0?(g=p.msaaTexture.createView(),y=x):(g=x,y=void 0),u.push({view:g,resolveTarget:y,depthSlice:d})}}if(a={textureViews:u},e.depth){const f=this.get(e.depthTexture),p={};e.depthTexture.isArrayTexture&&(p.dimension=ht.TwoD,p.arrayLayerCount=1,p.baseArrayLayer=e.activeCubeFace),a.depthStencilView=f.texture.createView(p)}s[o]=a,i.width=r.width,i.height=r.height,i.samples=r.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let l=0;l<a.textureViews.length;l++){const u=a.textureViews[l];let d={r:0,g:0,b:0,a:1};l===0&&t.clearValue&&(d=t.clearValue),c.colorAttachments.push({view:u.view,depthSlice:u.depthSlice,resolveTarget:u.resolveTarget,loadOp:t.loadOp||Be.Load,storeOp:t.storeOp||Ot.Store,clearValue:d})}return a.depthStencilView&&(c.depthStencilAttachment={view:a.depthStencilView}),c}beginRender(e){const t=this.get(e),r=this.device,i=e.occlusionQueryCount;let s;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=r.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:Be.Load}),this.initTimestampQuery(Xn.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const l=o.colorAttachments;for(let u=0;u<l.length;u++){const d=l[u];e.clearColor?(d.clearValue=u===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=Be.Clear):d.loadOp=Be.Load,d.storeOp=Ot.Store}}else{const l=o.colorAttachments[0];e.clearColor?(l.clearValue=e.clearColorValue,l.loadOp=Be.Clear):l.loadOp=Be.Load,l.storeOp=Ot.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=Be.Clear):a.depthLoadOp=Be.Load,a.depthStoreOp=Ot.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=Be.Clear):a.stencilLoadOp=Be.Load,a.stencilStoreOp=Ot.Store);const c=r.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const l=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==l.length?this._createDepthLayerDescriptors(e,t,o,l):this._updateDepthLayerDescriptors(e,t,l),t.bundleEncoders=[],t.bundleSets=[];for(let u=0;u<l.length;u++){const d=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+u),h={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(d),t.bundleSets.push(h)}t.currentPass=null}else{const l=c.beginRenderPass(o);t.currentPass=l,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,i){const s=r.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<i.length;a++){const c={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[a].view}]};if(r.depthStencilAttachment){const l=a;o.viewCache[l]||(o.viewCache[l]=o.texture.createView({dimension:ht.TwoD,baseArrayLayer:a,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[l],depthLoadOp:s.depthLoadOp||Be.Clear,depthStoreOp:s.depthStoreOp||Ot.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,r){for(let i=0;i<r.length;i++){const s=t.layerDescriptors[i];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Be.Clear):o.depthLoadOp=Be.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Be.Clear):o.stencilLoadOp=Be.Load)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const i=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];s.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const a=t.layerDescriptors[o],c=i.beginRenderPass(a);if(e.viewport){const{x:l,y:u,width:d,height:h,minDepth:f,maxDepth:p}=e.viewportValue;c.setViewport(l,u,d,h,f,p)}if(e.scissor){const{x:l,y:u,width:d,height:h}=e.scissorValue;c.setScissorRect(l,u,d,h)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const s=r*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const a=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,s),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const a=s[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const o=r.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<i.length;c++)a[c]===BigInt(0)&&s.add(i[c]);r.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o,minDepth:a,maxDepth:c}=e.viewportValue;t.setViewport(r,i,s,o,a,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o}=e.scissorValue;t.setScissorRect(r,i,s,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,i=null){const s=this.device,o=this.renderer;let a=[],c,l,u,d;if(e){const p=this.getClearColor();l={r:p.r,g:p.g,b:p.b,a:p.a}}if(i===null){u=o.depth,d=o.stencil;const p=this._getDefaultRenderPassDescriptor();if(e){a=p.colorAttachments;const m=a[0];m.clearValue=l,m.loadOp=Be.Clear,m.storeOp=Ot.Store}(u||d)&&(c=p.depthStencilAttachment)}else{u=i.depth,d=i.stencil;const p={loadOp:e?Be.Clear:Be.Load,clearValue:e?l:void 0};u&&(p.depthLoadOp=t?Be.Clear:Be.Load,p.depthClearValue=t?o.getClearDepth():void 0,p.depthStoreOp=Ot.Store),d&&(p.stencilLoadOp=r?Be.Clear:Be.Load,p.stencilClearValue=r?o.getClearStencil():void 0,p.stencilStoreOp=Ot.Store);const m=this._getRenderPassDescriptor(i,p);a=m.colorAttachments,c=m.depthStencilAttachment}u&&c&&(t?(c.depthLoadOp=Be.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=Ot.Store):(c.depthLoadOp=Be.Load,c.depthStoreOp=Ot.Store)),d&&c&&(r?(c.stencilLoadOp=Be.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=Ot.Store):(c.stencilLoadOp=Be.Load,c.stencilStoreOp=Ot.Store));const h=s.createCommandEncoder({label:"clear"});h.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),s.queue.submit([h.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(Xn.COMPUTE,this.getTimestampUID(e),r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,i,s=null){const o=this.get(t),{passEncoderGPU:a}=this.get(e),c=this.get(i).pipeline;this.pipelineUtils.setPipeline(a,c);for(let l=0,u=r.length;l<u;l++){const d=r[l],h=this.get(d);a.setBindGroup(l,h.group)}if(s===null&&(s=t.count),s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute){const l=this.get(s).buffer;a.dispatchWorkgroupsIndirect(l,0);return}if(typeof s=="number"){const l=s;if(o.dispatchSize===void 0||o.count!==l){o.dispatchSize=[0,1,1],o.count=l;const u=t.workgroupSize;let d=u[0];for(let p=1;p<u.length;p++)d*=u[p];const h=Math.ceil(l/d),f=this.device.limits.maxComputeWorkgroupsPerDimension;s=[h,1,1],h>f&&(s[0]=Math.min(h,f),s[1]=Math.ceil(h/f)),o.dispatchSize=s}s=o.dispatchSize}a.dispatchWorkgroups(s[0],s[1]||1,s[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:r,material:i,context:s,pipeline:o}=e,a=e.getBindings(),c=this.get(s),l=this.get(o),u=l.pipeline;if(l.error===!0)return;const d=e.getIndex(),h=d!==null,f=e.getDrawParameters();if(f===null)return;const p=(x,g)=>{this.pipelineUtils.setPipeline(x,u),g.pipeline=u;const y=g.bindingGroups;for(let _=0,T=a.length;_<T;_++){const w=a[_],N=this.get(w);y[w.index]!==w.id&&(x.setBindGroup(w.index,N.group),y[w.index]=w.id)}if(h===!0&&g.index!==d){const _=this.get(d).buffer,T=d.array instanceof Uint16Array?po.Uint16:po.Uint32;x.setIndexBuffer(_,T),g.index=d}const v=e.getVertexBuffers();for(let _=0,T=v.length;_<T;_++){const w=v[_];if(g.attributes[_]!==w){const N=this.get(w).buffer;x.setVertexBuffer(_,N),g.attributes[_]=w}}s.stencil===!0&&i.stencilWrite===!0&&c.currentStencilRef!==i.stencilRef&&(x.setStencilReference(i.stencilRef),c.currentStencilRef=i.stencilRef)},m=(x,g)=>{if(p(x,g),r.isBatchedMesh===!0){const y=r._multiDrawStarts,v=r._multiDrawCounts,_=r._multiDrawCount,T=r._multiDrawInstances;T!==null&&ft("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let w=0;w<_;w++){const N=T?T[w]:1,S=N>1?0:w;h===!0?x.drawIndexed(v[w],N,y[w]/d.array.BYTES_PER_ELEMENT,0,S):x.draw(v[w],N,y[w],S),t.update(r,v[w],N)}}else if(h===!0){const{vertexCount:y,instanceCount:v,firstVertex:_}=f,T=e.getIndirect();if(T!==null){const w=this.get(T).buffer;x.drawIndexedIndirect(w,0)}else x.drawIndexed(y,v,_,0,0);t.update(r,y,v)}else{const{vertexCount:y,instanceCount:v,firstVertex:_}=f,T=e.getIndirect();if(T!==null){const w=this.get(T).buffer;x.drawIndirect(w,0)}else x.draw(y,v,_,0);t.update(r,y,v)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const x=this.get(e.camera),g=e.camera.cameras,y=e.getBindingGroup("cameraIndex");if(x.indexesGPU===void 0||x.indexesGPU.length!==g.length){const _=this.get(y),T=[],w=new Uint32Array([0,0,0,0]);for(let N=0,S=g.length;N<S;N++){w[0]=N;const C=this.bindingUtils.createBindGroupIndex(w,_.layout);T.push(C)}x.indexesGPU=T}const v=this.renderer.getPixelRatio();for(let _=0,T=g.length;_<T;_++){const w=g[_];if(r.layers.test(w.layers)){const N=w.viewport;let S=c.currentPass,C=c.currentSets;if(c.bundleEncoders){const B=c.bundleEncoders[_],D=c.bundleSets[_];S=B,C=D}N&&S.setViewport(Math.floor(N.x*v),Math.floor(N.y*v),Math.floor(N.width*v),Math.floor(N.height*v),s.viewportValue.minDepth,s.viewportValue.maxDepth),y&&x.indexesGPU&&(S.setBindGroup(y.index,x.indexesGPU[_]),C.bindingGroups[y.index]=y.id),m(S,C)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const x=c.lastOcclusionObject;x!==r&&(x!==null&&x.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),r.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=r),c.lastOcclusionObject=r)}m(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:i}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),l=s.getCurrentDepthStencilFormat(e.context),u=s.getPrimitiveTopology(r,i);let d=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==c||t.depthStencilFormat!==l||t.primitiveTopology!==u||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=c,t.depthStencilFormat=l,t.primitiveTopology=u,t.clippingContextCacheKey=e.clippingContextCacheKey,d=!0),d}getRenderCacheKey(e){const{object:t,material:r}=e,i=this.utils,s=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,o,i.getSampleCountRenderContext(s),i.getCurrentColorSpace(s),i.getCurrentColorFormat(s),i.getCurrentDepthStencilFormat(s),i.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}initTimestampQuery(e,t,r){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new G6(this.device,e,2048));const i=this.timestampQueryPool[e],s=i.allocateQueriesForContext(t);r.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new F6(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),s=r.currentPass.finish();this.get(t).bundleGPU=s,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return Ub[e]!==void 0&&(e=Ub[e]),this.device.features.has(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){let a=0,c=0,l=0,u=0,d=0,h=0,f=e.image.width,p=e.image.height,m=1;r!==null&&(r.isBox3===!0?(u=r.min.x,d=r.min.y,h=r.min.z,f=r.max.x-r.min.x,p=r.max.y-r.min.y,m=r.max.z-r.min.z):(u=r.min.x,d=r.min.y,f=r.max.x-r.min.x,p=r.max.y-r.min.y,m=1)),i!==null&&(a=i.x,c=i.y,l=i.z||0);const x=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),g=this.get(e).texture,y=this.get(t).texture;x.copyTextureToTexture({texture:g,mipLevel:s,origin:{x:u,y:d,z:h}},{texture:y,mipLevel:o,origin:{x:a,y:c,z:l}},[f,p,m]),this.device.queue.submit([x.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const i=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){ie("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(i.currentPass?(i.currentPass.end(),a=i.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[r.x,r.y,0]},{texture:o},[r.z,r.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,a),i.currentPass){const{descriptor:c}=i;for(let l=0;l<c.colorAttachments.length;l++)c.colorAttachments[l].loadOp=Be.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=Be.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=Be.Load),i.currentPass=a.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([a.finish()])}dispose(){this.textureUtils.dispose()}}class j6 extends em{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class z6 extends em{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class H6 extends NN{constructor(){super(),this.addMaterial(t$,"MeshPhongMaterial"),this.addMaterial(cN,"MeshStandardMaterial"),this.addMaterial(nj,"MeshPhysicalMaterial"),this.addMaterial(oj,"MeshToonMaterial"),this.addMaterial(XG,"MeshBasicMaterial"),this.addMaterial(JG,"MeshLambertMaterial"),this.addMaterial(jG,"MeshNormalMaterial"),this.addMaterial(lj,"MeshMatcapMaterial"),this.addMaterial(OG,"LineBasicMaterial"),this.addMaterial(VG,"LineDashedMaterial"),this.addMaterial(pj,"PointsMaterial"),this.addMaterial(uN,"SpriteMaterial"),this.addMaterial(yj,"ShadowMaterial"),this.addLight(q8,kC),this.addLight(_z,F_),this.addLight(Tz,LC),this.addLight(mg,em),this.addLight(Az,k_),this.addLight(Ez,IC),this.addLight(Cz,OC),this.addLight(wz,j6),this.addLight(Nz,z6),this.addToneMapping(t8,UC),this.addToneMapping(n8,VC),this.addToneMapping(r8,GC),this.addToneMapping(s8,$C),this.addToneMapping(l8,jC),this.addToneMapping(u8,zC)}}class W6 extends Xz{constructor(e={}){let t;e.forceWebGL?t=Bb:(t=$6,e.getFallback=()=>(se("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new Bb(e)));const r=new t(e);super(r,e),this.library=new H6,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const Ch={type:"change"},xg={type:"start"},yg={type:"end"},zb=1e-6,Fe={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},nl=new we,Gr=new we,q6=new le,rl=new le,Rh=new le,Cs=new Zs,Hb=new le,il=new le,Mh=new le,sl=new le;class X6 extends Eu{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Ct.ROTATE,MIDDLE:Ct.DOLLY,RIGHT:Ct.PAN},this.target=new le,this.state=Fe.NONE,this.keyState=Fe.NONE,this._lastPosition=new le,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new le,this._movePrev=new we,this._moveCurr=new we,this._lastAxis=new le,this._zoomStart=new we,this._zoomEnd=new we,this._panStart=new we,this._panEnd=new we,this._pointers=[],this._pointerPositions={},this._onPointerMove=Y6.bind(this),this._onPointerDown=K6.bind(this),this._onPointerUp=Q6.bind(this),this._onPointerCancel=Z6.bind(this),this._onContextMenu=s9.bind(this),this._onMouseWheel=i9.bind(this),this._onKeyDown=e9.bind(this),this._onKeyUp=J6.bind(this),this._onTouchStart=o9.bind(this),this._onTouchMove=a9.bind(this),this._onTouchEnd=c9.bind(this),this._onMouseDown=t9.bind(this),this._onMouseMove=n9.bind(this),this._onMouseUp=r9.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>zb&&(this.dispatchEvent(Ch),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>zb||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Ch),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Fe.NONE,this.keyState=Fe.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Ch),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Gr.copy(this._panEnd).sub(this._panStart),Gr.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Gr.x*=e,Gr.y*=t}Gr.multiplyScalar(this._eye.length()*this.panSpeed),rl.copy(this._eye).cross(this.object.up).setLength(Gr.x),rl.add(q6.copy(this.object.up).setLength(Gr.y)),this.object.position.add(rl),this.target.add(rl),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Gr.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){sl.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=sl.length();e?(this._eye.copy(this.object.position).sub(this.target),Hb.copy(this._eye).normalize(),il.copy(this.object.up).normalize(),Mh.crossVectors(il,Hb).normalize(),il.setLength(this._moveCurr.y-this._movePrev.y),Mh.setLength(this._moveCurr.x-this._movePrev.x),sl.copy(il.add(Mh)),Rh.crossVectors(sl,this._eye).normalize(),e*=this.rotateSpeed,Cs.setFromAxisAngle(Rh,e),this._eye.applyQuaternion(Cs),this.object.up.applyQuaternion(Cs),this._lastAxis.copy(Rh),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Cs.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Cs),this.object.up.applyQuaternion(Cs)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Fe.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=$l.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=$l.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return nl.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),nl}_getMouseOnCircle(e,t){return nl.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),nl}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new we,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function K6(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function Y6(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function Q6(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function Z6(n){this._removePointer(n)}function J6(){this.enabled!==!1&&(this.keyState=Fe.NONE,window.addEventListener("keydown",this._onKeyDown))}function e9(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Fe.NONE&&(n.code===this.keys[Fe.ROTATE]&&!this.noRotate?this.keyState=Fe.ROTATE:n.code===this.keys[Fe.ZOOM]&&!this.noZoom?this.keyState=Fe.ZOOM:n.code===this.keys[Fe.PAN]&&!this.noPan&&(this.keyState=Fe.PAN)))}function t9(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ct.DOLLY:this.state=Fe.ZOOM;break;case Ct.ROTATE:this.state=Fe.ROTATE;break;case Ct.PAN:this.state=Fe.PAN;break;default:this.state=Fe.NONE}const t=this.keyState!==Fe.NONE?this.keyState:this.state;t===Fe.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Fe.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Fe.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(xg)}function n9(n){const e=this.keyState!==Fe.NONE?this.keyState:this.state;e===Fe.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Fe.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Fe.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function r9(){this.state=Fe.NONE,this.dispatchEvent(yg)}function i9(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(xg),this.dispatchEvent(yg)}}function s9(n){this.enabled!==!1&&n.preventDefault()}function o9(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Fe.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Fe.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(xg)}function a9(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,r=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const i=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s));break}}function c9(n){switch(this._pointers.length){case 0:this.state=Fe.NONE;break;case 1:this.state=Fe.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Fe.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(yg)}const Wb={type:"change"},bg={type:"start"},IN={type:"end"},ol=new J2,qb=new Cu,l9=Math.cos(70*$l.DEG2RAD),bt=new le,qt=2*Math.PI,Ue={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Ph=1e-6;class u9 extends Eu{constructor(e,t=null){super(e,t),this.state=Ue.NONE,this.target=new le,this.cursor=new le,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ct.ROTATE,MIDDLE:Ct.DOLLY,RIGHT:Ct.PAN},this.touches={ONE:Sr.ROTATE,TWO:Sr.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new le,this._lastQuaternion=new Zs,this._lastTargetPosition=new le,this._quat=new Zs().setFromUnitVectors(e.up,new le(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new x0,this._sphericalDelta=new x0,this._scale=1,this._panOffset=new le,this._rotateStart=new we,this._rotateEnd=new we,this._rotateDelta=new we,this._panStart=new we,this._panEnd=new we,this._panDelta=new we,this._dollyStart=new we,this._dollyEnd=new we,this._dollyDelta=new we,this._dollyDirection=new le,this._mouse=new we,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=h9.bind(this),this._onPointerDown=d9.bind(this),this._onPointerUp=f9.bind(this),this._onContextMenu=v9.bind(this),this._onMouseWheel=g9.bind(this),this._onKeyDown=x9.bind(this),this._onTouchStart=y9.bind(this),this._onTouchMove=b9.bind(this),this._onMouseDown=p9.bind(this),this._onMouseMove=m9.bind(this),this._interceptControlDown=_9.bind(this),this._interceptControlUp=T9.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Wb),this.update(),this.state=Ue.NONE}update(e=null){const t=this.object.position;bt.copy(t).sub(this.target),bt.applyQuaternion(this._quat),this._spherical.setFromVector3(bt),this.autoRotate&&this.state===Ue.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=qt:r>Math.PI&&(r-=qt),i<-Math.PI?i+=qt:i>Math.PI&&(i-=qt),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(bt.setFromSpherical(this._spherical),bt.applyQuaternion(this._quatInverse),t.copy(this.target).add(bt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=bt.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new le(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const l=new le(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),o=bt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(ol.origin.copy(this.object.position),ol.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ol.direction))<l9?this.object.lookAt(this.target):(qb.setFromNormalAndCoplanarPoint(this.object.up,this.target),ol.intersectPlane(qb,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Ph||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Ph||this._lastTargetPosition.distanceToSquared(this.target)>Ph?(this.dispatchEvent(Wb),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?qt/60*this.autoRotateSpeed*e:qt/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){bt.setFromMatrixColumn(t,0),bt.multiplyScalar(-e),this._panOffset.add(bt)}_panUp(e,t){this.screenSpacePanning===!0?bt.setFromMatrixColumn(t,1):(bt.setFromMatrixColumn(t,0),bt.crossVectors(this.object.up,bt)),bt.multiplyScalar(e),this._panOffset.add(bt)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;bt.copy(i).sub(this.target);let s=bt.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/r.clientHeight,this.object.matrix),this._panUp(2*t*s/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,o=r.width,a=r.height;this._mouse.x=i/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(qt*this._rotateDelta.x/t.clientHeight),this._rotateUp(qt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(qt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-qt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(qt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-qt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),s=.5*(e.pageY+r.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(qt*this._rotateDelta.x/t.clientHeight),this._rotateUp(qt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new we,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function d9(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function h9(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function f9(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(IN),this.state=Ue.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function p9(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ct.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Ue.DOLLY;break;case Ct.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Ue.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Ue.ROTATE}break;case Ct.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Ue.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Ue.PAN}break;default:this.state=Ue.NONE}this.state!==Ue.NONE&&this.dispatchEvent(bg)}function m9(n){switch(this.state){case Ue.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Ue.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Ue.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function g9(n){this.enabled===!1||this.enableZoom===!1||this.state!==Ue.NONE||(n.preventDefault(),this.dispatchEvent(bg),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(IN))}function x9(n){this.enabled!==!1&&this._handleKeyDown(n)}function y9(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Sr.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Ue.TOUCH_ROTATE;break;case Sr.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Ue.TOUCH_PAN;break;default:this.state=Ue.NONE}break;case 2:switch(this.touches.TWO){case Sr.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Ue.TOUCH_DOLLY_PAN;break;case Sr.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Ue.TOUCH_DOLLY_ROTATE;break;default:this.state=Ue.NONE}break;default:this.state=Ue.NONE}this.state!==Ue.NONE&&this.dispatchEvent(bg)}function b9(n){switch(this._trackPointer(n),this.state){case Ue.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Ue.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Ue.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Ue.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Ue.NONE}}function v9(n){this.enabled!==!1&&n.preventDefault()}function _9(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function T9(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const w9={type:"change"},Xb=1e-6,Kb=new Zs;class S9 extends Eu{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new le(0,0,0),this._rotationVector=new le(0,0,0),this._lastQuaternion=new Zs,this._lastPosition=new le,this._status=0,this._onKeyDown=N9.bind(this),this._onKeyUp=A9.bind(this),this._onPointerMove=C9.bind(this),this._onPointerDown=E9.bind(this),this._onPointerUp=R9.bind(this),this._onPointerCancel=M9.bind(this),this._onContextMenu=P9.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,r=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),Kb.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(Kb),(this._lastPosition.distanceToSquared(t.position)>Xb||8*(1-this._lastQuaternion.dot(t.quaternion))>Xb)&&(this.dispatchEvent(w9),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function N9(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function A9(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function E9(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function C9(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function R9(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function M9(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function P9(n){this.enabled!==!1&&n.preventDefault()}const D9={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class cd{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const B9=new nm(-1,1,1,-1,0,1);class F9 extends nc{constructor(){super(),this.setAttribute("position",new Gl([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Gl([0,2,0,0,2,0],2))}}const k9=new F9;class L9{constructor(e){this._mesh=new kn(k9,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,B9)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class I9 extends cd{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof y0?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=eR.clone(e.uniforms),this.material=new y0({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new L9(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class Yb extends cd{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class O9 extends cd{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class U9{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new we);this._width=r.width,this._height=r.height,t=new tR(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:$t}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new I9(D9),this.copyPass.material.blending=eo,this.clock=new yT}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Yb!==void 0&&(o instanceof Yb?r=!0:o instanceof O9&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new we);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class V9 extends cd{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new vn}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=i}}function G9(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Xa(n,e){return Xa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Xa(n,e)}function $9(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Xa(n,e)}function yp(n){return yp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yp(n)}function j9(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function ON(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ON=function(){return!!n})()}function z9(n,e,t){if(ON())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&Xa(i,t.prototype),i}function bp(n){var e=typeof Map=="function"?new Map:void 0;return bp=function(r){if(r===null||!j9(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return z9(r,arguments,yp(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Xa(i,r)},bp(n)}var Yn=(function(n){$9(e,n);function e(t){var r;return r=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,G9(r)}return e})(bp(Error));function Dh(n){return Math.round(n*255)}function H9(n,e,t){return Dh(n)+","+Dh(e)+","+Dh(t)}function yu(n,e,t,r){if(r===void 0&&(r=H9),e===0)return r(t,t,t);var i=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,c=0,l=0;i>=0&&i<1?(a=s,c=o):i>=1&&i<2?(a=o,c=s):i>=2&&i<3?(c=s,l=o):i>=3&&i<4?(c=o,l=s):i>=4&&i<5?(a=o,l=s):i>=5&&i<6&&(a=s,l=o);var u=t-s/2,d=a+u,h=c+u,f=l+u;return r(d,h,f)}var Qb={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function W9(n){if(typeof n!="string")return n;var e=n.toLowerCase();return Qb[e]?"#"+Qb[e]:n}var q9=/^#[a-fA-F0-9]{6}$/,X9=/^#[a-fA-F0-9]{8}$/,K9=/^#[a-fA-F0-9]{3}$/,Y9=/^#[a-fA-F0-9]{4}$/,Bh=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Q9=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Z9=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,J9=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function mo(n){if(typeof n!="string")throw new Yn(3);var e=W9(n);if(e.match(q9))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(X9)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(K9))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(Y9)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=Bh.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=Q9.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=Z9.exec(e);if(o){var a=parseInt(""+o[1],10),c=parseInt(""+o[2],10)/100,l=parseInt(""+o[3],10)/100,u="rgb("+yu(a,c,l)+")",d=Bh.exec(u);if(!d)throw new Yn(4,e,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10)}}var h=J9.exec(e.substring(0,50));if(h){var f=parseInt(""+h[1],10),p=parseInt(""+h[2],10)/100,m=parseInt(""+h[3],10)/100,x="rgb("+yu(f,p,m)+")",g=Bh.exec(x);if(!g)throw new Yn(4,e,x);return{red:parseInt(""+g[1],10),green:parseInt(""+g[2],10),blue:parseInt(""+g[3],10),alpha:parseFloat(""+h[4])>1?parseFloat(""+h[4])/100:parseFloat(""+h[4])}}throw new Yn(5)}function eH(n){var e=n.red/255,t=n.green/255,r=n.blue/255,i=Math.max(e,t,r),s=Math.min(e,t,r),o=(i+s)/2;if(i===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,c=i-s,l=o>.5?c/(2-i-s):c/(i+s);switch(i){case e:a=(t-r)/c+(t<r?6:0);break;case t:a=(r-e)/c+2;break;default:a=(e-t)/c+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:l,lightness:o,alpha:n.alpha}:{hue:a,saturation:l,lightness:o}}function fi(n){return eH(mo(n))}var tH=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},vp=tH;function Mi(n){var e=n.toString(16);return e.length===1?"0"+e:e}function Fh(n){return Mi(Math.round(n*255))}function nH(n,e,t){return vp("#"+Fh(n)+Fh(e)+Fh(t))}function UN(n,e,t){return yu(n,e,t,nH)}function rH(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return UN(n.hue,n.saturation,n.lightness);throw new Yn(1)}function iH(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?UN(n.hue,n.saturation,n.lightness):"rgba("+yu(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new Yn(2)}function VN(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return vp("#"+Mi(n)+Mi(e)+Mi(t));if(typeof n=="object"&&e===void 0&&t===void 0)return vp("#"+Mi(n.red)+Mi(n.green)+Mi(n.blue));throw new Yn(6)}function ld(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?VN(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new Yn(7)}var sH=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},oH=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},aH=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},cH=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function pi(n){if(typeof n!="object")throw new Yn(8);if(oH(n))return ld(n);if(sH(n))return VN(n);if(cH(n))return iH(n);if(aH(n))return rH(n);throw new Yn(8)}function GN(n,e,t){return function(){var i=t.concat(Array.prototype.slice.call(arguments));return i.length>=e?n.apply(this,i):GN(n,e,i)}}function an(n){return GN(n,n.length,[])}function lH(n,e){if(e==="transparent")return e;var t=fi(e);return pi(yn({},t,{hue:t.hue+parseFloat(n)}))}an(lH);function Eo(n,e,t){return Math.max(n,Math.min(e,t))}function uH(n,e){if(e==="transparent")return e;var t=fi(e);return pi(yn({},t,{lightness:Eo(0,1,t.lightness-parseFloat(n))}))}an(uH);function dH(n,e){if(e==="transparent")return e;var t=fi(e);return pi(yn({},t,{saturation:Eo(0,1,t.saturation-parseFloat(n))}))}an(dH);function hH(n,e){if(e==="transparent")return e;var t=fi(e);return pi(yn({},t,{lightness:Eo(0,1,t.lightness+parseFloat(n))}))}an(hH);function fH(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var r=mo(e),i=yn({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),s=mo(t),o=yn({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),a=i.alpha-o.alpha,c=parseFloat(n)*2-1,l=c*a===-1?c:c+a,u=1+c*a,d=(l/u+1)/2,h=1-d,f={red:Math.floor(i.red*d+o.red*h),green:Math.floor(i.green*d+o.green*h),blue:Math.floor(i.blue*d+o.blue*h),alpha:i.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return ld(f)}var pH=an(fH),$N=pH;function mH(n,e){if(e==="transparent")return e;var t=mo(e),r=typeof t.alpha=="number"?t.alpha:1,i=yn({},t,{alpha:Eo(0,1,(r*100+parseFloat(n)*100)/100)});return ld(i)}var gH=an(mH),xH=gH;function yH(n,e){if(e==="transparent")return e;var t=fi(e);return pi(yn({},t,{saturation:Eo(0,1,t.saturation+parseFloat(n))}))}an(yH);function bH(n,e){return e==="transparent"?e:pi(yn({},fi(e),{hue:parseFloat(n)}))}an(bH);function vH(n,e){return e==="transparent"?e:pi(yn({},fi(e),{lightness:parseFloat(n)}))}an(vH);function _H(n,e){return e==="transparent"?e:pi(yn({},fi(e),{saturation:parseFloat(n)}))}an(_H);function TH(n,e){return e==="transparent"?e:$N(parseFloat(n),"rgb(0, 0, 0)",e)}an(TH);function wH(n,e){return e==="transparent"?e:$N(parseFloat(n),"rgb(255, 255, 255)",e)}an(wH);function SH(n,e){if(e==="transparent")return e;var t=mo(e),r=typeof t.alpha=="number"?t.alpha:1,i=yn({},t,{alpha:Eo(0,1,+(r*100-parseFloat(n)*100).toFixed(2)/100)});return ld(i)}an(SH);var Qi=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-Qi.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?Qi.Bounce.In(n*2)*.5:Qi.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),fa=function(){return performance.now()},jN=(function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=fa()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],o=!t;s&&s.update(e,o)===!1&&!t&&delete this._tweens[r[i]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n})(),_p={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=_p.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},zN=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),Tp=new jN,Zb=(function(){function n(e,t){t===void 0&&(t=Tp),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Qi.Linear.None,this._interpolationFunction=_p.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=zN.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=fa()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var s in this._valuesEnd)i[s]=this._valuesEnd[s];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,i,s){for(var o in r){var a=e[o],c=Array.isArray(a),l=c?"array":typeof a,u=!c&&Array.isArray(r[o]);if(!(l==="undefined"||l==="function")){if(u){var d=r[o];if(d.length===0)continue;for(var h=[a],f=0,p=d.length;f<p;f+=1){var m=this._handleRelativeValue(a,d[f]);if(isNaN(m)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(m)}u&&(r[o]=h)}if((l==="object"||c)&&a&&!u){t[o]=c?[]:{};var x=a;for(var g in x)t[o][g]=x[g];i[o]=c?[]:{};var d=r[o];if(!this._isDynamic){var y={};for(var g in d)y[g]=d[g];r[o]=d=y}this._setupProperties(x,t[o],d,i[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),c||(t[o]*=1),u?i[o]=r[o].slice().reverse():i[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=fa()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=fa()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=Tp),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=Qi.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=_p.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,i;if(e===void 0&&(e=fa()),t===void 0&&(t=!0),this._isPaused)return!0;var s,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,c=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),l=this._duration+this._repeat*c,u=function(){if(r._duration===0||a>l)return 1;var x=Math.trunc(a/c),g=a-x*c,y=Math.min(g/r._duration,1);return y===0&&a===r._duration?1:y},d=u(),h=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||a>=this._duration)if(this._repeat>0){var f=Math.min(Math.trunc((a-this._duration)/c)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=f);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=c*f,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var p=0,m=this._chainedTweens.length;p<m;p++)this._chainedTweens[p].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var o=t[s]||0,a=r[s],c=Array.isArray(e[s]),l=Array.isArray(a),u=!c&&l;u?e[s]=this._interpolationFunction(a,i):typeof a=="object"&&a?this._updateProperties(e[s],o,a,i):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n})();zN.nextId;var or=Tp;or.getAll.bind(or);or.removeAll.bind(or);or.add.bind(or);or.remove.bind(or);or.update.bind(or);var hc,Ze,HN,WN,Ii,Jb,qN,XN,KN,vg,wp,Sp,Ka={},YN=[],NH=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ud=Array.isArray;function Qn(n,e){for(var t in e)n[t]=e[t];return n}function _g(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function AH(n,e,t){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?hc.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)o[s]===void 0&&(o[s]=n.defaultProps[s]);return Ca(n,o,r,i,null)}function Ca(n,e,t,r,i){var s={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++HN,__i:-1,__u:0};return i==null&&Ze.vnode!=null&&Ze.vnode(s),s}function dd(n){return n.children}function Pl(n,e){this.props=n,this.context=e}function go(n,e){if(e==null)return n.__?go(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?go(n):null}function QN(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return QN(n)}}function ev(n){(!n.__d&&(n.__d=!0)&&Ii.push(n)&&!bu.__r++||Jb!=Ze.debounceRendering)&&((Jb=Ze.debounceRendering)||qN)(bu)}function bu(){for(var n,e,t,r,i,s,o,a=1;Ii.length;)Ii.length>a&&Ii.sort(XN),n=Ii.shift(),a=Ii.length,n.__d&&(t=void 0,r=void 0,i=(r=(e=n).__v).__e,s=[],o=[],e.__P&&((t=Qn({},r)).__v=r.__v+1,Ze.vnode&&Ze.vnode(t),Tg(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??go(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,eA(s,t,o),r.__e=r.__=null,t.__e!=i&&QN(t)));bu.__r=0}function ZN(n,e,t,r,i,s,o,a,c,l,u){var d,h,f,p,m,x,g,y=r&&r.__k||YN,v=e.length;for(c=EH(t,e,y,c,v),d=0;d<v;d++)(f=t.__k[d])!=null&&(h=f.__i==-1?Ka:y[f.__i]||Ka,f.__i=d,x=Tg(n,f,h,i,s,o,a,c,l,u),p=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&wg(h.ref,null,f),u.push(f.ref,f.__c||p,f)),m==null&&p!=null&&(m=p),(g=!!(4&f.__u))||h.__k===f.__k?c=JN(f,c,n,g):typeof f.type=="function"&&x!==void 0?c=x:p&&(c=p.nextSibling),f.__u&=-7);return t.__e=m,c}function EH(n,e,t,r,i){var s,o,a,c,l,u=t.length,d=u,h=0;for(n.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[s]=Ca(null,o,null,null,null):ud(o)?o=n.__k[s]=Ca(dd,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=n.__k[s]=Ca(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[s]=o,c=s+h,o.__=n,o.__b=n.__b+1,(l=o.__i=CH(o,t,c,d))!=-1&&(d--,(a=t[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(i>u?h--:i<u&&h++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,o.__u|=4))):n.__k[s]=null;if(d)for(s=0;s<u;s++)(a=t[s])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=go(a)),nA(a,a));return r}function JN(n,e,t,r){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=JN(i[s],e,t,r));return e}n.__e!=e&&(r&&(e&&n.type&&!e.parentNode&&(e=go(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function CH(n,e,t,r){var i,s,o,a=n.key,c=n.type,l=e[t],u=l!=null&&(2&l.__u)==0;if(l===null&&a==null||u&&a==l.key&&c==l.type)return t;if(r>(u?1:0)){for(i=t-1,s=t+1;i>=0||s<e.length;)if((l=e[o=i>=0?i--:s++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return o}return-1}function tv(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||NH.test(e)?t:t+"px"}function al(n,e,t,r,i){var s,o;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||tv(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||tv(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(KN,"$1")),o=e.toLowerCase(),e=o in n||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?r?t.u=r.u:(t.u=vg,n.addEventListener(e,s?Sp:wp,s)):n.removeEventListener(e,s?Sp:wp,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function nv(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=vg++;else if(e.t<t.u)return;return t(Ze.event?Ze.event(e):e)}}}function Tg(n,e,t,r,i,s,o,a,c,l){var u,d,h,f,p,m,x,g,y,v,_,T,w,N,S,C,B,D=e.type;if(e.constructor!=null)return null;128&t.__u&&(c=!!(32&t.__u),s=[a=e.__e=t.__e]),(u=Ze.__b)&&u(e);e:if(typeof D=="function")try{if(g=e.props,y="prototype"in D&&D.prototype.render,v=(u=D.contextType)&&r[u.__c],_=u?v?v.props.value:u.__:r,t.__c?x=(d=e.__c=t.__c).__=d.__E:(y?e.__c=d=new D(g,_):(e.__c=d=new Pl(g,_),d.constructor=D,d.render=MH),v&&v.sub(d),d.state||(d.state={}),d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),y&&d.__s==null&&(d.__s=d.state),y&&D.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Qn({},d.__s)),Qn(d.__s,D.getDerivedStateFromProps(g,d.__s))),f=d.props,p=d.state,d.__v=e,h)y&&D.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),y&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(y&&D.getDerivedStateFromProps==null&&g!==f&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,_),e.__v==t.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,_)===!1){for(e.__v!=t.__v&&(d.props=g,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(U){U&&(U.__=e)}),T=0;T<d._sb.length;T++)d.__h.push(d._sb[T]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,_),y&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(f,p,m)})}if(d.context=_,d.props=g,d.__P=n,d.__e=!1,w=Ze.__r,N=0,y){for(d.state=d.__s,d.__d=!1,w&&w(e),u=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do d.__d=!1,w&&w(e),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++N<25);d.state=d.__s,d.getChildContext!=null&&(r=Qn(Qn({},r),d.getChildContext())),y&&!h&&d.getSnapshotBeforeUpdate!=null&&(m=d.getSnapshotBeforeUpdate(f,p)),C=u,u!=null&&u.type===dd&&u.key==null&&(C=tA(u.props.children)),a=ZN(n,ud(C)?C:[C],e,t,r,i,s,o,a,c,l),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),x&&(d.__E=d.__=null)}catch(U){if(e.__v=null,c||s!=null)if(U.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(B=s.length;B--;)_g(s[B]);Np(e)}else e.__e=t.__e,e.__k=t.__k,U.then||Np(e);Ze.__e(U,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=RH(t.__e,e,t,r,i,s,o,c,l);return(u=Ze.diffed)&&u(e),128&e.__u?void 0:a}function Np(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Np)}function eA(n,e,t){for(var r=0;r<t.length;r++)wg(t[r],t[++r],t[++r]);Ze.__c&&Ze.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(s){s.call(i)})}catch(s){Ze.__e(s,i.__v)}})}function tA(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:ud(n)?n.map(tA):Qn({},n)}function RH(n,e,t,r,i,s,o,a,c){var l,u,d,h,f,p,m,x=t.props||Ka,g=e.props,y=e.type;if(y=="svg"?i="http://www.w3.org/2000/svg":y=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((f=s[l])&&"setAttribute"in f==!!y&&(y?f.localName==y:f.nodeType==3)){n=f,s[l]=null;break}}if(n==null){if(y==null)return document.createTextNode(g);n=document.createElementNS(i,y,g.is&&g),a&&(Ze.__m&&Ze.__m(e,s),a=!1),s=null}if(y==null)x===g||a&&n.data==g||(n.data=g);else{if(s=s&&hc.call(n.childNodes),!a&&s!=null)for(x={},l=0;l<n.attributes.length;l++)x[(f=n.attributes[l]).name]=f.value;for(l in x)if(f=x[l],l!="children"){if(l=="dangerouslySetInnerHTML")d=f;else if(!(l in g)){if(l=="value"&&"defaultValue"in g||l=="checked"&&"defaultChecked"in g)continue;al(n,l,null,f,i)}}for(l in g)f=g[l],l=="children"?h=f:l=="dangerouslySetInnerHTML"?u=f:l=="value"?p=f:l=="checked"?m=f:a&&typeof f!="function"||x[l]===f||al(n,l,f,x[l],i);if(u)a||d&&(u.__html==d.__html||u.__html==n.innerHTML)||(n.innerHTML=u.__html),e.__k=[];else if(d&&(n.innerHTML=""),ZN(e.type=="template"?n.content:n,ud(h)?h:[h],e,t,r,y=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:t.__k&&go(t,0),a,c),s!=null)for(l=s.length;l--;)_g(s[l]);a||(l="value",y=="progress"&&p==null?n.removeAttribute("value"):p!=null&&(p!==n[l]||y=="progress"&&!p||y=="option"&&p!=x[l])&&al(n,l,p,x[l],i),l="checked",m!=null&&m!=n[l]&&al(n,l,m,x[l],i))}return n}function wg(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(i){Ze.__e(i,t)}}function nA(n,e,t){var r,i;if(Ze.unmount&&Ze.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||wg(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){Ze.__e(s,e)}r.base=r.__P=null}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&nA(r[i],e,t||typeof n.type!="function");t||_g(n.__e),n.__c=n.__=n.__e=void 0}function MH(n,e,t){return this.constructor(n,t)}function PH(n,e,t){var r,i,s,o;e==document&&(e=document.documentElement),Ze.__&&Ze.__(n,e),i=(r=!1)?null:e.__k,s=[],o=[],Tg(e,n=e.__k=AH(dd,null,[n]),i||Ka,Ka,e.namespaceURI,i?null:e.firstChild?hc.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,o),eA(s,n,o)}function rA(n,e,t){var r,i,s,o,a=Qn({},n.props);for(s in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)s=="key"?r=e[s]:s=="ref"?i=e[s]:a[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?hc.call(arguments,2):t),Ca(n.type,a,r||n.key,i||n.ref,null)}hc=YN.slice,Ze={__e:function(n,e,t,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(n)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),o=i.__d),o)return i.__E=i}catch(a){n=a}throw n}},HN=0,WN=function(n){return n!=null&&n.constructor==null},Pl.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Qn({},this.state),typeof n=="function"&&(n=n(Qn({},t),this.props)),n&&Qn(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),ev(this))},Pl.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),ev(this))},Pl.prototype.render=dd,Ii=[],qN=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,XN=function(n,e){return n.__v.__b-e.__v.__b},bu.__r=0,KN=/(PointerCapture)$|Capture$/i,vg=0,wp=nv(!1),Sp=nv(!0);function rv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function DH(n){if(Array.isArray(n))return n}function BH(n,e,t){return(e=UH(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function FH(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function kH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function LH(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iv(Object(t),!0).forEach(function(r){BH(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):iv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function IH(n,e){return DH(n)||FH(n,e)||VH(n,e)||kH()}function OH(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function UH(n){var e=OH(n,"string");return typeof e=="symbol"?e:e+""}function vu(n){"@babel/helpers - typeof";return vu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vu(n)}function VH(n,e){if(n){if(typeof n=="string")return rv(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?rv(n,e):void 0}}var Ap=function(e){if(vu(e)!=="object")return e;var t=rA(e);if(t.props){var r;t.props=LH({},t.props),t!=null&&(r=t.props)!==null&&r!==void 0&&r.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(Ap):Ap(t.props.children))}return t},GH=function(e){return WN(rA(e))},$H=function(e,t){delete t.__k,PH(Ap(e),t)};function jH(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var zH=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;jH(zH);var HH=ju({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.style,s=i===void 0?{}:i,o=!!e&&vu(e)==="object"&&!!e.node&&typeof e.node=="function",a=gt(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(l){var u=IH(l,2),d=u[0],h=u[1];return t.tooltipEl.style(d,h)}),t.tooltipEl.style("left","-10000px").style("display","none");var c="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(c),function(l){t.mouseInside=!0;var u=Nn(l),d=a.node(),h=d.offsetWidth,f=d.offsetHeight,p=[t.offsetX===null||t.offsetX===void 0?"-".concat(u[0]/h*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?f>130&&f-u[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",u[0]+"px").style("top",u[1]+"px").style("transform","translate(".concat(p.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(c),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(c),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):GH(e.content)?(e.tooltipEl.text(""),$H(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function WH(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var qH=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;WH(qH);function Ep(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function XH(n){if(Array.isArray(n))return n}function KH(n){if(Array.isArray(n))return Ep(n)}function YH(n,e,t){return(e=r7(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function QH(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ZH(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function JH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e7(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t7(n,e){return XH(n)||ZH(n,e)||iA(n,e)||JH()}function Ai(n){return KH(n)||QH(n)||iA(n)||e7()}function n7(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function r7(n){var e=n7(n,"string");return typeof e=="symbol"?e:e+""}function iA(n,e){if(n){if(typeof n=="string")return Ep(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ep(n,e):void 0}}var Ke=window.THREE?window.THREE:{WebGLRenderer:rR,Scene:Ru,PerspectiveCamera:Ba,Raycaster:C_,SRGBColorSpace:Jp,TextureLoader:nR,Vector2:we,Vector3:le,Box3:D_,Color:vn,Mesh:kn,SphereGeometry:Zp,MeshBasicMaterial:Hr,BackSide:Qt,Clock:yT},sA=ju({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(o,a){return e.hoverOrderComparator(o.object,a.object)});var s=i.find(function(o){return e.hoverFilter(o.object)})||null;r=s?s.object:null,e.intersection=s||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&Ae(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,r=t.x,i=t.y;return{x:r,y:i}},cameraPosition:function(e,t,r,i){var s=e.camera;if(t&&e.initialised){var o=t,a=r||{x:0,y:0,z:0};if(!i)u(o),d(a);else{var c=Object.assign({},s.position),l=h();e.tweenGroup.add(new Zb(c).to(o,i).easing(Qi.Quadratic.Out).onUpdate(u).start()),e.tweenGroup.add(new Zb(l).to(a,i/3).easing(Qi.Quadratic.Out).onUpdate(d).start())}return this}return Object.assign({},s.position,{lookAt:h()});function u(f){var p=f.x,m=f.y,x=f.z;p!==void 0&&(s.position.x=p),m!==void 0&&(s.position.y=m),x!==void 0&&(s.position.z=x)}function d(f){var p=new Ke.Vector3(f.x,f.y,f.z);e.controls.enabled&&e.controls.target?e.controls.target=p:s.lookAt(p)}function h(){return Object.assign(new Ke.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new Ke.Vector3(0,0,0),a=Math.max.apply(Math,Ai(Object.entries(t).map(function(f){var p=t7(f,2),m=p[0],x=p[1];return Math.max.apply(Math,Ai(x.map(function(g){return Math.abs(o[m]-g)})))})))*2,c=(1-i*2/e.height)*s.fov,l=a/Math.atan(c*Math.PI/180),u=l/s.aspect,d=Math.max(l,u);if(d>0){var h=o.clone().sub(s.position).normalize().multiplyScalar(-d);this.cameraPosition(h,o,r)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},r=new Ke.Box3(new Ke.Vector3(0,0,0),new Ke.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach(function(s){return r.expandByObject(s)}),Object.assign.apply(Object,Ai(["x","y","z"].map(function(s){return YH({},s,[r.min[s],r.max[s]])})))):null},getScreenCoords:function(e,t,r,i){var s=new Ke.Vector3(t,r,i);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Ke.Vector2(t/e.width*2-1,-(r/e.height)*2+1),o=new Ke.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(i,new Ke.Vector3))},intersectingObjects:function(e,t,r){var i=new Ke.Vector2(t/e.width*2-1,-(r/e.height)*2+1),s=new Ke.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(i,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Ke.Scene,camera:new Ke.PerspectiveCamera,clock:new Ke.Clock,tweenGroup:new jN,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.controlType,s=i===void 0?"trackball":i,o=r.useWebGPU,a=o===void 0?!1:o,c=r.rendererConfig,l=c===void 0?{}:c,u=r.extraRenderers,d=u===void 0?[]:u,h=r.waitForLoadComplete,f=h===void 0?!0:h;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new HH(t.container),t.pointerPos=new Ke.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(p){return t.container.addEventListener(p,function(m){if(p==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&m.type==="pointermove"&&(m.pressure>0||t.isPointerPressed)&&(m.pointerType==="mouse"||m.movementX===void 0||[m.movementX,m.movementY].some(function(y){return Math.abs(y)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var x=g(t.container);t.pointerPos.x=m.pageX-x.left,t.pointerPos.y=m.pageY-x.top}function g(y){var v=y.getBoundingClientRect(),_=window.pageXOffset||document.documentElement.scrollLeft,T=window.pageYOffset||document.documentElement.scrollTop;return{top:v.top+T,left:v.left+_}}},{passive:!0})}),t.container.addEventListener("pointerup",function(p){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){p.button===0&&t.onClick(t.hoverObj||null,p,t.intersection),p.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,p,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(p){t.onRightClick&&p.preventDefault()}),t.renderer=new(a?W6:Ke.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},l)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=d,t.extraRenderers.forEach(function(p){p.domElement.style.position="absolute",p.domElement.style.top="0px",p.domElement.style.pointerEvents="none",t.container.appendChild(p.domElement)}),t.postProcessingComposer=new U9(t.renderer),t.postProcessingComposer.addPass(new V9(t.scene,t.camera)),t.controls=new{trackball:X6,orbit:u9,fly:S9}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Ai(t.extraRenderers)).forEach(function(p){return p.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Ke.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!f,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,i=e.width,s=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(Ai(e.extraRenderers)).forEach(function(f){return f.setSize(i,s)}),e.camera.aspect=i/s;var o=e.viewOffset.slice(0,2);o.some(function(f){return f})&&(r=e.camera).setViewOffset.apply(r,[i,s].concat(Ai(o),[i,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var a,c=e.width,l=e.height,u=e.viewOffset.slice(0,2);u.some(function(f){return f})?(a=e.camera).setViewOffset.apply(a,[c,l].concat(Ai(u),[c,l])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Ke.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var d=mo(e.backgroundColor).alpha;d===void 0&&(d=1),e.renderer.setClearColor(new Ke.Color(xH(1,e.backgroundColor)),d)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Ke.TextureLoader().load(e.backgroundImageUrl,function(f){f.colorSpace=Ke.SRGBColorSpace,e.skysphere.material=new Ke.MeshBasicMaterial({map:f,side:Ke.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&h()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&h())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(f){return e.scene.remove(f)}),e.lights.forEach(function(f){return e.scene.add(f)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(f){return e.scene.remove(f)}),e.objects.forEach(function(f){return e.scene.add(f)}));function h(){e.loadComplete=e.scene.visible=!0}}});function i7(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var s7=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;i7(s7);function Cp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function o7(n){if(Array.isArray(n))return Cp(n)}function fc(n,e,t){return(e=u7(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function a7(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function c7(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function cl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sv(Object(t),!0).forEach(function(r){fc(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):sv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function hd(n){return o7(n)||a7(n)||d7(n)||c7()}function l7(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function u7(n){var e=l7(n,"string");return typeof e=="symbol"?e:e+""}function d7(n,e){if(n){if(typeof n=="string")return Cp(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Cp(n,e):void 0}}function oA(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),l=1;l<a;l++)c[l-1]=arguments[l];var u=o[i].apply(o,c);return u===o?this:u}}}}var kh=window.THREE?window.THREE:{AmbientLight:k_,DirectionalLight:F_,REVISION:Mu},h7=170,aA=oA("forceGraph",I1),f7=Object.assign.apply(Object,hd(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return fc({},n,aA.linkProp(n))}))),p7=Object.assign.apply(Object,hd(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return fc({},n,aA.linkMethod(n))}))),Dl=oA("renderObjs",sA),m7=Object.assign.apply(Object,hd(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return fc({},n,Dl.linkProp(n))}))),g7=Object.assign.apply(Object,hd(["lights","cameraPosition","postProcessingComposer"].map(function(n){return fc({},n,Dl.linkMethod(n))})).concat([{graph2ScreenCoords:Dl.linkMethod("getScreenCoords"),screen2GraphCoords:Dl.linkMethod("getSceneCoords")}])),x7=ju({props:cl(cl({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var r=t.renderObjs.controls();r&&(r.enabled=e,e&&r.domElement&&r.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},showPointerCursor:{default:!0,triggerUpdate:!1}},f7),m7),methods:cl(cl({zoomToFit:function(e,t,r){for(var i,s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];return e.renderObjs.fitToBbox((i=e.forceGraph).getGraphBbox.apply(i,o),t,r),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},p7),g7),stateInit:function(e){var t=e.controlType,r=e.rendererConfig,i=e.extraRenderers,s=new I1;return{forceGraph:s,renderObjs:sA({controlType:t,rendererConfig:r,extraRenderers:i}).objects([s]).lights([new kh.AmbientLight(13421772,Math.PI),new kh.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var r=document.createElement("div");t.container.appendChild(r),t.renderObjs(r);var i=t.renderObjs.camera(),s=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=i.position.z;var a;t.container.appendChild(a=document.createElement("div")),a.className="graph-info-msg",a.textContent="",t.forceGraph.onLoading(function(){a.textContent="Loading..."}).onFinishLoading(function(){a.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),i.position.x===0&&i.position.y===0&&i.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(i.lookAt(t.forceGraph.position),t.lastSetCameraZ=i.position.z=Math.cbrt(t.graphData.nodes.length)*h7)}).onFinishUpdate(function(){if(t._dragControls){var c=t.graphData.nodes.find(function(u){return u.__initialFixedPos&&!u.__disposeControlsAfterDrag});c?c.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var l=t._dragControls=new fk(t.graphData.nodes.map(function(u){return u.__threeObj}).filter(function(u){return u}),i,s.domElement);l.addEventListener("dragstart",function(u){var d=gr(u.object);if(d){o.enabled=!1,u.object.__initialPos=u.object.position.clone(),u.object.__prevPos=u.object.position.clone();var h=d.__data;!h.__initialFixedPos&&(h.__initialFixedPos={fx:h.fx,fy:h.fy,fz:h.fz}),!h.__initialPos&&(h.__initialPos={x:h.x,y:h.y,z:h.z}),["x","y","z"].forEach(function(f){return h["f".concat(f)]=h[f]}),s.domElement.classList.add("grabbable")}}),l.addEventListener("drag",function(u){var d=gr(u.object);if(d){if(!u.object.hasOwnProperty("__graphObjType")){var h=u.object.__initialPos,f=u.object.__prevPos,p=u.object.position;d.position.add(p.clone().sub(f)),f.copy(p),p.copy(h)}var m=d.__data,x=d.position,g={x:x.x-m.x,y:x.y-m.y,z:x.z-m.z};["x","y","z"].forEach(function(y){return m["f".concat(y)]=m[y]=x[y]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),m.__dragged=!0,t.onNodeDrag(m,g)}}),l.addEventListener("dragend",function(u){var d=gr(u.object);if(d){delete u.object.__initialPos,delete u.object.__prevPos;var h=d.__data;h.__disposeControlsAfterDrag&&(l.dispose(),delete h.__disposeControlsAfterDrag);var f=h.__initialFixedPos,p=h.__initialPos,m={x:p.x-h.x,y:p.y-h.y,z:p.z-h.z};if(f&&(["x","y","z"].forEach(function(g){var y="f".concat(g);f[y]===void 0&&delete h[y]}),delete h.__initialFixedPos,delete h.__initialPos,h.__dragged&&(delete h.__dragged,t.onNodeDragEnd(h,m))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls){var x;o.enabled=!0,o._status&&((x=o._onPointerCancel)===null||x===void 0||x.call(o)),o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))}s.domElement.classList.remove("grabbable")}})}}),kh.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(c,l){var u=gr(c);if(!u)return 1;var d=gr(l);if(!d)return-1;var h=function(p){return p.__graphObjType==="node"};return h(d)-h(u)}).tooltipContent(function(c){var l=gr(c);return l&&Ae(t["".concat(l.__graphObjType,"Label")])(l.__data)||""}).hoverDuringDrag(!1).onHover(function(c){var l=gr(c);if(l!==t.hoverObj){var u=t.hoverObj?t.hoverObj.__graphObjType:null,d=t.hoverObj?t.hoverObj.__data:null,h=l?l.__graphObjType:null,f=l?l.__data:null;if(u&&u!==h){var p=t["on".concat(u==="node"?"Node":"Link","Hover")];p&&p(null,d)}if(h){var m=t["on".concat(h==="node"?"Node":"Link","Hover")];m&&m(f,u===h?d:null)}s.domElement.classList[(l&&t["on".concat(h==="node"?"Node":"Link","Click")]||!l&&t.onBackgroundClick)&&Ae(t.showPointerCursor)(f)?"add":"remove"]("clickable"),t.hoverObj=l}}).clickAfterDrag(!1).onClick(function(c,l){var u=gr(c);if(u){var d=t["on".concat(u.__graphObjType==="node"?"Node":"Link","Click")];d&&d(u.__data,l)}else t.onBackgroundClick&&t.onBackgroundClick(l)}).onRightClick(function(c,l){var u=gr(c);if(u){var d=t["on".concat(u.__graphObjType==="node"?"Node":"Link","RightClick")];d&&d(u.__data,l)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(l)}),this._animationCycle()}});function gr(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var Lh={exports:{}},Ih,ov;function y7(){if(ov)return Ih;ov=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Ih=n,Ih}var Oh,av;function b7(){if(av)return Oh;av=1;var n=y7();function e(){}function t(){}return t.resetWarningCache=e,Oh=function(){function r(o,a,c,l,u,d){if(d!==n){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},Oh}var cv;function v7(){return cv||(cv=1,Lh.exports=b7()()),Lh.exports}var _7=v7();const F=E_(_7),fd={width:F.number,height:F.number,graphData:F.shape({nodes:F.arrayOf(F.object).isRequired,links:F.arrayOf(F.object).isRequired}),backgroundColor:F.string,nodeRelSize:F.number,nodeId:F.string,nodeLabel:F.oneOfType([F.string,F.func]),nodeVal:F.oneOfType([F.number,F.string,F.func]),nodeVisibility:F.oneOfType([F.bool,F.string,F.func]),nodeColor:F.oneOfType([F.string,F.func]),nodeAutoColorBy:F.oneOfType([F.string,F.func]),onNodeHover:F.func,onNodeClick:F.func,linkSource:F.string,linkTarget:F.string,linkLabel:F.oneOfType([F.string,F.func]),linkVisibility:F.oneOfType([F.bool,F.string,F.func]),linkColor:F.oneOfType([F.string,F.func]),linkAutoColorBy:F.oneOfType([F.string,F.func]),linkWidth:F.oneOfType([F.number,F.string,F.func]),linkCurvature:F.oneOfType([F.number,F.string,F.func]),linkDirectionalArrowLength:F.oneOfType([F.number,F.string,F.func]),linkDirectionalArrowColor:F.oneOfType([F.string,F.func]),linkDirectionalArrowRelPos:F.oneOfType([F.number,F.string,F.func]),linkDirectionalParticles:F.oneOfType([F.number,F.string,F.func]),linkDirectionalParticleSpeed:F.oneOfType([F.number,F.string,F.func]),linkDirectionalParticleOffset:F.oneOfType([F.number,F.string,F.func]),linkDirectionalParticleWidth:F.oneOfType([F.number,F.string,F.func]),linkDirectionalParticleColor:F.oneOfType([F.string,F.func]),onLinkHover:F.func,onLinkClick:F.func,dagMode:F.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:F.number,dagNodeFilter:F.func,onDagError:F.func,d3AlphaMin:F.number,d3AlphaDecay:F.number,d3VelocityDecay:F.number,warmupTicks:F.number,cooldownTicks:F.number,cooldownTime:F.number,onEngineTick:F.func,onEngineStop:F.func,getGraphBbox:F.func},cA={zoomToFit:F.func,onNodeRightClick:F.func,onNodeDrag:F.func,onNodeDragEnd:F.func,onLinkRightClick:F.func,linkHoverPrecision:F.number,onBackgroundClick:F.func,onBackgroundRightClick:F.func,showPointerCursor:F.oneOfType([F.bool,F.func]),enablePointerInteraction:F.bool,enableNodeDrag:F.bool},Sg={showNavInfo:F.bool,nodeOpacity:F.number,nodeResolution:F.number,nodeThreeObject:F.oneOfType([F.object,F.string,F.func]),nodeThreeObjectExtend:F.oneOfType([F.bool,F.string,F.func]),nodePositionUpdate:F.func,linkOpacity:F.number,linkResolution:F.number,linkCurveRotation:F.oneOfType([F.number,F.string,F.func]),linkMaterial:F.oneOfType([F.object,F.string,F.func]),linkThreeObject:F.oneOfType([F.object,F.string,F.func]),linkThreeObjectExtend:F.oneOfType([F.bool,F.string,F.func]),linkPositionUpdate:F.func,linkDirectionalArrowResolution:F.number,linkDirectionalParticleResolution:F.number,linkDirectionalParticleThreeObject:F.oneOfType([F.object,F.string,F.func]),forceEngine:F.oneOf(["d3","ngraph"]),ngraphPhysics:F.object,numDimensions:F.oneOf([1,2,3])};Object.assign({},fd,cA,{linkLineDash:F.oneOfType([F.arrayOf(F.number),F.string,F.func]),nodeCanvasObjectMode:F.oneOfType([F.string,F.func]),nodeCanvasObject:F.func,nodePointerAreaPaint:F.func,linkCanvasObjectMode:F.oneOfType([F.string,F.func]),linkCanvasObject:F.func,linkPointerAreaPaint:F.func,linkDirectionalParticleCanvasObject:F.func,autoPauseRedraw:F.bool,minZoom:F.number,maxZoom:F.number,enableZoomInteraction:F.oneOfType([F.bool,F.func]),enablePanInteraction:F.oneOfType([F.bool,F.func]),onZoom:F.func,onZoomEnd:F.func,onRenderFramePre:F.func,onRenderFramePost:F.func});const T7=Object.assign({},fd,cA,Sg,{enableNavigationControls:F.bool,controlType:F.oneOf(["trackball","orbit","fly"]),rendererConfig:F.object,extraRenderers:F.arrayOf(F.shape({render:F.func.isRequired}))});Object.assign({},fd,Sg,{nodeDesc:F.oneOfType([F.string,F.func]),linkDesc:F.oneOfType([F.string,F.func])});Object.assign({},fd,Sg,{markerAttrs:F.object,yOffset:F.number,glScale:F.number});const Ng=hk(x7,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});Ng.displayName="ForceGraph3D";Ng.propTypes=T7;const w7=()=>{const[n,e]=E.useState({nodes:[],links:[]}),[t,r]=E.useState(!1),i=E.useRef(),s=E.useRef(0);E.useEffect(()=>{const a=async()=>{try{const u=await(await fetch("/api/galaxy")).json();u.simulation&&r(!0),u&&u.nodes&&e(u)}catch(l){console.error("Failed to fetch galaxy data:",l)}};a();const c=setInterval(a,1e4);return()=>clearInterval(c)},[]),E.useEffect(()=>{const a=()=>{if(i.current){s.current+=.003;const c=s.current,l=800;i.current.cameraPosition({x:l*Math.sin(c),z:l*Math.cos(c)})}requestAnimationFrame(a)};a()},[]);const o=a=>{switch(a.group){case"start":return"#ef4444";case"core":return"#ffffff";case"sector":return"#f59e0b";case"agent":return"#00f3ff";case"knowledge":return"#a855f7";default:return"#64748b"}};return b.jsxs("div",{className:"w-full h-full relative bg-black/50 rounded overflow-hidden cursor-move",children:[b.jsxs("div",{className:"absolute top-4 left-4 z-10 pointer-events-none w-full pr-8",children:[b.jsxs("div",{className:"flex justify-between items-start",children:[b.jsxs("div",{className:"flex flex-col gap-1",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(si,{size:20,className:"text-[var(--hud-accent)] animate-pulse"}),b.jsx("h2",{className:"text-xl font-bold text-white tracking-widest uppercase font-mono",children:"Neural Ops Center"})]}),b.jsx("span",{className:"text-xs text-[var(--hud-text-dim)] font-mono",children:"LIVE SYSTEM TELEMETRY"})]}),b.jsxs("div",{className:"flex gap-8 bg-black/40 backdrop-blur-md p-4 rounded-lg border border-white/10",children:[b.jsxs("div",{className:"flex flex-col items-center",children:[b.jsx("span",{className:"text-2xl font-bold text-[#00f3ff] text-shadow-neon",children:n.stats?.cache_efficiency||"--%"}),b.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"CACHE EFFICIENCY"})]}),b.jsxs("div",{className:"flex flex-col items-center border-l border-white/10 pl-8",children:[b.jsx("span",{className:"text-2xl font-bold text-[#a855f7]",children:n.stats?.total_memories||0}),b.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"ACTIVE NODES"})]}),b.jsxs("div",{className:"flex flex-col items-center border-l border-white/10 pl-8",children:[b.jsx("span",{className:"text-2xl font-bold text-[#f59e0b]",children:n.stats?.active_agents||0}),b.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"AGENTS ONLINE"})]})]})]}),t&&b.jsxs("div",{className:"inline-flex items-center gap-2 bg-[rgba(255,165,0,0.1)] border border-orange-500/50 px-2 py-1 rounded mt-2",children:[b.jsx(wT,{size:12,className:"text-orange-500 animate-pulse"}),b.jsx("span",{className:"text-[10px] text-orange-400 font-mono",children:"SIMULATION MODE"})]})]}),n.nodes.length===0&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:b.jsx("span",{className:"text-[var(--hud-text-dim)] font-mono animate-pulse",children:"ESTABLISHING UPLINK..."})}),n.nodes.length>0&&b.jsx(Ng,{ref:i,graphData:n,nodeLabel:"name",nodeColor:o,nodeVal:a=>a.val||5,nodeResolution:16,linkColor:()=>"rgba(0, 243, 255, 0.15)",linkWidth:1,linkDirectionalParticles:2,linkDirectionalParticleSpeed:.005,linkDirectionalParticleWidth:2,linkDirectionalParticleColor:()=>"#00f3ff",backgroundColor:"rgba(0,0,0,0)",showNavInfo:!1,bloomStrength:1.5,enableNodeDrag:!1,onNodeClick:a=>{const l=1+100/Math.hypot(a.x,a.y,a.z);i.current&&i.current.cameraPosition({x:a.x*l,y:a.y*l,z:a.z*l},a,3e3)}}),b.jsx("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none bg-black/60 backdrop-blur p-2 rounded border border-white/10",children:b.jsxs("div",{className:"flex flex-col gap-1 text-[10px] font-mono text-[var(--hud-text-dim)]",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00f3ff] shadow-[0_0_5px_#00f3ff]"})," AGENT NODE"]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"w-2 h-2 rounded-full bg-[#a855f7] shadow-[0_0_5px_#a855f7]"})," KNOWLEDGE"]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"w-2 h-2 rounded-full bg-[#f59e0b] shadow-[0_0_5px_#f59e0b]"})," SECTOR HUB"]})]})})]})},lA=E.createContext(null),S7=({children:n})=>{const[e,t]=E.useState(null),[r,i]=E.useState(null),[s,o]=E.useState(!0);E.useEffect(()=>{const l=localStorage.getItem("agentcache_token"),u=localStorage.getItem("agentcache_user");l&&u&&(i(l),t(JSON.parse(u))),o(!1)},[]);const a=async l=>{try{const u=await fetch("/api/auth/dev-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l})});if(!u.ok)throw new Error("Login failed");const d=await u.json();return i(d.token),t(d.user),localStorage.setItem("agentcache_token",d.token),localStorage.setItem("agentcache_user",JSON.stringify(d.user)),!0}catch(u){return console.error(u),!1}},c=()=>{i(null),t(null),localStorage.removeItem("agentcache_token"),localStorage.removeItem("agentcache_user")};return b.jsx(lA.Provider,{value:{user:e,token:r,login:a,logout:c,loading:s},children:n})},Co=()=>E.useContext(lA);function N7(){const{token:n}=Co(),[e,t]=E.useState([]),[r,i]=E.useState([]),[s,o]=E.useState(null);return E.useEffect(()=>{if(!n)return;const a=async()=>{try{const h=await(await fetch("/api/admin-stats",{headers:{Authorization:`Bearer ${n}`}})).json();if(h&&h.top_users){const f=h.top_users.map((p,m)=>({rank:m+1,name:p.email.split("@")[0]||"Unknown Agent",score:p.requests,sector:"General"}));t(f)}else t([{rank:1,name:"System-Prime",score:1e3,sector:"Core"}])}catch(d){console.error("Failed to fetch leaderboard:",d)}};a();const c=setInterval(a,6e4),l=new EventSource("/api/events/stream");l.onmessage=d=>{const h=JSON.parse(d.data);if(h.type!=="sys:connected"&&(h.type==="CACHE_HIT"||h.type==="OPTIMIZATION"||Math.random()>.7)){const f={id:Date.now(),agent:h.agentId||"Swarm-Node",pattern:h.type==="CACHE_HIT"?"Pattern Match":"Optimization Found",improvement:Math.floor(Math.random()*20)+5,time:new Date().toLocaleTimeString()};i(p=>[f,...p].slice(0,8))}},o({status:"Running Experiment #8492",progress:45,target:"Global Latency Optimization"});const u=setInterval(()=>{o(d=>({...d,progress:d.progress>=100?0:d.progress+1}))},1e3);return()=>{clearInterval(c),clearInterval(u),l.close()}},[]),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-8rem)]",children:[b.jsx("div",{className:"space-y-6",children:b.jsx(He,{title:"Live Discoveries",icon:wT,className:"h-full flex flex-col",children:b.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-3 custom-scrollbar",children:[r.map(a=>b.jsxs("div",{className:"p-3 rounded bg-[rgba(255,255,255,0.03)] border-l-2 border-[var(--hud-accent)] animate-in slide-in-from-left duration-300",children:[b.jsxs("div",{className:"flex justify-between items-start mb-1",children:[b.jsx("span",{className:"text-sm font-bold text-white",children:a.agent}),b.jsx("span",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:a.time})]}),b.jsxs("div",{className:"text-xs text-[var(--hud-text-dim)] mb-2",children:["Found: ",b.jsx("span",{className:"text-white",children:a.pattern})]}),b.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono text-[var(--hud-success)]",children:[b.jsx(pm,{size:12}),b.jsxs("span",{children:["+",a.improvement,"% Efficiency"]})]})]},a.id)),r.length===0&&b.jsx("div",{className:"text-center text-[var(--hud-text-dim)] py-8 italic",children:"Listening for swarm signals..."})]})})}),b.jsx("div",{className:"lg:col-span-1 flex flex-col gap-6 relative",children:b.jsxs(He,{className:"flex-1 relative overflow-hidden p-0 border-[var(--hud-accent)] shadow-[0_0_30px_rgba(0,243,255,0.1)]",children:[b.jsx(w7,{}),b.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-[rgba(0,0,0,0.8)] backdrop-blur p-4 border-t border-[var(--hud-border)] pointer-events-none",children:[b.jsxs("div",{className:"flex justify-between items-center mb-2",children:[b.jsx("span",{className:"text-xs font-bold text-[var(--hud-text-dim)]",children:"ACTIVE EXPERIMENT"}),b.jsx("span",{className:"text-xs font-mono text-[var(--hud-accent)] animate-pulse",children:"RUNNING"})]}),b.jsx("div",{className:"text-sm font-medium text-white mb-3",children:s?.target}),b.jsx("div",{className:"h-1 bg-[rgba(255,255,255,0.1)] rounded-full overflow-hidden",children:b.jsx("div",{className:"h-full bg-[var(--hud-accent)] transition-all duration-300",style:{width:`${s?.progress}%`}})})]})]})}),b.jsx("div",{className:"space-y-6",children:b.jsx(He,{title:"Top Agents",icon:WR,className:"h-full",children:b.jsx(Wl,{columns:[{header:"Rank",accessor:"rank",render:a=>b.jsxs("span",{className:"font-mono text-[var(--hud-accent)]",children:["#",a.rank]})},{header:"Agent Name",accessor:"name",render:a=>b.jsx("span",{className:"font-bold text-white",children:a.name})},{header:"Score",accessor:"score",render:a=>b.jsx("span",{className:"font-mono text-[var(--hud-warning)]",children:a.score})}],data:e})})})]})}const Ag=E.createContext({});function Eg(n){const e=E.useRef(null);return e.current===null&&(e.current=n()),e.current}const Cg=typeof window<"u",uA=Cg?E.useLayoutEffect:E.useEffect,pd=E.createContext(null);function Rg(n,e){n.indexOf(e)===-1&&n.push(e)}function Mg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const kr=(n,e,t)=>t>e?e:t<n?n:t;let Pg=()=>{};const Lr={},dA=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function hA(n){return typeof n=="object"&&n!==null}const fA=n=>/^0[^.\s]+$/u.test(n);function Dg(n){let e;return()=>(e===void 0&&(e=n()),e)}const xn=n=>n,A7=(n,e)=>t=>e(n(t)),pc=(...n)=>n.reduce(A7),Ya=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class Bg{constructor(){this.subscriptions=[]}add(e){return Rg(this.subscriptions,e),()=>Mg(this.subscriptions,e)}notify(e,t,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,r);else for(let s=0;s<i;s++){const o=this.subscriptions[s];o&&o(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const tr=n=>n*1e3,mn=n=>n/1e3;function pA(n,e){return e?n*(1e3/e):0}const mA=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,E7=1e-7,C7=12;function R7(n,e,t,r,i){let s,o,a=0;do o=e+(t-e)/2,s=mA(o,r,i)-n,s>0?t=o:e=o;while(Math.abs(s)>E7&&++a<C7);return o}function mc(n,e,t,r){if(n===e&&t===r)return xn;const i=s=>R7(s,0,1,n,t);return s=>s===0||s===1?s:mA(i(s),e,r)}const gA=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,xA=n=>e=>1-n(1-e),yA=mc(.33,1.53,.69,.99),Fg=xA(yA),bA=gA(Fg),vA=n=>(n*=2)<1?.5*Fg(n):.5*(2-Math.pow(2,-10*(n-1))),kg=n=>1-Math.sin(Math.acos(n)),_A=xA(kg),TA=gA(kg),M7=mc(.42,0,1,1),P7=mc(0,0,.58,1),wA=mc(.42,0,.58,1),D7=n=>Array.isArray(n)&&typeof n[0]!="number",SA=n=>Array.isArray(n)&&typeof n[0]=="number",B7={linear:xn,easeIn:M7,easeInOut:wA,easeOut:P7,circIn:kg,circInOut:TA,circOut:_A,backIn:Fg,backInOut:bA,backOut:yA,anticipate:vA},F7=n=>typeof n=="string",lv=n=>{if(SA(n)){Pg(n.length===4);const[e,t,r,i]=n;return mc(e,t,r,i)}else if(F7(n))return B7[n];return n},ll=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function k7(n,e){let t=new Set,r=new Set,i=!1,s=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(l.schedule(u),n()),u(a)}const l={schedule:(u,d=!1,h=!1)=>{const p=h&&i?t:r;return d&&o.add(u),p.has(u)||p.add(u),u},cancel:u=>{r.delete(u),o.delete(u)},process:u=>{if(a=u,i){s=!0;return}i=!0,[t,r]=[r,t],t.forEach(c),t.clear(),i=!1,s&&(s=!1,l.process(u))}};return l}const L7=40;function NA(n,e){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},s=()=>t=!0,o=ll.reduce((v,_)=>(v[_]=k7(s),v),{}),{setup:a,read:c,resolveKeyframes:l,preUpdate:u,update:d,preRender:h,render:f,postRender:p}=o,m=()=>{const v=Lr.useManualTiming?i.timestamp:performance.now();t=!1,Lr.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(v-i.timestamp,L7),1)),i.timestamp=v,i.isProcessing=!0,a.process(i),c.process(i),l.process(i),u.process(i),d.process(i),h.process(i),f.process(i),p.process(i),i.isProcessing=!1,t&&e&&(r=!1,n(m))},x=()=>{t=!0,r=!0,i.isProcessing||n(m)};return{schedule:ll.reduce((v,_)=>{const T=o[_];return v[_]=(w,N=!1,S=!1)=>(t||x(),T.schedule(w,N,S)),v},{}),cancel:v=>{for(let _=0;_<ll.length;_++)o[ll[_]].cancel(v)},state:i,steps:o}}const{schedule:Je,cancel:ci,state:Et,steps:Uh}=NA(typeof requestAnimationFrame<"u"?requestAnimationFrame:xn,!0);let Bl;function I7(){Bl=void 0}const Yt={now:()=>(Bl===void 0&&Yt.set(Et.isProcessing||Lr.useManualTiming?Et.timestamp:performance.now()),Bl),set:n=>{Bl=n,queueMicrotask(I7)}},AA=n=>e=>typeof e=="string"&&e.startsWith(n),Lg=AA("--"),O7=AA("var(--"),Ig=n=>O7(n)?U7.test(n.split("/*")[0].trim()):!1,U7=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Ro={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Qa={...Ro,transform:n=>kr(0,1,n)},ul={...Ro,default:1},Ra=n=>Math.round(n*1e5)/1e5,Og=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function V7(n){return n==null}const G7=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ug=(n,e)=>t=>!!(typeof t=="string"&&G7.test(t)&&t.startsWith(n)||e&&!V7(t)&&Object.prototype.hasOwnProperty.call(t,e)),EA=(n,e,t)=>r=>{if(typeof r!="string")return r;const[i,s,o,a]=r.match(Og);return{[n]:parseFloat(i),[e]:parseFloat(s),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},$7=n=>kr(0,255,n),Vh={...Ro,transform:n=>Math.round($7(n))},$i={test:Ug("rgb","red"),parse:EA("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+Vh.transform(n)+", "+Vh.transform(e)+", "+Vh.transform(t)+", "+Ra(Qa.transform(r))+")"};function j7(n){let e="",t="",r="",i="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),i=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),i=n.substring(4,5),e+=e,t+=t,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const Rp={test:Ug("#"),parse:j7,transform:$i.transform},gc=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),$r=gc("deg"),nr=gc("%"),xe=gc("px"),z7=gc("vh"),H7=gc("vw"),uv={...nr,parse:n=>nr.parse(n)/100,transform:n=>nr.transform(n*100)},Ls={test:Ug("hsl","hue"),parse:EA("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+nr.transform(Ra(e))+", "+nr.transform(Ra(t))+", "+Ra(Qa.transform(r))+")"},dt={test:n=>$i.test(n)||Rp.test(n)||Ls.test(n),parse:n=>$i.test(n)?$i.parse(n):Ls.test(n)?Ls.parse(n):Rp.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?$i.transform(n):Ls.transform(n),getAnimatableNone:n=>{const e=dt.parse(n);return e.alpha=0,dt.transform(e)}},W7=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function q7(n){return isNaN(n)&&typeof n=="string"&&(n.match(Og)?.length||0)+(n.match(W7)?.length||0)>0}const CA="number",RA="color",X7="var",K7="var(",dv="${}",Y7=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Za(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},i=[];let s=0;const a=e.replace(Y7,c=>(dt.test(c)?(r.color.push(s),i.push(RA),t.push(dt.parse(c))):c.startsWith(K7)?(r.var.push(s),i.push(X7),t.push(c)):(r.number.push(s),i.push(CA),t.push(parseFloat(c))),++s,dv)).split(dv);return{values:t,split:a,indexes:r,types:i}}function MA(n){return Za(n).values}function PA(n){const{split:e,types:t}=Za(n),r=e.length;return i=>{let s="";for(let o=0;o<r;o++)if(s+=e[o],i[o]!==void 0){const a=t[o];a===CA?s+=Ra(i[o]):a===RA?s+=dt.transform(i[o]):s+=i[o]}return s}}const Q7=n=>typeof n=="number"?0:dt.test(n)?dt.getAnimatableNone(n):n;function Z7(n){const e=MA(n);return PA(n)(e.map(Q7))}const li={test:q7,parse:MA,createTransformer:PA,getAnimatableNone:Z7};function Gh(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function J7({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let i=0,s=0,o=0;if(!e)i=s=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,c=2*t-a;i=Gh(c,a,n+1/3),s=Gh(c,a,n),o=Gh(c,a,n-1/3)}return{red:Math.round(i*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:r}}function _u(n,e){return t=>t>0?e:n}const rt=(n,e,t)=>n+(e-n)*t,$h=(n,e,t)=>{const r=n*n,i=t*(e*e-r)+r;return i<0?0:Math.sqrt(i)},eW=[Rp,$i,Ls],tW=n=>eW.find(e=>e.test(n));function hv(n){const e=tW(n);if(!e)return!1;let t=e.parse(n);return e===Ls&&(t=J7(t)),t}const fv=(n,e)=>{const t=hv(n),r=hv(e);if(!t||!r)return _u(n,e);const i={...t};return s=>(i.red=$h(t.red,r.red,s),i.green=$h(t.green,r.green,s),i.blue=$h(t.blue,r.blue,s),i.alpha=rt(t.alpha,r.alpha,s),$i.transform(i))},Mp=new Set(["none","hidden"]);function nW(n,e){return Mp.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function rW(n,e){return t=>rt(n,e,t)}function Vg(n){return typeof n=="number"?rW:typeof n=="string"?Ig(n)?_u:dt.test(n)?fv:oW:Array.isArray(n)?DA:typeof n=="object"?dt.test(n)?fv:iW:_u}function DA(n,e){const t=[...n],r=t.length,i=n.map((s,o)=>Vg(s)(s,e[o]));return s=>{for(let o=0;o<r;o++)t[o]=i[o](s);return t}}function iW(n,e){const t={...n,...e},r={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(r[i]=Vg(n[i])(n[i],e[i]));return i=>{for(const s in r)t[s]=r[s](i);return t}}function sW(n,e){const t=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const s=e.types[i],o=n.indexes[s][r[s]],a=n.values[o]??0;t[i]=a,r[s]++}return t}const oW=(n,e)=>{const t=li.createTransformer(e),r=Za(n),i=Za(e);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?Mp.has(n)&&!i.values.length||Mp.has(e)&&!r.values.length?nW(n,e):pc(DA(sW(r,i),i.values),t):_u(n,e)};function BA(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?rt(n,e,t):Vg(n)(n,e)}const aW=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>Je.update(e,t),stop:()=>ci(e),now:()=>Et.isProcessing?Et.timestamp:Yt.now()}},FA=(n,e,t=10)=>{let r="";const i=Math.max(Math.round(e/t),2);for(let s=0;s<i;s++)r+=Math.round(n(s/(i-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},Tu=2e4;function Gg(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<Tu;)e+=t,r=n.next(e);return e>=Tu?1/0:e}function cW(n,e=100,t){const r=t({...n,keyframes:[0,e]}),i=Math.min(Gg(r),Tu);return{type:"keyframes",ease:s=>r.next(i*s).value/e,duration:mn(i)}}const lW=5;function kA(n,e,t){const r=Math.max(e-lW,0);return pA(t-n(r),e-r)}const ot={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},jh=.001;function uW({duration:n=ot.duration,bounce:e=ot.bounce,velocity:t=ot.velocity,mass:r=ot.mass}){let i,s,o=1-e;o=kr(ot.minDamping,ot.maxDamping,o),n=kr(ot.minDuration,ot.maxDuration,mn(n)),o<1?(i=l=>{const u=l*o,d=u*n,h=u-t,f=Pp(l,o),p=Math.exp(-d);return jh-h/f*p},s=l=>{const d=l*o*n,h=d*t+t,f=Math.pow(o,2)*Math.pow(l,2)*n,p=Math.exp(-d),m=Pp(Math.pow(l,2),o);return(-i(l)+jh>0?-1:1)*((h-f)*p)/m}):(i=l=>{const u=Math.exp(-l*n),d=(l-t)*n+1;return-jh+u*d},s=l=>{const u=Math.exp(-l*n),d=(t-l)*(n*n);return u*d});const a=5/n,c=hW(i,s,a);if(n=tr(n),isNaN(c))return{stiffness:ot.stiffness,damping:ot.damping,duration:n};{const l=Math.pow(c,2)*r;return{stiffness:l,damping:o*2*Math.sqrt(r*l),duration:n}}}const dW=12;function hW(n,e,t){let r=t;for(let i=1;i<dW;i++)r=r-n(r)/e(r);return r}function Pp(n,e){return n*Math.sqrt(1-e*e)}const fW=["duration","bounce"],pW=["stiffness","damping","mass"];function pv(n,e){return e.some(t=>n[t]!==void 0)}function mW(n){let e={velocity:ot.velocity,stiffness:ot.stiffness,damping:ot.damping,mass:ot.mass,isResolvedFromDuration:!1,...n};if(!pv(n,pW)&&pv(n,fW))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),i=r*r,s=2*kr(.05,1,1-(n.bounce||0))*Math.sqrt(i);e={...e,mass:ot.mass,stiffness:i,damping:s}}else{const t=uW(n);e={...e,...t,mass:ot.mass},e.isResolvedFromDuration=!0}return e}function wu(n=ot.visualDuration,e=ot.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:i}=t;const s=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:s},{stiffness:c,damping:l,mass:u,duration:d,velocity:h,isResolvedFromDuration:f}=mW({...t,velocity:-mn(t.velocity||0)}),p=h||0,m=l/(2*Math.sqrt(c*u)),x=o-s,g=mn(Math.sqrt(c/u)),y=Math.abs(x)<5;r||(r=y?ot.restSpeed.granular:ot.restSpeed.default),i||(i=y?ot.restDelta.granular:ot.restDelta.default);let v;if(m<1){const T=Pp(g,m);v=w=>{const N=Math.exp(-m*g*w);return o-N*((p+m*g*x)/T*Math.sin(T*w)+x*Math.cos(T*w))}}else if(m===1)v=T=>o-Math.exp(-g*T)*(x+(p+g*x)*T);else{const T=g*Math.sqrt(m*m-1);v=w=>{const N=Math.exp(-m*g*w),S=Math.min(T*w,300);return o-N*((p+m*g*x)*Math.sinh(S)+T*x*Math.cosh(S))/T}}const _={calculatedDuration:f&&d||null,next:T=>{const w=v(T);if(f)a.done=T>=d;else{let N=T===0?p:0;m<1&&(N=T===0?tr(p):kA(v,T,w));const S=Math.abs(N)<=r,C=Math.abs(o-w)<=i;a.done=S&&C}return a.value=a.done?o:w,a},toString:()=>{const T=Math.min(Gg(_),Tu),w=FA(N=>_.next(T*N).value,T,30);return T+"ms "+w},toTransition:()=>{}};return _}wu.applyToOptions=n=>{const e=cW(n,100,wu);return n.ease=e.ease,n.duration=tr(e.duration),n.type="keyframes",n};function Dp({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:c,restDelta:l=.5,restSpeed:u}){const d=n[0],h={done:!1,value:d},f=S=>a!==void 0&&S<a||c!==void 0&&S>c,p=S=>a===void 0?c:c===void 0||Math.abs(a-S)<Math.abs(c-S)?a:c;let m=t*e;const x=d+m,g=o===void 0?x:o(x);g!==x&&(m=g-d);const y=S=>-m*Math.exp(-S/r),v=S=>g+y(S),_=S=>{const C=y(S),B=v(S);h.done=Math.abs(C)<=l,h.value=h.done?g:B};let T,w;const N=S=>{f(h.value)&&(T=S,w=wu({keyframes:[h.value,p(h.value)],velocity:kA(v,S,h.value),damping:i,stiffness:s,restDelta:l,restSpeed:u}))};return N(0),{calculatedDuration:null,next:S=>{let C=!1;return!w&&T===void 0&&(C=!0,_(S),N(S)),T!==void 0&&S>=T?w.next(S-T):(!C&&_(S),h)}}}function gW(n,e,t){const r=[],i=t||Lr.mix||BA,s=n.length-1;for(let o=0;o<s;o++){let a=i(n[o],n[o+1]);if(e){const c=Array.isArray(e)?e[o]||xn:e;a=pc(c,a)}r.push(a)}return r}function xW(n,e,{clamp:t=!0,ease:r,mixer:i}={}){const s=n.length;if(Pg(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[s-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=gW(e,r,i),c=a.length,l=u=>{if(o&&u<n[0])return e[0];let d=0;if(c>1)for(;d<n.length-2&&!(u<n[d+1]);d++);const h=Ya(n[d],n[d+1],u);return a[d](h)};return t?u=>l(kr(n[0],n[s-1],u)):l}function yW(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const i=Ya(0,e,r);n.push(rt(t,1,i))}}function bW(n){const e=[0];return yW(e,n.length-1),e}function vW(n,e){return n.map(t=>t*e)}function _W(n,e){return n.map(()=>e||wA).splice(0,n.length-1)}function Ma({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const i=D7(r)?r.map(lv):lv(r),s={done:!1,value:e[0]},o=vW(t&&t.length===e.length?t:bW(e),n),a=xW(o,e,{ease:Array.isArray(i)?i:_W(e,i)});return{calculatedDuration:n,next:c=>(s.value=a(c),s.done=c>=n,s)}}const TW=n=>n!==null;function $g(n,{repeat:e,repeatType:t="loop"},r,i=1){const s=n.filter(TW),a=i<0||e&&t!=="loop"&&e%2===1?0:s.length-1;return!a||r===void 0?s[a]:r}const wW={decay:Dp,inertia:Dp,tween:Ma,keyframes:Ma,spring:wu};function LA(n){typeof n.type=="string"&&(n.type=wW[n.type])}class jg{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const SW=n=>n/100;class zg extends jg{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==Yt.now()&&this.tick(Yt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;LA(e);const{type:t=Ma,repeat:r=0,repeatDelay:i=0,repeatType:s,velocity:o=0}=e;let{keyframes:a}=e;const c=t||Ma;c!==Ma&&typeof a[0]!="number"&&(this.mixKeyframes=pc(SW,BA(a[0],a[1])),a=[0,100]);const l=c({...e,keyframes:a});s==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...a].reverse(),velocity:-o})),l.calculatedDuration===null&&(l.calculatedDuration=Gg(l));const{calculatedDuration:u}=l;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(r+1)-i,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:i,mixKeyframes:s,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:c}=this;if(this.startTime===null)return r.next(0);const{delay:l=0,keyframes:u,repeat:d,repeatType:h,repeatDelay:f,type:p,onUpdate:m,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),y=this.playbackSpeed>=0?g<0:g>i;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let v=this.currentTime,_=r;if(d){const S=Math.min(this.currentTime,i)/a;let C=Math.floor(S),B=S%1;!B&&S>=1&&(B=1),B===1&&C--,C=Math.min(C,d+1),!!(C%2)&&(h==="reverse"?(B=1-B,f&&(B-=f/a)):h==="mirror"&&(_=o)),v=kr(0,1,B)*a}const T=y?{done:!1,value:u[0]}:_.next(v);s&&(T.value=s(T.value));let{done:w}=T;!y&&c!==null&&(w=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const N=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&w);return N&&p!==Dp&&(T.value=$g(u,this.options,x,this.speed)),m&&m(T.value),N&&this.finish(),T}then(e,t){return this.finished.then(e,t)}get duration(){return mn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+mn(e)}get time(){return mn(this.currentTime)}set time(e){e=tr(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Yt.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=mn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=aW,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Yt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function NW(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const ji=n=>n*180/Math.PI,Bp=n=>{const e=ji(Math.atan2(n[1],n[0]));return Fp(e)},AW={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:Bp,rotateZ:Bp,skewX:n=>ji(Math.atan(n[1])),skewY:n=>ji(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},Fp=n=>(n=n%360,n<0&&(n+=360),n),mv=Bp,gv=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),xv=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),EW={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:gv,scaleY:xv,scale:n=>(gv(n)+xv(n))/2,rotateX:n=>Fp(ji(Math.atan2(n[6],n[5]))),rotateY:n=>Fp(ji(Math.atan2(-n[2],n[0]))),rotateZ:mv,rotate:mv,skewX:n=>ji(Math.atan(n[4])),skewY:n=>ji(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function kp(n){return n.includes("scale")?1:0}function Lp(n,e){if(!n||n==="none")return kp(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(t)r=EW,i=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=AW,i=a}if(!i)return kp(e);const s=r[e],o=i[1].split(",").map(RW);return typeof s=="function"?s(o):o[s]}const CW=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return Lp(t,e)};function RW(n){return parseFloat(n.trim())}const Mo=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Po=new Set(Mo),yv=n=>n===Ro||n===xe,MW=new Set(["x","y","z"]),PW=Mo.filter(n=>!MW.has(n));function DW(n){const e=[];return PW.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Zi={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>Lp(e,"x"),y:(n,{transform:e})=>Lp(e,"y")};Zi.translateX=Zi.x;Zi.translateY=Zi.y;const Ji=new Set;let Ip=!1,Op=!1,Up=!1;function IA(){if(Op){const n=Array.from(Ji).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const i=DW(r);i.length&&(t.set(r,i),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const i=t.get(r);i&&i.forEach(([s,o])=>{r.getValue(s)?.set(o)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}Op=!1,Ip=!1,Ji.forEach(n=>n.complete(Up)),Ji.clear()}function OA(){Ji.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(Op=!0)})}function BW(){Up=!0,OA(),IA(),Up=!1}class Hg{constructor(e,t,r,i,s,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=i,this.element=s,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Ji.add(this),Ip||(Ip=!0,Je.read(OA),Je.resolveKeyframes(IA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:i}=this;if(e[0]===null){const s=i?.get(),o=e[e.length-1];if(s!==void 0)e[0]=s;else if(r&&t){const a=r.readValue(t,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),i&&s===void 0&&i.set(e[0])}NW(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Ji.delete(this)}cancel(){this.state==="scheduled"&&(Ji.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const FW=n=>n.startsWith("--");function kW(n,e,t){FW(e)?n.style.setProperty(e,t):n.style[e]=t}const LW=Dg(()=>window.ScrollTimeline!==void 0),IW={};function OW(n,e){const t=Dg(n);return()=>IW[e]??t()}const UA=OW(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),pa=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,bv={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:pa([0,.65,.55,1]),circOut:pa([.55,0,1,.45]),backIn:pa([.31,.01,.66,-.59]),backOut:pa([.33,1.53,.69,.99])};function VA(n,e){if(n)return typeof n=="function"?UA()?FA(n,e):"ease-out":SA(n)?pa(n):Array.isArray(n)?n.map(t=>VA(t,e)||bv.easeOut):bv[n]}function UW(n,e,t,{delay:r=0,duration:i=300,repeat:s=0,repeatType:o="loop",ease:a="easeOut",times:c}={},l=void 0){const u={[e]:t};c&&(u.offset=c);const d=VA(a,i);Array.isArray(d)&&(u.easing=d);const h={delay:r,duration:i,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"};return l&&(h.pseudoElement=l),n.animate(u,h)}function GA(n){return typeof n=="function"&&"applyToOptions"in n}function VW({type:n,...e}){return GA(n)&&UA()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class GW extends jg{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:i,pseudoElement:s,allowFlatten:o=!1,finalKeyframe:a,onComplete:c}=e;this.isPseudoElement=!!s,this.allowFlatten=o,this.options=e,Pg(typeof e.type!="string");const l=VW(e);this.animation=UW(t,r,i,l,s),l.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const u=$g(i,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(u):kW(t,r,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return mn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+mn(e)}get time(){return mn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=tr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&LW()?(this.animation.timeline=e,xn):t(this)}}const $A={anticipate:vA,backInOut:bA,circInOut:TA};function $W(n){return n in $A}function jW(n){typeof n.ease=="string"&&$W(n.ease)&&(n.ease=$A[n.ease])}const vv=10;class zW extends GW{constructor(e){jW(e),LA(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:i,element:s,...o}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new zg({...o,autoplay:!1}),c=tr(this.finishedTime??this.time);t.setWithVelocity(a.sample(c-vv).value,a.sample(c).value,vv),a.stop()}}const _v=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(li.test(n)||n==="0")&&!n.startsWith("url("));function HW(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function WW(n,e,t,r){const i=n[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const s=n[n.length-1],o=_v(i,e),a=_v(s,e);return!o||!a?!1:HW(n)||(t==="spring"||GA(t))&&r}function Vp(n){n.duration=0,n.type="keyframes"}const qW=new Set(["opacity","clipPath","filter","transform"]),XW=Dg(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function KW(n){const{motionValue:e,name:t,repeatDelay:r,repeatType:i,damping:s,type:o}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:l}=e.owner.getProps();return XW()&&t&&qW.has(t)&&(t!=="transform"||!l)&&!c&&!r&&i!=="mirror"&&s!==0&&o!=="inertia"}const YW=40;class QW extends jg{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:i=0,repeatDelay:s=0,repeatType:o="loop",keyframes:a,name:c,motionValue:l,element:u,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Yt.now();const h={autoplay:e,delay:t,type:r,repeat:i,repeatDelay:s,repeatType:o,name:c,motionValue:l,element:u,...d},f=u?.KeyframeResolver||Hg;this.keyframeResolver=new f(a,(p,m,x)=>this.onKeyframesResolved(p,m,h,!x),c,l,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,i){this.keyframeResolver=void 0;const{name:s,type:o,velocity:a,delay:c,isHandoff:l,onUpdate:u}=r;this.resolvedAt=Yt.now(),WW(e,s,o,a)||((Lr.instantAnimations||!c)&&u?.($g(e,r,t)),e[0]=e[e.length-1],Vp(r),r.repeat=0);const h={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>YW?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},f=!l&&KW(h)?new zW({...h,element:h.motionValue.owner.current}):new zg(h);f.finished.then(()=>this.notifyFinished()).catch(xn),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),BW()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const ZW=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function JW(n){const e=ZW.exec(n);if(!e)return[,];const[,t,r,i]=e;return[`--${t??r}`,i]}function jA(n,e,t=1){const[r,i]=JW(n);if(!r)return;const s=window.getComputedStyle(e).getPropertyValue(r);if(s){const o=s.trim();return dA(o)?parseFloat(o):o}return Ig(i)?jA(i,e,t+1):i}function Wg(n,e){return n?.[e]??n?.default??n}const zA=new Set(["width","height","top","left","right","bottom",...Mo]),eq={test:n=>n==="auto",parse:n=>n},HA=n=>e=>e.test(n),WA=[Ro,xe,nr,$r,H7,z7,eq],Tv=n=>WA.find(HA(n));function tq(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||fA(n):!0}const nq=new Set(["brightness","contrast","saturate","opacity"]);function rq(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(Og)||[];if(!r)return n;const i=t.replace(r,"");let s=nq.has(e)?1:0;return r!==t&&(s*=100),e+"("+s+i+")"}const iq=/\b([a-z-]*)\(.*?\)/gu,Gp={...li,getAnimatableNone:n=>{const e=n.match(iq);return e?e.map(rq).join(" "):n}},wv={...Ro,transform:Math.round},sq={rotate:$r,rotateX:$r,rotateY:$r,rotateZ:$r,scale:ul,scaleX:ul,scaleY:ul,scaleZ:ul,skew:$r,skewX:$r,skewY:$r,distance:xe,translateX:xe,translateY:xe,translateZ:xe,x:xe,y:xe,z:xe,perspective:xe,transformPerspective:xe,opacity:Qa,originX:uv,originY:uv,originZ:xe},qg={borderWidth:xe,borderTopWidth:xe,borderRightWidth:xe,borderBottomWidth:xe,borderLeftWidth:xe,borderRadius:xe,radius:xe,borderTopLeftRadius:xe,borderTopRightRadius:xe,borderBottomRightRadius:xe,borderBottomLeftRadius:xe,width:xe,maxWidth:xe,height:xe,maxHeight:xe,top:xe,right:xe,bottom:xe,left:xe,padding:xe,paddingTop:xe,paddingRight:xe,paddingBottom:xe,paddingLeft:xe,margin:xe,marginTop:xe,marginRight:xe,marginBottom:xe,marginLeft:xe,backgroundPositionX:xe,backgroundPositionY:xe,...sq,zIndex:wv,fillOpacity:Qa,strokeOpacity:Qa,numOctaves:wv},oq={...qg,color:dt,backgroundColor:dt,outlineColor:dt,fill:dt,stroke:dt,borderColor:dt,borderTopColor:dt,borderRightColor:dt,borderBottomColor:dt,borderLeftColor:dt,filter:Gp,WebkitFilter:Gp},qA=n=>oq[n];function XA(n,e){let t=qA(n);return t!==Gp&&(t=li),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const aq=new Set(["auto","none","0"]);function cq(n,e,t){let r=0,i;for(;r<n.length&&!i;){const s=n[r];typeof s=="string"&&!aq.has(s)&&Za(s).values.length&&(i=n[r]),r++}if(i&&t)for(const s of e)n[s]=XA(t,i)}class lq extends Hg{constructor(e,t,r,i,s){super(e,t,r,i,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let l=e[c];if(typeof l=="string"&&(l=l.trim(),Ig(l))){const u=jA(l,t.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=l)}}if(this.resolveNoneKeyframes(),!zA.has(r)||e.length!==2)return;const[i,s]=e,o=Tv(i),a=Tv(s);if(o!==a)if(yv(o)&&yv(a))for(let c=0;c<e.length;c++){const l=e[c];typeof l=="string"&&(e[c]=parseFloat(l))}else Zi[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let i=0;i<e.length;i++)(e[i]===null||tq(e[i]))&&r.push(i);r.length&&cq(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Zi[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(r,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const s=r.length-1,o=r[s];r[s]=Zi[t](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,c])=>{e.getValue(a).set(c)}),this.resolveNoneKeyframes()}}function uq(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const i=t?.[n]??r.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const KA=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function YA(n){return hA(n)&&"offsetHeight"in n}const Sv=30,dq=n=>!isNaN(parseFloat(n));class hq{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const i=Yt.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Yt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=dq(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Bg);const r=this.events[e].add(t);return e==="change"?()=>{r(),Je.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Yt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Sv)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,Sv);return pA(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function xo(n,e){return new hq(n,e)}const{schedule:Xg}=NA(queueMicrotask,!1),Sn={x:!1,y:!1};function QA(){return Sn.x||Sn.y}function fq(n){return n==="x"||n==="y"?Sn[n]?null:(Sn[n]=!0,()=>{Sn[n]=!1}):Sn.x||Sn.y?null:(Sn.x=Sn.y=!0,()=>{Sn.x=Sn.y=!1})}function ZA(n,e){const t=uq(n),r=new AbortController,i={passive:!0,...e,signal:r.signal};return[t,i,()=>r.abort()]}function Nv(n){return!(n.pointerType==="touch"||QA())}function pq(n,e,t={}){const[r,i,s]=ZA(n,t),o=a=>{if(!Nv(a))return;const{target:c}=a,l=e(c,a);if(typeof l!="function"||!c)return;const u=d=>{Nv(d)&&(l(d),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,i)};return r.forEach(a=>{a.addEventListener("pointerenter",o,i)}),s}const JA=(n,e)=>e?n===e?!0:JA(n,e.parentElement):!1,Kg=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,mq=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function gq(n){return mq.has(n.tagName)||n.tabIndex!==-1}const Fl=new WeakSet;function Av(n){return e=>{e.key==="Enter"&&n(e)}}function zh(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const xq=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=Av(()=>{if(Fl.has(t))return;zh(t,"down");const i=Av(()=>{zh(t,"up")}),s=()=>zh(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",s,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function Ev(n){return Kg(n)&&!QA()}function yq(n,e,t={}){const[r,i,s]=ZA(n,t),o=a=>{const c=a.currentTarget;if(!Ev(a))return;Fl.add(c);const l=e(c,a),u=(f,p)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),Fl.has(c)&&Fl.delete(c),Ev(f)&&typeof l=="function"&&l(f,{success:p})},d=f=>{u(f,c===window||c===document||t.useGlobalTarget||JA(c,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",d,i),window.addEventListener("pointercancel",h,i)};return r.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",o,i),YA(a)&&(a.addEventListener("focus",l=>xq(l,i)),!gq(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),s}function eE(n){return hA(n)&&"ownerSVGElement"in n}function bq(n){return eE(n)&&n.tagName==="svg"}const Lt=n=>!!(n&&n.getVelocity),vq=[...WA,dt,li],_q=n=>vq.find(HA(n)),Yg=E.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function Cv(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Tq(...n){return e=>{let t=!1;const r=n.map(i=>{const s=Cv(i,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():Cv(n[i],null)}}}}function wq(...n){return E.useCallback(Tq(...n),n)}class Sq extends E.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,i=YA(r)&&r.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=i-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Nq({children:n,isPresent:e,anchorX:t,root:r}){const i=E.useId(),s=E.useRef(null),o=E.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=E.useContext(Yg),c=wq(s,n?.ref);return E.useInsertionEffect(()=>{const{width:l,height:u,top:d,left:h,right:f}=o.current;if(e||!s.current||!l||!u)return;const p=t==="left"?`left: ${h}`:`right: ${f}`;s.current.dataset.motionPopId=i;const m=document.createElement("style");a&&(m.nonce=a);const x=r??document.head;return x.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${u}px !important;
            ${p}px !important;
            top: ${d}px !important;
          }
        `),()=>{x.contains(m)&&x.removeChild(m)}},[e]),b.jsx(Sq,{isPresent:e,childRef:s,sizeRef:o,children:E.cloneElement(n,{ref:c})})}const Aq=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:s,mode:o,anchorX:a,root:c})=>{const l=Eg(Eq),u=E.useId();let d=!0,h=E.useMemo(()=>(d=!1,{id:u,initial:e,isPresent:t,custom:i,onExitComplete:f=>{l.set(f,!0);for(const p of l.values())if(!p)return;r&&r()},register:f=>(l.set(f,!1),()=>l.delete(f))}),[t,l,r]);return s&&d&&(h={...h}),E.useMemo(()=>{l.forEach((f,p)=>l.set(p,!1))},[t]),E.useEffect(()=>{!t&&!l.size&&r&&r()},[t]),o==="popLayout"&&(n=b.jsx(Nq,{isPresent:t,anchorX:a,root:c,children:n})),b.jsx(pd.Provider,{value:h,children:n})};function Eq(){return new Map}function tE(n=!0){const e=E.useContext(pd);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=e,s=E.useId();E.useEffect(()=>{if(n)return i(s)},[n]);const o=E.useCallback(()=>n&&r&&r(s),[s,r,n]);return!t&&r?[!1,o]:[!0]}const dl=n=>n.key||"";function Rv(n){const e=[];return E.Children.forEach(n,t=>{E.isValidElement(t)&&e.push(t)}),e}const nE=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:s="sync",propagate:o=!1,anchorX:a="left",root:c})=>{const[l,u]=tE(o),d=E.useMemo(()=>Rv(n),[n]),h=o&&!l?[]:d.map(dl),f=E.useRef(!0),p=E.useRef(d),m=Eg(()=>new Map),[x,g]=E.useState(d),[y,v]=E.useState(d);uA(()=>{f.current=!1,p.current=d;for(let w=0;w<y.length;w++){const N=dl(y[w]);h.includes(N)?m.delete(N):m.get(N)!==!0&&m.set(N,!1)}},[y,h.length,h.join("-")]);const _=[];if(d!==x){let w=[...d];for(let N=0;N<y.length;N++){const S=y[N],C=dl(S);h.includes(C)||(w.splice(N,0,S),_.push(S))}return s==="wait"&&_.length&&(w=_),v(Rv(w)),g(d),null}const{forceRender:T}=E.useContext(Ag);return b.jsx(b.Fragment,{children:y.map(w=>{const N=dl(w),S=o&&!l?!1:d===y||h.includes(N),C=()=>{if(m.has(N))m.set(N,!0);else return;let B=!0;m.forEach(D=>{D||(B=!1)}),B&&(T?.(),v(p.current),o&&u?.(),r&&r())};return b.jsx(Aq,{isPresent:S,initial:!f.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:s,root:c,onExitComplete:S?void 0:C,anchorX:a,children:w},N)})})},rE=E.createContext({strict:!1}),Mv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},yo={};for(const n in Mv)yo[n]={isEnabled:e=>Mv[n].some(t=>!!e[t])};function Cq(n){for(const e in n)yo[e]={...yo[e],...n[e]}}const Rq=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Su(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||Rq.has(n)}let iE=n=>!Su(n);function Mq(n){typeof n=="function"&&(iE=e=>e.startsWith("on")?!Su(e):n(e))}try{Mq(require("@emotion/is-prop-valid").default)}catch{}function Pq(n,e,t){const r={};for(const i in n)i==="values"&&typeof n.values=="object"||(iE(i)||t===!0&&Su(i)||!e&&!Su(i)||n.draggable&&i.startsWith("onDrag"))&&(r[i]=n[i]);return r}const md=E.createContext({});function gd(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Ja(n){return typeof n=="string"||Array.isArray(n)}const Qg=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Zg=["initial",...Qg];function xd(n){return gd(n.animate)||Zg.some(e=>Ja(n[e]))}function sE(n){return!!(xd(n)||n.variants)}function Dq(n,e){if(xd(n)){const{initial:t,animate:r}=n;return{initial:t===!1||Ja(t)?t:void 0,animate:Ja(r)?r:void 0}}return n.inherit!==!1?e:{}}function Bq(n){const{initial:e,animate:t}=Dq(n,E.useContext(md));return E.useMemo(()=>({initial:e,animate:t}),[Pv(e),Pv(t)])}function Pv(n){return Array.isArray(n)?n.join(" "):n}const ec={};function Fq(n){for(const e in n)ec[e]=n[e],Lg(e)&&(ec[e].isCSSVariable=!0)}function oE(n,{layout:e,layoutId:t}){return Po.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!ec[n]||n==="opacity")}const kq={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Lq=Mo.length;function Iq(n,e,t){let r="",i=!0;for(let s=0;s<Lq;s++){const o=Mo[s],a=n[o];if(a===void 0)continue;let c=!0;if(typeof a=="number"?c=a===(o.startsWith("scale")?1:0):c=parseFloat(a)===0,!c||t){const l=KA(a,qg[o]);if(!c){i=!1;const u=kq[o]||o;r+=`${u}(${l}) `}t&&(e[o]=l)}}return r=r.trim(),t?r=t(e,i?"":r):i&&(r="none"),r}function Jg(n,e,t){const{style:r,vars:i,transformOrigin:s}=n;let o=!1,a=!1;for(const c in e){const l=e[c];if(Po.has(c)){o=!0;continue}else if(Lg(c)){i[c]=l;continue}else{const u=KA(l,qg[c]);c.startsWith("origin")?(a=!0,s[c]=u):r[c]=u}}if(e.transform||(o||t?r.transform=Iq(e,n.transform,t):r.transform&&(r.transform="none")),a){const{originX:c="50%",originY:l="50%",originZ:u=0}=s;r.transformOrigin=`${c} ${l} ${u}`}}const e0=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function aE(n,e,t){for(const r in e)!Lt(e[r])&&!oE(r,t)&&(n[r]=e[r])}function Oq({transformTemplate:n},e){return E.useMemo(()=>{const t=e0();return Jg(t,e,n),Object.assign({},t.vars,t.style)},[e])}function Uq(n,e){const t=n.style||{},r={};return aE(r,t,n),Object.assign(r,Oq(n,e)),r}function Vq(n,e){const t={},r=Uq(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const Gq={offset:"stroke-dashoffset",array:"stroke-dasharray"},$q={offset:"strokeDashoffset",array:"strokeDasharray"};function jq(n,e,t=1,r=0,i=!0){n.pathLength=1;const s=i?Gq:$q;n[s.offset]=xe.transform(-r);const o=xe.transform(e),a=xe.transform(t);n[s.array]=`${o} ${a}`}function cE(n,{attrX:e,attrY:t,attrScale:r,pathLength:i,pathSpacing:s=1,pathOffset:o=0,...a},c,l,u){if(Jg(n,a,l),c){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:d,style:h}=n;d.transform&&(h.transform=d.transform,delete d.transform),(h.transform||d.transformOrigin)&&(h.transformOrigin=d.transformOrigin??"50% 50%",delete d.transformOrigin),h.transform&&(h.transformBox=u?.transformBox??"fill-box",delete d.transformBox),e!==void 0&&(d.x=e),t!==void 0&&(d.y=t),r!==void 0&&(d.scale=r),i!==void 0&&jq(d,i,s,o,!1)}const lE=()=>({...e0(),attrs:{}}),uE=n=>typeof n=="string"&&n.toLowerCase()==="svg";function zq(n,e,t,r){const i=E.useMemo(()=>{const s=lE();return cE(s,e,uE(r),n.transformTemplate,n.style),{...s.attrs,style:{...s.style}}},[e]);if(n.style){const s={};aE(s,n.style,n),i.style={...s,...i.style}}return i}const Hq=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function t0(n){return typeof n!="string"||n.includes("-")?!1:!!(Hq.indexOf(n)>-1||/[A-Z]/u.test(n))}function Wq(n,e,t,{latestValues:r},i,s=!1){const a=(t0(n)?zq:Vq)(e,r,i,n),c=Pq(e,typeof n=="string",s),l=n!==E.Fragment?{...c,...a,ref:t}:{},{children:u}=e,d=E.useMemo(()=>Lt(u)?u.get():u,[u]);return E.createElement(n,{...l,children:d})}function Dv(n){const e=[{},{}];return n?.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function n0(n,e,t,r){if(typeof e=="function"){const[i,s]=Dv(r);e=e(t!==void 0?t:n.custom,i,s)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[i,s]=Dv(r);e=e(t!==void 0?t:n.custom,i,s)}return e}function kl(n){return Lt(n)?n.get():n}function qq({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,i){return{latestValues:Xq(t,r,i,n),renderState:e()}}function Xq(n,e,t,r){const i={},s=r(n,{});for(const h in s)i[h]=kl(s[h]);let{initial:o,animate:a}=n;const c=xd(n),l=sE(n);e&&l&&!c&&n.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=t?t.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!gd(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const p=n0(n,h[f]);if(p){const{transitionEnd:m,transition:x,...g}=p;for(const y in g){let v=g[y];if(Array.isArray(v)){const _=u?v.length-1:0;v=v[_]}v!==null&&(i[y]=v)}for(const y in m)i[y]=m[y]}}}return i}const dE=n=>(e,t)=>{const r=E.useContext(md),i=E.useContext(pd),s=()=>qq(n,e,r,i);return t?s():Eg(s)};function r0(n,e,t){const{style:r}=n,i={};for(const s in r)(Lt(r[s])||e.style&&Lt(e.style[s])||oE(s,n)||t?.getValue(s)?.liveStyle!==void 0)&&(i[s]=r[s]);return i}const Kq=dE({scrapeMotionValuesFromProps:r0,createRenderState:e0});function hE(n,e,t){const r=r0(n,e,t);for(const i in n)if(Lt(n[i])||Lt(e[i])){const s=Mo.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[s]=n[i]}return r}const Yq=dE({scrapeMotionValuesFromProps:hE,createRenderState:lE}),Qq=Symbol.for("motionComponentSymbol");function Is(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function Zq(n,e,t){return E.useCallback(r=>{r&&n.onMount&&n.onMount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):Is(t)&&(t.current=r))},[e])}const i0=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Jq="framerAppearId",fE="data-"+i0(Jq),pE=E.createContext({});function eX(n,e,t,r,i){const{visualElement:s}=E.useContext(md),o=E.useContext(rE),a=E.useContext(pd),c=E.useContext(Yg).reducedMotion,l=E.useRef(null);r=r||o.renderer,!l.current&&r&&(l.current=r(n,{visualState:e,parent:s,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:c}));const u=l.current,d=E.useContext(pE);u&&!u.projection&&i&&(u.type==="html"||u.type==="svg")&&tX(l.current,t,i,d);const h=E.useRef(!1);E.useInsertionEffect(()=>{u&&h.current&&u.update(t,a)});const f=t[fE],p=E.useRef(!!f&&!window.MotionHandoffIsComplete?.(f)&&window.MotionHasOptimisedAnimation?.(f));return uA(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),p.current&&u.animationState&&u.animationState.animateChanges())}),E.useEffect(()=>{u&&(!p.current&&u.animationState&&u.animationState.animateChanges(),p.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(f)}),p.current=!1),u.enteringChildren=void 0)}),u}function tX(n,e,t,r){const{layoutId:i,layout:s,drag:o,dragConstraints:a,layoutScroll:c,layoutRoot:l,layoutCrossfade:u}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:mE(n.parent)),n.projection.setOptions({layoutId:i,layout:s,alwaysMeasureLayout:!!o||a&&Is(a),visualElement:n,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,crossfade:u,layoutScroll:c,layoutRoot:l})}function mE(n){if(n)return n.options.allowProjection!==!1?n.projection:mE(n.parent)}function Hh(n,{forwardMotionProps:e=!1}={},t,r){t&&Cq(t);const i=t0(n)?Yq:Kq;function s(a,c){let l;const u={...E.useContext(Yg),...a,layoutId:nX(a)},{isStatic:d}=u,h=Bq(a),f=i(a,d);if(!d&&Cg){rX();const p=iX(u);l=p.MeasureLayout,h.visualElement=eX(n,f,u,r,p.ProjectionNode)}return b.jsxs(md.Provider,{value:h,children:[l&&h.visualElement?b.jsx(l,{visualElement:h.visualElement,...u}):null,Wq(n,a,Zq(f,h.visualElement,c),f,d,e)]})}s.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const o=E.forwardRef(s);return o[Qq]=n,o}function nX({layoutId:n}){const e=E.useContext(Ag).id;return e&&n!==void 0?e+"-"+n:n}function rX(n,e){E.useContext(rE).strict}function iX(n){const{drag:e,layout:t}=yo;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function sX(n,e){if(typeof Proxy>"u")return Hh;const t=new Map,r=(s,o)=>Hh(s,o,n,e),i=(s,o)=>r(s,o);return new Proxy(i,{get:(s,o)=>o==="create"?r:(t.has(o)||t.set(o,Hh(o,void 0,n,e)),t.get(o))})}function gE({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function oX({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function aX(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function Wh(n){return n===void 0||n===1}function $p({scale:n,scaleX:e,scaleY:t}){return!Wh(n)||!Wh(e)||!Wh(t)}function Pi(n){return $p(n)||xE(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function xE(n){return Bv(n.x)||Bv(n.y)}function Bv(n){return n&&n!=="0%"}function Nu(n,e,t){const r=n-t,i=e*r;return t+i}function Fv(n,e,t,r,i){return i!==void 0&&(n=Nu(n,i,r)),Nu(n,t,r)+e}function jp(n,e=0,t=1,r,i){n.min=Fv(n.min,e,t,r,i),n.max=Fv(n.max,e,t,r,i)}function yE(n,{x:e,y:t}){jp(n.x,e.translate,e.scale,e.originPoint),jp(n.y,t.translate,t.scale,t.originPoint)}const kv=.999999999999,Lv=1.0000000000001;function cX(n,e,t,r=!1){const i=t.length;if(!i)return;e.x=e.y=1;let s,o;for(let a=0;a<i;a++){s=t[a],o=s.projectionDelta;const{visualElement:c}=s.options;c&&c.props.style&&c.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Us(n,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,yE(n,o)),r&&Pi(s.latestValues)&&Us(n,s.latestValues))}e.x<Lv&&e.x>kv&&(e.x=1),e.y<Lv&&e.y>kv&&(e.y=1)}function Os(n,e){n.min=n.min+e,n.max=n.max+e}function Iv(n,e,t,r,i=.5){const s=rt(n.min,n.max,i);jp(n,e,t,s,r)}function Us(n,e){Iv(n.x,e.x,e.scaleX,e.scale,e.originX),Iv(n.y,e.y,e.scaleY,e.scale,e.originY)}function bE(n,e){return gE(aX(n.getBoundingClientRect(),e))}function lX(n,e,t){const r=bE(n,t),{scroll:i}=e;return i&&(Os(r.x,i.offset.x),Os(r.y,i.offset.y)),r}const Ov=()=>({translate:0,scale:1,origin:0,originPoint:0}),Vs=()=>({x:Ov(),y:Ov()}),Uv=()=>({min:0,max:0}),vt=()=>({x:Uv(),y:Uv()}),zp={current:null},vE={current:!1};function uX(){if(vE.current=!0,!!Cg)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>zp.current=n.matches;n.addEventListener("change",e),e()}else zp.current=!1}const dX=new WeakMap;function hX(n,e,t){for(const r in e){const i=e[r],s=t[r];if(Lt(i))n.addValue(r,i);else if(Lt(s))n.addValue(r,xo(i,{owner:n}));else if(s!==i)if(n.hasValue(r)){const o=n.getValue(r);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=n.getStaticValue(r);n.addValue(r,xo(o!==void 0?o:i,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const Vv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class fX{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Hg,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Yt.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Je.render(this.render,!1,!0))};const{latestValues:c,renderState:l}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=t.initial?{...c}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=xd(t),this.isVariantNode=sE(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const h in d){const f=d[h];c[h]!==void 0&&Lt(f)&&f.set(c[h])}}mount(e){this.current=e,dX.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),vE.current||uX(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:zp.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ci(this.notifyUpdate),ci(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Po.has(e);r&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Je.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),s&&s(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in yo){const t=yo[e];if(!t)continue;const{isEnabled:r,Feature:i}=t;if(!this.features[e]&&i&&r(this.props)&&(this.features[e]=new i(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):vt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<Vv.length;r++){const i=Vv[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const s="on"+i,o=e[s];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=hX(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=xo(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(dA(r)||fA(r))?r=parseFloat(r):!_q(r)&&li.test(t)&&(r=XA(e,t)),this.setBaseTarget(e,Lt(r)?r.get():r)),Lt(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const s=n0(this.props,t,this.presenceContext?.custom);s&&(r=s[e])}if(t&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Lt(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Bg),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){Xg.render(this.render)}}class _E extends fX{constructor(){super(...arguments),this.KeyframeResolver=lq}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Lt(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function TE(n,{style:e,vars:t},r,i){const s=n.style;let o;for(o in e)s[o]=e[o];i?.applyProjectionStyles(s,r);for(o in t)s.setProperty(o,t[o])}function pX(n){return window.getComputedStyle(n)}class mX extends _E{constructor(){super(...arguments),this.type="html",this.renderInstance=TE}readValueFromInstance(e,t){if(Po.has(t))return this.projection?.isProjecting?kp(t):CW(e,t);{const r=pX(e),i=(Lg(t)?r.getPropertyValue(t):r[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return bE(e,t)}build(e,t,r){Jg(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return r0(e,t,r)}}const wE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function gX(n,e,t,r){TE(n,e,void 0,r);for(const i in e.attrs)n.setAttribute(wE.has(i)?i:i0(i),e.attrs[i])}class xX extends _E{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=vt}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Po.has(t)){const r=qA(t);return r&&r.default||0}return t=wE.has(t)?t:i0(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return hE(e,t,r)}build(e,t,r){cE(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,i){gX(e,t,r,i)}mount(e){this.isSVGTag=uE(e.tagName),super.mount(e)}}const yX=(n,e)=>t0(n)?new xX(e):new mX(e,{allowProjection:n!==E.Fragment});function Qs(n,e,t){const r=n.getProps();return n0(r,e,t!==void 0?t:r.custom,n)}const Hp=n=>Array.isArray(n);function bX(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,xo(t))}function vX(n){return Hp(n)?n[n.length-1]||0:n}function _X(n,e){const t=Qs(n,e);let{transitionEnd:r={},transition:i={},...s}=t||{};s={...s,...r};for(const o in s){const a=vX(s[o]);bX(n,o,a)}}function TX(n){return!!(Lt(n)&&n.add)}function Wp(n,e){const t=n.getValue("willChange");if(TX(t))return t.add(e);if(!t&&Lr.WillChange){const r=new Lr.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function SE(n){return n.props[fE]}const wX=n=>n!==null;function SX(n,{repeat:e,repeatType:t="loop"},r){const i=n.filter(wX),s=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[s]}const NX={type:"spring",stiffness:500,damping:25,restSpeed:10},AX=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),EX={type:"keyframes",duration:.8},CX={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},RX=(n,{keyframes:e})=>e.length>2?EX:Po.has(n)?n.startsWith("scale")?AX(e[1]):NX:CX;function MX({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:s,repeatType:o,repeatDelay:a,from:c,elapsed:l,...u}){return!!Object.keys(u).length}const s0=(n,e,t,r={},i,s)=>o=>{const a=Wg(r,n)||{},c=a.delay||r.delay||0;let{elapsed:l=0}=r;l=l-tr(c);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-l,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:s?void 0:i};MX(a)||Object.assign(u,RX(n,u)),u.duration&&(u.duration=tr(u.duration)),u.repeatDelay&&(u.repeatDelay=tr(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Vp(u),u.delay===0&&(d=!0)),(Lr.instantAnimations||Lr.skipAnimations)&&(d=!0,Vp(u),u.delay=0),u.allowFlatten=!a.type&&!a.ease,d&&!s&&e.get()!==void 0){const h=SX(u.keyframes,a);if(h!==void 0){Je.update(()=>{u.onUpdate(h),u.onComplete()});return}}return a.isSync?new zg(u):new QW(u)};function PX({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function NE(n,e,{delay:t=0,transitionOverride:r,type:i}={}){let{transition:s=n.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(s=r);const c=[],l=i&&n.animationState&&n.animationState.getState()[i];for(const u in a){const d=n.getValue(u,n.latestValues[u]??null),h=a[u];if(h===void 0||l&&PX(l,u))continue;const f={delay:t,...Wg(s||{},u)},p=d.get();if(p!==void 0&&!d.isAnimating&&!Array.isArray(h)&&h===p&&!f.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){const g=SE(n);if(g){const y=window.MotionHandoffAnimation(g,u,Je);y!==null&&(f.startTime=y,m=!0)}}Wp(n,u),d.start(s0(u,d,h,n.shouldReduceMotion&&zA.has(u)?{type:!1}:f,n,m));const x=d.animation;x&&c.push(x)}return o&&Promise.all(c).then(()=>{Je.update(()=>{o&&_X(n,o)})}),c}function AE(n,e,t,r=0,i=1){const s=Array.from(n).sort((l,u)=>l.sortNodePosition(u)).indexOf(e),o=n.size,a=(o-1)*r;return typeof t=="function"?t(s,o):i===1?s*r:a-s*r}function qp(n,e,t={}){const r=Qs(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(i=t.transitionOverride);const s=r?()=>Promise.all(NE(n,r,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:l=0,staggerChildren:u,staggerDirection:d}=i;return DX(n,e,c,l,u,d,t)}:()=>Promise.resolve(),{when:a}=i;if(a){const[c,l]=a==="beforeChildren"?[s,o]:[o,s];return c().then(()=>l())}else return Promise.all([s(),o(t.delay)])}function DX(n,e,t=0,r=0,i=0,s=1,o){const a=[];for(const c of n.variantChildren)c.notify("AnimationStart",e),a.push(qp(c,e,{...o,delay:t+(typeof r=="function"?0:r)+AE(n.variantChildren,c,r,i,s)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(a)}function BX(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(s=>qp(n,s,t));r=Promise.all(i)}else if(typeof e=="string")r=qp(n,e,t);else{const i=typeof e=="function"?Qs(n,e,t.custom):e;r=Promise.all(NE(n,i,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function EE(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const FX=Zg.length;function CE(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?CE(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<FX;t++){const r=Zg[t],i=n.props[r];(Ja(i)||i===!1)&&(e[r]=i)}return e}const kX=[...Qg].reverse(),LX=Qg.length;function IX(n){return e=>Promise.all(e.map(({animation:t,options:r})=>BX(n,t,r)))}function OX(n){let e=IX(n),t=Gv(),r=!0;const i=c=>(l,u)=>{const d=Qs(n,u,c==="exit"?n.presenceContext?.custom:void 0);if(d){const{transition:h,transitionEnd:f,...p}=d;l={...l,...p,...f}}return l};function s(c){e=c(n)}function o(c){const{props:l}=n,u=CE(n.parent)||{},d=[],h=new Set;let f={},p=1/0;for(let x=0;x<LX;x++){const g=kX[x],y=t[g],v=l[g]!==void 0?l[g]:u[g],_=Ja(v),T=g===c?y.isActive:null;T===!1&&(p=x);let w=v===u[g]&&v!==l[g]&&_;if(w&&r&&n.manuallyAnimateOnMount&&(w=!1),y.protectedKeys={...f},!y.isActive&&T===null||!v&&!y.prevProp||gd(v)||typeof v=="boolean")continue;const N=UX(y.prevProp,v);let S=N||g===c&&y.isActive&&!w&&_||x>p&&_,C=!1;const B=Array.isArray(v)?v:[v];let D=B.reduce(i(g),{});T===!1&&(D={});const{prevResolvedValues:U={}}=y,$={...U,...D},A=R=>{S=!0,h.has(R)&&(C=!0,h.delete(R)),y.needsAnimating[R]=!0;const L=n.getValue(R);L&&(L.liveStyle=!1)};for(const R in $){const L=D[R],M=U[R];if(f.hasOwnProperty(R))continue;let W=!1;Hp(L)&&Hp(M)?W=!EE(L,M):W=L!==M,W?L!=null?A(R):h.add(R):L!==void 0&&h.has(R)?A(R):y.protectedKeys[R]=!0}y.prevProp=v,y.prevResolvedValues=D,y.isActive&&(f={...f,...D}),r&&n.blockInitialAnimation&&(S=!1);const O=w&&N;S&&(!O||C)&&d.push(...B.map(R=>{const L={type:g};if(typeof R=="string"&&r&&!O&&n.manuallyAnimateOnMount&&n.parent){const{parent:M}=n,W=Qs(M,R);if(M.enteringChildren&&W){const{delayChildren:I}=W.transition||{};L.delay=AE(M.enteringChildren,n,I)}}return{animation:R,options:L}}))}if(h.size){const x={};if(typeof l.initial!="boolean"){const g=Qs(n,Array.isArray(l.initial)?l.initial[0]:l.initial);g&&g.transition&&(x.transition=g.transition)}h.forEach(g=>{const y=n.getBaseTarget(g),v=n.getValue(g);v&&(v.liveStyle=!0),x[g]=y??null}),d.push({animation:x})}let m=!!d.length;return r&&(l.initial===!1||l.initial===l.animate)&&!n.manuallyAnimateOnMount&&(m=!1),r=!1,m?e(d):Promise.resolve()}function a(c,l){if(t[c].isActive===l)return Promise.resolve();n.variantChildren?.forEach(d=>d.animationState?.setActive(c,l)),t[c].isActive=l;const u=o(c);for(const d in t)t[d].protectedKeys={};return u}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>t,reset:()=>{t=Gv()}}}function UX(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!EE(e,n):!1}function Ei(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Gv(){return{animate:Ei(!0),whileInView:Ei(),whileHover:Ei(),whileTap:Ei(),whileDrag:Ei(),whileFocus:Ei(),exit:Ei()}}class mi{constructor(e){this.isMounted=!1,this.node=e}update(){}}class VX extends mi{constructor(e){super(e),e.animationState||(e.animationState=OX(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();gd(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let GX=0;class $X extends mi{constructor(){super(...arguments),this.id=GX++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const jX={animation:{Feature:VX},exit:{Feature:$X}};function tc(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function xc(n){return{point:{x:n.pageX,y:n.pageY}}}const zX=n=>e=>Kg(e)&&n(e,xc(e));function Pa(n,e,t,r){return tc(n,e,zX(t),r)}const RE=1e-4,HX=1-RE,WX=1+RE,ME=.01,qX=0-ME,XX=0+ME;function jt(n){return n.max-n.min}function KX(n,e,t){return Math.abs(n-e)<=t}function $v(n,e,t,r=.5){n.origin=r,n.originPoint=rt(e.min,e.max,n.origin),n.scale=jt(t)/jt(e),n.translate=rt(t.min,t.max,n.origin)-n.originPoint,(n.scale>=HX&&n.scale<=WX||isNaN(n.scale))&&(n.scale=1),(n.translate>=qX&&n.translate<=XX||isNaN(n.translate))&&(n.translate=0)}function Da(n,e,t,r){$v(n.x,e.x,t.x,r?r.originX:void 0),$v(n.y,e.y,t.y,r?r.originY:void 0)}function jv(n,e,t){n.min=t.min+e.min,n.max=n.min+jt(e)}function YX(n,e,t){jv(n.x,e.x,t.x),jv(n.y,e.y,t.y)}function zv(n,e,t){n.min=e.min-t.min,n.max=n.min+jt(e)}function Au(n,e,t){zv(n.x,e.x,t.x),zv(n.y,e.y,t.y)}function cn(n){return[n("x"),n("y")]}const PE=({current:n})=>n?n.ownerDocument.defaultView:null,Hv=(n,e)=>Math.abs(n-e);function QX(n,e){const t=Hv(n.x,e.x),r=Hv(n.y,e.y);return Math.sqrt(t**2+r**2)}class DE{constructor(e,t,{transformPagePoint:r,contextWindow:i=window,dragSnapToOrigin:s=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Xh(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,p=QX(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!p)return;const{point:m}=h,{timestamp:x}=Et;this.history.push({...m,timestamp:x});const{onStart:g,onMove:y}=this.handlers;f||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=qh(f,this.transformPagePoint),Je.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:p,onSessionEnd:m,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Xh(h.type==="pointercancel"?this.lastMoveEventInfo:qh(f,this.transformPagePoint),this.history);this.startEvent&&p&&p(h,g),m&&m(h,g)},!Kg(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=i||window;const a=xc(e),c=qh(a,this.transformPagePoint),{point:l}=c,{timestamp:u}=Et;this.history=[{...l,timestamp:u}];const{onSessionStart:d}=t;d&&d(e,Xh(c,this.history)),this.removeListeners=pc(Pa(this.contextWindow,"pointermove",this.handlePointerMove),Pa(this.contextWindow,"pointerup",this.handlePointerUp),Pa(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ci(this.updatePoint)}}function qh(n,e){return e?{point:e(n.point)}:n}function Wv(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Xh({point:n},e){return{point:n,delta:Wv(n,BE(e)),offset:Wv(n,ZX(e)),velocity:JX(e,.1)}}function ZX(n){return n[0]}function BE(n){return n[n.length-1]}function JX(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const i=BE(n);for(;t>=0&&(r=n[t],!(i.timestamp-r.timestamp>tr(e)));)t--;if(!r)return{x:0,y:0};const s=mn(i.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const o={x:(i.x-r.x)/s,y:(i.y-r.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function eK(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?rt(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?rt(t,n,r.max):Math.min(n,t)),n}function qv(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function tK(n,{top:e,left:t,bottom:r,right:i}){return{x:qv(n.x,t,i),y:qv(n.y,e,r)}}function Xv(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function nK(n,e){return{x:Xv(n.x,e.x),y:Xv(n.y,e.y)}}function rK(n,e){let t=.5;const r=jt(n),i=jt(e);return i>r?t=Ya(e.min,e.max-r,n.min):r>i&&(t=Ya(n.min,n.max-i,e.min)),kr(0,1,t)}function iK(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Xp=.35;function sK(n=Xp){return n===!1?n=0:n===!0&&(n=Xp),{x:Kv(n,"left","right"),y:Kv(n,"top","bottom")}}function Kv(n,e,t){return{min:Yv(n,e),max:Yv(n,t)}}function Yv(n,e){return typeof n=="number"?n:n[e]||0}const oK=new WeakMap;class aK{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=vt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const s=d=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(xc(d).point)},o=(d,h)=>{const{drag:f,dragPropagation:p,onDragStart:m}=this.getProps();if(f&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=fq(f),!this.openDragLock))return;this.latestPointerEvent=d,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),cn(g=>{let y=this.getAxisMotionValue(g).get()||0;if(nr.test(y)){const{projection:v}=this.visualElement;if(v&&v.layout){const _=v.layout.layoutBox[g];_&&(y=jt(_)*(parseFloat(y)/100))}}this.originPoint[g]=y}),m&&Je.postRender(()=>m(d,h)),Wp(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h;const{dragPropagation:f,dragDirectionLock:p,onDirectionLock:m,onDrag:x}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:g}=h;if(p&&this.currentDirection===null){this.currentDirection=cK(g),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),x&&x(d,h)},c=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h,this.stop(d,h),this.latestPointerEvent=null,this.latestPanInfo=null},l=()=>cn(d=>this.getAnimationState(d)==="paused"&&this.getAxisMotionValue(d).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new DE(e,{onSessionStart:s,onStart:o,onMove:a,onSessionEnd:c,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:r,contextWindow:PE(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,i=t||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!i||!r)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Je.postRender(()=>a(r,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:i}=this.getProps();if(!r||!hl(e,i,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=eK(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&Is(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=tK(r.layoutBox,e):this.constraints=!1,this.elastic=sK(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&cn(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=iK(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Is(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const s=lX(r,i.root,this.visualElement.getTransformPagePoint());let o=nK(i.layout.layoutBox,s);if(t){const a=t(oX(o));this.hasMutatedConstraints=!!a,a&&(o=gE(a))}return o}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:i,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),c=this.constraints||{},l=cn(u=>{if(!hl(u,t,this.currentDirection))return;let d=c&&c[u]||{};o&&(d={min:0,max:0});const h=i?200:1e6,f=i?40:1e7,p={type:"inertia",velocity:r?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(u,p)});return Promise.all(l).then(a)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return Wp(this.visualElement,e),r.start(s0(e,r,0,t,this.visualElement,!1))}stopAnimation(){cn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){cn(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),i=r[t];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){cn(t=>{const{drag:r}=this.getProps();if(!hl(t,r,this.currentDirection))return;const{projection:i}=this.visualElement,s=this.getAxisMotionValue(t);if(i&&i.layout){const{min:o,max:a}=i.layout.layoutBox[t];s.set(e[t]-rt(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!Is(t)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};cn(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const c=a.get();i[o]=rK({min:c,max:c},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),cn(o=>{if(!hl(o,e,null))return;const a=this.getAxisMotionValue(o),{min:c,max:l}=this.constraints[o];a.set(rt(c,l,i[o]))})}addListeners(){if(!this.visualElement.current)return;oK.set(this.visualElement,this);const e=this.visualElement.current,t=Pa(e,"pointerdown",c=>{const{drag:l,dragListener:u=!0}=this.getProps();l&&u&&this.start(c)}),r=()=>{const{dragConstraints:c}=this.getProps();Is(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,s=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Je.read(r);const o=tc(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:l})=>{this.isDragging&&l&&(cn(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=c[u].translate,d.set(d.get()+c[u].translate))}),this.visualElement.render())}));return()=>{o(),t(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:s=!1,dragElastic:o=Xp,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:i,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function hl(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function cK(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class lK extends mi{constructor(e){super(e),this.removeGroupControls=xn,this.removeListeners=xn,this.controls=new aK(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||xn}unmount(){this.removeGroupControls(),this.removeListeners()}}const Qv=n=>(e,t)=>{n&&Je.postRender(()=>n(e,t))};class uK extends mi{constructor(){super(...arguments),this.removePointerDownListener=xn}onPointerDown(e){this.session=new DE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:PE(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:Qv(e),onStart:Qv(t),onMove:r,onEnd:(s,o)=>{delete this.session,i&&Je.postRender(()=>i(s,o))}}}mount(){this.removePointerDownListener=Pa(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Ll={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Zv(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const sa={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(xe.test(n))n=parseFloat(n);else return n;const t=Zv(n,e.target.x),r=Zv(n,e.target.y);return`${t}% ${r}%`}},dK={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,i=li.parse(n);if(i.length>5)return r;const s=li.createTransformer(n),o=typeof i[0]!="number"?1:0,a=t.x.scale*e.x,c=t.y.scale*e.y;i[0+o]/=a,i[1+o]/=c;const l=rt(a,c,.5);return typeof i[2+o]=="number"&&(i[2+o]/=l),typeof i[3+o]=="number"&&(i[3+o]/=l),s(i)}};let Kh=!1;class hK extends E.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:i}=this.props,{projection:s}=e;Fq(fK),s&&(t.group&&t.group.add(s),r&&r.register&&i&&r.register(s),Kh&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),Ll.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:i,isPresent:s}=this.props,{projection:o}=r;return o&&(o.isPresent=s,Kh=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==s?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||Je.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Xg.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:i}=e;Kh=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function FE(n){const[e,t]=tE(),r=E.useContext(Ag);return b.jsx(hK,{...n,layoutGroup:r,switchLayoutGroup:E.useContext(pE),isPresent:e,safeToRemove:t})}const fK={borderRadius:{...sa,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:sa,borderTopRightRadius:sa,borderBottomLeftRadius:sa,borderBottomRightRadius:sa,boxShadow:dK};function pK(n,e,t){const r=Lt(n)?n:xo(n);return r.start(s0("",r,e,t)),r.animation}const mK=(n,e)=>n.depth-e.depth;class gK{constructor(){this.children=[],this.isDirty=!1}add(e){Rg(this.children,e),this.isDirty=!0}remove(e){Mg(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(mK),this.isDirty=!1,this.children.forEach(e)}}function xK(n,e){const t=Yt.now(),r=({timestamp:i})=>{const s=i-t;s>=e&&(ci(r),n(s-e))};return Je.setup(r,!0),()=>ci(r)}const kE=["TopLeft","TopRight","BottomLeft","BottomRight"],yK=kE.length,Jv=n=>typeof n=="string"?parseFloat(n):n,e_=n=>typeof n=="number"||xe.test(n);function bK(n,e,t,r,i,s){i?(n.opacity=rt(0,t.opacity??1,vK(r)),n.opacityExit=rt(e.opacity??1,0,_K(r))):s&&(n.opacity=rt(e.opacity??1,t.opacity??1,r));for(let o=0;o<yK;o++){const a=`border${kE[o]}Radius`;let c=t_(e,a),l=t_(t,a);if(c===void 0&&l===void 0)continue;c||(c=0),l||(l=0),c===0||l===0||e_(c)===e_(l)?(n[a]=Math.max(rt(Jv(c),Jv(l),r),0),(nr.test(l)||nr.test(c))&&(n[a]+="%")):n[a]=l}(e.rotate||t.rotate)&&(n.rotate=rt(e.rotate||0,t.rotate||0,r))}function t_(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const vK=LE(0,.5,_A),_K=LE(.5,.95,xn);function LE(n,e,t){return r=>r<n?0:r>e?1:t(Ya(n,e,r))}function n_(n,e){n.min=e.min,n.max=e.max}function Tn(n,e){n_(n.x,e.x),n_(n.y,e.y)}function r_(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function i_(n,e,t,r,i){return n-=e,n=Nu(n,1/t,r),i!==void 0&&(n=Nu(n,1/i,r)),n}function TK(n,e=0,t=1,r=.5,i,s=n,o=n){if(nr.test(e)&&(e=parseFloat(e),e=rt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=rt(s.min,s.max,r);n===s&&(a-=e),n.min=i_(n.min,e,t,a,i),n.max=i_(n.max,e,t,a,i)}function s_(n,e,[t,r,i],s,o){TK(n,e[t],e[r],e[i],e.scale,s,o)}const wK=["x","scaleX","originX"],SK=["y","scaleY","originY"];function o_(n,e,t,r){s_(n.x,e,wK,t?t.x:void 0,r?r.x:void 0),s_(n.y,e,SK,t?t.y:void 0,r?r.y:void 0)}function a_(n){return n.translate===0&&n.scale===1}function IE(n){return a_(n.x)&&a_(n.y)}function c_(n,e){return n.min===e.min&&n.max===e.max}function NK(n,e){return c_(n.x,e.x)&&c_(n.y,e.y)}function l_(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function OE(n,e){return l_(n.x,e.x)&&l_(n.y,e.y)}function u_(n){return jt(n.x)/jt(n.y)}function d_(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class AK{constructor(){this.members=[]}add(e){Rg(this.members,e),e.scheduleRender()}remove(e){if(Mg(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let r;for(let i=t;i>=0;i--){const s=this.members[i];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function EK(n,e,t){let r="";const i=n.x.translate/e.x,s=n.y.translate/e.y,o=t?.z||0;if((i||s||o)&&(r=`translate3d(${i}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:l,rotate:u,rotateX:d,rotateY:h,skewX:f,skewY:p}=t;l&&(r=`perspective(${l}px) ${r}`),u&&(r+=`rotate(${u}deg) `),d&&(r+=`rotateX(${d}deg) `),h&&(r+=`rotateY(${h}deg) `),f&&(r+=`skewX(${f}deg) `),p&&(r+=`skewY(${p}deg) `)}const a=n.x.scale*e.x,c=n.y.scale*e.y;return(a!==1||c!==1)&&(r+=`scale(${a}, ${c})`),r||"none"}const Yh=["","X","Y","Z"],CK=1e3;let RK=0;function Qh(n,e,t,r){const{latestValues:i}=e;i[n]&&(t[n]=i[n],e.setStaticValue(n,0),r&&(r[n]=0))}function UE(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=SE(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:s}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Je,!(i||s))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&UE(r)}function VE({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(o={},a=e?.()){this.id=RK++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(DK),this.nodes.forEach(LK),this.nodes.forEach(IK),this.nodes.forEach(BK)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new gK)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Bg),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const c=this.eventHandlers.get(o);c&&c.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=eE(o)&&!bq(o),this.instance=o;const{layoutId:a,layout:c,visualElement:l}=this.options;if(l&&!l.current&&l.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||a)&&(this.isLayoutDirty=!0),n){let u,d=0;const h=()=>this.root.updateBlockedByResize=!1;Je.read(()=>{d=window.innerWidth}),n(o,()=>{const f=window.innerWidth;f!==d&&(d=f,this.root.updateBlockedByResize=!0,u&&u(),u=xK(h,250),Ll.hasAnimatedSinceResize&&(Ll.hasAnimatedSinceResize=!1,this.nodes.forEach(p_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&l&&(a||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:d,hasRelativeLayoutChanged:h,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||l.getDefaultTransition()||$K,{onLayoutAnimationStart:m,onLayoutAnimationComplete:x}=l.getProps(),g=!this.targetLayout||!OE(this.targetLayout,f),y=!d&&h;if(this.options.layoutRoot||this.resumeFrom||y||d&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...Wg(p,"layout"),onPlay:m,onComplete:x};(l.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(u,y)}else d||p_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ci(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(OK),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&UE(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:c}=this.options;if(a===void 0&&!c)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(h_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(f_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(kK),this.nodes.forEach(MK),this.nodes.forEach(PK)):this.nodes.forEach(f_),this.clearAllSnapshots();const a=Yt.now();Et.delta=kr(0,1e3/60,a-Et.timestamp),Et.timestamp=a,Et.isProcessing=!0,Uh.update.process(Et),Uh.preRender.process(Et),Uh.render.process(Et),Et.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Xg.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(FK),this.sharedNodes.forEach(UK)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Je.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Je.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!jt(this.snapshot.measuredBox.x)&&!jt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=vt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const c=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!IE(this.projectionDelta),c=this.getTransformTemplate(),l=c?c(this.latestValues,""):void 0,u=l!==this.prevTransformTemplateValue;o&&this.instance&&(a||Pi(this.latestValues)||u)&&(i(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let c=this.removeElementScroll(a);return o&&(c=this.removeTransform(c)),jK(c),{animationId:this.root.animationId,measuredBox:a,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return vt();const a=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(zK))){const{scroll:l}=this.root;l&&(Os(a.x,l.offset.x),Os(a.y,l.offset.y))}return a}removeElementScroll(o){const a=vt();if(Tn(a,o),this.scroll?.wasRoot)return a;for(let c=0;c<this.path.length;c++){const l=this.path[c],{scroll:u,options:d}=l;l!==this.root&&u&&d.layoutScroll&&(u.wasRoot&&Tn(a,o),Os(a.x,u.offset.x),Os(a.y,u.offset.y))}return a}applyTransform(o,a=!1){const c=vt();Tn(c,o);for(let l=0;l<this.path.length;l++){const u=this.path[l];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Us(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Pi(u.latestValues)&&Us(c,u.latestValues)}return Pi(this.latestValues)&&Us(c,this.latestValues),c}removeTransform(o){const a=vt();Tn(a,o);for(let c=0;c<this.path.length;c++){const l=this.path[c];if(!l.instance||!Pi(l.latestValues))continue;$p(l.latestValues)&&l.updateSnapshot();const u=vt(),d=l.measurePageBox();Tn(u,d),o_(a,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,u)}return Pi(this.latestValues)&&o_(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Et.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==a;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:d}=this.options;if(!this.layout||!(u||d))return;this.resolvedRelativeTargetAt=Et.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=vt(),this.targetWithTransforms=vt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),YX(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Tn(this.target,this.layout.layoutBox),yE(this.target,this.targetDelta)):Tn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||$p(this.parent.latestValues)||xE(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vt(),this.relativeTargetOrigin=vt(),Au(this.relativeTargetOrigin,a,c),Tn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),a=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Et.timestamp&&(c=!1),c)return;const{layout:l,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(l||u))return;Tn(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,h=this.treeScale.y;cX(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=vt());const{target:f}=o;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(r_(this.prevProjectionDelta.x,this.projectionDelta.x),r_(this.prevProjectionDelta.y,this.projectionDelta.y)),Da(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==h||!d_(this.projectionDelta.x,this.prevProjectionDelta.x)||!d_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Vs(),this.projectionDelta=Vs(),this.projectionDeltaWithTransform=Vs()}setAnimationOrigin(o,a=!1){const c=this.snapshot,l=c?c.latestValues:{},u={...this.latestValues},d=Vs();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=vt(),f=c?c.source:void 0,p=this.layout?this.layout.source:void 0,m=f!==p,x=this.getStack(),g=!x||x.members.length<=1,y=!!(m&&!g&&this.options.crossfade===!0&&!this.path.some(GK));this.animationProgress=0;let v;this.mixTargetDelta=_=>{const T=_/1e3;m_(d.x,o.x,T),m_(d.y,o.y,T),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Au(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),VK(this.relativeTarget,this.relativeTargetOrigin,h,T),v&&NK(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=vt()),Tn(v,this.relativeTarget)),m&&(this.animationValues=u,bK(u,l,this.latestValues,T,y,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ci(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Je.update(()=>{Ll.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=xo(0)),this.currentAnimation=pK(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(CK),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:c,layout:l,latestValues:u}=o;if(!(!a||!c||!l)){if(this!==o&&this.layout&&l&&GE(this.options.animationType,this.layout.layoutBox,l.layoutBox)){c=this.target||vt();const d=jt(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+d;const h=jt(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}Tn(a,c),Us(a,u),Da(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new AK),this.sharedNodes.get(o).add(a);const l=a.options.initialPromotionConfig;a.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:c}={}){const l=this.getStack();l&&l.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(a=!0),!a)return;const l={};c.z&&Qh("z",o,l,this.animationValues);for(let u=0;u<Yh.length;u++)Qh(`rotate${Yh[u]}`,o,l,this.animationValues),Qh(`skew${Yh[u]}`,o,l,this.animationValues);o.render();for(const u in l)o.setStaticValue(u,l[u]),this.animationValues&&(this.animationValues[u]=l[u]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=kl(a?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const l=this.getLead();if(!this.projectionDelta||!this.layout||!l.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=kl(a?.pointerEvents)||""),this.hasProjected&&!Pi(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=l.animationValues||l.latestValues;this.applyTransformsToTarget();let d=EK(this.projectionDeltaWithTransform,this.treeScale,u);c&&(d=c(u,d)),o.transform=d;const{x:h,y:f}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${f.origin*100}% 0`,l.animationValues?o.opacity=l===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=l===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const p in ec){if(u[p]===void 0)continue;const{correct:m,applyTo:x,isCSSVariable:g}=ec[p],y=d==="none"?u[p]:m(u[p],l);if(x){const v=x.length;for(let _=0;_<v;_++)o[x[_]]=y}else g?this.options.visualElement.renderState.vars[p]=y:o[p]=y}this.options.layoutId&&(o.pointerEvents=l===this?kl(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(h_),this.root.sharedNodes.clear()}}}function MK(n){n.updateLayout()}function PK(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=n.layout,{animationType:i}=n.options,s=e.source!==n.layout.source;i==="size"?cn(u=>{const d=s?e.measuredBox[u]:e.layoutBox[u],h=jt(d);d.min=t[u].min,d.max=d.min+h}):GE(i,e.layoutBox,t)&&cn(u=>{const d=s?e.measuredBox[u]:e.layoutBox[u],h=jt(t[u]);d.max=d.min+h,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[u].max=n.relativeTarget[u].min+h)});const o=Vs();Da(o,t,e.layoutBox);const a=Vs();s?Da(a,n.applyTransform(r,!0),e.measuredBox):Da(a,t,e.layoutBox);const c=!IE(o);let l=!1;if(!n.resumeFrom){const u=n.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:d,layout:h}=u;if(d&&h){const f=vt();Au(f,e.layoutBox,d.layoutBox);const p=vt();Au(p,t,h.layoutBox),OE(f,p)||(l=!0),u.options.layoutRoot&&(n.relativeTarget=p,n.relativeTargetOrigin=f,n.relativeParent=u)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:a,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:l})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function DK(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function BK(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function FK(n){n.clearSnapshot()}function h_(n){n.clearMeasurements()}function f_(n){n.isLayoutDirty=!1}function kK(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function p_(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function LK(n){n.resolveTargetDelta()}function IK(n){n.calcProjection()}function OK(n){n.resetSkewAndRotation()}function UK(n){n.removeLeadSnapshot()}function m_(n,e,t){n.translate=rt(e.translate,0,t),n.scale=rt(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function g_(n,e,t,r){n.min=rt(e.min,t.min,r),n.max=rt(e.max,t.max,r)}function VK(n,e,t,r){g_(n.x,e.x,t.x,r),g_(n.y,e.y,t.y,r)}function GK(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const $K={duration:.45,ease:[.4,0,.1,1]},x_=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),y_=x_("applewebkit/")&&!x_("chrome/")?Math.round:xn;function b_(n){n.min=y_(n.min),n.max=y_(n.max)}function jK(n){b_(n.x),b_(n.y)}function GE(n,e,t){return n==="position"||n==="preserve-aspect"&&!KX(u_(e),u_(t),.2)}function zK(n){return n!==n.root&&n.scroll?.wasRoot}const HK=VE({attachResizeListener:(n,e)=>tc(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Zh={current:void 0},$E=VE({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Zh.current){const n=new HK({});n.mount(window),n.setOptions({layoutScroll:!0}),Zh.current=n}return Zh.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),WK={pan:{Feature:uK},drag:{Feature:lK,ProjectionNode:$E,MeasureLayout:FE}};function v_(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,s=r[i];s&&Je.postRender(()=>s(e,xc(e)))}class qK extends mi{mount(){const{current:e}=this.node;e&&(this.unmount=pq(e,(t,r)=>(v_(this.node,r,"Start"),i=>v_(this.node,i,"End"))))}unmount(){}}class XK extends mi{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pc(tc(this.node.current,"focus",()=>this.onFocus()),tc(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function __(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),s=r[i];s&&Je.postRender(()=>s(e,xc(e)))}class KK extends mi{mount(){const{current:e}=this.node;e&&(this.unmount=yq(e,(t,r)=>(__(this.node,r,"Start"),(i,{success:s})=>__(this.node,i,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Kp=new WeakMap,Jh=new WeakMap,YK=n=>{const e=Kp.get(n.target);e&&e(n)},QK=n=>{n.forEach(YK)};function ZK({root:n,...e}){const t=n||document;Jh.has(t)||Jh.set(t,{});const r=Jh.get(t),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(QK,{root:n,...e})),r[i]}function JK(n,e,t){const r=ZK(e);return Kp.set(n,t),r.observe(n),()=>{Kp.delete(n),r.unobserve(n)}}const eY={some:0,all:1};class tY extends mi{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:i="some",once:s}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:eY[i]},a=c=>{const{isIntersecting:l}=c;if(this.isInView===l||(this.isInView=l,s&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=l?u:d;h&&h(c)};return JK(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(nY(e,t))&&this.startObserver()}unmount(){}}function nY({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const rY={inView:{Feature:tY},tap:{Feature:KK},focus:{Feature:XK},hover:{Feature:qK}},iY={layout:{ProjectionNode:$E,MeasureLayout:FE}},sY={...jX,...rY,...WK,...iY},ma=sX(sY,yX),oY={activity:si,shield:fm,zap:pm,dollar:_T},aY={cyan:"text-cyan-400 border-cyan-500/30 bg-cyan-500/5",rose:"text-rose-400 border-rose-500/30 bg-rose-500/5",amber:"text-amber-400 border-amber-500/30 bg-amber-500/5",emerald:"text-emerald-400 border-emerald-500/30 bg-emerald-500/5"},cY={cyan:"shadow-[0_0_15px_rgba(34,211,238,0.2)]",rose:"shadow-[0_0_15px_rgba(251,113,133,0.2)]",amber:"shadow-[0_0_15px_rgba(251,191,36,0.2)]",emerald:"shadow-[0_0_15px_rgba(52,211,153,0.2)]"};function fl({label:n,value:e,subValue:t,icon:r,color:i}){const s=oY[r];return b.jsxs(ma.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02},className:`relative overflow-hidden rounded-xl border ${aY[i]} ${cY[i]} backdrop-blur-md p-4 flex flex-col justify-between h-32`,children:[b.jsx(ma.div,{className:"absolute -inset-10 opacity-20 blur-2xl",animate:{rotate:[0,360],scale:[.8,1.1,.8]},transition:{duration:10,repeat:1/0,ease:"linear"},style:{background:"conic-gradient(from 0deg, transparent, currentColor, transparent)"}}),b.jsxs("div",{className:"relative z-10 flex justify-between items-start",children:[b.jsx("span",{className:"text-sm font-medium tracking-wider uppercase opacity-70",children:n}),b.jsx(ma.div,{animate:{scale:[1,1.2,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:b.jsx(s,{size:18})})]}),b.jsxs("div",{className:"relative z-10 mt-2",children:[b.jsx(nE,{mode:"wait",children:b.jsx(ma.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-3xl font-bold font-mono tracking-tight",children:e},String(e))}),t&&b.jsx("div",{className:"text-xs mt-1 font-mono opacity-60",children:t})]})]})}function lY({traces:n}){return b.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 backdrop-blur-xl h-[500px] overflow-hidden flex flex-col w-full shadow-2xl",children:[b.jsxs("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[b.jsxs("h3",{className:"font-mono text-sm uppercase tracking-widest text-white/70 flex items-center gap-2",children:[b.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),"Live Neural Feed"]}),b.jsx("span",{className:"text-xs text-white/30 font-mono",children:"Real-time Ingestion"})]}),b.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 relative no-scrollbar",children:[b.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(transparent_0%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_4px] opacity-20"}),b.jsx(nE,{initial:!1,children:n.map(e=>b.jsxs(ma.div,{initial:{x:-20,opacity:0,filter:"blur(10px)"},animate:{x:0,opacity:1,filter:"blur(0px)"},exit:{opacity:0,scale:.9},transition:{type:"spring",stiffness:300,damping:30},className:`
                group relative flex items-center gap-4 p-3 rounded-lg border 
                ${e.type==="hit"?"border-emerald-500/20 bg-emerald-500/5 hover:bg-emerald-500/10":""}
                ${e.type==="miss"?"border-blue-500/20 bg-blue-500/5 hover:bg-blue-500/10":""}
                ${e.type==="error"?"border-rose-500/20 bg-rose-500/5 hover:bg-rose-500/10":""}
                transition-colors duration-300
              `,children:[b.jsx("div",{className:`
                    w-1 h-full absolute left-0 top-0 bottom-0 rounded-l-lg
                    ${e.type==="hit"?"bg-emerald-500":""}
                    ${e.type==="miss"?"bg-blue-500":""}
                    ${e.type==="error"?"bg-rose-500":""}
                    opacity-50 group-hover:opacity-100 transition-opacity
                `}),b.jsxs("div",{className:"p-2 rounded-md bg-white/5",children:[e.type==="hit"&&b.jsx(uY,{className:"w-4 h-4 text-emerald-400"}),e.type==="miss"&&b.jsx(yR,{className:"w-4 h-4 text-blue-400"}),e.type==="error"&&b.jsx(GR,{className:"w-4 h-4 text-rose-400"})]}),b.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 items-center",children:[b.jsxs("div",{className:"col-span-4",children:[b.jsx("div",{className:"text-sm font-medium text-white/90 font-mono truncate",children:e.model}),b.jsx("div",{className:"text-[10px] text-white/40 uppercase tracking-wide",children:e.id.slice(0,8)})]}),b.jsxs("div",{className:"col-span-4 flex items-center gap-2",children:[b.jsx(zR,{className:"w-3 h-3 text-white/30"}),b.jsxs("span",{className:`text-xs font-mono ${e.latency<100?"text-emerald-400":"text-amber-400"}`,children:[e.latency,"ms"]})]}),b.jsx("div",{className:"col-span-4 flex justify-end items-center gap-1",children:e.type==="hit"?b.jsxs("span",{className:"text-xs font-bold text-emerald-400 flex items-center bg-emerald-500/10 px-2 py-0.5 rounded-full",children:[b.jsx(_T,{className:"w-3 h-3"}),"SAVED"]}):b.jsxs("span",{className:"text-xs text-white/30",children:["$ ",e.cost.toFixed(5)]})})]}),b.jsx("div",{className:"absolute inset-0 rounded-lg group-hover:shadow-[0_0_20px_rgba(255,255,255,0.05)] pointer-events-none transition-shadow"})]},e.id))}),n.length===0&&b.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/20 gap-2",children:[b.jsx(pR,{className:"w-8 h-8 opacity-20"}),b.jsx("span",{className:"text-xs font-mono",children:"Awaiting Neural Signals..."})]})]})]})}function uY({className:n}){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:b.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}function dY(){const{token:n}=Co(),[e,t]=E.useState({requests:0,hitRate:0,tokensSaved:0,costSaved:0,latency:0}),[r,i]=E.useState([]);return E.useEffect(()=>{const s=async()=>{try{const c=await(await fetch("/api/observability/stats")).json();c.error||t(c)}catch(a){console.error("Stats Error:",a)}};s();const o=setInterval(s,5e3);return()=>clearInterval(o)},[]),E.useEffect(()=>{const s=new EventSource("/api/observability/stream");return s.onmessage=o=>{try{const a=JSON.parse(o.data);if(a.type==="traces"&&Array.isArray(a.data)){const c=a.data.map(l=>typeof l=="string"?JSON.parse(l):l);i(l=>{const u=new Set(l.map(h=>h.id)),d=c.filter(h=>!u.has(h.id));return d.length===0?l:[...d,...l].slice(0,50)})}}catch(a){console.error("Stream Parse Error:",a)}},()=>s.close()},[]),b.jsxs("div",{className:"flex flex-col gap-8 h-full",children:[b.jsxs("div",{className:"flex justify-between items-end border-b border-white/5 pb-4",children:[b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-emerald-400",children:"Neural Glass"}),b.jsx("p",{className:"text-xs font-mono text-white/40 uppercase tracking-widest mt-1",children:"System Observability Deck"})]}),b.jsx("div",{className:"flex gap-2",children:b.jsx("span",{className:"px-2 py-1 rounded bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs font-mono animate-pulse",children:"LIVE"})})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[b.jsx(fl,{label:"Cache Hit Rate",value:`${e.hitRate}%`,subValue:"Global Efficiency",icon:"activity",color:"cyan"}),b.jsx(fl,{label:"Est. Savings",value:`$${e.costSaved.toFixed(2)}`,subValue:"Today's ROI",icon:"dollar",color:"emerald"}),b.jsx(fl,{label:"Tokens Saved",value:`${(e.tokensSaved/1e3).toFixed(1)}k`,subValue:"Bandwidth Preserved",icon:"shield",color:"amber"}),b.jsx(fl,{label:"Avg Latency",value:`${e.latency}ms`,subValue:"Edge Performance",icon:"zap",color:"rose"})]}),b.jsx("div",{className:"flex-1 min-h-[400px]",children:b.jsx(lY,{traces:r})})]})}function hY(n){return n}var fY=4,T_=1e-6;function pY(n){return"translate(0,"+n+")"}function mY(n){return e=>+n(e)}function gY(n,e){return e=Math.max(0,n.bandwidth()-e*2)/2,n.round()&&(e=Math.round(e)),t=>+n(t)+e}function xY(){return!this.__axis}function yY(n,e){var t=[],r=null,i=null,s=6,o=6,a=3,c=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=-1,u="x",d=pY;function h(f){var p=r??(e.ticks?e.ticks.apply(e,t):e.domain()),m=i??(e.tickFormat?e.tickFormat.apply(e,t):hY),x=Math.max(s,0)+a,g=e.range(),y=+g[0]+c,v=+g[g.length-1]+c,_=(e.bandwidth?gY:mY)(e.copy(),c),T=f.selection?f.selection():f,w=T.selectAll(".domain").data([null]),N=T.selectAll(".tick").data(p,e).order(),S=N.exit(),C=N.enter().append("g").attr("class","tick"),B=N.select("line"),D=N.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),N=N.merge(C),B=B.merge(C.append("line").attr("stroke","currentColor").attr(u+"2",l*s)),D=D.merge(C.append("text").attr("fill","currentColor").attr(u,l*x).attr("dy","0.32em")),f!==T&&(w=w.transition(f),N=N.transition(f),B=B.transition(f),D=D.transition(f),S=S.transition(f).attr("opacity",T_).attr("transform",function(U){return isFinite(U=_(U))?d(U+c):this.getAttribute("transform")}),C.attr("opacity",T_).attr("transform",function(U){var $=this.parentNode.__axis;return d(($&&isFinite($=$(U))?$:_(U))+c)})),S.remove(),w.attr("d",o?"M"+l*o+","+y+"H"+c+"V"+v+"H"+l*o:"M"+c+","+y+"V"+v),N.attr("opacity",1).attr("transform",function(U){return d(_(U)+c)}),B.attr(u+"2",l*s),D.attr(u,l*x).text(m),T.filter(xY).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","end"),T.each(function(){this.__axis=_})}return h.scale=function(f){return arguments.length?(e=f,h):e},h.ticks=function(){return t=Array.from(arguments),h},h.tickArguments=function(f){return arguments.length?(t=f==null?[]:Array.from(f),h):t.slice()},h.tickValues=function(f){return arguments.length?(r=f==null?null:Array.from(f),h):r&&r.slice()},h.tickFormat=function(f){return arguments.length?(i=f,h):i},h.tickSize=function(f){return arguments.length?(s=o=+f,h):s},h.tickSizeInner=function(f){return arguments.length?(s=+f,h):s},h.tickSizeOuter=function(f){return arguments.length?(o=+f,h):o},h.tickPadding=function(f){return arguments.length?(a=+f,h):a},h.offset=function(f){return arguments.length?(c=+f,h):c},h}function bY(n){return yY(fY,n)}const Yp=Math.PI,Qp=2*Yp,Di=1e-6,vY=Qp-Di;function jE(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}function _Y(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return jE;const t=10**e;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*t)/t+r[i]}}class TY{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?jE:_Y(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,i){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,t,r,i,s,o){this._append`C${+e},${+t},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(e,t,r,i,s){if(e=+e,t=+t,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,c=r-e,l=i-t,u=o-e,d=a-t,h=u*u+d*d;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(h>Di)if(!(Math.abs(d*c-l*u)>Di)||!s)this._append`L${this._x1=e},${this._y1=t}`;else{let f=r-o,p=i-a,m=c*c+l*l,x=f*f+p*p,g=Math.sqrt(m),y=Math.sqrt(h),v=s*Math.tan((Yp-Math.acos((m+h-x)/(2*g*y)))/2),_=v/y,T=v/g;Math.abs(_-1)>Di&&this._append`L${e+_*u},${t+_*d}`,this._append`A${s},${s},0,0,${+(d*f>u*p)},${this._x1=e+T*c},${this._y1=t+T*l}`}}arc(e,t,r,i,s,o){if(e=+e,t=+t,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),c=r*Math.sin(i),l=e+a,u=t+c,d=1^o,h=o?i-s:s-i;this._x1===null?this._append`M${l},${u}`:(Math.abs(this._x1-l)>Di||Math.abs(this._y1-u)>Di)&&this._append`L${l},${u}`,r&&(h<0&&(h=h%Qp+Qp),h>vY?this._append`A${r},${r},0,1,${d},${e-a},${t-c}A${r},${r},0,1,${d},${this._x1=l},${this._y1=u}`:h>Di&&this._append`A${r},${r},0,${+(h>=Yp)},${d},${this._x1=e+r*Math.cos(s)},${this._y1=t+r*Math.sin(s)}`)}rect(e,t,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function Rs(n){return function(){return n}}function wY(n){let e=3;return n.digits=function(t){if(!arguments.length)return e;if(t==null)e=null;else{const r=Math.floor(t);if(!(r>=0))throw new RangeError(`invalid digits: ${t}`);e=r}return n},()=>new TY(e)}function SY(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function zE(n){this._context=n}zE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,e){switch(n=+n,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,e):this._context.moveTo(n,e);break;case 1:this._point=2;default:this._context.lineTo(n,e);break}}};function NY(n){return new zE(n)}function AY(n){return n[0]}function EY(n){return n[1]}function CY(n,e){var t=Rs(!0),r=null,i=NY,s=null,o=wY(a);n=typeof n=="function"?n:n===void 0?AY:Rs(n),e=typeof e=="function"?e:e===void 0?EY:Rs(e);function a(c){var l,u=(c=SY(c)).length,d,h=!1,f;for(r==null&&(s=i(f=o())),l=0;l<=u;++l)!(l<u&&t(d=c[l],l,c))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+n(d,l,c),+e(d,l,c));if(f)return s=null,f+""||null}return a.x=function(c){return arguments.length?(n=typeof c=="function"?c:Rs(+c),a):n},a.y=function(c){return arguments.length?(e=typeof c=="function"?c:Rs(+c),a):e},a.defined=function(c){return arguments.length?(t=typeof c=="function"?c:Rs(!!c),a):t},a.curve=function(c){return arguments.length?(i=c,r!=null&&(s=i(r)),a):i},a.context=function(c){return arguments.length?(c==null?r=s=null:s=i(r=c),a):r},a}const RY=({data:n,dimensions:e,colorBy:t="fitness"})=>{const r=E.useRef(null),[i,s]=E.useState({width:0,height:0});return E.useEffect(()=>{const o=()=>{if(r.current){const a=r.current.parentElement.getBoundingClientRect();s({width:a.width,height:a.height})}};return window.addEventListener("resize",o),o(),()=>window.removeEventListener("resize",o)},[]),E.useEffect(()=>{if(!n||n.length===0||!r.current||i.width===0)return;const o=gt(r.current);o.selectAll("*").remove();const a={top:30,right:10,bottom:10,left:10},c=i.width-a.left-a.right,l=i.height-a.top-a.bottom,u=o.append("g").attr("transform",`translate(${a.left},${a.top})`),d=e||Object.keys(n[0]).filter(x=>typeof n[0][x]=="number"&&x!=="id"),h={};d.forEach(x=>{h[x]=T1().domain(Hx(n,g=>g[x])).range([l,0])});const f=nO().range([0,c]).padding(1).domain(d),p=x=>CY()(d.map(g=>[f(g),h[g](x[g])])),m=w1(EO).domain(Hx(n,x=>x[t]));u.selectAll("myPath").data(n).enter().append("path").attr("d",p).style("fill","none").style("stroke",x=>m(x[t])).style("opacity",.6).style("stroke-width",1.5).on("mouseover",function(x,g){gt(this).style("stroke-width",4).style("opacity",1)}).on("mouseout",function(x,g){gt(this).style("stroke-width",1.5).style("opacity",.6)}),u.selectAll("myAxis").data(d).enter().append("g").attr("transform",x=>`translate(${f(x)})`).each(function(x){gt(this).call(bY(h[x]))}).attr("color","#64748b").style("font-family","monospace").append("text").style("text-anchor","middle").attr("y",-9).text(x=>x.toUpperCase()).style("fill","#00f3ff").style("font-weight","bold")},[n,e,i]),b.jsx("svg",{ref:r,className:"w-full h-full"})};function MY(){const{token:n}=Co(),[e,t]=E.useState([]),[r,i]=E.useState(null);return E.useRef(null),E.useEffect(()=>{if(!n)return;(async()=>{try{const a=await(await fetch("/api/lab/genomes?limit=20",{headers:{Authorization:`Bearer ${n}`}})).json();a.genomes&&a.genomes.length>0&&(t(a.genomes),i(a.genomes[0]))}catch(o){console.error("Failed to fetch genomes:",o)}})()},[n]),b.jsxs("div",{className:"h-[calc(100vh-8rem)] flex gap-6",children:[b.jsx("div",{className:"w-80 flex flex-col gap-4",children:b.jsxs(He,{title:"Evolutionary Lab",icon:TT,className:"flex-1 flex flex-col",children:[b.jsxs("div",{className:"text-xs text-[var(--hud-text-dim)] mb-4",children:["Observing Generation ",b.jsx("span",{className:"text-[var(--hud-accent)] font-mono",children:e.length>0?e[0].generation:0})]}),b.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2",children:e.map(s=>b.jsxs("div",{onClick:()=>i(s),className:`p-3 rounded border cursor-pointer transition-all ${r?.id===s.id?"bg-[var(--hud-accent)]/10 border-[var(--hud-accent)] shadow-[0_0_10px_var(--hud-accent)]":"bg-black border-[var(--hud-border)] hover:border-[var(--hud-text)]"}`,children:[b.jsxs("div",{className:"flex justify-between items-center mb-1",children:[b.jsxs("span",{className:"text-xs font-mono text-[var(--hud-text-dim)]",children:["Gen ",s.generation]}),b.jsxs("span",{className:"text-xs font-bold text-[var(--hud-success)]",children:["Fit: ",Math.round(s.fitness||0)]})]}),b.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] truncate font-mono",children:s.id.split("-").pop()}),b.jsx("div",{className:"mt-2 flex gap-1 overflow-hidden opacity-50",children:s.phenotype?.slice(0,5).map((o,a)=>b.jsx("div",{className:"w-1 h-3 rounded-full bg-[var(--hud-text-dim)]",title:o},a))})]},s.id))})]})}),b.jsx("div",{className:"flex-1 flex flex-col gap-6",children:b.jsxs(He,{className:"flex-1 relative overflow-hidden p-0",children:[b.jsxs("div",{className:"absolute top-4 left-4 z-10 pointer-events-none",children:[b.jsxs("h1",{className:"text-xl font-bold text-white tracking-tight flex items-center gap-2",children:[b.jsx(si,{size:20,className:"text-[var(--hud-accent)]"}),"Multi-Objective Fitness Landscape"]}),b.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs font-mono",children:"Parallel Coordinates: Generation vs Fitness vs Complexity"})]}),b.jsx("div",{className:"w-full h-full pt-16 pb-8 px-8 bg-black/50",children:e.length>0?b.jsx(RY,{data:e.map(s=>({...s,generation:s.generation,fitness:s.fitness,complexity:Math.random()*100,latency:Math.random()*500})),dimensions:["generation","fitness","complexity","latency"],colorBy:"fitness"}):b.jsx("div",{className:"flex items-center justify-center h-full text-[var(--hud-text-dim)]",children:"awaiting genome data..."})})]})})]})}const PY=({nodes:n})=>{const e=E.useRef(null),[t,r]=E.useState({width:0,height:0});return E.useEffect(()=>{const i=()=>{if(e.current){const s=e.current.parentElement.getBoundingClientRect();r({width:s.width,height:s.height})}};return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),E.useEffect(()=>{if(!n||n.length===0||!e.current||t.width===0)return;const i=t.width,s=t.height,o=gt(e.current);o.selectAll("*").remove();const a=n.map(d=>{if(d.x&&d.y)return d;const h=d.id.split("").reduce((f,p)=>f+p.charCodeAt(0),0);return{...d,x:(Math.sin(h)*.4+.5)*i,y:(Math.cos(h)*.4+.5)*s,cluster:h%5}}),c=o.append("g"),l=tw().scaleExtent([.5,4]).on("zoom",d=>{c.attr("transform",d.transform)});o.call(l);const u=zu(NO);c.selectAll("circle").data(a).join("circle").attr("cx",d=>d.x).attr("cy",d=>d.y).attr("r",5).attr("fill",d=>u(d.cluster)).attr("stroke","#000").attr("stroke-width",1).attr("opacity",.8).on("mouseover",function(d,h){gt(this).transition().duration(200).attr("r",10).attr("stroke","#fff"),c.append("text").attr("id","tooltip").attr("x",h.x+15).attr("y",h.y).text(h.name||h.key).attr("fill","#fff").style("font-size","12px").style("font-family","monospace").style("pointer-events","none").style("text-shadow","0 0 5px #000")}).on("mouseout",function(){gt(this).transition().duration(200).attr("r",5).attr("stroke","#000"),gt("#tooltip").remove()})},[n,t]),b.jsx("svg",{ref:e,className:"w-full h-full bg-black/40 rounded-lg"})};function DY(){const[n,e]=E.useState("activity"),[t,r]=E.useState([]),[i,s]=E.useState(!1),[o,a]=E.useState(""),[c,l]=E.useState(null);E.useEffect(()=>{n==="inspector"&&u()},[n]);const u=async()=>{s(!0);try{const f=await(await fetch("/api/explorer/nodes?limit=50")).json();f.nodes&&r(f.nodes)}catch(h){console.error(h)}finally{s(!1)}},d=async()=>{if(o.trim()){s(!0);try{const f=await(await fetch("/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o})})).json();l(f)}catch(h){l({error:h.message})}finally{s(!1)}}};return b.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col gap-6",children:[b.jsx("div",{className:"flex items-center justify-between",children:b.jsx("div",{className:"flex gap-2 bg-black/50 p-1 rounded-lg border border-[var(--hud-border)]",children:[{id:"activity",label:"Cache Activity",icon:si},{id:"inspector",label:"Cache Inspector",icon:Hl},{id:"embeddings",label:"Vector Lab",icon:_0}].map(h=>b.jsxs("button",{onClick:()=>e(h.id),className:`px-4 py-2 rounded flex items-center gap-2 text-sm font-bold transition-all ${n===h.id?"bg-[var(--hud-accent)] text-black shadow-[0_0_10px_var(--hud-accent)]":"text-[var(--hud-text-dim)] hover:text-white hover:bg-[rgba(255,255,255,0.05)]"}`,children:[b.jsx(h.icon,{size:16}),h.label]},h.id))})}),b.jsxs("div",{className:"flex-1 overflow-hidden",children:[n==="activity"&&b.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[b.jsxs("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-6",children:[b.jsxs(He,{className:"bg-[rgba(0,255,128,0.05)] border-[var(--hud-success)]",children:[b.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Global Hit Rate"}),b.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-success)]",children:"94.2%"}),b.jsxs("div",{className:"text-xs text-[var(--hud-success)] mt-2 flex items-center gap-1",children:[b.jsx(vT,{size:12,className:"-rotate-45"})," +2.4% this week"]})]}),b.jsxs(He,{children:[b.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Data Cached"}),b.jsx("div",{className:"text-3xl font-mono font-bold text-white",children:"4.2 TB"})]}),b.jsxs(He,{children:[b.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Requests Served"}),b.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-accent)]",children:"8.4M"})]}),b.jsxs(He,{children:[b.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Avg Latency"}),b.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-accent-secondary)]",children:"12ms"})]})]}),b.jsxs(He,{title:"Throughput Analysis",className:"lg:col-span-2",children:[b.jsx("div",{className:"h-64 flex items-end justify-between gap-2 px-4 pb-4 border-b border-[var(--hud-border)]",children:[40,65,45,80,55,90,70].map((h,f)=>b.jsx("div",{className:"w-full bg-[var(--hud-accent)]/20 hover:bg-[var(--hud-accent)]/40 transition-colors rounded-t relative group",style:{height:`${h}%`},children:b.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-black border border-[var(--hud-border)] px-2 py-1 text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10",children:[h*100," req/s"]})},f))}),b.jsxs("div",{className:"flex justify-between mt-2 text-xs text-[var(--hud-text-dim)] font-mono px-4",children:[b.jsx("span",{children:"MON"}),b.jsx("span",{children:"TUE"}),b.jsx("span",{children:"WED"}),b.jsx("span",{children:"THU"}),b.jsx("span",{children:"FRI"}),b.jsx("span",{children:"SAT"}),b.jsx("span",{children:"SUN"})]})]}),b.jsx(He,{title:"Top Agents",className:"lg:col-span-1",children:b.jsx(Wl,{columns:[{header:"Agent",accessor:"agent"},{header:"Ops/Sec",accessor:"ops",render:h=>b.jsx("span",{className:"text-[var(--hud-success)] font-mono",children:h.ops})}],data:[{agent:"Clinical-Bot-1",ops:"1,204"},{agent:"Trading-Alpha",ops:"940"},{agent:"Legal-Reviewer",ops:"850"},{agent:"Support-Swarm",ops:"420"}]})})]}),n==="inspector"&&b.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[b.jsx("div",{className:"lg:col-span-2 flex flex-col",children:b.jsxs(He,{title:"Knowledge Lattice (Public/Community)",icon:si,className:"flex-1 relative overflow-hidden p-0",children:[b.jsx("div",{className:"absolute top-0 left-0 w-full h-full",children:b.jsx(PY,{nodes:t})}),i&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-20 backdrop-blur-sm",children:b.jsx("div",{className:"text-[var(--hud-accent)] animate-pulse font-mono",children:"SCANNING SECTOR..."})})]})}),b.jsx(He,{title:"Node Inspector",icon:Hl,className:"h-full flex flex-col",children:b.jsx("div",{className:"flex-1 overflow-hidden",children:b.jsx(Wl,{columns:[{header:"ID",accessor:"id",render:h=>b.jsxs("span",{className:"font-mono text-xs text-[var(--hud-text-dim)]",children:[h.id.substring(0,6),"..."]})},{header:"Key / Topic",accessor:"key",render:h=>b.jsx("span",{className:"text-white truncate max-w-[150px] block",children:h.key||h.prompt||"Untitled"})},{header:"Conf.",accessor:"confidence",render:h=>b.jsxs("span",{className:"text-[var(--hud-success)] font-mono",children:[(h.confidence*100).toFixed(0),"%"]})}],data:t})})})]}),n==="embeddings"&&b.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[b.jsx(He,{title:"Vector Laboratory",icon:_0,children:b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"text-xs text-[var(--hud-text-dim)] uppercase tracking-wider mb-2 block",children:"Input Text"}),b.jsx("textarea",{value:o,onChange:h=>a(h.target.value),className:"w-full h-32 bg-black border border-[var(--hud-border)] rounded p-3 text-sm focus:border-[var(--hud-accent)] focus:outline-none transition-colors",placeholder:"Enter text to vectorize..."})]}),b.jsxs("button",{onClick:d,disabled:i,className:"btn-cyber btn-cyber-primary w-full py-3 font-bold flex items-center justify-center gap-2",children:[i?b.jsx(Af,{className:"animate-spin",size:16}):b.jsx(Af,{size:16}),"GENERATE VECTOR"]})]})}),b.jsx(He,{title:"Vector Output",className:"font-mono text-xs",children:c?b.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar space-y-4",children:[b.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-[rgba(255,255,255,0.05)]",children:[b.jsx("span",{className:"text-[var(--hud-text-dim)]",children:"Status"}),b.jsx("span",{className:c.cached?"text-[var(--hud-success)]":"text-[var(--hud-warning)]",children:c.cached?"CACHE HIT":"CACHE MISS"})]}),b.jsxs("div",{children:[b.jsx("div",{className:"text-[var(--hud-text-dim)] mb-1",children:"Vector Preview (First 50 dims)"}),b.jsxs("div",{className:"p-3 rounded bg-black border border-[var(--hud-border)] text-[var(--hud-accent)] break-all leading-relaxed",children:["[",c.embedding?.slice(0,50).map(h=>h.toFixed(4)).join(", "),"...]"]})]})]}):b.jsx("div",{className:"h-full flex items-center justify-center text-[var(--hud-text-dim)] italic",children:"Waiting for input..."})})]})]})]})}const BY=[{id:"Darwin",icon:"",label:"Darwin",desc:"Survival of the fittest. High mutation, ruthless culling.",color:"text-orange-400",border:"border-orange-500/50",bg:"bg-orange-500/10"},{id:"Utopia",icon:"",label:"Utopia",desc:"High cooperation, shared rewards, altruistic caching.",color:"text-cyan-400",border:"border-cyan-500/50",bg:"bg-cyan-500/10"},{id:"WallStreet",icon:"",label:"Wall Street",desc:"Profit maximization. High competition for tokens.",color:"text-emerald-400",border:"border-emerald-500/50",bg:"bg-emerald-500/10"},{id:"ArtistColony",icon:"",label:"Artist Colony",desc:"High temperature, novelty seeking, creative risks.",color:"text-pink-400",border:"border-pink-500/50",bg:"bg-pink-500/10"},{id:"DoomerPrepper",icon:"",label:"Doomer Prepper",desc:"Extreme safety, redundancy, low risk tolerance.",color:"text-slate-400",border:"border-slate-500/50",bg:"bg-slate-500/10"}];function FY(){const{token:n}=Co(),[e,t]=E.useState(null),[r,i]=E.useState(null),[s,o]=E.useState(!0),[a,c]=E.useState(!1);E.useEffect(()=>{if(!n)return;(async()=>{try{const d={Authorization:`Bearer ${n}`},[h,f,p,m]=await Promise.all([fetch("/api/governance/org",{headers:d}),fetch("/api/governance/members",{headers:d}),fetch("/api/governance/keys",{headers:d}),fetch("/api/governance/presets",{headers:d})]);if(!h.ok)throw new Error("Failed to fetch org data");const x=await h.json(),g=await f.json(),y=await p.json(),v=await m.json();i({...x,members:g.members||[],apiKeys:y.apiKeys||[]}),t(v.mode||"Default")}catch(d){console.error("Failed to fetch governance data:",d)}finally{o(!1)}})()},[n]);const l=async u=>{c(!0);try{(await fetch("/api/governance/presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:u,parameters:{timestamp:Date.now()}})})).ok&&t(u)}catch(d){console.error("Failed to switch mode:",d)}finally{c(!1)}};return s?b.jsx("div",{className:"p-8 text-slate-400",children:"Loading governance data..."}):b.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[b.jsxs("header",{className:"mb-8",children:[b.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Governance"}),b.jsxs("p",{className:"text-slate-400",children:["Organization settings, access control, and ",b.jsx("span",{className:"text-purple-400",children:"Reality Switching"}),"."]})]}),b.jsxs("section",{className:"mb-12",children:[b.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[b.jsx("span",{className:"text-purple-500",children:""})," Reality Switcher",b.jsx("span",{className:"text-xs font-normal text-slate-500 ml-2 border border-slate-700 px-2 py-0.5 rounded",children:"Global Simulation Parameters"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:BY.map(u=>{const d=e===u.id;return b.jsxs("button",{onClick:()=>l(u.id),disabled:a,className:`relative p-4 rounded-xl border text-left transition-all ${d?`${u.bg} ${u.border} shadow-[0_0_20px_rgba(0,0,0,0.3)] scale-[1.02]`:"bg-slate-900/40 border-slate-800 hover:border-slate-600 hover:bg-slate-800/60"}`,children:[d&&b.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.8)]"}),b.jsx("div",{className:"text-2xl mb-2",children:u.icon}),b.jsx("div",{className:`font-bold mb-1 ${d?"text-white":"text-slate-300"}`,children:u.label}),b.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:u.desc})]},u.id)})})]}),b.jsx("div",{className:"border-t border-slate-800/50 my-8"}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[b.jsxs("div",{className:"lg:col-span-2 bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[b.jsxs("div",{className:"flex justify-between items-start mb-6",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"text-xl font-bold text-white",children:r.name}),b.jsxs("div",{className:"text-sm text-slate-500 font-mono mt-1",children:["ID: ",r.id]})]}),b.jsxs("span",{className:"px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-xs font-bold border border-purple-500/30",children:[r.plan.toUpperCase()," PLAN"]})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[b.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Your Role"}),b.jsx("div",{className:"font-semibold text-green-400",children:r.role})]}),b.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[b.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Region"}),b.jsx("div",{className:"font-semibold text-white",children:"US-East (N. Virginia)"})]})]})]}),b.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[b.jsx("h3",{className:"text-lg font-bold mb-4",children:"Compliance"}),b.jsxs("div",{className:"space-y-3",children:[b.jsx(ef,{label:"SOC 2 Type II",status:"active"}),b.jsx(ef,{label:"GDPR",status:"active"}),b.jsx(ef,{label:"HIPAA",status:"pending"})]})]})]}),b.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 mb-8",children:[b.jsxs("div",{className:"flex justify-between items-center mb-6",children:[b.jsx("h3",{className:"text-lg font-bold",children:"Team Members"}),b.jsx("button",{className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Invite Member"})]}),b.jsx("div",{className:"overflow-x-auto",children:b.jsxs("table",{className:"w-full text-left text-sm",children:[b.jsx("thead",{children:b.jsxs("tr",{className:"border-b border-slate-800 text-slate-400",children:[b.jsx("th",{className:"pb-3 pl-2",children:"User"}),b.jsx("th",{className:"pb-3",children:"Role"}),b.jsx("th",{className:"pb-3",children:"2FA"}),b.jsx("th",{className:"pb-3 text-right pr-2",children:"Actions"})]})}),b.jsx("tbody",{className:"divide-y divide-slate-800",children:r.members.map(u=>b.jsxs("tr",{className:"group hover:bg-slate-800/30 transition-colors",children:[b.jsxs("td",{className:"py-3 pl-2",children:[b.jsx("div",{className:"font-medium text-white",children:u.name}),b.jsx("div",{className:"text-slate-500",children:u.email})]}),b.jsx("td",{className:"py-3",children:b.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize
                      ${u.role==="owner"?"bg-purple-500/10 text-purple-400":u.role==="admin"?"bg-blue-500/10 text-blue-400":"bg-slate-700/50 text-slate-400"}`,children:u.role})}),b.jsx("td",{className:"py-3",children:b.jsx("span",{className:"text-green-400",children:"Enabled"})}),b.jsx("td",{className:"py-3 text-right pr-2",children:b.jsx("button",{className:"text-slate-500 hover:text-white",children:""})})]},u.id))})]})})]}),b.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[b.jsx("h3",{className:"text-lg font-bold mb-4",children:"Active API Keys"}),b.jsx("div",{className:"space-y-3",children:r.apiKeys.map((u,d)=>b.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950 rounded-lg border border-slate-800",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("div",{className:"w-8 h-8 rounded bg-slate-900 flex items-center justify-center text-slate-400",children:""}),b.jsxs("div",{children:[b.jsxs("div",{className:"font-mono text-sm text-white",children:[u.prefix,"****************"]}),b.jsxs("div",{className:"text-xs text-slate-500",children:["Created ",u.created]})]})]}),b.jsx("div",{className:"flex gap-2",children:u.scopes.map(h=>b.jsx("span",{className:"px-2 py-1 bg-slate-800 text-slate-300 text-xs rounded border border-slate-700",children:h},h))})]},d))})]})]})}function ef({label:n,status:e}){const t={active:"bg-green-500",pending:"bg-yellow-500",inactive:"bg-slate-500"};return b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-sm text-slate-300",children:n}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:`w-2 h-2 rounded-full ${t[e]}`}),b.jsx("span",{className:"text-xs text-slate-500 capitalize",children:e})]})]})}const w_={healthcare:[{id:"patient_records",title:" Patient Records",description:"Cache medical records with HIPAA compliance",prompt:"Cache patient medical records with HIPAA compliance and PHI detection",nodes:["input","phi_filter","cache_l1","cache_l2","hipaa_audit","openai","output"]},{id:"clinical_decision",title:" Clinical Decision Support",description:"AI-powered diagnosis with audit trails",prompt:"Cache clinical decision support AI with full audit logging",nodes:["input","phi_filter","cache_l1","anthropic","hipaa_audit","output"]},{id:"ehr_integration",title:" EHR Integration",description:"Electronic health record system caching",prompt:"Cache EHR system queries with encryption and compliance",nodes:["input","cache_l1","cache_l2","phi_filter","hipaa_audit","output"]},{id:"custom",title:" Custom Healthcare",description:"Describe your own healthcare use case",prompt:"",nodes:[]}],finance:[{id:"risk_analysis",title:" Risk Analysis",description:"Fraud detection and risk scoring",prompt:"Cache risk analysis and fraud detection for financial transactions",nodes:["input","fraud_detector","cache_l1","cache_l2","openai","pci_audit","output"]},{id:"transaction_processing",title:" Transaction Processing",description:"High-speed payment validation",prompt:"Cache transaction validation with PCI-DSS compliance",nodes:["input","transaction_validator","cache_l1","pci_audit","output"]},{id:"kyc_compliance",title:" KYC Compliance",description:"Know Your Customer verification",prompt:"Cache KYC verification results with audit trail",nodes:["input","cache_l1","cache_l2","anthropic","pci_audit","output"]},{id:"custom",title:" Custom Finance",description:"Describe your own financial use case",prompt:"",nodes:[]}],legal:[{id:"document_analysis",title:" Document Analysis",description:"Legal document review and search",prompt:"Cache legal document analysis with retention policies",nodes:["input","cache_l1","cache_l2","anthropic","retention_policy","output"]},{id:"case_research",title:" Case Research",description:"Case law and precedent lookup",prompt:"Cache case law research with audit logging",nodes:["input","semantic_dedup","cache_l2","cache_l3","openai","audit_logger","output"]},{id:"custom",title:" Custom Legal",description:"Describe your own legal use case",prompt:"",nodes:[]}],ecommerce:[{id:"product_search",title:" Product Search",description:"Fast product catalog search",prompt:"Cache product search and recommendations",nodes:["input","cache_l1","semantic_dedup","openai","output"]},{id:"inventory_sync",title:" Inventory Sync",description:"Real-time inventory availability",prompt:"Cache inventory status with short TTL for freshness",nodes:["input","cache_l1","output"]},{id:"personalization",title:" Personalization",description:"User recommendations and preferences",prompt:"Cache personalized recommendations per user",nodes:["input","cache_l1","cache_l2","gemini","output"]},{id:"custom",title:" Custom E-commerce",description:"Describe your own e-commerce use case",prompt:"",nodes:[]}],saas:[{id:"api_caching",title:" API Caching",description:"Multi-tenant API response caching",prompt:"Cache API responses with tenant isolation",nodes:["input","cache_l1","cache_l2","output"]},{id:"ai_features",title:" AI Features",description:"AI-powered product features",prompt:"Cache AI completions for SaaS features",nodes:["input","semantic_dedup","cache_l1","cache_l2","openai","output"]},{id:"analytics",title:" Analytics",description:"Dashboard data aggregation",prompt:"Cache analytics queries and dashboard data",nodes:["input","cache_l2","cache_l3","output"]},{id:"custom",title:" Custom SaaS",description:"Describe your own SaaS use case",prompt:"",nodes:[]}],general:[{id:"api_basic",title:" API Caching",description:"Basic API response caching",prompt:"Cache API responses to reduce latency",nodes:["input","cache_l1","cache_l2","output"]},{id:"llm_caching",title:" LLM Caching",description:"Cache AI model responses",prompt:"Cache LLM completions to save costs",nodes:["input","semantic_dedup","cache_l1","cache_l2","openai","output"]},{id:"database",title:" Database Query",description:"Cache expensive database queries",prompt:"Cache database query results",nodes:["input","cache_l1","cache_l2","cache_l3","output"]},{id:"custom",title:" Custom",description:"Describe your own use case",prompt:"",nodes:[]}]},S_={healthcare:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup","phi_filter"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["hipaa_audit","encrypted_cache"]},{category:"output",types:["output"]}],finance:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup","fraud_detector","transaction_validator"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["pci_audit","sox_logger"]},{category:"output",types:["output"]}],legal:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["retention_policy","audit_logger"]},{category:"output",types:["output"]}],ecommerce:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}],saas:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}],general:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}]},N_={healthcare:{required:["hipaa","phi"],autoAddNodes:["phi_filter","hipaa_audit"],retention:"7 years",encryption:"required"},finance:{required:["pci_dss","sox"],autoAddNodes:["pci_audit"],retention:"7 years",encryption:"required"},legal:{required:["data_retention"],autoAddNodes:["retention_policy","audit_logger"],retention:"10 years",encryption:"recommended"},ecommerce:{required:["pci_dss","gdpr"],autoAddNodes:[],retention:"2 years",encryption:"recommended"},saas:{required:["soc2"],autoAddNodes:[],retention:"1 year",encryption:"recommended"},general:{required:[],autoAddNodes:[],retention:"30 days",encryption:"optional"}};function A_(n){return{templates:w_[n]||w_.general,nodes:S_[n]||S_.general,compliance:N_[n]||N_.general}}const kY=E.createContext();function LY({children:n}){const[e,t]=E.useState(null),[r,i]=E.useState(null),[s,o]=E.useState(!1);E.useEffect(()=>{const l=localStorage.getItem("agentcache_sector");l?(t(l),i(A_(l))):o(!0)},[]);const a=l=>{t(l),i(A_(l)),localStorage.setItem("agentcache_sector",l),o(!1)},c=()=>{o(!0)};return b.jsx(kY.Provider,{value:{sector:e,config:r,selectSector:a,changeSector:c,showSectorModal:s,setShowSectorModal:o},children:n})}function IY(){const{login:n}=Co(),[e,t]=E.useState(""),[r,i]=E.useState(!1),[s,o]=E.useState(null),a=async c=>{c.preventDefault(),i(!0),o(null),await n(e)||o("Login failed. Please try again."),i(!1)};return b.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm",children:b.jsx("div",{className:"w-full max-w-md p-6",children:b.jsx(He,{title:"Mission Control Access",icon:ER,className:"border-[var(--hud-accent)] shadow-[0_0_50px_rgba(0,243,255,0.2)]",children:b.jsxs("form",{onSubmit:a,className:"space-y-6 mt-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"block text-xs font-mono text-[var(--hud-text-dim)] mb-2",children:"OPERATOR ID (EMAIL)"}),b.jsx("input",{type:"email",value:e,onChange:c=>t(c.target.value),placeholder:"alice@acme.com",className:"w-full bg-black border border-[var(--hud-border)] rounded p-3 text-white focus:border-[var(--hud-accent)] focus:outline-none transition-colors",required:!0})]}),s&&b.jsx("div",{className:"text-red-500 text-xs font-mono border border-red-500/50 bg-red-500/10 p-2 rounded",children:s}),b.jsx("button",{type:"submit",disabled:r,className:"w-full py-3 bg-[var(--hud-accent)] text-black font-bold rounded hover:bg-white transition-colors flex items-center justify-center gap-2",children:r?"AUTHENTICATING...":b.jsxs(b.Fragment,{children:["ENTER CONSOLE ",b.jsx(vT,{size:16})]})}),b.jsx("div",{className:"text-center text-[10px] text-[var(--hud-text-dim)] font-mono",children:"SECURE TERMINAL // AUTHORIZED PERSONNEL ONLY"})]})})})})}const OY=()=>{const[n,e]=E.useState("swarm"),{user:t,loading:r}=Co();if(r)return b.jsx("div",{className:"h-screen flex items-center justify-center text-[var(--hud-accent)] font-mono",children:"INITIALIZING..."});if(!t)return b.jsx(IY,{});const i=()=>{switch(n){case"overview":return b.jsx(T0,{});case"pipeline":return b.jsx(qF,{});case"swarm":return b.jsx(N7,{});case"observability":return b.jsx(dY,{});case"lab":return b.jsx(MY,{});case"data":return b.jsx(DY,{});case"governance":return b.jsx(FY,{});default:return b.jsx(T0,{})}};return b.jsx(LY,{children:b.jsxs("div",{className:"flex h-screen bg-[var(--hud-bg)] text-[var(--hud-text)] overflow-hidden font-sans selection:bg-[var(--hud-accent)] selection:text-black",children:[b.jsx(eM,{activeView:n,setActiveView:e,user:t}),b.jsxs("div",{className:"flex-1 flex flex-col pl-16 transition-all duration-300",children:[b.jsx(tM,{}),b.jsxs("main",{className:"flex-1 overflow-y-auto overflow-x-hidden pt-16 p-6 relative",children:[b.jsx("div",{className:"fixed inset-0 pointer-events-none z-0 opacity-20",style:{backgroundImage:"linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),b.jsx("div",{className:"relative z-10 max-w-7xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:i()})]})]})]})})},UY=()=>b.jsx(S7,{children:b.jsx(OY,{})});NC.createRoot(document.getElementById("root")).render(b.jsx(K.StrictMode,{children:b.jsx(UY,{})}));
