import{r as N,j as f,R as X,g as n_,a as KE,b as XE}from"./client-Cx4iHea0.js";/* empty css              */import{C as Tu,R as s_,M as At,T as Ns,V as Se,P as wu,a as ue,b as On,G as r_,c as Bn,S as Vp,d as _n,e as i_,B as Za,f as uc,L as YE,g as o_,h as a_,i as QE,Q as ZE,j as l_,k as JE,l as eA,w as ie,H as Vt,m as Gp,N as Or,n as tA,o as Nu,p as ft,q as re,r as pt,s as fo,t as Ln,u as kn,v as et,F as nA,x as sA,y as Qt,z as la,D as zr,W as Dc,A as Kn,E as rA,I as c_,J as iA,K as $p,O as u_,U as oA,X as aA,Y as lA,Z as cA,_ as uA,$ as dA,a0 as hA,a1 as fA,a2 as zp,a3 as d_,a4 as Zn,a5 as Hp,a6 as Zg,a7 as Ea,a8 as pA,a9 as mA,aa as on,ab as er,ac as mt,ad as tr,ae as nr,af as Ks,ag as ca,ah as vs,ai as Hs,aj as qi,ak as gA,al as Wp,am as qp,an as Xh,ao as Kp,ap as Xp,aq as Ei,ar as _e,as as xA,at as Ja,au as Su,av as Eu,aw as yA,ax as Ot,ay as Au,az as Aa,aA as Cu,aB as Hr,aC as Yh,aD as Ca,aE as h_,aF as Rn,aG as f_,aH as p_,aI as m_,aJ as g_,aK as x_,aL as Yp,aM as y_,aN as b_,aO as Jg,aP as Ki,aQ as hn,aR as bA,aS as v_,aT as __,aU as T_,aV as w_,aW as N_,aX as S_,aY as E_,aZ as A_,a_ as C_,a$ as R_,b0 as M_,b1 as P_,b2 as vA,b3 as _A,b4 as TA,b5 as Xi,b6 as Ic,b7 as Bc,b8 as Lc,b9 as Wr,ba as k_,bb as D_,bc as I_,bd as B_,be as L_,bf as F_,bg as O_,bh as j_,bi as wA,bj as NA,bk as U_,bl as V_,bm as ua,bn as da,bo as Ai,bp as SA,bq as Qp,br as Zp,bs as Jp,bt as Zs,bu as em,bv as tm,bw as dc,bx as hc,by as fc,bz as pc,bA as e0,bB as t0,bC as n0,bD as s0,bE as Qh,bF as Zh,bG as Jh,bH as ef,bI as tf,bJ as nf,bK as sf,bL as rf,bM as of,bN as af,bO as lf,bP as cf,bQ as uf,bR as df,bS as hf,bT as ff,bU as pf,bV as mf,bW as gf,bX as xf,bY as yf,bZ as bf,b_ as G_,b$ as EA,c0 as AA,c1 as CA,c2 as RA,c3 as MA,c4 as PA,c5 as kA,c6 as DA,c7 as IA,c8 as BA,c9 as Fc,ca as LA,cb as FA,cc as OA,cd as jA,ce as $_,cf as UA,cg as VA,ch as GA,ci as $A,cj as zA,ck as HA,cl as WA,cm as qA,cn as KA,co as XA,cp as YA,cq as QA,cr as ZA,cs as JA,ct as eC,cu as tC,cv as nC,cw as sC,cx as z_,cy as rC,cz as iC,cA as oC,cB as aC,cC as Oc,cD as lC,cE as H_,cF as cC,cG as W_,cH as uC,cI as dC,cJ as hC,cK as mc,cL as jc,cM as Uc,cN as r0,cO as fC,cP as pC,cQ as mC,cR as gC,cS as xC,cT as yC,cU as bC,cV as vC,cW as _C,cX as i0,cY as TC,cZ as o0,c_ as wC,c$ as NC,d0 as q_,d1 as bn,d2 as SC,d3 as EC,d4 as AC}from"./with-selector-DCyFAZBy.js";const CC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RC=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),a0=n=>{const e=RC(n);return e.charAt(0).toUpperCase()+e.slice(1)},K_=(...n)=>n.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),MC=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var PC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const kC=N.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:o,...a},l)=>N.createElement("svg",{ref:l,...PC,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:K_("lucide",r),...!i&&!MC(a)&&{"aria-hidden":"true"},...a},[...o.map(([c,u])=>N.createElement(c,u)),...Array.isArray(i)?i:[i]]));const ae=(n,e)=>{const t=N.forwardRef(({className:s,...r},i)=>N.createElement(kC,{ref:i,iconNode:e,className:K_(`lucide-${CC(a0(n))}`,`lucide-${n}`,s),...r}));return t.displayName=a0(n),t};const DC=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Zt=ae("activity",DC);const IC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ru=ae("arrow-right",IC);const BC=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],X_=ae("bell",BC);const LC=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],FC=ae("book",LC);const OC=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],jC=ae("bot",OC);const UC=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],VC=ae("box",UC);const GC=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Vc=ae("brain",GC);const $C=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],zC=ae("building-2",$C);const HC=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],WC=ae("chevron-right",HC);const qC=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Mu=ae("circle-check-big",qC);const KC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],nm=ae("circle-stop",KC);const XC=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Y_=ae("clock",XC);const YC=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],QC=ae("cloud",YC);const ZC=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Q_=ae("cpu",ZC);const JC=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ps=ae("database",JC);const eR=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],tR=ae("dollar-sign",eR);const nR=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Z_=ae("eye",nR);const sR=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],rR=ae("file-text",sR);const iR=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],J_=ae("flask-conical",iR);const oR=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],aR=ae("funnel",oR);const lR=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],e1=ae("gamepad-2",lR);const cR=[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]],uR=ae("gavel",cR);const dR=[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]],l0=ae("git-fork",dR);const hR=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],sm=ae("globe",hR);const fR=[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}]],pR=ae("hexagon",fR);const mR=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Pu=ae("key",mR);const gR=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],c0=ae("layers",gR);const xR=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],yR=ae("layout-grid",xR);const bR=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],t1=ae("lock",bR);const vR=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],_R=ae("log-out",vR);const TR=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],wR=ae("map",TR);const NR=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],SR=ae("message-square",NR);const ER=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],AR=ae("network",ER);const CR=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],rm=ae("play",CR);const RR=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],n1=ae("plus",RR);const MR=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Ra=ae("radio",MR);const PR=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],s1=ae("refresh-cw",PR);const kR=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],r1=ae("save",kR);const DR=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Gc=ae("search",DR);const IR=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],BR=ae("send",IR);const LR=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],im=ae("server",LR);const FR=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],OR=ae("settings",FR);const jR=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ha=ae("share-2",jR);const UR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],i1=ae("shield-alert",UR);const VR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],GR=ae("shield-check",VR);const $R=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ks=ae("shield",$R);const zR=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],u0=ae("snowflake",zR);const HR=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],WR=ae("tag",HR);const qR=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],KR=ae("terminal",qR);const XR=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],YR=ae("thermometer",XR);const QR=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],ZR=ae("thumbs-up",QR);const JR=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],e3=ae("timer",JR);const t3=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],n3=ae("trash-2",t3);const s3=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],r3=ae("trending-up",s3);const i3=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ma=ae("triangle-alert",i3);const o3=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],o1=ae("trophy",o3);const a3=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],l3=ae("user-check",a3);const c3=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],u3=ae("user-plus",c3);const d3=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ku=ae("user",d3);const h3=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],$c=ae("users",h3);const f3=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],a1=ae("wallet",f3);const p3=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],m3=ae("wand-sparkles",p3);const g3=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],x3=ae("wind",g3);const y3=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],b3=ae("workflow",y3);const v3=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],zc=ae("x",v3);const _3=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ar=ae("zap",_3),T3=({activeView:n,setActiveView:e,user:t})=>{const[s,r]=N.useState(!1),i=[{id:"swarm",label:"Neural Ops Center",icon:Zt},{id:"overview",label:"System Overview",icon:yR},{id:"pipeline",label:"Pipeline Studio",icon:b3},{id:"observability",label:"Observability",icon:Ps},{id:"lab",label:"Research Lab",icon:J_},{id:"data",label:"Data Explorer",icon:Ps},{id:"governance",label:"Governance",icon:ks},{id:"settings",label:"Settings",icon:OR}];return f.jsxs("div",{className:`fixed left-0 top-16 bottom-0 z-40 flex flex-col bg-[rgba(6,11,20,0.95)] border-r border-[rgba(0,243,255,0.2)] backdrop-blur-xl transition-all duration-300 ${s?"w-64":"w-16"}`,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[f.jsx("div",{className:"flex-1 py-6 flex flex-col gap-2",children:i.map(o=>{const a=o.icon,l=n===o.id;return f.jsxs("button",{onClick:()=>e(o.id),className:`relative flex items-center h-12 px-4 mx-2 rounded-lg transition-all duration-200 group ${l?"bg-[rgba(0,243,255,0.1)] text-[var(--hud-accent)] shadow-[0_0_15px_rgba(0,243,255,0.2)]":"text-[var(--hud-text-dim)] hover:bg-[rgba(255,255,255,0.05)] hover:text-white"}`,children:[f.jsx(a,{size:20,className:`min-w-[20px] transition-transform duration-300 ${l?"scale-110":"group-hover:scale-110"}`}),f.jsx("span",{className:`ml-4 font-['Rajdhani'] font-semibold tracking-wide whitespace-nowrap overflow-hidden transition-all duration-300 ${s?"opacity-100 w-auto":"opacity-0 w-0"}`,children:o.label}),l&&f.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-[var(--hud-accent)] rounded-r-full shadow-[0_0_10px_var(--hud-accent)]"})]},o.id)})}),f.jsxs("div",{className:"p-2 border-t border-[rgba(0,243,255,0.1)]",children:[f.jsxs("div",{className:`flex items-center p-2 rounded-lg bg-[rgba(0,0,0,0.3)] border border-[rgba(255,255,255,0.05)] ${s?"justify-start":"justify-center"}`,children:[f.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-[var(--hud-accent)] to-[var(--hud-accent-secondary)] flex items-center justify-center text-black font-bold text-xs shadow-[0_0_10px_rgba(0,243,255,0.3)]",children:t?.name?.charAt(0)||"G"}),f.jsxs("div",{className:`ml-3 overflow-hidden transition-all duration-300 ${s?"w-auto opacity-100":"w-0 opacity-0"}`,children:[f.jsx("div",{className:"text-sm font-bold text-white truncate",children:t?.name||"Guest"}),f.jsx("div",{className:"text-xs text-[var(--hud-accent)] font-mono",children:t?.role||"Viewer"})]})]}),f.jsxs("button",{onClick:()=>{localStorage.removeItem("agentcache_token"),localStorage.removeItem("agentcache_user"),window.location.href="/login.html"},className:`mt-2 w-full flex items-center justify-center h-10 rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors ${!s&&"hidden"}`,children:[f.jsx(_R,{size:16,className:"mr-2"}),f.jsx("span",{className:"font-['Rajdhani'] font-semibold",children:"LOGOUT"})]})]})]})},w3=()=>{const[n,e]=N.useState(new Date),[t,s]=N.useState(!1);return N.useEffect(()=>{const r=setInterval(()=>e(new Date),1e3),i=()=>s(window.scrollY>20);return window.addEventListener("scroll",i),()=>{clearInterval(r),window.removeEventListener("scroll",i)}},[]),f.jsx("header",{className:`fixed top-0 left-0 right-0 h-16 z-50 transition-all duration-300 ${t?"bg-[rgba(3,5,8,0.9)] backdrop-blur-md border-b border-[rgba(0,243,255,0.2)]":"bg-transparent border-b border-transparent"}`,children:f.jsxs("div",{className:"h-full px-6 flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("div",{className:"relative group cursor-pointer",children:[f.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-[var(--hud-accent)] to-[var(--hud-accent-secondary)] rounded-lg blur opacity-40 group-hover:opacity-75 transition duration-500"}),f.jsx("div",{className:"relative w-10 h-10 bg-black border border-[var(--hud-accent)] rounded-lg flex items-center justify-center",children:f.jsx("div",{className:"w-4 h-4 bg-[var(--hud-accent)] rotate-45 group-hover:rotate-90 transition-transform duration-500"})})]}),f.jsxs("div",{children:[f.jsxs("h1",{className:"text-xl font-['Rajdhani'] font-bold tracking-widest text-white",children:["AGENT",f.jsx("span",{className:"text-[var(--hud-accent)]",children:"CACHE"})]}),f.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-mono text-[var(--hud-text-dim)]",children:[f.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),"SYSTEM ONLINE"]})]})]}),f.jsxs("div",{className:"hidden md:flex items-center gap-8 px-8 py-2 bg-[rgba(255,255,255,0.03)] rounded-full border border-[rgba(255,255,255,0.05)]",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Grid Status"}),f.jsx("span",{className:"text-xs font-mono text-[var(--hud-success)]",children:"OPTIMAL"})]}),f.jsx("div",{className:"w-px h-4 bg-[rgba(255,255,255,0.1)]"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Latency"}),f.jsx("span",{className:"text-xs font-mono text-[var(--hud-accent)]",children:"42ms"})]}),f.jsx("div",{className:"w-px h-4 bg-[rgba(255,255,255,0.1)]"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Active Agents"}),f.jsx("span",{className:"text-xs font-mono text-white",children:"8,492"})]})]}),f.jsxs("div",{className:"flex items-center gap-6",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("button",{className:"text-[var(--hud-text-dim)] hover:text-white transition-colors",children:f.jsx(Gc,{size:20})}),f.jsxs("button",{className:"relative text-[var(--hud-text-dim)] hover:text-white transition-colors",children:[f.jsx(X_,{size:20}),f.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-[var(--hud-accent)] rounded-full animate-pulse"})]})]}),f.jsxs("div",{className:"text-right hidden sm:block",children:[f.jsx("div",{className:"text-sm font-mono font-bold text-white",children:n.toLocaleTimeString([],{hour12:!1})}),f.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:"UTC"})]})]})]})})},ge=({title:n,children:e,className:t="",icon:s,action:r=null})=>f.jsxs("div",{className:`relative group bg-[var(--hud-panel-bg)] border border-[var(--hud-border)] rounded-lg overflow-hidden transition-all duration-300 hover:shadow-[0_0_20px_rgba(0,243,255,0.1)] hover:border-[var(--hud-accent)] ${t}`,children:[f.jsx("div",{className:"absolute top-0 left-0 w-2 h-2 border-t-2 border-l-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),f.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),f.jsx("div",{className:"absolute bottom-0 left-0 w-2 h-2 border-b-2 border-l-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),f.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 border-b-2 border-r-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),(n||s)&&f.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[var(--hud-border)] bg-[rgba(0,0,0,0.2)]",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[s&&f.jsx(s,{size:18,className:"text-[var(--hud-accent)]"}),f.jsxs("h3",{className:"font-['Rajdhani'] font-bold text-lg tracking-wider text-white uppercase",children:[f.jsx("span",{className:"text-[var(--hud-accent)] mr-2",children:"::"}),n]})]}),r&&f.jsx("div",{className:"text-sm",children:r})]}),f.jsx("div",{className:"p-6",children:e})]}),gl=({value:n,max:e=100,label:t,sublabel:s,color:r="var(--hud-accent)"})=>{const i=Math.min(100,Math.max(0,n/e*100)),o=36,a=2*Math.PI*o,l=a-i/100*a;return f.jsxs("div",{className:"flex flex-col items-center justify-center",children:[f.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[f.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[f.jsx("circle",{cx:"64",cy:"64",r:o,stroke:"rgba(255,255,255,0.1)",strokeWidth:"8",fill:"transparent"}),f.jsx("circle",{cx:"64",cy:"64",r:o,stroke:r,strokeWidth:"8",fill:"transparent",strokeDasharray:a,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out",style:{filter:`drop-shadow(0 0 4px ${r})`}})]}),f.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:f.jsxs("span",{className:"text-2xl font-['Rajdhani'] font-bold text-white",children:[n,"%"]})})]}),f.jsxs("div",{className:"text-center mt-2",children:[f.jsx("div",{className:"text-sm font-bold text-white tracking-wide",children:t}),s&&f.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:s})]})]})},Yi=({columns:n,data:e,onRowClick:t=void 0})=>f.jsx("div",{className:"w-full overflow-x-auto",children:f.jsxs("table",{className:"w-full text-left border-collapse",children:[f.jsx("thead",{children:f.jsx("tr",{className:"border-b border-[var(--hud-border)]",children:n.map((s,r)=>f.jsx("th",{className:"py-3 px-4 text-xs font-['Rajdhani'] font-bold text-[var(--hud-text-dim)] uppercase tracking-wider whitespace-nowrap bg-[rgba(0,0,0,0.2)]",children:s.header},r))})}),f.jsx("tbody",{className:"font-mono text-sm",children:e.map((s,r)=>f.jsx("tr",{onClick:()=>t&&t(s),className:`
                border-b border-[rgba(255,255,255,0.05)] transition-colors duration-200
                ${t?"cursor-pointer hover:bg-[rgba(0,243,255,0.05)]":""}
                group
              `,children:n.map((i,o)=>f.jsx("td",{className:"py-3 px-4 text-white group-hover:text-[var(--hud-accent)] transition-colors",children:i.render?i.render(s):s[i.accessor]},o))},s.id||r))})]})});function N3(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function S3(n,e,t){return e=D3(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function d0(n,e){return C3(n)||N3(n,e)||l1(n,e)||P3()}function E3(n){return A3(n)||R3(n)||l1(n)||M3()}function A3(n){if(Array.isArray(n))return vf(n)}function C3(n){if(Array.isArray(n))return n}function R3(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function l1(n,e){if(n){if(typeof n=="string")return vf(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return vf(n,e)}}function vf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=n[t];return s}function M3(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k3(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function D3(n){var e=k3(n,"string");return typeof e=="symbol"?e:String(e)}var I3=function(e,t){var s=new Set(t);return Object.assign.apply(Object,[{}].concat(E3(Object.entries(e).filter(function(r){var i=d0(r,1),o=i[0];return!s.has(o)}).map(function(r){var i=d0(r,2),o=i[0],a=i[1];return S3({},o,a)}))))};function _f(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function B3(n){if(Array.isArray(n))return n}function L3(n){if(Array.isArray(n))return _f(n)}function F3(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function O3(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function j3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U3(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V3(n,e){return B3(n)||O3(n,e)||c1(n,e)||j3()}function h0(n){return L3(n)||F3(n)||c1(n)||U3()}function c1(n,e){if(n){if(typeof n=="string")return _f(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_f(n,e):void 0}}function G3(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,s=t===void 0?"div":t,r=e.nodeMapper,i=r===void 0?function(u){return u}:r,o=e.methodNames,a=o===void 0?[]:o,l=e.initPropNames,c=l===void 0?[]:l;return N.forwardRef(function(u,d){var h=N.useRef(),p=N.useMemo(function(){var y=Object.fromEntries(c.filter(function(g){return u.hasOwnProperty(g)}).map(function(g){return[g,u[g]]}));return n(y)},[]);f0(function(){p(i(h.current))},N.useLayoutEffect),f0(function(){return p._destructor instanceof Function?p._destructor:void 0});var m=N.useCallback(function(y){for(var g=arguments.length,b=new Array(g>1?g-1:0),v=1;v<g;v++)b[v-1]=arguments[v];return p[y]instanceof Function?p[y].apply(p,b):void 0},[p]),x=N.useRef({});return Object.keys(I3(u,[].concat(h0(a),h0(c)))).filter(function(y){return x.current[y]!==u[y]}).forEach(function(y){return m(y,u[y])}),x.current=u,N.useImperativeHandle(d,function(){return Object.fromEntries(a.map(function(y){return[y,function(){for(var g=arguments.length,b=new Array(g),v=0;v<g;v++)b[v]=arguments[v];return m.apply(void 0,[y].concat(b))}]}))},[m]),X.createElement(s,{ref:h})})}function f0(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:N.useEffect,t=N.useRef(),s=N.useRef(!1),r=N.useRef(!1),i=N.useState(0),o=V3(i,2);o[0];var a=o[1];s.current&&(r.current=!0),e(function(){return s.current||(t.current=n(),s.current=!0),a(function(l){return l+1}),function(){r.current&&t.current&&t.current()}},[])}const Fi=new wu,_s=new Se,u1=new ue,gd=new Se,gc=new Se,Hc=new ue,Tf=new ue,d1=new On,h1=new ue,f1=new ue;let kt=null,Wn=null;const Ts=[],sr={NONE:-1,PAN:0,ROTATE:1};class $3 extends Tu{constructor(e,t,s=null){super(t,s),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new s_,this.mouseButtons={LEFT:At.PAN,MIDDLE:At.PAN,RIGHT:At.ROTATE},this.touches={ONE:Ns.PAN},this._onPointerMove=z3.bind(this),this._onPointerDown=H3.bind(this),this._onPointerCancel=W3.bind(this),this._onContextMenu=q3.bind(this),s!==null&&this.connect(s)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();_s.x=(e.clientX-t.left)/t.width*2-1,_s.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case At.PAN:case Ns.PAN:this.state=sr.PAN;break;case At.ROTATE:case Ns.ROTATE:this.state=sr.ROTATE;break;default:this.state=sr.NONE}}}function z3(n){const e=this.object,t=this.domElement,s=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),s.setFromCamera(_s,e),kt)this.state===sr.PAN?s.ray.intersectPlane(Fi,Hc)&&(kt.position.copy(Hc.sub(u1).applyMatrix4(d1)),this.dispatchEvent({type:"drag",object:kt})):this.state===sr.ROTATE&&(gd.subVectors(_s,gc).multiplyScalar(this.rotateSpeed),kt.rotateOnWorldAxis(h1,gd.x),kt.rotateOnWorldAxis(f1.normalize(),-gd.y),this.dispatchEvent({type:"drag",object:kt})),gc.copy(_s);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(Ts.length=0,s.setFromCamera(_s,e),s.intersectObjects(this.objects,this.recursive,Ts),Ts.length>0){const r=Ts[0].object;Fi.setFromNormalAndCoplanarPoint(e.getWorldDirection(Fi.normal),Tf.setFromMatrixPosition(r.matrixWorld)),Wn!==r&&Wn!==null&&(this.dispatchEvent({type:"hoveroff",object:Wn}),t.style.cursor="auto",Wn=null),Wn!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",Wn=r)}else Wn!==null&&(this.dispatchEvent({type:"hoveroff",object:Wn}),t.style.cursor="auto",Wn=null);gc.copy(_s)}}function H3(n){const e=this.object,t=this.domElement,s=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),Ts.length=0,s.setFromCamera(_s,e),s.intersectObjects(this.objects,this.recursive,Ts),Ts.length>0&&(this.transformGroup===!0?kt=p1(Ts[0].object):kt=Ts[0].object,Fi.setFromNormalAndCoplanarPoint(e.getWorldDirection(Fi.normal),Tf.setFromMatrixPosition(kt.matrixWorld)),s.ray.intersectPlane(Fi,Hc)&&(this.state===sr.PAN?(d1.copy(kt.parent.matrixWorld).invert(),u1.copy(Hc).sub(Tf.setFromMatrixPosition(kt.matrixWorld)),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:kt})):this.state===sr.ROTATE&&(h1.set(0,1,0).applyQuaternion(e.quaternion).normalize(),f1.set(1,0,0).applyQuaternion(e.quaternion).normalize(),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:kt})))),gc.copy(_s))}function W3(){this.enabled!==!1&&(kt&&(this.dispatchEvent({type:"dragend",object:kt}),kt=null),this.domElement.style.cursor=Wn?"pointer":"auto",this.state=sr.NONE)}function q3(n){this.enabled!==!1&&n.preventDefault()}function p1(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:p1(n.parent,e)}function K3(n,e,t){var s,r=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function i(){var o,a=s.length,l,c=0,u=0,d=0;for(o=0;o<a;++o)l=s[o],c+=l.x||0,u+=l.y||0,d+=l.z||0;for(c=(c/a-n)*r,u=(u/a-e)*r,d=(d/a-t)*r,o=0;o<a;++o)l=s[o],c&&(l.x-=c),u&&(l.y-=u),d&&(l.z-=d)}return i.initialize=function(o){s=o},i.x=function(o){return arguments.length?(n=+o,i):n},i.y=function(o){return arguments.length?(e=+o,i):e},i.z=function(o){return arguments.length?(t=+o,i):t},i.strength=function(o){return arguments.length?(r=+o,i):r},i}function X3(n){const e=+this._x.call(null,n);return m1(this.cover(e),e,n)}function m1(n,e,t){if(isNaN(e))return n;var s,r=n._root,i={data:t},o=n._x0,a=n._x1,l,c,u,d,h;if(!r)return n._root=i,n;for(;r.length;)if((u=e>=(l=(o+a)/2))?o=l:a=l,s=r,!(r=r[d=+u]))return s[d]=i,n;if(c=+n._x.call(null,r.data),e===c)return i.next=r,s?s[d]=i:n._root=i,n;do s=s?s[d]=new Array(2):n._root=new Array(2),(u=e>=(l=(o+a)/2))?o=l:a=l;while((d=+u)==(h=+(c>=l)));return s[h]=r,s[d]=i,n}function Y3(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let s=1/0,r=-1/0;for(let i=0,o;i<e;++i)isNaN(o=+this._x.call(null,n[i]))||(t[i]=o,o<s&&(s=o),o>r&&(r=o));if(s>r)return this;this.cover(s).cover(r);for(let i=0;i<e;++i)m1(this,t[i],n[i]);return this}function Q3(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var s=t-e||1,r=this._root,i,o;e>n||n>=t;)switch(o=+(n<e),i=new Array(2),i[o]=r,r=i,s*=2,o){case 0:t=e+s;break;case 1:e=t-s;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function Z3(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function J3(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Cs(n,e,t){this.node=n,this.x0=e,this.x1=t}function eM(n,e){var t,s=this._x0,r,i,o=this._x1,a=[],l=this._root,c,u;for(l&&a.push(new Cs(l,s,o)),e==null?e=1/0:(s=n-e,o=n+e);c=a.pop();)if(!(!(l=c.node)||(r=c.x0)>o||(i=c.x1)<s))if(l.length){var d=(r+i)/2;a.push(new Cs(l[1],d,i),new Cs(l[0],r,d)),(u=+(n>=d))&&(c=a[a.length-1],a[a.length-1]=a[a.length-1-u],a[a.length-1-u]=c)}else{var h=Math.abs(n-+this._x.call(null,l.data));h<e&&(e=h,s=n-h,o=n+h,t=l.data)}return t}function tM(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,t=this._root,s,r,i,o=this._x0,a=this._x1,l,c,u,d,h;if(!t)return this;if(t.length)for(;;){if((u=l>=(c=(o+a)/2))?o=c:a=c,e=t,!(t=t[d=+u]))return this;if(!t.length)break;e[d+1&1]&&(s=e,h=d)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(i=t.next)&&delete t.next,r?(i?r.next=i:delete r.next,this):e?(i?e[d]=i:delete e[d],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(s?s[h]=t:this._root=t),this):(this._root=i,this)}function nM(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function sM(){return this._root}function rM(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function iM(n){var e=[],t,s=this._root,r,i,o;for(s&&e.push(new Cs(s,this._x0,this._x1));t=e.pop();)if(!n(s=t.node,i=t.x0,o=t.x1)&&s.length){var a=(i+o)/2;(r=s[1])&&e.push(new Cs(r,a,o)),(r=s[0])&&e.push(new Cs(r,i,a))}return this}function oM(n){var e=[],t=[],s;for(this._root&&e.push(new Cs(this._root,this._x0,this._x1));s=e.pop();){var r=s.node;if(r.length){var i,o=s.x0,a=s.x1,l=(o+a)/2;(i=r[0])&&e.push(new Cs(i,o,l)),(i=r[1])&&e.push(new Cs(i,l,a))}t.push(s)}for(;s=t.pop();)n(s.node,s.x0,s.x1);return this}function aM(n){return n[0]}function lM(n){return arguments.length?(this._x=n,this):this._x}function g1(n,e){var t=new om(e??aM,NaN,NaN);return n==null?t:t.addAll(n)}function om(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function p0(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var en=g1.prototype=om.prototype;en.copy=function(){var n=new om(this._x,this._x0,this._x1),e=this._root,t,s;if(!e)return n;if(!e.length)return n._root=p0(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(s=e.source[r])&&(s.length?t.push({source:s,target:e.target[r]=new Array(2)}):e.target[r]=p0(s));return n};en.add=X3;en.addAll=Y3;en.cover=Q3;en.data=Z3;en.extent=J3;en.find=eM;en.remove=tM;en.removeAll=nM;en.root=sM;en.size=rM;en.visit=iM;en.visitAfter=oM;en.x=lM;function cM(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return x1(this.cover(e,t),e,t,n)}function x1(n,e,t,s){if(isNaN(e)||isNaN(t))return n;var r,i=n._root,o={data:s},a=n._x0,l=n._y0,c=n._x1,u=n._y1,d,h,p,m,x,y,g,b;if(!i)return n._root=o,n;for(;i.length;)if((x=e>=(d=(a+c)/2))?a=d:c=d,(y=t>=(h=(l+u)/2))?l=h:u=h,r=i,!(i=i[g=y<<1|x]))return r[g]=o,n;if(p=+n._x.call(null,i.data),m=+n._y.call(null,i.data),e===p&&t===m)return o.next=i,r?r[g]=o:n._root=o,n;do r=r?r[g]=new Array(4):n._root=new Array(4),(x=e>=(d=(a+c)/2))?a=d:c=d,(y=t>=(h=(l+u)/2))?l=h:u=h;while((g=y<<1|x)===(b=(m>=h)<<1|p>=d));return r[b]=i,r[g]=o,n}function uM(n){var e,t,s=n.length,r,i,o=new Array(s),a=new Array(s),l=1/0,c=1/0,u=-1/0,d=-1/0;for(t=0;t<s;++t)isNaN(r=+this._x.call(null,e=n[t]))||isNaN(i=+this._y.call(null,e))||(o[t]=r,a[t]=i,r<l&&(l=r),r>u&&(u=r),i<c&&(c=i),i>d&&(d=i));if(l>u||c>d)return this;for(this.cover(l,c).cover(u,d),t=0;t<s;++t)x1(this,o[t],a[t],n[t]);return this}function dM(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,s=this._y0,r=this._x1,i=this._y1;if(isNaN(t))r=(t=Math.floor(n))+1,i=(s=Math.floor(e))+1;else{for(var o=r-t||1,a=this._root,l,c;t>n||n>=r||s>e||e>=i;)switch(c=(e<s)<<1|n<t,l=new Array(4),l[c]=a,a=l,o*=2,c){case 0:r=t+o,i=s+o;break;case 1:t=r-o,i=s+o;break;case 2:r=t+o,s=i-o;break;case 3:t=r-o,s=i-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=t,this._y0=s,this._x1=r,this._y1=i,this}function hM(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function fM(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ut(n,e,t,s,r){this.node=n,this.x0=e,this.y0=t,this.x1=s,this.y1=r}function pM(n,e,t){var s,r=this._x0,i=this._y0,o,a,l,c,u=this._x1,d=this._y1,h=[],p=this._root,m,x;for(p&&h.push(new Ut(p,r,i,u,d)),t==null?t=1/0:(r=n-t,i=e-t,u=n+t,d=e+t,t*=t);m=h.pop();)if(!(!(p=m.node)||(o=m.x0)>u||(a=m.y0)>d||(l=m.x1)<r||(c=m.y1)<i))if(p.length){var y=(o+l)/2,g=(a+c)/2;h.push(new Ut(p[3],y,g,l,c),new Ut(p[2],o,g,y,c),new Ut(p[1],y,a,l,g),new Ut(p[0],o,a,y,g)),(x=(e>=g)<<1|n>=y)&&(m=h[h.length-1],h[h.length-1]=h[h.length-1-x],h[h.length-1-x]=m)}else{var b=n-+this._x.call(null,p.data),v=e-+this._y.call(null,p.data),_=b*b+v*v;if(_<t){var w=Math.sqrt(t=_);r=n-w,i=e-w,u=n+w,d=e+w,s=p.data}}return s}function mM(n){if(isNaN(u=+this._x.call(null,n))||isNaN(d=+this._y.call(null,n)))return this;var e,t=this._root,s,r,i,o=this._x0,a=this._y0,l=this._x1,c=this._y1,u,d,h,p,m,x,y,g;if(!t)return this;if(t.length)for(;;){if((m=u>=(h=(o+l)/2))?o=h:l=h,(x=d>=(p=(a+c)/2))?a=p:c=p,e=t,!(t=t[y=x<<1|m]))return this;if(!t.length)break;(e[y+1&3]||e[y+2&3]||e[y+3&3])&&(s=e,g=y)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(i=t.next)&&delete t.next,r?(i?r.next=i:delete r.next,this):e?(i?e[y]=i:delete e[y],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(s?s[g]=t:this._root=t),this):(this._root=i,this)}function gM(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function xM(){return this._root}function yM(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function bM(n){var e=[],t,s=this._root,r,i,o,a,l;for(s&&e.push(new Ut(s,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(s=t.node,i=t.x0,o=t.y0,a=t.x1,l=t.y1)&&s.length){var c=(i+a)/2,u=(o+l)/2;(r=s[3])&&e.push(new Ut(r,c,u,a,l)),(r=s[2])&&e.push(new Ut(r,i,u,c,l)),(r=s[1])&&e.push(new Ut(r,c,o,a,u)),(r=s[0])&&e.push(new Ut(r,i,o,c,u))}return this}function vM(n){var e=[],t=[],s;for(this._root&&e.push(new Ut(this._root,this._x0,this._y0,this._x1,this._y1));s=e.pop();){var r=s.node;if(r.length){var i,o=s.x0,a=s.y0,l=s.x1,c=s.y1,u=(o+l)/2,d=(a+c)/2;(i=r[0])&&e.push(new Ut(i,o,a,u,d)),(i=r[1])&&e.push(new Ut(i,u,a,l,d)),(i=r[2])&&e.push(new Ut(i,o,d,u,c)),(i=r[3])&&e.push(new Ut(i,u,d,l,c))}t.push(s)}for(;s=t.pop();)n(s.node,s.x0,s.y0,s.x1,s.y1);return this}function _M(n){return n[0]}function TM(n){return arguments.length?(this._x=n,this):this._x}function wM(n){return n[1]}function NM(n){return arguments.length?(this._y=n,this):this._y}function y1(n,e,t){var s=new am(e??_M,t??wM,NaN,NaN,NaN,NaN);return n==null?s:s.addAll(n)}function am(n,e,t,s,r,i){this._x=n,this._y=e,this._x0=t,this._y0=s,this._x1=r,this._y1=i,this._root=void 0}function m0(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var zt=y1.prototype=am.prototype;zt.copy=function(){var n=new am(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,s;if(!e)return n;if(!e.length)return n._root=m0(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(s=e.source[r])&&(s.length?t.push({source:s,target:e.target[r]=new Array(4)}):e.target[r]=m0(s));return n};zt.add=cM;zt.addAll=uM;zt.cover=dM;zt.data=hM;zt.extent=fM;zt.find=pM;zt.remove=mM;zt.removeAll=gM;zt.root=xM;zt.size=yM;zt.visit=bM;zt.visitAfter=vM;zt.x=TM;zt.y=NM;function SM(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),s=+this._z.call(null,n);return b1(this.cover(e,t,s),e,t,s,n)}function b1(n,e,t,s,r){if(isNaN(e)||isNaN(t)||isNaN(s))return n;var i,o=n._root,a={data:r},l=n._x0,c=n._y0,u=n._z0,d=n._x1,h=n._y1,p=n._z1,m,x,y,g,b,v,_,w,T,E,S;if(!o)return n._root=a,n;for(;o.length;)if((_=e>=(m=(l+d)/2))?l=m:d=m,(w=t>=(x=(c+h)/2))?c=x:h=x,(T=s>=(y=(u+p)/2))?u=y:p=y,i=o,!(o=o[E=T<<2|w<<1|_]))return i[E]=a,n;if(g=+n._x.call(null,o.data),b=+n._y.call(null,o.data),v=+n._z.call(null,o.data),e===g&&t===b&&s===v)return a.next=o,i?i[E]=a:n._root=a,n;do i=i?i[E]=new Array(8):n._root=new Array(8),(_=e>=(m=(l+d)/2))?l=m:d=m,(w=t>=(x=(c+h)/2))?c=x:h=x,(T=s>=(y=(u+p)/2))?u=y:p=y;while((E=T<<2|w<<1|_)===(S=(v>=y)<<2|(b>=x)<<1|g>=m));return i[S]=o,i[E]=a,n}function EM(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),s=new Float64Array(e),r=new Float64Array(e);let i=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0;for(let d=0,h,p,m,x;d<e;++d)isNaN(p=+this._x.call(null,h=n[d]))||isNaN(m=+this._y.call(null,h))||isNaN(x=+this._z.call(null,h))||(t[d]=p,s[d]=m,r[d]=x,p<i&&(i=p),p>l&&(l=p),m<o&&(o=m),m>c&&(c=m),x<a&&(a=x),x>u&&(u=x));if(i>l||o>c||a>u)return this;this.cover(i,o,a).cover(l,c,u);for(let d=0;d<e;++d)b1(this,t[d],s[d],r[d],n[d]);return this}function AM(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var s=this._x0,r=this._y0,i=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(s))o=(s=Math.floor(n))+1,a=(r=Math.floor(e))+1,l=(i=Math.floor(t))+1;else{for(var c=o-s||1,u=this._root,d,h;s>n||n>=o||r>e||e>=a||i>t||t>=l;)switch(h=(t<i)<<2|(e<r)<<1|n<s,d=new Array(8),d[h]=u,u=d,c*=2,h){case 0:o=s+c,a=r+c,l=i+c;break;case 1:s=o-c,a=r+c,l=i+c;break;case 2:o=s+c,r=a-c,l=i+c;break;case 3:s=o-c,r=a-c,l=i+c;break;case 4:o=s+c,a=r+c,i=l-c;break;case 5:s=o-c,a=r+c,i=l-c;break;case 6:o=s+c,r=a-c,i=l-c;break;case 7:s=o-c,r=a-c,i=l-c;break}this._root&&this._root.length&&(this._root=u)}return this._x0=s,this._y0=r,this._z0=i,this._x1=o,this._y1=a,this._z1=l,this}function CM(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function RM(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function $e(n,e,t,s,r,i,o){this.node=n,this.x0=e,this.y0=t,this.z0=s,this.x1=r,this.y1=i,this.z1=o}function MM(n,e,t,s){var r,i=this._x0,o=this._y0,a=this._z0,l,c,u,d,h,p,m=this._x1,x=this._y1,y=this._z1,g=[],b=this._root,v,_;for(b&&g.push(new $e(b,i,o,a,m,x,y)),s==null?s=1/0:(i=n-s,o=e-s,a=t-s,m=n+s,x=e+s,y=t+s,s*=s);v=g.pop();)if(!(!(b=v.node)||(l=v.x0)>m||(c=v.y0)>x||(u=v.z0)>y||(d=v.x1)<i||(h=v.y1)<o||(p=v.z1)<a))if(b.length){var w=(l+d)/2,T=(c+h)/2,E=(u+p)/2;g.push(new $e(b[7],w,T,E,d,h,p),new $e(b[6],l,T,E,w,h,p),new $e(b[5],w,c,E,d,T,p),new $e(b[4],l,c,E,w,T,p),new $e(b[3],w,T,u,d,h,E),new $e(b[2],l,T,u,w,h,E),new $e(b[1],w,c,u,d,T,E),new $e(b[0],l,c,u,w,T,E)),(_=(t>=E)<<2|(e>=T)<<1|n>=w)&&(v=g[g.length-1],g[g.length-1]=g[g.length-1-_],g[g.length-1-_]=v)}else{var S=n-+this._x.call(null,b.data),C=e-+this._y.call(null,b.data),k=t-+this._z.call(null,b.data),B=S*S+C*C+k*k;if(B<s){var V=Math.sqrt(s=B);i=n-V,o=e-V,a=t-V,m=n+V,x=e+V,y=t+V,r=b.data}}return r}const PM=(n,e,t,s,r,i)=>Math.sqrt((n-s)**2+(e-r)**2+(t-i)**2);function kM(n,e,t,s){const r=[],i=n-s,o=e-s,a=t-s,l=n+s,c=e+s,u=t+s;return this.visit((d,h,p,m,x,y,g)=>{if(!d.length)do{const b=d.data;PM(n,e,t,this._x(b),this._y(b),this._z(b))<=s&&r.push(b)}while(d=d.next);return h>l||p>c||m>u||x<i||y<o||g<a}),r}function DM(n){if(isNaN(h=+this._x.call(null,n))||isNaN(p=+this._y.call(null,n))||isNaN(m=+this._z.call(null,n)))return this;var e,t=this._root,s,r,i,o=this._x0,a=this._y0,l=this._z0,c=this._x1,u=this._y1,d=this._z1,h,p,m,x,y,g,b,v,_,w,T;if(!t)return this;if(t.length)for(;;){if((b=h>=(x=(o+c)/2))?o=x:c=x,(v=p>=(y=(a+u)/2))?a=y:u=y,(_=m>=(g=(l+d)/2))?l=g:d=g,e=t,!(t=t[w=_<<2|v<<1|b]))return this;if(!t.length)break;(e[w+1&7]||e[w+2&7]||e[w+3&7]||e[w+4&7]||e[w+5&7]||e[w+6&7]||e[w+7&7])&&(s=e,T=w)}for(;t.data!==n;)if(r=t,!(t=t.next))return this;return(i=t.next)&&delete t.next,r?(i?r.next=i:delete r.next,this):e?(i?e[w]=i:delete e[w],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(s?s[T]=t:this._root=t),this):(this._root=i,this)}function IM(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function BM(){return this._root}function LM(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function FM(n){var e=[],t,s=this._root,r,i,o,a,l,c,u;for(s&&e.push(new $e(s,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(s=t.node,i=t.x0,o=t.y0,a=t.z0,l=t.x1,c=t.y1,u=t.z1)&&s.length){var d=(i+l)/2,h=(o+c)/2,p=(a+u)/2;(r=s[7])&&e.push(new $e(r,d,h,p,l,c,u)),(r=s[6])&&e.push(new $e(r,i,h,p,d,c,u)),(r=s[5])&&e.push(new $e(r,d,o,p,l,h,u)),(r=s[4])&&e.push(new $e(r,i,o,p,d,h,u)),(r=s[3])&&e.push(new $e(r,d,h,a,l,c,p)),(r=s[2])&&e.push(new $e(r,i,h,a,d,c,p)),(r=s[1])&&e.push(new $e(r,d,o,a,l,h,p)),(r=s[0])&&e.push(new $e(r,i,o,a,d,h,p))}return this}function OM(n){var e=[],t=[],s;for(this._root&&e.push(new $e(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));s=e.pop();){var r=s.node;if(r.length){var i,o=s.x0,a=s.y0,l=s.z0,c=s.x1,u=s.y1,d=s.z1,h=(o+c)/2,p=(a+u)/2,m=(l+d)/2;(i=r[0])&&e.push(new $e(i,o,a,l,h,p,m)),(i=r[1])&&e.push(new $e(i,h,a,l,c,p,m)),(i=r[2])&&e.push(new $e(i,o,p,l,h,u,m)),(i=r[3])&&e.push(new $e(i,h,p,l,c,u,m)),(i=r[4])&&e.push(new $e(i,o,a,m,h,p,d)),(i=r[5])&&e.push(new $e(i,h,a,m,c,p,d)),(i=r[6])&&e.push(new $e(i,o,p,m,h,u,d)),(i=r[7])&&e.push(new $e(i,h,p,m,c,u,d))}t.push(s)}for(;s=t.pop();)n(s.node,s.x0,s.y0,s.z0,s.x1,s.y1,s.z1);return this}function jM(n){return n[0]}function UM(n){return arguments.length?(this._x=n,this):this._x}function VM(n){return n[1]}function GM(n){return arguments.length?(this._y=n,this):this._y}function $M(n){return n[2]}function zM(n){return arguments.length?(this._z=n,this):this._z}function v1(n,e,t,s){var r=new lm(e??jM,t??VM,s??$M,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function lm(n,e,t,s,r,i,o,a,l){this._x=n,this._y=e,this._z=t,this._x0=s,this._y0=r,this._z0=i,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function g0(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Rt=v1.prototype=lm.prototype;Rt.copy=function(){var n=new lm(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,s;if(!e)return n;if(!e.length)return n._root=g0(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(s=e.source[r])&&(s.length?t.push({source:s,target:e.target[r]=new Array(8)}):e.target[r]=g0(s));return n};Rt.add=SM;Rt.addAll=EM;Rt.cover=AM;Rt.data=CM;Rt.extent=RM;Rt.find=MM;Rt.findAllWithinRadius=kM;Rt.remove=DM;Rt.removeAll=IM;Rt.root=BM;Rt.size=LM;Rt.visit=FM;Rt.visitAfter=OM;Rt.x=UM;Rt.y=GM;Rt.z=zM;function Ss(n){return function(){return n}}function xs(n){return(n()-.5)*1e-6}function HM(n){return n.index}function x0(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function WM(n){var e=HM,t=h,s,r=Ss(30),i,o,a,l,c,u,d=1;n==null&&(n=[]);function h(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function p(g){for(var b=0,v=n.length;b<d;++b)for(var _=0,w,T,E,S=0,C=0,k=0,B,V;_<v;++_)w=n[_],T=w.source,E=w.target,S=E.x+E.vx-T.x-T.vx||xs(u),a>1&&(C=E.y+E.vy-T.y-T.vy||xs(u)),a>2&&(k=E.z+E.vz-T.z-T.vz||xs(u)),B=Math.sqrt(S*S+C*C+k*k),B=(B-i[_])/B*g*s[_],S*=B,C*=B,k*=B,E.vx-=S*(V=c[_]),a>1&&(E.vy-=C*V),a>2&&(E.vz-=k*V),T.vx+=S*(V=1-V),a>1&&(T.vy+=C*V),a>2&&(T.vz+=k*V)}function m(){if(o){var g,b=o.length,v=n.length,_=new Map(o.map((T,E)=>[e(T,E,o),T])),w;for(g=0,l=new Array(b);g<v;++g)w=n[g],w.index=g,typeof w.source!="object"&&(w.source=x0(_,w.source)),typeof w.target!="object"&&(w.target=x0(_,w.target)),l[w.source.index]=(l[w.source.index]||0)+1,l[w.target.index]=(l[w.target.index]||0)+1;for(g=0,c=new Array(v);g<v;++g)w=n[g],c[g]=l[w.source.index]/(l[w.source.index]+l[w.target.index]);s=new Array(v),x(),i=new Array(v),y()}}function x(){if(o)for(var g=0,b=n.length;g<b;++g)s[g]=+t(n[g],g,n)}function y(){if(o)for(var g=0,b=n.length;g<b;++g)i[g]=+r(n[g],g,n)}return p.initialize=function(g,...b){o=g,u=b.find(v=>typeof v=="function")||Math.random,a=b.find(v=>[1,2,3].includes(v))||2,m()},p.links=function(g){return arguments.length?(n=g,m(),p):n},p.id=function(g){return arguments.length?(e=g,p):e},p.iterations=function(g){return arguments.length?(d=+g,p):d},p.strength=function(g){return arguments.length?(t=typeof g=="function"?g:Ss(+g),x(),p):t},p.distance=function(g){return arguments.length?(r=typeof g=="function"?g:Ss(+g),y(),p):r},p}var qM={value:()=>{}};function el(){for(var n=0,e=arguments.length,t={},s;n<e;++n){if(!(s=arguments[n]+"")||s in t||/[\s.]/.test(s))throw new Error("illegal type: "+s);t[s]=[]}return new xc(t)}function xc(n){this._=n}function KM(n,e){return n.trim().split(/^|\s+/).map(function(t){var s="",r=t.indexOf(".");if(r>=0&&(s=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:s}})}xc.prototype=el.prototype={constructor:xc,on:function(n,e){var t=this._,s=KM(n+"",t),r,i=-1,o=s.length;if(arguments.length<2){for(;++i<o;)if((r=(n=s[i]).type)&&(r=XM(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<o;)if(r=(n=s[i]).type)t[r]=y0(t[r],n.name,e);else if(e==null)for(r in t)t[r]=y0(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new xc(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),s=0,r,i;s<r;++s)t[s]=arguments[s+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(i=this._[n],s=0,r=i.length;s<r;++s)i[s].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)}};function XM(n,e){for(var t=0,s=n.length,r;t<s;++t)if((r=n[t]).name===e)return r.value}function y0(n,e,t){for(var s=0,r=n.length;s<r;++s)if(n[s].name===e){n[s]=qM,n=n.slice(0,s).concat(n.slice(s+1));break}return t!=null&&n.push({name:e,value:t}),n}var Qi=0,Jo=0,Co=0,_1=1e3,Wc,ea,qc=0,Jr=0,Du=0,Pa=typeof performance=="object"&&performance.now?performance:Date,T1=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function cm(){return Jr||(T1(YM),Jr=Pa.now()+Du)}function YM(){Jr=0}function Kc(){this._call=this._time=this._next=null}Kc.prototype=um.prototype={constructor:Kc,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?cm():+t)+(e==null?0:+e),!this._next&&ea!==this&&(ea?ea._next=this:Wc=this,ea=this),this._call=n,this._time=t,wf()},stop:function(){this._call&&(this._call=null,this._time=1/0,wf())}};function um(n,e,t){var s=new Kc;return s.restart(n,e,t),s}function QM(){cm(),++Qi;for(var n=Wc,e;n;)(e=Jr-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Qi}function b0(){Jr=(qc=Pa.now())+Du,Qi=Jo=0;try{QM()}finally{Qi=0,JM(),Jr=0}}function ZM(){var n=Pa.now(),e=n-qc;e>_1&&(Du-=e,qc=n)}function JM(){for(var n,e=Wc,t,s=1/0;e;)e._call?(s>e._time&&(s=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Wc=t);ea=n,wf(s)}function wf(n){if(!Qi){Jo&&(Jo=clearTimeout(Jo));var e=n-Jr;e>24?(n<1/0&&(Jo=setTimeout(b0,n-Pa.now()-Du)),Co&&(Co=clearInterval(Co))):(Co||(qc=Pa.now(),Co=setInterval(ZM,_1)),Qi=1,T1(b0))}}function v0(n,e,t){var s=new Kc;return e=e==null?0:+e,s.restart(r=>{s.stop(),n(r+e)},e,t),s}const eP=1664525,tP=1013904223,_0=4294967296;function nP(){let n=1;return()=>(n=(eP*n+tP)%_0)/_0}var T0=3;function xd(n){return n.x}function w0(n){return n.y}function sP(n){return n.z}var rP=10,iP=Math.PI*(3-Math.sqrt(5)),oP=Math.PI*20/(9+Math.sqrt(221));function aP(n,e){e=e||2;var t=Math.min(T0,Math.max(1,Math.round(e))),s,r=1,i=.001,o=1-Math.pow(i,1/300),a=0,l=.6,c=new Map,u=um(p),d=el("tick","end"),h=nP();n==null&&(n=[]);function p(){m(),d.call("tick",s),r<i&&(u.stop(),d.call("end",s))}function m(g){var b,v=n.length,_;g===void 0&&(g=1);for(var w=0;w<g;++w)for(r+=(a-r)*o,c.forEach(function(T){T(r)}),b=0;b<v;++b)_=n[b],_.fx==null?_.x+=_.vx*=l:(_.x=_.fx,_.vx=0),t>1&&(_.fy==null?_.y+=_.vy*=l:(_.y=_.fy,_.vy=0)),t>2&&(_.fz==null?_.z+=_.vz*=l:(_.z=_.fz,_.vz=0));return s}function x(){for(var g=0,b=n.length,v;g<b;++g){if(v=n[g],v.index=g,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),v.fz!=null&&(v.z=v.fz),isNaN(v.x)||t>1&&isNaN(v.y)||t>2&&isNaN(v.z)){var _=rP*(t>2?Math.cbrt(.5+g):t>1?Math.sqrt(.5+g):g),w=g*iP,T=g*oP;t===1?v.x=_:t===2?(v.x=_*Math.cos(w),v.y=_*Math.sin(w)):(v.x=_*Math.sin(w)*Math.cos(T),v.y=_*Math.cos(w),v.z=_*Math.sin(w)*Math.sin(T))}(isNaN(v.vx)||t>1&&isNaN(v.vy)||t>2&&isNaN(v.vz))&&(v.vx=0,t>1&&(v.vy=0),t>2&&(v.vz=0))}}function y(g){return g.initialize&&g.initialize(n,h,t),g}return x(),s={tick:m,restart:function(){return u.restart(p),s},stop:function(){return u.stop(),s},numDimensions:function(g){return arguments.length?(t=Math.min(T0,Math.max(1,Math.round(g))),c.forEach(y),s):t},nodes:function(g){return arguments.length?(n=g,x(),c.forEach(y),s):n},alpha:function(g){return arguments.length?(r=+g,s):r},alphaMin:function(g){return arguments.length?(i=+g,s):i},alphaDecay:function(g){return arguments.length?(o=+g,s):+o},alphaTarget:function(g){return arguments.length?(a=+g,s):a},velocityDecay:function(g){return arguments.length?(l=1-g,s):1-l},randomSource:function(g){return arguments.length?(h=g,c.forEach(y),s):h},force:function(g,b){return arguments.length>1?(b==null?c.delete(g):c.set(g,y(b)),s):c.get(g)},find:function(){var g=Array.prototype.slice.call(arguments),b=g.shift()||0,v=(t>1?g.shift():null)||0,_=(t>2?g.shift():null)||0,w=g.shift()||1/0,T=0,E=n.length,S,C,k,B,V,z;for(w*=w,T=0;T<E;++T)V=n[T],S=b-V.x,C=v-(V.y||0),k=_-(V.z||0),B=S*S+C*C+k*k,B<w&&(z=V,w=B);return z},on:function(g,b){return arguments.length>1?(d.on(g,b),s):d.on(g)}}}function lP(){var n,e,t,s,r,i=Ss(-30),o,a=1,l=1/0,c=.81;function u(m){var x,y=n.length,g=(e===1?g1(n,xd):e===2?y1(n,xd,w0):e===3?v1(n,xd,w0,sP):null).visitAfter(h);for(r=m,x=0;x<y;++x)t=n[x],g.visit(p)}function d(){if(n){var m,x=n.length,y;for(o=new Array(x),m=0;m<x;++m)y=n[m],o[y.index]=+i(y,m,n)}}function h(m){var x=0,y,g,b=0,v,_,w,T,E=m.length;if(E){for(v=_=w=T=0;T<E;++T)(y=m[T])&&(g=Math.abs(y.value))&&(x+=y.value,b+=g,v+=g*(y.x||0),_+=g*(y.y||0),w+=g*(y.z||0));x*=Math.sqrt(4/E),m.x=v/b,e>1&&(m.y=_/b),e>2&&(m.z=w/b)}else{y=m,y.x=y.data.x,e>1&&(y.y=y.data.y),e>2&&(y.z=y.data.z);do x+=o[y.data.index];while(y=y.next)}m.value=x}function p(m,x,y,g,b){if(!m.value)return!0;var v=[y,g,b][e-1],_=m.x-t.x,w=e>1?m.y-t.y:0,T=e>2?m.z-t.z:0,E=v-x,S=_*_+w*w+T*T;if(E*E/c<S)return S<l&&(_===0&&(_=xs(s),S+=_*_),e>1&&w===0&&(w=xs(s),S+=w*w),e>2&&T===0&&(T=xs(s),S+=T*T),S<a&&(S=Math.sqrt(a*S)),t.vx+=_*m.value*r/S,e>1&&(t.vy+=w*m.value*r/S),e>2&&(t.vz+=T*m.value*r/S)),!0;if(m.length||S>=l)return;(m.data!==t||m.next)&&(_===0&&(_=xs(s),S+=_*_),e>1&&w===0&&(w=xs(s),S+=w*w),e>2&&T===0&&(T=xs(s),S+=T*T),S<a&&(S=Math.sqrt(a*S)));do m.data!==t&&(E=o[m.data.index]*r/S,t.vx+=_*E,e>1&&(t.vy+=w*E),e>2&&(t.vz+=T*E));while(m=m.next)}return u.initialize=function(m,...x){n=m,s=x.find(y=>typeof y=="function")||Math.random,e=x.find(y=>[1,2,3].includes(y))||2,d()},u.strength=function(m){return arguments.length?(i=typeof m=="function"?m:Ss(+m),d(),u):i},u.distanceMin=function(m){return arguments.length?(a=m*m,u):Math.sqrt(a)},u.distanceMax=function(m){return arguments.length?(l=m*m,u):Math.sqrt(l)},u.theta=function(m){return arguments.length?(c=m*m,u):Math.sqrt(c)},u}function cP(n,e,t,s){var r,i,o=Ss(.1),a,l;typeof n!="function"&&(n=Ss(+n)),e==null&&(e=0),t==null&&(t=0),s==null&&(s=0);function c(d){for(var h=0,p=r.length;h<p;++h){var m=r[h],x=m.x-e||1e-6,y=(m.y||0)-t||1e-6,g=(m.z||0)-s||1e-6,b=Math.sqrt(x*x+y*y+g*g),v=(l[h]-b)*a[h]*d/b;m.vx+=x*v,i>1&&(m.vy+=y*v),i>2&&(m.vz+=g*v)}}function u(){if(r){var d,h=r.length;for(a=new Array(h),l=new Array(h),d=0;d<h;++d)l[d]=+n(r[d],d,r),a[d]=isNaN(l[d])?0:+o(r[d],d,r)}}return c.initialize=function(d,...h){r=d,i=h.find(p=>[1,2,3].includes(p))||2,u()},c.strength=function(d){return arguments.length?(o=typeof d=="function"?d:Ss(+d),u(),c):o},c.radius=function(d){return arguments.length?(n=typeof d=="function"?d:Ss(+d),u(),c):n},c.x=function(d){return arguments.length?(e=+d,c):e},c.y=function(d){return arguments.length?(t=+d,c):t},c.z=function(d){return arguments.length?(s=+d,c):s},c}function uP(n){hP(n);const e=dP(n);return n.on=e.on,n.off=e.off,n.fire=e.fire,n}function dP(n){let e=Object.create(null);return{on:function(t,s,r){if(typeof s!="function")throw new Error("callback is expected to be a function");let i=e[t];return i||(i=e[t]=[]),i.push({callback:s,ctx:r}),n},off:function(t,s){if(typeof t>"u")return e=Object.create(null),n;if(e[t])if(typeof s!="function")delete e[t];else{const o=e[t];for(let a=0;a<o.length;++a)o[a].callback===s&&o.splice(a,1)}return n},fire:function(t){const s=e[t];if(!s)return n;let r;arguments.length>1&&(r=Array.prototype.slice.call(arguments,1));for(let i=0;i<s.length;++i){const o=s[i];o.callback.apply(o.ctx,r)}return n}}}function hP(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");const e=["on","fire","off"];for(let t=0;t<e.length;++t)if(n.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}function fP(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,s={},r=0,i=n.multigraph?_:v,o=[],a=R,l=R,c=R,u=R,d={version:20,addNode:x,addLink:b,removeLink:S,removeNode:g,getNode:y,getNodeCount:w,getLinkCount:T,getEdgeCount:T,getLinksCount:T,getNodesCount:w,getLinks:E,forEachNode:W,forEachLinkedNode:A,forEachLink:z,beginUpdate:c,endUpdate:u,clear:V,hasLink:k,hasNode:y,getLink:k,getLinkById:B};return uP(d),h(),d;function h(){var L=d.on;d.on=G;function G(){return d.beginUpdate=c=F,d.endUpdate=u=P,a=p,l=m,d.on=L,L.apply(d,arguments)}}function p(L,G){o.push({link:L,changeType:G})}function m(L,G){o.push({node:L,changeType:G})}function x(L,G){if(L===void 0)throw new Error("Invalid node identifier");c();var Z=y(L);return Z?(Z.data=G,l(Z,"update")):(Z=new pP(L,G),l(Z,"add")),e.set(L,Z),u(),Z}function y(L){return e.get(L)}function g(L){var G=y(L);if(!G)return!1;c();var Z=G.links;return Z&&(Z.forEach(C),G.links=null),e.delete(L),l(G,"remove"),u(),!0}function b(L,G,Z){c();var ee=y(L)||x(L),j=y(G)||x(G),Q=i(L,G,Z),te=t.has(Q.id);return t.set(Q.id,Q),N0(ee,Q),L!==G&&N0(j,Q),a(Q,te?"update":"add"),u(),Q}function v(L,G,Z){var ee=xl(L,G),j=t.get(ee);return j?(j.data=Z,j):new S0(L,G,Z,ee)}function _(L,G,Z){var ee=xl(L,G),j=s.hasOwnProperty(ee);if(j||k(L,G)){j||(s[ee]=0);var Q="@"+ ++s[ee];ee=xl(L+Q,G+Q)}return new S0(L,G,Z,ee)}function w(){return e.size}function T(){return t.size}function E(L){var G=y(L);return G?G.links:null}function S(L,G){return G!==void 0&&(L=k(L,G)),C(L)}function C(L){if(!L||!t.get(L.id))return!1;c(),t.delete(L.id);var G=y(L.fromId),Z=y(L.toId);return G&&G.links.delete(L),Z&&Z.links.delete(L),a(L,"remove"),u(),!0}function k(L,G){if(!(L===void 0||G===void 0))return t.get(xl(L,G))}function B(L){if(L!==void 0)return t.get(L)}function V(){c(),W(function(L){g(L.id)}),u()}function z(L){if(typeof L=="function")for(var G=t.values(),Z=G.next();!Z.done;){if(L(Z.value))return!0;Z=G.next()}}function A(L,G,Z){var ee=y(L);if(ee&&ee.links&&typeof G=="function")return Z?I(ee.links,L,G):O(ee.links,L,G)}function O(L,G,Z){for(var ee,j=L.values(),Q=j.next();!Q.done;){var te=Q.value,ce=te.fromId===G?te.toId:te.fromId;if(ee=Z(e.get(ce),te),ee)return!0;Q=j.next()}}function I(L,G,Z){for(var ee,j=L.values(),Q=j.next();!Q.done;){var te=Q.value;if(te.fromId===G&&(ee=Z(e.get(te.toId),te),ee))return!0;Q=j.next()}}function R(){}function F(){r+=1}function P(){r-=1,r===0&&o.length>0&&(d.fire("changed",o),o.length=0)}function W(L){if(typeof L!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+L);for(var G=e.values(),Z=G.next();!Z.done;){if(L(Z.value))return!0;Z=G.next()}}}function pP(n,e){this.id=n,this.links=null,this.data=e}function N0(n,e){n.links?n.links.add(e):n.links=new Set([e])}function S0(n,e,t,s){this.fromId=n,this.toId=e,this.data=t,this.id=s}function xl(n,e){return n.toString()+" "+e.toString()}var yl={exports:{}},ui={exports:{}},yd,E0;function w1(){return E0||(E0=1,yd=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),yd}var bd,A0;function po(){if(A0)return bd;A0=1;const n=w1();return bd=function(t){return s;function s(r,i){let o=i&&i.indent||0,a=i&&i.join!==void 0?i.join:`
`,l=Array(o+1).join(" "),c=[];for(let u=0;u<t;++u){let d=n(u),h=u===0?"":l;c.push(h+r.replace(/{var}/g,d))}return c.join(a)}},bd}var C0;function mP(){if(C0)return ui.exports;C0=1;const n=po();ui.exports=e,ui.exports.generateCreateBodyFunctionBody=t,ui.exports.getVectorCode=r,ui.exports.getBodyCode=s;function e(i,o){let a=t(i,o),{Body:l}=new Function(a)();return l}function t(i,o){return`
${r(i,o)}
${s(i)}
return {Body: Body, Vector: Vector};
`}function s(i){let o=n(i),a=o("{var}",{join:", "});return`
function Body(${a}) {
  this.isPinned = false;
  this.pos = new Vector(${a});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${a}) {
  ${o("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function r(i,o){let a=n(i),l="";return o&&(l=`${a(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${a("{var}",{join:", "})}) {
  ${l}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${a('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${a("this.{var} = v.{var};",{indent:4})}
    } else {
      ${a('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${a("this.{var} = ",{join:""})}0;
  };`}return ui.exports}var ds={exports:{}},R0;function gP(){if(R0)return ds.exports;R0=1;const n=po(),e=w1();ds.exports=t,ds.exports.generateQuadTreeFunctionBody=s,ds.exports.getInsertStackCode=l,ds.exports.getQuadNodeCode=a,ds.exports.isSamePosition=r,ds.exports.getChildBodyCode=o,ds.exports.setChildBodyCode=i;function t(c){let u=s(c);return new Function(u)()}function s(c){let u=n(c),d=Math.pow(2,c);return`
${l()}
${a(c)}
${r(c)}
${o(c)}
${i(c)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${x("      node.")}
      node.body = null;
      node.mass = ${u("node.mass_{var} = ",{join:""})}0;
      ${u("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${u("var d{var};",{indent:4})}
    var r; 
    ${u("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${u("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${u("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${u("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${u("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${u("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${u("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${m()}
        }
      }
    }

    ${u("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${u("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${u("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${u("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${u("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${u("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${u("root.min_{var} = {var}min;",{indent:4})}
    ${u("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${u("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${u("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${u("var min_{var} = node.min_{var};",{indent:8})}
        ${u("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${p(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${u("child.min_{var} = min_{var};",{indent:10})}
          ${u("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${u("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${u("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function p(y){let g=[],b=Array(y+1).join(" ");for(let v=0;v<c;++v)g.push(b+`if (${e(v)} > max_${e(v)}) {`),g.push(b+`  quadIdx = quadIdx + ${Math.pow(2,v)};`),g.push(b+`  min_${e(v)} = max_${e(v)};`),g.push(b+`  max_${e(v)} = node.max_${e(v)};`),g.push(b+"}");return g.join(`
`)}function m(){let y=Array(11).join(" "),g=[];for(let b=0;b<d;++b)g.push(y+`if (node.quad${b}) {`),g.push(y+`  queue[pushIdx] = node.quad${b};`),g.push(y+"  queueLength += 1;"),g.push(y+"  pushIdx += 1;"),g.push(y+"}");return g.join(`
`)}function x(y){let g=[];for(let b=0;b<d;++b)g.push(`${y}quad${b} = null;`);return g.join(`
`)}}function r(c){let u=n(c);return`
  function isSamePosition(point1, point2) {
    ${u("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${u("d{var} < 1e-8",{join:" && "})};
  }  
`}function i(c){var u=Math.pow(2,c);return`
function setChild(node, idx, child) {
  ${d()}
}`;function d(){let h=[];for(let p=0;p<u;++p){let m=p===0?"  ":"  else ";h.push(`${m}if (idx === ${p}) node.quad${p} = child;`)}return h.join(`
`)}}function o(c){return`function getChild(node, idx) {
${u()}
  return null;
}`;function u(){let d=[],h=Math.pow(2,c);for(let p=0;p<h;++p)d.push(`  if (idx === ${p}) return node.quad${p};`);return d.join(`
`)}}function a(c){let u=n(c),d=Math.pow(2,c);var h=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${p("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${u("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${u("this.min_{var} = 0;",{indent:2})}
  ${u("this.max_{var} = 0;",{indent:2})}
}
`;return h;function p(m){let x=[];for(let y=0;y<d;++y)x.push(`${m}quad${y} = null;`);return x.join(`
`)}}function l(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return ds.exports}var bl={exports:{}},M0;function xP(){if(M0)return bl.exports;M0=1,bl.exports=e,bl.exports.generateFunctionBody=t;const n=po();function e(s){let r=t(s);return new Function("bodies","settings","random",r)}function t(s){let r=n(s);return`
  var boundingBox = {
    ${r("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${r("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${r("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${r("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${r("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${r("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${r("var max_{var} = -Infinity;",{indent:4})}
    ${r("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${r("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${r("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${r("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${r("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${r("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return bl.exports}var vl={exports:{}},P0;function yP(){if(P0)return vl.exports;P0=1;const n=po();vl.exports=e,vl.exports.generateCreateDragForceFunctionBody=t;function e(s){let r=t(s);return new Function("options",r)}function t(s){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${n(s)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return vl.exports}var _l={exports:{}},k0;function bP(){if(k0)return _l.exports;k0=1;const n=po();_l.exports=e,_l.exports.generateCreateSpringForceFunctionBody=t;function e(s){let r=t(s);return new Function("options","random",r)}function t(s){let r=n(s);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${r("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${r("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${r("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${r("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return _l.exports}var Tl={exports:{}},D0;function vP(){if(D0)return Tl.exports;D0=1;const n=po();Tl.exports=e,Tl.exports.generateIntegratorFunctionBody=t;function e(s){let r=t(s);return new Function("bodies","timeStep","adaptiveTimeStepWeight",r)}function t(s){let r=n(s);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${r("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${r("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${r("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${r("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${r("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${r("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${r("body.pos.{var} += d{var};",{indent:4})}

    ${r("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${r("t{var} * t{var}",{join:" + "})})/length;
`}return Tl.exports}var vd,I0;function _P(){if(I0)return vd;I0=1,vd=n;function n(e,t,s,r){this.from=e,this.to=t,this.length=s,this.coefficient=r}return vd}var _d,B0;function TP(){if(B0)return _d;B0=1,_d=n;function n(e,t){var s;if(e||(e={}),t){for(s in t)if(t.hasOwnProperty(s)){var r=e.hasOwnProperty(s),i=typeof t[s],o=!r||typeof e[s]!==i;o?e[s]=t[s]:i==="object"&&(e[s]=n(e[s],t[s]))}}return e}return _d}var Td,L0;function N1(){if(L0)return Td;L0=1;function n(s){t(s);const r=e(s);return s.on=r.on,s.off=r.off,s.fire=r.fire,s}function e(s){let r=Object.create(null);return{on:function(i,o,a){if(typeof o!="function")throw new Error("callback is expected to be a function");let l=r[i];return l||(l=r[i]=[]),l.push({callback:o,ctx:a}),s},off:function(i,o){if(typeof i>"u")return r=Object.create(null),s;if(r[i])if(typeof o!="function")delete r[i];else{const a=r[i];for(let l=0;l<a.length;++l)a[l].callback===o&&a.splice(l,1)}return s},fire:function(i){const o=r[i];if(!o)return s;let a;arguments.length>1&&(a=Array.prototype.slice.call(arguments,1));for(let l=0;l<o.length;++l){const c=o[l];c.callback.apply(c.ctx,a)}return s}}}function t(s){if(!s)throw new Error("Eventify cannot use falsy object as events subject");const r=["on","fire","off"];for(let i=0;i<r.length;++i)if(s.hasOwnProperty(r[i]))throw new Error("Subject cannot be eventified, since it already has property '"+r[i]+"'")}return Td=n,Td}var Ro={exports:{}},F0;function wP(){if(F0)return Ro.exports;F0=1,Ro.exports=n,Ro.exports.random=n,Ro.exports.randomIterator=a;function n(l){var c=typeof l=="number"?l:+new Date;return new e(c)}function e(l){this.seed=l}e.prototype.next=o,e.prototype.nextDouble=i,e.prototype.uniform=i,e.prototype.gaussian=t,e.prototype.random=i;function t(){var l,c,u;do c=this.nextDouble()*2-1,u=this.nextDouble()*2-1,l=c*c+u*u;while(l>=1||l===0);return c*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=s;function s(){var l=1.5,c=Math.pow(r(1+l)*Math.sin(Math.PI*l/2)/(r((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*c/Math.pow(Math.abs(this.gaussian()),1/l)}function r(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function i(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function o(l){return Math.floor(this.nextDouble()*l)}function a(l,c){var u=c||n();if(typeof u.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:h,shuffle:d};function d(){var p,m,x;for(p=l.length-1;p>0;--p)m=u.next(p+1),x=l[m],l[m]=l[p],l[p]=x;return l}function h(p){var m,x,y;for(m=l.length-1;m>0;--m)x=u.next(m+1),y=l[x],l[x]=l[m],l[m]=y,p(y);l.length&&p(l[0])}}return Ro.exports}var wd,O0;function j0(){if(O0)return wd;O0=1,wd=a;var n=mP(),e=gP(),t=xP(),s=yP(),r=bP(),i=vP(),o={};function a(u){var d=_P(),h=TP(),p=N1();if(u){if(u.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(u.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}u=h(u,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var m=o[u.dimensions];if(!m){var x=u.dimensions;m={Body:n(x,u.debug),createQuadTree:e(x),createBounds:t(x),createDragForce:s(x),createSpringForce:r(x),integrate:i(x)},o[x]=m}var y=m.Body,g=m.createQuadTree,b=m.createBounds,v=m.createDragForce,_=m.createSpringForce,w=m.integrate,T=j=>new y(j),E=wP().random(42),S=[],C=[],k=g(u,E),B=b(S,u,E),V=_(u,E),z=v(u),A=0,O=[],I=new Map,R=0;W("nbody",Z),W("spring",ee);var F={bodies:S,quadTree:k,springs:C,settings:u,addForce:W,removeForce:L,getForces:G,step:function(){for(var j=0;j<O.length;++j)O[j](R);var Q=w(S,u.timeStep,u.adaptiveTimeStepWeight);return R+=1,Q},addBody:function(j){if(!j)throw new Error("Body is required");return S.push(j),j},addBodyAt:function(j){if(!j)throw new Error("Body position is required");var Q=T(j);return S.push(Q),Q},removeBody:function(j){if(j){var Q=S.indexOf(j);if(!(Q<0))return S.splice(Q,1),S.length===0&&B.reset(),!0}},addSpring:function(j,Q,te,ce){if(!j||!Q)throw new Error("Cannot add null spring to force simulator");typeof te!="number"&&(te=-1);var ve=new d(j,Q,te,ce>=0?ce:-1);return C.push(ve),ve},getTotalMovement:function(){return A},removeSpring:function(j){if(j){var Q=C.indexOf(j);if(Q>-1)return C.splice(Q,1),!0}},getBestNewBodyPosition:function(j){return B.getBestNewPosition(j)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(j){return j!==void 0?(u.gravity=j,k.options({gravity:j}),this):u.gravity},theta:function(j){return j!==void 0?(u.theta=j,k.options({theta:j}),this):u.theta},random:E};return l(u,F),p(F),F;function P(){return B.update(),B.box}function W(j,Q){if(I.has(j))throw new Error("Force "+j+" is already added");I.set(j,Q),O.push(Q)}function L(j){var Q=O.indexOf(I.get(j));Q<0||(O.splice(Q,1),I.delete(j))}function G(){return I}function Z(){if(S.length!==0){k.insertBodies(S);for(var j=S.length;j--;){var Q=S[j];Q.isPinned||(Q.reset(),k.updateBodyForce(Q),z.update(Q))}}}function ee(){for(var j=C.length;j--;)V.update(C[j])}}function l(u,d){for(var h in u)c(u,d,h)}function c(u,d,h){if(u.hasOwnProperty(h)&&typeof d[h]!="function"){var p=Number.isFinite(u[h]);p?d[h]=function(m){if(m!==void 0){if(!Number.isFinite(m))throw new Error("Value of "+h+" should be a valid number.");return u[h]=m,d}return u[h]}:d[h]=function(m){return m!==void 0?(u[h]=m,d):u[h]}}}return wd}var U0;function NP(){if(U0)return yl.exports;U0=1,yl.exports=e,yl.exports.simulator=j0();var n=N1();function e(s,r){if(!s)throw new Error("Graph structure cannot be undefined");var i=r&&r.createSimulator||j0(),o=i(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var a=s.version>19?I:O;r&&typeof r.nodeMass=="function"&&(a=r.nodeMass);var l=new Map,c={},u=0,d=o.settings.springTransform||t;T(),v();var h=!1,p={step:function(){if(u===0)return m(!0),!0;var R=o.step();p.lastMove=R,p.fire("step");var F=R/u,P=F<=.01;return m(P),P},getNodePosition:function(R){return A(R).pos},setNodePosition:function(R){var F=A(R);F.setPosition.apply(F,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(R){var F=c[R];if(F)return{from:F.from.pos,to:F.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:x,pinNode:function(R,F){var P=A(R.id);P.isPinned=!!F},isNodePinned:function(R){return A(R.id).isPinned},dispose:function(){s.off("changed",w),p.fire("disposed")},getBody:b,getSpring:g,getForceVectorLength:y,simulator:o,graph:s,lastMove:0};return n(p),p;function m(R){h!==R&&(h=R,_(R))}function x(R){l.forEach(R)}function y(){var R=0,F=0;return x(function(P){R+=Math.abs(P.force.x),F+=Math.abs(P.force.y)}),Math.sqrt(R*R+F*F)}function g(R,F){var P;if(F===void 0)typeof R!="object"?P=R:P=R.id;else{var W=s.hasLink(R,F);if(!W)return;P=W.id}return c[P]}function b(R){return l.get(R)}function v(){s.on("changed",w)}function _(R){p.fire("stable",R)}function w(R){for(var F=0;F<R.length;++F){var P=R[F];P.changeType==="add"?(P.node&&E(P.node.id),P.link&&C(P.link)):P.changeType==="remove"&&(P.node&&S(P.node),P.link&&k(P.link))}u=s.getNodesCount()}function T(){u=0,s.forEachNode(function(R){E(R.id),u+=1}),s.forEachLink(C)}function E(R){var F=l.get(R);if(!F){var P=s.getNode(R);if(!P)throw new Error("initBody() was called with unknown node id");var W=P.position;if(!W){var L=B(P);W=o.getBestNewBodyPosition(L)}F=o.addBodyAt(W),F.id=R,l.set(R,F),V(R),z(P)&&(F.isPinned=!0)}}function S(R){var F=R.id,P=l.get(F);P&&(l.delete(F),o.removeBody(P))}function C(R){V(R.fromId),V(R.toId);var F=l.get(R.fromId),P=l.get(R.toId),W=o.addSpring(F,P,R.length);d(R,W),c[R.id]=W}function k(R){var F=c[R.id];if(F){var P=s.getNode(R.fromId),W=s.getNode(R.toId);P&&V(P.id),W&&V(W.id),delete c[R.id],o.removeSpring(F)}}function B(R){var F=[];if(!R.links)return F;for(var P=Math.min(R.links.length,2),W=0;W<P;++W){var L=R.links[W],G=L.fromId!==R.id?l.get(L.fromId):l.get(L.toId);G&&G.pos&&F.push(G)}return F}function V(R){var F=l.get(R);if(F.mass=a(R),Number.isNaN(F.mass))throw new Error("Node mass should be a number")}function z(R){return R&&(R.isPinned||R.data&&R.data.isPinned)}function A(R){var F=l.get(R);return F||(E(R),F=l.get(R)),F}function O(R){var F=s.getLinks(R);return F?1+F.length/3:1}function I(R){var F=s.getLinks(R);return F?1+F.size/3:1}}function t(){}return yl.exports}var SP=NP();const EP=n_(SP);function Nf(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var AP=typeof global=="object"&&global&&global.Object===Object&&global,CP=typeof self=="object"&&self&&self.Object===Object&&self,S1=AP||CP||Function("return this")(),Nd=function(){return S1.Date.now()},RP=/\s/;function MP(n){for(var e=n.length;e--&&RP.test(n.charAt(e)););return e}var PP=/^\s+/;function kP(n){return n&&n.slice(0,MP(n)+1).replace(PP,"")}var Xc=S1.Symbol,E1=Object.prototype,DP=E1.hasOwnProperty,IP=E1.toString,Mo=Xc?Xc.toStringTag:void 0;function BP(n){var e=DP.call(n,Mo),t=n[Mo];try{n[Mo]=void 0;var s=!0}catch{}var r=IP.call(n);return s&&(e?n[Mo]=t:delete n[Mo]),r}var LP=Object.prototype,FP=LP.toString;function OP(n){return FP.call(n)}var jP="[object Null]",UP="[object Undefined]",V0=Xc?Xc.toStringTag:void 0;function VP(n){return n==null?n===void 0?UP:jP:V0&&V0 in Object(n)?BP(n):OP(n)}function GP(n){return n!=null&&typeof n=="object"}var $P="[object Symbol]";function zP(n){return typeof n=="symbol"||GP(n)&&VP(n)==$P}var G0=NaN,HP=/^[-+]0x[0-9a-f]+$/i,WP=/^0b[01]+$/i,qP=/^0o[0-7]+$/i,KP=parseInt;function $0(n){if(typeof n=="number")return n;if(zP(n))return G0;if(Nf(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Nf(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=kP(n);var t=WP.test(n);return t||qP.test(n)?KP(n.slice(2),t?2:8):HP.test(n)?G0:+n}var XP="Expected a function",YP=Math.max,QP=Math.min;function ZP(n,e,t){var s,r,i,o,a,l,c=0,u=!1,d=!1,h=!0;if(typeof n!="function")throw new TypeError(XP);e=$0(e)||0,Nf(t)&&(u=!!t.leading,d="maxWait"in t,i=d?YP($0(t.maxWait)||0,e):i,h="trailing"in t?!!t.trailing:h);function p(T){var E=s,S=r;return s=r=void 0,c=T,o=n.apply(S,E),o}function m(T){return c=T,a=setTimeout(g,e),u?p(T):o}function x(T){var E=T-l,S=T-c,C=e-E;return d?QP(C,i-S):C}function y(T){var E=T-l,S=T-c;return l===void 0||E>=e||E<0||d&&S>=i}function g(){var T=Nd();if(y(T))return b(T);a=setTimeout(g,x(T))}function b(T){return a=void 0,h&&s?p(T):(s=r=void 0,o)}function v(){a!==void 0&&clearTimeout(a),c=0,s=l=r=a=void 0}function _(){return a===void 0?o:b(Nd())}function w(){var T=Nd(),E=y(T);if(s=arguments,r=this,l=T,E){if(a===void 0)return m(l);if(d)return clearTimeout(a),a=setTimeout(g,e),p(l)}return a===void 0&&(a=setTimeout(g,e)),o}return w.cancel=v,w.flush=_,w}function z0(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function JP(n){if(Array.isArray(n))return n}function ek(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function tk(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function nk(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function sk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rk(n,e){return JP(n)||nk(n,e)||ik(n,e)||sk()}function ik(n,e){if(n){if(typeof n=="string")return z0(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?z0(n,e):void 0}}var ok=tk(function n(e,t){var s=t.default,r=s===void 0?null:s,i=t.triggerUpdate,o=i===void 0?!0:i,a=t.onChange,l=a===void 0?function(c,u){}:a;ek(this,n),this.name=e,this.defaultVal=r,this.triggerUpdate=o,this.onChange=l});function Iu(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,s=n.props,r=s===void 0?{}:s,i=n.methods,o=i===void 0?{}:i,a=n.aliases,l=a===void 0?{}:a,c=n.init,u=c===void 0?function(){}:c,d=n.update,h=d===void 0?function(){}:d,p=Object.keys(r).map(function(m){return new ok(m,r[m])});return function m(){for(var x=arguments.length,y=new Array(x),g=0;g<x;g++)y[g]=arguments[g];var b=!!(this instanceof m&&this.constructor),v=b?y.shift():void 0,_=y[0],w=_===void 0?{}:_,T=Object.assign({},t instanceof Function?t(w):t,{initialised:!1}),E={};function S(B){return C(B,w),k(),S}var C=function(V,z){u.call(S,V,T,z),T.initialised=!0},k=ZP(function(){T.initialised&&(h.call(S,T,E),E={})},1);return p.forEach(function(B){S[B.name]=V(B);function V(z){var A=z.name,O=z.triggerUpdate,I=O===void 0?!1:O,R=z.onChange,F=R===void 0?function(L,G){}:R,P=z.defaultVal,W=P===void 0?null:P;return function(L){var G=T[A];if(!arguments.length)return G;var Z=L===void 0?W:L;return T[A]=Z,F.call(S,Z,T,G),!E.hasOwnProperty(A)&&(E[A]=G),I&&k(),S}}}),Object.keys(o).forEach(function(B){S[B]=function(){for(var V,z=arguments.length,A=new Array(z),O=0;O<z;O++)A[O]=arguments[O];return(V=o[B]).call.apply(V,[S,T].concat(A))}}),Object.entries(l).forEach(function(B){var V=rk(B,2),z=V[0],A=V[1];return S[z]=S[A]}),S.resetProps=function(){return p.forEach(function(B){S[B.name](B.defaultVal)}),S},S.resetProps(),T._rerender=k,b&&v&&S(v),S}}var Ce=(function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}});class H0 extends Map{constructor(e,t=ck){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[s,r]of e)this.set(s,r)}get(e){return super.get(W0(this,e))}has(e){return super.has(W0(this,e))}set(e,t){return super.set(ak(this,e),t)}delete(e){return super.delete(lk(this,e))}}function W0({_intern:n,_key:e},t){const s=e(t);return n.has(s)?n.get(s):t}function ak({_intern:n,_key:e},t){const s=e(t);return n.has(s)?n.get(s):(n.set(s,t),t)}function lk({_intern:n,_key:e},t){const s=e(t);return n.has(s)&&(t=n.get(s),n.delete(s)),t}function ck(n){return n!==null&&typeof n=="object"?n.valueOf():n}function uk(n,e){let t;if(e===void 0)for(const s of n)s!=null&&(t<s||t===void 0&&s>=s)&&(t=s);else{let s=-1;for(let r of n)(r=e(r,++s,n))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function dk(n,e){let t;if(e===void 0)for(const s of n)s!=null&&(t>s||t===void 0&&s>=s)&&(t=s);else{let s=-1;for(let r of n)(r=e(r,++s,n))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function Sf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function hk(n){if(Array.isArray(n))return n}function fk(n){if(Array.isArray(n))return Sf(n)}function A1(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function pk(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function mk(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Pt(n,e){return n.get(A1(n,e))}function di(n,e,t){pk(n,e),e.set(n,t)}function wl(n,e,t){return n.set(A1(n,e),t),t}function gk(n,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,Sk(s.key),s)}}function xk(n,e,t){return e&&gk(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function yk(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function bk(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function vk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _k(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tk(n,e){return hk(n)||bk(n,e)||C1(n,e)||vk()}function wk(n){return fk(n)||yk(n)||C1(n)||_k()}function Nk(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function Sk(n){var e=Nk(n,"string");return typeof e=="symbol"?e:e+""}function C1(n,e){if(n){if(typeof n=="string")return Sf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Sf(n,e):void 0}}var hi=new WeakMap,Po=new WeakMap,fi=new WeakMap,Sd=new WeakMap,Ed=new WeakMap,Ad=new WeakMap,Ek=(function(){function n(){mk(this,n),di(this,hi,new Map),di(this,Po,new Map),di(this,fi,function(e){return e}),di(this,Sd,function(){return{}}),di(this,Ed,function(){}),di(this,Ad,function(){})}return xk(n,[{key:"getObj",value:function(t){return Pt(hi,this).get(Pt(fi,this).call(this,t))}},{key:"getData",value:function(t){return Pt(Po,this).get(t)}},{key:"entries",value:function(){return wk(Pt(Po,this).entries()).map(function(t){var s=Tk(t,2),r=s[0],i=s[1];return[i,r]})}},{key:"id",value:function(t){return wl(fi,this,Ce(t)),this}},{key:"onCreateObj",value:function(t){return wl(Sd,this,t),this}},{key:"onUpdateObj",value:function(t){return wl(Ed,this,t),this}},{key:"onRemoveObj",value:function(t){return wl(Ad,this,t),this}},{key:"digest",value:function(t){var s=this;t.filter(function(i){return!Pt(hi,s).has(Pt(fi,s).call(s,i))}).forEach(function(i){var o=Pt(Sd,s).call(s,i);Pt(hi,s).set(Pt(fi,s).call(s,i),o),Pt(Po,s).set(o,i)});var r=new Map(t.map(function(i){return[Pt(fi,s).call(s,i),i]}));return Pt(hi,this).forEach(function(i,o){r.has(o)?Pt(Ed,s).call(s,i,r.get(o)):(Pt(Ad,s).call(s,i,o),Pt(hi,s).delete(o),Pt(Po,s).delete(i))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])})();function Ak(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const q0=Symbol("implicit");function dm(){var n=new H0,e=[],t=[],s=q0;function r(i){let o=n.get(i);if(o===void 0){if(s!==q0)return s;n.set(i,o=e.push(i)-1)}return t[o%t.length]}return r.domain=function(i){if(!arguments.length)return e.slice();e=[],n=new H0;for(const o of i)n.has(o)||n.set(o,e.push(o)-1);return r},r.range=function(i){return arguments.length?(t=Array.from(i),r):t.slice()},r.unknown=function(i){return arguments.length?(s=i,r):s},r.copy=function(){return dm(e,t).unknown(s)},Ak.apply(r,arguments),r}function hm(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function R1(n,e){var t=Object.create(n.prototype);for(var s in e)t[s]=e[s];return t}function tl(){}var ka=.7,Yc=1/ka,Oi="\\s*([+-]?\\d+)\\s*",Da="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ck=/^#([0-9a-f]{3,8})$/,Rk=new RegExp(`^rgb\\(${Oi},${Oi},${Oi}\\)$`),Mk=new RegExp(`^rgb\\(${Jn},${Jn},${Jn}\\)$`),Pk=new RegExp(`^rgba\\(${Oi},${Oi},${Oi},${Da}\\)$`),kk=new RegExp(`^rgba\\(${Jn},${Jn},${Jn},${Da}\\)$`),Dk=new RegExp(`^hsl\\(${Da},${Jn},${Jn}\\)$`),Ik=new RegExp(`^hsla\\(${Da},${Jn},${Jn},${Da}\\)$`),K0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};hm(tl,Ia,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:X0,formatHex:X0,formatHex8:Bk,formatHsl:Lk,formatRgb:Y0,toString:Y0});function X0(){return this.rgb().formatHex()}function Bk(){return this.rgb().formatHex8()}function Lk(){return M1(this).formatHsl()}function Y0(){return this.rgb().formatRgb()}function Ia(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=Ck.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?Q0(e):t===3?new qt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Nl(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Nl(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Rk.exec(n))?new qt(e[1],e[2],e[3],1):(e=Mk.exec(n))?new qt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Pk.exec(n))?Nl(e[1],e[2],e[3],e[4]):(e=kk.exec(n))?Nl(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Dk.exec(n))?ex(e[1],e[2]/100,e[3]/100,1):(e=Ik.exec(n))?ex(e[1],e[2]/100,e[3]/100,e[4]):K0.hasOwnProperty(n)?Q0(K0[n]):n==="transparent"?new qt(NaN,NaN,NaN,0):null}function Q0(n){return new qt(n>>16&255,n>>8&255,n&255,1)}function Nl(n,e,t,s){return s<=0&&(n=e=t=NaN),new qt(n,e,t,s)}function Fk(n){return n instanceof tl||(n=Ia(n)),n?(n=n.rgb(),new qt(n.r,n.g,n.b,n.opacity)):new qt}function Ef(n,e,t,s){return arguments.length===1?Fk(n):new qt(n,e,t,s??1)}function qt(n,e,t,s){this.r=+n,this.g=+e,this.b=+t,this.opacity=+s}hm(qt,Ef,R1(tl,{brighter(n){return n=n==null?Yc:Math.pow(Yc,n),new qt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?ka:Math.pow(ka,n),new qt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new qt(qr(this.r),qr(this.g),qr(this.b),Qc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Z0,formatHex:Z0,formatHex8:Ok,formatRgb:J0,toString:J0}));function Z0(){return`#${jr(this.r)}${jr(this.g)}${jr(this.b)}`}function Ok(){return`#${jr(this.r)}${jr(this.g)}${jr(this.b)}${jr((isNaN(this.opacity)?1:this.opacity)*255)}`}function J0(){const n=Qc(this.opacity);return`${n===1?"rgb(":"rgba("}${qr(this.r)}, ${qr(this.g)}, ${qr(this.b)}${n===1?")":`, ${n})`}`}function Qc(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function qr(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function jr(n){return n=qr(n),(n<16?"0":"")+n.toString(16)}function ex(n,e,t,s){return s<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Mn(n,e,t,s)}function M1(n){if(n instanceof Mn)return new Mn(n.h,n.s,n.l,n.opacity);if(n instanceof tl||(n=Ia(n)),!n)return new Mn;if(n instanceof Mn)return n;n=n.rgb();var e=n.r/255,t=n.g/255,s=n.b/255,r=Math.min(e,t,s),i=Math.max(e,t,s),o=NaN,a=i-r,l=(i+r)/2;return a?(e===i?o=(t-s)/a+(t<s)*6:t===i?o=(s-e)/a+2:o=(e-t)/a+4,a/=l<.5?i+r:2-i-r,o*=60):a=l>0&&l<1?0:o,new Mn(o,a,l,n.opacity)}function jk(n,e,t,s){return arguments.length===1?M1(n):new Mn(n,e,t,s??1)}function Mn(n,e,t,s){this.h=+n,this.s=+e,this.l=+t,this.opacity=+s}hm(Mn,jk,R1(tl,{brighter(n){return n=n==null?Yc:Math.pow(Yc,n),new Mn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?ka:Math.pow(ka,n),new Mn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,s=t+(t<.5?t:1-t)*e,r=2*t-s;return new qt(Cd(n>=240?n-240:n+120,r,s),Cd(n,r,s),Cd(n<120?n+240:n-120,r,s),this.opacity)},clamp(){return new Mn(tx(this.h),Sl(this.s),Sl(this.l),Qc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Qc(this.opacity);return`${n===1?"hsl(":"hsla("}${tx(this.h)}, ${Sl(this.s)*100}%, ${Sl(this.l)*100}%${n===1?")":`, ${n})`}`}}));function tx(n){return n=(n||0)%360,n<0?n+360:n}function Sl(n){return Math.max(0,Math.min(1,n||0))}function Cd(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const P1=n=>()=>n;function Uk(n,e){return function(t){return n+t*e}}function Vk(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(s){return Math.pow(n+s*e,t)}}function Gk(n){return(n=+n)==1?k1:function(e,t){return t-e?Vk(e,t,n):P1(isNaN(e)?t:e)}}function k1(n,e){var t=e-n;return t?Uk(n,t):P1(isNaN(n)?e:n)}const nx=(function n(e){var t=Gk(e);function s(r,i){var o=t((r=Ef(r)).r,(i=Ef(i)).r),a=t(r.g,i.g),l=t(r.b,i.b),c=k1(r.opacity,i.opacity);return function(u){return r.r=o(u),r.g=a(u),r.b=l(u),r.opacity=c(u),r+""}}return s.gamma=n,s})(1);function Ws(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var Af=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Rd=new RegExp(Af.source,"g");function $k(n){return function(){return n}}function zk(n){return function(e){return n(e)+""}}function Hk(n,e){var t=Af.lastIndex=Rd.lastIndex=0,s,r,i,o=-1,a=[],l=[];for(n=n+"",e=e+"";(s=Af.exec(n))&&(r=Rd.exec(e));)(i=r.index)>t&&(i=e.slice(t,i),a[o]?a[o]+=i:a[++o]=i),(s=s[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:Ws(s,r)})),t=Rd.lastIndex;return t<e.length&&(i=e.slice(t),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?zk(l[0].x):$k(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}var sx=180/Math.PI,Cf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function D1(n,e,t,s,r,i){var o,a,l;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(l=n*t+e*s)&&(t-=n*l,s-=e*l),(a=Math.sqrt(t*t+s*s))&&(t/=a,s/=a,l/=a),n*s<e*t&&(n=-n,e=-e,l=-l,o=-o),{translateX:r,translateY:i,rotate:Math.atan2(e,n)*sx,skewX:Math.atan(l)*sx,scaleX:o,scaleY:a}}var El;function Wk(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Cf:D1(e.a,e.b,e.c,e.d,e.e,e.f)}function qk(n){return n==null||(El||(El=document.createElementNS("http://www.w3.org/2000/svg","g")),El.setAttribute("transform",n),!(n=El.transform.baseVal.consolidate()))?Cf:(n=n.matrix,D1(n.a,n.b,n.c,n.d,n.e,n.f))}function I1(n,e,t,s){function r(c){return c.length?c.pop()+" ":""}function i(c,u,d,h,p,m){if(c!==d||u!==h){var x=p.push("translate(",null,e,null,t);m.push({i:x-4,x:Ws(c,d)},{i:x-2,x:Ws(u,h)})}else(d||h)&&p.push("translate("+d+e+h+t)}function o(c,u,d,h){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),h.push({i:d.push(r(d)+"rotate(",null,s)-2,x:Ws(c,u)})):u&&d.push(r(d)+"rotate("+u+s)}function a(c,u,d,h){c!==u?h.push({i:d.push(r(d)+"skewX(",null,s)-2,x:Ws(c,u)}):u&&d.push(r(d)+"skewX("+u+s)}function l(c,u,d,h,p,m){if(c!==d||u!==h){var x=p.push(r(p)+"scale(",null,",",null,")");m.push({i:x-4,x:Ws(c,d)},{i:x-2,x:Ws(u,h)})}else(d!==1||h!==1)&&p.push(r(p)+"scale("+d+","+h+")")}return function(c,u){var d=[],h=[];return c=n(c),u=n(u),i(c.translateX,c.translateY,u.translateX,u.translateY,d,h),o(c.rotate,u.rotate,d,h),a(c.skewX,u.skewX,d,h),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,h),c=u=null,function(p){for(var m=-1,x=h.length,y;++m<x;)d[(y=h[m]).i]=y.x(p);return d.join("")}}}var Kk=I1(Wk,"px, ","px)","deg)"),Xk=I1(qk,", ",")",")"),Yk=1e-12;function rx(n){return((n=Math.exp(n))+1/n)/2}function Qk(n){return((n=Math.exp(n))-1/n)/2}function Zk(n){return((n=Math.exp(2*n))-1)/(n+1)}const Jk=(function n(e,t,s){function r(i,o){var a=i[0],l=i[1],c=i[2],u=o[0],d=o[1],h=o[2],p=u-a,m=d-l,x=p*p+m*m,y,g;if(x<Yk)g=Math.log(h/c)/e,y=function(E){return[a+E*p,l+E*m,c*Math.exp(e*E*g)]};else{var b=Math.sqrt(x),v=(h*h-c*c+s*x)/(2*c*t*b),_=(h*h-c*c-s*x)/(2*h*t*b),w=Math.log(Math.sqrt(v*v+1)-v),T=Math.log(Math.sqrt(_*_+1)-_);g=(T-w)/e,y=function(E){var S=E*g,C=rx(w),k=c/(t*b)*(C*Zk(e*S+w)-Qk(w));return[a+k*p,l+k*m,c*C/rx(e*S+w)]}}return y.duration=g*1e3*e/Math.SQRT2,y}return r.rho=function(i){var o=Math.max(.001,+i),a=o*o,l=a*a;return n(o,a,l)},r})(Math.SQRT2,2,4);function B1(n){for(var e=n.length/6|0,t=new Array(e),s=0;s<e;)t[s]="#"+n.slice(s*6,++s*6);return t}const eD=B1("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),tD=B1("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Zc(n){"@babel/helpers - typeof";return Zc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zc(n)}var nD=/^\s+/,sD=/\s+$/;function he(n,e){if(n=n||"",e=e||{},n instanceof he)return n;if(!(this instanceof he))return new he(n,e);var t=rD(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}he.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,s,r,i,o,a;return t=e.r/255,s=e.g/255,r=e.b/255,t<=.03928?i=t/12.92:i=Math.pow((t+.055)/1.055,2.4),s<=.03928?o=s/12.92:o=Math.pow((s+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),.2126*i+.7152*o+.0722*a},setAlpha:function(e){return this._a=L1(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=ox(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=ox(this._r,this._g,this._b),t=Math.round(e.h*360),s=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+s+"%, "+r+"%)":"hsva("+t+", "+s+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=ix(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=ix(this._r,this._g,this._b),t=Math.round(e.h*360),s=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+s+"%, "+r+"%)":"hsla("+t+", "+s+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return ax(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return lD(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ye(this._r,255)*100)+"%",g:Math.round(Ye(this._g,255)*100)+"%",b:Math.round(Ye(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ye(this._r,255)*100)+"%, "+Math.round(Ye(this._g,255)*100)+"%, "+Math.round(Ye(this._b,255)*100)+"%)":"rgba("+Math.round(Ye(this._r,255)*100)+"%, "+Math.round(Ye(this._g,255)*100)+"%, "+Math.round(Ye(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:vD[ax(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+lx(this._r,this._g,this._b,this._a),s=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=he(e);s="#"+lx(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+s+")"},toString:function(e){var t=!!e;e=e||this._format;var s=!1,r=this._a<1&&this._a>=0,i=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return i?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(s=this.toRgbString()),e==="prgb"&&(s=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(s=this.toHexString()),e==="hex3"&&(s=this.toHexString(!0)),e==="hex4"&&(s=this.toHex8String(!0)),e==="hex8"&&(s=this.toHex8String()),e==="name"&&(s=this.toName()),e==="hsl"&&(s=this.toHslString()),e==="hsv"&&(s=this.toHsvString()),s||this.toHexString())},clone:function(){return he(this.toString())},_applyModification:function(e,t){var s=e.apply(null,[this].concat([].slice.call(t)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function(){return this._applyModification(hD,arguments)},brighten:function(){return this._applyModification(fD,arguments)},darken:function(){return this._applyModification(pD,arguments)},desaturate:function(){return this._applyModification(cD,arguments)},saturate:function(){return this._applyModification(uD,arguments)},greyscale:function(){return this._applyModification(dD,arguments)},spin:function(){return this._applyModification(mD,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(yD,arguments)},complement:function(){return this._applyCombination(gD,arguments)},monochromatic:function(){return this._applyCombination(bD,arguments)},splitcomplement:function(){return this._applyCombination(xD,arguments)},triad:function(){return this._applyCombination(cx,[3])},tetrad:function(){return this._applyCombination(cx,[4])}};he.fromRatio=function(n,e){if(Zc(n)=="object"){var t={};for(var s in n)n.hasOwnProperty(s)&&(s==="a"?t[s]=n[s]:t[s]=ta(n[s]));n=t}return he(n,e)};function rD(n){var e={r:0,g:0,b:0},t=1,s=null,r=null,i=null,o=!1,a=!1;return typeof n=="string"&&(n=ND(n)),Zc(n)=="object"&&(hs(n.r)&&hs(n.g)&&hs(n.b)?(e=iD(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):hs(n.h)&&hs(n.s)&&hs(n.v)?(s=ta(n.s),r=ta(n.v),e=aD(n.h,s,r),o=!0,a="hsv"):hs(n.h)&&hs(n.s)&&hs(n.l)&&(s=ta(n.s),i=ta(n.l),e=oD(n.h,s,i),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=L1(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function iD(n,e,t){return{r:Ye(n,255)*255,g:Ye(e,255)*255,b:Ye(t,255)*255}}function ix(n,e,t){n=Ye(n,255),e=Ye(e,255),t=Ye(t,255);var s=Math.max(n,e,t),r=Math.min(n,e,t),i,o,a=(s+r)/2;if(s==r)i=o=0;else{var l=s-r;switch(o=a>.5?l/(2-s-r):l/(s+r),s){case n:i=(e-t)/l+(e<t?6:0);break;case e:i=(t-n)/l+2;break;case t:i=(n-e)/l+4;break}i/=6}return{h:i,s:o,l:a}}function oD(n,e,t){var s,r,i;n=Ye(n,360),e=Ye(e,100),t=Ye(t,100);function o(c,u,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?c+(u-c)*6*d:d<1/2?u:d<2/3?c+(u-c)*(2/3-d)*6:c}if(e===0)s=r=i=t;else{var a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;s=o(l,a,n+1/3),r=o(l,a,n),i=o(l,a,n-1/3)}return{r:s*255,g:r*255,b:i*255}}function ox(n,e,t){n=Ye(n,255),e=Ye(e,255),t=Ye(t,255);var s=Math.max(n,e,t),r=Math.min(n,e,t),i,o,a=s,l=s-r;if(o=s===0?0:l/s,s==r)i=0;else{switch(s){case n:i=(e-t)/l+(e<t?6:0);break;case e:i=(t-n)/l+2;break;case t:i=(n-e)/l+4;break}i/=6}return{h:i,s:o,v:a}}function aD(n,e,t){n=Ye(n,360)*6,e=Ye(e,100),t=Ye(t,100);var s=Math.floor(n),r=n-s,i=t*(1-e),o=t*(1-r*e),a=t*(1-(1-r)*e),l=s%6,c=[t,o,i,i,a,t][l],u=[a,t,t,o,i,i][l],d=[i,i,a,t,t,o][l];return{r:c*255,g:u*255,b:d*255}}function ax(n,e,t,s){var r=[Dn(Math.round(n).toString(16)),Dn(Math.round(e).toString(16)),Dn(Math.round(t).toString(16))];return s&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function lD(n,e,t,s,r){var i=[Dn(Math.round(n).toString(16)),Dn(Math.round(e).toString(16)),Dn(Math.round(t).toString(16)),Dn(F1(s))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function lx(n,e,t,s){var r=[Dn(F1(s)),Dn(Math.round(n).toString(16)),Dn(Math.round(e).toString(16)),Dn(Math.round(t).toString(16))];return r.join("")}he.equals=function(n,e){return!n||!e?!1:he(n).toRgbString()==he(e).toRgbString()};he.random=function(){return he.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function cD(n,e){e=e===0?0:e||10;var t=he(n).toHsl();return t.s-=e/100,t.s=Bu(t.s),he(t)}function uD(n,e){e=e===0?0:e||10;var t=he(n).toHsl();return t.s+=e/100,t.s=Bu(t.s),he(t)}function dD(n){return he(n).desaturate(100)}function hD(n,e){e=e===0?0:e||10;var t=he(n).toHsl();return t.l+=e/100,t.l=Bu(t.l),he(t)}function fD(n,e){e=e===0?0:e||10;var t=he(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),he(t)}function pD(n,e){e=e===0?0:e||10;var t=he(n).toHsl();return t.l-=e/100,t.l=Bu(t.l),he(t)}function mD(n,e){var t=he(n).toHsl(),s=(t.h+e)%360;return t.h=s<0?360+s:s,he(t)}function gD(n){var e=he(n).toHsl();return e.h=(e.h+180)%360,he(e)}function cx(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=he(n).toHsl(),s=[he(n)],r=360/e,i=1;i<e;i++)s.push(he({h:(t.h+i*r)%360,s:t.s,l:t.l}));return s}function xD(n){var e=he(n).toHsl(),t=e.h;return[he(n),he({h:(t+72)%360,s:e.s,l:e.l}),he({h:(t+216)%360,s:e.s,l:e.l})]}function yD(n,e,t){e=e||6,t=t||30;var s=he(n).toHsl(),r=360/t,i=[he(n)];for(s.h=(s.h-(r*e>>1)+720)%360;--e;)s.h=(s.h+r)%360,i.push(he(s));return i}function bD(n,e){e=e||6;for(var t=he(n).toHsv(),s=t.h,r=t.s,i=t.v,o=[],a=1/e;e--;)o.push(he({h:s,s:r,v:i})),i=(i+a)%1;return o}he.mix=function(n,e,t){t=t===0?0:t||50;var s=he(n).toRgb(),r=he(e).toRgb(),i=t/100,o={r:(r.r-s.r)*i+s.r,g:(r.g-s.g)*i+s.g,b:(r.b-s.b)*i+s.b,a:(r.a-s.a)*i+s.a};return he(o)};he.readability=function(n,e){var t=he(n),s=he(e);return(Math.max(t.getLuminance(),s.getLuminance())+.05)/(Math.min(t.getLuminance(),s.getLuminance())+.05)};he.isReadable=function(n,e,t){var s=he.readability(n,e),r,i;switch(i=!1,r=SD(t),r.level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7;break}return i};he.mostReadable=function(n,e,t){var s=null,r=0,i,o,a,l;t=t||{},o=t.includeFallbackColors,a=t.level,l=t.size;for(var c=0;c<e.length;c++)i=he.readability(n,e[c]),i>r&&(r=i,s=he(e[c]));return he.isReadable(n,s,{level:a,size:l})||!o?s:(t.includeFallbackColors=!1,he.mostReadable(n,["#fff","#000"],t))};var Rf=he.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},vD=he.hexNames=_D(Rf);function _D(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function L1(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function Ye(n,e){TD(n)&&(n="100%");var t=wD(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function Bu(n){return Math.min(1,Math.max(0,n))}function sn(n){return parseInt(n,16)}function TD(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function wD(n){return typeof n=="string"&&n.indexOf("%")!=-1}function Dn(n){return n.length==1?"0"+n:""+n}function ta(n){return n<=1&&(n=n*100+"%"),n}function F1(n){return Math.round(parseFloat(n)*255).toString(16)}function ux(n){return sn(n)/255}var Nn=(function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",s="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+s),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+s),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+s),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function hs(n){return!!Nn.CSS_UNIT.exec(n)}function ND(n){n=n.replace(nD,"").replace(sD,"").toLowerCase();var e=!1;if(Rf[n])n=Rf[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=Nn.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=Nn.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=Nn.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=Nn.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=Nn.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=Nn.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=Nn.hex8.exec(n))?{r:sn(t[1]),g:sn(t[2]),b:sn(t[3]),a:ux(t[4]),format:e?"name":"hex8"}:(t=Nn.hex6.exec(n))?{r:sn(t[1]),g:sn(t[2]),b:sn(t[3]),format:e?"name":"hex"}:(t=Nn.hex4.exec(n))?{r:sn(t[1]+""+t[1]),g:sn(t[2]+""+t[2]),b:sn(t[3]+""+t[3]),a:ux(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=Nn.hex3.exec(n))?{r:sn(t[1]+""+t[1]),g:sn(t[2]+""+t[2]),b:sn(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function SD(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Mf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function ED(n){if(Array.isArray(n))return n}function AD(n){if(Array.isArray(n))return Mf(n)}function O1(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function CD(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function j1(n,e,t){return e=Zi(e),LD(n,fm()?Reflect.construct(e,t||[],Zi(n).constructor):e.apply(n,t))}function RD(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function U1(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Md(n,e){return n.get(O1(n,e))}function dx(n,e,t){RD(n,e),e.set(n,t)}function hx(n,e,t){return n.set(O1(n,e),t),t}function V1(n,e,t){if(fm())return Reflect.construct.apply(null,arguments);var s=[null];s.push.apply(s,e);var r=new(n.bind.apply(n,s));return r}function MD(n,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,z1(s.key),s)}}function G1(n,e,t){return e&&MD(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function Lu(n,e,t){return(e=z1(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Pf(){return Pf=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var s=FD(n,e);if(s){var r=Object.getOwnPropertyDescriptor(s,e);return r.get?r.get.call(arguments.length<3?n:t):r.value}},Pf.apply(null,arguments)}function Zi(n){return Zi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Zi(n)}function $1(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&kf(n,e)}function fm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fm=function(){return!!n})()}function PD(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function kD(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function DD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ID(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function BD(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fx(Object(t),!0).forEach(function(s){Lu(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fx(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function LD(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CD(n)}function kf(n,e){return kf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},kf(n,e)}function fa(n,e){return ED(n)||kD(n,e)||H1(n,e)||DD()}function FD(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=Zi(n))!==null;);return n}function Pd(n,e,t,s){var r=Pf(Zi(n.prototype),e,t);return typeof r=="function"?function(i){return r.apply(t,i)}:r}function En(n){return AD(n)||PD(n)||H1(n)||ID()}function OD(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function z1(n){var e=OD(n,"string");return typeof e=="symbol"?e:e+""}function Df(n){"@babel/helpers - typeof";return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Df(n)}function H1(n,e){if(n){if(typeof n=="string")return Mf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Mf(n,e):void 0}}var W1=function(e){e instanceof Array?e.forEach(W1):(e.map&&e.map.dispose(),e.dispose())},q1=function(e){e.geometry&&e.geometry.dispose(),e.material&&W1(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(q1)},If=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),q1(t)}},kd=new WeakMap,Al=new WeakMap,ko=(function(n){function e(t){var s,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.dataBindAttr,o=i===void 0?"__data":i,a=r.objBindAttr,l=a===void 0?"__threeObj":a;return U1(this,e),s=j1(this,e),Lu(s,"scene",void 0),dx(s,kd,void 0),dx(s,Al,void 0),s.scene=t,hx(kd,s,o),hx(Al,s,l),s.onRemoveObj(function(){}),s}return $1(e,n),G1(e,[{key:"onCreateObj",value:function(s){var r=this;return Pd(e,"onCreateObj",this)([function(i){var o=s(i);return i[Md(Al,r)]=o,o[Md(kd,r)]=i,r.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(s){var r=this;return Pd(e,"onRemoveObj",this)([function(i,o){var a=Pd(e,"getData",r)([i]);s(i,o),r.scene.remove(i),If(i),delete a[Md(Al,r)]}]),this}}])})(Ek),Do=function(e){return isNaN(e)?parseInt(he(e).toHex(),16):e},Dd=function(e){return isNaN(e)?he(e).getAlpha():1},jD=dm(tD);function px(n,e,t){!e||typeof t!="string"||n.filter(function(s){return!s[t]}).forEach(function(s){s[t]=jD(e(s))})}function UD(n,e){var t=n.nodes,s=n.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.nodeFilter,o=i===void 0?function(){return!0}:i,a=r.onLoopError,l=a===void 0?function(p){throw"Invalid DAG structure! Found cycle in node path: ".concat(p.join(" -> "),".")}:a,c={};t.forEach(function(p){return c[e(p)]={data:p,out:[],depth:-1,skip:!o(p)}}),s.forEach(function(p){var m=p.source,x=p.target,y=_(m),g=_(x);if(!c.hasOwnProperty(y))throw"Missing source node with id: ".concat(y);if(!c.hasOwnProperty(g))throw"Missing target node with id: ".concat(g);var b=c[y],v=c[g];b.out.push(v);function _(w){return Df(w)==="object"?e(w):w}});var u=[];h(Object.values(c));var d=Object.assign.apply(Object,[{}].concat(En(Object.entries(c).filter(function(p){var m=fa(p,2),x=m[1];return!x.skip}).map(function(p){var m=fa(p,2),x=m[0],y=m[1];return Lu({},x,y.depth)}))));return d;function h(p){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=function(){var _=p[g];if(m.indexOf(_)!==-1){var w=[].concat(En(m.slice(m.indexOf(_))),[_]).map(function(T){return e(T.data)});return u.some(function(T){return T.length===w.length&&T.every(function(E,S){return E===w[S]})})||(u.push(w),l(w)),1}x>_.depth&&(_.depth=x,h(_.out,[].concat(En(m),[_]),x+(_.skip?0:1)))},g=0,b=p.length;g<b;g++)y()}}var xe=window.THREE?window.THREE:{Group:r_,Mesh:Bn,MeshLambertMaterial:i_,Color:_n,BufferGeometry:Za,BufferAttribute:uc,Matrix4:On,Vector3:ue,SphereGeometry:Vp,CylinderGeometry:o_,TubeGeometry:eA,ConeGeometry:JE,Line:YE,LineBasicMaterial:l_,QuadraticBezierCurve3:ZE,CubicBezierCurve3:QE,Box3:a_},mx={graph:fP,forcelayout:EP},VD=2,Id=new xe.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Cl=new xe.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",GD=Iu({props:{jsonUrl:{onChange:function(e,t){var s=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),s.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var s=t.d3ForceLayout.force("charge");s&&s.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(i,o){i.forEach(function(a){delete a[o],delete a["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(s){return s.fx=s.fy=s.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},linkDirectionalParticleThreeObject:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,s){return s===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,s),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&s(),r(),i(),this;function s(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=Ce(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(h){var p=fa(h,2),m=p[0],x=p[1];if(x){var y=t?m:e.layout.getNodePosition(m[e.nodeId]),g=o(m);(!e.nodePositionUpdate||!e.nodePositionUpdate(g?x.children[0]:x,{x:y.x,y:y.y,z:y.z},m)||g)&&(x.position.x=y.x,x.position.y=y.y||0,x.position.z=y.z||0)}});var a=Ce(e.linkWidth),l=Ce(e.linkCurvature),c=Ce(e.linkCurveRotation),u=Ce(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(h){var p=fa(h,2),m=p[0],x=p[1];if(x){var y=t?m:e.layout.getLinkPosition(e.layout.graph.getLink(m.source,m.target).id),g=y[t?"source":"from"],b=y[t?"target":"to"];if(!(!g||!b||!g.hasOwnProperty("x")||!b.hasOwnProperty("x"))){d(m);var v=u(m);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(v?x.children[1]:x,{start:{x:g.x,y:g.y,z:g.z},end:{x:b.x,y:b.y,z:b.z}},m)&&!v)){var _=30,w=m.__curve,T=x.children.length?x.children[0]:x;if(T.type==="Line"){if(w){var S=w.getPoints(_);T.geometry.getAttribute("position").array.length!==S.length*3&&T.geometry[Id]("position",new xe.BufferAttribute(new Float32Array(S.length*3),3)),T.geometry.setFromPoints(S)}else{var E=T.geometry.getAttribute("position");(!E||!E.array||E.array.length!==6)&&T.geometry[Id]("position",E=new xe.BufferAttribute(new Float32Array(6),3)),E.array[0]=g.x,E.array[1]=g.y||0,E.array[2]=g.z||0,E.array[3]=b.x,E.array[4]=b.y||0,E.array[5]=b.z||0,E.needsUpdate=!0}T.geometry.computeBoundingSphere()}else if(T.type==="Mesh")if(w){T.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(T.position.set(0,0,0),T.rotation.set(0,0,0),T.scale.set(1,1,1));var O=Math.ceil(a(m)*10)/10,I=O/2,R=new xe.TubeGeometry(w,_,I,e.linkResolution,!1);T.geometry.dispose(),T.geometry=R}else{if(!T.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var C=Math.ceil(a(m)*10)/10,k=C/2,B=new xe.CylinderGeometry(k,k,1,e.linkResolution,1,!1);B[Cl](new xe.Matrix4().makeTranslation(0,1/2,0)),B[Cl](new xe.Matrix4().makeRotationX(Math.PI/2)),T.geometry.dispose(),T.geometry=B}var V=new xe.Vector3(g.x,g.y||0,g.z||0),z=new xe.Vector3(b.x,b.y||0,b.z||0),A=V.distanceTo(z);T.position.x=V.x,T.position.y=V.y,T.position.z=V.z,T.scale.z=A,T.parent.localToWorld(z),T.lookAt(z)}}}}});function d(h){var p=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),m=p[t?"source":"from"],x=p[t?"target":"to"];if(!(!m||!x||!m.hasOwnProperty("x")||!x.hasOwnProperty("x"))){var y=l(h);if(!y)h.__curve=null;else{var g=new xe.Vector3(m.x,m.y||0,m.z||0),b=new xe.Vector3(x.x,x.y||0,x.z||0),v=g.distanceTo(b),_,w=c(h);if(v>0){var T=x.x-m.x,E=x.y-m.y||0,S=new xe.Vector3().subVectors(b,g),C=S.clone().multiplyScalar(y).cross(T!==0||E!==0?new xe.Vector3(0,0,1):new xe.Vector3(0,1,0)).applyAxisAngle(S.normalize(),w).add(new xe.Vector3().addVectors(g,b).divideScalar(2));_=new xe.QuadraticBezierCurve3(g,C,b)}else{var k=y*70,B=-w,V=B+Math.PI/2;_=new xe.CubicBezierCurve3(g,new xe.Vector3(k*Math.cos(V),k*Math.sin(V),0).add(g),new xe.Vector3(k*Math.cos(B),k*Math.sin(B),0).add(g),b)}h.__curve=_}}}}function r(){var o=Ce(e.linkDirectionalArrowRelPos),a=Ce(e.linkDirectionalArrowLength),l=Ce(e.nodeVal);e.arrowDataMapper.entries().forEach(function(c){var u=fa(c,2),d=u[0],h=u[1];if(h){var p=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),m=p[t?"source":"from"],x=p[t?"target":"to"];if(!(!m||!x||!m.hasOwnProperty("x")||!x.hasOwnProperty("x"))){var y=Math.cbrt(Math.max(0,l(m)||1))*e.nodeRelSize,g=Math.cbrt(Math.max(0,l(x)||1))*e.nodeRelSize,b=a(d),v=o(d),_=d.__curve?function(k){return d.__curve.getPoint(k)}:function(k){var B=function(z,A,O,I){return A[z]+(O[z]-A[z])*I||0};return{x:B("x",m,x,k),y:B("y",m,x,k),z:B("z",m,x,k)}},w=d.__curve?d.__curve.getLength():Math.sqrt(["x","y","z"].map(function(k){return Math.pow((x[k]||0)-(m[k]||0),2)}).reduce(function(k,B){return k+B},0)),T=y+b+(w-y-g-b)*v,E=_(T/w),S=_((T-b)/w);["x","y","z"].forEach(function(k){return h.position[k]=S[k]});var C=V1(xe.Vector3,En(["x","y","z"].map(function(k){return E[k]})));h.parent.localToWorld(C),h.lookAt(C)}}})}function i(){var o=Ce(e.linkDirectionalParticleSpeed),a=Ce(e.linkDirectionalParticleOffset);e.graphData.links.forEach(function(l){var c=e.particlesDataMapper.getObj(l),u=c&&c.children,d=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!d||!d.length)&&(!u||!u.length))){var h=t?l:e.layout.getLinkPosition(e.layout.graph.getLink(l.source,l.target).id),p=h[t?"source":"from"],m=h[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var x=o(l),y=Math.abs(a(l)),g=l.__curve?function(v){return l.__curve.getPoint(v)}:function(v){var _=function(T,E,S,C){return E[T]+(S[T]-E[T])*C||0};return{x:_("x",p,m,v),y:_("y",p,m,v),z:_("z",p,m,v)}},b=[].concat(En(u||[]),En(d||[]));b.forEach(function(v,_){var w=v.parent.__linkThreeObjType==="singleHopPhotons";if(v.hasOwnProperty("__progressRatio")||(v.__progressRatio=w?0:(_+y)/u.length),v.__progressRatio+=x,v.__progressRatio>=1)if(!w)v.__progressRatio=v.__progressRatio%1;else{v.parent.remove(v),If(v);return}var T=v.__progressRatio,E=g(T);v.geometry.type!=="SphereGeometry"&&v.lookAt(E.x,E.y,E.z),["x","y","z"].forEach(function(S){return v.position[S]=E[S]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var s=new xe.Group;s.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=s,e.graphScene.add(s)}var r=Ce(e.linkDirectionalParticleThreeObject)(t);if(r&&e.linkDirectionalParticleThreeObject===r&&(r=r.clone()),!r){var i=Ce(e.linkDirectionalParticleWidth),o=Math.ceil(i(t)*10)/10/2,a=e.linkDirectionalParticleResolution,l=new xe.SphereGeometry(o,a,a),c=Ce(e.linkColor),u=Ce(e.linkDirectionalParticleColor),d=u(t)||c(t)||"#f0f0f0",h=new xe.Color(Do(d)),p=e.linkOpacity*3,m=new xe.MeshLambertMaterial({color:h,transparent:!0,opacity:p});r=new xe.Mesh(l,m)}t.__singleHopPhotonsObj.add(r)}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var s=(function r(i){var o=[];if(i.geometry){i.geometry.computeBoundingBox();var a=new xe.Box3;a.copy(i.geometry.boundingBox).applyMatrix4(i.matrixWorld),o.push(a)}return o.concat.apply(o,En((i.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(r)))})(e.graphScene);return s.length?Object.assign.apply(Object,En(["x","y","z"].map(function(r){return Lu({},r,[dk(s,function(i){return i.min[r]}),uk(s,function(i){return i.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:aP().force("link",WM()).force("charge",lP()).force("center",K3()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new ko(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new ko(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new ko(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new ko(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var s=function(Q){return Q.some(function(te){return t.hasOwnProperty(te)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&s(["nodeAutoColorBy","graphData","nodeColor"])&&px(e.graphData.nodes,Ce(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&s(["linkAutoColorBy","graphData","linkColor"])&&px(e.graphData.links,Ce(e.linkAutoColorBy),e.linkColor),e._flushObjects||s(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=Ce(e.nodeThreeObject),i=Ce(e.nodeThreeObjectExtend),o=Ce(e.nodeVal),a=Ce(e.nodeColor),l=Ce(e.nodeVisibility),c={},u={};(e._flushObjects||s(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(j){var Q=r(j),te=i(j);Q&&e.nodeThreeObject===Q&&(Q=Q.clone());var ce;return Q&&!te?ce=Q:(ce=new xe.Mesh,ce.__graphDefaultObj=!0,Q&&te&&ce.add(Q)),ce.__graphObjType="node",ce}).onUpdateObj(function(j,Q){if(j.__graphDefaultObj){var te=o(Q)||1,ce=Math.cbrt(te)*e.nodeRelSize,ve=e.nodeResolution;(!j.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||j.geometry.parameters.radius!==ce||j.geometry.parameters.widthSegments!==ve)&&(c.hasOwnProperty(te)||(c[te]=new xe.SphereGeometry(ce,ve,ve)),j.geometry.dispose(),j.geometry=c[te]);var ye=a(Q),Pe=new xe.Color(Do(ye||"#ffffaa")),nt=e.nodeOpacity*Dd(ye);(j.material.type!=="MeshLambertMaterial"||!j.material.color.equals(Pe)||j.material.opacity!==nt)&&(u.hasOwnProperty(ye)||(u[ye]=new xe.MeshLambertMaterial({color:Pe,transparent:!0,opacity:nt})),j.material.dispose(),j.material=u[ye])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||s(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject"])){var d=Ce(e.linkThreeObject),h=Ce(e.linkThreeObjectExtend),p=Ce(e.linkMaterial),m=Ce(e.linkVisibility),x=Ce(e.linkColor),y=Ce(e.linkWidth),g={},b={},v={},_=e.graphData.links.filter(m);if((e._flushObjects||s(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(j){var Q=j.__data&&j.__data.__singleHopPhotonsObj;Q&&(Q.parent.remove(Q),If(Q),delete j.__data.__singleHopPhotonsObj)}).onCreateObj(function(j){var Q=d(j),te=h(j);Q&&e.linkThreeObject===Q&&(Q=Q.clone());var ce;if(!Q||te){var ve=!!y(j);if(ve)ce=new xe.Mesh;else{var ye=new xe.BufferGeometry;ye[Id]("position",new xe.BufferAttribute(new Float32Array(6),3)),ce=new xe.Line(ye)}}var Pe;return Q?te?(Pe=new xe.Group,Pe.__graphDefaultObj=!0,Pe.add(ce),Pe.add(Q)):Pe=Q:(Pe=ce,Pe.__graphDefaultObj=!0),Pe.renderOrder=10,Pe.__graphObjType="link",Pe}).onUpdateObj(function(j,Q){if(j.__graphDefaultObj){var te=j.children.length?j.children[0]:j,ce=Math.ceil(y(Q)*10)/10,ve=!!ce;if(ve){var ye=ce/2,Pe=e.linkResolution;if(!te.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||te.geometry.parameters.radiusTop!==ye||te.geometry.parameters.radialSegments!==Pe){if(!g.hasOwnProperty(ce)){var nt=new xe.CylinderGeometry(ye,ye,1,Pe,1,!1);nt[Cl](new xe.Matrix4().makeTranslation(0,1/2,0)),nt[Cl](new xe.Matrix4().makeRotationX(Math.PI/2)),g[ce]=nt}te.geometry.dispose(),te.geometry=g[ce]}}var xt=p(Q);if(xt)te.material=xt;else{var lt=x(Q),He=new xe.Color(Do(lt||"#f0f0f0")),wt=e.linkOpacity*Dd(lt),ke=ve?"MeshLambertMaterial":"LineBasicMaterial";if(te.material.type!==ke||!te.material.color.equals(He)||te.material.opacity!==wt){var de=ve?b:v;de.hasOwnProperty(lt)||(de[lt]=new xe[ke]({color:He,transparent:wt<1,opacity:wt,depthWrite:wt>=1})),te.material.dispose(),te.material=de[lt]}}}}).digest(_),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var w=Ce(e.linkDirectionalArrowLength),T=Ce(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var j=new xe.Mesh(void 0,new xe.MeshLambertMaterial({transparent:!0}));return j.__linkThreeObjType="arrow",j}).onUpdateObj(function(j,Q){var te=w(Q),ce=e.linkDirectionalArrowResolution;if(!j.geometry.type.match(/^Cone(Buffer)?Geometry$/)||j.geometry.parameters.height!==te||j.geometry.parameters.radialSegments!==ce){var ve=new xe.ConeGeometry(te*.25,te,ce);ve.translate(0,te/2,0),ve.rotateX(Math.PI/2),j.geometry.dispose(),j.geometry=ve}var ye=T(Q)||x(Q)||"#f0f0f0";j.material.color=new xe.Color(Do(ye)),j.material.opacity=e.linkOpacity*3*Dd(ye)}).digest(_.filter(w))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var E=Ce(e.linkDirectionalParticles),S=Ce(e.linkDirectionalParticleWidth),C=Ce(e.linkDirectionalParticleColor),k=Ce(e.linkDirectionalParticleThreeObject),B={},V={};e.particlesDataMapper.onCreateObj(function(){var j=new xe.Group;return j.__linkThreeObjType="photons",j.__photonDataMapper=new ko(j),j}).onUpdateObj(function(j,Q){var te=!!j.children.length&&j.children[0],ce=k(Q),ve,ye;if(ce)ve=ce.geometry,ye=ce.material;else{var Pe=Math.ceil(S(Q)*10)/10/2,nt=e.linkDirectionalParticleResolution;te&&te.geometry.parameters.radius===Pe&&te.geometry.parameters.widthSegments===nt?ve=te.geometry:(V.hasOwnProperty(Pe)||(V[Pe]=new xe.SphereGeometry(Pe,nt,nt)),ve=V[Pe]);var xt=C(Q)||x(Q)||"#f0f0f0",lt=new xe.Color(Do(xt)),He=e.linkOpacity*3;te&&te.material.color.equals(lt)&&te.material.opacity===He?ye=te.material:(B.hasOwnProperty(xt)||(B[xt]=new xe.MeshLambertMaterial({color:lt,transparent:!0,opacity:He})),ye=B[xt])}te&&(te.geometry!==ve&&te.geometry.dispose(),te.material!==ye&&te.material.dispose());var wt=Math.round(Math.abs(E(Q)));j.__photonDataMapper.id(function(ke){return ke.idx}).onCreateObj(function(){return new xe.Mesh(ve,ye)}).onUpdateObj(function(ke){ke.geometry=ve,ke.material=ye}).digest(En(new Array(wt)).map(function(ke,de){return{idx:de}}))}).digest(_.filter(E))}}if(e._flushObjects=!1,s(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(j){j.source=j[e.linkSource],j.target=j[e.linkTarget]});var z=e.forceEngine!=="ngraph",A;if(z){(A=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var O=e.d3ForceLayout.force("link");O&&O.id(function(j){return j[e.nodeId]}).links(e.graphData.links);var I=e.dagMode&&UD(e.graphData,function(j){return j[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),R=Math.max.apply(Math,En(Object.values(I||[]))),F=e.dagLevelDistance||e.graphData.nodes.length/(R||1)*VD*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var P=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(j){return delete j[P]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var W=["rl","td","zout"].includes(e.dagMode),L=function(Q){return(I[Q[e.nodeId]]-R/2)*F*(W?-1:1)},G=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(j){return j[G]=L(j)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?cP(function(j){var Q=I[j[e.nodeId]]||-1;return(e.dagMode==="radialin"?R-Q:Q)*F}).strength(function(j){return e.dagNodeFilter(j)?1:0}):null)}else{var Z=mx.graph();e.graphData.nodes.forEach(function(j){Z.addNode(j[e.nodeId])}),e.graphData.links.forEach(function(j){Z.addLink(j.source,j.target)}),A=mx.forcelayout(Z,BD({dimensions:e.numDimensions},e.ngraphPhysics)),A.graph=Z}for(var ee=0;ee<e.warmupTicks&&!(z&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);ee++)A[z?"tick":"step"]();e.layout=A,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function $D(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=(function(r){function i(){var o;U1(this,i);for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return o=j1(this,i,[].concat(l)),o.__kapsuleInstance=V1(n,[].concat(En(t?[o]:[]),l)),o}return $1(i,r),G1(i)})(e);return Object.keys(n()).forEach(function(r){return s.prototype[r]=function(){var i,o=(i=this.__kapsuleInstance)[r].apply(i,arguments);return o===this.__kapsuleInstance?this:o}}),s}var zD=window.THREE?window.THREE:{Group:r_},K1=$D(GD,zD.Group,!0);const HD=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Bd=new WeakMap;class WD{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=HD,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:s,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:s.id,attributes:this.getAttributesData(s.attributes),indexVersion:s.index?s.index.version:null,drawRange:{start:s.drawRange.start,count:s.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const s in e){const r=e[s];t[s]={version:r.version}}return t}containsNode(e){const t=e.material;for(const s in t)if(t[s]&&t[s].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const s of this.refreshUniforms){const r=e[s];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[s]={id:r.id,version:r.version}:t[s]=r.clone():t[s]=r)}return t}equals(e,t){const{object:s,material:r,geometry:i}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(s.matrixWorld)!==!0)return o.worldMatrix.copy(s.matrixWorld),!1;const a=o.material;for(const y in a){const g=a[y],b=r[y];if(g.equals!==void 0){if(g.equals(b)===!1)return g.copy(b),!1}else if(b.isTexture===!0){if(g.id!==b.id||g.version!==b.version)return g.id=b.id,g.version=b.version,!1}else if(g!==b)return a[y]=b,!1}if(a.transmission>0){const{width:y,height:g}=e.context;if(o.bufferWidth!==y||o.bufferHeight!==g)return o.bufferWidth=y,o.bufferHeight=g,!1}const l=o.geometry,c=i.attributes,u=l.attributes,d=Object.keys(u),h=Object.keys(c);if(l.id!==i.id)return l.id=i.id,!1;if(d.length!==h.length)return o.geometry.attributes=this.getAttributesData(c),!1;for(const y of d){const g=u[y],b=c[y];if(b===void 0)return delete u[y],!1;if(g.version!==b.version)return g.version=b.version,!1}const p=i.index,m=l.indexVersion,x=p?p.version:null;if(m!==x)return l.indexVersion=x,!1;if(l.drawRange.start!==i.drawRange.start||l.drawRange.count!==i.drawRange.count)return l.drawRange.start=i.drawRange.start,l.drawRange.count=i.drawRange.count,!1;if(o.morphTargetInfluences){let y=!1;for(let g=0;g<o.morphTargetInfluences.length;g++)o.morphTargetInfluences[g]!==s.morphTargetInfluences[g]&&(o.morphTargetInfluences[g]=s.morphTargetInfluences[g],y=!0);if(y)return!1}if(o.lights){for(let y=0;y<t.length;y++)if(o.lights[y].map!==t[y].map)return!1}return o.center&&o.center.equals(s.center)===!1?(o.center.copy(s.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const s of e)s.isSpotLight===!0&&s.map!==null&&t.push({map:s.map.version});return t}getLights(e,t){if(Bd.has(e)){const r=Bd.get(e);if(r.renderId===t)return r.lightsData}const s=this.getLightsData(e.getLights());return Bd.set(e,{renderId:t,lightsData:s}),s}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:s}=t;if(this.renderId!==s)return this.renderId=s,!0;const r=e.object.static===!0,i=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;const o=this.getLights(e.lightsNode,s);return this.equals(e,o)!==!0}}function pm(n,e=0){let t=3735928559^e,s=1103547991^e;if(n instanceof Array)for(let r=0,i;r<n.length;r++)i=n[r],t=Math.imul(t^i,2654435761),s=Math.imul(s^i,1597334677);else for(let r=0,i;r<n.length;r++)i=n.charCodeAt(r),t=Math.imul(t^i,2654435761),s=Math.imul(s^i,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&s)+(t>>>0)}const Fu=n=>pm(n),nl=n=>pm(n),pa=(...n)=>pm(n),qD=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),gx=new WeakMap;function KD(n){return qD.get(n)}function Jc(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function mm(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new _n(...e):t==="vec2"?new Se(...e):t==="vec3"?new ue(...e):t==="vec4"?new et(...e):t==="mat2"?new $_(...e):t==="mat3"?new Ja(...e):t==="mat4"?new On(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?YD(e[0]):null}function X1(n){let e=gx.get(n);return e===void 0&&(e={},gx.set(n,e)),e}function XD(n){let e="";const t=new Uint8Array(n);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function YD(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const Rl={VERTEX:"vertex"},we={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Xn={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},QD=["fragment","vertex"],xx=["setup","analyze","generate"],yx=[...QD,"compute"],mo=["x","y","z","w"],ZD={analyze:"setup",generate:"analyze"};let JD=0;class le extends zp{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=we.NONE,this.updateBeforeType=we.NONE,this.updateAfterType=we.NONE,this.uuid=Oc.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:JD++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,we.FRAME)}onRenderUpdate(e){return this.onUpdate(e,we.RENDER)}onObjectUpdate(e){return this.onUpdate(e,we.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const s of Object.getOwnPropertyNames(this)){const r=this[s];if(!(s.startsWith("_")===!0||e.has(r))){if(Array.isArray(r)===!0)for(let i=0;i<r.length;i++){const o=r[i];o&&o.isNode===!0&&t.push({property:s,index:i,childNode:o})}else if(r&&r.isNode===!0)t.push({property:s,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(const i in r){if(i.startsWith("_")===!0)continue;const o=r[i];o&&o.isNode===!0&&t.push({property:s,index:i,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const s=[];for(const{property:r,childNode:i}of this._getChildren(t))s.push(Fu(r.slice(0,-4)),i.getCacheKey(e,t));this._cacheKey=pa(nl(s),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let s=0;for(const r of this.getChildren())t["node"+s++]=r;return t.outputNode||null}analyze(e,t=null){const s=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(s===1){const r=e.getNodeProperties(this);for(const i of Object.values(r))i&&i.isNode===!0&&i.build(e,this)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){ie("Abstract function.")}updateAfter(){ie("Abstract function.")}update(){ie("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);if(this._beforeNodes!==null){const l=this._beforeNodes;this._beforeNodes=null;for(const c of l)c.build(e,t);this._beforeNodes=l}const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const i=ZD[e.buildStage];if(i&&r.buildStages[i]!==!0){const l=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const c of Object.values(l))if(c&&c.isNode===!0){if(c.parents===!0){const u=e.getNodeProperties(c);u.parents=u.parents||[],u.parents.push(this)}c.build(e)}}o=l.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length<2){const c=this.getNodeType(e),u=e.getDataFromNode(this);o=u.snippet,o===void 0?u.generated===void 0?(u.generated=!0,o=this.generate(e)||"",u.snippet=o):(ie("Node: Recursion detected.",this),o="/* Recursion detected. */"):u.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,c,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(re(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:r,index:i,childNode:o}of t)i!==void 0?(s[r]===void 0&&(s[r]=Number.isInteger(i)?[]:{}),s[r][i]=o.toJSON(e.meta).uuid):s[r]=o.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const r=[];for(const i of e.inputNodes[s])r.push(t[i]);this[s]=r}else if(typeof e.inputNodes[s]=="object"){const r={};for(const i in e.inputNodes[s]){const o=e.inputNodes[s][i];r[i]=t[o]}this[s]=r}else{const r=e.inputNodes[s];this[s]=t[r]}}}toJSON(e){const{uuid:t,type:s}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:s,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}if(r){const a=o(e.textures),l=o(e.images),c=o(e.nodes);a.length>0&&(i.textures=a),l.length>0&&(i.images=l),c.length>0&&(i.nodes=c)}return i}}class sl extends le{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),s=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${s}[ ${r} ]`}}class Y1 extends le{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const r of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(r))&&(s=r);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,r=this.getNodeType(e),i=s.build(e,r);return e.format(i,r,t)}}class _t extends le{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(i.propertyName!==void 0)return e.format(i.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),a=e.getVarFromNode(this,null,r),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),i.snippet=o,i.propertyName=l,e.format(i.propertyName,r,t)}}return super.build(e,t)}}class eI extends _t{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),r=e.getTypeLength(s),i=this.nodes,o=e.getComponentType(s),a=[];let l=0;for(const u of i){if(l>=r){re(`TSL: Length of parameters exceeds maximum length of function '${s}()' type.`);break}let d=u.getNodeType(e),h=e.getTypeLength(d),p;if(l+h>r&&(re(`TSL: Length of '${s}()' data exceeds maximum length of output type.`),h=r-l,d=e.getTypeFromLength(h)),l+=h,p=u.build(e,d),e.getComponentType(d)!==o){const x=e.getTypeFromLength(h,o);p=e.format(p,d,x)}a.push(p)}const c=`${e.getType(s)}( ${a.join(", ")} )`;return e.format(c,s,t)}}const tI=mo.join("");class nI extends le{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(mo.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const s=this.node,r=e.getTypeLength(s.getNodeType(e));let i=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=s.build(e,o);this.components.length===r&&this.components===tI.slice(0,this.components.length)?i=e.format(l,o,t):i=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class sI extends _t{static get type(){return"SetNode"}constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:r}=this,i=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),a=e.getTypeFromLength(s.length,o),l=r.build(e,a),c=t.build(e,i),u=e.getTypeLength(i),d=[];for(let h=0;h<u;h++){const p=mo[h];p===s[0]?(d.push(l),h+=s.length-1):d.push(c+"."+p)}return`${e.getType(i)}( ${d.join(", ")} )`}}class rI extends _t{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:s}=this,r=this.getNodeType(e),i=s.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+i,this);const l=e.getTypeLength(r),c=[];let u=0;for(let d=0;d<l;d++){const h=mo[d];h===t[u]?(c.push("1.0 - "+(a+"."+h)),u++):c.push(a+"."+h)}return`${e.getType(r)}( ${c.join(", ")} )`}}let gm=class extends le{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Jc(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Jc(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=XD(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?mm(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){ie("Abstract function.")}};const bx=/float|u?int/;class as extends gm{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return bx.test(s)&&bx.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),s,t)}}class iI extends le{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const s=this.getNodeType(e);return e.getStructTypeNode(s).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){ie(`TSL: Member "${this.property}" does not exist in struct.`);const s=this.getNodeType(e);return e.generateConst(s)}return this.structNode.build(e)+"."+this.property}}let ei=null;const Bf=new Map;function H(n,e){if(Bf.has(n)){ie(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);Bf.set(n,e),n!=="assign"&&(le.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},le.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const oI=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),vx=n=>oI(n).split("").sort().join("");le.prototype.assign=function(...n){if(this.isStackNode!==!0)return ei!==null?ei.assign(this,...n):re("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=Bf.get("assign");return this.addToStack(e(...n))}};le.prototype.toVarIntent=function(){return this};le.prototype.get=function(n){return new iI(this,n)};const ma={};function Ml(n,e,t){ma[n]=ma[e]=ma[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new nI(this,n),this._cache[n]=o),o},set(o){this[n].assign(J(o))}};const s=n.toUpperCase(),r=e.toUpperCase(),i=t.toUpperCase();le.prototype["set"+s]=le.prototype["set"+r]=le.prototype["set"+i]=function(o){const a=vx(n);return new sI(this,a,J(o))},le.prototype["flip"+s]=le.prototype["flip"+r]=le.prototype["flip"+i]=function(){const o=vx(n);return new rI(this,o)}}const Gn=["x","y","z","w"],$n=["r","g","b","a"],zn=["s","t","p","q"];for(let n=0;n<4;n++){let e=Gn[n],t=$n[n],s=zn[n];Ml(e,t,s);for(let r=0;r<4;r++){e=Gn[n]+Gn[r],t=$n[n]+$n[r],s=zn[n]+zn[r],Ml(e,t,s);for(let i=0;i<4;i++){e=Gn[n]+Gn[r]+Gn[i],t=$n[n]+$n[r]+$n[i],s=zn[n]+zn[r]+zn[i],Ml(e,t,s);for(let o=0;o<4;o++)e=Gn[n]+Gn[r]+Gn[i]+Gn[o],t=$n[n]+$n[r]+$n[i]+$n[o],s=zn[n]+zn[r]+zn[i]+zn[o],Ml(e,t,s)}}}for(let n=0;n<32;n++)ma[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new sl(this,new as(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(J(e))}};Object.defineProperties(le.prototype,ma);const _x=new WeakMap,aI=function(n,e=null){const t=Jc(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?J(Lf(n,e)):t==="shader"?n.isFn?n:Y(n):n},lI=function(n,e=null){for(const t in n)n[t]=J(n[t],e);return n},cI=function(n,e=null){const t=n.length;for(let s=0;s<t;s++)n[s]=J(n[s],e);return n},Q1=function(n,e=null,t=null,s=null){function r(u){return s!==null?(u=J(Object.assign(u,s)),s.intent===!0&&(u=u.toVarIntent())):u=J(u),u}let i,o=e,a,l;function c(u){let d;return o?d=/[a-z]/i.test(o)?o+"()":o:d=n.type,a!==void 0&&u.length<a?(re(`TSL: "${d}" parameter length is less than minimum required.`),u.concat(new Array(a-u.length).fill(0))):l!==void 0&&u.length>l?(re(`TSL: "${d}" parameter length exceeds limit.`),u.slice(0,l)):u}return e===null?i=(...u)=>r(new n(...ji(c(u)))):t!==null?(t=J(t),i=(...u)=>r(new n(e,...ji(c(u)),t))):i=(...u)=>r(new n(e,...ji(c(u)))),i.setParameterLength=(...u)=>(u.length===1?a=l=u[0]:u.length===2&&([a,l]=u),i),i.setName=u=>(o=u,i),i},uI=function(n,...e){return J(new n(...ji(e)))};class dI extends le{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:s}=this,r=e.getNodeProperties(t),i=e.getClosestSubBuild(t.subBuilds)||"",o=i||"default";if(r[o])return r[o];const a=e.subBuildFn,l=e.fnCall;e.subBuildFn=i,e.fnCall=this;let c=null;if(t.layout){let u=_x.get(e.constructor);u===void 0&&(u=new WeakMap,_x.set(e.constructor,u));let d=u.get(t);d===void 0&&(d=J(e.buildFunctionNode(t)),u.set(t,d)),e.addInclude(d);const h=s?hI(s):null;c=J(d.call(h))}else{const u=new Proxy(e,{get:(x,y,g)=>{let b;return Symbol.iterator===y?b=function*(){yield void 0}:b=Reflect.get(x,y,g),b}}),d=s?fI(s):null,h=Array.isArray(s)?s.length>0:s!==null,p=t.jsFunc,m=h||p.length>1?p(d,u):p(u);c=J(m)}return e.subBuildFn=a,e.fnCall=l,t.once&&(r[o]=c),c}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),s=e.getSubBuildOutput(this);return t[s]=t[s]||this.setupOutput(e),t[s].subBuild=e.getClosestSubBuild(this),t[s]}build(e,t=null){let s=null;const r=e.getBuildStage(),i=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e),l=e.fnCall;if(e.fnCall=this,r==="setup"){const c=e.getSubBuildProperty("initialized",this);if(i[c]!==!0&&(i[c]=!0,i[o]=this.getOutputNode(e),i[o].build(e),this.shaderNode.subBuilds))for(const u of e.chaining){const d=e.getDataFromNode(u,"any");d.subBuilds=d.subBuilds||new Set;for(const h of this.shaderNode.subBuilds)d.subBuilds.add(h)}s=i[o]}else r==="analyze"?a.build(e,t):r==="generate"&&(s=a.build(e,t)||"");return e.fnCall=l,s}}function hI(n){let e;return vm(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function fI(n){let e=0;return vm(n),new Proxy(n,{get:(t,s,r)=>{let i;if(s==="length")return i=n.length,i;if(Symbol.iterator===s)i=function*(){for(const o of n)yield J(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[s]===void 0?i=o[e++]:i=Reflect.get(o,s,r)}else n[0]instanceof le&&(n[s]===void 0?i=n[e++]:i=Reflect.get(n,s,r));else i=Reflect.get(t,s,r);i=J(i)}return i}})}class pI extends le{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new dI(this,e)}setup(){return this.call()}}const mI=[!1,!0],gI=[0,1,2,3],xI=[-1,-2],Z1=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],xm=new Map;for(const n of mI)xm.set(n,new as(n));const ym=new Map;for(const n of gI)ym.set(n,new as(n,"uint"));const bm=new Map([...ym].map(n=>new as(n.value,"int")));for(const n of xI)bm.set(n,new as(n,"int"));const Ou=new Map([...bm].map(n=>new as(n.value)));for(const n of Z1)Ou.set(n,new as(n));for(const n of Z1)Ou.set(-n,new as(-n));const ju={bool:xm,uint:ym,ints:bm,float:Ou},Tx=new Map([...xm,...Ou]),Lf=(n,e)=>Tx.has(n)?Tx.get(n):n.isNode===!0?n:new as(n,e),gt=function(n,e=null){return(...t)=>{for(const r of t)if(r===void 0)return re(`TSL: Invalid parameter for the type "${n}".`),J(new as(0,n));if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(r=>{const i=typeof r;return i!=="object"&&i!=="function"}))&&(t=[mm(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Pl(e.get(t[0]));if(t.length===1){const r=Lf(t[0],n);return r.nodeType===n?Pl(r):Pl(new Y1(r,n))}const s=t.map(r=>Lf(r));return Pl(new eI(s,n))}},wx=n=>typeof n=="object"&&n!==null?n.value:n,yI=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function na(n,e){return new pI(n,e)}const J=(n,e=null)=>aI(n,e),Pl=(n,e=null)=>J(n,e).toVarIntent(),vm=(n,e=null)=>new lI(n,e),ji=(n,e=null)=>new cI(n,e),Ie=(n,e=null,t=null,s=null)=>new Q1(n,e,t,s),se=(n,...e)=>new uI(n,...e),oe=(n,e=null,t=null,s={})=>new Q1(n,e,t,{...s,intent:!0});let bI=0;class vI extends le{constructor(e,t=null){super();let s=null;t!==null&&(typeof t=="object"?s=t.return:(typeof t=="string"?s=t:re("TSL: Invalid layout type."),t=null)),this.shaderNode=new na(e,s),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const s={name:"fn"+bI++,type:t,inputs:[]};for(const r in e)r!=="return"&&s.inputs.push({name:r,type:e[r]});e=s}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return re('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function Y(n,e=null){const t=new vI(n,e);return new Proxy(()=>{},{apply(s,r,i){return t.call(...i)},get(s,r,i){return Reflect.get(t,r,i)},set(s,r,i,o){return Reflect.set(t,r,i,o)}})}const eu=n=>{ei=n},J1=()=>ei,Ke=(...n)=>ei.If(...n);function eT(n){return ei&&ei.addToStack(n),n}H("toStack",eT);const _I=new gt("color"),$=new gt("float",ju.float),ze=new gt("int",ju.ints),it=new gt("uint",ju.uint),_m=new gt("bool",ju.bool),ne=new gt("vec2"),ys=new gt("ivec2"),TI=new gt("uvec2"),wI=new gt("bvec2"),K=new gt("vec3"),NI=new gt("ivec3"),SI=new gt("uvec3"),EI=new gt("bvec3"),Te=new gt("vec4"),AI=new gt("ivec4"),CI=new gt("uvec4"),RI=new gt("bvec4"),Tm=new gt("mat2"),$t=new gt("mat3"),Ui=new gt("mat4");H("toColor",_I);H("toFloat",$);H("toInt",ze);H("toUint",it);H("toBool",_m);H("toVec2",ne);H("toIVec2",ys);H("toUVec2",TI);H("toBVec2",wI);H("toVec3",K);H("toIVec3",NI);H("toUVec3",SI);H("toBVec3",EI);H("toVec4",Te);H("toIVec4",AI);H("toUVec4",CI);H("toBVec4",RI);H("toMat2",Tm);H("toMat3",$t);H("toMat4",Ui);const MI=Ie(sl).setParameterLength(2),PI=(n,e)=>J(new Y1(J(n),e));H("element",MI);H("convert",PI);H("append",n=>(ie("TSL: .append() has been renamed to .toStack()."),eT(n)));class Oe extends le{static get type(){return"PropertyNode"}constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Fu(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const rr=(n,e)=>J(new Oe(n,e)),tu=(n,e)=>J(new Oe(n,e,!0)),Me=se(Oe,"vec4","DiffuseColor"),Nx=se(Oe,"vec3","EmissiveColor"),ws=se(Oe,"float","Roughness"),nu=se(Oe,"float","Metalness"),Ff=se(Oe,"float","Clearcoat"),su=se(Oe,"float","ClearcoatRoughness"),Ci=se(Oe,"vec3","Sheen"),wm=se(Oe,"float","SheenRoughness"),Nm=se(Oe,"float","Iridescence"),tT=se(Oe,"float","IridescenceIOR"),nT=se(Oe,"float","IridescenceThickness"),Of=se(Oe,"float","AlphaT"),Rr=se(Oe,"float","Anisotropy"),yc=se(Oe,"vec3","AnisotropyT"),Vi=se(Oe,"vec3","AnisotropyB"),An=se(Oe,"color","SpecularColor"),ru=se(Oe,"float","SpecularF90"),jf=se(Oe,"float","Shininess"),ga=se(Oe,"vec4","Output"),Ld=se(Oe,"float","dashSize"),Sx=se(Oe,"float","gapSize"),bc=se(Oe,"float","IOR"),Uf=se(Oe,"float","Transmission"),sT=se(Oe,"float","Thickness"),rT=se(Oe,"float","AttenuationDistance"),iT=se(Oe,"color","AttenuationColor"),oT=se(Oe,"float","Dispersion");class aT extends le{static get type(){return"UniformGroupNode"}constructor(e,t=!1,s=1){super("string"),this.name=e,this.shared=t,this.order=s,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const kI=n=>new aT(n),Sm=(n,e=0)=>new aT(n,!0,e),DI=Sm("frame"),pe=Sm("render"),lT=kI("object");class rl extends gm{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=lT}setName(e){return this.name=e,this}label(e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(s=>{const r=e(s,this);r!==void 0&&(this.value=r)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const s=this.getNodeType(e),r=this.getUniformHash(e);let i=e.getNodeFromHash(r);i===void 0&&(e.setHashNode(this,r),i=this);const o=i.getInputType(e),a=e.getUniformFromNode(i,o,e.shaderStage,this.name||e.context.nodeName),l=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let c=l;if(s==="bool"){const u=e.getDataFromNode(this);let d=u.propertyName;if(d===void 0){const h=e.getVarFromNode(this,null,"bool");d=e.getPropertyName(h),u.propertyName=d,c=e.format(l,o,s),e.addLineFlowCode(`${d} = ${c}`,this)}c=d}return e.format(c,s,t)}}const me=(n,e)=>{const t=yI(e||n);return t===n&&(n=mm(t)),n=n&&n.isNode===!0?n.node&&n.node.value||n.value:n,J(new rl(n,t))};class Ex extends _t{static get type(){return"ArrayNode"}constructor(e,t,s=null){super(e),this.count=t,this.values=s,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const II=(...n)=>{let e;if(n.length===1){const t=n[0];e=new Ex(null,t.length,t)}else{const t=n[0],s=n[1];e=new Ex(t,s)}return J(e)};H("toArray",(n,e)=>II(Array(e).fill(n)));class BI extends _t{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const s=e.getTypeLength(t.node.getNodeType(e));return mo.join("").slice(0,s)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:s}=this,r=t.getScope(),i=e.getNodeProperties(r);i.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=s,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:s,sourceNode:r}=e.getNodeProperties(this),i=this.needsSplitAssign(e),o=s.build(e),a=s.getNodeType(e),l=r.build(e,a),c=r.getNodeType(e),u=e.getDataFromNode(this);let d;if(u.initialized===!0)t!=="void"&&(d=o);else if(i){const h=e.getVarFromNode(this,null,a),p=e.getPropertyName(h);e.addLineFlowCode(`${p} = ${l}`,this);const m=s.node,y=m.node.context({assign:!0}).build(e);for(let g=0;g<m.components.length;g++){const b=m.components[g];e.addLineFlowCode(`${y}.${b} = ${p}[ ${g} ]`,this)}t!=="void"&&(d=o)}else d=`${o} = ${l}`,(t==="void"||c==="void")&&(e.addLineFlowCode(d,this),t!=="void"&&(d=o));return u.initialized=!0,e.format(d,a,t)}}const LI=Ie(BI).setParameterLength(2);H("assign",LI);class FI extends _t{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],s=this.functionNode,r=s.getInputs(e),i=this.parameters,o=(l,c)=>{const u=c.type,d=u==="pointer";let h;return d?h="&"+l.build(e):h=l.build(e,u),h};if(Array.isArray(i)){if(i.length>r.length)re("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=r.length;else if(i.length<r.length)for(re("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<r.length;)i.push($(0));for(let l=0;l<i.length;l++)t.push(o(i[l],r[l]))}else for(const l of r){const c=i[l.name];c!==void 0?t.push(o(c,l)):(re(`TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(o($(0),l)))}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const OI=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?ji(e):vm(e[0]),new FI(J(n),e));H("call",OI);const jI={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class tt extends _t{static get type(){return"OperatorNode"}constructor(e,t,s,...r){if(super(),r.length>0){let i=new tt(e,t,s);for(let o=0;o<r.length-1;o++)i=new tt(e,i,r[o]);t=i,s=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=s,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(jI[this.op],t)}getNodeType(e,t=null){const s=this.op,r=this.aNode,i=this.bNode,o=r.getNodeType(e),a=i?i.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(s==="%")return o;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(o);if(s==="!"||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="=="||s==="!="||s==="<"||s===">"||s==="<="||s===">="){const l=Math.max(e.getTypeLength(o),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const s=this.op,{aNode:r,bNode:i}=this,o=this.getNodeType(e,t);let a=null,l=null;o!=="void"?(a=r.getNodeType(e),l=i?i.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="||s==="!="?e.isVector(a)?l=a:e.isVector(l)?a=l:a!==l&&(a=l="float"):s===">>"||s==="<<"?(a=o,l=e.changeComponentType(l,"uint")):s==="%"?(a=o,l=e.isInteger(a)&&e.isInteger(l)?l:a):e.isMatrix(a)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(a):e.isMatrix(l)||(a=l=o):e.isMatrix(l)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(l):a=l=o:a=l=o):a=l=o;const c=r.build(e,a),u=i?i.build(e,l):null,d=e.getFunctionOperator(s);if(t!=="void"){const h=e.renderer.coordinateSystem===Dc;if(s==="=="||s==="!="||s==="<"||s===">"||s==="<="||s===">=")return h?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${c}, ${u} )`,o,t):e.format(`( ${c} ${s} ${u} )`,o,t):e.format(`( ${c} ${s} ${u} )`,o,t);if(s==="%")return e.isInteger(l)?e.format(`( ${c} % ${u} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${c}, ${u} )`,o,t);if(s==="!"||s==="~")return e.format(`(${s}${c})`,a,t);if(d)return e.format(`${d}( ${c}, ${u} )`,o,t);if(e.isMatrix(a)&&l==="float")return e.format(`( ${u} ${s} ${c} )`,o,t);if(a==="float"&&e.isMatrix(l))return e.format(`${c} ${s} ${u}`,o,t);{let p=`( ${c} ${s} ${u} )`;return!h&&o==="bool"&&e.isVector(a)&&e.isVector(l)&&(p=`all${p}`),e.format(p,o,t)}}else if(a!=="void")return d?e.format(`${d}( ${c}, ${u} )`,o,t):e.isMatrix(a)&&l==="float"?e.format(`${u} ${s} ${c}`,o,t):e.format(`${c} ${s} ${u}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Jt=oe(tt,"+").setParameterLength(2,1/0).setName("add"),jt=oe(tt,"-").setParameterLength(2,1/0).setName("sub"),Ne=oe(tt,"*").setParameterLength(2,1/0).setName("mul"),ss=oe(tt,"/").setParameterLength(2,1/0).setName("div"),Em=oe(tt,"%").setParameterLength(2).setName("mod"),cT=oe(tt,"==").setParameterLength(2).setName("equal"),UI=oe(tt,"!=").setParameterLength(2).setName("notEqual"),VI=oe(tt,"<").setParameterLength(2).setName("lessThan"),GI=oe(tt,">").setParameterLength(2).setName("greaterThan"),$I=oe(tt,"<=").setParameterLength(2).setName("lessThanEqual"),zI=oe(tt,">=").setParameterLength(2).setName("greaterThanEqual"),HI=oe(tt,"&&").setParameterLength(2,1/0).setName("and"),WI=oe(tt,"||").setParameterLength(2,1/0).setName("or"),qI=oe(tt,"!").setParameterLength(1).setName("not"),KI=oe(tt,"^^").setParameterLength(2).setName("xor"),XI=oe(tt,"&").setParameterLength(2).setName("bitAnd"),YI=oe(tt,"~").setParameterLength(1).setName("bitNot"),QI=oe(tt,"|").setParameterLength(2).setName("bitOr"),ZI=oe(tt,"^").setParameterLength(2).setName("bitXor"),JI=oe(tt,"<<").setParameterLength(2).setName("shiftLeft"),eB=oe(tt,">>").setParameterLength(2).setName("shiftRight"),tB=Y(([n])=>(n.addAssign(1),n)),nB=Y(([n])=>(n.subAssign(1),n)),sB=Y(([n])=>{const e=ze(n).toConst();return n.addAssign(1),e}),rB=Y(([n])=>{const e=ze(n).toConst();return n.subAssign(1),e});H("add",Jt);H("sub",jt);H("mul",Ne);H("div",ss);H("mod",Em);H("equal",cT);H("notEqual",UI);H("lessThan",VI);H("greaterThan",GI);H("lessThanEqual",$I);H("greaterThanEqual",zI);H("and",HI);H("or",WI);H("not",qI);H("xor",KI);H("bitAnd",XI);H("bitNot",YI);H("bitOr",QI);H("bitXor",ZI);H("shiftLeft",JI);H("shiftRight",eB);H("incrementBefore",tB);H("decrementBefore",nB);H("increment",sB);H("decrement",rB);const iB=(n,e)=>(ie('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Em(ze(n),ze(e)));H("modInt",iB);class U extends _t{static get type(){return"MathNode"}constructor(e,t,s=null,r=null){if(super(),(e===U.MAX||e===U.MIN)&&arguments.length>3){let i=new U(e,t,s);for(let o=2;o<arguments.length-1;o++)i=new U(e,i,arguments[o]);t=i,s=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=s,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(r)?0:e.getTypeLength(r);return i>o&&i>a?t:o>a?s:a>i?r:t}getNodeType(e){const t=this.method;return t===U.LENGTH||t===U.DISTANCE||t===U.DOT?"float":t===U.CROSS?"vec3":t===U.ALL||t===U.ANY?"bool":t===U.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:s,method:r}=this;let i=null;if(r===U.ONE_MINUS)i=jt(1,t);else if(r===U.RECIPROCAL)i=ss(1,t);else if(r===U.DIFFERENCE)i=rn(jt(t,s));else if(r===U.TRANSFORM_DIRECTION){let o=t,a=s;e.isMatrix(o.getNodeType(e))?a=Te(K(a),0):o=Te(K(o),0);const l=Ne(o,a).xyz;i=es(l)}return i!==null?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const i=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,l=this.bNode,c=this.cNode,u=e.renderer.coordinateSystem;if(r===U.NEGATE)return e.format("( - "+a.build(e,o)+" )",i,t);{const d=[];return r===U.CROSS?d.push(a.build(e,i),l.build(e,i)):u===Dc&&r===U.STEP?d.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),l.build(e,o)):u===Dc&&(r===U.MIN||r===U.MAX)?d.push(a.build(e,o),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o)):r===U.REFRACT?d.push(a.build(e,o),l.build(e,o),c.build(e,"float")):r===U.MIX?d.push(a.build(e,o),l.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(u===Eu&&r===U.ATAN&&l!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===U.DFDX||r===U.DFDY)&&(ie(`TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),d.push(a.build(e,o)),l!==null&&d.push(l.build(e,o)),c!==null&&d.push(c.build(e,o))),e.format(`${e.getMethod(r,i)}( ${d.join(", ")} )`,i,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}U.ALL="all";U.ANY="any";U.RADIANS="radians";U.DEGREES="degrees";U.EXP="exp";U.EXP2="exp2";U.LOG="log";U.LOG2="log2";U.SQRT="sqrt";U.INVERSE_SQRT="inversesqrt";U.FLOOR="floor";U.CEIL="ceil";U.NORMALIZE="normalize";U.FRACT="fract";U.SIN="sin";U.COS="cos";U.TAN="tan";U.ASIN="asin";U.ACOS="acos";U.ATAN="atan";U.ABS="abs";U.SIGN="sign";U.LENGTH="length";U.NEGATE="negate";U.ONE_MINUS="oneMinus";U.DFDX="dFdx";U.DFDY="dFdy";U.ROUND="round";U.RECIPROCAL="reciprocal";U.TRUNC="trunc";U.FWIDTH="fwidth";U.TRANSPOSE="transpose";U.DETERMINANT="determinant";U.INVERSE="inverse";U.EQUALS="equals";U.MIN="min";U.MAX="max";U.STEP="step";U.REFLECT="reflect";U.DISTANCE="distance";U.DIFFERENCE="difference";U.DOT="dot";U.CROSS="cross";U.POW="pow";U.TRANSFORM_DIRECTION="transformDirection";U.MIX="mix";U.CLAMP="clamp";U.REFRACT="refract";U.SMOOTHSTEP="smoothstep";U.FACEFORWARD="faceforward";const uT=$(1e-6),oB=$(Math.PI),aB=oe(U,U.ALL).setParameterLength(1),lB=oe(U,U.ANY).setParameterLength(1),cB=oe(U,U.RADIANS).setParameterLength(1),uB=oe(U,U.DEGREES).setParameterLength(1),dT=oe(U,U.EXP).setParameterLength(1),Ba=oe(U,U.EXP2).setParameterLength(1),hT=oe(U,U.LOG).setParameterLength(1),Rs=oe(U,U.LOG2).setParameterLength(1),Ur=oe(U,U.SQRT).setParameterLength(1),dB=oe(U,U.INVERSE_SQRT).setParameterLength(1),Kr=oe(U,U.FLOOR).setParameterLength(1),Am=oe(U,U.CEIL).setParameterLength(1),es=oe(U,U.NORMALIZE).setParameterLength(1),rs=oe(U,U.FRACT).setParameterLength(1),dn=oe(U,U.SIN).setParameterLength(1),bs=oe(U,U.COS).setParameterLength(1),hB=oe(U,U.TAN).setParameterLength(1),fB=oe(U,U.ASIN).setParameterLength(1),fT=oe(U,U.ACOS).setParameterLength(1),pT=oe(U,U.ATAN).setParameterLength(1,2),rn=oe(U,U.ABS).setParameterLength(1),iu=oe(U,U.SIGN).setParameterLength(1),Ms=oe(U,U.LENGTH).setParameterLength(1),pB=oe(U,U.NEGATE).setParameterLength(1),mB=oe(U,U.ONE_MINUS).setParameterLength(1),mT=oe(U,U.DFDX).setParameterLength(1),gT=oe(U,U.DFDY).setParameterLength(1),gB=oe(U,U.ROUND).setParameterLength(1),xB=oe(U,U.RECIPROCAL).setParameterLength(1),yB=oe(U,U.TRUNC).setParameterLength(1),xT=oe(U,U.FWIDTH).setParameterLength(1),bB=oe(U,U.TRANSPOSE).setParameterLength(1),vB=oe(U,U.DETERMINANT).setParameterLength(1),_B=oe(U,U.INVERSE).setParameterLength(1),TB=(n,e)=>(ie('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),cT(n,e)),Ji=oe(U,U.MIN).setParameterLength(2,1/0),vt=oe(U,U.MAX).setParameterLength(2,1/0),yT=oe(U,U.STEP).setParameterLength(2),wB=oe(U,U.REFLECT).setParameterLength(2),NB=oe(U,U.DISTANCE).setParameterLength(2),SB=oe(U,U.DIFFERENCE).setParameterLength(2),eo=oe(U,U.DOT).setParameterLength(2),La=oe(U,U.CROSS).setParameterLength(2),Uu=oe(U,U.POW).setParameterLength(2),bT=n=>Ne(n,n),EB=n=>Ne(n,n,n),vT=n=>Ne(n,n,n,n),AB=oe(U,U.TRANSFORM_DIRECTION).setParameterLength(2),CB=n=>Ne(iu(n),Uu(rn(n),1/3)),_T=n=>eo(n,n),We=oe(U,U.MIX).setParameterLength(3),Ds=(n,e=0,t=1)=>J(new U(U.CLAMP,J(n),J(e),J(t))),TT=n=>Ds(n),wT=oe(U,U.REFRACT).setParameterLength(3),Is=oe(U,U.SMOOTHSTEP).setParameterLength(3),RB=oe(U,U.FACEFORWARD).setParameterLength(3),MB=Y(([n])=>{const s=43758.5453,r=eo(n.xy,ne(12.9898,78.233)),i=Em(r,oB);return rs(dn(i).mul(s))}),PB=(n,e,t)=>We(e,t,n),kB=(n,e,t)=>Is(e,t,n),DB=(n,e)=>yT(e,n),IB=(n,e)=>(ie('TSL: "atan2" is overloaded. Use "atan" instead.'),pT(n,e));H("all",aB);H("any",lB);H("equals",TB);H("radians",cB);H("degrees",uB);H("exp",dT);H("exp2",Ba);H("log",hT);H("log2",Rs);H("sqrt",Ur);H("inverseSqrt",dB);H("floor",Kr);H("ceil",Am);H("normalize",es);H("fract",rs);H("sin",dn);H("cos",bs);H("tan",hB);H("asin",fB);H("acos",fT);H("atan",pT);H("abs",rn);H("sign",iu);H("length",Ms);H("lengthSq",_T);H("negate",pB);H("oneMinus",mB);H("dFdx",mT);H("dFdy",gT);H("round",gB);H("reciprocal",xB);H("trunc",yB);H("fwidth",xT);H("atan2",IB);H("min",Ji);H("max",vt);H("step",DB);H("reflect",wB);H("distance",NB);H("dot",eo);H("cross",La);H("pow",Uu);H("pow2",bT);H("pow3",EB);H("pow4",vT);H("transformDirection",AB);H("mix",PB);H("clamp",Ds);H("refract",wT);H("smoothstep",kB);H("faceForward",RB);H("difference",SB);H("saturate",TT);H("cbrt",CB);H("transpose",bB);H("determinant",vB);H("inverse",_B);H("rand",MB);class BB extends le{static get type(){return"ConditionalNode"}constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const{ifNode:t,elseNode:s}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(s!==null){const i=s.getNodeType(e);if(e.getTypeLength(i)>e.getTypeLength(r))return i}return r}setup(e){const t=this.condNode,s=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,i=e.context.nodeBlock;e.getDataFromNode(s).parentNodeBlock=i,r!==null&&(e.getDataFromNode(r).parentNodeBlock=i);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?s:s.context({nodeBlock:s}),a.elseNode=r?o?r:r.context({nodeBlock:r}):null}generate(e,t){const s=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:i,ifNode:o,elseNode:a}=e.getNodeProperties(this),l=e.currentFunctionNode,c=t!=="void",u=c?rr(s).build(e):"";r.nodeProperty=u;const d=i.build(e,"bool");if(e.context.uniformFlow&&a!==null){const m=o.build(e,s),x=a.build(e,s),y=e.getTernary(d,m,x);return e.format(y,s,t)}e.addFlowCode(`
${e.tab}if ( ${d} ) {

`).addFlowTab();let p=o.build(e,s);if(p&&(c?p=u+" = "+p+";":(p="return "+p+";",l===null&&(ie("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),p="// "+p))),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let m=a.build(e,s);m&&(c?m=u+" = "+m+";":(m="return "+m+";",l===null&&(ie("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),m="// "+m))),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,s,t)}}const Ct=Ie(BB).setParameterLength(2,3);H("select",Ct);class NT extends le{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const s=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(s),r}}const Vu=Ie(NT).setParameterLength(1,2),LB=n=>Vu(n,{uniformFlow:!0}),ST=(n,e)=>Vu(n,{nodeName:e});function FB(n,e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),ST(n,e)}H("context",Vu);H("label",FB);H("uniformFlow",LB);H("setName",ST);class vc extends le{static get type(){return"VarNode"}constructor(e,t=null,s=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=s,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){let s=e.getNodeProperties(this).assign;return s!==!0&&this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop&&(s=!0),s}build(...e){const t=e[0];return this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)&&t.getBaseStack().addToStack(this),this.intent===!0&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:s,readOnly:r}=this,{renderer:i}=e,o=i.backend.isWebGPUBackend===!0;let a=!1,l=!1;r&&(a=e.isDeterministic(t),l=o?r:a);const c=this.getNodeType(e);if(c=="void")return this.intent!==!0&&re('TSL: ".toVar()" can not be used with void type.'),t.build(e);const u=e.getVectorType(c),d=t.build(e,u),h=e.getVarFromNode(this,s,u,void 0,l),p=e.getPropertyName(h);let m=p;if(l)if(o)m=a?`const ${p}`:`let ${p}`;else{const x=t.getArrayCount(e);m=`const ${e.getVar(h.type,p,x)}`}return e.addLineFlowCode(`${m} = ${d}`,this),p}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const Cm=Ie(vc),OB=(n,e=null)=>Cm(n,e).toStack(),jB=(n,e=null)=>Cm(n,e,!0).toStack(),UB=n=>Cm(n).setIntent(!0).toStack();H("toVar",OB);H("toConst",jB);H("toVarIntent",UB);class VB extends le{static get type(){return"SubBuild"}constructor(e,t,s=null){super(s),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const s=this.node.build(e,...t);return e.removeSubBuild(),s}}const xa=(n,e,t=null)=>J(new VB(J(n),e,t));class GB extends le{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let s=t.varying;if(s===void 0){const r=this.name,i=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=s=e.getVaryingFromNode(this,r,i,o,a),t.node=xa(this.node,"VERTEX")}return s.needsInterpolation||(s.needsInterpolation=e.shaderStage==="fragment"),s}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Rl.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Rl.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),s=e.getNodeProperties(this),r=this.setupVarying(e);if(s[t]===void 0){const i=this.getNodeType(e),o=e.getPropertyName(r,Rl.VERTEX);e.flowNodeFromShaderStage(Rl.VERTEX,s.node,i,o),s[t]=o}return e.getPropertyName(r)}}const dr=Ie(GB).setParameterLength(1,2),$B=n=>dr(n);H("toVarying",dr);H("toVertexStage",$B);H("varying",(...n)=>(ie("TSL: .varying() has been renamed to .toVarying()."),dr(...n)));H("vertexStage",(...n)=>(ie("TSL: .vertexStage() has been renamed to .toVertexStage()."),dr(...n)));const zB=Y(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),s=n.lessThanEqual(.04045);return We(e,t,s)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),HB=Y(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),s=n.lessThanEqual(.0031308);return We(e,t,s)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Rm="WorkingColorSpace",WB="OutputColorSpace";class ET extends _t{static get type(){return"ColorSpaceNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this.source=t,this.target=s}resolveColorSpace(e,t){return t===Rm?pt.workingColorSpace:t===WB?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,s=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let i=t;return pt.enabled===!1||s===r||!s||!r||(pt.getTransfer(s)===_e&&(i=Te(zB(i.rgb),i.a)),pt.getPrimaries(s)!==pt.getPrimaries(r)&&(i=Te($t(pt._getMatrix(new Ja,s,r)).mul(i.rgb),i.a)),pt.getTransfer(r)===_e&&(i=Te(HB(i.rgb),i.a))),i}}const qB=(n,e)=>J(new ET(J(n),Rm,e)),Mm=(n,e)=>J(new ET(J(n),e,Rm));H("workingToColorSpace",qB);H("colorSpaceToWorking",Mm);let KB=class extends sl{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,s,r)}};class AT extends le{static get type(){return"ReferenceBaseNode"}constructor(e,t,s=null,r=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=r,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=we.OBJECT}setGroup(e){return this.group=e,this}element(e){return J(new KB(this,J(e)))}setNodeType(e){const t=me(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let r=1;r<t.length;r++)s=s[t[r]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const XB=(n,e,t)=>J(new AT(n,e,t));class YB extends AT{static get type(){return"RendererReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.renderer=s,this.setGroup(pe)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const QB=(n,e,t=null)=>J(new YB(n,e,t));class ZB extends _t{static get type(){return"ToneMappingNode"}constructor(e,t=eL,s=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=s}customCacheKey(){return pa(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,s=this._toneMapping;if(s===Or)return t;let r=null;const i=e.renderer.library.getToneMappingFunction(s);return i!==null?r=Te(i(t.rgb,this.exposureNode),t.a):(re("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}const JB=(n,e,t)=>J(new ZB(n,J(e),J(t))),eL=QB("toneMappingExposure","float");H("toneMapping",(n,e,t)=>JB(e,t,n));class tL extends gm{static get type(){return"BufferAttributeNode"}constructor(e,t=null,s=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=r,this.usage=yC,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,r=e.getTypeLength(t),i=this.bufferStride||r,o=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new bC(s,i),l=new vC(a,r,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(s);let i=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,i=r):i=dr(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const Pm=(n,e=null,t=0,s=0)=>J(new tL(n,e,t,s)),nL=(n,e=null,t=0,s=0)=>Pm(n,e,t,s).setUsage(Ei),Ax=(n,e=null,t=0,s=0)=>Pm(n,e,t,s).setInstanced(!0),Cx=(n,e=null,t=0,s=0)=>nL(n,e,t,s).setInstanced(!0);H("toAttribute",n=>Pm(n.value));class sL extends le{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=we.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const s=e.getNodeProperties(this);s.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:s}=e;if(s==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const i=e.getNodeProperties(this).outputComputeNode;if(i)return i.build(e,t)}}}const CT=(n,e=[64])=>{(e.length===0||e.length>3)&&re("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const s=e[t];(typeof s!="number"||s<=0||!Number.isInteger(s))&&re(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return J(new sL(J(n),e))},rL=(n,e,t)=>CT(n,t).setCount(e);H("compute",rL);H("computeKernel",CT);class iL extends le{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const s=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.build(e,...t);return e.setCache(s),i}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const ya=n=>new iL(J(n));function oL(n,e=!0){return ie('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),ya(n).setParent(e)}H("cache",oL);H("isolate",ya);class aL extends le{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const lL=Ie(aL).setParameterLength(2);H("bypass",lL);class RT extends le{static get type(){return"RemapNode"}constructor(e,t,s,r=$(0),i=$(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:r,outHighNode:i,doClamp:o}=this;let a=e.sub(t).div(s.sub(t));return o===!0&&(a=a.clamp()),a.mul(i.sub(r)).add(r)}}const cL=Ie(RT,null,null,{doClamp:!1}).setParameterLength(3,5),uL=Ie(RT).setParameterLength(3,5);H("remap",cL);H("remapClamp",uL);class _c extends le{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),r=this.snippet;if(s==="void")e.addLineFlowCode(r,this);else return e.format(r,s,t)}}const to=Ie(_c).setParameterLength(1,2),dL=n=>(n?Ct(n,to("discard")):to("discard")).toStack();H("discard",dL);class hL extends _t{static get type(){return"RenderOutputNode"}constructor(e,t,s){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=s,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const s=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Or,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Ki;return s!==Or&&(t=t.toneMapping(s)),r!==Ki&&r!==pt.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const fL=(n,e=null,t=null)=>J(new hL(J(n),e,t));H("renderOutput",fL);class pL extends _t{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,s=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(r.length);let o="";return o+="// #"+r+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+s+` /* ... */
`,o+="// #"+i+`#
`,t!==null?t(e,o):_C(o),s}}const mL=(n,e=null)=>J(new pL(J(n),e)).toStack();H("debug",mL);class MT{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class gL extends le{static get type(){return"InspectorNode"}constructor(e,t="",s=null){super(),this.node=e,this.name=t,this.callback=s,this.updateType=we.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==MT&&ft('TSL: ".toInspector()" is only available with WebGPU.'),t}}function xL(n,e="",t=null){return n=J(n),n.before(new gL(n,e,t))}H("toInspector",xL);class PT extends le{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const r=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(i),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,s):dr(this).build(e,s)}else return ie(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const lr=(n,e=null)=>J(new PT(n,e)),go=(n=0)=>lr("uv"+(n>0?n:""),"vec2");class yL extends le{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${r} )`,this.getNodeType(e),t)}}const Xr=Ie(yL).setParameterLength(1,2);class bL extends rl{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=we.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:r,height:i}=s;this.value=Math.log2(Math.max(r,i))}}}const vL=Ie(bL).setParameterLength(1),kT=new Xp;class xo extends rl{static get type(){return"TextureNode"}constructor(e=kT,t=null,s=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=we.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===mt?"uvec4":this.value.type===Ot?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return go(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=me(this.value.matrix)),this._matrixUniform.mul(K(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=me(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(ze(Xr(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const s=this.value;if(!s||s.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const r=Y(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?we.OBJECT:we.NONE,o})();let i=this.levelNode;i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,s,r,i,o,a,l,c){const u=this.value;let d;return i?d=e.generateTextureBias(u,t,s,i,o,c):l?d=e.generateTextureGrad(u,t,s,l,o,c):a?d=e.generateTextureCompare(u,t,s,a,o,c):this.sampler===!1?d=e.generateTextureLoad(u,t,s,r,o,c):r?d=e.generateTextureLevel(u,t,s,r,o,c):d=e.generateTexture(u,t,s,o,c),d}generate(e,t){const s=this.value,r=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:u,levelNode:d,biasNode:h,compareNode:p,depthNode:m,gradNode:x,offsetNode:y}=r,g=this.generateUV(e,u),b=d?d.build(e,"float"):null,v=h?h.build(e,"float"):null,_=m?m.build(e,"int"):null,w=p?p.build(e,"float"):null,T=x?[x[0].build(e,"vec2"),x[1].build(e,"vec2")]:null,E=y?this.generateOffset(e,y):null,S=e.getVarFromNode(this);a=e.getPropertyName(S);const C=this.generateSnippet(e,i,g,b,v,_,w,T,E);e.addLineFlowCode(`${a} = ${C}`,this),o.snippet=C,o.propertyName=a}let l=a;const c=this.getNodeType(e);return e.needsToWorkingColorSpace(s)&&(l=Mm(to(l,c),s.colorSpace).setup(e).build(e,c)),e.format(l,c,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return ie("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=J(e),t.referenceNode=this.getBase(),J(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=J(e).mul(vL(t)),t.referenceNode=this.getBase();const s=t.value;return t.generateMipmaps===!1&&(s&&s.generateMipmaps===!1||s.minFilter===Rn||s.magFilter===Rn)&&(ie("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),J(t)}level(e){const t=this.clone();return t.levelNode=J(e),t.referenceNode=this.getBase(),J(t)}size(e){return Xr(this,e)}bias(e){const t=this.clone();return t.biasNode=J(e),t.referenceNode=this.getBase(),J(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=J(e),t.referenceNode=this.getBase(),J(t)}grad(e,t){const s=this.clone();return s.gradNode=[J(e),J(t)],s.referenceNode=this.getBase(),J(s)}depth(e){const t=this.clone();return t.depthNode=J(e),t.referenceNode=this.getBase(),J(t)}offset(e){const t=this.clone();return t.offsetNode=J(e),t.referenceNode=this.getBase(),J(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const s=this._flipYUniform;s!==null&&(s.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const _L=Ie(xo).setParameterLength(1,4).setName("texture"),Re=(n=kT,e=null,t=null,s=null)=>{let r;return n&&n.isTextureNode===!0?(r=J(n.clone()),r.referenceNode=n.getBase(),e!==null&&(r.uvNode=J(e)),t!==null&&(r.levelNode=J(t)),s!==null&&(r.biasNode=J(s))):r=_L(n,e,t,s),r},un=(...n)=>Re(...n).setSampler(!1);class DT extends rl{static get type(){return"BufferNode"}constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const IT=(n,e,t)=>J(new DT(n,e,t));class TL extends sl{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),s=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,s)}}class wL extends DT{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Jc(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=we.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,s=this.elementType;if(s==="float"||s==="int"||s==="uint")for(let r=0;r<e.length;r++){const i=r*4;t[i]=e[r]}else if(s==="color")for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.r,t[i+1]=o.g,t[i+2]=o.b||0}else if(s==="mat2")for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+3]=o.elements[3]}else if(s==="mat3")for(let r=0;r<e.length;r++){const i=r*16,o=e[r];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+4]=o.elements[3],t[i+5]=o.elements[4],t[i+6]=o.elements[5],t[i+8]=o.elements[6],t[i+9]=o.elements[7],t[i+10]=o.elements[8],t[i+15]=1}else if(s==="mat4")for(let r=0;r<e.length;r++){const i=r*16,o=e[r];for(let a=0;a<o.elements.length;a++)t[i+a]=o.elements[a]}else for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.x,t[i+1]=o.y,t[i+2]=o.z||0,t[i+3]=o.w||0}}setup(e){const t=this.array.length,s=this.elementType;let r=Float32Array;const i=this.paddedType,o=e.getTypeLength(i);return s.charAt(0)==="i"&&(r=Int32Array),s.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return J(new TL(this,J(e)))}}const Pn=(n,e)=>J(new wL(n,e));class NL extends le{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const il=Ie(NL).setParameterLength(1);let Io,Bo;class Ge extends le{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Ge.DPR?"float":this.scope===Ge.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=we.NONE;return(this.scope===Ge.SIZE||this.scope===Ge.VIEWPORT||this.scope===Ge.DPR)&&(e=we.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Ge.VIEWPORT?t!==null?Bo.copy(t.viewport):(e.getViewport(Bo),Bo.multiplyScalar(e.getPixelRatio())):this.scope===Ge.DPR?this._output.value=e.getPixelRatio():t!==null?(Io.width=t.width,Io.height=t.height):e.getDrawingBufferSize(Io)}setup(){const e=this.scope;let t=null;return e===Ge.SIZE?t=me(Io||(Io=new Se)):e===Ge.VIEWPORT?t=me(Bo||(Bo=new et)):e===Ge.DPR?t=me(1):t=ne(Gu.div(Vf)),this._output=t,t}generate(e){if(this.scope===Ge.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(Vf).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}Ge.COORDINATE="coordinate";Ge.VIEWPORT="viewport";Ge.SIZE="size";Ge.UV="uv";Ge.DPR="dpr";const SL=se(Ge,Ge.DPR),Gi=se(Ge,Ge.UV),Vf=se(Ge,Ge.SIZE),Gu=se(Ge,Ge.COORDINATE),BT=se(Ge,Ge.VIEWPORT),EL=BT.zw;BT.xy;const km=me(0,"uint").setName("u_cameraIndex").setGroup(Sm("cameraIndex")).toVarying("v_cameraIndex"),Dr=me("float").setName("cameraNear").setGroup(pe).onRenderUpdate(({camera:n})=>n.near),Ir=me("float").setName("cameraFar").setGroup(pe).onRenderUpdate(({camera:n})=>n.far),LT=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.projectionMatrix);e=Pn(t).setGroup(pe).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?il("gl_ViewID_OVR"):km).toConst("cameraProjectionMatrix")}else e=me("mat4").setName("cameraProjectionMatrix").setGroup(pe).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),js=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const r of n.cameras)t.push(r.matrixWorldInverse);e=Pn(t).setGroup(pe).setName("cameraViewMatrices").element(n.isMultiViewCamera?il("gl_ViewID_OVR"):km).toConst("cameraViewMatrix")}else e=me("mat4").setName("cameraViewMatrix").setGroup(pe).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),AL=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let r=0,i=n.cameras.length;r<i;r++)t.push(new ue);e=Pn(t).setGroup(pe).setName("cameraPositions").onRenderUpdate(({camera:r},i)=>{const o=r.cameras,a=i.array;for(let l=0,c=o.length;l<c;l++)a[l].setFromMatrixPosition(o[l].matrixWorld)}).element(n.isMultiViewCamera?il("gl_ViewID_OVR"):km).toConst("cameraPosition")}else e=me(new ue).setName("cameraPosition").setGroup(pe).onRenderUpdate(({camera:t},s)=>s.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),Rx=new hC;class je extends le{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=we.OBJECT,this.uniformNode=new rl(null)}getNodeType(){const e=this.scope;if(e===je.WORLD_MATRIX)return"mat4";if(e===je.POSITION||e===je.VIEW_POSITION||e===je.DIRECTION||e===je.SCALE)return"vec3";if(e===je.RADIUS)return"float"}update(e){const t=this.object3d,s=this.uniformNode,r=this.scope;if(r===je.WORLD_MATRIX)s.value=t.matrixWorld;else if(r===je.POSITION)s.value=s.value||new ue,s.value.setFromMatrixPosition(t.matrixWorld);else if(r===je.SCALE)s.value=s.value||new ue,s.value.setFromMatrixScale(t.matrixWorld);else if(r===je.DIRECTION)s.value=s.value||new ue,t.getWorldDirection(s.value);else if(r===je.VIEW_POSITION){const i=e.camera;s.value=s.value||new ue,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}else if(r===je.RADIUS){const i=e.object.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Rx.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),s.value=Rx.radius}}generate(e){const t=this.scope;return t===je.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===je.POSITION||t===je.VIEW_POSITION||t===je.DIRECTION||t===je.SCALE?this.uniformNode.nodeType="vec3":t===je.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}je.WORLD_MATRIX="worldMatrix";je.POSITION="position";je.SCALE="scale";je.VIEW_POSITION="viewPosition";je.DIRECTION="direction";je.RADIUS="radius";const CL=Ie(je,je.POSITION).setParameterLength(1);class vn extends je{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}vn.DIRECTION;const ti=se(vn,vn.WORLD_MATRIX);vn.POSITION;vn.SCALE;vn.VIEW_POSITION;vn.RADIUS;const RL=me(new Ja).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),$u=Y(n=>n.renderer.overrideNodes.modelViewMatrix||ML).once()().toVar("modelViewMatrix"),ML=js.mul(ti),Mx=Y(n=>(n.context.isHighPrecisionModelViewMatrix=!0,me("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),Px=Y(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return me("mat3").onObjectUpdate(({object:t,camera:s})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),zu=lr("position","vec3"),Dt=zu.toVarying("positionLocal"),kx=zu.toVarying("positionPrevious"),no=Y(n=>ti.mul(Dt).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),FT=Y(()=>Dt.transformDirection(ti).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ct=Y(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Qe=Y(n=>{let e;return n.camera.isOrthographicCamera?e=K(0,0,1):e=ct.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class PL extends le{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Qt?"false":e.getFrontFacing()}}const kL=se(PL),OT=$(kL).mul(2).sub(1),ol=Y(([n],{material:e})=>{const t=e.side;return t===Qt?n=n.mul(-1):t===zr&&(n=n.mul(OT)),n}),jT=lr("normal","vec3"),is=Y(n=>n.geometry.hasAttribute("normal")===!1?(ie('TSL: Vertex attribute "normal" not found on geometry.'),K(0,1,0)):jT,"vec3").once()().toVar("normalLocal"),DL=ct.dFdx().cross(ct.dFdy()).normalize().toVar("normalFlat"),Fa=Y(n=>{let e;return n.material.flatShading===!0?e=DL:e=UT(is).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),IL=Y(n=>{let e=Fa.transformDirection(js);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Fe=Y(({subBuildFn:n,material:e,context:t})=>{let s;return n==="NORMAL"||n==="VERTEX"?(s=Fa,e.flatShading!==!0&&(s=ol(s))):s=t.setupNormal().context({getUV:null}),s},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),yo=Fe.transformDirection(js).toVar("normalWorld"),Ri=Y(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=Fe:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),BL=Y(([n,e=ti])=>{const t=$t(e),s=n.div(K(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(s).xyz}),UT=Y(([n],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const s=RL.mul(n);return js.transformDirection(s)});Y(()=>(ie('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Fe)).once(["NORMAL","VERTEX"])();Y(()=>(ie('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),yo)).once(["NORMAL","VERTEX"])();Y(()=>(ie('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Ri)).once(["NORMAL","VERTEX"])();const Dx=new H_,Fd=new On,LL=me(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),Od=me(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),VT=me(new On).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(Dx.copy(t),Fd.makeRotationFromEuler(Dx)):Fd.identity(),Fd}),FL=Qe.negate().reflect(Fe),OL=Qe.negate().refract(Fe,LL),jL=FL.transformDirection(js).toVar("reflectVector"),UL=OL.transformDirection(js).toVar("reflectVector"),VL=new Kp;class GL extends xo{static get type(){return"CubeTextureNode"}constructor(e,t=null,s=null,r=null){super(e,t,s,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===jc?jL:e.mapping===Uc?UL:(re('CubeTextureNode: Mapping "%s" not supported.',e.mapping),K(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return(e.renderer.coordinateSystem===Eu||!s.isRenderTargetTexture)&&(t=K(t.x.negate(),t.yz)),VT.mul(t)}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const $L=Ie(GL).setParameterLength(1,4).setName("cubeTexture"),Oa=(n=VL,e=null,t=null,s=null)=>{let r;return n&&n.isCubeTextureNode===!0?(r=J(n.clone()),r.referenceNode=n,e!==null&&(r.uvNode=J(e)),t!==null&&(r.levelNode=J(t)),s!==null&&(r.biasNode=J(s))):r=$L(n,e,t,s),r};class zL extends sl{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,s,r)}}class Dm extends le{static get type(){return"ReferenceNode"}constructor(e,t,s=null,r=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=r,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=we.OBJECT}element(e){return J(new zL(this,J(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=IT(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Pn(null,e):e==="texture"?t=Re(null):e==="cubeTexture"?t=Oa(null):t=me(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let r=1;r<t.length;r++)s=s[t[r]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Ue=(n,e,t)=>J(new Dm(n,e,t)),Ix=(n,e,t,s)=>J(new Dm(n,e,s,t));class HL extends Dm{static get type(){return"MaterialReferenceNode"}constructor(e,t,s=null){super(e,t,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Xs=(n,e,t=null)=>J(new HL(n,e,t)),GT=go(),WL=ct.dFdx(),qL=ct.dFdy(),$T=GT.dFdx(),zT=GT.dFdy(),HT=Fe,WT=qL.cross(HT),qT=HT.cross(WL),Gf=WT.mul($T.x).add(qT.mul(zT.x)),$f=WT.mul($T.y).add(qT.mul(zT.y)),Bx=Gf.dot(Gf).max($f.dot($f)),KT=Bx.equal(0).select(0,Bx.inverseSqrt()),KL=Gf.mul(KT).toVar("tangentViewFrame"),XL=$f.mul(KT).toVar("bitangentViewFrame"),XT=Y(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),lr("tangent","vec4")))(),Im=XT.xyz.toVar("tangentLocal"),YT=Y(({subBuildFn:n,geometry:e,material:t})=>{let s;return n==="VERTEX"||e.hasAttribute("tangent")?s=$u.mul(Te(Im,0)).xyz.toVarying("v_tangentView").normalize():s=KL,t.flatShading!==!0&&(s=ol(s)),s},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),YL=Y(([n,e],{subBuildFn:t,material:s})=>{let r=n.mul(XT.w).xyz;return t==="NORMAL"&&s.flatShading!==!0&&(r=r.toVarying(e)),r}).once(["NORMAL"]),QL=Y(({subBuildFn:n,geometry:e,material:t})=>{let s;return n==="VERTEX"||e.hasAttribute("tangent")?s=YL(Fe.cross(YT),"v_bitangentView").normalize():s=XL,t.flatShading!==!0&&(s=ol(s)),s},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),sa=$t(YT,QL,Fe).toVar("TBNViewMatrix"),ZL=Y(()=>{let n=Vi.cross(Qe);return n=n.cross(Vi).normalize(),n=We(n,Fe,Rr.mul(ws.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()();class JL extends _t{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=r0}setup({material:e}){const{normalMapType:t,scaleNode:s}=this;let r=this.node.mul(2).sub(1);if(s!==null){let o=s;e.flatShading===!0&&(o=ol(o)),r=K(r.xy.mul(o),r.z)}let i=null;return t===fC?i=UT(r):t===r0?i=sa.mul(r).normalize():(re(`NodeMaterial: Unsupported normal map type: ${t}`),i=Fe),i}}const Lx=Ie(JL).setParameterLength(1,2),eF=Y(({textureNode:n,bumpScale:e})=>{const t=r=>n.isolate().context({getUV:i=>r(i.uvNode||go()),forceUVContext:!0}),s=$(t(r=>r));return ne($(t(r=>r.add(r.dFdx()))).sub(s),$(t(r=>r.add(r.dFdy()))).sub(s)).mul(e)}),tF=Y(n=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=n,r=e.dFdx().normalize(),i=e.dFdy().normalize(),o=t,a=i.cross(o),l=o.cross(r),c=r.dot(a).mul(OT),u=c.sign().mul(s.x.mul(a).add(s.y.mul(l)));return c.abs().mul(t).sub(u).normalize()});class nF extends _t{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=eF({textureNode:this.textureNode,bumpScale:e});return tF({surf_pos:ct,surf_norm:Fe,dHdxy:t})}}const sF=Ie(nF).setParameterLength(1,2),Fx=new Map;class q extends le{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let s=Fx.get(e);return s===void 0&&(s=Xs(e,t),Fx.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let r=null;if(s===q.COLOR){const i=t.color!==void 0?this.getColor(s):K();t.map&&t.map.isTexture===!0?r=i.mul(this.getTexture("map")):r=i}else if(s===q.OPACITY){const i=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?r=i.mul(this.getTexture("alpha")):r=i}else if(s===q.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=$(1);else if(s===q.SPECULAR_INTENSITY){const i=this.getFloat(s);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=i.mul(this.getTexture(s).a):r=i}else if(s===q.SPECULAR_COLOR){const i=this.getColor(s);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=i.mul(this.getTexture(s).rgb):r=i}else if(s===q.ROUGHNESS){const i=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=i.mul(this.getTexture(s).g):r=i}else if(s===q.METALNESS){const i=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=i.mul(this.getTexture(s).b):r=i}else if(s===q.EMISSIVE){const i=this.getFloat("emissiveIntensity"),o=this.getColor(s).mul(i);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(s)):r=o}else if(s===q.NORMAL)t.normalMap?(r=Lx(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=sF(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Fe;else if(s===q.CLEARCOAT){const i=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=i.mul(this.getTexture(s).r):r=i}else if(s===q.CLEARCOAT_ROUGHNESS){const i=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(s).r):r=i}else if(s===q.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=Lx(this.getTexture(s),this.getCache(s+"Scale","vec2")):r=Fe;else if(s===q.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=i.mul(this.getTexture("sheenColor").rgb):r=i}else if(s===q.SHEEN_ROUGHNESS){const i=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(s).a):r=i,r=r.clamp(.07,1)}else if(s===q.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const i=this.getTexture(s);r=Tm(Lo.x,Lo.y,Lo.y.negate(),Lo.x).mul(i.rg.mul(2).sub(ne(1)).normalize().mul(i.b))}else r=Lo;else if(s===q.IRIDESCENCE_THICKNESS){const i=Ue("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Ue("0","float",t.iridescenceThicknessRange);r=i.sub(o).mul(this.getTexture(s).g).add(o)}else r=i}else if(s===q.TRANSMISSION){const i=this.getFloat(s);t.transmissionMap?r=i.mul(this.getTexture(s).r):r=i}else if(s===q.THICKNESS){const i=this.getFloat(s);t.thicknessMap?r=i.mul(this.getTexture(s).g):r=i}else if(s===q.IOR)r=this.getFloat(s);else if(s===q.LIGHT_MAP)r=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===q.AO)r=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(s===q.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(s):$(0);else{const i=this.getNodeType(e);r=this.getCache(s,i)}return r}}q.ALPHA_TEST="alphaTest";q.COLOR="color";q.OPACITY="opacity";q.SHININESS="shininess";q.SPECULAR="specular";q.SPECULAR_STRENGTH="specularStrength";q.SPECULAR_INTENSITY="specularIntensity";q.SPECULAR_COLOR="specularColor";q.REFLECTIVITY="reflectivity";q.ROUGHNESS="roughness";q.METALNESS="metalness";q.NORMAL="normal";q.CLEARCOAT="clearcoat";q.CLEARCOAT_ROUGHNESS="clearcoatRoughness";q.CLEARCOAT_NORMAL="clearcoatNormal";q.EMISSIVE="emissive";q.ROTATION="rotation";q.SHEEN="sheen";q.SHEEN_ROUGHNESS="sheenRoughness";q.ANISOTROPY="anisotropy";q.IRIDESCENCE="iridescence";q.IRIDESCENCE_IOR="iridescenceIOR";q.IRIDESCENCE_THICKNESS="iridescenceThickness";q.IOR="ior";q.TRANSMISSION="transmission";q.THICKNESS="thickness";q.ATTENUATION_DISTANCE="attenuationDistance";q.ATTENUATION_COLOR="attenuationColor";q.LINE_SCALE="scale";q.LINE_DASH_SIZE="dashSize";q.LINE_GAP_SIZE="gapSize";q.LINE_WIDTH="linewidth";q.LINE_DASH_OFFSET="dashOffset";q.POINT_SIZE="size";q.DISPERSION="dispersion";q.LIGHT_MAP="light";q.AO="ao";const rF=se(q,q.ALPHA_TEST),iF=se(q,q.COLOR),oF=se(q,q.SHININESS),aF=se(q,q.EMISSIVE),QT=se(q,q.OPACITY),lF=se(q,q.SPECULAR),Ox=se(q,q.SPECULAR_INTENSITY),cF=se(q,q.SPECULAR_COLOR),Tc=se(q,q.SPECULAR_STRENGTH),jd=se(q,q.REFLECTIVITY),uF=se(q,q.ROUGHNESS),dF=se(q,q.METALNESS),hF=se(q,q.NORMAL),fF=se(q,q.CLEARCOAT),pF=se(q,q.CLEARCOAT_ROUGHNESS),mF=se(q,q.CLEARCOAT_NORMAL),gF=se(q,q.ROTATION),xF=se(q,q.SHEEN),yF=se(q,q.SHEEN_ROUGHNESS),bF=se(q,q.ANISOTROPY),vF=se(q,q.IRIDESCENCE),_F=se(q,q.IRIDESCENCE_IOR),TF=se(q,q.IRIDESCENCE_THICKNESS),wF=se(q,q.TRANSMISSION),NF=se(q,q.THICKNESS),SF=se(q,q.IOR),EF=se(q,q.ATTENUATION_DISTANCE),AF=se(q,q.ATTENUATION_COLOR),CF=se(q,q.LINE_SCALE),RF=se(q,q.LINE_DASH_SIZE),MF=se(q,q.LINE_GAP_SIZE);q.LINE_WIDTH;const PF=se(q,q.LINE_DASH_OFFSET),kF=se(q,q.POINT_SIZE),DF=se(q,q.DISPERSION),ZT=se(q,q.LIGHT_MAP),IF=se(q,q.AO),Lo=me(new Se).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),JT=Y(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class qe extends le{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let r;if(s===qe.VERTEX)r=e.getVertexIndex();else if(s===qe.INSTANCE)r=e.getInstanceIndex();else if(s===qe.DRAW)r=e.getDrawIndex();else if(s===qe.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(s===qe.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(s===qe.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=r:i=dr(this).build(e,t),i}}qe.VERTEX="vertex";qe.INSTANCE="instance";qe.SUBGROUP="subgroup";qe.INVOCATION_LOCAL="invocationLocal";qe.INVOCATION_SUBGROUP="invocationSubgroup";qe.DRAW="draw";const BF=se(qe,qe.VERTEX),Bm=se(qe,qe.INSTANCE);qe.SUBGROUP;qe.INVOCATION_SUBGROUP;qe.INVOCATION_LOCAL;const LF=se(qe,qe.DRAW);class FF extends le{static get type(){return"InstanceNode"}constructor(e,t,s=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=s,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=we.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{instanceMatrix:t,instanceColor:s}=this,{count:r}=t;let{instanceMatrixNode:i,instanceColorNode:o}=this;if(i===null){if(r<=1e3)i=IT(t.array,"mat4",Math.max(r,1)).element(Bm);else{const l=new pC(t.array,16,1);this.buffer=l;const c=t.usage===Ei?Cx:Ax,u=[c(l,"vec4",16,0),c(l,"vec4",16,4),c(l,"vec4",16,8),c(l,"vec4",16,12)];i=Ui(...u)}this.instanceMatrixNode=i}if(s&&o===null){const l=new mC(s.array,3),c=s.usage===Ei?Cx:Ax;this.bufferColor=l,o=K(c(l,"vec3",3,0)),this.instanceColorNode=o}const a=i.mul(Dt).xyz;if(Dt.assign(a),e.hasGeometryAttribute("normal")){const l=BL(is,i);is.assign(l)}this.instanceColorNode!==null&&tu("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Ei&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Ei&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}class OF extends FF{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:s,instanceColor:r}=e;super(t,s,r),this.instancedMesh=e}}const jF=Ie(OF).setParameterLength(1);class UF extends le{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Bm:this.batchingIdNode=LF);const s=Y(([m])=>{const x=ze(Xr(un(this.batchMesh._indirectTexture),0).x),y=ze(m).mod(x),g=ze(m).div(x);return un(this.batchMesh._indirectTexture,ys(y,g)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(ze(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=ze(Xr(un(r),0).x),o=$(s).mul(4).toInt().toVar(),a=o.mod(i),l=o.div(i),c=Ui(un(r,ys(a,l)),un(r,ys(a.add(1),l)),un(r,ys(a.add(2),l)),un(r,ys(a.add(3),l))),u=this.batchMesh._colorsTexture;if(u!==null){const x=Y(([y])=>{const g=ze(Xr(un(u),0).x),b=y,v=b.mod(g),_=b.div(g);return un(u,ys(v,_)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(s);tu("vec3","vBatchColor").assign(x)}const d=$t(c);Dt.assign(c.mul(Dt));const h=is.div(K(d[0].dot(d[0]),d[1].dot(d[1]),d[2].dot(d[2]))),p=d.mul(h).xyz;is.assign(p),e.hasGeometryAttribute("tangent")&&Im.mulAssign(d)}}const VF=Ie(UF).setParameterLength(1),jx=new WeakMap;class GF extends le{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=we.OBJECT,this.skinIndexNode=lr("skinIndex","uvec4"),this.skinWeightNode=lr("skinWeight","vec4"),this.bindMatrixNode=Ue("bindMatrix","mat4"),this.bindMatrixInverseNode=Ue("bindMatrixInverse","mat4"),this.boneMatricesNode=Ix("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Dt,this.toPositionNode=Dt,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:s,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:o}=this,a=e.element(s.x),l=e.element(s.y),c=e.element(s.z),u=e.element(s.w),d=i.mul(t),h=Jt(a.mul(r.x).mul(d),l.mul(r.y).mul(d),c.mul(r.z).mul(d),u.mul(r.w).mul(d));return o.mul(h).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=is){const{skinIndexNode:s,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:o}=this,a=e.element(s.x),l=e.element(s.y),c=e.element(s.z),u=e.element(s.w);let d=Jt(r.x.mul(a),r.y.mul(l),r.z.mul(c),r.w.mul(u));return d=o.mul(d).mul(i),d.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=Ix("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,kx)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||X1(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&kx.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const s=this.getSkinnedNormal();is.assign(s),e.hasGeometryAttribute("tangent")&&Im.assign(s)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;jx.get(t)!==e.frameId&&(jx.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const $F=n=>J(new GF(n));class zF extends le{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let a=0,l=this.params.length-1;a<l;a++){const c=this.params[a],u=c.isNode!==!0&&c.name||this.getVarName(a),d=c.isNode!==!0&&c.type||"int";s[u]=to(u,d)}const r=e.addStack(),i=this.params[this.params.length-1](s);t.returnsNode=i.context({nodeLoop:i}),t.stackNode=r;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const a=Y(this.params[0].update)(s);t.updateNode=a.context({nodeLoop:a})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),s=this.params,r=t.stackNode;for(let o=0,a=s.length-1;o<a;o++){const l=s[o];let c=!1,u=null,d=null,h=null,p=null,m=null,x=null;l.isNode?l.getNodeType(e)==="bool"?(c=!0,p="bool",d=l.build(e,p)):(p="int",h=this.getVarName(o),u="0",d=l.build(e,p),m="<"):(p=l.type||"int",h=l.name||this.getVarName(o),u=l.start,d=l.end,m=l.condition,x=l.update,typeof u=="number"?u=e.generateConst(p,u):u&&u.isNode&&(u=u.build(e,p)),typeof d=="number"?d=e.generateConst(p,d):d&&d.isNode&&(d=d.build(e,p)),u!==void 0&&d===void 0?(u=u+" - 1",d="0",m=">="):d!==void 0&&u===void 0&&(u="0",m="<"),m===void 0&&(Number(u)>Number(d)?m=">=":m="<"));let y;if(c)y=`while ( ${d} )`;else{const g={start:u,end:d},b=g.start,v=g.end;let _;const w=()=>m.includes("<")?"+=":"-=";if(x!=null)switch(typeof x){case"function":_=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":_=h+" "+w()+" "+e.generateConst(p,x);break;case"string":_=h+" "+x;break;default:x.isNode?_=h+" "+w()+" "+x.build(e):(re("TSL: 'Loop( { update: ... } )' is not a function, string or number."),_="break /* invalid update */")}else p==="int"||p==="uint"?x=m.includes("<")?"++":"--":x=w()+" 1.",_=h+" "+x;const T=e.getVar(p,h)+" = "+b,E=h+" "+m+" "+v;y=`for ( ${T}; ${E}; ${_} )`}e.addFlowCode((o===0?`
`:"")+e.tab+y+` {

`).addFlowTab()}const i=r.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+i);for(let o=0,a=this.params.length-1;o<a;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const fn=(...n)=>new zF(ji(n,"int")).toStack(),HF=()=>to("break").toStack(),Ud=new WeakMap,nn=new et,Ux=Y(({bufferMap:n,influence:e,stride:t,width:s,depth:r,offset:i})=>{const o=ze(BF).mul(t).add(i),a=o.div(s),l=o.sub(a.mul(s));return un(n,ys(l,a)).depth(r).xyz.mul(e)});function WF(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,s=n.morphAttributes.color!==void 0,r=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,i=r!==void 0?r.length:0;let o=Ud.get(n);if(o===void 0||o.count!==i){let g=function(){x.dispose(),Ud.delete(n),n.removeEventListener("dispose",g)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],c=n.morphAttributes.color||[];let u=0;e===!0&&(u=1),t===!0&&(u=2),s===!0&&(u=3);let d=n.attributes.position.count*u,h=1;const p=4096;d>p&&(h=Math.ceil(d/p),d=p);const m=new Float32Array(d*h*4*i),x=new gC(m,d,h,i);x.type=hn,x.needsUpdate=!0;const y=u*4;for(let b=0;b<i;b++){const v=a[b],_=l[b],w=c[b],T=d*h*4*b;for(let E=0;E<v.count;E++){const S=E*y;e===!0&&(nn.fromBufferAttribute(v,E),m[T+S+0]=nn.x,m[T+S+1]=nn.y,m[T+S+2]=nn.z,m[T+S+3]=0),t===!0&&(nn.fromBufferAttribute(_,E),m[T+S+4]=nn.x,m[T+S+5]=nn.y,m[T+S+6]=nn.z,m[T+S+7]=0),s===!0&&(nn.fromBufferAttribute(w,E),m[T+S+8]=nn.x,m[T+S+9]=nn.y,m[T+S+10]=nn.z,m[T+S+11]=w.itemSize===4?nn.w:1)}}o={count:i,texture:x,stride:u,size:new Se(d,h)},Ud.set(n,o),n.addEventListener("dispose",g)}return o}class qF extends le{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=me(1),this.updateType=we.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=i!==void 0?i.length:0,{texture:a,stride:l,size:c}=WF(t);s===!0&&Dt.mulAssign(this.morphBaseInfluence),r===!0&&is.mulAssign(this.morphBaseInfluence);const u=ze(c.width);fn(o,({i:d})=>{const h=$(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?h.assign(un(this.mesh.morphTexture,ys(ze(d).add(1),ze(Bm))).r):h.assign(Ue("morphTargetInfluences","float").element(d).toVar()),Ke(h.notEqual(0),()=>{s===!0&&Dt.addAssign(Ux({bufferMap:a,influence:h,stride:l,width:u,depth:d,offset:ze(0)})),r===!0&&is.addAssign(Ux({bufferMap:a,influence:h,stride:l,width:u,depth:d,offset:ze(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const KF=Ie(qF).setParameterLength(1);class bo extends le{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class XF extends bo{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class YF extends NT{static get type(){return"LightingContextNode"}constructor(e,t=null,s=null,r=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=K().toVar("directDiffuse"),r=K().toVar("directSpecular"),i=K().toVar("indirectDiffuse"),o=K().toVar("indirectSpecular"),a={directDiffuse:s,directSpecular:r,indirectDiffuse:i,indirectSpecular:o};return{radiance:K().toVar("radiance"),irradiance:K().toVar("irradiance"),iblIrradiance:K().toVar("iblIrradiance"),ambientOcclusion:$(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const QF=Ie(YF);class ZF extends bo{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const pi=new Se;class ew extends xo{static get type(){return"ViewportTextureNode"}constructor(e=Gi,t=null,s=null){let r=null;s===null?(r=new d_,r.minFilter=Hr,s=r):r=s,super(s,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=we.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,s;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,s=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,s=this._cacheTextures),e===null)return t;if(s.has(e)===!1){const r=t.clone();s.set(e,r)}return s.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,s=t.getRenderTarget();s===null?t.getDrawingBufferSize(pi):pi.set(s.width,s.height);const r=this.getTextureForReference(s);(r.image.width!==pi.width||r.image.height!==pi.height)&&(r.image.width=pi.width,r.image.height=pi.height,r.needsUpdate=!0);const i=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const tw=Ie(ew,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let kl=null;class JF extends ew{static get type(){return"ViewportDepthTextureNode"}constructor(e=Gi,t=null){kl===null&&(kl=new Zn),super(e,t,kl)}getTextureForReference(){return kl}}const eO=Ie(JF).setParameterLength(0,2);class Kt extends le{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Kt.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,s=this.valueNode;let r=null;if(t===Kt.DEPTH_BASE)s!==null&&(r=rw().assign(s));else if(t===Kt.DEPTH)e.isPerspectiveCamera?r=tO(ct.z,Dr,Ir):r=ba(ct.z,Dr,Ir);else if(t===Kt.LINEAR_DEPTH)if(s!==null)if(e.isPerspectiveCamera){const i=nw(s,Dr,Ir);r=ba(i,Dr,Ir)}else r=s;else r=ba(ct.z,Dr,Ir);return r}}Kt.DEPTH_BASE="depthBase";Kt.DEPTH="depth";Kt.LINEAR_DEPTH="linearDepth";const ba=(n,e,t)=>n.add(e).div(e.sub(t)),tO=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),nw=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),sw=(n,e,t)=>{e=e.max(1e-6).toVar();const s=Rs(n.negate().div(e)),r=Rs(t.div(e));return s.div(r)},rw=Ie(Kt,Kt.DEPTH_BASE),iw=se(Kt,Kt.DEPTH),nO=Ie(Kt,Kt.LINEAR_DEPTH).setParameterLength(0,1);eO();iw.assign=n=>rw(n);class xn extends le{static get type(){return"ClippingNode"}constructor(e=xn.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:s,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===xn.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(s,r):this.scope===xn.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(s,r)}setupAlphaToCoverage(e,t){return Y(()=>{const s=$().toVar("distanceToPlane"),r=$().toVar("distanceToGradient"),i=$(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const l=Pn(t).setGroup(pe);fn(o,({i:c})=>{const u=l.element(c);s.assign(ct.dot(u.xyz).negate().add(u.w)),r.assign(s.fwidth().div(2)),i.mulAssign(Is(r.negate(),r,s))})}const a=e.length;if(a>0){const l=Pn(e).setGroup(pe),c=$(1).toVar("intersectionClipOpacity");fn(a,({i:u})=>{const d=l.element(u);s.assign(ct.dot(d.xyz).negate().add(d.w)),r.assign(s.fwidth().div(2)),c.mulAssign(Is(r.negate(),r,s).oneMinus())}),i.mulAssign(c.oneMinus())}Me.a.mulAssign(i),Me.a.equal(0).discard()})()}setupDefault(e,t){return Y(()=>{const s=t.length;if(this.hardwareClipping===!1&&s>0){const i=Pn(t).setGroup(pe);fn(s,({i:o})=>{const a=i.element(o);ct.dot(a.xyz).greaterThan(a.w).discard()})}const r=e.length;if(r>0){const i=Pn(e).setGroup(pe),o=_m(!0).toVar("clipped");fn(r,({i:a})=>{const l=i.element(a);o.assign(ct.dot(l.xyz).greaterThan(l.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const s=e.length;return t.enableHardwareClipping(s),Y(()=>{const r=Pn(e).setGroup(pe),i=il(t.getClipDistance());fn(s,({i:o})=>{const a=r.element(o),l=ct.dot(a.xyz).sub(a.w).negate();i.element(o).assign(l)})})()}}xn.ALPHA_TO_COVERAGE="alphaToCoverage";xn.DEFAULT="default";xn.HARDWARE="hardware";const sO=()=>J(new xn),rO=()=>J(new xn(xn.ALPHA_TO_COVERAGE)),iO=()=>J(new xn(xn.HARDWARE)),oO=.05,Vx=Y(([n])=>rs(Ne(1e4,dn(Ne(17,n.x).add(Ne(.1,n.y)))).mul(Jt(.1,rn(dn(Ne(13,n.y).add(n.x))))))),Gx=Y(([n])=>Vx(ne(Vx(n.xy),n.z))),aO=Y(([n])=>{const e=vt(Ms(mT(n.xyz)),Ms(gT(n.xyz))),t=$(1).div($(oO).mul(e)).toVar("pixScale"),s=ne(Ba(Kr(Rs(t))),Ba(Am(Rs(t)))),r=ne(Gx(Kr(s.x.mul(n.xyz))),Gx(Kr(s.y.mul(n.xyz)))),i=rs(Rs(t)),o=Jt(Ne(i.oneMinus(),r.x),Ne(i,r.y)),a=Ji(i,i.oneMinus()),l=K(o.mul(o).div(Ne(2,a).mul(jt(1,a))),o.sub(Ne(.5,a)).div(jt(1,a)),jt(1,jt(1,o).mul(jt(1,o)).div(Ne(2,a).mul(jt(1,a))))),c=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(l.x,l.y),l.z);return Ds(c,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class lO extends PT{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),s=e.hasGeometryAttribute(t);let r;return s===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new et(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const cO=(n=0)=>J(new lO(n)),uO=Y(([n])=>Te(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"});class ut extends Zg{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{ie('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const s=this[t];s&&s.isNode===!0&&e.push({property:t,childNode:s})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:s}of this._getNodeChildren())e.push(Fu(t.slice(0,-4)),s.getCacheKey());return this.type+nl(e)}build(e){this.setup(e)}setupObserver(e){return new WD(e)}setup(e){e.context.setupNormal=()=>xa(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,s=t.getRenderTarget();e.addStack();const r=xa(this.setupVertex(e),"VERTEX"),i=this.vertexNode||r;e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(s!==null?s.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);a!==null&&e.stack.addToStack(a);const c=Te(l,Me.a).max(0);o=this.setupOutput(e,c),ga.assign(o);const u=this.outputNode!==null;if(u&&(o=this.outputNode),s!==null){const d=t.getMRT(),h=this.mrtNode;d!==null?(u&&ga.assign(o),o=d,h!==null&&(o=d.merge(h))):h!==null&&(o=h)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=Te(l)),o=this.setupOutput(e,l)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:s}=e.clippingContext;let r=null;if(t.length>0||s.length>0){const i=e.renderer.currentSamples;this.alphaToCoverage&&i>1?r=rO():e.stack.addToStack(sO())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(iO()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:s}=e;let r=this.depthNode;if(r===null){const i=t.getMRT();i&&i.has("depth")?r=i.get("depth"):t.logarithmicDepthBuffer===!0&&(s.isPerspectiveCamera?r=sw(ct.z,Dr,Ir):r=ba(ct.z,Dr,Ir))}r!==null&&iw.assign(r).toStack()}setupPositionView(){return $u.mul(Dt).xyz}setupModelViewProjection(){return LT.mul(ct)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),JT}setupPosition(e){const{object:t,geometry:s}=e;if((s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&KF(t).toStack(),t.isSkinnedMesh===!0&&$F(t).toStack(),this.displacementMap){const r=Xs("displacementMap","texture"),i=Xs("displacementScale","float"),o=Xs("displacementBias","float");Dt.addAssign(is.normalize().mul(r.x.mul(i).add(o)))}return t.isBatchedMesh&&VF(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&jF(t).toStack(),this.positionNode!==null&&Dt.assign(xa(this.positionNode,"POSITION","vec3")),Dt}setupDiffuseColor(e){const{object:t,geometry:s}=e;this.maskNode!==null&&_m(this.maskNode).not().discard();let r=this.colorNode?Te(this.colorNode):iF;this.vertexColors===!0&&s.hasAttribute("color")&&(r=r.mul(cO())),t.instanceColor&&(r=tu("vec3","vInstanceColor").mul(r)),t.isBatchedMesh&&t._colorsTexture&&(r=tu("vec3","vBatchColor").mul(r)),Me.assign(r);const i=this.opacityNode?$(this.opacityNode):QT;Me.a.assign(Me.a.mul(i));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?$(this.alphaTestNode):rF,this.alphaToCoverage===!0?(Me.a=Is(o,o.add(xT(Me.a)),Me.a),Me.a.lessThanEqual(0).discard()):Me.a.lessThanEqual(o).discard()),this.alphaHash===!0&&Me.a.lessThan(aO(Dt)).discard(),e.isOpaque()&&Me.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?K(0):Me.rgb}setupNormal(){return this.normalNode?K(this.normalNode):hF}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Xs("envMap","cubeTexture"):Xs("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new ZF(ZT)),t}setupLights(e){const t=[],s=this.setupEnvironment(e);s&&s.isLightingNode&&t.push(s);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:IF;t.push(new XF(o))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:r,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const c=this.setupLightingModel(e)||null;l=QF(a,c,s,r)}else s!==null&&(l=K(r!==null?We(l,s,r):s));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(Nx.assign(K(i||aF)),l=l.add(Nx)),l}setupFog(e,t){const s=e.fogNode;return s&&(ga.assign(t),t=Te(s.toVar())),t}setupPremultipliedAlpha(e,t){return uO(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const s in e){const r=e[s];this[s]===void 0&&(this[s]=r,r&&r.clone&&(this[s]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=Zg.prototype.toJSON.call(this,e);s.inputNodes={};for(const{property:i,childNode:o}of this._getNodeChildren())s.inputNodes[i]=o.toJSON(e).uuid;function r(i){const o=[];for(const a in i){const l=i[a];delete l.metadata,o.push(l)}return o}if(t){const i=r(e.textures),o=r(e.images),a=r(e.nodes);i.length>0&&(s.textures=i),o.length>0&&(s.images=o),a.length>0&&(s.nodes=a)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const dO=new l_;class hO extends ut{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(dO),this.setValues(e)}}const fO=new kA;class pO extends ut{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(fO),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?$(this.offsetNode):PF,t=this.dashScaleNode?$(this.dashScaleNode):CF,s=this.dashSizeNode?$(this.dashSizeNode):RF,r=this.gapSizeNode?$(this.gapSizeNode):MF;Ld.assign(s),Sx.assign(r);const i=dr(lr("lineDistance").mul(t));(e?i.add(e):i).mod(Ld.add(Sx)).greaterThan(Ld).discard()}}const mO=n=>J(n).mul(.5).add(.5),gO=new MA;class xO extends ut{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(gO),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?$(this.opacityNode):QT;Me.assign(Mm(Te(mO(Fe),e),Gp))}}const ow=Y(([n=FT])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ne(e,t)});class aw extends cC{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const s=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new W_(5,5,5),o=ow(FT),a=new ut;a.colorNode=Re(t,o,0),a.side=Qt,a.blending=Xi;const l=new Bn(i,a),c=new Nu;c.add(l),t.minFilter===Hr&&(t.minFilter=Ln);const u=new uC(1,10,this),d=e.getMRT();return e.setMRT(null),u.update(e,c),e.setMRT(d),t.minFilter=s,t.currentGenerateMipmaps=r,l.geometry.dispose(),l.material.dispose(),this}}const va=new WeakMap;class yO extends _t{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Oa(null);const t=new Kp;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=we.RENDER}updateBefore(e){const{renderer:t,material:s}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const i=r.isTextureNode?r.value:s[r.property];if(i&&i.isTexture){const o=i.mapping;if(o===Wp||o===qp){if(va.has(i)){const a=va.get(i);$x(a,i.mapping),this._cubeTexture=a}else{const a=i.image;if(bO(a)){const l=new aw(a.height);l.fromEquirectangularTexture(t,i),$x(l.texture,i.mapping),this._cubeTexture=l.texture,va.set(i,l.texture),i.addEventListener("dispose",lw)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function bO(n){return n==null?!1:n.height>0}function lw(n){const e=n.target;e.removeEventListener("dispose",lw);const t=va.get(e);t!==void 0&&(va.delete(e),t.dispose())}function $x(n,e){e===Wp?n.mapping=jc:e===qp&&(n.mapping=Uc)}const cw=Ie(yO).setParameterLength(1);class Lm extends bo{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=cw(this.envNode)}}class vO extends bo{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=$(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Hu{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class uw extends Hu{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,s=e.reflectedLight,r=e.irradianceLightMap;s.indirectDiffuse.assign(Te(0)),r?s.indirectDiffuse.addAssign(r):s.indirectDiffuse.addAssign(Te(1,1,1,0)),s.indirectDiffuse.mulAssign(t),s.indirectDiffuse.mulAssign(Me.rgb)}finish(e){const{material:t,context:s}=e,r=s.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case aC:r.rgb.assign(We(r.rgb,r.rgb.mul(i.rgb),Tc.mul(jd)));break;case oC:r.rgb.assign(We(r.rgb,i.rgb,Tc.mul(jd)));break;case iC:r.rgb.addAssign(i.rgb.mul(Tc.mul(jd)));break;default:ie("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const _O=new Ks;class TO extends ut{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(_O),this.setValues(e)}setupNormal(){return ol(Fa)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Lm(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new vO(ZT)),t}setupOutgoingLight(){return Me.rgb}setupLightingModel(){return new uw}}const ja=Y(({f0:n,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(s.oneMinus()).add(e.mul(s))}),so=Y(n=>n.diffuseColor.mul(1/Math.PI)),wO=()=>$(.25),NO=Y(({dotNH:n})=>jf.mul($(.5)).add(1).mul($(1/Math.PI)).mul(n.pow(jf))),SO=Y(({lightDirection:n})=>{const e=n.add(Qe).normalize(),t=Fe.dot(e).clamp(),s=Qe.dot(e).clamp(),r=ja({f0:An,f90:1,dotVH:s}),i=wO(),o=NO({dotNH:t});return r.mul(i).mul(o)});class dw extends uw{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=Fe.dot(e).clamp().mul(t);s.directDiffuse.addAssign(i.mul(so({diffuseColor:Me.rgb}))),this.specular===!0&&s.directSpecular.addAssign(i.mul(SO({lightDirection:e})).mul(Tc))}indirect(e){const{ambientOcclusion:t,irradiance:s,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(s.mul(so({diffuseColor:Me}))),r.indirectDiffuse.mulAssign(t)}}const EO=new i_;class AO extends ut{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(EO),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Lm(t):null}setupLightingModel(){return new dw(!1)}}const CO=new EA;class RO extends ut{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(CO),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Lm(t):null}setupLightingModel(){return new dw}setupVariants(){const e=(this.shininessNode?$(this.shininessNode):oF).max(1e-4);jf.assign(e);const t=this.specularNode||lF;An.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const MO=Y(n=>{if(n.geometry.hasAttribute("normal")===!1)return $(0);const e=Fa.dFdx().abs().max(Fa.dFdy().abs());return e.x.max(e.y).max(e.z)}),hw=Y(n=>{const{roughness:e}=n,t=MO();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),PO=Y(({alpha:n,dotNL:e,dotNV:t})=>{const s=n.pow2(),r=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt()),i=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt());return ss(.5,r.add(i).max(uT))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),kO=Y(({alphaT:n,alphaB:e,dotTV:t,dotBV:s,dotTL:r,dotBL:i,dotNV:o,dotNL:a})=>{const l=a.mul(K(n.mul(t),e.mul(s),o).length()),c=o.mul(K(n.mul(r),e.mul(i),a).length());return ss(.5,l.add(c)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),DO=Y(({alpha:n,dotNH:e})=>{const t=n.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),IO=$(1/Math.PI),BO=Y(({alphaT:n,alphaB:e,dotNH:t,dotTH:s,dotBH:r})=>{const i=n.mul(e),o=K(e.mul(s),n.mul(r),i.mul(t)),a=o.dot(o),l=i.div(a);return IO.mul(i.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),fw=Y(({lightDirection:n,f0:e,f90:t,roughness:s,f:r,normalView:i=Fe,USE_IRIDESCENCE:o,USE_ANISOTROPY:a})=>{const l=s.pow2(),c=n.add(Qe).normalize(),u=i.dot(n).clamp(),d=i.dot(Qe).clamp(),h=i.dot(c).clamp(),p=Qe.dot(c).clamp();let m=ja({f0:e,f90:t,dotVH:p}),x,y;if(wx(o)&&(m=Nm.mix(m,r)),wx(a)){const g=yc.dot(n),b=yc.dot(Qe),v=yc.dot(c),_=Vi.dot(n),w=Vi.dot(Qe),T=Vi.dot(c);x=kO({alphaT:Of,alphaB:l,dotTV:b,dotBV:w,dotTL:g,dotBL:_,dotNV:d,dotNL:u}),y=BO({alphaT:Of,alphaB:l,dotNH:h,dotTH:v,dotBH:T})}else x=PO({alpha:l,dotNL:u,dotNV:d}),y=DO({alpha:l,dotNH:h});return m.mul(x).mul(y)}),LO=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let fs=null;const ou=Y(({roughness:n,dotNV:e})=>{fs===null&&(fs=new G_(LO,32,32,Zs,Vt),fs.minFilter=Ln,fs.magFilter=Ln,fs.wrapS=Aa,fs.wrapT=Aa,fs.generateMipmaps=!1,fs.needsUpdate=!0);const t=ne(n,e);return Re(fs,t).rg}),FO=Y(({lightDirection:n,f0:e,f90:t,roughness:s,f:r,USE_IRIDESCENCE:i,USE_ANISOTROPY:o})=>{const a=fw({lightDirection:n,f0:e,f90:t,roughness:s,f:r,USE_IRIDESCENCE:i,USE_ANISOTROPY:o}),l=Fe.dot(n).clamp(),c=Fe.dot(Qe).clamp(),u=ou({roughness:s,dotNV:c}),d=ou({roughness:s,dotNV:l}),h=e.mul(u.x).add(t.mul(u.y)),p=e.mul(d.x).add(t.mul(d.y)),m=u.x.add(u.y),x=d.x.add(d.y),y=$(1).sub(m),g=$(1).sub(x),b=e.add(e.oneMinus().mul(.047619)),v=h.mul(p).mul(b).div($(1).sub(y.mul(g).mul(b).mul(b)).add(uT)),_=y.mul(g),w=v.mul(_);return a.add(w)}),pw=Y(n=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:r}=n,i=ou({dotNV:e,roughness:r});return t.mul(i.x).add(s.mul(i.y))}),OO=Y(({f:n,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),r=s.mul(s),i=s.mul(r,r).clamp(0,.9999);return n.sub(K(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),jO=Y(({roughness:n,dotNH:e})=>{const t=n.pow2(),s=$(1).div(t),i=e.pow2().oneMinus().max(.0078125);return $(2).add(s).mul(i.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),UO=Y(({dotNV:n,dotNL:e})=>$(1).div($(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),VO=Y(({lightDirection:n})=>{const e=n.add(Qe).normalize(),t=Fe.dot(n).clamp(),s=Fe.dot(Qe).clamp(),r=Fe.dot(e).clamp(),i=jO({roughness:wm,dotNH:r}),o=UO({dotNV:s,dotNL:t});return Ci.mul(i).mul(o)}),GO=Y(({N:n,V:e,roughness:t})=>{const i=.0078125,o=n.dot(e).saturate(),a=ne(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(i)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),$O=Y(({f:n})=>{const e=n.length();return vt(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Dl=Y(({v1:n,v2:e})=>{const t=n.dot(e),s=t.abs().toVar(),r=s.mul(.0145206).add(.4965155).mul(s).add(.8543985).toVar(),i=s.add(4.1616724).mul(s).add(3.417594).toVar(),o=r.div(i),a=t.greaterThan(0).select(o,vt(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),zx=Y(({N:n,V:e,P:t,mInv:s,p0:r,p1:i,p2:o,p3:a})=>{const l=i.sub(r).toVar(),c=a.sub(r).toVar(),u=l.cross(c),d=K().toVar();return Ke(u.dot(t.sub(r)).greaterThanEqual(0),()=>{const h=e.sub(n.mul(e.dot(n))).normalize(),p=n.cross(h).negate(),m=s.mul($t(h,p,n).transpose()).toVar(),x=m.mul(r.sub(t)).normalize().toVar(),y=m.mul(i.sub(t)).normalize().toVar(),g=m.mul(o.sub(t)).normalize().toVar(),b=m.mul(a.sub(t)).normalize().toVar(),v=K(0).toVar();v.addAssign(Dl({v1:x,v2:y})),v.addAssign(Dl({v1:y,v2:g})),v.addAssign(Dl({v1:g,v2:b})),v.addAssign(Dl({v1:b,v2:x})),d.assign(K($O({f:v})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Wu=1/6,mw=n=>Ne(Wu,Ne(n,Ne(n,n.negate().add(3)).sub(3)).add(1)),zf=n=>Ne(Wu,Ne(n,Ne(n,Ne(3,n).sub(6))).add(4)),gw=n=>Ne(Wu,Ne(n,Ne(n,Ne(-3,n).add(3)).add(3)).add(1)),Hf=n=>Ne(Wu,Uu(n,3)),Hx=n=>mw(n).add(zf(n)),Wx=n=>gw(n).add(Hf(n)),qx=n=>Jt(-1,zf(n).div(mw(n).add(zf(n)))),Kx=n=>Jt(1,Hf(n).div(gw(n).add(Hf(n)))),Xx=(n,e,t)=>{const s=n.uvNode,r=Ne(s,e.zw).add(.5),i=Kr(r),o=rs(r),a=Hx(o.x),l=Wx(o.x),c=qx(o.x),u=Kx(o.x),d=qx(o.y),h=Kx(o.y),p=ne(i.x.add(c),i.y.add(d)).sub(.5).mul(e.xy),m=ne(i.x.add(u),i.y.add(d)).sub(.5).mul(e.xy),x=ne(i.x.add(c),i.y.add(h)).sub(.5).mul(e.xy),y=ne(i.x.add(u),i.y.add(h)).sub(.5).mul(e.xy),g=Hx(o.y).mul(Jt(a.mul(n.sample(p).level(t)),l.mul(n.sample(m).level(t)))),b=Wx(o.y).mul(Jt(a.mul(n.sample(x).level(t)),l.mul(n.sample(y).level(t))));return g.add(b)},zO=Y(([n,e])=>{const t=ne(n.size(ze(e))),s=ne(n.size(ze(e.add(1)))),r=ss(1,t),i=ss(1,s),o=Xx(n,Te(r,t),Kr(e)),a=Xx(n,Te(i,s),Am(e));return rs(e).mix(o,a)}),Yx=Y(([n,e,t,s,r])=>{const i=K(wT(e.negate(),es(n),ss(1,s))),o=K(Ms(r[0].xyz),Ms(r[1].xyz),Ms(r[2].xyz));return es(i).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),HO=Y(([n,e])=>n.mul(Ds(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),WO=tw(),qO=tw(),Qx=Y(([n,e,t],{material:s})=>{const i=(s.side===Qt?WO:qO).sample(n),o=Rs(Vf.x).mul(HO(e,t));return zO(i,o)}),Zx=Y(([n,e,t])=>(Ke(t.notEqual(0),()=>{const s=hT(e).negate().div(t);return dT(s.negate().mul(n))}),K(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),KO=Y(([n,e,t,s,r,i,o,a,l,c,u,d,h,p,m])=>{let x,y;if(m){x=Te().toVar(),y=K().toVar();const w=u.sub(1).mul(m.mul(.025)),T=K(u.sub(w),u,u.add(w));fn({start:0,end:3},({i:E})=>{const S=T.element(E),C=Yx(n,e,d,S,a),k=o.add(C),B=c.mul(l.mul(Te(k,1))),V=ne(B.xy.div(B.w)).toVar();V.addAssign(1),V.divAssign(2),V.assign(ne(V.x,V.y.oneMinus()));const z=Qx(V,t,S);x.element(E).assign(z.element(E)),x.a.addAssign(z.a),y.element(E).assign(s.element(E).mul(Zx(Ms(C),h,p).element(E)))}),x.a.divAssign(3)}else{const w=Yx(n,e,d,u,a),T=o.add(w),E=c.mul(l.mul(Te(T,1))),S=ne(E.xy.div(E.w)).toVar();S.addAssign(1),S.divAssign(2),S.assign(ne(S.x,S.y.oneMinus())),x=Qx(S,t,u),y=s.mul(Zx(Ms(w),h,p))}const g=y.rgb.mul(x.rgb),b=n.dot(e).clamp(),v=K(pw({dotNV:b,specularColor:r,specularF90:i,roughness:t})),_=y.r.add(y.g,y.b).div(3);return Te(v.oneMinus().mul(g),x.a.oneMinus().mul(_).oneMinus())}),XO=$t(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),YO=n=>{const e=n.sqrt();return K(1).add(e).div(K(1).sub(e))},Jx=(n,e)=>n.sub(e).div(n.add(e)).pow2(),QO=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),s=K(54856e-17,44201e-17,52481e-17),r=K(1681e3,1795300,2208400),i=K(43278e5,93046e5,66121e5),o=$(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(i.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=K(a.x.add(o),a.y,a.z).div(10685e-11),XO.mul(a)},ZO=Y(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:r})=>{const i=We(n,e,Is(0,.03,s)),a=n.div(i).pow2().mul(t.pow2().oneMinus()).oneMinus();Ke(a.lessThan(0),()=>K(1));const l=a.sqrt(),c=Jx(i,n),u=ja({f0:c,f90:1,dotVH:t}),d=u.oneMinus(),h=i.lessThan(n).select(Math.PI,0),p=$(Math.PI).sub(h),m=YO(r.clamp(0,.9999)),x=Jx(m,i.toVec3()),y=ja({f0:x,f90:1,dotVH:l}),g=K(m.x.lessThan(i).select(Math.PI,0),m.y.lessThan(i).select(Math.PI,0),m.z.lessThan(i).select(Math.PI,0)),b=i.mul(s,l,2),v=K(p).add(g),_=u.mul(y).clamp(1e-5,.9999),w=_.sqrt(),T=d.pow2().mul(y).div(K(1).sub(_)),S=u.add(T).toVar(),C=T.sub(d).toVar();return fn({start:1,end:2,condition:"<=",name:"m"},({m:k})=>{C.mulAssign(w);const B=QO($(k).mul(b),$(k).mul(v)).mul(2);S.addAssign(C.mul(B))}),S.max(K(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),JO=Y(({normal:n,viewDir:e,roughness:t})=>{const s=n.dot(e).saturate(),r=t.pow2(),i=Ct(t.lessThan(.25),$(-339.2).mul(r).add($(161.4).mul(t)).sub(25.9),$(-8.48).mul(r).add($(14.3).mul(t)).sub(9.95)),o=Ct(t.lessThan(.25),$(44).mul(r).sub($(23.7).mul(t)).add(3.26),$(1.97).mul(r).sub($(3.27).mul(t)).add(.72));return Ct(t.lessThan(.25),0,$(.1).mul(t).sub(.025)).add(i.mul(s).add(o).exp()).mul(1/Math.PI).saturate()}),Vd=K(.04),Gd=$(1);class xw extends Hu{constructor(e=!1,t=!1,s=!1,r=!1,i=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.anisotropy=r,this.transmission=i,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=K().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=K().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=K().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=K().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=K().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Fe.dot(Qe).clamp();this.iridescenceFresnel=ZO({outsideIOR:$(1),eta2:tT,cosTheta1:t,thinFilmThickness:nT,baseF0:An}),this.iridescenceF0=OO({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=no,s=AL.sub(no).normalize(),r=yo,i=e.context;i.backdrop=KO(r,s,ws,Me,An,ru,t,ti,js,LT,bc,sT,iT,rT,this.dispersion?oT:null),i.backdropAlpha=Uf,Me.a.mulAssign(We(1,i.backdrop.a,Uf))}super.start(e)}computeMultiscattering(e,t,s){const r=Fe.dot(Qe).clamp(),i=ou({roughness:ws,dotNV:r}),o=this.iridescenceF0?Nm.mix(An,this.iridescenceF0):An,a=o.mul(i.x).add(s.mul(i.y)),c=i.x.add(i.y).oneMinus(),u=o.add(o.oneMinus().mul(.047619)),d=a.mul(u).div(c.mul(u).oneMinus());e.addAssign(a),t.addAssign(d.mul(c))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=Fe.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(VO({lightDirection:e}))),this.clearcoat===!0){const a=Ri.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(fw({lightDirection:e,f0:Vd,f90:Gd,roughness:su,normalView:Ri})))}s.directDiffuse.addAssign(i.mul(so({diffuseColor:Me.rgb}))),s.directSpecular.addAssign(i.mul(FO({lightDirection:e,f0:An,f90:1,roughness:ws,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:s,halfHeight:r,reflectedLight:i,ltc_1:o,ltc_2:a}){const l=t.add(s).sub(r),c=t.sub(s).sub(r),u=t.sub(s).add(r),d=t.add(s).add(r),h=Fe,p=Qe,m=ct.toVar(),x=GO({N:h,V:p,roughness:ws}),y=o.sample(x).toVar(),g=a.sample(x).toVar(),b=$t(K(y.x,0,y.y),K(0,1,0),K(y.z,0,y.w)).toVar(),v=An.mul(g.x).add(An.oneMinus().mul(g.y)).toVar();i.directSpecular.addAssign(e.mul(v).mul(zx({N:h,V:p,P:m,mInv:b,p0:l,p1:c,p2:u,p3:d}))),i.directDiffuse.addAssign(e.mul(Me).mul(zx({N:h,V:p,P:m,mInv:$t(1,0,0,0,1,0,0,0,1),p0:l,p1:c,p2:u,p3:d})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(t.mul(so({diffuseColor:Me})))}indirectSpecular(e){const{radiance:t,iblIrradiance:s,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(s.mul(Ci,JO({normal:Fe,viewDir:Qe,roughness:wm}))),this.clearcoat===!0){const u=Ri.dot(Qe).clamp(),d=pw({dotNV:u,specularColor:Vd,specularF90:Gd,roughness:su});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(d))}const i=K().toVar("singleScattering"),o=K().toVar("multiScattering"),a=s.mul(1/Math.PI);this.computeMultiscattering(i,o,ru);const l=i.add(o),c=Me.mul(l.r.max(l.g).max(l.b).oneMinus());r.indirectSpecular.addAssign(t.mul(i)),r.indirectSpecular.addAssign(o.mul(a)),r.indirectDiffuse.addAssign(c.mul(a))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:s}=e.context,i=Fe.dot(Qe).clamp().add(t),o=ws.mul(-16).oneMinus().negate().exp2(),a=t.sub(i.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),s.indirectDiffuse.mulAssign(t),s.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=Ri.dot(Qe).clamp(),r=ja({dotVH:s,f0:Vd,f90:Gd}),i=t.mul(Ff.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Ff));t.assign(i)}if(this.sheen===!0){const s=Ci.r.max(Ci.g).max(Ci.b).mul(.157).oneMinus(),r=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const ey=$(1),Wf=$(-2),Il=$(.8),$d=$(-1),Bl=$(.4),zd=$(2),Ll=$(.305),Hd=$(3),ty=$(.21),e5=$(4),ny=$(4),t5=$(16),n5=Y(([n])=>{const e=K(rn(n)).toVar(),t=$(-1).toVar();return Ke(e.x.greaterThan(e.z),()=>{Ke(e.x.greaterThan(e.y),()=>{t.assign(Ct(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Ct(n.y.greaterThan(0),1,4))})}).Else(()=>{Ke(e.z.greaterThan(e.y),()=>{t.assign(Ct(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Ct(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),s5=Y(([n,e])=>{const t=ne().toVar();return Ke(e.equal(0),()=>{t.assign(ne(n.z,n.y).div(rn(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(ne(n.x.negate(),n.z.negate()).div(rn(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(ne(n.x.negate(),n.y).div(rn(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(ne(n.z.negate(),n.y).div(rn(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(ne(n.x.negate(),n.z).div(rn(n.y)))}).Else(()=>{t.assign(ne(n.x,n.y).div(rn(n.z)))}),Ne(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),r5=Y(([n])=>{const e=$(0).toVar();return Ke(n.greaterThanEqual(Il),()=>{e.assign(ey.sub(n).mul($d.sub(Wf)).div(ey.sub(Il)).add(Wf))}).ElseIf(n.greaterThanEqual(Bl),()=>{e.assign(Il.sub(n).mul(zd.sub($d)).div(Il.sub(Bl)).add($d))}).ElseIf(n.greaterThanEqual(Ll),()=>{e.assign(Bl.sub(n).mul(Hd.sub(zd)).div(Bl.sub(Ll)).add(zd))}).ElseIf(n.greaterThanEqual(ty),()=>{e.assign(Ll.sub(n).mul(e5.sub(Hd)).div(Ll.sub(ty)).add(Hd))}).Else(()=>{e.assign($(-2).mul(Rs(Ne(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),i5=Y(([n,e])=>{const t=n.toVar();t.assign(Ne(2,t).sub(1));const s=K(t,1).toVar();return Ke(e.equal(0),()=>{s.assign(s.zyx)}).ElseIf(e.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{s.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),o5=Y(([n,e,t,s,r,i])=>{const o=$(t),a=K(e),l=Ds(r5(o),Wf,i),c=rs(l),u=Kr(l),d=K(Ua(n,a,u,s,r,i)).toVar();return Ke(c.notEqual(0),()=>{const h=K(Ua(n,a,u.add(1),s,r,i)).toVar();d.assign(We(d,h,c))}),d}),Ua=Y(([n,e,t,s,r,i])=>{const o=$(t).toVar(),a=K(e),l=$(n5(a)).toVar(),c=$(vt(ny.sub(o),0)).toVar();o.assign(vt(o,ny));const u=$(Ba(o)).toVar(),d=ne(s5(a,l).mul(u.sub(2)).add(1)).toVar();return Ke(l.greaterThan(2),()=>{d.y.addAssign(u),l.subAssign(3)}),d.x.addAssign(l.mul(u)),d.x.addAssign(c.mul(Ne(3,t5))),d.y.addAssign(Ne(4,Ba(i).sub(u))),d.x.mulAssign(s),d.y.mulAssign(r),n.sample(d).grad(ne(),ne())}),Wd=Y(({envMap:n,mipInt:e,outputDirection:t,theta:s,axis:r,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=bs(s),c=t.mul(l).add(r.cross(t).mul(dn(s))).add(r.mul(r.dot(t).mul(l.oneMinus())));return Ua(n,c,e,i,o,a)}),a5=Y(({n,latitudinal:e,poleAxis:t,outputDirection:s,weights:r,samples:i,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})=>{const h=K(Ct(e,t,La(t,s))).toVar();Ke(h.equal(K(0)),()=>{h.assign(K(s.z,0,s.x.negate()))}),h.assign(es(h));const p=K().toVar();return p.addAssign(r.element(0).mul(Wd({theta:0,axis:h,outputDirection:s,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),fn({start:ze(1),end:n},({i:m})=>{Ke(m.greaterThanEqual(i),()=>{HF()});const x=$(o.mul($(m))).toVar();p.addAssign(r.element(m).mul(Wd({theta:x.mul(-1),axis:h,outputDirection:s,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),p.addAssign(r.element(m).mul(Wd({theta:x,axis:h,outputDirection:s,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})))}),Te(p,1)}),l5=Y(([n])=>{const e=it(n).toVar();return e.assign(e.shiftLeft(it(16)).bitOr(e.shiftRight(it(16)))),e.assign(e.bitAnd(it(1431655765)).shiftLeft(it(1)).bitOr(e.bitAnd(it(2863311530)).shiftRight(it(1)))),e.assign(e.bitAnd(it(858993459)).shiftLeft(it(2)).bitOr(e.bitAnd(it(3435973836)).shiftRight(it(2)))),e.assign(e.bitAnd(it(252645135)).shiftLeft(it(4)).bitOr(e.bitAnd(it(4042322160)).shiftRight(it(4)))),e.assign(e.bitAnd(it(16711935)).shiftLeft(it(8)).bitOr(e.bitAnd(it(4278255360)).shiftRight(it(8)))),$(e).mul(23283064365386963e-26)}),c5=Y(([n,e])=>ne($(n).div($(e)),l5(n))),u5=Y(([n,e,t])=>{const s=K(e).toVar(),r=$(t),i=r.mul(r).toVar(),o=es(K(i.mul(s.x),i.mul(s.y),s.z)).toVar(),a=o.x.mul(o.x).add(o.y.mul(o.y)),l=Ct(a.greaterThan(0),K(o.y.negate(),o.x,0).div(Ur(a)),K(1,0,0)).toVar(),c=La(o,l).toVar(),u=Ur(n.x),d=Ne(2,3.14159265359).mul(n.y),h=u.mul(bs(d)).toVar(),p=u.mul(dn(d)).toVar(),m=Ne(.5,o.z.add(1));p.assign(m.oneMinus().mul(Ur(h.mul(h).oneMinus())).add(m.mul(p)));const x=l.mul(h).add(c.mul(p)).add(o.mul(Ur(vt(0,h.mul(h).add(p.mul(p)).oneMinus()))));return es(K(i.mul(x.x),i.mul(x.y),vt(0,x.z)))}),d5=Y(({roughness:n,mipInt:e,envMap:t,N_immutable:s,GGX_SAMPLES:r,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=K(s).toVar(),c=K(0).toVar(),u=$(0).toVar();return Ke(n.lessThan(.001),()=>{c.assign(Ua(t,l,e,i,o,a))}).Else(()=>{const d=Ct(rn(l.z).lessThan(.999),K(0,0,1),K(1,0,0)),h=es(La(d,l)).toVar(),p=La(l,h).toVar();fn({start:it(0),end:r},({i:m})=>{const x=c5(m,r),y=u5(x,K(0,0,1),n),g=es(h.mul(y.x).add(p.mul(y.y)).add(l.mul(y.z))),b=es(g.mul(eo(l,g).mul(2)).sub(l)),v=vt(eo(l,b),0);Ke(v.greaterThan(0),()=>{const _=Ua(t,b,e,i,o,a);c.addAssign(_.mul(v)),u.addAssign(v)})}),Ke(u.greaterThan(0),()=>{c.assign(c.div(u))})}),Te(c,1)}),Js=4,sy=[.125,.215,.35,.446,.526,.582],Br=20,h5=512,Fo=new Hp(-1,1,1,-1,0,1),f5=new Ea(90,1),ry=new _n;let qd=null,Kd=0,Xd=0;const p5=new ue,au=new WeakMap,m5=[3,1,5,0,4,2],Yd=i5(go(),lr("faceIndex")).normalize(),qu=K(Yd.x,Yd.y,Yd.z);class g5{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,s=.1,r=100,i={}){const{size:o=256,position:a=p5,renderTarget:l=null}=i;if(this._setSize(o),this._hasInitialized===!1){ie('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const u=l||this._allocateTarget();return i.renderTarget=u,this.fromSceneAsync(e,t,s,r,i),u}qd=this._renderer.getRenderTarget(),Kd=this._renderer.getActiveCubeFace(),Xd=this._renderer.getActiveMipmapLevel();const c=l||this._allocateTarget();return c.depthBuffer=!0,this._init(c),this._sceneToCubeUV(e,s,r,c,a),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}async fromSceneAsync(e,t=0,s=.1,r=100,i={}){return ft('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,s,r,i)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){ie('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const s=t||this._allocateTarget();return this.fromEquirectangularAsync(e,s),s}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return ft('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){ie("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const s=t||this._allocateTarget();return this.fromCubemapAsync(e,t),s}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return ft('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oy(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=ay(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===jc||e.mapping===Uc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(qd,Kd,Xd),e.scissorTest=!1,mi(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),qd=this._renderer.getRenderTarget(),Kd=this._renderer.getActiveCubeFace(),Xd=this._renderer.getActiveMipmapLevel();const s=t||this._allocateTarget();return this._init(s),this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return iy(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=iy(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=x5(t)),this._blurMaterial=y5(t,e.width,e.height),this._ggxMaterial=b5(t,e.width,e.height)}}async _compileMaterial(e){const t=new Bn(new Za,e);await this._renderer.compile(t,Fo)}_sceneToCubeUV(e,t,s,r,i){const o=f5;o.near=t,o.far=s;const a=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],c=this._renderer,u=c.autoClear;c.getClearColor(ry),c.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new Bn(new W_,new Ks({name:"PMREM.Background",side:Qt,depthWrite:!1,depthTest:!1})));const d=this._backgroundBox,h=d.material;let p=!1;const m=e.background;m?m.isColor&&(h.color.copy(m),e.background=null,p=!0):(h.color.copy(ry),p=!0),c.setRenderTarget(r),c.clear(),p&&c.render(d,o);for(let x=0;x<6;x++){const y=x%3;y===0?(o.up.set(0,a[x],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x+l[x],i.y,i.z)):y===1?(o.up.set(0,0,a[x]),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y+l[x],i.z)):(o.up.set(0,a[x],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y,i.z+l[x]));const g=this._cubeSize;mi(r,y*g,x>2?g:0,g,g),c.render(e,o)}c.autoClear=u,e.background=m}_textureToCubeUV(e,t){const s=this._renderer,r=e.mapping===jc||e.mapping===Uc;r?this._cubemapMaterial===null&&(this._cubemapMaterial=oy(e)):this._equirectMaterial===null&&(this._equirectMaterial=ay(e));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=i;const a=this._cubeSize;mi(t,0,0,3*a,2*a),s.setRenderTarget(t),s.render(o,Fo)}_applyPMREM(e){const t=this._renderer,s=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let i=1;i<r;i++)this._applyGGXFilter(e,i-1,i);t.autoClear=s}_applyGGXFilter(e,t,s){const r=this._renderer,i=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[s];a.material=o;const l=au.get(o),c=s/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),d=Math.sqrt(c*c-u*u),h=.05+c*.95,p=d*h,{_lodMax:m}=this,x=this._sizeLods[s],y=3*x*(s>m-Js?s-m+Js:0),g=4*(this._cubeSize-x);e.texture.frame=(e.texture.frame||0)+1,l.envMap.value=e.texture,l.roughness.value=p,l.mipInt.value=m-t,mi(i,y,g,3*x,2*x),r.setRenderTarget(i),r.render(a,Fo),i.texture.frame=(i.texture.frame||0)+1,l.envMap.value=i.texture,l.roughness.value=0,l.mipInt.value=m-s,mi(e,y,g,3*x,2*x),r.setRenderTarget(e),r.render(a,Fo)}_blur(e,t,s,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,s,r,"latitudinal",i),this._halfBlur(o,e,s,s,r,"longitudinal",i)}_halfBlur(e,t,s,r,i,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&re("blur direction must be either latitudinal or longitudinal!");const u=3,d=this._lodMeshes[r];d.material=c;const h=au.get(c),p=this._sizeLods[s]-1,m=isFinite(i)?Math.PI/(2*p):2*Math.PI/(2*Br-1),x=i/m,y=isFinite(i)?1+Math.floor(u*x):Br;y>Br&&ie(`sigmaRadians, ${i}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Br}`);const g=[];let b=0;for(let E=0;E<Br;++E){const S=E/x,C=Math.exp(-S*S/2);g.push(C),E===0?b+=C:E<y&&(b+=2*C)}for(let E=0;E<g.length;E++)g[E]=g[E]/b;e.texture.frame=(e.texture.frame||0)+1,h.envMap.value=e.texture,h.samples.value=y,h.weights.array=g,h.latitudinal.value=o==="latitudinal"?1:0,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=m,h.mipInt.value=v-s;const _=this._sizeLods[r],w=3*_*(r>v-Js?r-v+Js:0),T=4*(this._cubeSize-_);mi(t,w,T,3*_,2*_),l.setRenderTarget(t),l.render(d,Fo)}}function x5(n){const e=[],t=[],s=[];let r=n;const i=n-Js+1+sy.length;for(let o=0;o<i;o++){const a=Math.pow(2,r);e.push(a);let l=1/a;o>n-Js?l=sy[o-n+Js-1]:o===0&&(l=0),t.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],p=6,m=6,x=3,y=2,g=1,b=new Float32Array(x*m*p),v=new Float32Array(y*m*p),_=new Float32Array(g*m*p);for(let T=0;T<p;T++){const E=T%3*2/3-1,S=T>2?0:-1,C=[E,S,0,E+2/3,S,0,E+2/3,S+1,0,E,S,0,E+2/3,S+1,0,E,S+1,0],k=m5[T];b.set(C,x*m*k),v.set(h,y*m*k);const B=[k,k,k,k,k,k];_.set(B,g*m*k)}const w=new Za;w.setAttribute("position",new uc(b,x)),w.setAttribute("uv",new uc(v,y)),w.setAttribute("faceIndex",new uc(_,g)),s.push(new Bn(w,null)),r>Js&&r--}return{lodMeshes:s,sizeLods:e,sigmas:t}}function iy(n,e){const t={magFilter:Ln,minFilter:Ln,generateMipmaps:!1,type:Vt,format:kn,colorSpace:xC},s=new fo(n,e,t);return s.texture.mapping=Xh,s.texture.name="PMREM.cubeUv",s.texture.isPMREMTexture=!0,s.scissorTest=!0,s}function mi(n,e,t,s,r){n.viewport.set(e,t,s,r),n.scissor.set(e,t,s,r)}function Ku(n){const e=new ut;return e.depthTest=!1,e.depthWrite=!1,e.blending=Xi,e.name=`PMREM_${n}`,e}function y5(n,e,t){const s=Pn(new Array(Br).fill(0)),r=me(new ue(0,1,0)),i=me(0),o=$(Br),a=me(0),l=me(1),c=Re(),u=me(0),d=$(1/e),h=$(1/t),p=$(n),m={n:o,latitudinal:a,weights:s,poleAxis:r,outputDirection:qu,dTheta:i,samples:l,envMap:c,mipInt:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p},x=Ku("blur");return x.fragmentNode=a5({...m,latitudinal:a.equal(1)}),au.set(x,m),x}function b5(n,e,t){const s=Re(),r=me(0),i=me(0),o=$(1/e),a=$(1/t),l=$(n),c={envMap:s,roughness:r,mipInt:i,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:l},u=Ku("ggx");return u.fragmentNode=d5({...c,N_immutable:qu,GGX_SAMPLES:it(h5)}),au.set(u,c),u}function oy(n){const e=Ku("cubemap");return e.fragmentNode=Oa(n,qu),e}function ay(n){const e=Ku("equirect");return e.fragmentNode=Re(n,ow(qu),0),e}const ly=new WeakMap;function v5(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function _5(n,e,t){const s=T5(e);let r=s.get(n);if((r!==void 0?r.pmremVersion:-1)!==n.pmremVersion){const o=n.image;if(n.isCubeTexture)if(N5(o))r=t.fromCubemap(n,r);else return null;else if(S5(o))r=t.fromEquirectangular(n,r);else return null;r.pmremVersion=n.pmremVersion,s.set(n,r)}return r.texture}function T5(n){let e=ly.get(n);return e===void 0&&(e=new WeakMap,ly.set(n,e)),e}class w5 extends _t{static get type(){return"PMREMNode"}constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null;const r=new Xp;r.isRenderTargetTexture=!0,this._texture=Re(r),this._width=me(0),this._height=me(0),this._maxMip=me(0),this.updateBeforeType=we.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=v5(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const s=t?t.pmremVersion:-1,r=this._value;s!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=_5(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new g5(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=VT.mul(K(t.x,t.y.negate(),t.z));let s=this.levelNode;return s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),o5(this._texture,t,s,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function N5(n){if(n==null)return!1;let e=0;const t=6;for(let s=0;s<t;s++)n[s]!==void 0&&e++;return e===t}function S5(n){return n==null?!1:n.height>0}const yw=Ie(w5).setParameterLength(1,3),cy=new WeakMap;class E5 extends bo{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const d=s.isTextureNode?s.value:t[s.property];let h=cy.get(d);h===void 0&&(h=yw(d),cy.set(d,h)),s=h}const i=t.useAnisotropy===!0||t.anisotropy>0?ZL:Fe,o=s.context(uy(ws,i)).mul(Od),a=s.context(A5(yo)).mul(Math.PI).mul(Od),l=ya(o),c=ya(a);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(c);const u=e.context.lightingModel.clearcoatRadiance;if(u){const d=s.context(uy(su,Ri)).mul(Od),h=ya(d);u.addAssign(h)}}}const uy=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Qe.negate().reflect(e),t=vT(n).mix(t,e).normalize(),t=t.transformDirection(js)),t),getTextureLevel:()=>n}},A5=n=>({getUV:()=>n,getTextureLevel:()=>$(1)}),C5=new AA;class bw extends ut{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(C5),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new E5(t):null}setupLightingModel(){return new xw}setupSpecular(){const e=We(K(.04),Me.rgb,nu);An.assign(e),ru.assign(1)}setupVariants(){const e=this.metalnessNode?$(this.metalnessNode):dF;nu.assign(e);let t=this.roughnessNode?$(this.roughnessNode):uF;t=hw({roughness:t}),ws.assign(t),this.setupSpecular(),Me.assign(Te(Me.rgb.mul(e.oneMinus()),Me.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const R5=new CA;class M5 extends bw{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(R5),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?$(this.iorNode):SF;bc.assign(e),An.assign(We(Ji(bT(bc.sub(1).div(bc.add(1))).mul(cF),K(1)).mul(Ox),Me.rgb,nu)),ru.assign(We(Ox,1,nu))}setupLightingModel(){return new xw(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?$(this.clearcoatNode):fF,s=this.clearcoatRoughnessNode?$(this.clearcoatRoughnessNode):pF;Ff.assign(t),su.assign(hw({roughness:s}))}if(this.useSheen){const t=this.sheenNode?K(this.sheenNode):xF,s=this.sheenRoughnessNode?$(this.sheenRoughnessNode):yF;Ci.assign(t),wm.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?$(this.iridescenceNode):vF,s=this.iridescenceIORNode?$(this.iridescenceIORNode):_F,r=this.iridescenceThicknessNode?$(this.iridescenceThicknessNode):TF;Nm.assign(t),tT.assign(s),nT.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?ne(this.anisotropyNode):bF).toVar();Rr.assign(t.length()),Ke(Rr.equal(0),()=>{t.assign(ne(1,0))}).Else(()=>{t.divAssign(ne(Rr)),Rr.assign(Rr.saturate())}),Of.assign(Rr.pow2().mix(ws.pow2(),1)),yc.assign(sa[0].mul(t.x).add(sa[1].mul(t.y))),Vi.assign(sa[1].mul(t.x).sub(sa[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?$(this.transmissionNode):wF,s=this.thicknessNode?$(this.thicknessNode):NF,r=this.attenuationDistanceNode?$(this.attenuationDistanceNode):EF,i=this.attenuationColorNode?K(this.attenuationColorNode):AF;if(Uf.assign(t),sT.assign(s),rT.assign(r),iT.assign(i),this.useDispersion){const o=this.dispersionNode?$(this.dispersionNode):DF;oT.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?K(this.clearcoatNormalNode):mF}setup(e){e.context.setupClearcoatNormal=()=>xa(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const P5=Y(({normal:n,lightDirection:e,builder:t})=>{const s=n.dot(e),r=ne(s.mul(.5).add(.5),0);if(t.material.gradientMap){const i=Xs("gradientMap","texture").context({getUV:()=>r});return K(i.r)}else{const i=r.fwidth().mul(.5);return We(K(.7),K(1),Is($(.7).sub(i.x),$(.7).add(i.x),r.x))}});class k5 extends Hu{direct({lightDirection:e,lightColor:t,reflectedLight:s},r){const i=P5({normal:jT,lightDirection:e,builder:r}).mul(t);s.directDiffuse.addAssign(i.mul(so({diffuseColor:Me.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:s,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(s.mul(so({diffuseColor:Me}))),r.indirectDiffuse.mulAssign(t)}}const D5=new RA;class I5 extends ut{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(D5),this.setValues(e)}setupLightingModel(){return new k5}}const B5=Y(()=>{const n=K(Qe.z,0,Qe.x.negate()).normalize(),e=Qe.cross(n);return ne(n.dot(Fe),e.dot(Fe)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),L5=new PA;class F5 extends ut{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(L5),this.setValues(e)}setupVariants(e){const t=B5;let s;e.material.matcap?s=Xs("matcap","texture").context({getUV:()=>t}):s=K(We(.2,.8,t.y)),Me.rgb.mulAssign(s.rgb)}}class O5 extends _t{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:s}=this;if(this.getNodeType(e)==="vec2"){const i=t.cos(),o=t.sin();return Tm(i,o,o.negate(),i).mul(s)}else{const i=t,o=Ui(Te(1,0,0,0),Te(0,bs(i.x),dn(i.x).negate(),0),Te(0,dn(i.x),bs(i.x),0),Te(0,0,0,1)),a=Ui(Te(bs(i.y),0,dn(i.y),0),Te(0,1,0,0),Te(dn(i.y).negate(),0,bs(i.y),0),Te(0,0,0,1)),l=Ui(Te(bs(i.z),dn(i.z).negate(),0,0),Te(dn(i.z),bs(i.z),0,0),Te(0,0,1,0),Te(0,0,0,1));return o.mul(a).mul(l).mul(Te(s,1)).xyz}}}const vw=Ie(O5).setParameterLength(2),j5=new IA;class _w extends ut{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(j5),this.setValues(e)}setupPositionView(e){const{object:t,camera:s}=e,{positionNode:r,rotationNode:i,scaleNode:o,sizeAttenuation:a}=this,l=$u.mul(K(r||0));let c=ne(ti[0].xyz.length(),ti[1].xyz.length());o!==null&&(c=c.mul(ne(o))),s.isPerspectiveCamera&&a===!1&&(c=c.mul(l.z.negate()));let u=zu.xy;if(t.center&&t.center.isVector2===!0){const p=XB("center","vec2",t);u=u.sub(p.sub(.5))}u=u.mul(c);const d=$(i||gF),h=vw(u,d);return Te(l.xy.add(h),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const U5=new DA,V5=new Se;class G5 extends _w{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(U5),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return $u.mul(K(e||Dt)).xyz}setupVertexSprite(e){const{material:t,camera:s}=e,{rotationNode:r,scaleNode:i,sizeNode:o,sizeAttenuation:a}=this;let l=super.setupVertex(e);if(t.isNodeMaterial!==!0)return l;let c=o!==null?ne(o):kF;c=c.mul(SL),s.isPerspectiveCamera&&a===!0&&(c=c.mul($5.div(ct.z.negate()))),i&&i.isNode&&(c=c.mul(ne(i)));let u=zu.xy;if(r&&r.isNode){const d=$(r);u=vw(u,d)}return u=u.mul(c),u=u.div(EL.div(2)),u=u.mul(l.w),l=l.add(Te(u,0,0)),l}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const $5=me(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(V5);this.value=.5*e.y});class z5 extends Hu{constructor(){super(),this.shadowNode=$(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Me.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Me.rgb)}}const H5=new BA;class W5 extends ut{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(H5),this.setValues(e)}setupLightingModel(){return new z5}}rr("vec3");rr("vec3");rr("vec3");class q5{constructor(e,t,s){this.renderer=e,this.nodes=t,this.info=s,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,s)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,s),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Fn{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let s=0;s<e.length-1;s++)if(t=t.get(e[s]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let s=this.weakMap;for(let r=0;r<e.length-1;r++){const i=e[r];s.has(i)===!1&&s.set(i,new WeakMap),s=s.get(i)}return s.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let s=0;s<e.length-1;s++)if(t=t.get(e[s]),t===void 0)return!1;return t.delete(e[e.length-1])}}let K5=0;function X5(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const s=Object.getOwnPropertyDescriptors(t);for(const r in s)if(s[r]!==void 0){const i=s[r];i&&typeof i.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class Y5{constructor(e,t,s,r,i,o,a,l,c,u){this.id=K5++,this._nodes=e,this._geometries=t,this.renderer=s,this.object=r,this.material=i,this.scene=o,this.camera=a,this.lightsNode=l,this.context=c,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=u!==null?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,s=[],r=new Set,i={};for(const o of e){let a;if(o.node&&o.node.attribute?a=o.node.attribute:(a=t.getAttribute(o.name),i[o.name]=a.version),a===void 0)continue;s.push(a);const l=a.isInterleavedBufferAttribute?a.data:a;r.add(l)}return this.attributes=s,this.attributesId=i,this.vertexBuffers=Array.from(r.values()),s}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:s,group:r,drawRange:i}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),l=a!==null;let c=1;if(s.isInstancedBufferGeometry===!0?c=s.instanceCount:e.count!==void 0&&(c=Math.max(0,e.count)),c===0)return null;if(o.instanceCount=c,e.isBatchedMesh===!0)return o;let u=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(u=2);let d=i.start*u,h=(i.start+i.count)*u;r!==null&&(d=Math.max(d,r.start*u),h=Math.min(h,(r.start+r.count)*u));const p=s.attributes.position;let m=1/0;l?m=a.count:p!=null&&(m=p.count),d=Math.max(d,0),h=Math.min(h,m);const x=h-d;return x<0||x===1/0?null:(o.vertexCount=x,o.firstVertex=d,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const s of Object.keys(e.attributes).sort()){const r=e.attributes[s];t+=s+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const s of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[s];t+="morph-"+s+",";for(let i=0,o=r.length;i<o;i++){const a=r[i];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:s}=this;let r=t.customProgramCacheKey();for(const i of X5(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const o=t[i];let a;if(o!==null){const l=typeof o;l==="number"?a=o!==0?"1":"0":l==="object"?(a="{",o.isTexture&&(a+=o.mapping,s.backend.isWebGPUBackend===!0&&(a+=o.magFilter,a+=o.minFilter,a+=o.wrapS,a+=o.wrapT,a+=o.wrapR)),a+="}"):a=String(o)}else a=String(o);r+=a+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(r+=e.uuid+","),r+=e.receiveShadow+",",Fu(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const s=this.geometry.getAttribute(t);if(s===void 0||e[t]!==s.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=pa(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=pa(e,1)),e=pa(e,this.camera.id),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Nr=[];class Q5{constructor(e,t,s,r,i,o){this.renderer=e,this.nodes=t,this.geometries=s,this.pipelines=r,this.bindings=i,this.info=o,this.chainMaps={}}get(e,t,s,r,i,o,a,l){const c=this.getChainMap(l);Nr[0]=e,Nr[1]=t,Nr[2]=o,Nr[3]=i;let u=c.get(Nr);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,s,r,i,o,a,l),c.set(Nr,u)):(u.updateClipping(a),u.needsGeometryUpdate&&u.setGeometry(e.geometry),(u.version!==t.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,t,s,r,i,o,a,l)):u.version=t.version)),Nr.length=0,u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Fn)}dispose(){this.chainMaps={}}createRenderObject(e,t,s,r,i,o,a,l,c,u,d){const h=this.getChainMap(d),p=new Y5(e,t,s,r,i,o,a,l,c,u);return p.onDispose=()=>{this.pipelines.delete(p),this.bindings.deleteForRender(p),this.nodes.delete(p),h.delete(p.getChainArray())},p}}class hr{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const pn={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Ys=16,Z5=211,J5=212;class ej extends hr{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const s=this.get(e);if(s.version===void 0)t===pn.VERTEX?this.backend.createAttribute(e):t===pn.INDEX?this.backend.createIndexAttribute(e):t===pn.STORAGE?this.backend.createStorageAttribute(e):t===pn.INDIRECT&&this.backend.createIndirectStorageAttribute(e),s.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(s.version<r.version||r.usage===Ei)&&(this.backend.updateAttribute(e),s.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Tw(n){return n.index!==null?n.index.version:n.attributes.position.version}function dy(n){const e=[],t=n.index,s=n.attributes.position;if(t!==null){const i=t.array;for(let o=0,a=i.length;o<a;o+=3){const l=i[o+0],c=i[o+1],u=i[o+2];e.push(l,c,c,u,u,l)}}else{const i=s.array;for(let o=0,a=i.length/3-1;o<a;o+=3){const l=o+0,c=o+1,u=o+2;e.push(l,c,c,u,u,l)}}const r=new(jA(e)?FA:OA)(e,1);return r.version=Tw(n),r}class tj extends hr{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,s=this.get(t);s.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const i=t.index,o=e.getAttributes();i!==null&&this.attributes.delete(i);for(const l of o)this.attributes.delete(l);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",r),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",r),this._geometryDisposeListeners.set(t,r)}updateAttributes(e){const t=e.getAttributes();for(const i of t)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,pn.STORAGE):this.updateAttribute(i,pn.VERTEX);const s=this.getIndex(e);s!==null&&this.updateAttribute(s,pn.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,pn.INDIRECT)}updateAttribute(e,t){const s=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,s)):this.attributeCall.get(e.data)!==s&&(this.attributes.update(e,t),this.attributeCall.set(e.data,s),this.attributeCall.set(e,s)):this.attributeCall.get(e)!==s&&(this.attributes.update(e,t),this.attributeCall.set(e,s))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:s}=e;let r=t.index;if(s.wireframe===!0){const i=this.wireframes;let o=i.get(t);o===void 0?(o=dy(t),i.set(t,o)):o.version!==Tw(t)&&(this.attributes.delete(o),o=dy(t),i.set(t,o)),r=o}return r}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class nj{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,s){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=s*(t/3):e.isPoints?this.render.points+=s*t:e.isLineSegments?this.render.lines+=s*(t/2):e.isLine?this.render.lines+=s*(t-1):re("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class ww{constructor(e){this.cacheKey=e,this.usedTimes=0}}class sj extends ww{constructor(e,t,s){super(e),this.vertexProgram=t,this.fragmentProgram=s}}class rj extends ww{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let ij=0;class Qd{constructor(e,t,s,r=null,i=null){this.id=ij++,this.code=e,this.stage=t,this.name=s,this.transforms=r,this.attributes=i,this.usedTimes=0}}class oj extends hr{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:s}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(i&&i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram),a=new Qd(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),s.createProgram(a));const l=this._getComputeCacheKey(e,a);let c=this.caches.get(l);c===void 0&&(i&&i.usedTimes===0&&this._releasePipeline(i),c=this._getComputePipeline(e,a,l,t)),c.usedTimes++,a.usedTimes++,r.version=e.version,r.pipeline=c}return r.pipeline}getForRender(e,t=null){const{backend:s}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let l=this.programs.vertex.get(o.vertexShader);l===void 0&&(i&&i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),l=new Qd(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,l),s.createProgram(l));let c=this.programs.fragment.get(o.fragmentShader);c===void 0&&(i&&i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram),c=new Qd(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,c),s.createProgram(c));const u=this._getRenderCacheKey(e,l,c);let d=this.caches.get(u);d===void 0?(i&&i.usedTimes===0&&this._releasePipeline(i),d=this._getRenderPipeline(e,l,c,u,t)):e.pipeline=d,d.usedTimes++,l.usedTimes++,c.usedTimes++,r.pipeline=d}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,s,r){s=s||this._getComputeCacheKey(e,t);let i=this.caches.get(s);return i===void 0&&(i=new rj(s,t),this.caches.set(s,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(e,t,s,r,i){r=r||this._getRenderCacheKey(e,t,s);let o=this.caches.get(r);return o===void 0&&(o=new sj(r,t,s),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,i)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,s){return t.id+","+s.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,s=e.stage;this.programs[s].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class aj extends hr{constructor(e,t,s,r,i,o){super(),this.backend=e,this.textures=s,this.pipelines=i,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const s of t){const r=this.get(s);r.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,t,0),r.bindGroup=s)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const s of t){const r=this.get(s);r.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,t,0),r.bindGroup=s)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const s of t)this.delete(s)}deleteForRender(e){const t=e.getBindings();for(const s of t)this.delete(s)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const s=t.attribute,r=s.isIndirectStorageBufferAttribute?pn.INDIRECT:pn.STORAGE;this.attributes.update(s,r)}}_update(e,t){const{backend:s}=this;let r=!1,i=!0,o=0,a=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isStorageBuffer){const c=l.attribute,u=c.isIndirectStorageBufferAttribute?pn.INDIRECT:pn.STORAGE;this.attributes.update(c,u)}if(l.isUniformBuffer)l.update()&&s.updateBinding(l);else if(l.isSampledTexture){const c=l.update(),u=l.texture,d=this.textures.get(u);if(c&&(this.textures.updateTexture(u),l.generation!==d.generation&&(l.generation=d.generation,r=!0,i=!1)),s.get(u).externalTexture!==void 0||d.isDefaultTexture?i=!1:(o=o*10+u.id,a+=u.version),u.isStorageTexture===!0&&u.mipmapsAutoUpdate===!0){const p=this.get(u);l.store===!0?p.needsMipmap=!0:this.textures.needsMipmaps(u)&&p.needsMipmap===!0&&(this.backend.generateMipmaps(u),p.needsMipmap=!1)}}else if(l.isSampler&&l.update()){const u=this.textures.updateSampler(l.texture);l.samplerKey!==u&&(l.samplerKey=u,r=!0,i=!1)}}r===!0&&this.backend.updateBindings(e,t,i?o:0,a)}}function lj(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function hy(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function fy(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===zr&&n.forceSinglePass===!1}class cj{constructor(e,t,s){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,s),this.lightsArray=[],this.scene=t,this.camera=s,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,s,r,i,o,a){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:s,groupOrder:r,renderOrder:e.renderOrder,z:i,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=s,l.groupOrder=r,l.renderOrder=e.renderOrder,l.z=i,l.group=o,l.clippingContext=a),this.renderItemsIndex++,l}push(e,t,s,r,i,o,a){const l=this.getNextRenderItem(e,t,s,r,i,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,s.transparent===!0||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode?(fy(s)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,s,r,i,o,a){const l=this.getNextRenderItem(e,t,s,r,i,o,a);s.transparent===!0||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode?(fy(s)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||lj),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||hy),this.transparent.length>1&&this.transparent.sort(t||hy)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const s=this.renderItems[e];if(s.id===null)break;s.id=null,s.object=null,s.geometry=null,s.material=null,s.groupOrder=null,s.renderOrder=null,s.z=null,s.group=null,s.clippingContext=null}}}const Oo=[];class uj{constructor(e){this.lighting=e,this.lists=new Fn}get(e,t){const s=this.lists;Oo[0]=e,Oo[1]=t;let r=s.get(Oo);return r===void 0&&(r=new cj(this.lighting,e,t),s.set(Oo,r)),Oo.length=0,r}dispose(){this.lists=new Fn}}let dj=0;class hj{constructor(){this.id=dj++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new et,this.scissor=!1,this.scissorValue=new et,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return Nw(this)}}function Nw(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:s}=n,r=[t,s];for(const i of e)r.push(i.id);return nl(r)}const jo=[],fj=new Nu,pj=new xA;class mj{constructor(){this.chainMaps={}}get(e,t,s=null){jo[0]=e,jo[1]=t;let r;if(s===null)r="default";else{const a=s.texture.format;r=`${s.textures.length}:${a}:${s.samples}:${s.depthBuffer}:${s.stencilBuffer}`}const i=this._getChainMap(r);let o=i.get(jo);return o===void 0&&(o=new hj,i.set(jo,o)),jo.length=0,s!==null&&(o.sampleCount=s.samples===0?1:s.samples),o}getForClear(e=null){return this.get(fj,pj,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Fn)}dispose(){this.chainMaps={}}}const gj=new ue;class xj extends hr{constructor(e,t,s){super(),this.renderer=e,this.backend=t,this.info=s}updateRenderTarget(e,t=0){const s=this.get(e),r=e.samples===0?1:e.samples,i=s.depthTextureMips||(s.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),l=a.width>>t,c=a.height>>t;let u=e.depthTexture||i[t];const d=e.depthBuffer===!0||e.stencilBuffer===!0;let h=!1;u===void 0&&d&&(u=new Zn,u.format=e.stencilBuffer?tr:nr,u.type=e.stencilBuffer?er:mt,u.image.width=l,u.image.height=c,u.image.depth=a.depth,u.renderTarget=e,u.isArrayTexture=e.multiview===!0&&a.depth>1,i[t]=u),(s.width!==a.width||a.height!==s.height)&&(h=!0,u&&(u.needsUpdate=!0,u.image.width=l,u.image.height=c,u.image.depth=u.isArrayTexture?u.image.depth:1)),s.width=a.width,s.height=a.height,s.textures=o,s.depthTexture=u||null,s.depth=e.depthBuffer,s.stencil=e.stencilBuffer,s.renderTarget=e,s.sampleCount!==r&&(h=!0,u&&(u.needsUpdate=!0),s.sampleCount=r);const p={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let m=0;m<o.length;m++){const x=o[m];h&&(x.needsUpdate=!0),this.updateTexture(x,p)}u&&this.updateTexture(u,p)}s.initialized!==!0&&(s.initialized=!0,s.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",s.onDispose))}updateTexture(e,t={}){const s=this.get(e);if(s.initialized===!0&&s.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(r&&s.initialized===!0&&i.destroyTexture(e),e.isFramebufferTexture){const c=this.renderer.getRenderTarget();c?e.type=c.texture.type:e.type=on}const{width:o,height:a,depth:l}=this.getSize(e);if(t.width=o,t.height=a,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||e.isStorageTexture===!0||e.isExternalTexture===!0)i.createTexture(e,t),s.generation=e.version;else if(e.version>0){const c=e.image;if(c===void 0)ie("Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)ie("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const d=[];for(const h of e.images)d.push(h);t.images=d}else t.image=c;(s.isDefaultTexture===void 0||s.isDefaultTexture===!0)&&(i.createTexture(e,t),s.isDefaultTexture=!1,s.generation=e.version),e.source.dataReady===!0&&i.updateTexture(e,t);const u=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!u&&i.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else i.createDefaultTexture(e),s.isDefaultTexture=!0,s.generation=e.version;s.initialized!==!0&&(s.initialized=!0,s.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&pt.getTransfer(e.colorSpace)!==_e&&ie("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),s.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",s.onDispose)),s.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=gj){let s=e.images?e.images[0]:e.image;return s?(s.image!==void 0&&(s=s.image),typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement?(t.width=s.videoWidth||1,t.height=s.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&s instanceof VideoFrame?(t.width=s.displayWidth||1,t.height=s.displayHeight||1,t.depth=1):(t.width=s.width||1,t.height=s.height||1,t.depth=e.isCubeTexture?6:s.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,s){let r;return e.mipmaps.length>0?r=e.mipmaps.length:e.isCompressedTexture===!0?r=1:r=Math.floor(Math.log2(Math.max(t,s)))+1,r}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),s=t.textures,r=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let i=0;i<s.length;i++)this._destroyTexture(s[i]);r&&this._destroyTexture(r),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const s=t.isDefaultTexture;this.backend.destroyTexture(e,s),this.delete(e),this.info.memory.textures--}}}class Fm extends _n{constructor(e,t,s,r=1){super(e,t,s),this.a=r}set(e,t,s,r=1){return this.a=r,super.set(e,t,s)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class yj extends Oe{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const s=this.getNodeType(e),r=e.getStructTypeNode(s);let i;return r!==null?i=r.getMemberType(e,t):(re(`TSL: Member "${t}" not found in struct "${s}".`),i="float"),i}getHash(){return this.uuid}generate(){return this.name}}class bj extends le{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e){return e.isNode!==!0?(re("TSL: Invalid node added to stack."),this):(this.nodes.push(e),this)}If(e,t){const s=new na(t);return this._currentCond=Ct(e,s),this.addToStack(this._currentCond)}ElseIf(e,t){const s=new na(t),r=Ct(e,s);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new na(e),this}Switch(e){return this._expressionNode=J(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(J(e[a])));else re("TSL: Invalid parameter length. Case() requires at least two parameters.");const s=e[e.length-1],r=new na(s);let i=t[0];for(let a=1;a<t.length;a++)i=i.or(t[a]);const o=Ct(i,r);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let s=0;for(const r of this.getChildren())r.isVarNode&&r.intent===!0&&r.isAssign(e)!==!0||(t["node"+s++]=r);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const s=J1();eu(this),e.setActiveStack(this);const r=e.buildStage;for(const o of this.nodes)if(!(o.isVarNode&&o.intent===!0&&o.isAssign(e)!==!0)){if(r==="setup")o.build(e);else if(r==="analyze")o.build(e,this);else if(r==="generate"){const a=e.getDataFromNode(o,"any").stages,l=a&&a[e.shaderStage];if(o.isVarNode&&l&&l.length===1&&l[0]&&l[0].isStackNode)continue;o.build(e,"void")}}let i;return this.hasOutput?i=this.outputNode.build(e,...t):i=super.build(e,...t),eu(s),e.removeActiveStack(this),i}}const Zd=Ie(bj).setParameterLength(0,1);new wu;new ue;new ue;new ue;new On;new ue(0,0,-1);new et;new ue;new ue;new et;new Se;const vj=new fo;Gi.flipX();vj.depthTexture=new Zn(1,1);const Jd=new Hp(-1,1,1,-1,0,1);class _j extends Za{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Fc([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Fc(t,2))}}const Tj=new _j;class Om extends Bn{constructor(e=null){super(Tj,e),this.camera=Jd,this.isQuadMesh=!0}async renderAsync(e){ft('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,Jd)}render(e){e.render(this,Jd)}}Y(([n])=>rs($(52.9829189).mul(rs(eo(n,ne(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]});class Es extends le{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Es.OBJECT?this.updateType=we.OBJECT:e===Es.MATERIAL?this.updateType=we.RENDER:e===Es.BEFORE_OBJECT?this.updateBeforeType=we.OBJECT:e===Es.BEFORE_MATERIAL&&(this.updateBeforeType=we.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Es.OBJECT="object";Es.MATERIAL="material";Es.BEFORE_OBJECT="beforeObject";Es.BEFORE_MATERIAL="beforeMaterial";const Uo=new H_,eh=new On;class Xt extends le{static get type(){return"SceneNode"}constructor(e=Xt.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let r;return t===Xt.BACKGROUND_BLURRINESS?r=Ue("backgroundBlurriness","float",s):t===Xt.BACKGROUND_INTENSITY?r=Ue("backgroundIntensity","float",s):t===Xt.BACKGROUND_ROTATION?r=me("mat4").setName("backgroundRotation").setGroup(pe).onRenderUpdate(()=>{const i=s.background;return i!==null&&i.isTexture&&i.mapping!==lC?(Uo.copy(s.backgroundRotation),Uo.x*=-1,Uo.y*=-1,Uo.z*=-1,eh.makeRotationFromEuler(Uo)):eh.identity(),eh}):re("SceneNode: Unknown scope:",t),r}}Xt.BACKGROUND_BLURRINESS="backgroundBlurriness";Xt.BACKGROUND_INTENSITY="backgroundIntensity";Xt.BACKGROUND_ROTATION="backgroundRotation";const wj=se(Xt,Xt.BACKGROUND_BLURRINESS),py=se(Xt,Xt.BACKGROUND_INTENSITY),Nj=se(Xt,Xt.BACKGROUND_ROTATION),Sj=Y(({texture:n,uv:e})=>{const s=K().toVar();return Ke(e.x.lessThan(1e-4),()=>{s.assign(K(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{s.assign(K(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{s.assign(K(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{s.assign(K(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{s.assign(K(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{s.assign(K(0,0,-1))}).Else(()=>{const i=n.sample(e.add(K(-.01,0,0))).r.sub(n.sample(e.add(K(.01,0,0))).r),o=n.sample(e.add(K(0,-.01,0))).r.sub(n.sample(e.add(K(0,.01,0))).r),a=n.sample(e.add(K(0,0,-.01))).r.sub(n.sample(e.add(K(0,0,.01))).r);s.assign(K(i,o,a))}),s.normalize()});class Ej extends xo{static get type(){return"Texture3DNode"}constructor(e,t=null,s=null){super(e,t,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return K(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(ze(Xr(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return Sj({texture:this,uv:e})}}const Aj=Ie(Ej).setParameterLength(1,3),Fl=new Se;class Cj extends xo{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class my extends Cj{static get type(){return"PassMultipleTextureNode"}constructor(e,t,s=!1){super(e,null),this.textureName=t,this.previousTexture=s}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Xu extends _t{static get type(){return"PassNode"}constructor(e,t,s,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new Zn;i.isRenderTargetTexture=!0,i.name="depth";const o=new fo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Vt,...r});o.texture.name="output",o.depthTexture=i,this.renderTarget=o,this._textures={output:o.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=me(0),this._cameraFar=me(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=we.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return ie("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return ie("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const s=this._textures[e],r=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=s,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=J(new my(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=J(new my(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const s=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=nw(this.getTextureNode(e),s,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const s=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=ba(i,s,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),s=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(s)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getColorBufferType(),this.scope===Xu.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s}=this;let r,i;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),Fl.set(o.width,o.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize(Fl)),this._pixelRatio=i,this.setSize(Fl.width,Fl.height);const a=t.getRenderTarget(),l=t.getMRT(),c=t.autoClear,u=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const h in this._previousTextures)this.toggleTexture(h);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0;const d=s.name;s.name=this.name?this.name:s.name,t.render(s,r),s.name=d,t.setRenderTarget(a),t.setMRT(l),t.autoClear=c,r.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const s=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(s,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,s,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new et),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,s,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,s,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new et),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,s,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Xu.COLOR="color";Xu.DEPTH="depth";const Rj=Y(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Mj=Y(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Pj=Y(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),s=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),kj=Y(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Dj=Y(([n,e])=>{const t=$t(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=$t(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=kj(n),n=s.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Ij=$t(K(1.6605,-.1246,-.0182),K(-.5876,1.1329,-.1006),K(-.0728,-.0083,1.1187)),Bj=$t(K(.6274,.0691,.0164),K(.3293,.9195,.088),K(.0433,.0113,.8956)),Lj=Y(([n])=>{const e=K(n).toVar(),t=K(e.mul(e)).toVar(),s=K(t.mul(t)).toVar();return $(15.5).mul(s.mul(t)).sub(Ne(40.14,s.mul(e))).add(Ne(31.96,s).sub(Ne(6.868,t.mul(e))).add(Ne(.4298,t).add(Ne(.1191,e).sub(.00232))))}),Fj=Y(([n,e])=>{const t=K(n).toVar(),s=$t(K(.856627153315983,.137318972929847,.11189821299995),K(.0951212405381588,.761241990602591,.0767994186031903),K(.0482516061458583,.101439036467562,.811302368396859)),r=$t(K(1.1271005818144368,-.1413297634984383,-.14132976349843826),K(-.11060664309660323,1.157823702216272,-.11060664309660294),K(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=$(-12.47393),o=$(4.026069);return t.mulAssign(e),t.assign(Bj.mul(t)),t.assign(s.mul(t)),t.assign(vt(t,1e-10)),t.assign(Rs(t)),t.assign(t.sub(i).div(o.sub(i))),t.assign(Ds(t,0,1)),t.assign(Lj(t)),t.assign(r.mul(t)),t.assign(Uu(vt(K(0),t),K(2.2))),t.assign(Ij.mul(t)),t.assign(Ds(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Oj=Y(([n,e])=>{const t=$(.76),s=$(.15);n=n.mul(e);const r=Ji(n.r,Ji(n.g,n.b)),i=Ct(r.lessThan(.08),r.sub(Ne(6.25,r.mul(r))),.04);n.subAssign(i);const o=vt(n.r,vt(n.g,n.b));Ke(o.lessThan(t),()=>n);const a=jt(1,t),l=jt(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(l.div(o));const c=jt(1,ss(1,s.mul(o.sub(l)).add(1)));return We(n,K(l),c)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class St extends le{static get type(){return"CodeNode"}constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=s}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class jj extends St{static get type(){return"FunctionNode"}constructor(e="",t=[],s=""){super(e,t,s)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const s=this.getNodeType(e);return e.getStructTypeNode(s).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),r=s.name,i=s.type,o=e.getCodeFromNode(this,i);r!==""&&(o.name=r);const a=e.getPropertyName(o),l=this.getNodeFunction(e).getCode(a);return o.code=l+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}function Sw(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||ct.z).negate()}const Uj=Y(([n,e],t)=>{const s=Sw(t);return Is(n,e,s)}),Vj=Y(([n],e)=>{const t=Sw(e);return n.mul(n,t,t).negate().exp().oneMinus()}),gy=Y(([n,e])=>Te(e.toFloat().mix(ga.rgb,n.toVec3()),ga.a));class Gj extends le{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:s}=e;s.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Ie(Gj);class ls extends le{static get type(){return"AtomicFunctionNode"}constructor(e,t,s){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=s,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),s=t.parents,r=this.method,i=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,l=this.valueNode,c=[];c.push(`&${a.build(e,o)}`),l!==null&&c.push(l.build(e,o));const u=`${e.getMethod(r,i)}( ${c.join(", ")} )`;if(s?s.length===1&&s[0].isStackNode===!0:!1)e.addLineFlowCode(u,this);else return t.constNode===void 0&&(t.constNode=to(u,i).toConst()),t.constNode.build(e)}}ls.ATOMIC_LOAD="atomicLoad";ls.ATOMIC_STORE="atomicStore";ls.ATOMIC_ADD="atomicAdd";ls.ATOMIC_SUB="atomicSub";ls.ATOMIC_MAX="atomicMax";ls.ATOMIC_MIN="atomicMin";ls.ATOMIC_AND="atomicAnd";ls.ATOMIC_OR="atomicOr";ls.ATOMIC_XOR="atomicXor";Ie(ls);class De extends _t{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,s=null){super(),this.method=e,this.aNode=t,this.bNode=s}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,s=this.bNode?this.bNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),i=e.isMatrix(s)?0:e.getTypeLength(s);return r>i?t:s}getNodeType(e){const t=this.method;return t===De.SUBGROUP_ELECT?"bool":t===De.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const s=this.method,r=this.getNodeType(e),i=this.getInputType(e),o=this.aNode,a=this.bNode,l=[];if(s===De.SUBGROUP_BROADCAST||s===De.SUBGROUP_SHUFFLE||s===De.QUAD_BROADCAST){const u=a.getNodeType(e);l.push(o.build(e,r),a.build(e,u==="float"?"int":r))}else s===De.SUBGROUP_SHUFFLE_XOR||s===De.SUBGROUP_SHUFFLE_DOWN||s===De.SUBGROUP_SHUFFLE_UP?l.push(o.build(e,r),a.build(e,"uint")):(o!==null&&l.push(o.build(e,i)),a!==null&&l.push(a.build(e,i)));const c=l.length===0?"()":`( ${l.join(", ")} )`;return e.format(`${e.getMethod(s,r)}${c}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}De.SUBGROUP_ELECT="subgroupElect";De.SUBGROUP_BALLOT="subgroupBallot";De.SUBGROUP_ADD="subgroupAdd";De.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";De.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";De.SUBGROUP_MUL="subgroupMul";De.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";De.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";De.SUBGROUP_AND="subgroupAnd";De.SUBGROUP_OR="subgroupOr";De.SUBGROUP_XOR="subgroupXor";De.SUBGROUP_MIN="subgroupMin";De.SUBGROUP_MAX="subgroupMax";De.SUBGROUP_ALL="subgroupAll";De.SUBGROUP_ANY="subgroupAny";De.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";De.QUAD_SWAP_X="quadSwapX";De.QUAD_SWAP_Y="quadSwapY";De.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";De.SUBGROUP_BROADCAST="subgroupBroadcast";De.SUBGROUP_SHUFFLE="subgroupShuffle";De.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";De.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";De.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";De.QUAD_BROADCAST="quadBroadcast";let Ol;function Yu(n){Ol=Ol||new WeakMap;let e=Ol.get(n);return e===void 0&&Ol.set(n,e={}),e}function jm(n){const e=Yu(n);return e.shadowMatrix||(e.shadowMatrix=me("mat4").setGroup(pe).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function $j(n,e=no){const t=jm(n).mul(e);return t.xyz.div(t.w)}function Ew(n){const e=Yu(n);return e.position||(e.position=me(new ue).setGroup(pe).onRenderUpdate((t,s)=>s.value.setFromMatrixPosition(n.matrixWorld)))}function zj(n){const e=Yu(n);return e.targetPosition||(e.targetPosition=me(new ue).setGroup(pe).onRenderUpdate((t,s)=>s.value.setFromMatrixPosition(n.target.matrixWorld)))}function Aw(n){const e=Yu(n);return e.viewPosition||(e.viewPosition=me(new ue).setGroup(pe).onRenderUpdate(({camera:t},s)=>{s.value=s.value||new ue,s.value.setFromMatrixPosition(n.matrixWorld),s.value.applyMatrix4(t.matrixWorldInverse)}))}const Cw=n=>js.transformDirection(Ew(n).sub(zj(n))),Hj=n=>n.sort((e,t)=>e.id-t.id),Wj=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},th=new WeakMap,Vo=[];class Rw extends le{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=rr("vec3","totalDiffuse"),this.totalSpecularNode=rr("vec3","totalSpecular"),this.outgoingLightNode=rr("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let s=0;s<e.length;s++){const r=e[s];if(Vo.push(r.id),Vo.push(r.castShadow?1:0),r.isSpotLight===!0){const i=r.map!==null?r.map.id:-1,o=r.colorNode?r.colorNode.getCacheKey():-1;Vo.push(i,o)}}const t=nl(Vo);return Vo.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const s of this._lightNodes)t.push(s.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const s of t.nodes)s.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],s=this._lightNodes,r=Hj(this._lights),i=e.renderer.library;for(const o of r)if(o.isNode)t.push(J(o));else{let a=null;if(s!==null&&(a=Wj(o.id,s)),a===null){const l=i.getLightNodeClass(o.constructor);if(l===null){ie(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let c=null;th.has(o)?c=th.get(o):(c=J(new l(o)),th.set(o,c)),t.push(c)}}this._lightNodes=t}setupDirectLight(e,t,s){const{lightingModel:r,reflectedLight:i}=e.context;r.direct({...s,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,s){const{lightingModel:r,reflectedLight:i}=e.context;r.directRectArea({...s,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(const s of t)s.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let s=this.outgoingLightNode;const r=e.context,i=r.lightingModel,o=e.getNodeProperties(this);if(i){const{totalDiffuseNode:a,totalSpecularNode:l}=this;r.outgoingLight=s;const c=e.addStack();o.nodes=c.nodes,i.start(e);const{backdrop:u,backdropAlpha:d}=r,{directDiffuse:h,directSpecular:p,indirectDiffuse:m,indirectSpecular:x}=r.reflectedLight;let y=h.add(m);u!==null&&(d!==null?y=K(d.mix(y,u)):y=K(u)),a.assign(y),l.assign(p.add(x)),s.assign(a.add(l)),i.finish(e),s=s.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,s}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class qj extends le{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=we.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){Mw.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||no)}}const Mw=rr("vec3","shadowPositionWorld");function Kj(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new _n),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function Xj(n,e){return e=Kj(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function Yj(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function Qj(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function Zj(n,e){return e=Qj(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function Jj(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function e4(n,e,t){return t=Xj(n,t),t=Zj(e,t),t}function t4(n,e,t){Yj(n,t),Jj(e,t)}const xy=new WeakMap,n4=Y(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let s=Re(n,e.xy).setName("t_basic");return n.isArrayTexture&&(s=s.depth(t)),s.compare(e.z)}),s4=Y(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:s})=>{const r=(y,g)=>{let b=Re(n,y);return n.isArrayTexture&&(b=b.depth(s)),b.compare(g)},i=Ue("mapSize","vec2",t).setGroup(pe),o=Ue("radius","float",t).setGroup(pe),a=ne(1).div(i),l=a.x.negate().mul(o),c=a.y.negate().mul(o),u=a.x.mul(o),d=a.y.mul(o),h=l.div(2),p=c.div(2),m=u.div(2),x=d.div(2);return Jt(r(e.xy.add(ne(l,c)),e.z),r(e.xy.add(ne(0,c)),e.z),r(e.xy.add(ne(u,c)),e.z),r(e.xy.add(ne(h,p)),e.z),r(e.xy.add(ne(0,p)),e.z),r(e.xy.add(ne(m,p)),e.z),r(e.xy.add(ne(l,0)),e.z),r(e.xy.add(ne(h,0)),e.z),r(e.xy,e.z),r(e.xy.add(ne(m,0)),e.z),r(e.xy.add(ne(u,0)),e.z),r(e.xy.add(ne(h,x)),e.z),r(e.xy.add(ne(0,x)),e.z),r(e.xy.add(ne(m,x)),e.z),r(e.xy.add(ne(l,d)),e.z),r(e.xy.add(ne(0,d)),e.z),r(e.xy.add(ne(u,d)),e.z)).mul(1/17)}),r4=Y(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:s})=>{const r=(d,h)=>{let p=Re(n,d);return n.isArrayTexture&&(p=p.depth(s)),p.compare(h)},i=Ue("mapSize","vec2",t).setGroup(pe),o=ne(1).div(i),a=o.x,l=o.y,c=e.xy,u=rs(c.mul(i).add(.5));return c.subAssign(u.mul(o)),Jt(r(c,e.z),r(c.add(ne(a,0)),e.z),r(c.add(ne(0,l)),e.z),r(c.add(o),e.z),We(r(c.add(ne(a.negate(),0)),e.z),r(c.add(ne(a.mul(2),0)),e.z),u.x),We(r(c.add(ne(a.negate(),l)),e.z),r(c.add(ne(a.mul(2),l)),e.z),u.x),We(r(c.add(ne(0,l.negate())),e.z),r(c.add(ne(0,l.mul(2))),e.z),u.y),We(r(c.add(ne(a,l.negate())),e.z),r(c.add(ne(a,l.mul(2))),e.z),u.y),We(We(r(c.add(ne(a.negate(),l.negate())),e.z),r(c.add(ne(a.mul(2),l.negate())),e.z),u.x),We(r(c.add(ne(a.negate(),l.mul(2))),e.z),r(c.add(ne(a.mul(2),l.mul(2))),e.z),u.x),u.y)).mul(1/9)}),i4=Y(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{const s=$(1).toVar();let r=Re(n).sample(e.xy);n.isArrayTexture&&(r=r.depth(t)),r=r.rg;const i=yT(e.z,r.x);return Ke(i.notEqual($(1)),()=>{const o=e.z.sub(r.x),a=vt(0,r.y.mul(r.y));let l=a.div(a.add(o.mul(o)));l=Ds(jt(l,.3).div(.95-.3)),s.assign(Ds(vt(i,l)))}),s}),o4=Y(([n,e,t])=>{let s=no.sub(n).length();return s=s.sub(e).div(t.sub(e)),s=s.saturate(),s}),a4=n=>{const e=n.shadow.camera,t=Ue("near","float",e).setGroup(pe),s=Ue("far","float",e).setGroup(pe),r=CL(n);return o4(r,t,s)},l4=n=>{let e=xy.get(n);if(e===void 0){const t=n.isPointLight?a4(n):null;e=new ut,e.colorNode=Te(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,xy.set(n,e)}return e},yy=new Fn,gi=[],c4=(n,e,t,s)=>{gi[0]=n,gi[1]=e;let r=yy.get(gi);return(r===void 0||r.shadowType!==t||r.useVelocity!==s)&&(r=(i,o,a,l,c,u,...d)=>{(i.castShadow===!0||i.receiveShadow&&t===mc)&&(s&&(X1(i).useVelocity=!0),i.onBeforeShadow(n,i,a,e.camera,l,o.overrideMaterial,u),n.renderObject(i,o,a,l,c,u,...d),i.onAfterShadow(n,i,a,e.camera,l,o.overrideMaterial,u))},r.shadowType=t,r.useVelocity=s,yy.set(gi,r)),gi[0]=null,gi[1]=null,r},u4=Y(({samples:n,radius:e,size:t,shadowPass:s,depthLayer:r})=>{const i=$(0).toVar("meanVertical"),o=$(0).toVar("squareMeanVertical"),a=n.lessThanEqual($(1)).select($(0),$(2).div(n.sub(1))),l=n.lessThanEqual($(1)).select($(0),$(-1));fn({start:ze(0),end:ze(n),type:"int",condition:"<"},({i:u})=>{const d=l.add($(u).mul(a));let h=s.sample(Jt(Gu.xy,ne(0,d).mul(e)).div(t));s.value.isArrayTexture&&(h=h.depth(r)),h=h.x,i.addAssign(h),o.addAssign(h.mul(h))}),i.divAssign(n),o.divAssign(n);const c=Ur(o.sub(i.mul(i)));return ne(i,c)}),d4=Y(({samples:n,radius:e,size:t,shadowPass:s,depthLayer:r})=>{const i=$(0).toVar("meanHorizontal"),o=$(0).toVar("squareMeanHorizontal"),a=n.lessThanEqual($(1)).select($(0),$(2).div(n.sub(1))),l=n.lessThanEqual($(1)).select($(0),$(-1));fn({start:ze(0),end:ze(n),type:"int",condition:"<"},({i:u})=>{const d=l.add($(u).mul(a));let h=s.sample(Jt(Gu.xy,ne(d,0).mul(e)).div(t));s.value.isArrayTexture&&(h=h.depth(r)),i.addAssign(h.x),o.addAssign(Jt(h.y.mul(h.y),h.x.mul(h.x)))}),i.divAssign(n),o.divAssign(n);const c=Ur(o.sub(i.mul(i)));return ne(i,c)}),h4=[n4,s4,r4,i4];let nh;const jl=new Om;class Pw extends qj{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:s,shadowCoord:r,shadow:i,depthLayer:o}){const a=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),l=t({depthTexture:s,shadowCoord:r,shadow:i,depthLayer:o});return a.select(l,$(1))}setupShadowCoord(e,t){const{shadow:s}=this,{renderer:r}=e,i=Ue("bias","float",s).setGroup(pe);let o=t,a;if(s.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===Eu&&(a=a.mul(2).sub(1));else{const l=o.w;o=o.xy.div(l);const c=Ue("near","float",s.camera).setGroup(pe),u=Ue("far","float",s.camera).setGroup(pe);a=sw(l.negate(),c,u)}return o=K(o.x,o.y.oneMinus(),a.add(i)),o}getShadowFilterFn(e){return h4[e]}setupRenderTarget(e,t){const s=new Zn(e.mapSize.width,e.mapSize.height);s.name="ShadowDepthTexture",s.compareFunction=Yp;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=s,{shadowMap:r,depthTexture:s}}setupShadow(e){const{renderer:t,camera:s}=e,{light:r,shadow:i}=this,o=t.shadowMap.type,{depthTexture:a,shadowMap:l}=this.setupRenderTarget(i,e);if(i.camera.coordinateSystem=s.coordinateSystem,i.camera.updateProjectionMatrix(),o===mc&&i.isPointLightShadow!==!0){a.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Zs,type:Vt,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Zs,type:Vt,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Zs,type:Vt,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Zs,type:Vt,depthBuffer:!1}));let v=Re(a);a.isArrayTexture&&(v=v.depth(this.depthLayer));let _=Re(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(_=_.depth(this.depthLayer));const w=Ue("blurSamples","float",i).setGroup(pe),T=Ue("radius","float",i).setGroup(pe),E=Ue("mapSize","vec2",i).setGroup(pe);let S=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ut);S.fragmentNode=u4({samples:w,radius:T,size:E,shadowPass:v,depthLayer:this.depthLayer}).context(e.getSharedContext()),S.name="VSMVertical",S=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ut),S.fragmentNode=d4({samples:w,radius:T,size:E,shadowPass:_,depthLayer:this.depthLayer}).context(e.getSharedContext()),S.name="VSMHorizontal"}const c=Ue("intensity","float",i).setGroup(pe),u=Ue("normalBias","float",i).setGroup(pe),d=jm(r).mul(Mw.add(yo.mul(u))),h=this.setupShadowCoord(e,d),p=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(p===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const m=o===mc&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,x=this.setupShadowFilter(e,{filterFn:p,shadowTexture:l.texture,depthTexture:m,shadowCoord:h,shadow:i,depthLayer:this.depthLayer});let y=Re(l.texture,h);a.isArrayTexture&&(y=y.depth(this.depthLayer));const g=We(1,x.rgb.mix(y,1),c.mul(y.a)).toVar();this.shadowMap=l,this.shadow.map=l;const b=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return g.toInspector(`${b} / Color`,()=>Re(this.shadowMap.texture)).toInspector(`${b} / Depth`,()=>un(this.shadowMap.depthTexture,go().mul(Xr(Re(this.shadowMap.depthTexture)))).x.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Y(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let s=this._node;return this.setupShadowPosition(e),s===null&&(this._node=s=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&ie('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(s=e.material.receivedShadowNode(s)),s})()}renderShadow(e){const{shadow:t,shadowMap:s,light:r}=this,{renderer:i,scene:o}=e;t.updateMatrices(r),s.setSize(t.mapSize.width,t.mapSize.height,s.depth);const a=o.name;o.name=`Shadow Map [ ${r.name||"ID: "+r.id} ]`,i.render(o,t.camera),o.name=a}updateShadow(e){const{shadowMap:t,light:s,shadow:r}=this,{renderer:i,scene:o,camera:a}=e,l=i.shadowMap.type,c=t.depthTexture.version;this._depthVersionCached=c;const u=r.camera.layers.mask;(r.camera.layers.mask&4294967294)===0&&(r.camera.layers.mask=a.layers.mask);const d=i.getRenderObjectFunction(),h=i.getMRT(),p=h?h.has("velocity"):!1;nh=e4(i,o,nh),o.overrideMaterial=l4(s),i.setRenderObjectFunction(c4(i,r,l,p)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(d),l===mc&&r.isPointLightShadow!==!0&&this.vsmPass(i),r.camera.layers.mask=u,t4(i,o,nh)}vsmPass(e){const{shadow:t}=this,s=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,s),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,s),e.setRenderTarget(this.vsmShadowMapVertical),jl.material=this.vsmMaterialVertical,jl.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),jl.material=this.vsmMaterialHorizontal,jl.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let s=t.needsUpdate||t.autoUpdate;s&&(this._cameraFrameId[e.camera]===e.frameId&&(s=!1),this._cameraFrameId[e.camera]=e.frameId),s&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const f4=(n,e)=>J(new Pw(n,e)),p4=new _n,qn=Y(([n,e])=>{const t=n.toVar(),s=rn(t),r=ss(1,vt(s.x,vt(s.y,s.z)));s.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const i=ne(t.xy).toVar(),a=e.mul(1.5).oneMinus();return Ke(s.z.greaterThanEqual(a),()=>{Ke(t.z.greaterThan(0),()=>{i.x.assign(jt(4,t.x))})}).ElseIf(s.x.greaterThanEqual(a),()=>{const l=iu(t.x);i.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(s.y.greaterThanEqual(a),()=>{const l=iu(t.y);i.x.assign(t.x.add(l.mul(2)).add(2)),i.y.assign(t.z.mul(l).sub(2))}),ne(.125,.25).mul(i).add(ne(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),m4=Y(({depthTexture:n,bd3D:e,dp:t,texelSize:s})=>Re(n,qn(e,s.y)).compare(t)),g4=Y(({depthTexture:n,bd3D:e,dp:t,texelSize:s,shadow:r})=>{const i=Ue("radius","float",r).setGroup(pe),o=ne(-1,1).mul(i).mul(s.y);return Re(n,qn(e.add(o.xyy),s.y)).compare(t).add(Re(n,qn(e.add(o.yyy),s.y)).compare(t)).add(Re(n,qn(e.add(o.xyx),s.y)).compare(t)).add(Re(n,qn(e.add(o.yyx),s.y)).compare(t)).add(Re(n,qn(e,s.y)).compare(t)).add(Re(n,qn(e.add(o.xxy),s.y)).compare(t)).add(Re(n,qn(e.add(o.yxy),s.y)).compare(t)).add(Re(n,qn(e.add(o.xxx),s.y)).compare(t)).add(Re(n,qn(e.add(o.yxx),s.y)).compare(t)).mul(1/9)}),x4=Y(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:s})=>{const r=t.xyz.toVar(),i=r.length(),o=me("float").setGroup(pe).onRenderUpdate(()=>s.camera.near),a=me("float").setGroup(pe).onRenderUpdate(()=>s.camera.far),l=Ue("bias","float",s).setGroup(pe),c=me(s.mapSize).setGroup(pe),u=$(1).toVar();return Ke(i.sub(a).lessThanEqual(0).and(i.sub(o).greaterThanEqual(0)),()=>{const d=i.sub(o).div(a.sub(o)).toVar();d.addAssign(l);const h=r.normalize(),p=ne(1).div(c.mul(ne(4,2)));u.assign(n({depthTexture:e,bd3D:h,dp:d,texelSize:p,shadow:s}))}),u}),by=new et,xi=new Se,Go=new Se;class y4 extends Pw{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===dC?m4:g4}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:s,depthTexture:r,shadowCoord:i,shadow:o}){return x4({filterFn:t,shadowTexture:s,depthTexture:r,shadowCoord:i,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:s,light:r}=this,{renderer:i,scene:o}=e,a=t.getFrameExtents();Go.copy(t.mapSize),Go.multiply(a),s.setSize(Go.width,Go.height),xi.copy(t.mapSize);const l=i.autoClear,c=i.getClearColor(p4),u=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha),i.clear();const d=t.getViewportCount();for(let h=0;h<d;h++){const p=t.getViewport(h),m=xi.x*p.x,x=Go.y-xi.y-xi.y*p.y;by.set(m,x,xi.x*p.z,xi.y*p.w),s.viewport.copy(by),t.updateMatrices(r,h);const y=o.name;o.name=`Point Light Shadow [ ${r.name||"ID: "+r.id} ] - Face ${h+1}`,i.render(o,t.camera),o.name=y}i.autoClear=l,i.setClearColor(c,u)}}const b4=(n,e)=>J(new y4(n,e));class si extends bo{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new _n,this.colorNode=e&&e.colorNode||me(this.color).setGroup(pe),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=we.FRAME}getHash(){return this.light.uuid}getLightVector(e){return Aw(this.light).sub(e.context.positionView||ct)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return f4(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let s=this.shadowColorNode;if(s===null){const r=this.light.shadow.shadowNode;let i;r!==void 0?i=J(r):i=this.setupShadowNode(),this.shadowNode=i,this.shadowColorNode=s=this.colorNode.mul(i),this.baseColorNode=this.colorNode}this.colorNode=s}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),s=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),s&&e.lightsNode.setupDirectRectAreaLight(e,this,s)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const kw=Y(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const s=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(s.mul(n.div(e).pow4().oneMinus().clamp().pow2()),s)}),v4=({color:n,lightVector:e,cutoffDistance:t,decayExponent:s})=>{const r=e.normalize(),i=e.length(),o=kw({lightDistance:i,cutoffDistance:t,decayExponent:s}),a=n.mul(o);return{lightDirection:r,lightColor:a}};class _4 extends si{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=me(0).setGroup(pe),this.decayExponentNode=me(2).setGroup(pe)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return b4(this.light)}setupDirect(e){return v4({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Y(([n=go()],{renderer:e,material:t})=>{const s=_T(n.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.currentSamples>0){const i=$(s.fwidth()).toVar();r=Is(i.oneMinus(),i.add(1),s).oneMinus()}else r=Ct(s.greaterThan(1),0,1);return r});const T4=Y(([n,e])=>{const t=n.x,s=n.y,r=n.z;let i=e.element(0).mul(.886227);return i=i.add(e.element(1).mul(2*.511664).mul(s)),i=i.add(e.element(2).mul(2*.511664).mul(r)),i=i.add(e.element(3).mul(2*.511664).mul(t)),i=i.add(e.element(4).mul(2*.429043).mul(t).mul(s)),i=i.add(e.element(5).mul(2*.429043).mul(s).mul(r)),i=i.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),i=i.add(e.element(7).mul(2*.429043).mul(t).mul(r)),i=i.add(e.element(8).mul(.429043).mul(Ne(t,t).sub(Ne(s,s)))),i}),Tn=new Fm;let w4=class extends hr{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,s){const r=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(i===null)r._clearColor.getRGB(Tn),Tn.a=r._clearColor.a;else if(i.isColor===!0)i.getRGB(Tn),Tn.a=1,o=!0;else if(i.isNode===!0){const l=this.get(e),c=i;Tn.copy(r._clearColor);let u=l.backgroundMesh;if(u===void 0){let x=function(){i.removeEventListener("dispose",x),u.material.dispose(),u.geometry.dispose()};const h=Vu(Te(c).mul(py),{getUV:()=>Nj.mul(IL),getTextureLevel:()=>wj});let p=JT;p=p.setZ(p.w);const m=new ut;m.name="Background.material",m.side=Qt,m.depthTest=!1,m.depthWrite=!1,m.allowOverride=!1,m.fog=!1,m.lights=!1,m.vertexNode=p,m.colorNode=h,l.backgroundMeshNode=h,l.backgroundMesh=u=new Bn(new Vp(1,32,32),m),u.frustumCulled=!1,u.name="Background.mesh",u.onBeforeRender=function(y,g,b){this.matrixWorld.copyPosition(b.matrixWorld)},i.addEventListener("dispose",x)}const d=c.getCacheKey();l.backgroundCacheKey!==d&&(l.backgroundMeshNode.node=Te(c).mul(py),l.backgroundMeshNode.needsUpdate=!0,u.material.needsUpdate=!0,l.backgroundCacheKey=d),t.unshift(u,u.geometry,u.material,0,0,null,null)}else re("Renderer: Unsupported background configuration.",i);const a=r.xr.getEnvironmentBlendMode();if(a==="additive"?Tn.set(0,0,0,1):a==="alpha-blend"&&Tn.set(0,0,0,0),r.autoClear===!0||o===!0){const l=s.clearColorValue;l.r=Tn.r,l.g=Tn.g,l.b=Tn.b,l.a=Tn.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),s.depthClearValue=r._clearDepth,s.stencilClearValue=r._clearStencil,s.clearColor=r.autoClearColor===!0,s.clearDepth=r.autoClearDepth===!0,s.clearStencil=r.autoClearStencil===!0}else s.clearColor=!1,s.clearDepth=!1,s.clearStencil=!1}},N4=0;class qf{constructor(e="",t=[],s=0,r=[]){this.name=e,this.bindings=t,this.index=s,this.bindingsReference=r,this.id=N4++}}class S4{constructor(e,t,s,r,i,o,a,l,c,u=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=s,this.transforms=u,this.nodeAttributes=r,this.bindings=i,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=l,this.observer=c,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new qf(t.name,[],t.index,t.bindingsReference);e.push(r);for(const i of t.bindings)r.bindings.push(i.clone())}else e.push(t);return e}}class vy{constructor(e,t,s=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=s}}class E4{constructor(e,t,s){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=s}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class Dw{constructor(e,t,s=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=s,this.count=r}}class A4 extends Dw{constructor(e,t,s=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=s,this.interpolationSampling=r}}class C4{constructor(e,t,s=""){this.name=e,this.type=t,this.code=s,Object.defineProperty(this,"isNodeCode",{value:!0})}}let R4=0;class sh{constructor(e=null){this.id=R4++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class M4{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class fr{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class P4 extends fr{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class k4 extends fr{constructor(e,t=new Se){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class D4 extends fr{constructor(e,t=new ue){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class I4 extends fr{constructor(e,t=new et){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class B4 extends fr{constructor(e,t=new _n){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class L4 extends fr{constructor(e,t=new $_){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class F4 extends fr{constructor(e,t=new Ja){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class O4 extends fr{constructor(e,t=new On){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class j4 extends P4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class U4 extends k4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class V4 extends D4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class G4 extends I4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class $4 extends B4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class z4 extends L4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class H4 extends F4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class W4 extends O4{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let q4=0;const _y=new WeakMap,K4=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Ul=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class Iw{constructor(e,t,s){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=s,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Zd(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new sh,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:q4++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===Wr&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=_y.get(this.renderer);return e===void 0&&(e=new Fn,_y.set(this.renderer,e)),e}createRenderTarget(e,t,s){return new fo(e,t,s)}createCubeRenderTarget(e,t){return new aw(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const s=this.getBindGroupsCache(),r=[];let i=!0;for(const a of t)r.push(a),i=i&&a.groupNode.shared!==!0;let o;return i?(o=s.get(r),o===void 0&&(o=new qf(e,r,this.bindingsIndexes[e].group,r),s.set(r,o))):o=new qf(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const s=this.bindings[t];let r=s[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),s[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},s=this.bindings;for(const r of yx)for(const i in s[r]){const o=s[r][i];(t[i]||(t[i]=[])).push(...o)}e=[];for(const r in t){const i=t[r],o=this._getBindGroup(r,i);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,s)=>t.bindings[0].groupNode.order-s.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const s=e[t];this.bindingsIndexes[s.name].group=t,s.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==we.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),s=e.getUpdateAfterType();t!==we.NONE&&this.updateBeforeNodes.push(e),s!==we.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Ln||e.magFilter===Yh||e.magFilter===Ca||e.magFilter===Hr||e.minFilter===Ln||e.minFilter===Yh||e.minFilter===Ca||e.minFilter===Hr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const s=this.getDataFromNode(e);return s.cache===void 0&&(s.cache=new sh(t?this.getCache():null)),s.cache}isAvailable(){return!1}getVertexIndex(){ie("Abstract function.")}getInstanceIndex(){ie("Abstract function.")}getDrawIndex(){ie("Abstract function.")}getFrontFacing(){ie("Abstract function.")}getFragCoord(){ie("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){ie("Abstract function.")}generateTextureLod(){ie("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,s=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const o=s?s[i]:null;o!==null?r+=o.build(this,e):r+=this.generateConst(e),i<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,s=null){const r=[];for(const i of t){const{name:o,type:a}=i;s&&s[o]&&s[o].isNode?r.push(s[o].build(this,a)):r.push(this.generateConst(a))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new _n:e==="vec2"?t=new Se:e==="vec3"?t=new ue:e==="vec4"&&(t=new et)),e==="float")return Ul(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Ul(t.r)}, ${Ul(t.g)}, ${Ul(t.b)} )`;const s=this.getTypeLength(e),r=this.getComponentType(e),i=o=>this.generateConst(r,o);if(s===2)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)} )`;if(s===3)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)} )`;if(s===4&&e!=="mat2")return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)}, ${i(t.w)} )`;if(s>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(i).join(", ")} )`;if(s>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const s=this.attributes;for(const i of s)if(i.name===e)return i;const r=new vy(e,t);return this.registerDeclaration(r),s.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ot)return"int";if(t===mt)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let s=KD(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(s=s.replace("vec","mat")),r+s}getTypeFromArray(e){return K4.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const s=t.array,r=e.itemSize,i=e.normalized;let o;return!(e instanceof z_)&&i!==!0&&(o=this.getTypeFromArray(s)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),s=/vec([2-4])/.exec(t);return s!==null?Number(s[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=Zd(this.stack);const e=J1();return this.stacks.push(e),eu(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const s=this.getDataFromNode(t);s.stack=e}return this.stack=e.parent,eu(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,s=null){s=s===null?e.isGlobal(this)?this.globalCache:this.cache:s;let r=s.getData(e);r===void 0&&(r={},s.setData(e,r)),r[t]===void 0&&(r[t]={});let i=r[t];const o=r.any?r.any.subBuilds:null,a=this.getClosestSubBuild(o);return a&&(i.subBuildsCache===void 0&&(i.subBuildsCache={}),i=i.subBuildsCache[a]||(i.subBuildsCache[a]={}),i.subBuilds=o),i}getNodeProperties(e,t="any"){const s=this.getDataFromNode(e,t);return s.properties||(s.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const s=this.getDataFromNode(e);let r=s.bufferAttribute;if(r===void 0){const i=this.uniforms.index++;r=new vy("nodeAttribute"+i,t,e),this.bufferAttributes.push(r),s.bufferAttribute=r}return r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,s=null,r=this.shaderStage){const i=this.getDataFromNode(e,r,this.globalCache);let o=i.structType;if(o===void 0){const a=this.structs.index++;s===null&&(s="StructType"+a),o=new M4(s,t),this.structs[r].push(o),this.types[r][s]=e,i.structType=o}return o}getOutputStructTypeFromNode(e,t){const s=this.getStructTypeFromNode(e,t,"OutputType","fragment");return s.output=!0,s}getUniformFromNode(e,t,s=this.shaderStage,r=null){const i=this.getDataFromNode(e,s,this.globalCache);let o=i.uniform;if(o===void 0){const a=this.uniforms.index++;o=new E4(r||"nodeUniform"+a,t,e),this.uniforms[s].push(o),this.registerDeclaration(o),i.uniform=o}return o}getVarFromNode(e,t=null,s=e.getNodeType(this),r=this.shaderStage,i=!1){const o=this.getDataFromNode(e,r),a=this.getSubBuildProperty("variable",o.subBuilds);let l=o[a];if(l===void 0){const c=i?"_const":"_var",u=this.vars[r]||(this.vars[r]=[]),d=this.vars[c]||(this.vars[c]=0);t===null&&(t=(i?"nodeConst":"nodeVar")+d,this.vars[c]++),a!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const h=e.getArrayCount(this);l=new Dw(t,s,i,h),i||u.push(l),this.registerDeclaration(l),o[a]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,s=e.getNodeType(this),r=null,i=null){const o=this.getDataFromNode(e,"any"),a=this.getSubBuildProperty("varying",o.subBuilds);let l=o[a];if(l===void 0){const c=this.varyings,u=c.length;t===null&&(t="nodeVarying"+u),a!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),l=new A4(t,s,r,i),c.push(l),this.registerDeclaration(l),o[a]=l}return l}registerDeclaration(e){const t=this.shaderStage,s=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let i=1,o=r;for(;s[o]!==void 0;)o=r+"_"+i++;i>1&&(e.name=o,ie(`TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${o}'.`)),s[o]=e}getCodeFromNode(e,t,s=this.shaderStage){const r=this.getDataFromNode(e);let i=r.code;if(i===void 0){const o=this.codes[s]||(this.codes[s]=[]),a=o.length;i=new C4("nodeCode"+a,t),o.push(i),r.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:s,flowCodeBlock:r}=this.getDataFromNode(e);let i=!0,o=t;for(;o;){if(r.get(o)===!0){i=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(i)for(const a of s)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,s){const r=this.getDataFromNode(e),i=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(t),o.set(s,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),s=this.flowChildNode(e,t);return this.flowsData.set(e,s),s}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new jj,s=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=s,t}flowShaderNode(e){const t=e.layout,s={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)s[o.name]=new yj(o.type,o.name);e.layout=null;const r=e.call(s),i=this.flowStagesNode(r,t.type);return e.layout=t,i}flowBuildStage(e,t,s=null){const r=this.getBuildStage();this.setBuildStage(t);const i=e.build(this,s);return this.setBuildStage(r),i}flowStagesNode(e,t=null){const s=this.flow,r=this.vars,i=this.declarations,o=this.cache,a=this.buildStage,l=this.stack,c={code:""};this.flow=c,this.vars={},this.declarations={},this.cache=new sh,this.stack=Zd();for(const u of xx)this.setBuildStage(u),c.result=e.build(this,t);return c.vars=this.getVars(this.shaderStage),this.flow=s,this.vars=r,this.declarations=i,this.cache=o,this.stack=l,this.setBuildStage(a),c}getFunctionOperator(){return null}buildFunctionCode(){ie("Abstract function.")}flowChildNode(e,t=null){const s=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=s,r}flowNodeFromShaderStage(e,t,s=null,r=null){const i=this.tab,o=this.cache,a=this.shaderStage,l=this.context;this.setShaderStage(e);const c={...this.context};delete c.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=c;let u=null;if(this.buildStage==="generate"){const d=this.flowChildNode(t,s);r!==null&&(d.code+=`${this.tab+r} = ${d.result};
`),this.flowCode[e]=this.flowCode[e]+d.code,u=d}else u=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=i,this.context=l,u}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){ie("Abstract function.")}getVaryings(){ie("Abstract function.")}getVar(e,t,s=null){return`${s!==null?this.generateArrayDeclaration(e,s):this.getType(e)} ${t}`}getVars(e){let t="";const s=this.vars[e];if(s!==void 0)for(const r of s)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){ie("Abstract function.")}getCodes(e){const t=this.codes[e];let s="";if(t!==void 0)for(const r of t)s+=r.code+`
`;return s}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){ie("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const s=this.subBuildLayers;for(let r=t.length-1;r>=0;r--){const i=t[r];if(s.includes(i))return i}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let s;t!==null?s=this.getClosestSubBuild(t):s=this.subBuildFn;let r;return s?r=e?s+"_"+e:s:r=e,r}build(){const{object:e,material:t,renderer:s}=this;if(t!==null){let r=s.library.fromMaterial(t);r===null&&(re(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new ut),r.build(this)}else this.addFlow("compute",e);for(const r of xx){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const i of yx){this.setShaderStage(i);const o=this.flowNodes[i];for(const a of o)r==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new j4(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new U4(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new V4(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new G4(e);if(t==="color")return new $4(e);if(t==="mat2")return new z4(e);if(t==="mat3")return new H4(e);if(t==="mat4")return new W4(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,s){if(t=this.getVectorType(t),s=this.getVectorType(s),t===s||s===null||this.isReference(s))return e;const r=this.getTypeLength(t),i=this.getTypeLength(s);return r===16&&i===9?`${this.getType(s)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&i===4?`${this.getType(s)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||i>4||i===0?e:r===i?`${this.getType(s)}( ${e} )`:r>i?(e=s==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,i)}`,this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),s)):i===4&&r>1?`${this.getType(s)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(s)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&i>1&&t!==this.getComponentType(s)&&(e=`${this.getType(this.getComponentType(s))}( ${e} )`),`${this.getType(s)}( ${e} )`)}getSignature(){return`// Three.js r${Su} - Node System
`}}class Ty{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let s=e.get(t);return s===void 0&&(s={renderId:0,frameId:0},e.set(t,s)),s}updateBeforeNode(e){const t=e.getUpdateBeforeType(),s=e.updateReference(this);if(t===we.FRAME){const r=this._getMaps(this.updateBeforeMap,s);r.frameId!==this.frameId&&e.updateBefore(this)!==!1&&(r.frameId=this.frameId)}else if(t===we.RENDER){const r=this._getMaps(this.updateBeforeMap,s);r.renderId!==this.renderId&&e.updateBefore(this)!==!1&&(r.renderId=this.renderId)}else t===we.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),s=e.updateReference(this);if(t===we.FRAME){const r=this._getMaps(this.updateAfterMap,s);r.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(r.frameId=this.frameId)}else if(t===we.RENDER){const r=this._getMaps(this.updateAfterMap,s);r.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(r.renderId=this.renderId)}else t===we.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),s=e.updateReference(this);if(t===we.FRAME){const r=this._getMaps(this.updateMap,s);r.frameId!==this.frameId&&e.update(this)!==!1&&(r.frameId=this.frameId)}else if(t===we.RENDER){const r=this._getMaps(this.updateMap,s);r.renderId!==this.renderId&&e.update(this)!==!1&&(r.renderId=this.renderId)}else t===we.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class Um{constructor(e,t,s=null,r="",i=!1){this.type=e,this.name=t,this.count=s,this.qualifier=r,this.isConst=i}}Um.isNodeFunctionInput=!0;class X4 extends si{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:Cw(this.light),lightColor:e}}}const rh=new On,Vl=new On;let $o=null;class Y4 extends si{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=me(new ue).setGroup(pe),this.halfWidth=me(new ue).setGroup(pe),this.updateType=we.RENDER}update(e){super.update(e);const{light:t}=this,s=e.camera.matrixWorldInverse;Vl.identity(),rh.copy(t.matrixWorld),rh.premultiply(s),Vl.extractRotation(rh),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Vl),this.halfHeight.value.applyMatrix4(Vl)}setupDirectRectArea(e){let t,s;e.isAvailable("float32Filterable")?(t=Re($o.LTC_FLOAT_1),s=Re($o.LTC_FLOAT_2)):(t=Re($o.LTC_HALF_1),s=Re($o.LTC_HALF_2));const{colorNode:r,light:i}=this,o=Aw(i);return{lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:s}}static setLTC(e){$o=e}}class Vm extends si{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=me(0).setGroup(pe),this.penumbraCosNode=me(0).setGroup(pe),this.cutoffDistanceNode=me(0).setGroup(pe),this.decayExponentNode=me(0).setGroup(pe),this.colorNode=me(this.color).setGroup(pe)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:s,penumbraCosNode:r}=this;return Is(s,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let s=t.projectionUV;return s===void 0&&(s=$j(this.light,e.context.positionWorld),t.projectionUV=s),s}setupDirect(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:r,light:i}=this,o=this.getLightVector(e),a=o.normalize(),l=a.dot(Cw(i)),c=this.getSpotAttenuation(e,l),u=o.length(),d=kw({lightDistance:u,cutoffDistance:s,decayExponent:r});let h=t.mul(c).mul(d),p,m;return i.colorNode?(m=this.getLightCoord(e),p=i.colorNode(m)):i.map&&(m=this.getLightCoord(e),p=Re(i.map,m.xy).onRenderUpdate(()=>i.map)),p&&(h=m.mul(2).sub(1).abs().lessThan(1).all().select(h.mul(p),h)),{lightColor:h,lightDirection:a}}}class Q4 extends Vm{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const s=this.light.iesMap;let r=null;if(s&&s.isTexture===!0){const i=t.acos().mul(1/Math.PI);r=Re(s,ne(i,0),0).r}else r=super.getSpotAttenuation(t);return r}}const Z4=Y(([n,e])=>{const t=n.abs().sub(e);return Ms(vt(t,0)).add(Ji(vt(t.x,t.y),0))});class J4 extends Vm{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let s=1;t.map!==null&&(s=t.map.width/t.map.height),t.shadow.aspect=s}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=$(0),s=this.penumbraCosNode,r=jm(this.light).mul(e.context.positionWorld||no);return Ke(r.w.greaterThan(0),()=>{const i=r.xyz.div(r.w),o=Z4(i.xy.sub(ne(.5)),ne(.5)),a=ss(-1,jt(1,fT(s)).sub(1));t.assign(TT(o.mul(-2).mul(a)))}),t}}class eU extends si{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class tU extends si{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=Ew(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=me(new _n).setGroup(pe)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:r}=this,o=yo.dot(r).mul(.5).add(.5),a=We(s,t,o);e.context.irradiance.addAssign(a)}}class nU extends si{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let s=0;s<9;s++)t.push(new ue);this.lightProbe=Pn(t)}update(e){const{light:t}=this;super.update(e);for(let s=0;s<9;s++)this.lightProbe.array[s].copy(t.sh.coefficients[s]).multiplyScalar(t.intensity)}setup(e){const t=T4(yo,this.lightProbe);e.context.irradiance.addAssign(t)}}class Bw{parseFunction(){ie("Abstract function.")}}class Gm{constructor(e,t,s="",r=""){this.type=e,this.inputs=t,this.name=s,this.precision=r}getCode(){ie("Abstract function.")}}Gm.isNodeFunction=!0;const sU=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,rU=/[a-z_0-9]+/ig,wy="#pragma main",iU=n=>{n=n.trim();const e=n.indexOf(wy),t=e!==-1?n.slice(e+wy.length):n,s=t.match(sU);if(s!==null&&s.length===5){const r=s[4],i=[];let o=null;for(;(o=rU.exec(r))!==null;)i.push(o);const a=[];let l=0;for(;l<i.length;){const m=i[l][0]==="const";m===!0&&l++;let x=i[l][0];x==="in"||x==="out"||x==="inout"?l++:x="";const y=i[l++][0];let g=Number.parseInt(i[l][0]);Number.isNaN(g)===!1?l++:g=null;const b=i[l++][0];a.push(new Um(y,b,g,x,m))}const c=t.substring(s[0].length),u=s[3]!==void 0?s[3]:"",d=s[2],h=s[1]!==void 0?s[1]:"",p=e!==-1?n.slice(0,e):"";return{type:d,inputs:a,name:u,precision:h,inputsCode:r,blockCode:c,headerCode:p}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class oU extends Gm{constructor(e){const{type:t,inputs:s,name:r,precision:i,inputsCode:o,blockCode:a,headerCode:l}=iU(e);super(t,s,r,i),this.inputsCode=o,this.blockCode=a,this.headerCode=l}getCode(e=this.name){let t;const s=this.blockCode;if(s!==""){const{type:r,inputsCode:i,headerCode:o,precision:a}=this;let l=`${r} ${e} ( ${i.trim()} )`;a!==""&&(l=`${a} ${l}`),t=o+l+s}else t="";return t}}class aU extends Bw{parseFunction(e){return new oU(e)}}const Ny=new WeakMap,Hn=[],Us=[];class lU extends hr{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new Ty,this.nodeBuilderCache=new Map,this.callHashCache=new Fn,this.groupsData=new Fn,this.cacheLib={}}updateGroup(e){const t=e.groupNode,s=t.name;if(s===lT.name)return!0;if(s===pe.name){const i=this.get(e),o=this.nodeFrame.renderId;return i.renderId!==o?(i.renderId=o,!0):!1}if(s===DI.name){const i=this.get(e),o=this.nodeFrame.frameId;return i.frameId!==o?(i.frameId=o,!0):!1}Hn[0]=t,Hn[1]=e;let r=this.groupsData.get(Hn);return r===void 0&&this.groupsData.set(Hn,r={}),Hn.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let s=t.nodeBuilderState;if(s===void 0){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(e);if(s=r.get(i),s===void 0){const o=l=>{const c=this.backend.createNodeBuilder(e.object,this.renderer);return c.scene=e.scene,c.material=l,c.camera=e.camera,c.context.material=l,c.lightsNode=e.lightsNode,c.environmentNode=this.getEnvironmentNode(e.scene),c.fogNode=this.getFogNode(e.scene),c.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&c.enableMultiview(),c};let a=o(e.material);try{a.build()}catch(l){a=o(new ut),a.build(),re("TSL: "+l)}s=this._createNodeBuilderState(a),r.set(i,s)}s.usedTimes++,t.nodeBuilderState=s}return s}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let s=t.nodeBuilderState;if(s===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),s=this._createNodeBuilderState(r),t.nodeBuilderState=s}return s}_createNodeBuilderState(e){return new S4(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const s=this.get(e);s.environmentNode&&(t=s.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const s=this.get(e);s.backgroundNode&&(t=s.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Hn[0]=e,Hn[1]=t;const s=this.renderer.info.calls,r=this.callHashCache.get(Hn)||{};if(r.callId!==s){const i=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Us.push(t.getCacheKey(!0)),i&&Us.push(i.getCacheKey()),o&&Us.push(o.getCacheKey()),Us.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Us.push(this.renderer.shadowMap.enabled?1:0),Us.push(this.renderer.shadowMap.type),r.callId=s,r.cacheKey=nl(Us),this.callHashCache.set(Hn,r),Us.length=0}return Hn.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),s=e.background;if(s){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==s||r){const i=this.getCacheNode("background",s,()=>{if(s.isCubeTexture===!0||s.mapping===Wp||s.mapping===qp||s.mapping===Xh){if(e.backgroundBlurriness>0||s.mapping===Xh)return yw(s);{let o;return s.isCubeTexture===!0?o=Oa(s):o=Re(s),cw(o)}}else{if(s.isTexture===!0)return Re(s,Gi.flipY()).setUpdateMatrix(!0);s.isColor!==!0&&re("WebGPUNodes: Unsupported background configuration.",s)}},r);t.backgroundNode=i,t.background=s,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,s,r=!1){const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=i.get(t);return(o===void 0||r)&&(o=s(),i.set(t,o)),o}updateFog(e){const t=this.get(e),s=e.fog;if(s){if(t.fog!==s){const r=this.getCacheNode("fog",s,()=>{if(s.isFogExp2){const i=Ue("color","color",s).setGroup(pe),o=Ue("density","float",s).setGroup(pe);return gy(i,Vj(o))}else if(s.isFog){const i=Ue("color","color",s).setGroup(pe),o=Ue("near","float",s).setGroup(pe),a=Ue("far","float",s).setGroup(pe);return gy(i,Uj(o,a))}else re("Renderer: Unsupported fog configuration.",s)});t.fogNode=r,t.fog=s}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),s=e.environment;if(s){if(t.environment!==s){const r=this.getCacheNode("environment",s,()=>{if(s.isCubeTexture===!0)return Oa(s);if(s.isTexture===!0)return Re(s);re("Nodes: Unsupported environment configuration.",s)});t.environmentNode=r,t.environment=s}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,s=null,r=null,i=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=s,o.camera=r,o.material=i,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return Ny.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,s=this.getOutputCacheKey(),r=e.isArrayTexture?Aj(e,K(Gi,il("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Re(e,Gi).renderOutput(t.toneMapping,t.currentColorSpace);return Ny.set(e,s),r}updateBefore(e){const t=e.getNodeBuilderState();for(const s of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(s)}updateAfter(e){const t=e.getNodeBuilderState();for(const s of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(s)}updateForCompute(e){const t=this.getNodeFrame(),s=this.getForCompute(e);for(const r of s.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),s=e.getNodeBuilderState();for(const r of s.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new Ty,this.nodeBuilderCache=new Map,this.cacheLib={}}}const ih=new wu;class lu{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Ja,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,s){const r=e.length;for(let i=0;i<r;i++){ih.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[s+i],a=ih.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=ih.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let s=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,i=r.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+i){o.length=a+i;for(let l=0;l<i;l++)o[a+l]=new et;s=!0}this.projectPlanes(r,o,a),s&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new lu(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class cU{constructor(e,t){this.bundleGroup=e,this.camera=t}}const zo=[];class uU{constructor(){this.bundles=new Fn}get(e,t){const s=this.bundles;zo[0]=e,zo[1]=t;let r=s.get(zo);return r===void 0&&(r=new cU(e,t),s.set(zo,r)),zo.length=0,r}dispose(){this.bundles=new Fn}}class Lw{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const s=this.getMaterialNodeClass(e.type);if(s!==null){t=new s;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,s){if(s.has(t)){ie(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);s.set(t,e)}addClass(e,t,s){if(s.has(t)){ie(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);s.set(t,e)}}const dU=new Rw,Ho=[];class hU extends Fn{constructor(){super()}createNode(e=[]){return new Rw().setLights(e)}getNode(e,t){if(e.isQuadMesh)return dU;Ho[0]=e,Ho[1]=t;let s=this.get(Ho);return s===void 0&&(s=this.createNode(),this.set(Ho,s)),Ho.length=0,s}}class ra extends fo{constructor(e=1,t=1,s={}){super(e,t,s),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const Sy=new ue,Ey=new ue;class fU extends zp{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ea,this._cameraL.viewport=new et,this._cameraR=new Ea,this._cameraR.viewport=new et,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new pA,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=bU.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Se,this._onSessionEvent=gU.bind(this),this._onSessionEnd=xU.bind(this),this._onInputSourcesChange=yU.bind(this),this._onAnimationFrame=vU.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&ie("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&ie("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,s,r,i,o,a,l={}){const c=new mA(e,t),u=new ra(i,o,{format:kn,type:on,depthTexture:new Zn(i,o,l.stencil?er:mt,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?tr:nr),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});u._autoAllocateDepthBuffer=!0;const d=new Ks({color:16777215,side:la});d.map=u.texture,d.map.offset.y=1,d.map.repeat.y=-1;const h=new Bn(c,d);h.position.copy(s),h.quaternion.copy(r);const p={type:"quad",width:e,height:t,translation:s,quaternion:r,pixelwidth:i,pixelheight:o,plane:h,material:d,rendercall:a,renderTarget:u};if(this._layers.push(p),this._session!==null){p.plane.material=new Ks({color:16777215,side:la}),p.plane.material.blending=ca,p.plane.material.blendEquation=vs,p.plane.material.blendSrc=Hs,p.plane.material.blendDst=Hs,p.xrlayer=this._createXRLayer(p);const m=this._session.renderState.layers;m.unshift(p.xrlayer),this._session.updateRenderState({layers:m})}else u.isXRRenderTarget=!1;return h}createCylinderLayer(e,t,s,r,i,o,a,l,c={}){const u=new o_(e,e,e*t/s,64,64,!0,Math.PI-t/2,t),d=new ra(o,a,{format:kn,type:on,depthTexture:new Zn(o,a,c.stencil?er:mt,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?tr:nr),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});d._autoAllocateDepthBuffer=!0;const h=new Ks({color:16777215,side:Qt});h.map=d.texture,h.map.offset.y=1,h.map.repeat.y=-1;const p=new Bn(u,h);p.position.copy(r),p.quaternion.copy(i);const m={type:"cylinder",radius:e,centralAngle:t,aspectratio:s,translation:r,quaternion:i,pixelwidth:o,pixelheight:a,plane:p,material:h,rendercall:l,renderTarget:d};if(this._layers.push(m),this._session!==null){m.plane.material=new Ks({color:16777215,side:Qt}),m.plane.material.blending=ca,m.plane.material.blendEquation=vs,m.plane.material.blendSrc=Hs,m.plane.material.blendDst=Hs,m.xrlayer=this._createXRLayer(m);const x=this._session.renderState.layers;x.unshift(m.xrlayer),this._session.updateRenderState({layers:x})}else d.isXRRenderTarget=!1;return p}renderLayers(){const e=new ue,t=new qi,s=this._renderer,r=this.isPresenting,i=s.getOutputRenderTarget(),o=s._frameBufferTarget;this.isPresenting=!1;const a=new Se;s.getSize(a);const l=s._quad;for(const c of this._layers)if(c.renderTarget.isXRRenderTarget=this._session!==null,c.renderTarget._hasExternalTextures=c.renderTarget.isXRRenderTarget,c.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){c.xrlayer.transform=new XRRigidTransform(c.plane.getWorldPosition(e),c.plane.getWorldQuaternion(t));const u=this._glBinding.getSubImage(c.xrlayer,this._xrFrame);s.backend.setXRRenderTargetTextures(c.renderTarget,u.colorTexture,void 0),s._setXRLayerSize(c.renderTarget.width,c.renderTarget.height),s.setOutputRenderTarget(c.renderTarget),s.setRenderTarget(null),s._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:d,quad:h}=this._frameBufferTargets.get(c.renderTarget)||{frameBufferTarget:null,quad:null};d?(s._frameBufferTarget=d,s._quad=h):(s._quad=new Om(new ut),this._frameBufferTargets.set(c.renderTarget,{frameBufferTarget:s._getFrameBufferTarget(),quad:s._quad})),c.rendercall(),s._frameBufferTarget=null}else s.setRenderTarget(c.renderTarget),c.rendercall();s.setRenderTarget(null),s.setOutputRenderTarget(i),s._frameBufferTarget=o,s._setXRLayerSize(a.x,a.y),s._quad=l,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,s=t.backend;this._gl=t.getContext();const r=this._gl,i=r.getContextAttributes();if(this._session=e,e!==null){if(s.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await s.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,a=null,l=null;t.depth&&(l=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,o=t.stencil?tr:nr,a=t.stencil?er:mt);const c={colorFormat:r.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(c.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const u=this._glBinding.createProjectionLayer(c),d=[u];this._glProjLayer=u,t.setPixelRatio(1),t._setXRLayerSize(u.textureWidth,u.textureHeight);const h=this._useMultiview?2:1,p=new Zn(u.textureWidth,u.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,h);if(this._xrRenderTarget=new ra(u.textureWidth,u.textureHeight,{format:kn,type:on,colorSpace:t.outputColorSpace,depthTexture:p,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const m of this._layers)m.plane.material=new Ks({color:16777215,side:m.type==="cylinder"?Qt:la}),m.plane.material.blending=ca,m.plane.material.blendEquation=vs,m.plane.material.blendSrc=Hs,m.plane.material.blendDst=Hs,m.xrlayer=this._createXRLayer(m),d.unshift(m.xrlayer);e.updateRenderState({layers:d})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,r,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new ra(a.framebufferWidth,a.framebufferHeight,{format:kn,type:on,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const s=e.near,r=e.far,i=this._cameraXR,o=this._cameraL,a=this._cameraR;i.near=a.near=o.near=s,i.far=a.far=o.far=r,i.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==i.near||this._currentDepthFar!==i.far)&&(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=e.layers.mask|6,o.layers.mask=i.layers.mask&3,a.layers.mask=i.layers.mask&5;const l=e.parent,c=i.cameras;Ay(i,l);for(let u=0;u<c.length;u++)Ay(c[u],l);c.length===2?pU(i,o,a):i.projectionMatrix.copy(o.projectionMatrix),mU(e,i,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new gA,this._controllers[e]=t),t}}function pU(n,e,t){Sy.setFromMatrixPosition(e.matrixWorld),Ey.setFromMatrixPosition(t.matrixWorld);const s=Sy.distanceTo(Ey),r=e.projectionMatrix.elements,i=t.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(i[8]+1)/i[0],h=o*u,p=o*d,m=s/(-u+d),x=m*-u;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(x),n.translateZ(m),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),r[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const y=o+m,g=a+m,b=h-x,v=p+(s-x),_=l*a/g*y,w=c*a/g*y;n.projectionMatrix.makePerspective(b,v,_,w,y,g),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function Ay(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function mU(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=LA*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function gU(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const s=this.getReferenceSpace();t.update(n.inputSource,n.frame,s),t.dispatchEvent({type:n.type,data:n.inputSource})}}function xU(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const s=this._controllerInputSources[t];s!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(s))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new ra(t.pixelwidth,t.pixelheight,{format:kn,type:on,depthTexture:new Zn(t.pixelwidth,t.pixelheight,t.stencilBuffer?er:mt,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?tr:nr),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function yU(n){const e=this._controllers,t=this._controllerInputSources;for(let s=0;s<n.removed.length;s++){const r=n.removed[s],i=t.indexOf(r);i>=0&&(t[i]=null,e[i].disconnect(r))}for(let s=0;s<n.added.length;s++){const r=n.added[s];let i=t.indexOf(r);if(i===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(r),i=a;break}else if(t[a]===null){t[a]=r,i=a;break}if(i===-1)break}const o=e[i];o&&o.connect(r)}}function bU(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function vU(n,e){if(e===void 0)return;const t=this._cameraXR,s=this._renderer,r=s.backend,i=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const l=a.views;this._glBaseLayer!==null&&r.setXRTarget(i.framebuffer);let c=!1;l.length!==t.cameras.length&&(t.cameras.length=0,c=!0);for(let u=0;u<l.length;u++){const d=l[u];let h;if(this._supportsLayers===!0){const m=this._glBinding.getViewSubImage(this._glProjLayer,d);h=m.viewport,u===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,m.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:m.depthStencilTexture)}else h=i.getViewport(d);let p=this._cameras[u];p===void 0&&(p=new Ea,p.layers.enable(u),p.viewport=new et,this._cameras[u]=p),p.matrix.fromArray(d.transform.matrix),p.matrix.decompose(p.position,p.quaternion,p.scale),p.projectionMatrix.fromArray(d.projectionMatrix),p.projectionMatrixInverse.copy(p.projectionMatrix).invert(),p.viewport.set(h.x,h.y,h.width,h.height),u===0&&(t.matrix.copy(p.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),c===!0&&t.cameras.push(p)}s.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const c=this._controllerInputSources[l],u=this._controllers[l];c!==null&&u!==void 0&&u.update(c,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class _U extends zp{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new et(0,0,this._width,this._height),this._scissor=new et(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new d_,this.depthTexture=new Zn}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,s){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=s,this.domElement.width=Math.floor(e*s),this.domElement.height=Math.floor(t*s),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,s=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),s===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,s,r){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,s,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,s,r,i=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,s,r),a.minDepth=i,a.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const Cy=new Nu,yi=new Se,oh=new et,ah=new sA,lh=new nA,Gl=new On,ps=new et;class TU{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:s=!1,alpha:r=!0,depth:i=!0,stencil:o=!1,antialias:a=!1,samples:l=0,getFallback:c=null,colorBufferType:u=Vt,multiview:d=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=s,this.outputColorSpace=Gp,this.toneMapping=Or,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=o,this.info=new nj,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new Lw,this.lighting=new hU,this._samples=l||a===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new _U(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new MT,this._inspector.setRenderer(this),this._getFallback=c,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Om(new ut),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const h=this.alpha===!0?0:1;this._clearColor=new Fm(0,0,0,h),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=u,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:tA},this.xr=new fU(this,d),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(p,m,x)=>{await this.compileAsync(p,m);const y=this._renderLists.get(p,m),g=this._renderContexts.get(p,m,this._renderTarget),b=p.overrideMaterial||x.material,v=this._objects.get(x,b,p,m,y.lightsNode,g,g.clippingContext),{fragmentShader:_,vertexShader:w}=v.getNodeBuilderState();return{fragmentShader:_,vertexShader:w}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let s=this.backend;try{await s.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=s=this._getFallback(r),await s.init(this)}catch(i){t(i);return}else{t(r);return}}this._nodes=new lU(this,s),this._animation=new q5(this,this._nodes,this.info),this._attributes=new ej(s),this._background=new w4(this,this._nodes),this._geometries=new tj(this._attributes,this.info),this._textures=new xj(this,s,this.info),this._pipelines=new oj(s,this._nodes),this._bindings=new aj(s,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Q5(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new uj(this.lighting),this._bundles=new uU,this._renderContexts=new mj,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,s=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=this._compilationPromises,c=e.isScene===!0?e:Cy;s===null&&(s=e);const u=this._renderTarget,d=this._renderContexts.get(s,t,u),h=this._activeMipmapLevel,p=[];this._currentRenderContext=d,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=p,r.renderId++,r.update(),d.depth=this.depth,d.stencil=this.stencil,d.clippingContext||(d.clippingContext=new lu),d.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,u);const m=this._renderLists.get(e,t);if(m.begin(),this._projectObject(e,t,0,m,d.clippingContext),s!==e&&s.traverseVisible(function(v){v.isLight&&v.layers.test(t.layers)&&m.pushLight(v)}),m.finish(),u!==null){this._textures.updateRenderTarget(u,h);const v=this._textures.get(u);d.textures=v.textures,d.depthTexture=v.depthTexture}else d.textures=null,d.depthTexture=null;this._background.update(c,m,d);const x=m.opaque,y=m.transparent,g=m.transparentDoublePass,b=m.lightsNode;this.opaque===!0&&x.length>0&&this._renderObjects(x,t,c,b),this.transparent===!0&&y.length>0&&this._renderTransparents(y,g,t,c,b),r.renderId=i,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(p)}async renderAsync(e,t){ft('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){re("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=Mx,this.overrideNodes.modelNormalViewMatrix=Px):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===Mx&&this.overrideNodes.modelNormalViewMatrix===Px}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),re(t),this._isDeviceLost=!0}_renderBundle(e,t,s){const{bundleGroup:r,camera:i,renderList:o}=e,a=this._currentRenderContext,l=this._bundles.get(r,i),c=this.backend.get(l);c.renderContexts===void 0&&(c.renderContexts=new Set);const u=r.version!==c.version,d=c.renderContexts.has(a)===!1||u;if(c.renderContexts.add(a),d){this.backend.beginBundle(a),(c.renderObjects===void 0||u)&&(c.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:h,transparent:p,opaque:m}=o;this.opaque===!0&&m.length>0&&this._renderObjects(m,i,t,s),this.transparent===!0&&p.length>0&&this._renderTransparents(p,h,i,t,s),this._currentRenderBundle=null,this.backend.finishBundle(a,l),c.version=r.version}else{const{renderObjects:h}=c;for(let p=0,m=h.length;p<m;p++){const x=h[p];this._nodes.needsRefresh(x)&&(this._nodes.updateBefore(x),this._nodes.updateForRender(x),this._bindings.updateForRender(x),this._nodes.updateAfter(x))}}this.backend.addBundle(a,l)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,s=e!==Or,r=t!==pt.workingColorSpace;if(s===!1&&r===!1)return null;const{width:i,height:o}=this.getDrawingBufferSize(yi),{depth:a,stencil:l}=this;let c=this._frameBufferTarget;c===null&&(c=new fo(i,o,{depthBuffer:a,stencilBuffer:l,type:this._colorBufferType,format:kn,colorSpace:pt.workingColorSpace,generateMipmaps:!1,minFilter:Ln,magFilter:Ln,samples:this.samples}),c.isPostProcessingRenderTarget=!0,this._frameBufferTarget=c);const u=this.getOutputRenderTarget();c.depthBuffer=a,c.stencilBuffer=l,u!==null?c.setSize(u.width,u.height,u.depth):c.setSize(i,o,1);const d=this._canvasTarget;return c.viewport.copy(d._viewport),c.scissor.copy(d._scissor),c.viewport.multiplyScalar(d._pixelRatio),c.scissor.multiplyScalar(d._pixelRatio),c.scissorTest=d._scissorTest,c.multiview=u!==null?u.multiview:!1,c.resolveDepthBuffer=u!==null?u.resolveDepthBuffer:!0,c._autoAllocateDepthBuffer=u!==null?u._autoAllocateDepthBuffer:!1,c}_renderScene(e,t,s=!0){if(this._isDeviceLost===!0)return;const r=s?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,o=i.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,c=e.isScene===!0?e:Cy,u=this._renderTarget||this._outputRenderTarget,d=this._activeCubeFace,h=this._activeMipmapLevel;let p;r!==null?(p=r,this.setRenderTarget(p)):p=u;const m=this._renderContexts.get(e,t,p);this._currentRenderContext=m,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(m),this.inspector.beginRender(this.backend.getTimestampUID(m),e,t,p);const x=this.coordinateSystem,y=this.xr;if(t.coordinateSystem!==x&&y.isPresenting===!1&&(t.coordinateSystem=x,t.updateProjectionMatrix(),t.isArrayCamera))for(const A of t.cameras)A.coordinateSystem=x,A.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),y.enabled===!0&&y.isPresenting===!0&&(y.cameraAutoUpdate===!0&&y.updateCamera(t),t=y.getCamera());const g=this._canvasTarget;let b=g._viewport,v=g._scissor,_=g._pixelRatio;p!==null&&(b=p.viewport,v=p.scissor,_=1),this.getDrawingBufferSize(yi),oh.set(0,0,yi.width,yi.height);const w=b.minDepth===void 0?0:b.minDepth,T=b.maxDepth===void 0?1:b.maxDepth;m.viewportValue.copy(b).multiplyScalar(_).floor(),m.viewportValue.width>>=h,m.viewportValue.height>>=h,m.viewportValue.minDepth=w,m.viewportValue.maxDepth=T,m.viewport=m.viewportValue.equals(oh)===!1,m.scissorValue.copy(v).multiplyScalar(_).floor(),m.scissor=g._scissorTest&&m.scissorValue.equals(oh)===!1,m.scissorValue.width>>=h,m.scissorValue.height>>=h,m.clippingContext||(m.clippingContext=new lu),m.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,p);const E=t.isArrayCamera?lh:ah;t.isArrayCamera||(Gl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),E.setFromProjectionMatrix(Gl,t.coordinateSystem,t.reversedDepth));const S=this._renderLists.get(e,t);if(S.begin(),this._projectObject(e,t,0,S,m.clippingContext),S.finish(),this.sortObjects===!0&&S.sort(this._opaqueSort,this._transparentSort),p!==null){this._textures.updateRenderTarget(p,h);const A=this._textures.get(p);m.textures=A.textures,m.depthTexture=A.depthTexture,m.width=A.width,m.height=A.height,m.renderTarget=p,m.depth=p.depthBuffer,m.stencil=p.stencilBuffer}else m.textures=null,m.depthTexture=null,m.width=yi.width,m.height=yi.height,m.depth=this.depth,m.stencil=this.stencil;m.width>>=h,m.height>>=h,m.activeCubeFace=d,m.activeMipmapLevel=h,m.occlusionQueryCount=S.occlusionQueryCount,m.scissorValue.max(ps.set(0,0,0,0)),m.scissorValue.x+m.scissorValue.width>m.width&&(m.scissorValue.width=Math.max(m.width-m.scissorValue.x,0)),m.scissorValue.y+m.scissorValue.height>m.height&&(m.scissorValue.height=Math.max(m.height-m.scissorValue.y,0)),this._background.update(c,S,m),m.camera=t,this.backend.beginRender(m);const{bundles:C,lightsNode:k,transparentDoublePass:B,transparent:V,opaque:z}=S;return C.length>0&&this._renderBundles(C,c,k),this.opaque===!0&&z.length>0&&this._renderObjects(z,t,c,k),this.transparent===!0&&V.length>0&&this._renderTransparents(V,B,t,c,k),this.backend.finishRender(m),i.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=l,r!==null&&(this.setRenderTarget(u,d,h),this._renderOutput(p)),c.onAfterRender(this,e,t,p),this.inspector.finishRender(this.backend.getTimestampUID(m)),m}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const s=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=s,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,s){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,s)}setSize(e,t,s=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,s)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,s,r){this._canvasTarget.setScissor(e,t,s,r)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,s,r,i=0,o=1){this._canvasTarget.setViewport(e,t,s,r,i,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,s=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);i=this._renderContexts.getForClear(r),i.textures=o.textures,i.depthTexture=o.depthTexture,i.width=o.width,i.height=o.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer,i.clearColorValue=this.backend.getClearColor(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,s,i),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,s=!0){ft('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,s)}async clearColorAsync(){ft('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){ft('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){ft('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Or,t=this.currentColorSpace!==pt.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Or}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:pt.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,s=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=s}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return ie("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const s=this._nodes.nodeFrame,r=s.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const i=this.backend,o=this._pipelines,a=this._bindings,l=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const u of c){if(o.has(u)===!1){const p=()=>{u.removeEventListener("dispose",p),o.delete(u),a.deleteForCompute(u),l.delete(u)};u.addEventListener("dispose",p);const m=u.onInitFunction;m!==null&&m.call(u,{renderer:this})}l.updateForCompute(u),a.updateForCompute(u);const d=a.getForCompute(u),h=o.getForCompute(u,d);i.compute(e,u,d,h,t)}i.finishCompute(e),s.renderId=r,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return ft('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){ft('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=ps.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=ps.copy(t).floor();else{re("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=ps.set(0,0,e.image.width,e.image.height);let s=this._currentRenderContext,r;s!==null?r=s.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),s=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,s,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,s=null,r=null,i=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,s,r,i,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,s,r,i,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,s,r,i,a)}_projectObject(e,t,s,r,i){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)s=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?lh:ah;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&ps.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Gl);const{geometry:c,material:u}=e;u.visible&&r.push(e,c,u,s,ps.z,null,i)}}else if(e.isLineLoop)re("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?lh:ah;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:c,material:u}=e;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),ps.copy(c.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Gl)),Array.isArray(u)){const d=c.groups;for(let h=0,p=d.length;h<p;h++){const m=d[h],x=u[m.materialIndex];x&&x.visible&&r.push(e,c,x,s,ps.z,m,i)}}else u.visible&&r.push(e,c,u,s,ps.z,null,i)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=r;r=this._renderLists.get(e,t),r.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let l=0,c=a.length;l<c;l++)this._projectObject(a[l],t,s,r,i)}_renderBundles(e,t,s){for(const r of e)this._renderBundle(r,t,s)}_renderTransparents(e,t,s,r,i){if(t.length>0){for(const{material:o}of t)o.side=Qt;this._renderObjects(t,s,r,i,"backSide");for(const{material:o}of t)o.side=la;this._renderObjects(e,s,r,i);for(const{material:o}of t)o.side=zr}else this._renderObjects(e,s,r,i)}_renderObjects(e,t,s,r,i=null){for(let o=0,a=e.length;o<a;o++){const{object:l,geometry:c,material:u,group:d,clippingContext:h}=e[o];this._currentRenderObjectFunction(l,s,t,c,u,d,r,h,i)}}_getShadowNodes(e){const t=e.version;let s=this._cacheShadowNodes.get(e);if(s===void 0||s.version!==t){const r=e.map!==null,i=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let a=null,l=null,c=null;if(r||i||o){let u,d;o?(u=e.castShadowNode.rgb,d=e.castShadowNode.a):(u=K(0),d=$(1)),r&&(d=d.mul(Ue("map","texture",e).a)),i&&(d=d.mul(e.colorNode.a)),l=Te(u,d)}e.depthNode&&e.depthNode.isNode&&(c=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?a=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(a=e.positionNode),s={version:t,colorNode:l,depthNode:c,positionNode:a},this._cacheShadowNodes.set(e,s)}return s}renderObject(e,t,s,r,i,o,a,l=null,c=null){let u=!1,d,h,p,m;if(e.onBeforeRender(this,t,s,r,i,o),i.allowOverride===!0&&t.overrideMaterial!==null){const x=t.overrideMaterial;if(u=!0,d=t.overrideMaterial.colorNode,h=t.overrideMaterial.depthNode,p=t.overrideMaterial.positionNode,m=t.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(x.positionNode=i.positionNode),x.alphaTest=i.alphaTest,x.alphaMap=i.alphaMap,x.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,x.isShadowPassMaterial){const{colorNode:y,depthNode:g,positionNode:b}=this._getShadowNodes(i);x.side=i.shadowSide===null?i.side:i.shadowSide,y!==null&&(x.colorNode=y),g!==null&&(x.depthNode=g),b!==null&&(x.positionNode=b)}i=x}i.transparent===!0&&i.side===zr&&i.forceSinglePass===!1?(i.side=Qt,this._handleObjectFunction(e,i,t,s,a,o,l,"backSide"),i.side=la,this._handleObjectFunction(e,i,t,s,a,o,l,c),i.side=zr):this._handleObjectFunction(e,i,t,s,a,o,l,c),u&&(t.overrideMaterial.colorNode=d,t.overrideMaterial.depthNode=h,t.overrideMaterial.positionNode=p,t.overrideMaterial.side=m),e.onAfterRender(this,t,s,r,i,o)}_renderObjectDirect(e,t,s,r,i,o,a,l){const c=this._objects.get(e,t,s,r,i,this._currentRenderContext,a,l);c.drawRange=e.geometry.drawRange,c.group=o;const u=this._nodes.needsRefresh(c);u&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(c,this.info),u&&this._nodes.updateAfter(c)}_createObjectPipeline(e,t,s,r,i,o,a,l){const c=this._objects.get(e,t,s,r,i,this._currentRenderContext,a,l);c.drawRange=e.geometry.drawRange,c.group=o,this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._pipelines.getForRender(c,this._compilationPromises),this._nodes.updateAfter(c)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class Fw{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function wU(n){return n+(Ys-n%Ys)%Ys}class Ow extends Fw{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return wU(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class jw extends Ow{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let NU=0;class Uw extends jw{constructor(e,t){super("UniformBuffer_"+NU++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class SU extends jw{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let s=0,r=this.uniforms.length;s<r;s++){const i=this.uniforms[s],o=i.boundary,a=i.itemSize*e,l=t%Ys,c=l%o,u=l+c;t+=c,u!==0&&Ys-u<a&&(t+=Ys-u),i.offset=t/e,t+=a}return Math.ceil(t/Ys)*Ys}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);re("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const s=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(s[i]!==r){const a=this._getBufferForType(o);a[i]=s[i]=r,t=!0}return t}updateVector2(e){let t=!1;const s=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(s[i+0]!==r.x||s[i+1]!==r.y){const a=this._getBufferForType(o);a[i+0]=s[i+0]=r.x,a[i+1]=s[i+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const s=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(s[i+0]!==r.x||s[i+1]!==r.y||s[i+2]!==r.z){const a=this._getBufferForType(o);a[i+0]=s[i+0]=r.x,a[i+1]=s[i+1]=r.y,a[i+2]=s[i+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const s=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(s[i+0]!==r.x||s[i+1]!==r.y||s[i+2]!==r.z||s[i+4]!==r.w){const a=this._getBufferForType(o);a[i+0]=s[i+0]=r.x,a[i+1]=s[i+1]=r.y,a[i+2]=s[i+2]=r.z,a[i+3]=s[i+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const s=this.values,r=e.getValue(),i=e.offset;if(s[i+0]!==r.r||s[i+1]!==r.g||s[i+2]!==r.b){const o=this.buffer;o[i+0]=s[i+0]=r.r,o[i+1]=s[i+1]=r.g,o[i+2]=s[i+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const s=this.values,r=e.getValue().elements,i=e.offset;if(s[i+0]!==r[0]||s[i+1]!==r[1]||s[i+2]!==r[2]||s[i+4]!==r[3]||s[i+5]!==r[4]||s[i+6]!==r[5]||s[i+8]!==r[6]||s[i+9]!==r[7]||s[i+10]!==r[8]){const o=this.buffer;o[i+0]=s[i+0]=r[0],o[i+1]=s[i+1]=r[1],o[i+2]=s[i+2]=r[2],o[i+4]=s[i+4]=r[3],o[i+5]=s[i+5]=r[4],o[i+6]=s[i+6]=r[5],o[i+8]=s[i+8]=r[6],o[i+9]=s[i+9]=r[7],o[i+10]=s[i+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const s=this.values,r=e.getValue().elements,i=e.offset;return AU(s,r,i)===!1&&(this.buffer.set(r,i),EU(s,r,i),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function EU(n,e,t){for(let s=0,r=e.length;s<r;s++)n[t+s]=e[s]}function AU(n,e,t){for(let s=0,r=e.length;s<r;s++)if(n[t+s]!==e[s])return!1;return!0}let CU=0;class Vw extends SU{constructor(e,t){super(e),this.id=CU++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class Gw extends Fw{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let RU=0;class MU extends Gw{constructor(e,t){super(e,t),this.id=RU++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class Qu extends MU{constructor(e,t,s,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=s,this.access=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class $w extends Qu{constructor(e,t,s,r=null){super(e,t,s,r),this.isSampledCubeTexture=!0}}class Kf extends Qu{constructor(e,t,s,r=null){super(e,t,s,r),this.isSampledTexture3D=!0}}const Ry={bitcast_int_uint:new St("uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }"),bitcast_uint_int:new St("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }")},PU={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint"},kU={low:"lowp",medium:"mediump",high:"highp"},My={swizzleAssign:!0,storageBuffer:!1},Py={perspective:"smooth",linear:"noperspective"},ky={centroid:"centroid"},Dy=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class DU extends Iw{constructor(e,t){super(e,t,new aU),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Ki}_include(e){const t=Ry[e];return t.build(this),this.addInclude(t),t}getMethod(e){return Ry[e]!==void 0&&this._include(e),PU[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getTernary(e,t,s){return`${e} ? ${t} : ${s}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,s=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${s.vars}

${s.code}
	return ${s.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const s=t.array,r=t.count*t.itemSize,{itemSize:i}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?Jp:Zp;i===2?a=o?em:Zs:i===3?a=o?rC:Qp:i===4&&(a=o?tm:kn);const l={Float32Array:hn,Uint8Array:on,Uint16Array:Ai,Uint32Array:mt,Int8Array:ua,Int16Array:da,Int32Array:Ot,Uint8ClampedArray:on},c=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/i))));let u=Math.ceil(r/i/c);c*u*i<r&&u++;const d=c*u*i,h=new s.constructor(d);h.set(s,0),t.array=h;const p=new G_(t.array,c,u,a,l[t.array.constructor.name]||hn);p.needsUpdate=!0,p.isPBOTexture=!0;const m=new xo(p,null,null);m.setPrecision("high"),t.pboNode=m,t.pbo=m.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:s}=e,r=t.value;if(this.renderer.backend.has(r)){const u=this.renderer.backend.get(r);u.pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(i);this.increaseUsage(s);const a=s.build(this,"uint"),l=this.getDataFromNode(e);let c=l.propertyName;if(c===void 0){const u=this.getVarFromNode(e);c=this.getPropertyName(u);const d=this.getDataFromNode(t);let h=d.propertySizeName;h===void 0&&(h=c+"Size",this.getVarFromNode(t,h,"uint"),this.addLineFlowCode(`${h} = uint( textureSize( ${o}, 0 ).x )`,e),d.propertySizeName=h);const{itemSize:p}=r,m="."+mo.join("").slice(0,p),x=`ivec2(${a} % ${h}, ${a} / ${h})`,y=this.generateTextureLoad(null,o,x,"0",null,null);let g="vec4";r.pbo.type===mt?g="uvec4":r.pbo.type===Ot&&(g="ivec4"),this.addLineFlowCode(`${c} = ${g}(${y})${m}`,e),l.propertyName=c}return c}generateTextureLoad(e,t,s,r,i,o){r===null&&(r="0");let a;return i?o?a=`texelFetchOffset( ${t}, ivec3( ${s}, ${i} ), ${r}, ${o} )`:a=`texelFetch( ${t}, ivec3( ${s}, ${i} ), ${r} )`:o?a=`texelFetchOffset( ${t}, ${s}, ${r}, ${o} )`:a=`texelFetch( ${t}, ${s}, ${r} )`,e!==null&&e.isDepthTexture&&(a+=".x"),a}generateTexture(e,t,s,r,i){return r&&(s=`vec3( ${s}, ${r} )`),e.isDepthTexture?i?`textureOffset( ${t}, ${s}, ${i} ).x`:`texture( ${t}, ${s} ).x`:i?`textureOffset( ${t}, ${s}, ${i} )`:`texture( ${t}, ${s} )`}generateTextureLevel(e,t,s,r,i){return i?`textureLodOffset( ${t}, ${s}, ${r}, ${i} )`:`textureLod( ${t}, ${s}, ${r} )`}generateTextureBias(e,t,s,r,i){return i?`textureOffset( ${t}, ${s}, ${i}, ${r} )`:`texture( ${t}, ${s}, ${r} )`}generateTextureGrad(e,t,s,r,i){return i?`textureGradOffset( ${t}, ${s}, ${r[0]}, ${r[1]}, ${i} )`:`textureGrad( ${t}, ${s}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,s,r,i,o,a=this.shaderStage){if(a==="fragment")return i?o?`textureOffset( ${t}, vec4( ${s}, ${i}, ${r} ), ${o} )`:`texture( ${t}, vec4( ${s}, ${i}, ${r} ) )`:o?`textureOffset( ${t}, vec3( ${s}, ${r} ), ${o} )`:`texture( ${t}, vec3( ${s}, ${r} ) )`;re(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],s=this.vars[e];if(s!==void 0)for(const r of s)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],s=[],r={};for(const o of t){let a=null,l=!1;if(o.type==="texture"||o.type==="texture3D"){const u=o.node.value;let d="";(u.isDataTexture===!0||u.isData3DTexture===!0)&&(u.type===mt?d="u":u.type===Ot&&(d="i")),o.type==="texture3D"&&u.isArrayTexture===!1?a=`${d}sampler3D ${o.name};`:u.compareFunction?u.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:u.isArrayTexture===!0||u.isDataArrayTexture===!0||u.isCompressedArrayTexture===!0?a=`${d}sampler2DArray ${o.name};`:a=`${d}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="buffer"){const u=o.node,d=this.getType(u.bufferType),h=u.bufferCount,p=h>0?h:"";a=`${u.name} {
	${d} ${o.name}[${p}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,l=!0;const c=o.node.precision;if(c!==null&&(a=kU[c]+" "+a),l){a="	"+a;const u=o.groupNode.name;(r[u]||(r[u]=[])).push(a)}else a="uniform "+a,s.push(a)}let i="";for(const o in r){const a=r[o];i+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return i+=s.join(`
`),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ot){let s=e;e.isInterleavedBufferAttribute&&(s=e.data);const r=s.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const s=this.getAttributesArray();let r=0;for(const i of s)t+=`layout( location = ${r++} ) in ${i.type} ${i.name};
`}return t}getStructMembers(e){const t=[];for(const s of e.members)t.push(`	${s.type} ${s.name};`);return t.join(`
`)}getStructs(e){const t=[],s=this.structs[e],r=[];for(const i of s)if(i.output)for(const o of i.members)r.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+i.name+` {
`;o+=this.getStructMembers(i),o+=`
};
`,t.push(o)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const s=this.varyings;if(e==="vertex"||e==="compute")for(const r of s){e==="compute"&&(r.needsInterpolation=!0);const i=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const o=Py[r.interpolationType]||r.interpolationType,a=ky[r.interpolationSampling]||"";t+=`${o} ${a} out ${i} ${r.name};
`}else{const o=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";t+=`${o}out ${i} ${r.name};
`}else t+=`${i} ${r.name};
`}else if(e==="fragment"){for(const r of s)if(r.needsInterpolation){const i=this.getType(r.type);if(r.interpolationType){const o=Py[r.interpolationType]||r.interpolationType,a=ky[r.interpolationSampling]||"";t+=`${o} ${a} in ${i} ${r.name};
`}else{const o=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";t+=`${o}in ${i} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((s,r)=>s*r,1)}u`}getSubgroupSize(){re("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){re("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){re("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,s=this.shaderStage){const r=this.extensions[s]||(this.extensions[s]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const s=this.extensions[e];if(s!==void 0)for(const{name:r,behavior:i}of s.values())t.push(`#extension ${r} : ${i}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=My[e];if(t===void 0){let s;switch(t=!1,e){case"float32Filterable":s="OES_texture_float_linear";break;case"clipDistance":s="WEBGL_clip_cull_distance";break}if(s!==void 0){const r=this.renderer.backend.extensions;r.has(s)&&(r.get(s),t=!0)}My[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let s=0;s<e.length;s++){const r=e[s],i=this.getPropertyName(r.attributeNode);i&&(t+=`${r.varyingName} = ${i};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Dy}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Dy}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let s=`// code

`;s+=this.flowCode[t];const r=this.flowNodes[t],i=r[r.length-1];for(const a of r){const l=this.getFlowData(a),c=a.name;c&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${c}
	`),s+=`${l.code}
	`,a===i&&t!=="compute"&&(s+=`// result
	`,t==="vertex"?(s+="gl_Position = ",s+=`${l.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(s+="fragColor = ",s+=`${l.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=s}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,s,r=null){const i=super.getUniformFromNode(e,t,s,r),o=this.getDataFromNode(e,s,this.globalCache);let a=o.uniformGPU;if(a===void 0){const l=e.groupNode,c=l.name,u=this.getBindGroupArray(c,s);if(t==="texture")a=new Qu(i.name,i.node,l),u.push(a);else if(t==="cubeTexture")a=new $w(i.name,i.node,l),u.push(a);else if(t==="texture3D")a=new Kf(i.name,i.node,l),u.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,i.name=`buffer${e.id}`;const d=new Uw(e,l);d.name=e.name,u.push(d),a=d}else{const d=this.uniformGroups[s]||(this.uniformGroups[s]={});let h=d[c];h===void 0&&(h=new Vw(s+"_"+c,l),d[c]=h,u.push(h)),a=this.getNodeUniform(i,t),h.addUniform(a)}o.uniformGPU=a}return i}}let ch=null,bi=null;class zw{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[Kn.RENDER]:null,[Kn.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),s=this.renderer.info.frame;let r;e.isComputeNode===!0?r="c:"+this.renderer.info.compute.frameCalls:r="r:"+this.renderer.info.render.frameCalls,t.timestampUID=r+":"+e.id+":f"+s}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?Kn.COMPUTE:Kn.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){ft("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const s=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=s,s}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return ch=ch||new Se,this.renderer.getDrawingBufferSize(ch)}setScissorTest(){}getClearColor(){const e=this.renderer;return bi=bi||new Fm,e.getClearColor(bi),bi.getRGB(bi),bi}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:yA(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Su} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let IU=0;class BU{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class LU{constructor(e){this.backend=e}createAttribute(e,t){const s=this.backend,{gl:r}=s,i=e.array,o=e.usage||r.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,l=s.get(a);let c=l.bufferGPU;c===void 0&&(c=this._createBuffer(r,t,i,o),l.bufferGPU=c,l.bufferType=t,l.version=a.version);let u;if(i instanceof Float32Array)u=r.FLOAT;else if(typeof Float16Array<"u"&&i instanceof Float16Array)u=r.HALF_FLOAT;else if(i instanceof Uint16Array)e.isFloat16BufferAttribute?u=r.HALF_FLOAT:u=r.UNSIGNED_SHORT;else if(i instanceof Int16Array)u=r.SHORT;else if(i instanceof Uint32Array)u=r.UNSIGNED_INT;else if(i instanceof Int32Array)u=r.INT;else if(i instanceof Int8Array)u=r.BYTE;else if(i instanceof Uint8Array)u=r.UNSIGNED_BYTE;else if(i instanceof Uint8ClampedArray)u=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);let d={bufferGPU:c,bufferType:t,type:u,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:u===r.INT||u===r.UNSIGNED_INT||e.gpuType===Ot,id:IU++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const h=this._createBuffer(r,t,i,o);d=new BU(d,h)}s.set(e,d)}updateAttribute(e){const t=this.backend,{gl:s}=t,r=e.array,i=e.isInterleavedBufferAttribute?e.data:e,o=t.get(i),a=o.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(s.bindBuffer(a,o.bufferGPU),l.length===0)s.bufferSubData(a,0,r);else{for(let c=0,u=l.length;c<u;c++){const d=l[c];s.bufferSubData(a,d.start*r.BYTES_PER_ELEMENT,r,d.start,d.count)}i.clearUpdateRanges()}s.bindBuffer(a,null),o.version=i.version}destroyAttribute(e){const t=this.backend,{gl:s}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);s.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:s}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(r),o=e.array,a=o.byteLength;s.bindBuffer(s.COPY_READ_BUFFER,i);const l=s.createBuffer();s.bindBuffer(s.COPY_WRITE_BUFFER,l),s.bufferData(s.COPY_WRITE_BUFFER,a,s.STREAM_READ),s.copyBufferSubData(s.COPY_READ_BUFFER,s.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const c=new e.array.constructor(o.length);return s.bindBuffer(s.COPY_WRITE_BUFFER,l),s.getBufferSubData(s.COPY_WRITE_BUFFER,0,c),s.deleteBuffer(l),s.bindBuffer(s.COPY_READ_BUFFER,null),s.bindBuffer(s.COPY_WRITE_BUFFER,null),c.buffer}_createBuffer(e,t,s,r){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,s,r),e.bindBuffer(t,null),i}}let uh,Wo;class FU{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;uh={[vs]:e.FUNC_ADD,[__]:e.FUNC_SUBTRACT,[v_]:e.FUNC_REVERSE_SUBTRACT},Wo={[Hs]:e.ZERO,[P_]:e.ONE,[M_]:e.SRC_COLOR,[R_]:e.SRC_ALPHA,[C_]:e.SRC_ALPHA_SATURATE,[A_]:e.DST_COLOR,[E_]:e.DST_ALPHA,[S_]:e.ONE_MINUS_SRC_COLOR,[N_]:e.ONE_MINUS_SRC_ALPHA,[w_]:e.ONE_MINUS_DST_COLOR,[T_]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),s=e.getParameter(e.VIEWPORT);this.currentScissor=new et().fromArray(t),this.currentViewport=new et().fromArray(s),this._tempVec4=new et}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==vA?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===_A?t.cullFace(t.BACK):e===TA?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:s}=this;e!==t&&(s.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,s,r,i,o,a,l){const{gl:c}=this;if(e===Xi){this.currentBlendingEnabled===!0&&(this.disable(c.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(c.BLEND),this.currentBlendingEnabled=!0),e!==ca){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==vs||this.currentBlendEquationAlpha!==vs)&&(c.blendEquation(c.FUNC_ADD),this.currentBlendEquation=vs,this.currentBlendEquationAlpha=vs),l)switch(e){case Wr:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case Lc:c.blendFunc(c.ONE,c.ONE);break;case Bc:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case Ic:c.blendFuncSeparate(c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA,c.ZERO,c.ONE);break;default:re("WebGLState: Invalid blending: ",e);break}else switch(e){case Wr:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case Lc:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE,c.ONE,c.ONE);break;case Bc:re("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ic:re("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:re("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}i=i||t,o=o||s,a=a||r,(t!==this.currentBlendEquation||i!==this.currentBlendEquationAlpha)&&(c.blendEquationSeparate(uh[t],uh[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),(s!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(c.blendFuncSeparate(Wo[s],Wo[r],Wo[o],Wo[a]),this.currentBlendSrc=s,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case j_:t.depthFunc(t.NEVER);break;case O_:t.depthFunc(t.ALWAYS);break;case F_:t.depthFunc(t.LESS);break;case L_:t.depthFunc(t.LEQUAL);break;case B_:t.depthFunc(t.EQUAL);break;case I_:t.depthFunc(t.GEQUAL);break;case D_:t.depthFunc(t.GREATER);break;case k_:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,s,r){const i=this._tempVec4.set(e,t,s,r);if(this.currentScissor.equals(i)===!1){const{gl:o}=this;o.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,s,r){const i=this._tempVec4.set(e,t,s,r);if(this.currentViewport.equals(i)===!1){const{gl:o}=this;o.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,s){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==s)&&(this.gl.stencilFunc(e,t,s),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=s)}setStencilOp(e,t,s){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==s)&&(this.gl.stencilOp(e,t,s),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=s)}setMaterial(e,t,s){const{gl:r}=this;e.side===zr?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=e.side===Qt;t&&(i=!i),this.setFlipSided(i),e.blending===Wr&&e.transparent===!1?this.setBlending(Xi):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),s>0&&this.currentClippingPlanes!==s)for(let l=0;l<8;l++)l<s?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,s){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==s)&&(r.polygonOffset(t,s),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=s)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const s=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(s.bindVertexArray(e),t!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:s,currentBoundFramebuffers:r}=this;return r[e]!==t?(s.bindFramebuffer(e,t),r[e]=t,e===s.DRAW_FRAMEBUFFER&&(r[s.FRAMEBUFFER]=t),e===s.FRAMEBUFFER&&(r[s.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:s}=this;let r=[],i=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==s.COLOR_ATTACHMENT0){for(let a=0,l=o.length;a<l;a++)r[a]=s.COLOR_ATTACHMENT0+a;r.length=o.length,i=!0}}else r[0]!==s.BACK&&(r[0]=s.BACK,i=!0);i&&s.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:s,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),s!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,s){const{gl:r,currentTextureSlot:i,currentBoundTextures:o,maxTextures:a}=this;s===void 0&&(i===null?s=r.TEXTURE0+a-1:s=i);let l=o[s];l===void 0&&(l={type:void 0,texture:void 0},o[s]=l),(l.type!==e||l.texture!==t)&&(i!==s&&(r.activeTexture(s),this.currentTextureSlot=s),r.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,s){const{gl:r}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]!==s?(r.bindBufferBase(e,t,s),this.currentBoundBufferBases[i]=s,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:s}=this,r=s[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class OU{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Ki){const{gl:s,extensions:r}=this;let i;const o=pt.getTransfer(t);if(e===on)return s.UNSIGNED_BYTE;if(e===wA)return s.UNSIGNED_SHORT_4_4_4_4;if(e===NA)return s.UNSIGNED_SHORT_5_5_5_1;if(e===U_)return s.UNSIGNED_INT_5_9_9_9_REV;if(e===V_)return s.UNSIGNED_INT_10F_11F_11F_REV;if(e===ua)return s.BYTE;if(e===da)return s.SHORT;if(e===Ai)return s.UNSIGNED_SHORT;if(e===Ot)return s.INT;if(e===mt)return s.UNSIGNED_INT;if(e===hn)return s.FLOAT;if(e===Vt)return s.HALF_FLOAT;if(e===SA)return s.ALPHA;if(e===Qp)return s.RGB;if(e===kn)return s.RGBA;if(e===nr)return s.DEPTH_COMPONENT;if(e===tr)return s.DEPTH_STENCIL;if(e===Zp)return s.RED;if(e===Jp)return s.RED_INTEGER;if(e===Zs)return s.RG;if(e===em)return s.RG_INTEGER;if(e===tm)return s.RGBA_INTEGER;if(e===dc||e===hc||e===fc||e===pc)if(o===_e)if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),i!==null){if(e===dc)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===hc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===fc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===pc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=r.get("WEBGL_compressed_texture_s3tc"),i!==null){if(e===dc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===hc)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===fc)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===pc)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===e0||e===t0||e===n0||e===s0)if(i=r.get("WEBGL_compressed_texture_pvrtc"),i!==null){if(e===e0)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===t0)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===n0)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===s0)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Qh||e===Zh||e===Jh)if(i=r.get("WEBGL_compressed_texture_etc"),i!==null){if(e===Qh||e===Zh)return o===_e?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===Jh)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===ef||e===tf||e===nf||e===sf||e===rf||e===of||e===af||e===lf||e===cf||e===uf||e===df||e===hf||e===ff||e===pf)if(i=r.get("WEBGL_compressed_texture_astc"),i!==null){if(e===ef)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===tf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===nf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===sf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===rf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===of)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===af)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===lf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===cf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===uf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===df)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===hf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===ff)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===pf)return o===_e?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===mf)if(i=r.get("EXT_texture_compression_bptc"),i!==null){if(e===mf)return o===_e?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===gf||e===xf||e===yf||e===bf)if(i=r.get("EXT_texture_compression_rgtc"),i!==null){if(e===gf)return i.COMPRESSED_RED_RGTC1_EXT;if(e===xf)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===yf)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===bf)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===er?s.UNSIGNED_INT_24_8:s[e]!==void 0?s[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((s,r)=>{function i(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(i);return}e.deleteSync(t),s()}i()})}}let Iy=!1,$l,dh,By;class jU{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,Iy===!1&&(this._init(),Iy=!0)}_init(){const e=this.gl;$l={[Cu]:e.REPEAT,[Aa]:e.CLAMP_TO_EDGE,[Au]:e.MIRRORED_REPEAT},dh={[Rn]:e.NEAREST,[h_]:e.NEAREST_MIPMAP_NEAREST,[Ca]:e.NEAREST_MIPMAP_LINEAR,[Ln]:e.LINEAR,[Yh]:e.LINEAR_MIPMAP_NEAREST,[Hr]:e.LINEAR_MIPMAP_LINEAR},By={[b_]:e.NEVER,[y_]:e.ALWAYS,[Yp]:e.LESS,[x_]:e.LEQUAL,[g_]:e.EQUAL,[m_]:e.GEQUAL,[p_]:e.GREATER,[f_]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let s;return e.isCubeTexture===!0?s=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?s=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?s=t.TEXTURE_3D:s=t.TEXTURE_2D,s}getInternalFormat(e,t,s,r,i=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];ie("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===o.RED&&(s===o.FLOAT&&(l=o.R32F),s===o.HALF_FLOAT&&(l=o.R16F),s===o.UNSIGNED_BYTE&&(l=o.R8),s===o.UNSIGNED_SHORT&&(l=o.R16),s===o.UNSIGNED_INT&&(l=o.R32UI),s===o.BYTE&&(l=o.R8I),s===o.SHORT&&(l=o.R16I),s===o.INT&&(l=o.R32I)),t===o.RED_INTEGER&&(s===o.UNSIGNED_BYTE&&(l=o.R8UI),s===o.UNSIGNED_SHORT&&(l=o.R16UI),s===o.UNSIGNED_INT&&(l=o.R32UI),s===o.BYTE&&(l=o.R8I),s===o.SHORT&&(l=o.R16I),s===o.INT&&(l=o.R32I)),t===o.RG&&(s===o.FLOAT&&(l=o.RG32F),s===o.HALF_FLOAT&&(l=o.RG16F),s===o.UNSIGNED_BYTE&&(l=o.RG8),s===o.UNSIGNED_SHORT&&(l=o.RG16),s===o.UNSIGNED_INT&&(l=o.RG32UI),s===o.BYTE&&(l=o.RG8I),s===o.SHORT&&(l=o.RG16I),s===o.INT&&(l=o.RG32I)),t===o.RG_INTEGER&&(s===o.UNSIGNED_BYTE&&(l=o.RG8UI),s===o.UNSIGNED_SHORT&&(l=o.RG16UI),s===o.UNSIGNED_INT&&(l=o.RG32UI),s===o.BYTE&&(l=o.RG8I),s===o.SHORT&&(l=o.RG16I),s===o.INT&&(l=o.RG32I)),t===o.RGB){const c=i?Jg:pt.getTransfer(r);s===o.FLOAT&&(l=o.RGB32F),s===o.HALF_FLOAT&&(l=o.RGB16F),s===o.UNSIGNED_BYTE&&(l=o.RGB8),s===o.UNSIGNED_SHORT&&(l=o.RGB16),s===o.UNSIGNED_INT&&(l=o.RGB32UI),s===o.BYTE&&(l=o.RGB8I),s===o.SHORT&&(l=o.RGB16I),s===o.INT&&(l=o.RGB32I),s===o.UNSIGNED_BYTE&&(l=c===_e?o.SRGB8:o.RGB8),s===o.UNSIGNED_SHORT_5_6_5&&(l=o.RGB565),s===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1),s===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGB4),s===o.UNSIGNED_INT_5_9_9_9_REV&&(l=o.RGB9_E5),s===o.UNSIGNED_INT_10F_11F_11F_REV&&(l=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(s===o.UNSIGNED_BYTE&&(l=o.RGB8UI),s===o.UNSIGNED_SHORT&&(l=o.RGB16UI),s===o.UNSIGNED_INT&&(l=o.RGB32UI),s===o.BYTE&&(l=o.RGB8I),s===o.SHORT&&(l=o.RGB16I),s===o.INT&&(l=o.RGB32I)),t===o.RGBA){const c=i?Jg:pt.getTransfer(r);s===o.FLOAT&&(l=o.RGBA32F),s===o.HALF_FLOAT&&(l=o.RGBA16F),s===o.UNSIGNED_BYTE&&(l=o.RGBA8),s===o.UNSIGNED_SHORT&&(l=o.RGBA16),s===o.UNSIGNED_INT&&(l=o.RGBA32UI),s===o.BYTE&&(l=o.RGBA8I),s===o.SHORT&&(l=o.RGBA16I),s===o.INT&&(l=o.RGBA32I),s===o.UNSIGNED_BYTE&&(l=c===_e?o.SRGB8_ALPHA8:o.RGBA8),s===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGBA4),s===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(s===o.UNSIGNED_BYTE&&(l=o.RGBA8UI),s===o.UNSIGNED_SHORT&&(l=o.RGBA16UI),s===o.UNSIGNED_INT&&(l=o.RGBA32UI),s===o.BYTE&&(l=o.RGBA8I),s===o.SHORT&&(l=o.RGBA16I),s===o.INT&&(l=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(s===o.UNSIGNED_SHORT&&(l=o.DEPTH_COMPONENT16),s===o.UNSIGNED_INT&&(l=o.DEPTH_COMPONENT24),s===o.FLOAT&&(l=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&s===o.UNSIGNED_INT_24_8&&(l=o.DEPTH24_STENCIL8),(l===o.R16F||l===o.R32F||l===o.RG16F||l===o.RG32F||l===o.RGBA16F||l===o.RGBA32F)&&a.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:s,extensions:r,backend:i}=this,o=pt.getPrimaries(pt.workingColorSpace),a=t.colorSpace===Ki?null:pt.getPrimaries(t.colorSpace),l=t.colorSpace===Ki||o===a?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),s.texParameteri(e,s.TEXTURE_WRAP_S,$l[t.wrapS]),s.texParameteri(e,s.TEXTURE_WRAP_T,$l[t.wrapT]),(e===s.TEXTURE_3D||e===s.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||s.texParameteri(e,s.TEXTURE_WRAP_R,$l[t.wrapR])),s.texParameteri(e,s.TEXTURE_MAG_FILTER,dh[t.magFilter]);const c=t.mipmaps!==void 0&&t.mipmaps.length>0,u=t.minFilter===Ln&&c?Hr:t.minFilter;if(s.texParameteri(e,s.TEXTURE_MIN_FILTER,dh[u]),t.compareFunction&&(s.texParameteri(e,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(e,s.TEXTURE_COMPARE_FUNC,By[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Rn||t.minFilter!==Ca&&t.minFilter!==Hr||t.type===hn&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const d=r.get("EXT_texture_filter_anisotropic");s.texParameterf(e,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:s,defaultTextures:r}=this,i=this.getGLTextureType(e);let o=r[i];o===void 0&&(o=t.createTexture(),s.state.bindTexture(i,o),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),r[i]=o),s.set(e,{textureGPU:o,glTextureType:i})}createTexture(e,t){const{gl:s,backend:r}=this,{levels:i,width:o,height:a,depth:l}=t,c=r.utils.convert(e.format,e.colorSpace),u=r.utils.convert(e.type),d=this.getInternalFormat(e.internalFormat,c,u,e.colorSpace,e.isVideoTexture),h=s.createTexture(),p=this.getGLTextureType(e);r.state.bindTexture(p,h),this.setTextureParameters(p,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?s.texStorage3D(s.TEXTURE_2D_ARRAY,i,d,o,a,l):e.isData3DTexture?s.texStorage3D(s.TEXTURE_3D,i,d,o,a,l):e.isVideoTexture||s.texStorage2D(p,i,d,o,a),r.set(e,{textureGPU:h,glTextureType:p,glFormat:c,glType:u,glInternalFormat:d})}copyBufferToTexture(e,t){const{gl:s,backend:r}=this,{textureGPU:i,glTextureType:o,glFormat:a,glType:l}=r.get(t),{width:c,height:u}=t.source.data;s.bindBuffer(s.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,i),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texSubImage2D(o,0,0,0,c,u,a,l,0),s.bindBuffer(s.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:s}=this,{width:r,height:i}=t,{textureGPU:o,glTextureType:a,glFormat:l,glType:c,glInternalFormat:u}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const d=e.mipmaps,h=t.image;for(let p=0;p<d.length;p++){const m=d[p];e.isCompressedArrayTexture?e.format!==s.RGBA?l!==null?s.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,p,0,0,0,m.width,m.height,h.depth,l,m.data):ie("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):s.texSubImage3D(s.TEXTURE_2D_ARRAY,p,0,0,0,m.width,m.height,h.depth,l,c,m.data):l!==null?s.compressedTexSubImage2D(s.TEXTURE_2D,p,0,0,m.width,m.height,l,m.data):ie("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images,h=e.mipmaps;for(let p=0;p<6;p++){const m=zl(d[p]);s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,0,0,r,i,l,c,m);for(let x=0;x<h.length;x++){const y=h[x],g=zl(y.images[p]);s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+p,x+1,0,0,g.width,g.height,l,c,g)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const d=t.image;if(e.layerUpdates.size>0){const h=bA(d.width,d.height,e.format,e.type);for(const p of e.layerUpdates){const m=d.data.subarray(p*h/d.data.BYTES_PER_ELEMENT,(p+1)*h/d.data.BYTES_PER_ELEMENT);s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,p,d.width,d.height,1,l,c,m)}e.clearLayerUpdates()}else s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,l,c,d.data)}else if(e.isData3DTexture){const d=t.image;s.texSubImage3D(s.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,l,c,d.data)}else if(e.isVideoTexture)e.update(),s.texImage2D(a,0,u,l,c,t.image);else{const d=e.mipmaps;if(d.length>0)for(let h=0,p=d.length;h<p;h++){const m=d[h],x=zl(m);s.texSubImage2D(a,h,0,0,m.width,m.height,l,c,x)}else{const h=zl(t.image);s.texSubImage2D(a,0,0,0,r,i,l,c,h)}}}generateMipmaps(e){const{gl:t,backend:s}=this,{textureGPU:r,glTextureType:i}=s.get(e);s.state.bindTexture(i,r),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:s}=this;if(e){const r=s.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const i in r.framebuffers)t.deleteFramebuffer(r.framebuffers[i]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let i=0;i<r.msaaRenderbuffers.length;i++)t.deleteRenderbuffer(r.msaaRenderbuffers[i]);delete r.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:s,backend:r}=this,{textureGPU:i,renderTarget:o}=r.get(e);this.deallocateRenderBuffers(o),t===!1&&s.deleteTexture(i),r.delete(e)}copyTextureToTexture(e,t,s=null,r=null,i=0,o=0){const{gl:a,backend:l}=this,{state:c}=this.backend,{textureGPU:u,glTextureType:d,glType:h,glFormat:p}=l.get(t);c.bindTexture(d,u);let m,x,y,g,b,v,_,w,T;const E=e.isCompressedTexture?e.mipmaps[o]:e.image;if(s!==null)m=s.max.x-s.min.x,x=s.max.y-s.min.y,y=s.isBox3?s.max.z-s.min.z:1,g=s.min.x,b=s.min.y,v=s.isBox3?s.min.z:0;else{const O=Math.pow(2,-i);m=Math.floor(E.width*O),x=Math.floor(E.height*O),e.isDataArrayTexture||e.isArrayTexture?y=E.depth:e.isData3DTexture?y=Math.floor(E.depth*O):y=1,g=0,b=0,v=0}r!==null?(_=r.x,w=r.y,T=r.z):(_=0,w=0,T=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const S=a.getParameter(a.UNPACK_ROW_LENGTH),C=a.getParameter(a.UNPACK_IMAGE_HEIGHT),k=a.getParameter(a.UNPACK_SKIP_PIXELS),B=a.getParameter(a.UNPACK_SKIP_ROWS),V=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,E.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,E.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,g),a.pixelStorei(a.UNPACK_SKIP_ROWS,b),a.pixelStorei(a.UNPACK_SKIP_IMAGES,v);const z=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,A=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const O=l.get(e),I=l.get(t),R=l.get(O.renderTarget),F=l.get(I.renderTarget),P=R.framebuffers[O.cacheKey],W=F.framebuffers[I.cacheKey];c.bindFramebuffer(a.READ_FRAMEBUFFER,P),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,W);for(let L=0;L<y;L++)z&&(a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,O.textureGPU,i,v+L),a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,o,T+L)),a.blitFramebuffer(g,b,m,x,_,w,m,x,a.DEPTH_BUFFER_BIT,a.NEAREST);c.bindFramebuffer(a.READ_FRAMEBUFFER,null),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else if(i!==0||e.isRenderTargetTexture||l.has(e)){const O=l.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=a.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=a.createFramebuffer()),c.bindFramebuffer(a.READ_FRAMEBUFFER,this._srcFramebuffer),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let I=0;I<y;I++)z?a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,O.textureGPU,i,v+I):a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,O.textureGPU,i),A?a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,o,T+I):a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,u,o),i!==0?a.blitFramebuffer(g,b,m,x,_,w,m,x,a.COLOR_BUFFER_BIT,a.NEAREST):A?a.copyTexSubImage3D(d,o,_,w,T+I,g,b,m,x):a.copyTexSubImage2D(d,o,_,w,g,b,m,x);c.bindFramebuffer(a.READ_FRAMEBUFFER,null),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else A?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(d,o,_,w,T,m,x,y,p,h,E.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(d,o,_,w,T,m,x,y,p,E.data):a.texSubImage3D(d,o,_,w,T,m,x,y,p,h,E):e.isDataTexture?a.texSubImage2D(a.TEXTURE_2D,o,_,w,m,x,p,h,E.data):e.isCompressedTexture?a.compressedTexSubImage2D(a.TEXTURE_2D,o,_,w,E.width,E.height,p,E.data):a.texSubImage2D(a.TEXTURE_2D,o,_,w,m,x,p,h,E);a.pixelStorei(a.UNPACK_ROW_LENGTH,S),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,C),a.pixelStorei(a.UNPACK_SKIP_PIXELS,k),a.pixelStorei(a.UNPACK_SKIP_ROWS,B),a.pixelStorei(a.UNPACK_SKIP_IMAGES,V),o===0&&t.generateMipmaps&&a.generateMipmap(d),c.unbindTexture()}copyFramebufferToTexture(e,t,s){const{gl:r}=this,{state:i}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:l,z:c,w:u}=s,d=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,h=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(d){const p=a!==0||l!==0;let m,x;if(e.isDepthTexture===!0?(m=r.DEPTH_BUFFER_BIT,x=r.DEPTH_ATTACHMENT,t.stencil&&(m|=r.STENCIL_BUFFER_BIT)):(m=r.COLOR_BUFFER_BIT,x=r.COLOR_ATTACHMENT0),p){const y=this.backend.get(t.renderTarget),g=y.framebuffers[t.getCacheKey()],b=y.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,g),i.bindFramebuffer(r.READ_FRAMEBUFFER,b);const v=h-l-u;r.blitFramebuffer(a,v,a+c,v+u,a,v,a+c,v+u,m,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,g),i.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,v,c,u),i.unbindTexture()}else{const y=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,y),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,x,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,c,u,0,0,c,u,m,r.NEAREST),r.deleteFramebuffer(y)}}else i.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,h-u-l,c,u),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,s,r=!1){const{gl:i}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:l,stencilBuffer:c,width:u,height:d}=o;if(i.bindRenderbuffer(i.RENDERBUFFER,e),l&&!c){let h=i.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,o.samples,h,u,d):s>0?(a&&a.isDepthTexture&&a.type===i.FLOAT&&(h=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,s,h,u,d)):i.renderbufferStorage(i.RENDERBUFFER,h,u,d),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else l&&c&&(s>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,s,i.DEPTH24_STENCIL8,u,d):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,u,d),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,s,r,i,o){const{backend:a,gl:l}=this,{textureGPU:c,glFormat:u,glType:d}=this.backend.get(e),h=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,h);const p=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+o:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,p,c,0);const m=this._getTypedArrayType(d),x=this._getBytesPerTexel(d,u),g=r*i*x,b=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,b),l.bufferData(l.PIXEL_PACK_BUFFER,g,l.STREAM_READ),l.readPixels(t,s,r,i,u,d,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const v=new m(g/m.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,b),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,v),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(h),v}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:s}=this;let r=0;if(e===s.UNSIGNED_BYTE&&(r=1),(e===s.UNSIGNED_SHORT_4_4_4_4||e===s.UNSIGNED_SHORT_5_5_5_1||e===s.UNSIGNED_SHORT_5_6_5||e===s.UNSIGNED_SHORT||e===s.HALF_FLOAT)&&(r=2),(e===s.UNSIGNED_INT||e===s.FLOAT)&&(r=4),t===s.RGBA)return r*4;if(t===s.RGB)return r*3;if(t===s.ALPHA)return r}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function zl(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class UU{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class VU{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const s=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const Ly={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class GU{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:s,mode:r,object:i,type:o,info:a,index:l}=this;l!==0?s.drawElements(r,t,o,e):s.drawArrays(r,e,t),a.update(i,t,1)}renderInstances(e,t,s){const{gl:r,mode:i,type:o,index:a,object:l,info:c}=this;s!==0&&(a!==0?r.drawElementsInstanced(i,t,o,e,s):r.drawArraysInstanced(i,e,t,s),c.update(l,t,s))}renderMultiDraw(e,t,s){const{extensions:r,mode:i,object:o,info:a}=this;if(s===0)return;const l=r.get("WEBGL_multi_draw");if(l===null)for(let c=0;c<s;c++)this.render(e[c],t[c]);else{this.index!==0?l.multiDrawElementsWEBGL(i,t,0,this.type,e,0,s):l.multiDrawArraysWEBGL(i,e,0,t,0,s);let c=0;for(let u=0;u<s;u++)c+=t[u];a.update(o,c,1)}}renderMultiDrawInstances(e,t,s,r){const{extensions:i,mode:o,object:a,info:l}=this;if(s===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<s;u++)this.renderInstances(e[u],t[u],r[u]);else{this.index!==0?c.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,s):c.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,s);let u=0;for(let d=0;d<s;d++)u+=t[d]*r[d];l.update(a,u,1)}}}class Hw{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(ie(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class $U extends Hw{constructor(e,t,s=2048){if(super(s),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){ie("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const s=this.queries[t];if(s)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,s),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){r("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(s){s("Error in endQuery:",s),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[i,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const l=this.queries[o];e.set(i,this.resolveQuery(l))}if(e.size===0)return this.lastValue;const t={},s=[];for(const[i,o]of e){const a=i.match(/^(.*):f(\d+)$/),l=parseInt(a[2]);s.includes(l)===!1&&s.push(l),t[l]===void 0&&(t[l]=0);const c=await o;this.timestamps.set(i,c),t[l]+=c}const r=t[s[s.length-1]];return this.lastValue=r,this.frames=s,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(e){return e("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let s,r=!1;const i=()=>{s&&(clearTimeout(s),s=null)},o=l=>{r||(r=!0,i(),t(l))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){s=setTimeout(a,1);return}const u=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(u)/1e6)}catch(l){l("Error checking query:",l),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class Fy extends zw{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,s={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",s);function i(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=r,this.extensions=new UU(this),this.capabilities=new VU(this),this.attributeUtils=new LU(this),this.textureUtils=new jU(this),this.bufferRenderer=new GU(this),this.state=new FU(this),this.utils=new OU(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return Dc}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,s=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),s!==null){const i=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:s,glInternalFormat:i}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&ie("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new $U(this.gl,e,2048));const s=this.timestampQueryPool[e];s.allocateQueriesForContext(t)!==null&&s.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,s=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:i,height:o}=this.getDrawingBufferSize();t.viewport(0,0,i,o)}if(e.scissor){const{x:i,y:o,width:a,height:l}=e.scissorValue;t.scissor(i,e.height-l-o,a,l)}this.initTimestampQuery(Kn.RENDER,this.getTimestampUID(e)),s.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(s.currentOcclusionQueries=s.occlusionQueries,s.currentOcclusionQueryObjects=s.occlusionQueryObjects,s.lastOcclusionObject=null,s.occlusionQueries=new Array(r),s.occlusionQueryObjects=new Array(r),s.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:s}=this,r=this.get(e),i=r.previousContext;s.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let l=0;l<a.length;l++){const c=a[l];c.generateMipmaps&&this.generateMipmaps(c)}if(this._currentContext=i,this._resolveRenderTarget(e),i!==null)if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:l,height:c}=this.getDrawingBufferSize();s.viewport(0,0,l,c)}this.prepareTimestampBuffer(Kn.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:s,currentOcclusionQueryObjects:r}=t;if(s&&r){const i=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let l=0;for(let c=0;c<s.length;c++){const u=s[c];u!==null&&o.getQueryParameter(u,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(u,o.QUERY_RESULT)===0&&i.add(r[c]),s[c]=null,o.deleteQuery(u),l++)}l<s.length?requestAnimationFrame(a):t.occluded=i};a()}}isOccluded(e,t){const s=this.get(e);return s.occluded&&s.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:s,y:r,width:i,height:o}=e.viewportValue;t.viewport(s,e.height-o-r,i,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,s,r=null,i=!0,o=!0){const{gl:a,renderer:l}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=a.COLOR_BUFFER_BIT),t&&(c|=a.DEPTH_BUFFER_BIT),s&&(c|=a.STENCIL_BUFFER_BIT),c!==0){let u;r.clearColorValue?u=r.clearColorValue:u=this.getClearColor();const d=l.getClearDepth(),h=l.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)a.clearColor(u.r,u.g,u.b,u.a),a.clear(c);else{if(i&&this._setFramebuffer(r),e)for(let p=0;p<r.textures.length;p++)p===0?a.clearBufferfv(a.COLOR,p,[u.r,u.g,u.b,u.a]):a.clearBufferfv(a.COLOR,p,[0,0,0,1]);t&&s?a.clearBufferfi(a.DEPTH_STENCIL,0,d,h):t?a.clearBufferfv(a.DEPTH,0,[d]):s&&a.clearBufferiv(a.STENCIL,0,[h]),i&&o&&this._resolveRenderTarget(r)}}}beginCompute(e){const{state:t,gl:s}=this;t.bindFramebuffer(s.FRAMEBUFFER,null),this.initTimestampQuery(Kn.COMPUTE,this.getTimestampUID(e))}compute(e,t,s,r,i=null){const{state:o,gl:a}=this;this.discard===!1&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:c,attributes:u}=this.get(r),d=this._getVaoKey(u),h=this.vaoCache[d];h===void 0?this.vaoCache[d]=this._createVao(u):o.setVertexState(h),o.useProgram(l),this._bindUniforms(s);const p=this._getTransformFeedback(c);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,p),a.beginTransformFeedback(a.POINTS),i=i!==null?i:t.count,Array.isArray(i)?(ft("WebGLBackend.compute(): The count parameter must be a single number, not an array."),i=i[0]):i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute&&(ft("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),i=t.count),u[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,i):a.drawArrays(a.POINTS,0,i),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let m=0;m<c.length;m++){const x=c[m];x.pbo&&this.has(x.pbo)&&this.textureUtils.copyBufferToTexture(x.transformBuffer,x.pbo),x.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Kn.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:s,material:r,context:i,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(s),{gl:l,state:c}=this,u=this.get(i),d=e.getDrawParameters();if(d===null)return;this._bindUniforms(e.getBindings());const h=t.isMesh&&t.matrixWorld.determinant()<0;c.setMaterial(r,h,o),c.useProgram(a);const p=e.getAttributes(),m=this.get(p);let x=m.vaoGPU;if(x===void 0){const S=this._getVaoKey(p);x=this.vaoCache[S],x===void 0&&(x=this._createVao(p),this.vaoCache[S]=x,m.vaoGPU=x)}const y=e.getIndex(),g=y!==null?this.get(y).bufferGPU:null;c.setVertexState(x,g);const b=u.lastOcclusionObject;if(b!==t&&b!==void 0){if(b!==null&&b.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),t.occlusionTest===!0){const S=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,S),u.occlusionQueries[u.occlusionQueryIndex]=S,u.occlusionQueryObjects[u.occlusionQueryIndex]=t}u.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=l.POINTS:t.isLineSegments?v.mode=l.LINES:t.isLine?v.mode=l.LINE_STRIP:t.isLineLoop?v.mode=l.LINE_LOOP:r.wireframe===!0?(c.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=l.LINES):v.mode=l.TRIANGLES;const{vertexCount:_,instanceCount:w}=d;let{firstVertex:T}=d;if(v.object=t,y!==null){T*=y.array.BYTES_PER_ELEMENT;const S=this.get(y);v.index=y.count,v.type=S.type}else v.index=0;const E=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(ft("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):ft("WebGLBackend: WEBGL_multi_draw not supported."):w>1?v.renderInstances(T,_,w):v.render(T,_)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const S=this.get(e.camera),C=e.camera.cameras,k=e.getBindingGroup("cameraIndex").bindings[0];if(S.indexesGPU===void 0||S.indexesGPU.length!==C.length){const I=new Uint32Array([0,0,0,0]),R=[];for(let F=0,P=C.length;F<P;F++){const W=l.createBuffer();I[0]=F,l.bindBuffer(l.UNIFORM_BUFFER,W),l.bufferData(l.UNIFORM_BUFFER,I,l.STATIC_DRAW),R.push(W)}S.indexesGPU=R}const B=this.get(k),V=this.renderer.getPixelRatio(),z=this._currentContext.renderTarget,A=this._isRenderCameraDepthArray(this._currentContext),O=this._currentContext.activeCubeFace;if(A){const I=this.get(z.depthTexture);if(I.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){I.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:R}=z;for(let F=0,P=C.length;F<P;F++)this.renderer._activeCubeFace=F,this._currentContext.activeCubeFace=F,this._setFramebuffer(this._currentContext),this.clear(!1,!0,R,this._currentContext,!1,!1);this.renderer._activeCubeFace=O,this._currentContext.activeCubeFace=O}}for(let I=0,R=C.length;I<R;I++){const F=C[I];if(t.layers.test(F.layers)){A&&(this.renderer._activeCubeFace=I,this._currentContext.activeCubeFace=I,this._setFramebuffer(this._currentContext));const P=F.viewport;if(P!==void 0){const W=P.x*V,L=P.y*V,G=P.width*V,Z=P.height*V;c.viewport(Math.floor(W),Math.floor(e.context.height-Z-L),Math.floor(G),Math.floor(Z))}c.bindBufferBase(l.UNIFORM_BUFFER,B.index,S.indexesGPU[I]),E()}this._currentContext.activeCubeFace=O,this.renderer._activeCubeFace=O}}else E()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,s,r,i,o){return this.textureUtils.copyTextureToBuffer(e,t,s,r,i,o)}updateSampler(){return""}createNodeBuilder(e,t){return new DU(e,t)}createProgram(e){const t=this.gl,{stage:s,code:r}=e,i=s==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const s=this.gl,r=e.pipeline,{fragmentProgram:i,vertexProgram:o}=r,a=s.createProgram(),l=this.get(i).shaderGPU,c=this.get(o).shaderGPU;if(s.attachShader(a,l),s.attachShader(a,c),s.linkProgram(a),this.set(r,{programGPU:a,fragmentShader:l,vertexShader:c}),t!==null&&this.parallel){const u=new Promise(d=>{const h=this.parallel,p=()=>{s.getProgramParameter(a,h.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),d()):requestAnimationFrame(p)};p()});t.push(u);return}this._completeCompile(e,r)}_handleSource(e,t){const s=e.split(`
`),r=[],i=Math.max(t-6,0),o=Math.min(t+6,s.length);for(let a=i;a<o;a++){const l=a+1;r.push(`${l===t?">":" "} ${l}: ${s[a]}`)}return r.join(`
`)}_getShaderErrors(e,t,s){const r=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(r&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const l=parseInt(a[1]);return s.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),l)}else return o}_logProgramError(e,t,s){if(this.renderer.debug.checkShaderErrors){const r=this.gl,o=(r.getProgramInfoLog(e)||"").trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,s,t);else{const a=this._getShaderErrors(r,s,"vertex"),l=this._getShaderErrors(r,t,"fragment");re("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+a+`
`+l)}else o!==""&&ie("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:s,gl:r}=this,i=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:l}=i;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,a,l),s.useProgram(o);const c=e.getBindings();this._setupBindings(c,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:s,gl:r}=this,i={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(i);const{computeProgram:o}=e,a=r.createProgram(),l=this.get(i).shaderGPU,c=this.get(o).shaderGPU,u=o.transforms,d=[],h=[];for(let y=0;y<u.length;y++){const g=u[y];d.push(g.varyingName),h.push(g.attributeNode)}r.attachShader(a,l),r.attachShader(a,c),r.transformFeedbackVaryings(a,d,r.SEPARATE_ATTRIBS),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,l,c),s.useProgram(a),this._setupBindings(t,a);const p=o.attributes,m=[],x=[];for(let y=0;y<p.length;y++){const g=p[y].node.attribute;m.push(g),this.has(g)||this.attributeUtils.createAttribute(g,r.ARRAY_BUFFER)}for(let y=0;y<h.length;y++){const g=h[y].attribute;this.has(g)||this.attributeUtils.createAttribute(g,r.ARRAY_BUFFER);const b=this.get(g);x.push(b)}this.set(e,{programGPU:a,transformBuffers:x,attributes:m})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let s=0,r=0;for(const i of t){this.set(i,{textures:r,uniformBuffers:s});for(const o of i.bindings)o.isUniformBuffer&&s++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,s=this.get(e);let r=s.uniformBuffers,i=s.textures;for(const o of e.bindings){const a=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const l=o.buffer;let{bufferGPU:c}=this.get(l);c===void 0?(c=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW),this.set(l,{bufferGPU:c})):(t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferSubData(t.UNIFORM_BUFFER,0,l)),a.index=r++,a.bufferGPU=c,this.set(o,a)}else if(o.isSampledTexture){const{textureGPU:l,glTextureType:c}=this.get(o.texture);a.index=i++,a.textureGPU=l,a.glTextureType=c,this.set(o,a)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,i=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,i,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(Ly).filter(r=>Ly[r]===e),s=this.extensions;for(let r=0;r<t.length;r++)if(s.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,s=null,r=null,i=0,o=0){this.textureUtils.copyTextureToTexture(e,t,s,r,i,o)}copyFramebufferToTexture(e,t,s){this.textureUtils.copyFramebufferToTexture(e,t,s)}_setFramebuffer(e){const{gl:t,state:s}=this;let r=null;if(e.textures!==null){const i=e.renderTarget,o=this.get(i),{samples:a,depthBuffer:l,stencilBuffer:c}=i,u=i.isWebGLCubeRenderTarget===!0,d=i.isRenderTarget3D===!0,h=i.depth>1,p=i.isXRRenderTarget===!0,m=p===!0&&i._hasExternalTextures===!0;let x=o.msaaFrameBuffer,y=o.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),b=this.extensions.get("OVR_multiview2"),v=this._useMultisampledExtension(i),_=Nw(e);let w;if(u?(o.cubeFramebuffers||(o.cubeFramebuffers={}),w=o.cubeFramebuffers[_]):p&&m===!1?w=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),w=o.framebuffers[_]),w===void 0){w=t.createFramebuffer(),s.bindFramebuffer(t.FRAMEBUFFER,w);const T=e.textures,E=[];if(u){o.cubeFramebuffers[_]=w;const{textureGPU:C}=this.get(T[0]),k=this.renderer._activeCubeFace,B=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+k,C,B)}else{o.framebuffers[_]=w;for(let C=0;C<T.length;C++){const k=T[C],B=this.get(k);B.renderTarget=e.renderTarget,B.cacheKey=_;const V=t.COLOR_ATTACHMENT0+C;if(i.multiview)b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,V,B.textureGPU,0,a,0,2);else if(d||h){const z=this.renderer._activeCubeFace,A=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,V,B.textureGPU,A,z)}else if(v)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,V,t.TEXTURE_2D,B.textureGPU,0,a);else{const z=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,V,t.TEXTURE_2D,B.textureGPU,z)}}}const S=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const C=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(C,e,0,v),o.xrDepthRenderbuffer=C,E.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,C),t.framebufferRenderbuffer(t.FRAMEBUFFER,S,t.RENDERBUFFER,C)}else if(e.depthTexture!==null){E.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const C=this.get(e.depthTexture);if(C.renderTarget=e.renderTarget,C.cacheKey=_,i.multiview)b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,S,C.textureGPU,0,a,0,2);else if(m&&v)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const k=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,S,C.textureGPU,0,k)}else t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0)}o.depthInvalidationArray=E}else{if(this._isRenderCameraDepthArray(e)){s.bindFramebuffer(t.FRAMEBUFFER,w);const E=this.renderer._activeCubeFace,S=this.get(e.depthTexture),C=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,C,S.textureGPU,0,E)}if((p||v||i.multiview)&&i._isOpaqueFramebuffer!==!0){s.bindFramebuffer(t.FRAMEBUFFER,w);const E=this.get(e.textures[0]);i.multiview?b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,E.textureGPU,0,a,0,2):v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,E.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,E.textureGPU,0);const S=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const C=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,C),t.framebufferRenderbuffer(t.FRAMEBUFFER,S,t.RENDERBUFFER,C)}else{const C=this.get(e.depthTexture);i.multiview?b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,S,C.textureGPU,0,a,0,2):v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0)}}}if(a>0&&v===!1&&!i.multiview){if(x===void 0){const T=[];x=t.createFramebuffer(),s.bindFramebuffer(t.FRAMEBUFFER,x);const E=[],S=e.textures;for(let C=0;C<S.length;C++){E[C]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,E[C]),T.push(t.COLOR_ATTACHMENT0+C);const k=e.textures[C],B=this.get(k);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,B.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+C,t.RENDERBUFFER,E[C])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=x,o.msaaRenderbuffers=E,l&&y===void 0){y=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(y,e,a),o.depthRenderbuffer=y;const C=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;T.push(C)}o.invalidationArray=T}r=o.msaaFrameBuffer}else r=w;s.drawBuffers(e,w)}s.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let s=0;s<e.length;s++){const r=this.get(e[s]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,s=t.createVertexArray();t.bindVertexArray(s);for(let r=0;r<e.length;r++){const i=e[r],o=this.get(i);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(r);let a,l;i.isInterleavedBufferAttribute===!0?(a=i.data.stride*o.bytesPerElement,l=i.offset*o.bytesPerElement):(a=0,l=0),o.isInteger?t.vertexAttribIPointer(r,i.itemSize,o.type,a,l):t.vertexAttribPointer(r,i.itemSize,o.type,i.normalized,a,l),i.isInstancedBufferAttribute&&!i.isInterleavedBufferAttribute?t.vertexAttribDivisor(r,i.meshPerAttribute):i.isInterleavedBufferAttribute&&i.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(r,i.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),s}_getTransformFeedback(e){let t="";for(let i=0;i<e.length;i++)t+=":"+e[i].id;let s=this.transformFeedbackCache[t];if(s!==void 0)return s;const{gl:r}=this;s=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,s);for(let i=0;i<e.length;i++){const o=e[i];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,i,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=s,s}_setupBindings(e,t){const s=this.gl;for(const r of e)for(const i of r.bindings){const a=this.get(i).index;if(i.isUniformsGroup||i.isUniformBuffer){const l=s.getUniformBlockIndex(t,i.name);s.uniformBlockBinding(t,l,a)}else if(i.isSampledTexture){const l=s.getUniformLocation(t,i.name);s.uniform1i(l,a)}}}_bindUniforms(e){const{gl:t,state:s}=this;for(const r of e)for(const i of r.bindings){const o=this.get(i),a=o.index;i.isUniformsGroup||i.isUniformBuffer?s.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):i.isSampledTexture&&s.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_resolveRenderTarget(e){const{gl:t,state:s}=this,r=e.renderTarget;if(e.textures!==null&&r){const i=this.get(r);if(r.samples>0&&this._useMultisampledExtension(r)===!1){const o=i.framebuffers[e.getCacheKey()];let a=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT));const l=i.msaaFrameBuffer,c=i.msaaRenderbuffers,u=e.textures,d=u.length>1;if(s.bindFramebuffer(t.READ_FRAMEBUFFER,l),s.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),d)for(let h=0;h<u.length;h++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.TEXTURE_2D,null,0);for(let h=0;h<u.length;h++){if(d){const{textureGPU:p}=this.get(u[h]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c[h]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,p,0)}if(e.scissor){const{x:p,y:m,width:x,height:y}=e.scissorValue,g=e.height-y-m;t.blitFramebuffer(p,g,p+x,g+y,p,g,p+x,g+y,a,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST)}if(d)for(let h=0;h<u.length;h++){const{textureGPU:p}=this.get(u[h]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.RENDERBUFFER,c[h]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.TEXTURE_2D,p,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray)}else if(r.resolveDepthBuffer===!1&&i.framebuffers){const o=i.framebuffers[e.getCacheKey()];s.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Mi={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Nt={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Ft={Store:"store"},Be={Load:"load",Clear:"clear"},Oy={CCW:"ccw",CW:"cw"},jy={None:"none",Back:"back"},ro={Uint16:"uint16",Uint32:"uint32"},M={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},hh={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Lr={Linear:"linear",Nearest:"nearest"},Ae={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Sr={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},Uy={None:0,All:15},Vs={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},fh={Storage:"storage",ReadOnlyStorage:"read-only-storage"},ph={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},Vy={NonFiltering:"non-filtering",Comparison:"comparison"},Er={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},Gy={TwoD:"2d",ThreeD:"3d"},ht={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},zU={All:"all"},Hl={Vertex:"vertex",Instance:"instance"},Xf={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},$y={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class HU extends Gw{constructor(e,t,s){super(e,t?t.value:null),this.textureNode=t,this.groupNode=s}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class WU extends Ow{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let qU=0;class KU extends WU{constructor(e,t){super("StorageBuffer_"+qU++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Xn.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class XU extends hr{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Lr.Linear}),this.flipYSampler=e.createSampler({minFilter:Lr.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:s}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Mi.TriangleStrip,stripIndexFormat:ro.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Mi.TriangleStrip,stripIndexFormat:ro.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,s=0){const r=t.format,{width:i,height:o}=t.size,a=this.getTransferPipeline(r),l=this.getFlipYPipeline(r),c=this.device.createTexture({size:{width:i,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:s}),d=c.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),p=(m,x,y)=>{const g=m.getBindGroupLayout(0),b=this.device.createBindGroup({layout:g,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:x}]}),v=h.beginRenderPass({colorAttachments:[{view:y,loadOp:Be.Clear,storeOp:Ft.Store,clearValue:[0,0,0,0]}]});v.setPipeline(m),v.setBindGroup(0,b),v.draw(4,1,0,0),v.end()};p(a,u,d),p(l,d,u),this.device.queue.submit([h.finish()]),c.destroy()}generateMipmaps(e,t,s=0,r=null){const i=this.get(e);i.layers===void 0&&(i.layers=[]);const o=i.layers[s]||this._mipmapCreateBundles(e,t,s),a=r||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,o),r===null&&this.device.queue.submit([a.finish()]),i.layers[s]=o}_mipmapCreateBundles(e,t,s){const r=this.getTransferPipeline(t.format),i=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:s});const a=[];for(let l=1;l<t.mipLevelCount;l++){const c=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),u=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:s}),d={colorAttachments:[{view:u,loadOp:Be.Clear,storeOp:Ft.Store,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[t.format]});h.setPipeline(r),h.setBindGroup(0,c),h.draw(4,1,0,0),a.push({renderBundles:[h.finish()],passDescriptor:d}),o=u}return a}_mipmapRunBundles(e,t){const s=t.length;for(let r=0;r<s;r++){const i=t[r],o=e.beginRenderPass(i.passDescriptor);o.executeBundles(i.renderBundles),o.end()}}}const YU={[b_]:"never",[Yp]:"less",[g_]:"equal",[x_]:"less-equal",[p_]:"greater",[m_]:"greater-equal",[y_]:"always",[f_]:"not-equal"},QU=[0,1,3,2,4,5];class ZU{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,s=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let r=this._samplerCache.get(s);if(r===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Lr.Linear&&o.minFilter===Lr.Linear&&o.mipmapFilter===Lr.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=YU[e.compareFunction]),r={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(s,r)}const i=t.get(e);if(i.sampler!==r.sampler){if(i.sampler!==void 0){const o=this._samplerCache.get(i.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=s,i.sampler=r.sampler,r.usedTimes++}return s}createDefaultTexture(e){let t;const s=Yf(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(s):t=this._getDefaultTextureGPU(s),this.backend.get(e).texture=t}createTexture(e,t={}){const s=this.backend,r=s.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){r.texture=e.sourceTexture,r.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:i,height:o,depth:a,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const c=this._getDimension(e),u=e.internalFormat||t.format||Yf(e,s.device);r.format=u;const{samples:d,primarySamples:h,isMSAA:p}=s.utils.getTextureSampleData(e);let m=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(m|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&u!==M.RGB9E5UFloat&&(m|=GPUTextureUsage.RENDER_ATTACHMENT);const x={label:e.name,size:{width:i,height:o,depthOrArrayLayers:a},mipLevelCount:l,sampleCount:h,dimension:c,format:u,usage:m};if(u===void 0){ie("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(x.textureBindingViewDimension=ht.Cube),r.texture=s.device.createTexture(x),p){const y=Object.assign({},x);y.label=y.label+"-msaa",y.sampleCount=d,y.mipLevelCount=1,r.msaaTexture=s.device.createTexture(y)}r.initialized=!0,r.textureDescriptorGPU=x}destroyTexture(e,t=!1){const s=this.backend,r=s.get(e);r.texture!==void 0&&t===!1&&r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),s.delete(e)}generateMipmaps(e,t=null){const s=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(s.texture,s.textureDescriptorGPU,r,t);else{const r=e.image.depth||1;for(let i=0;i<r;i++)this._generateMipmaps(s.texture,s.textureDescriptorGPU,i,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:s,height:r}=e.getDrawingBufferSize(),i=e.renderer.currentSamples,o=t.colorTexture,a=e.get(o);if(o.width===s&&o.height===r&&o.samples===i)return a.texture;let l=a.texture;return l&&l.destroy(),l=e.device.createTexture({label:"colorBuffer",size:{width:s,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=s,o.source.height=r,o.samples=i,a.texture=l,l}getDepthBuffer(e=!0,t=!1){const s=this.backend,r=s.renderer.getCanvasTarget(),{width:i,height:o}=s.getDrawingBufferSize(),a=s.renderer.currentSamples,l=r.depthTexture;if(l.width===i&&l.height===o&&l.samples===a&&l.depth===e&&l.stencil===t)return s.get(l).texture;const c=s.get(l).texture;let u,d;if(t?(u=tr,d=er):e&&(u=nr,d=mt),c!==void 0){if(l.image.width===i&&l.image.height===o&&l.format===u&&l.type===d&&l.samples===a)return c;this.destroyTexture(l)}return l.name="depthBuffer",l.format=u,l.type=d,l.image.width=i,l.image.height=o,l.samples=a,this.createTexture(l,{width:i,height:o}),s.get(l).texture}updateTexture(e,t){const s=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:i}=s;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)if(r.length>0)for(let o=0,a=r.length;o<a;o++){const l=r[o];this._copyBufferToTexture(l,s.texture,i,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,s.texture,i,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,s.texture,i,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,s.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,s.texture,i);else if(r.length>0)for(let o=0,a=r.length;o<a;o++){const l=r[o];this._copyImageToTexture(l,s.texture,i,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,s.texture,i,0,e.flipY,e.premultiplyAlpha);s.version=e.version}}async copyTextureToBuffer(e,t,s,r,i,o){const a=this.backend.device,l=this.backend.get(e),c=l.texture,u=l.textureDescriptorGPU.format,d=this._getBytesPerTexel(u);let h=r*d;h=Math.ceil(h/256)*256;const p=a.createBuffer({size:(i-1)*h+r*d,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),m=a.createCommandEncoder();m.copyTextureToBuffer({texture:c,origin:{x:t,y:s,z:o}},{buffer:p,bytesPerRow:h},{width:r,height:i});const x=this._getTypedArrayType(u);a.queue.submit([m.finish()]),await p.mapAsync(GPUMapMode.READ);const y=p.getMappedRange();return new x(y)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const s=new Xp;s.minFilter=Rn,s.magFilter=Rn,this.createTexture(s,{width:1,height:1,format:e}),this.defaultTexture[e]=t=s}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const s=new Kp;s.minFilter=Rn,s.magFilter=Rn,this.createTexture(s,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=s}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,s){const r=e.images,i=e.mipmaps;for(let o=0;o<6;o++){const a=r[o],l=e.flipY===!0?QU[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,s,l,e.flipY):this._copyImageToTexture(a,t,s,l,e.flipY,e.premultiplyAlpha);for(let c=0;c<i.length;c++){const d=i[c].images[o];d.isDataTexture?this._copyBufferToTexture(d.image,t,s,l,e.flipY,0,c+1):this._copyImageToTexture(d,t,s,l,e.flipY,e.premultiplyAlpha,c+1)}}}_copyImageToTexture(e,t,s,r,i,o,a=0){const l=this.backend.device,c=a>0?e.width:s.size.width,u=a>0?e.height:s.size.height;l.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:a,origin:{x:0,y:0,z:r},premultipliedAlpha:o},{width:c,height:u,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new XU(this.backend.device)),e}_generateMipmaps(e,t,s=0,r=null){this._getPassUtils().generateMipmaps(e,t,s,r)}_flipY(e,t,s=0){this._getPassUtils().flipY(e,t,s)}_copyBufferToTexture(e,t,s,r,i,o=0,a=0){const l=this.backend.device,c=e.data,u=this._getBytesPerTexel(s.format),d=e.width*u;l.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:r}},c,{offset:e.width*e.height*u*o,bytesPerRow:d},{width:e.width,height:e.height,depthOrArrayLayers:1}),i===!0&&this._flipY(t,s,r)}_copyCompressedBufferToTexture(e,t,s){const r=this.backend.device,i=this._getBlockData(s.format),o=s.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const l=e[a],c=l.width,u=l.height,d=o?s.size.depthOrArrayLayers:1,h=Math.ceil(c/i.width)*i.byteLength,p=h*Math.ceil(u/i.height);for(let m=0;m<d;m++)r.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:m}},l.data,{offset:m*p,bytesPerRow:h,rowsPerImage:Math.ceil(u/i.height)},{width:Math.ceil(c/i.width)*i.width,height:Math.ceil(u/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===M.BC1RGBAUnorm||e===M.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===M.BC2RGBAUnorm||e===M.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.BC3RGBAUnorm||e===M.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.BC4RUnorm||e===M.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===M.BC5RGUnorm||e===M.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===M.BC6HRGBUFloat||e===M.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===M.BC7RGBAUnorm||e===M.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.ETC2RGB8Unorm||e===M.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===M.ETC2RGB8A1Unorm||e===M.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===M.ETC2RGBA8Unorm||e===M.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===M.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===M.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===M.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===M.ASTC4x4Unorm||e===M.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.ASTC5x4Unorm||e===M.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===M.ASTC5x5Unorm||e===M.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===M.ASTC6x5Unorm||e===M.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===M.ASTC6x6Unorm||e===M.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===M.ASTC8x5Unorm||e===M.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===M.ASTC8x6Unorm||e===M.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===M.ASTC8x8Unorm||e===M.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===M.ASTC10x5Unorm||e===M.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===M.ASTC10x6Unorm||e===M.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===M.ASTC10x8Unorm||e===M.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===M.ASTC10x10Unorm||e===M.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===M.ASTC12x10Unorm||e===M.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===M.ASTC12x12Unorm||e===M.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=hh.ClampToEdge;return e===Cu?t=hh.Repeat:e===Au&&(t=hh.MirrorRepeat),t}_convertFilterMode(e){let t=Lr.Linear;return(e===Rn||e===h_||e===Ca)&&(t=Lr.Nearest),t}_getBytesPerTexel(e){if(e===M.R8Unorm||e===M.R8Snorm||e===M.R8Uint||e===M.R8Sint)return 1;if(e===M.R16Uint||e===M.R16Sint||e===M.R16Float||e===M.RG8Unorm||e===M.RG8Snorm||e===M.RG8Uint||e===M.RG8Sint)return 2;if(e===M.R32Uint||e===M.R32Sint||e===M.R32Float||e===M.RG16Uint||e===M.RG16Sint||e===M.RG16Float||e===M.RGBA8Unorm||e===M.RGBA8UnormSRGB||e===M.RGBA8Snorm||e===M.RGBA8Uint||e===M.RGBA8Sint||e===M.BGRA8Unorm||e===M.BGRA8UnormSRGB||e===M.RGB9E5UFloat||e===M.RGB10A2Unorm||e===M.RG11B10UFloat||e===M.Depth32Float||e===M.Depth24Plus||e===M.Depth24PlusStencil8||e===M.Depth32FloatStencil8)return 4;if(e===M.RG32Uint||e===M.RG32Sint||e===M.RG32Float||e===M.RGBA16Uint||e===M.RGBA16Sint||e===M.RGBA16Float)return 8;if(e===M.RGBA32Uint||e===M.RGBA32Sint||e===M.RGBA32Float)return 16}_getTypedArrayType(e){if(e===M.R8Uint)return Uint8Array;if(e===M.R8Sint)return Int8Array;if(e===M.R8Unorm)return Uint8Array;if(e===M.R8Snorm)return Int8Array;if(e===M.RG8Uint)return Uint8Array;if(e===M.RG8Sint)return Int8Array;if(e===M.RG8Unorm)return Uint8Array;if(e===M.RG8Snorm)return Int8Array;if(e===M.RGBA8Uint)return Uint8Array;if(e===M.RGBA8Sint)return Int8Array;if(e===M.RGBA8Unorm||e===M.RGBA8UnormSRGB)return Uint8Array;if(e===M.RGBA8Snorm)return Int8Array;if(e===M.R16Uint)return Uint16Array;if(e===M.R16Sint)return Int16Array;if(e===M.RG16Uint)return Uint16Array;if(e===M.RG16Sint)return Int16Array;if(e===M.RGBA16Uint)return Uint16Array;if(e===M.RGBA16Sint)return Int16Array;if(e===M.R16Float||e===M.RG16Float||e===M.RGBA16Float)return Uint16Array;if(e===M.R32Uint)return Uint32Array;if(e===M.R32Sint)return Int32Array;if(e===M.R32Float)return Float32Array;if(e===M.RG32Uint)return Uint32Array;if(e===M.RG32Sint)return Int32Array;if(e===M.RG32Float)return Float32Array;if(e===M.RGBA32Uint)return Uint32Array;if(e===M.RGBA32Sint)return Int32Array;if(e===M.RGBA32Float)return Float32Array;if(e===M.BGRA8Unorm||e===M.BGRA8UnormSRGB)return Uint8Array;if(e===M.RGB10A2Unorm||e===M.RGB9E5UFloat||e===M.RG11B10UFloat)return Uint32Array;if(e===M.Depth32Float)return Float32Array;if(e===M.Depth24Plus||e===M.Depth24PlusStencil8)return Uint32Array;if(e===M.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=Gy.ThreeD:t=Gy.TwoD,t}}function Yf(n,e=null){const t=n.format,s=n.type,r=n.colorSpace,i=pt.getTransfer(r);let o;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case dc:case hc:o=i===_e?M.BC1RGBAUnormSRGB:M.BC1RGBAUnorm;break;case fc:o=i===_e?M.BC2RGBAUnormSRGB:M.BC2RGBAUnorm;break;case pc:o=i===_e?M.BC3RGBAUnormSRGB:M.BC3RGBAUnorm;break;case gf:o=M.BC4RUnorm;break;case xf:o=M.BC4RSnorm;break;case yf:o=M.BC5RGUnorm;break;case bf:o=M.BC5RGSnorm;break;case mf:o=i===_e?M.BC7RGBAUnormSRGB:M.BC7RGBAUnorm;break;case Zh:case Qh:o=i===_e?M.ETC2RGB8UnormSRGB:M.ETC2RGB8Unorm;break;case Jh:o=i===_e?M.ETC2RGBA8UnormSRGB:M.ETC2RGBA8Unorm;break;case ef:o=i===_e?M.ASTC4x4UnormSRGB:M.ASTC4x4Unorm;break;case tf:o=i===_e?M.ASTC5x4UnormSRGB:M.ASTC5x4Unorm;break;case nf:o=i===_e?M.ASTC5x5UnormSRGB:M.ASTC5x5Unorm;break;case sf:o=i===_e?M.ASTC6x5UnormSRGB:M.ASTC6x5Unorm;break;case rf:o=i===_e?M.ASTC6x6UnormSRGB:M.ASTC6x6Unorm;break;case of:o=i===_e?M.ASTC8x5UnormSRGB:M.ASTC8x5Unorm;break;case af:o=i===_e?M.ASTC8x6UnormSRGB:M.ASTC8x6Unorm;break;case lf:o=i===_e?M.ASTC8x8UnormSRGB:M.ASTC8x8Unorm;break;case cf:o=i===_e?M.ASTC10x5UnormSRGB:M.ASTC10x5Unorm;break;case uf:o=i===_e?M.ASTC10x6UnormSRGB:M.ASTC10x6Unorm;break;case df:o=i===_e?M.ASTC10x8UnormSRGB:M.ASTC10x8Unorm;break;case hf:o=i===_e?M.ASTC10x10UnormSRGB:M.ASTC10x10Unorm;break;case ff:o=i===_e?M.ASTC12x10UnormSRGB:M.ASTC12x10Unorm;break;case pf:o=i===_e?M.ASTC12x12UnormSRGB:M.ASTC12x12Unorm;break;case kn:o=i===_e?M.RGBA8UnormSRGB:M.RGBA8Unorm;break;default:re("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case kn:switch(s){case ua:o=M.RGBA8Snorm;break;case da:o=M.RGBA16Sint;break;case Ai:o=M.RGBA16Uint;break;case mt:o=M.RGBA32Uint;break;case Ot:o=M.RGBA32Sint;break;case on:o=i===_e?M.RGBA8UnormSRGB:M.RGBA8Unorm;break;case Vt:o=M.RGBA16Float;break;case hn:o=M.RGBA32Float;break;default:re("WebGPURenderer: Unsupported texture type with RGBAFormat.",s)}break;case Qp:switch(s){case U_:o=M.RGB9E5UFloat;break;case V_:o=M.RG11B10UFloat;break;default:re("WebGPURenderer: Unsupported texture type with RGBFormat.",s)}break;case Zp:switch(s){case ua:o=M.R8Snorm;break;case da:o=M.R16Sint;break;case Ai:o=M.R16Uint;break;case mt:o=M.R32Uint;break;case Ot:o=M.R32Sint;break;case on:o=M.R8Unorm;break;case Vt:o=M.R16Float;break;case hn:o=M.R32Float;break;default:re("WebGPURenderer: Unsupported texture type with RedFormat.",s)}break;case Zs:switch(s){case ua:o=M.RG8Snorm;break;case da:o=M.RG16Sint;break;case Ai:o=M.RG16Uint;break;case mt:o=M.RG32Uint;break;case Ot:o=M.RG32Sint;break;case on:o=M.RG8Unorm;break;case Vt:o=M.RG16Float;break;case hn:o=M.RG32Float;break;default:re("WebGPURenderer: Unsupported texture type with RGFormat.",s)}break;case nr:switch(s){case Ai:o=M.Depth16Unorm;break;case mt:o=M.Depth24Plus;break;case hn:o=M.Depth32Float;break;default:re("WebGPURenderer: Unsupported texture type with DepthFormat.",s)}break;case tr:switch(s){case er:o=M.Depth24PlusStencil8;break;case hn:e&&e.features.has(Xf.Depth32FloatStencil8)===!1&&re('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=M.Depth32FloatStencil8;break;default:re("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",s)}break;case Jp:switch(s){case Ot:o=M.R32Sint;break;case mt:o=M.R32Uint;break;default:re("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",s)}break;case em:switch(s){case Ot:o=M.RG32Sint;break;case mt:o=M.RG32Uint;break;default:re("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",s)}break;case tm:switch(s){case Ot:o=M.RGBA32Sint;break;case mt:o=M.RGBA32Uint;break;default:re("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",s)}break;default:re("WebGPURenderer: Unsupported texture format.",t)}return o}const JU=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,eV=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,zy={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},tV=n=>{n=n.trim();const e=n.match(JU);if(e!==null&&e.length===4){const t=e[2],s=[];let r=null;for(;(r=eV.exec(t))!==null;)s.push({name:r[1],type:r[2]});const i=[];for(let u=0;u<s.length;u++){const{name:d,type:h}=s[u];let p=h;p.startsWith("ptr")?p="pointer":(p.startsWith("texture")&&(p=h.split("<")[0]),p=zy[p]),i.push(new Um(p,d))}const o=n.substring(e[0].length),a=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:zy[a]||a,inputs:i,name:l,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class nV extends Gm{constructor(e){const{type:t,inputs:s,name:r,inputsCode:i,blockCode:o,outputType:a}=tV(e);super(t,s,r),this.inputsCode=i,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class sV extends Bw{parseFunction(e){return new nV(e)}}const vi=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},rV={[Xn.READ_ONLY]:"read",[Xn.WRITE_ONLY]:"write",[Xn.READ_WRITE]:"read_write"},Hy={[Cu]:"repeat",[Aa]:"clamp",[Au]:"mirror"},Wl={vertex:vi?vi.VERTEX:1,fragment:vi?vi.FRAGMENT:2,compute:vi?vi.COMPUTE:4},Wy={instance:!0,swizzleAssign:!1,storageBuffer:!0},iV={"^^":"tsl_xor"},oV={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},qy={},qo={tsl_xor:new St("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new St("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new St("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new St("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new St("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new St("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new St("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new St("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new St("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new St("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new St("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new St("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new St(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},aV={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};let Ww="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(Ww+=`diagnostic( off, derivative_uniformity );
`);class lV extends Iw{constructor(e,t){super(e,t,new sV),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,s,r,i,o=this.shaderStage){return o==="fragment"?r?i?`textureSample( ${t}, ${t}_sampler, ${s}, ${r}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${s}, ${r} )`:i?`textureSample( ${t}, ${t}_sampler, ${s}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${s} )`:this.generateTextureSampleLevel(e,t,s,"0",r)}generateTextureSampleLevel(e,t,s,r,i,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,s,o,r):this.generateTextureLod(e,t,s,i,o,r)}generateWrapFunction(e){const t=`tsl_coord_${Hy[e.wrapS]}S_${Hy[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let s=qy[t];if(s===void 0){const r=[],i=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${i} ) -> ${i} {

	return ${i}(
`;const a=(l,c)=>{l===Cu?(r.push(qo.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${c} )`):l===Aa?(r.push(qo.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${c} )`):l===Au?(r.push(qo.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${c} )`):(o+=`		coord.${c}`,ie(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,qy[t]=s=new St(o,r)}return s.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,s){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[s];if(r.dimensionsSnippet[s]===void 0){let o,a;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),c=l>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",c||e.isStorageTexture?o=t:o=`${t}${s?`, u32( ${s} )`:""}`,i=new vc(new _c(`textureDimensions( ${o} )`,a)),r.dimensionsSnippet[s]=i,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new vc(new _c(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new vc(new _c("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,s,r,i="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,i);return r&&(s=`${s} + vec2<f32>(${r}) / ${a}`),`tsl_biquadraticTexture( ${t}, ${o}( ${s} ), ${a}, u32( ${i} ) )`}generateTextureLod(e,t,s,r,i,o="0u"){const a=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,o),c=e.isData3DTexture?"vec3":"vec2";i&&(s=`${s} + ${c}<f32>(${i}) / ${c}<f32>( ${l} )`);const u=`${c}<u32>( ${a}( ${s} ) * ${c}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,u,o,r,null)}generateTextureLoad(e,t,s,r,i,o){r===null&&(r="0u"),o&&(s=`${s} + ${o}`);let a;return i?a=`textureLoad( ${t}, ${s}, ${i}, u32( ${r} ) )`:(a=`textureLoad( ${t}, ${s}, u32( ${r} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,s,r,i){let o;return r?o=`textureStore( ${t}, ${s}, ${r}, ${i} )`:o=`textureStore( ${t}, ${s}, ${i} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===hn||this.isSampleCompare(e)===!1&&e.minFilter===Rn&&e.magFilter===Rn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,s,r,i,o=this.shaderStage){let a=null;return this.isUnfilterable(e)?a=this.generateTextureLod(e,t,s,r,i,"0",o):a=this._generateTextureSample(e,t,s,r,i,o),a}generateTextureGrad(e,t,s,r,i,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${s},  ${r[0]}, ${r[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${s},  ${r[0]}, ${r[1]} )`;re(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,s,r,i,o,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${i}, ${r}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${i}, ${r} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${r}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${s}, ${r} )`;re(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,s,r,i,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${s}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,s,o,r):this.generateTextureLod(e,t,s,i,o,r)}generateTextureBias(e,t,s,r,i,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${s}, ${r}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${s}, ${r} )`;re(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const s=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?s:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?s:s+".value":e.groupNode.name+"."+s}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=iV[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(ie("WebGPURenderer: Atomic operations are only supported in compute shaders."),Xn.READ_WRITE):Xn.READ_ONLY:e.access}getStorageAccess(e,t){return rV[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,s,r=null){const i=super.getUniformFromNode(e,t,s,r),o=this.getDataFromNode(e,s,this.globalCache);if(o.uniformGPU===void 0){let a;const l=e.groupNode,c=l.name,u=this.getBindGroupArray(c,s);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let d=null;const h=this.getNodeAccess(e,s);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?d=new Kf(i.name,i.node,l,h):d=new Qu(i.name,i.node,l,h):t==="cubeTexture"?d=new $w(i.name,i.node,l,h):t==="texture3D"&&(d=new Kf(i.name,i.node,l,h)),d.store=e.isStorageTextureNode===!0,d.mipLevel=d.store?e.mipLevel:0,d.setVisibility(Wl[s]),this.isUnfilterable(e.value)===!1&&d.store===!1){const p=new HU(`${i.name}_sampler`,i.node,l);p.setVisibility(Wl[s]),u.push(p,d),a=[p,d]}else u.push(d),a=[d]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const d=t==="buffer"?Uw:KU,h=new d(e,l);h.setVisibility(Wl[s]),u.push(h),a=h,i.name=r||"NodeBuffer_"+i.id}else{const d=this.uniformGroups[s]||(this.uniformGroups[s]={});let h=d[c];h===void 0&&(h=new Vw(c,l),h.setVisibility(Wl[s]),d[c]=h,u.push(h)),a=this.getNodeUniform(i,t),h.addUniform(a)}o.uniformGPU=a}return i}getBuiltin(e,t,s,r=this.shaderStage){const i=this.builtins[r]||(this.builtins[r]=new Map);return i.has(e)===!1&&i.set(e,{name:e,property:t,type:s}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,s=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let i=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${s.vars}
${s.code}
`;return s.result&&(i+=`	return ${s.result};
`),i+=`
}
`,i}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],s=this.directives[e];if(s!==void 0)for(const r of s)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],s=this.builtins[e];if(s!==void 0)for(const{name:r,property:i,type:o}of s.values())t.push(`@builtin( ${r} ) ${i} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,s,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:s,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:s,scope:r,bufferType:i,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(i);t.push(`var<${r}> ${s}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const s=this.getBuiltins("attribute");s&&t.push(s);const r=this.getAttributesArray();for(let i=0,o=r.length;i<o;i++){const a=r[i],l=a.name,c=this.getType(a.type);t.push(`@location( ${i} ) ${l} : ${c}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const s of e.members){const r=e.output?"@location( "+s.index+" ) ":"";let i=this.getType(s.type);s.atomic&&(i="atomic< "+i+" >"),t.push(`	${r+s.name} : ${i}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const s=this.structs[e];if(s.length>0){const r=[];for(const i of s){let o=`struct ${i.name} {
`;o+=this.getStructMembers(i),o+=`
};`,r.push(o)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,s=null){let r=`var ${t} : `;return s!==null?r+=this.generateArrayDeclaration(e,s):r+=this.getType(e),r}getVars(e){const t=[],s=this.vars[e];if(s!==void 0)for(const r of s)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const i=this.varyings,o=this.vars[e];for(let a=0;a<i.length;a++){const l=i[a];if(l.needsInterpolation){let c=`@location( ${a} )`;if(l.interpolationType){const u=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";c+=` @interpolate( ${l.interpolationType}${u}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(c+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${c} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&o.includes(l)===!1&&o.push(l)}}const s=this.getBuiltins(e);s&&t.push(s);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,s=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&s.structTypeNode!==null,i=s.value&&s.value.array&&typeof s.value.itemSize=="number"&&s.value.array.length>s.value.itemSize;return r&&!i}getUniforms(e){const t=this.uniforms[e],s=[],r=[],i=[],o={};for(const l of t){const c=l.groupNode.name,u=this.bindingsIndexes[c];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const d=l.node.value;this.isUnfilterable(d)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(d)?s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name}_sampler : sampler_comparison;`):s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name}_sampler : sampler;`));let h,p="";const{primarySamples:m}=this.renderer.backend.utils.getTextureSampleData(d);if(m>1&&(p="_multisampled"),d.isCubeTexture===!0)h="texture_cube<f32>";else if(d.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&d.compareFunction===null?h=`texture${p}_2d<f32>`:h=`texture_depth${p}_2d${d.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const x=Yf(d),y=this.getStorageAccess(l.node,e),g=l.node.value.is3DTexture,b=l.node.value.isArrayTexture;h=`texture_storage_${g?"3d":`2d${b?"_array":""}`}<${x}, ${y}>`}else if(d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0)h="texture_2d_array<f32>";else if(d.is3DTexture===!0||d.isData3DTexture===!0)h="texture_3d<f32>";else{const x=this.getComponentTypeFromTexture(d).charAt(0);h=`texture${p}_2d<${x}32>`}s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name} : ${h};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const d=l.node,h=this.getType(d.getNodeType(this)),p=d.bufferCount,m=p>0&&l.type==="buffer"?", "+p:"",x=d.isStorageBufferNode?`storage, ${this.getStorageAccess(d,e)}`:"uniform";if(this.isCustomStruct(l))r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var<${x}> ${l.name} : ${h};`);else{const g=`	value : array< ${d.isAtomic?`atomic<${h}>`:`${h}`}${m} >`;r.push(this._getWGSLStructBinding(l.name,g,x,u.binding++,u.group))}}else{const d=this.getType(this.getVectorType(l.type)),h=l.groupNode.name;(o[h]||(o[h]={index:u.binding++,id:u.group,snippets:[]})).snippets.push(`	${l.name} : ${d}`)}}for(const l in o){const c=o[l];i.push(this._getWGSLStructBinding(l,c.snippets.join(`,
`),"uniform",c.index,c.id))}let a=s.join(`
`);return a+=r.join(`
`),a+=i.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const s=e[t];s.uniforms=this.getUniforms(t),s.attributes=this.getAttributes(t),s.varyings=this.getVaryings(t),s.structs=this.getStructs(t),s.vars=this.getVars(t),s.codes=this.getCodes(t),s.directives=this.getDirectives(t),s.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],o=i[i.length-1],a=o.outputNode,l=a!==void 0&&a.isOutputStructNode===!0;for(const c of i){const u=this.getFlowData(c),d=c.name;if(d&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${d}
`),r+=`${u.code}
	`,c===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${u.result};`;else if(t==="fragment")if(l)s.returnType=a.getNodeType(this),s.structs+="var<private> output : "+s.returnType+";",r+=`return ${u.result};`;else{let h="	@location(0) color: vec4<f32>";const p=this.getBuiltins("output");p&&(h+=`,
	`+p),s.returnType="OutputStruct",s.structs+=this._getWGSLStruct("OutputStruct",h),s.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${u.result};

	return output;`}}}s.flow=r}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let s;return t!==null&&(s=this._getWGSLMethod(e+"_"+t)),s===void 0&&(s=this._getWGSLMethod(e)),s||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getTernary(e,t,s){return`select( ${s}, ${t}, ${e} )`}getType(e){return oV[e]||e}isAvailable(e){let t=Wy[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),Wy[e]=t),t}_getWGSLMethod(e){return qo[e]!==void 0&&this._include(e),aV[e]}_include(e){const t=qo[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${Ww}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[s,r,i]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${s}, ${r}, ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${s} * numWorkgroups.x )
		+ globalId.z * ( ${s} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,s,r=0,i=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${i} )
var<${s}> ${e} : ${o};`}}class cV{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=M.Depth24PlusStencil8:e.depth&&(t=M.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const i=this.backend.renderer,o=i.getRenderTarget();t=o?o.samples:i.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const s=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:s?1:t,isMSAA:s}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Mi.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Mi.LineList;if(e.isLine)return Mi.LineStrip;if(e.isMesh)return Mi.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===on)return M.BGRA8Unorm;if(e===Vt)return M.RGBA16Float;throw new Error("Unsupported outputType")}}const qw=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&qw.set(Float16Array,["float16"]);const uV=new Map([[z_,["float16"]]]),dV=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class hV{constructor(e){this.backend=e}createAttribute(e,t){const s=this._getBufferAttribute(e),r=this.backend,i=r.get(s);let o=i.buffer;if(o===void 0){const a=r.device;let l=s.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let d=0;d<l.length;d++)l[d]===65535&&(l[d]=4294967295)}if(s.array=l,(s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute)&&s.itemSize===3){l=new l.constructor(s.count*4);for(let d=0;d<s.count;d++)l.set(s.array.subarray(d*3,d*3+3),d*4);s.itemSize=4,s.array=l,i._force3to4BytesAlignment=!0}const c=l.byteLength,u=c+(4-c%4)%4;o=a.createBuffer({label:s.name,size:u,usage:t,mappedAtCreation:!0}),new l.constructor(o.getMappedRange()).set(l),o.unmap(),i.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),s=this.backend,r=s.device,i=s.get(t),o=s.get(t).buffer;let a=t.array;if(i._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let u=0;u<t.count;u++)a.set(t.array.subarray(u*3,u*3+3),u*4);t.array=a}const l=this._isTypedArray(a),c=t.updateRanges;if(c.length===0)r.queue.writeBuffer(o,0,a,0);else{const u=l?1:a.BYTES_PER_ELEMENT;for(let d=0,h=c.length;d<h;d++){const p=c[d];let m,x;if(i._force3to4BytesAlignment===!0){const g=Math.floor(p.start/3),b=Math.ceil(p.count/3);m=g*4*u,x=b*4*u}else m=p.start*u,x=p.count*u;const y=m*(l?a.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(o,y,a,m,x)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),s=new Map;for(let r=0;r<t.length;r++){const i=t[r],o=i.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(i);let l=s.get(a);if(l===void 0){let d,h;i.isInterleavedBufferAttribute===!0?(d=i.data.stride*o,h=i.data.isInstancedInterleavedBuffer?Hl.Instance:Hl.Vertex):(d=i.itemSize*o,h=i.isInstancedBufferAttribute?Hl.Instance:Hl.Vertex),i.normalized===!1&&(i.array.constructor===Int16Array||i.array.constructor===Uint16Array)&&(d=4),l={arrayStride:d,attributes:[],stepMode:h},s.set(a,l)}const c=this._getVertexFormat(i),u=i.isInterleavedBufferAttribute===!0?i.offset*o:0;l.attributes.push({shaderLocation:r,offset:u,format:c})}return Array.from(s.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,s=t.device,i=t.get(this._getBufferAttribute(e)).buffer,o=i.size,a=s.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=s.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(i,0,a,0,o);const c=l.finish();s.queue.submit([c]),await a.mapAsync(GPUMapMode.READ);const u=a.getMappedRange(),d=new e.array.constructor(u.slice(0));return a.unmap(),d.buffer}_getVertexFormat(e){const{itemSize:t,normalized:s}=e,r=e.array.constructor,i=e.constructor;let o;if(t===1)o=dV.get(r);else{const l=(uV.get(i)||qw.get(r))[s?1:0];if(l){const c=r.BYTES_PER_ELEMENT*t,d=Math.floor((c+3)/4)*4/r.BYTES_PER_ELEMENT;if(d%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${l}x${d}`}}return o||re("WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class fV{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,s=t.device,r=[];let i=0;for(const o of e.bindings){const a={binding:i++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const l={};o.isStorageBuffer&&(o.visibility&4&&(o.access===Xn.READ_WRITE||o.access===Xn.WRITE_ONLY)?l.type=fh.Storage:l.type=fh.ReadOnlyStorage),a.buffer=l}else if(o.isSampledTexture&&o.store){const l={};l.format=this.backend.get(o.texture).texture.format;const c=o.access;c===Xn.READ_WRITE?l.access=ph.ReadWrite:c===Xn.WRITE_ONLY?l.access=ph.WriteOnly:l.access=ph.ReadOnly,o.texture.isArrayTexture?l.viewDimension=ht.TwoDArray:o.texture.is3DTexture&&(l.viewDimension=ht.ThreeD),a.storageTexture=l}else if(o.isSampledTexture){const l={},{primarySamples:c}=t.utils.getTextureSampleData(o.texture);if(c>1&&(l.multisampled=!0,o.texture.isDepthTexture||(l.sampleType=Er.UnfilterableFloat)),o.texture.isDepthTexture)t.compatibilityMode&&o.texture.compareFunction===null?l.sampleType=Er.UnfilterableFloat:l.sampleType=Er.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const u=o.texture.type;u===Ot?l.sampleType=Er.SInt:u===mt?l.sampleType=Er.UInt:u===hn&&(this.backend.hasFeature("float32-filterable")?l.sampleType=Er.Float:l.sampleType=Er.UnfilterableFloat)}o.isSampledCubeTexture?l.viewDimension=ht.Cube:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?l.viewDimension=ht.TwoDArray:o.isSampledTexture3D&&(l.viewDimension=ht.ThreeD),a.texture=l}else if(o.isSampler){const l={};o.texture.isDepthTexture&&(o.texture.compareFunction!==null?l.type=Vy.Comparison:t.compatibilityMode&&(l.type=Vy.NonFiltering)),a.sampler=l}else re(`WebGPUBindingUtils: Unsupported binding "${o}".`);r.push(a)}return s.createBindGroupLayout({entries:r})}createBindings(e,t,s,r=0){const{backend:i,bindGroupLayoutCache:o}=this,a=i.get(e);let l=o.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),o.set(e.bindingsReference,l));let c;s>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[s]===r&&(c=a.groups[s])),c===void 0&&(c=this.createBindGroup(e,l),s>0&&(a.groups[s]=c,a.versions[s]=r)),a.group=c,a.layout=l}updateBinding(e){const t=this.backend,s=t.device,r=e.buffer,i=t.get(e).buffer;s.queue.writeBuffer(i,0,r,0)}createBindGroupIndex(e,t){const r=this.backend.device,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=r.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:i});r.queue.writeBuffer(a,0,e,0);const l=[{binding:0,resource:{buffer:a}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:l})}createBindGroup(e,t){const s=this.backend,r=s.device;let i=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const l=s.get(a);if(l.buffer===void 0){const c=a.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,d=r.createBuffer({label:"bindingBuffer_"+a.name,size:c,usage:u});l.buffer=d}o.push({binding:i,resource:{buffer:l.buffer}})}else if(a.isStorageBuffer){const l=s.get(a);if(l.buffer===void 0){const c=a.attribute;l.buffer=s.get(c).buffer}o.push({binding:i,resource:{buffer:l.buffer}})}else if(a.isSampledTexture){const l=s.get(a.texture);let c;if(l.externalTexture!==void 0)c=r.importExternalTexture({source:l.externalTexture});else{const u=a.store?1:l.texture.mipLevelCount,d=a.store?a.mipLevel:0;let h=`view-${l.texture.width}-${l.texture.height}`;if(l.texture.depthOrArrayLayers>1&&(h+=`-${l.texture.depthOrArrayLayers}`),h+=`-${u}-${d}`,c=l[h],c===void 0){const p=zU.All;let m;a.isSampledCubeTexture?m=ht.Cube:a.isSampledTexture3D?m=ht.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?m=ht.TwoDArray:m=ht.TwoD,c=l[h]=l.texture.createView({aspect:p,dimension:m,mipLevelCount:u,baseMipLevel:d})}}o.push({binding:i,resource:c})}else if(a.isSampler){const l=s.get(a.texture);o.push({binding:i,resource:l.sampler})}i++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class pV{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:s,material:r,geometry:i,pipeline:o}=e,{vertexProgram:a,fragmentProgram:l}=o,c=this.backend,u=c.device,d=c.utils,h=c.get(o),p=[];for(const z of e.getBindings()){const A=c.get(z);p.push(A.layout)}const m=c.attributeUtils.createShaderVertexBuffers(e);let x;r.blending!==Xi&&(r.blending!==Wr||r.transparent!==!1)&&(x=this._getBlending(r));let y={};r.stencilWrite===!0&&(y={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const g=this._getColorWriteMask(r),b=[];if(e.context.textures!==null){const z=e.context.textures;for(let A=0;A<z.length;A++){const O=d.getTextureFormatGPU(z[A]);b.push({format:O,blend:x,writeMask:g})}}else{const z=d.getCurrentColorFormat(e.context);b.push({format:z,blend:x,writeMask:g})}const v=c.get(a).module,_=c.get(l).module,w=this._getPrimitiveState(s,i,r),T=this._getDepthCompare(r),E=d.getCurrentDepthStencilFormat(e.context),S=this._getSampleCount(e.context),C={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},v,{buffers:m}),fragment:Object.assign({},_,{targets:b}),primitive:w,multisample:{count:S,alphaToCoverageEnabled:r.alphaToCoverage&&S>1},layout:u.createPipelineLayout({bindGroupLayouts:p})},k={},B=e.context.depth,V=e.context.stencil;if((B===!0||V===!0)&&(B===!0&&(k.format=E,k.depthWriteEnabled=r.depthWrite,k.depthCompare=T),V===!0&&(k.stencilFront=y,k.stencilBack={},k.stencilReadMask=r.stencilFuncMask,k.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(k.depthBias=r.polygonOffsetUnits,k.depthBiasSlopeScale=r.polygonOffsetFactor,k.depthBiasClamp=0),C.depthStencil=k),u.pushErrorScope("validation"),t===null)h.pipeline=u.createRenderPipeline(C),u.popErrorScope().then(z=>{z!==null&&(h.error=!0,re(z.message))});else{const z=new Promise(async A=>{try{h.pipeline=await u.createRenderPipelineAsync(C)}catch{}const O=await u.popErrorScope();O!==null&&(h.error=!0,re(O.message)),A()});t.push(z)}}createBundleEncoder(e,t="renderBundleEncoder"){const s=this.backend,{utils:r,device:i}=s,o=r.getCurrentDepthStencilFormat(e),a=r.getCurrentColorFormats(e),l=this._getSampleCount(e),c={label:t,colorFormats:a,depthStencilFormat:o,sampleCount:l};return i.createRenderBundleEncoder(c)}createComputePipeline(e,t){const s=this.backend,r=s.device,i=s.get(e.computeProgram).module,o=s.get(e),a=[];for(const l of t){const c=s.get(l);a.push(c.layout)}o.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,s;const r=e.blending,i=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(r===ca){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:i,c=e.blendDstAlpha!==null?e.blendDstAlpha:o,u=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},s={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(c),operation:this._getBlendOperation(u)}}else{const l=e.premultipliedAlpha,c=(u,d,h,p)=>{t={srcFactor:u,dstFactor:d,operation:Sr.Add},s={srcFactor:h,dstFactor:p,operation:Sr.Add}};if(l)switch(r){case Wr:c(Ae.One,Ae.OneMinusSrcAlpha,Ae.One,Ae.OneMinusSrcAlpha);break;case Lc:c(Ae.One,Ae.One,Ae.One,Ae.One);break;case Bc:c(Ae.Zero,Ae.OneMinusSrc,Ae.Zero,Ae.One);break;case Ic:c(Ae.Dst,Ae.OneMinusSrcAlpha,Ae.Zero,Ae.One);break}else switch(r){case Wr:c(Ae.SrcAlpha,Ae.OneMinusSrcAlpha,Ae.One,Ae.OneMinusSrcAlpha);break;case Lc:c(Ae.SrcAlpha,Ae.One,Ae.One,Ae.One);break;case Bc:re("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ic:re("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&s!==void 0)return{color:t,alpha:s};re("WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case Hs:t=Ae.Zero;break;case P_:t=Ae.One;break;case M_:t=Ae.Src;break;case S_:t=Ae.OneMinusSrc;break;case R_:t=Ae.SrcAlpha;break;case N_:t=Ae.OneMinusSrcAlpha;break;case A_:t=Ae.Dst;break;case w_:t=Ae.OneMinusDst;break;case E_:t=Ae.DstAlpha;break;case T_:t=Ae.OneMinusDstAlpha;break;case C_:t=Ae.SrcAlphaSaturated;break;case Z5:t=Ae.Constant;break;case J5:t=Ae.OneMinusConstant;break;default:re("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const s=e.stencilFunc;switch(s){case qA:t=Nt.Never;break;case WA:t=Nt.Always;break;case HA:t=Nt.Less;break;case zA:t=Nt.LessEqual;break;case $A:t=Nt.Equal;break;case GA:t=Nt.GreaterEqual;break;case VA:t=Nt.Greater;break;case UA:t=Nt.NotEqual;break;default:re("WebGPURenderer: Invalid stencil function.",s)}return t}_getStencilOperation(e){let t;switch(e){case tC:t=Vs.Keep;break;case eC:t=Vs.Zero;break;case JA:t=Vs.Replace;break;case ZA:t=Vs.Invert;break;case QA:t=Vs.IncrementClamp;break;case YA:t=Vs.DecrementClamp;break;case XA:t=Vs.IncrementWrap;break;case KA:t=Vs.DecrementWrap;break;default:re("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case vs:t=Sr.Add;break;case __:t=Sr.Subtract;break;case v_:t=Sr.ReverseSubtract;break;case sC:t=Sr.Min;break;case nC:t=Sr.Max;break;default:re("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,s){const r={},i=this.backend.utils;r.topology=i.getPrimitiveTopology(e,s),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?ro.Uint16:ro.Uint32);let o=s.side===Qt;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),r.frontFace=o===!0?Oy.CW:Oy.CCW,r.cullMode=s.side===zr?jy.None:jy.Back,r}_getColorWriteMask(e){return e.colorWrite===!0?Uy.All:Uy.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Nt.Always;else{const s=e.depthFunc;switch(s){case j_:t=Nt.Never;break;case O_:t=Nt.Always;break;case F_:t=Nt.Less;break;case L_:t=Nt.LessEqual;break;case B_:t=Nt.Equal;break;case I_:t=Nt.GreaterEqual;break;case D_:t=Nt.Greater;break;case k_:t=Nt.NotEqual;break;default:re("WebGPUPipelineUtils: Invalid depth function.",s)}}return t}}class mV extends Hw{constructor(e,t,s=2048){super(s),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,s=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,s);const i=r.finish();if(this.device.queue.submit([i]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,s),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,s)),a={},l=[];for(const[u,d]of e){const h=u.match(/^(.*):f(\d+)$/),p=parseInt(h[2]);l.includes(p)===!1&&l.push(p),a[p]===void 0&&(a[p]=0);const m=o[d],x=o[d+1],y=Number(x-m)/1e6;this.timestamps.set(u,y),a[p]+=y}const c=a[l[l.length-1]];return this.resultBuffer.unmap(),this.lastValue=c,this.frames=l,c}catch(e){return e("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){e("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){e("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class gV extends zw{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new cV(this),this.attributeUtils=new hV(this),this.bindingUtils=new fV(this),this.pipelineUtils=new pV(this),this.textureUtils=new ZU(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let s;if(t.device===void 0){const r={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},i=typeof navigator<"u"?await navigator.gpu.requestAdapter(r):null;if(i===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(Xf),a=[];for(const c of o)i.features.has(c)&&a.push(c);const l={requiredFeatures:a,requiredLimits:t.requiredLimits};s=await i.requestDevice(l)}else s=t.device;s.lost.then(r=>{const i={api:"WebGPU",message:r.message||"Unknown reason",reason:r.reason||null,originalEvent:r};e.onDeviceLost(i)}),this.device=s,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Xf.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let s=t.context;if(s===void 0){const r=this.parameters;e.isDefaultCanvasTarget===!0&&r.context!==void 0?s=r.context:s=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${Su} webgpu`);const i=r.alpha?"premultiplied":"opaque",o=r.outputType===Vt?"extended":"standard";s.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:o}}),t.context=s}return s}get coordinateSystem(){return Eu}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),s=this.get(t),r=e.currentSamples;let i=s.descriptor;if(i===void 0||s.samples!==r){i={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const a=i.colorAttachments[0];r>0?a.view=this.textureUtils.getColorBuffer().createView():a.resolveTarget=void 0,s.descriptor=i,s.samples=r}const o=i.colorAttachments[0];return r>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const s=e.renderTarget,r=this.get(s);let i=r.descriptors;(i===void 0||r.width!==s.width||r.height!==s.height||r.samples!==s.samples)&&(i={},r.descriptors=i);const o=e.getCacheKey();let a=i[o];if(a===void 0){const c=e.textures,u=[];let d;const h=this._isRenderCameraDepthArray(e);for(let p=0;p<c.length;p++){const m=this.get(c[p]),x={label:`colorAttachment_${p}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:ht.TwoD};if(s.isRenderTarget3D)d=e.activeCubeFace,x.baseArrayLayer=0,x.dimension=ht.ThreeD,x.depthOrArrayLayers=c[p].image.depth;else if(s.isRenderTarget&&c[p].image.depth>1)if(h===!0){const y=e.camera.cameras;for(let g=0;g<y.length;g++){const b={...x,baseArrayLayer:g,arrayLayerCount:1,dimension:ht.TwoD},v=m.texture.createView(b);u.push({view:v,resolveTarget:void 0,depthSlice:void 0})}}else x.dimension=ht.TwoDArray,x.depthOrArrayLayers=c[p].image.depth;if(h!==!0){const y=m.texture.createView(x);let g,b;m.msaaTexture!==void 0?(g=m.msaaTexture.createView(),b=y):(g=y,b=void 0),u.push({view:g,resolveTarget:b,depthSlice:d})}}if(a={textureViews:u},e.depth){const p=this.get(e.depthTexture),m={};e.depthTexture.isArrayTexture&&(m.dimension=ht.TwoD,m.arrayLayerCount=1,m.baseArrayLayer=e.activeCubeFace),a.depthStencilView=p.texture.createView(m)}i[o]=a,r.width=s.width,r.height=s.height,r.samples=s.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}const l={colorAttachments:[]};for(let c=0;c<a.textureViews.length;c++){const u=a.textureViews[c];let d={r:0,g:0,b:0,a:1};c===0&&t.clearValue&&(d=t.clearValue),l.colorAttachments.push({view:u.view,depthSlice:u.depthSlice,resolveTarget:u.resolveTarget,loadOp:t.loadOp||Be.Load,storeOp:t.storeOp||Ft.Store,clearValue:d})}return a.depthStencilView&&(l.depthStencilAttachment={view:a.depthStencilView}),l}beginRender(e){const t=this.get(e),s=this.device,r=e.occlusionQueryCount;let i;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=s.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:Be.Load}),this.initTimestampQuery(Kn.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=i;const a=o.depthStencilAttachment;if(e.textures!==null){const c=o.colorAttachments;for(let u=0;u<c.length;u++){const d=c[u];e.clearColor?(d.clearValue=u===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=Be.Clear):d.loadOp=Be.Load,d.storeOp=Ft.Store}}else{const c=o.colorAttachments[0];e.clearColor?(c.clearValue=e.clearColorValue,c.loadOp=Be.Clear):c.loadOp=Be.Load,c.storeOp=Ft.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=Be.Clear):a.depthLoadOp=Be.Load,a.depthStoreOp=Ft.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=Be.Clear):a.stencilLoadOp=Be.Load,a.stencilStoreOp=Ft.Store);const l=s.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const c=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==c.length?this._createDepthLayerDescriptors(e,t,o,c):this._updateDepthLayerDescriptors(e,t,c),t.bundleEncoders=[],t.bundleSets=[];for(let u=0;u<c.length;u++){const d=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+u),h={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(d),t.bundleSets.push(h)}t.currentPass=null}else{const c=l.beginRenderPass(o);t.currentPass=c,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,s,r){const i=s.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<r.length;a++){const l={...s,colorAttachments:[{...s.colorAttachments[0],view:s.colorAttachments[a].view}]};if(s.depthStencilAttachment){const c=a;o.viewCache[c]||(o.viewCache[c]=o.texture.createView({dimension:ht.TwoD,baseArrayLayer:a,arrayLayerCount:1})),l.depthStencilAttachment={view:o.viewCache[c],depthLoadOp:i.depthLoadOp||Be.Clear,depthStoreOp:i.depthStoreOp||Ft.Store,depthClearValue:i.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else l.depthStencilAttachment={...i};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,s){for(let r=0;r<s.length;r++){const i=t.layerDescriptors[r];if(i.depthStencilAttachment){const o=i.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Be.Clear):o.depthLoadOp=Be.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Be.Clear):o.stencilLoadOp=Be.Load)}}}finishRender(e){const t=this.get(e),s=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),s>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const i=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];i.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<i.length){const a=t.layerDescriptors[o],l=r.beginRenderPass(a);if(e.viewport){const{x:c,y:u,width:d,height:h,minDepth:p,maxDepth:m}=e.viewportValue;l.setViewport(c,u,d,h,p,m)}if(e.scissor){const{x:c,y:u,width:d,height:h}=e.scissorValue;l.setScissorRect(c,u,d,h)}l.executeBundles([i[o]]),l.end()}}else t.currentPass&&t.currentPass.end();if(s>0){const i=s*8;let o=this.occludedResolveCache.get(i);o===void 0&&(o=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,o));const a=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,s,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,i),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const i=e.textures;for(let o=0;o<i.length;o++){const a=i[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const s=this.get(e);return s.occluded&&s.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:s,currentOcclusionQueryObjects:r}=t;if(s&&r){const i=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await s.mapAsync(GPUMapMode.READ);const o=s.getMappedRange(),a=new BigUint64Array(o);for(let l=0;l<r.length;l++)a[l]===BigInt(0)&&i.add(r[l]);s.destroy(),t.occluded=i}}updateViewport(e){const{currentPass:t}=this.get(e),{x:s,y:r,width:i,height:o,minDepth:a,maxDepth:l}=e.viewportValue;t.setViewport(s,r,i,o,a,l)}updateScissor(e){const{currentPass:t}=this.get(e),{x:s,y:r,width:i,height:o}=e.scissorValue;t.setScissorRect(s,r,i,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,s,r=null){const i=this.device,o=this.renderer;let a=[],l,c,u,d;if(e){const m=this.getClearColor();c={r:m.r,g:m.g,b:m.b,a:m.a}}if(r===null){u=o.depth,d=o.stencil;const m=this._getDefaultRenderPassDescriptor();if(e){a=m.colorAttachments;const x=a[0];x.clearValue=c,x.loadOp=Be.Clear,x.storeOp=Ft.Store}(u||d)&&(l=m.depthStencilAttachment)}else{u=r.depth,d=r.stencil;const m={loadOp:e?Be.Clear:Be.Load,clearValue:e?c:void 0};u&&(m.depthLoadOp=t?Be.Clear:Be.Load,m.depthClearValue=t?o.getClearDepth():void 0,m.depthStoreOp=Ft.Store),d&&(m.stencilLoadOp=s?Be.Clear:Be.Load,m.stencilClearValue=s?o.getClearStencil():void 0,m.stencilStoreOp=Ft.Store);const x=this._getRenderPassDescriptor(r,m);a=x.colorAttachments,l=x.depthStencilAttachment}u&&l&&(t?(l.depthLoadOp=Be.Clear,l.depthClearValue=o.getClearDepth(),l.depthStoreOp=Ft.Store):(l.depthLoadOp=Be.Load,l.depthStoreOp=Ft.Store)),d&&l&&(s?(l.stencilLoadOp=Be.Clear,l.stencilClearValue=o.getClearStencil(),l.stencilStoreOp=Ft.Store):(l.stencilLoadOp=Be.Load,l.stencilStoreOp=Ft.Store));const h=i.createCommandEncoder({label:"clear"});h.beginRenderPass({colorAttachments:a,depthStencilAttachment:l}).end(),i.queue.submit([h.finish()])}beginCompute(e){const t=this.get(e),s={label:"computeGroup_"+e.id};this.initTimestampQuery(Kn.COMPUTE,this.getTimestampUID(e),s),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(s)}compute(e,t,s,r,i=null){const o=this.get(t),{passEncoderGPU:a}=this.get(e),l=this.get(r).pipeline;this.pipelineUtils.setPipeline(a,l);for(let c=0,u=s.length;c<u;c++){const d=s[c],h=this.get(d);a.setBindGroup(c,h.group)}if(i===null&&(i=t.count),i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute){const c=this.get(i).buffer;a.dispatchWorkgroupsIndirect(c,0);return}if(typeof i=="number"){const c=i;if(o.dispatchSize===void 0||o.count!==c){o.dispatchSize=[0,1,1],o.count=c;const u=t.workgroupSize;let d=u[0];for(let m=1;m<u.length;m++)d*=u[m];const h=Math.ceil(c/d),p=this.device.limits.maxComputeWorkgroupsPerDimension;i=[h,1,1],h>p&&(i[0]=Math.min(h,p),i[1]=Math.ceil(h/p)),o.dispatchSize=i}i=o.dispatchSize}a.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:s,material:r,context:i,pipeline:o}=e,a=e.getBindings(),l=this.get(i),c=this.get(o),u=c.pipeline;if(c.error===!0)return;const d=e.getIndex(),h=d!==null,p=e.getDrawParameters();if(p===null)return;const m=(y,g)=>{this.pipelineUtils.setPipeline(y,u),g.pipeline=u;const b=g.bindingGroups;for(let _=0,w=a.length;_<w;_++){const T=a[_],E=this.get(T);b[T.index]!==T.id&&(y.setBindGroup(T.index,E.group),b[T.index]=T.id)}if(h===!0&&g.index!==d){const _=this.get(d).buffer,w=d.array instanceof Uint16Array?ro.Uint16:ro.Uint32;y.setIndexBuffer(_,w),g.index=d}const v=e.getVertexBuffers();for(let _=0,w=v.length;_<w;_++){const T=v[_];if(g.attributes[_]!==T){const E=this.get(T).buffer;y.setVertexBuffer(_,E),g.attributes[_]=T}}i.stencil===!0&&r.stencilWrite===!0&&l.currentStencilRef!==r.stencilRef&&(y.setStencilReference(r.stencilRef),l.currentStencilRef=r.stencilRef)},x=(y,g)=>{if(m(y,g),s.isBatchedMesh===!0){const b=s._multiDrawStarts,v=s._multiDrawCounts,_=s._multiDrawCount,w=s._multiDrawInstances;w!==null&&ft("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let T=0;T<_;T++){const E=w?w[T]:1,S=E>1?0:T;h===!0?y.drawIndexed(v[T],E,b[T]/d.array.BYTES_PER_ELEMENT,0,S):y.draw(v[T],E,b[T],S),t.update(s,v[T],E)}}else if(h===!0){const{vertexCount:b,instanceCount:v,firstVertex:_}=p,w=e.getIndirect();if(w!==null){const T=this.get(w).buffer;y.drawIndexedIndirect(T,0)}else y.drawIndexed(b,v,_,0,0);t.update(s,b,v)}else{const{vertexCount:b,instanceCount:v,firstVertex:_}=p,w=e.getIndirect();if(w!==null){const T=this.get(w).buffer;y.drawIndirect(T,0)}else y.draw(b,v,_,0);t.update(s,b,v)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const y=this.get(e.camera),g=e.camera.cameras,b=e.getBindingGroup("cameraIndex");if(y.indexesGPU===void 0||y.indexesGPU.length!==g.length){const _=this.get(b),w=[],T=new Uint32Array([0,0,0,0]);for(let E=0,S=g.length;E<S;E++){T[0]=E;const C=this.bindingUtils.createBindGroupIndex(T,_.layout);w.push(C)}y.indexesGPU=w}const v=this.renderer.getPixelRatio();for(let _=0,w=g.length;_<w;_++){const T=g[_];if(s.layers.test(T.layers)){const E=T.viewport;let S=l.currentPass,C=l.currentSets;if(l.bundleEncoders){const k=l.bundleEncoders[_],B=l.bundleSets[_];S=k,C=B}E&&S.setViewport(Math.floor(E.x*v),Math.floor(E.y*v),Math.floor(E.width*v),Math.floor(E.height*v),i.viewportValue.minDepth,i.viewportValue.maxDepth),b&&y.indexesGPU&&(S.setBindGroup(b.index,y.indexesGPU[_]),C.bindingGroups[b.index]=b.id),x(S,C)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const y=l.lastOcclusionObject;y!==s&&(y!==null&&y.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),s.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=s),l.lastOcclusionObject=s)}x(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:s,material:r}=e,i=this.utils,o=i.getSampleCountRenderContext(e.context),a=i.getCurrentColorSpace(e.context),l=i.getCurrentColorFormat(e.context),c=i.getCurrentDepthStencilFormat(e.context),u=i.getPrimitiveTopology(s,r);let d=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==l||t.depthStencilFormat!==c||t.primitiveTopology!==u||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=l,t.depthStencilFormat=c,t.primitiveTopology=u,t.clippingContextCacheKey=e.clippingContextCacheKey,d=!0),d}getRenderCacheKey(e){const{object:t,material:s}=e,r=this.utils,i=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[s.transparent,s.blending,s.premultipliedAlpha,s.blendSrc,s.blendDst,s.blendEquation,s.blendSrcAlpha,s.blendDstAlpha,s.blendEquationAlpha,s.colorWrite,s.depthWrite,s.depthTest,s.depthFunc,s.stencilWrite,s.stencilFunc,s.stencilFail,s.stencilZFail,s.stencilZPass,s.stencilFuncMask,s.stencilWriteMask,s.side,o,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(t,s),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,s,r,i,o){return this.textureUtils.copyTextureToBuffer(e,t,s,r,i,o)}initTimestampQuery(e,t,s){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new mV(this.device,e,2048));const r=this.timestampQueryPool[e],i=r.allocateQueriesForContext(t);s.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new lV(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const s=this.get(e),i=s.currentPass.finish();this.get(t).bundleGPU=i,s.currentSets=s._currentSets,s.currentPass=s._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,s,r){this.bindingUtils.createBindings(e,t,s,r)}updateBindings(e,t,s,r){this.bindingUtils.createBindings(e,t,s,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return $y[e]!==void 0&&(e=$y[e]),this.device.features.has(e)}copyTextureToTexture(e,t,s=null,r=null,i=0,o=0){let a=0,l=0,c=0,u=0,d=0,h=0,p=e.image.width,m=e.image.height,x=1;s!==null&&(s.isBox3===!0?(u=s.min.x,d=s.min.y,h=s.min.z,p=s.max.x-s.min.x,m=s.max.y-s.min.y,x=s.max.z-s.min.z):(u=s.min.x,d=s.min.y,p=s.max.x-s.min.x,m=s.max.y-s.min.y,x=1)),r!==null&&(a=r.x,l=r.y,c=r.z||0);const y=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),g=this.get(e).texture,b=this.get(t).texture;y.copyTextureToTexture({texture:g,mipLevel:i,origin:{x:u,y:d,z:h}},{texture:b,mipLevel:o,origin:{x:a,y:l,z:c}},[p,m,x]),this.device.queue.submit([y.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,s){const r=this.get(t);let i=null;t.renderTarget?e.isDepthTexture?i=this.get(t.depthTexture).texture:i=this.get(t.textures[0]).texture:e.isDepthTexture?i=this.textureUtils.getDepthBuffer(t.depth,t.stencil):i=this.context.getCurrentTexture();const o=this.get(e).texture;if(i.format!==o.format){re("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,o.format);return}let a;if(r.currentPass?(r.currentPass.end(),a=r.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:i,origin:[s.x,s.y,0]},{texture:o},[s.z,s.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,a),r.currentPass){const{descriptor:l}=r;for(let c=0;c<l.colorAttachments.length;c++)l.colorAttachments[c].loadOp=Be.Load;t.depth&&(l.depthStencilAttachment.depthLoadOp=Be.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=Be.Load),r.currentPass=a.beginRenderPass(l),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([a.finish()])}dispose(){this.textureUtils.dispose()}}class xV extends $p{constructor(e,t,s,r,i,o){super(e,t,s,r,i,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class yV extends $p{constructor(e,t,s,r,i,o){super(e,t,s,r,i,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class bV extends Lw{constructor(){super(),this.addMaterial(RO,"MeshPhongMaterial"),this.addMaterial(bw,"MeshStandardMaterial"),this.addMaterial(M5,"MeshPhysicalMaterial"),this.addMaterial(I5,"MeshToonMaterial"),this.addMaterial(TO,"MeshBasicMaterial"),this.addMaterial(AO,"MeshLambertMaterial"),this.addMaterial(xO,"MeshNormalMaterial"),this.addMaterial(F5,"MeshMatcapMaterial"),this.addMaterial(hO,"LineBasicMaterial"),this.addMaterial(pO,"LineDashedMaterial"),this.addMaterial(G5,"PointsMaterial"),this.addMaterial(_w,"SpriteMaterial"),this.addMaterial(W5,"ShadowMaterial"),this.addLight(_4,rA),this.addLight(X4,c_),this.addLight(Y4,iA),this.addLight(Vm,$p),this.addLight(eU,u_),this.addLight(tU,oA),this.addLight(nU,aA),this.addLight(Q4,xV),this.addLight(J4,yV),this.addToneMapping(Rj,lA),this.addToneMapping(Mj,cA),this.addToneMapping(Pj,uA),this.addToneMapping(Dj,dA),this.addToneMapping(Fj,hA),this.addToneMapping(Oj,fA)}}class vV extends TU{constructor(e={}){let t;e.forceWebGL?t=Fy:(t=gV,e.getFallback=()=>(ie("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new Fy(e)));const s=new t(e);super(s,e),this.library=new bV,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const mh={type:"change"},$m={type:"start"},zm={type:"end"},Ky=1e-6,Le={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},ql=new Se,Gs=new Se,_V=new ue,Kl=new ue,gh=new ue,_i=new qi,Xy=new ue,Xl=new ue,xh=new ue,Yl=new ue;class TV extends Tu{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:At.ROTATE,MIDDLE:At.DOLLY,RIGHT:At.PAN},this.target=new ue,this.state=Le.NONE,this.keyState=Le.NONE,this._lastPosition=new ue,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ue,this._movePrev=new Se,this._moveCurr=new Se,this._lastAxis=new ue,this._zoomStart=new Se,this._zoomEnd=new Se,this._panStart=new Se,this._panEnd=new Se,this._pointers=[],this._pointerPositions={},this._onPointerMove=NV.bind(this),this._onPointerDown=wV.bind(this),this._onPointerUp=SV.bind(this),this._onPointerCancel=EV.bind(this),this._onContextMenu=DV.bind(this),this._onMouseWheel=kV.bind(this),this._onKeyDown=CV.bind(this),this._onKeyUp=AV.bind(this),this._onTouchStart=IV.bind(this),this._onTouchMove=BV.bind(this),this._onTouchEnd=LV.bind(this),this._onMouseDown=RV.bind(this),this._onMouseMove=MV.bind(this),this._onMouseUp=PV.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>Ky&&(this.dispatchEvent(mh),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>Ky||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(mh),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Le.NONE,this.keyState=Le.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(mh),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Gs.copy(this._panEnd).sub(this._panStart),Gs.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Gs.x*=e,Gs.y*=t}Gs.multiplyScalar(this._eye.length()*this.panSpeed),Kl.copy(this._eye).cross(this.object.up).setLength(Gs.x),Kl.add(_V.copy(this.object.up).setLength(Gs.y)),this.object.position.add(Kl),this.target.add(Kl),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Gs.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){Yl.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=Yl.length();e?(this._eye.copy(this.object.position).sub(this.target),Xy.copy(this._eye).normalize(),Xl.copy(this.object.up).normalize(),xh.crossVectors(Xl,Xy).normalize(),Xl.setLength(this._moveCurr.y-this._movePrev.y),xh.setLength(this._moveCurr.x-this._movePrev.x),Yl.copy(Xl.add(xh)),gh.crossVectors(Yl,this._eye).normalize(),e*=this.rotateSpeed,_i.setFromAxisAngle(gh,e),this._eye.applyQuaternion(_i),this.object.up.applyQuaternion(_i),this._lastAxis.copy(gh),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),_i.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(_i),this.object.up.applyQuaternion(_i)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Le.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Oc.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Oc.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return ql.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),ql}_getMouseOnCircle(e,t){return ql.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),ql}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Se,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function wV(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function NV(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function SV(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function EV(n){this._removePointer(n)}function AV(){this.enabled!==!1&&(this.keyState=Le.NONE,window.addEventListener("keydown",this._onKeyDown))}function CV(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Le.NONE&&(n.code===this.keys[Le.ROTATE]&&!this.noRotate?this.keyState=Le.ROTATE:n.code===this.keys[Le.ZOOM]&&!this.noZoom?this.keyState=Le.ZOOM:n.code===this.keys[Le.PAN]&&!this.noPan&&(this.keyState=Le.PAN)))}function RV(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case At.DOLLY:this.state=Le.ZOOM;break;case At.ROTATE:this.state=Le.ROTATE;break;case At.PAN:this.state=Le.PAN;break;default:this.state=Le.NONE}const t=this.keyState!==Le.NONE?this.keyState:this.state;t===Le.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Le.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Le.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent($m)}function MV(n){const e=this.keyState!==Le.NONE?this.keyState:this.state;e===Le.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Le.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Le.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function PV(){this.state=Le.NONE,this.dispatchEvent(zm)}function kV(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent($m),this.dispatchEvent(zm)}}function DV(n){this.enabled!==!1&&n.preventDefault()}function IV(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Le.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Le.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const s=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(s,r)),this._panEnd.copy(this._panStart);break}this.dispatchEvent($m)}function BV(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,s=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+s*s);const r=(n.pageX+e.x)/2,i=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,i));break}}function LV(n){switch(this._pointers.length){case 0:this.state=Le.NONE;break;case 1:this.state=Le.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Le.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(zm)}const Yy={type:"change"},Hm={type:"start"},Kw={type:"end"},Ql=new TC,Qy=new wu,FV=Math.cos(70*Oc.DEG2RAD),yt=new ue,Wt=2*Math.PI,Ve={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},yh=1e-6;class OV extends Tu{constructor(e,t=null){super(e,t),this.state=Ve.NONE,this.target=new ue,this.cursor=new ue,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:At.ROTATE,MIDDLE:At.DOLLY,RIGHT:At.PAN},this.touches={ONE:Ns.ROTATE,TWO:Ns.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ue,this._lastQuaternion=new qi,this._lastTargetPosition=new ue,this._quat=new qi().setFromUnitVectors(e.up,new ue(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new i0,this._sphericalDelta=new i0,this._scale=1,this._panOffset=new ue,this._rotateStart=new Se,this._rotateEnd=new Se,this._rotateDelta=new Se,this._panStart=new Se,this._panEnd=new Se,this._panDelta=new Se,this._dollyStart=new Se,this._dollyEnd=new Se,this._dollyDelta=new Se,this._dollyDirection=new ue,this._mouse=new Se,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=UV.bind(this),this._onPointerDown=jV.bind(this),this._onPointerUp=VV.bind(this),this._onContextMenu=KV.bind(this),this._onMouseWheel=zV.bind(this),this._onKeyDown=HV.bind(this),this._onTouchStart=WV.bind(this),this._onTouchMove=qV.bind(this),this._onMouseDown=GV.bind(this),this._onMouseMove=$V.bind(this),this._interceptControlDown=XV.bind(this),this._interceptControlUp=YV.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Yy),this.update(),this.state=Ve.NONE}update(e=null){const t=this.object.position;yt.copy(t).sub(this.target),yt.applyQuaternion(this._quat),this._spherical.setFromVector3(yt),this.autoRotate&&this.state===Ve.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(s)&&isFinite(r)&&(s<-Math.PI?s+=Wt:s>Math.PI&&(s-=Wt),r<-Math.PI?r+=Wt:r>Math.PI&&(r-=Wt),s<=r?this._spherical.theta=Math.max(s,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+r)/2?Math.max(s,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=o!=this._spherical.radius}if(yt.setFromSpherical(this._spherical),yt.applyQuaternion(this._quatInverse),t.copy(this.target).add(yt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=yt.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),i=!!l}else if(this.object.isOrthographicCamera){const a=new ue(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=l!==this.object.zoom;const c=new ue(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=yt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Ql.origin.copy(this.object.position),Ql.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Ql.direction))<FV?this.object.lookAt(this.target):(Qy.setFromNormalAndCoplanarPoint(this.object.up,this.target),Ql.intersectPlane(Qy,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>yh||8*(1-this._lastQuaternion.dot(this.object.quaternion))>yh||this._lastTargetPosition.distanceToSquared(this.target)>yh?(this.dispatchEvent(Yy),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Wt/60*this.autoRotateSpeed*e:Wt/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){yt.setFromMatrixColumn(t,0),yt.multiplyScalar(-e),this._panOffset.add(yt)}_panUp(e,t){this.screenSpacePanning===!0?yt.setFromMatrixColumn(t,1):(yt.setFromMatrixColumn(t,0),yt.crossVectors(this.object.up,yt)),yt.multiplyScalar(e),this._panOffset.add(yt)}_pan(e,t){const s=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;yt.copy(r).sub(this.target);let i=yt.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/s.clientHeight,this.object.matrix),this._panUp(2*t*i/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),r=e-s.left,i=t-s.top,o=s.width,a=s.height;this._mouse.x=r/o*2-1,this._mouse.y=-(i/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Wt*this._rotateDelta.x/t.clientHeight),this._rotateUp(Wt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(s,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(s,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(s*s+r*r);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),r=.5*(e.pageX+s.x),i=.5*(e.pageY+s.y);this._rotateEnd.set(r,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Wt*this._rotateDelta.x/t.clientHeight),this._rotateUp(Wt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(s,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(s*s+r*r);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Se,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function jV(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function UV(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function VV(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Kw),this.state=Ve.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function GV(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case At.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Ve.DOLLY;break;case At.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Ve.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Ve.ROTATE}break;case At.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Ve.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Ve.PAN}break;default:this.state=Ve.NONE}this.state!==Ve.NONE&&this.dispatchEvent(Hm)}function $V(n){switch(this.state){case Ve.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Ve.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Ve.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function zV(n){this.enabled===!1||this.enableZoom===!1||this.state!==Ve.NONE||(n.preventDefault(),this.dispatchEvent(Hm),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(Kw))}function HV(n){this.enabled!==!1&&this._handleKeyDown(n)}function WV(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Ns.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Ve.TOUCH_ROTATE;break;case Ns.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Ve.TOUCH_PAN;break;default:this.state=Ve.NONE}break;case 2:switch(this.touches.TWO){case Ns.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Ve.TOUCH_DOLLY_PAN;break;case Ns.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Ve.TOUCH_DOLLY_ROTATE;break;default:this.state=Ve.NONE}break;default:this.state=Ve.NONE}this.state!==Ve.NONE&&this.dispatchEvent(Hm)}function qV(n){switch(this._trackPointer(n),this.state){case Ve.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Ve.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Ve.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Ve.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Ve.NONE}}function KV(n){this.enabled!==!1&&n.preventDefault()}function XV(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function YV(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const QV={type:"change"},Zy=1e-6,Jy=new qi;class ZV extends Tu{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ue(0,0,0),this._rotationVector=new ue(0,0,0),this._lastQuaternion=new qi,this._lastPosition=new ue,this._status=0,this._onKeyDown=JV.bind(this),this._onKeyUp=eG.bind(this),this._onPointerMove=nG.bind(this),this._onPointerDown=tG.bind(this),this._onPointerUp=sG.bind(this),this._onPointerCancel=rG.bind(this),this._onContextMenu=iG.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,s=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*s),t.translateY(this._moveVector.y*s),t.translateZ(this._moveVector.z*s),Jy.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(Jy),(this._lastPosition.distanceToSquared(t.position)>Zy||8*(1-this._lastQuaternion.dot(t.quaternion))>Zy)&&(this.dispatchEvent(QV),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function JV(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function eG(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function tG(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function nG(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,s=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-s)/s,this._updateRotationVector()}}function sG(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function rG(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function iG(n){this.enabled!==!1&&n.preventDefault()}const oG={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Zu{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const aG=new Hp(-1,1,1,-1,0,1);class lG extends Za{constructor(){super(),this.setAttribute("position",new Fc([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Fc([0,2,0,0,2,0],2))}}const cG=new lG;class uG{constructor(e){this._mesh=new Bn(cG,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,aG)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class dG extends Zu{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof o0?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=wC.clone(e.uniforms),this.material=new o0({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new uG(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class eb extends Zu{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const r=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class hG extends Zu{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class fG{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const s=e.getSize(new Se);this._width=s.width,this._height=s.height,t=new NC(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Vt}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new dG(oG),this.copyPass.material.blending=Xi,this.clock=new q_}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let r=0,i=this.passes.length;r<i;r++){const o=this.passes[r];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),o.needsSwap){if(s){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}eb!==void 0&&(o instanceof eb?s=!0:o instanceof hG&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Se);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(s,r),this.renderTarget2.setSize(s,r);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(s,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class pG extends Zu{constructor(e,t,s=null,r=null,i=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new _n}render(e,t,s){const r=e.autoClear;e.autoClear=!1;let i,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(i),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=r}}function mG(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Va(n,e){return Va=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},Va(n,e)}function gG(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Va(n,e)}function Qf(n){return Qf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qf(n)}function xG(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function Xw(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xw=function(){return!!n})()}function yG(n,e,t){if(Xw())return Reflect.construct.apply(null,arguments);var s=[null];s.push.apply(s,e);var r=new(n.bind.apply(n,s));return t&&Va(r,t.prototype),r}function Zf(n){var e=typeof Map=="function"?new Map:void 0;return Zf=function(s){if(s===null||!xG(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(s))return e.get(s);e.set(s,r)}function r(){return yG(s,arguments,Qf(this).constructor)}return r.prototype=Object.create(s.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Va(r,s)},Zf(n)}var Yn=(function(n){gG(e,n);function e(t){var s;return s=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,mG(s)}return e})(Zf(Error));function bh(n){return Math.round(n*255)}function bG(n,e,t){return bh(n)+","+bh(e)+","+bh(t)}function cu(n,e,t,s){if(s===void 0&&(s=bG),e===0)return s(t,t,t);var r=(n%360+360)%360/60,i=(1-Math.abs(2*t-1))*e,o=i*(1-Math.abs(r%2-1)),a=0,l=0,c=0;r>=0&&r<1?(a=i,l=o):r>=1&&r<2?(a=o,l=i):r>=2&&r<3?(l=i,c=o):r>=3&&r<4?(l=o,c=i):r>=4&&r<5?(a=o,c=i):r>=5&&r<6&&(a=i,c=o);var u=t-i/2,d=a+u,h=l+u,p=c+u;return s(d,h,p)}var tb={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function vG(n){if(typeof n!="string")return n;var e=n.toLowerCase();return tb[e]?"#"+tb[e]:n}var _G=/^#[a-fA-F0-9]{6}$/,TG=/^#[a-fA-F0-9]{8}$/,wG=/^#[a-fA-F0-9]{3}$/,NG=/^#[a-fA-F0-9]{4}$/,vh=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,SG=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,EG=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,AG=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function io(n){if(typeof n!="string")throw new Yn(3);var e=vG(n);if(e.match(_G))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(TG)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(wG))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(NG)){var s=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:s}}var r=vh.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var i=SG.exec(e.substring(0,50));if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10),alpha:parseFloat(""+i[4])>1?parseFloat(""+i[4])/100:parseFloat(""+i[4])};var o=EG.exec(e);if(o){var a=parseInt(""+o[1],10),l=parseInt(""+o[2],10)/100,c=parseInt(""+o[3],10)/100,u="rgb("+cu(a,l,c)+")",d=vh.exec(u);if(!d)throw new Yn(4,e,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10)}}var h=AG.exec(e.substring(0,50));if(h){var p=parseInt(""+h[1],10),m=parseInt(""+h[2],10)/100,x=parseInt(""+h[3],10)/100,y="rgb("+cu(p,m,x)+")",g=vh.exec(y);if(!g)throw new Yn(4,e,y);return{red:parseInt(""+g[1],10),green:parseInt(""+g[2],10),blue:parseInt(""+g[3],10),alpha:parseFloat(""+h[4])>1?parseFloat(""+h[4])/100:parseFloat(""+h[4])}}throw new Yn(5)}function CG(n){var e=n.red/255,t=n.green/255,s=n.blue/255,r=Math.max(e,t,s),i=Math.min(e,t,s),o=(r+i)/2;if(r===i)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,l=r-i,c=o>.5?l/(2-r-i):l/(r+i);switch(r){case e:a=(t-s)/l+(t<s?6:0);break;case t:a=(s-e)/l+2;break;default:a=(e-t)/l+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:c,lightness:o,alpha:n.alpha}:{hue:a,saturation:c,lightness:o}}function pr(n){return CG(io(n))}var RG=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},Jf=RG;function Mr(n){var e=n.toString(16);return e.length===1?"0"+e:e}function _h(n){return Mr(Math.round(n*255))}function MG(n,e,t){return Jf("#"+_h(n)+_h(e)+_h(t))}function Yw(n,e,t){return cu(n,e,t,MG)}function PG(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return Yw(n.hue,n.saturation,n.lightness);throw new Yn(1)}function kG(n,e,t,s){if(typeof n=="object"&&e===void 0&&t===void 0&&s===void 0)return n.alpha>=1?Yw(n.hue,n.saturation,n.lightness):"rgba("+cu(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new Yn(2)}function Qw(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return Jf("#"+Mr(n)+Mr(e)+Mr(t));if(typeof n=="object"&&e===void 0&&t===void 0)return Jf("#"+Mr(n.red)+Mr(n.green)+Mr(n.blue));throw new Yn(6)}function Ju(n,e,t,s){if(typeof n=="object"&&e===void 0&&t===void 0&&s===void 0)return n.alpha>=1?Qw(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new Yn(7)}var DG=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},IG=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},BG=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},LG=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function mr(n){if(typeof n!="object")throw new Yn(8);if(IG(n))return Ju(n);if(DG(n))return Qw(n);if(LG(n))return kG(n);if(BG(n))return PG(n);throw new Yn(8)}function Zw(n,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?n.apply(this,r):Zw(n,e,r)}}function ln(n){return Zw(n,n.length,[])}function FG(n,e){if(e==="transparent")return e;var t=pr(e);return mr(bn({},t,{hue:t.hue+parseFloat(n)}))}ln(FG);function vo(n,e,t){return Math.max(n,Math.min(e,t))}function OG(n,e){if(e==="transparent")return e;var t=pr(e);return mr(bn({},t,{lightness:vo(0,1,t.lightness-parseFloat(n))}))}ln(OG);function jG(n,e){if(e==="transparent")return e;var t=pr(e);return mr(bn({},t,{saturation:vo(0,1,t.saturation-parseFloat(n))}))}ln(jG);function UG(n,e){if(e==="transparent")return e;var t=pr(e);return mr(bn({},t,{lightness:vo(0,1,t.lightness+parseFloat(n))}))}ln(UG);function VG(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var s=io(e),r=bn({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),i=io(t),o=bn({},i,{alpha:typeof i.alpha=="number"?i.alpha:1}),a=r.alpha-o.alpha,l=parseFloat(n)*2-1,c=l*a===-1?l:l+a,u=1+l*a,d=(c/u+1)/2,h=1-d,p={red:Math.floor(r.red*d+o.red*h),green:Math.floor(r.green*d+o.green*h),blue:Math.floor(r.blue*d+o.blue*h),alpha:r.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return Ju(p)}var GG=ln(VG),Jw=GG;function $G(n,e){if(e==="transparent")return e;var t=io(e),s=typeof t.alpha=="number"?t.alpha:1,r=bn({},t,{alpha:vo(0,1,(s*100+parseFloat(n)*100)/100)});return Ju(r)}var zG=ln($G),HG=zG;function WG(n,e){if(e==="transparent")return e;var t=pr(e);return mr(bn({},t,{saturation:vo(0,1,t.saturation+parseFloat(n))}))}ln(WG);function qG(n,e){return e==="transparent"?e:mr(bn({},pr(e),{hue:parseFloat(n)}))}ln(qG);function KG(n,e){return e==="transparent"?e:mr(bn({},pr(e),{lightness:parseFloat(n)}))}ln(KG);function XG(n,e){return e==="transparent"?e:mr(bn({},pr(e),{saturation:parseFloat(n)}))}ln(XG);function YG(n,e){return e==="transparent"?e:Jw(parseFloat(n),"rgb(0, 0, 0)",e)}ln(YG);function QG(n,e){return e==="transparent"?e:Jw(parseFloat(n),"rgb(255, 255, 255)",e)}ln(QG);function ZG(n,e){if(e==="transparent")return e;var t=io(e),s=typeof t.alpha=="number"?t.alpha:1,r=bn({},t,{alpha:vo(0,1,+(s*100-parseFloat(n)*100).toFixed(2)/100)});return Ju(r)}ln(ZG);var Yr=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-Yr.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?Yr.Bounce.In(n*2)*.5:Yr.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),ia=function(){return performance.now()},eN=(function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=ia()),t===void 0&&(t=!1);var s=Object.keys(this._tweens);if(s.length===0)return!1;for(;s.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<s.length;r++){var i=this._tweens[s[r]],o=!t;i&&i.update(e,o)===!1&&!t&&delete this._tweens[s[r]]}s=Object.keys(this._tweensAddedDuringUpdate)}return!0},n})(),ep={Linear:function(n,e){var t=n.length-1,s=t*e,r=Math.floor(s),i=ep.Utils.Linear;return e<0?i(n[0],n[1],s):e>1?i(n[t],n[t-1],t-s):i(n[r],n[r+1>t?t:r+1],s-r)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},tN=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),tp=new eN,nb=(function(){function n(e,t){t===void 0&&(t=tp),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Yr.Linear.None,this._interpolationFunction=ep.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=tN.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=ia()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var s in this._valuesStartRepeat)this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,s,r,i){for(var o in s){var a=e[o],l=Array.isArray(a),c=l?"array":typeof a,u=!l&&Array.isArray(s[o]);if(!(c==="undefined"||c==="function")){if(u){var d=s[o];if(d.length===0)continue;for(var h=[a],p=0,m=d.length;p<m;p+=1){var x=this._handleRelativeValue(a,d[p]);if(isNaN(x)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(x)}u&&(s[o]=h)}if((c==="object"||l)&&a&&!u){t[o]=l?[]:{};var y=a;for(var g in y)t[o][g]=y[g];r[o]=l?[]:{};var d=s[o];if(!this._isDynamic){var b={};for(var g in d)b[g]=d[g];s[o]=d=b}this._setupProperties(y,t[o],d,r[o],i)}else(typeof t[o]>"u"||i)&&(t[o]=a),l||(t[o]*=1),u?r[o]=s[o].slice().reverse():r[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=ia()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=ia()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=tp),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=Yr.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=ep.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var s=this,r;if(e===void 0&&(e=ia()),t===void 0&&(t=!0),this._isPaused)return!0;var i,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,l=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),c=this._duration+this._repeat*l,u=function(){if(s._duration===0||a>c)return 1;var y=Math.trunc(a/l),g=a-y*l,b=Math.min(g/s._duration,1);return b===0&&a===s._duration?1:b},d=u(),h=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||a>=this._duration)if(this._repeat>0){var p=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=p);for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*p,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var m=0,x=this._chainedTweens.length;m<x;m++)this._chainedTweens[m].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,s,r){for(var i in s)if(t[i]!==void 0){var o=t[i]||0,a=s[i],l=Array.isArray(e[i]),c=Array.isArray(a),u=!l&&c;u?e[i]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(e[i],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[i]=o+(a-o)*r))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],s=this._valuesEnd[e];typeof s=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(s):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n})();tN.nextId;var os=tp;os.getAll.bind(os);os.removeAll.bind(os);os.add.bind(os);os.remove.bind(os);os.update.bind(os);var np="http://www.w3.org/1999/xhtml";const sb={svg:"http://www.w3.org/2000/svg",xhtml:np,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ed(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),sb.hasOwnProperty(e)?{space:sb[e],local:n}:n}function JG(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===np&&e.documentElement.namespaceURI===np?e.createElement(n):e.createElementNS(t,n)}}function e8(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function nN(n){var e=ed(n);return(e.local?e8:JG)(e)}function t8(){}function Wm(n){return n==null?t8:function(){return this.querySelector(n)}}function n8(n){typeof n!="function"&&(n=Wm(n));for(var e=this._groups,t=e.length,s=new Array(t),r=0;r<t;++r)for(var i=e[r],o=i.length,a=s[r]=new Array(o),l,c,u=0;u<o;++u)(l=i[u])&&(c=n.call(l,l.__data__,u,i))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new an(s,this._parents)}function s8(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function r8(){return[]}function sN(n){return n==null?r8:function(){return this.querySelectorAll(n)}}function i8(n){return function(){return s8(n.apply(this,arguments))}}function o8(n){typeof n=="function"?n=i8(n):n=sN(n);for(var e=this._groups,t=e.length,s=[],r=[],i=0;i<t;++i)for(var o=e[i],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(s.push(n.call(l,l.__data__,c,o)),r.push(l));return new an(s,r)}function rN(n){return function(){return this.matches(n)}}function iN(n){return function(e){return e.matches(n)}}var a8=Array.prototype.find;function l8(n){return function(){return a8.call(this.children,n)}}function c8(){return this.firstElementChild}function u8(n){return this.select(n==null?c8:l8(typeof n=="function"?n:iN(n)))}var d8=Array.prototype.filter;function h8(){return Array.from(this.children)}function f8(n){return function(){return d8.call(this.children,n)}}function p8(n){return this.selectAll(n==null?h8:f8(typeof n=="function"?n:iN(n)))}function m8(n){typeof n!="function"&&(n=rN(n));for(var e=this._groups,t=e.length,s=new Array(t),r=0;r<t;++r)for(var i=e[r],o=i.length,a=s[r]=[],l,c=0;c<o;++c)(l=i[c])&&n.call(l,l.__data__,c,i)&&a.push(l);return new an(s,this._parents)}function oN(n){return new Array(n.length)}function g8(){return new an(this._enter||this._groups.map(oN),this._parents)}function uu(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}uu.prototype={constructor:uu,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function x8(n){return function(){return n}}function y8(n,e,t,s,r,i){for(var o=0,a,l=e.length,c=i.length;o<c;++o)(a=e[o])?(a.__data__=i[o],s[o]=a):t[o]=new uu(n,i[o]);for(;o<l;++o)(a=e[o])&&(r[o]=a)}function b8(n,e,t,s,r,i,o){var a,l,c=new Map,u=e.length,d=i.length,h=new Array(u),p;for(a=0;a<u;++a)(l=e[a])&&(h[a]=p=o.call(l,l.__data__,a,e)+"",c.has(p)?r[a]=l:c.set(p,l));for(a=0;a<d;++a)p=o.call(n,i[a],a,i)+"",(l=c.get(p))?(s[a]=l,l.__data__=i[a],c.delete(p)):t[a]=new uu(n,i[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(h[a])===l&&(r[a]=l)}function v8(n){return n.__data__}function _8(n,e){if(!arguments.length)return Array.from(this,v8);var t=e?b8:y8,s=this._parents,r=this._groups;typeof n!="function"&&(n=x8(n));for(var i=r.length,o=new Array(i),a=new Array(i),l=new Array(i),c=0;c<i;++c){var u=s[c],d=r[c],h=d.length,p=T8(n.call(u,u&&u.__data__,c,s)),m=p.length,x=a[c]=new Array(m),y=o[c]=new Array(m),g=l[c]=new Array(h);t(u,d,x,y,g,p,e);for(var b=0,v=0,_,w;b<m;++b)if(_=x[b]){for(b>=v&&(v=b+1);!(w=y[v])&&++v<m;);_._next=w||null}}return o=new an(o,s),o._enter=a,o._exit=l,o}function T8(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function w8(){return new an(this._exit||this._groups.map(oN),this._parents)}function N8(n,e,t){var s=this.enter(),r=this,i=this.exit();return typeof n=="function"?(s=n(s),s&&(s=s.selection())):s=s.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?i.remove():t(i),s&&r?s.merge(r).order():r}function S8(n){for(var e=n.selection?n.selection():n,t=this._groups,s=e._groups,r=t.length,i=s.length,o=Math.min(r,i),a=new Array(r),l=0;l<o;++l)for(var c=t[l],u=s[l],d=c.length,h=a[l]=new Array(d),p,m=0;m<d;++m)(p=c[m]||u[m])&&(h[m]=p);for(;l<r;++l)a[l]=t[l];return new an(a,this._parents)}function E8(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var s=n[e],r=s.length-1,i=s[r],o;--r>=0;)(o=s[r])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function A8(n){n||(n=C8);function e(d,h){return d&&h?n(d.__data__,h.__data__):!d-!h}for(var t=this._groups,s=t.length,r=new Array(s),i=0;i<s;++i){for(var o=t[i],a=o.length,l=r[i]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new an(r,this._parents).order()}function C8(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function R8(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function M8(){return Array.from(this)}function P8(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var s=n[e],r=0,i=s.length;r<i;++r){var o=s[r];if(o)return o}return null}function k8(){let n=0;for(const e of this)++n;return n}function D8(){return!this.node()}function I8(n){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var r=e[t],i=0,o=r.length,a;i<o;++i)(a=r[i])&&n.call(a,a.__data__,i,r);return this}function B8(n){return function(){this.removeAttribute(n)}}function L8(n){return function(){this.removeAttributeNS(n.space,n.local)}}function F8(n,e){return function(){this.setAttribute(n,e)}}function O8(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function j8(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function U8(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function V8(n,e){var t=ed(n);if(arguments.length<2){var s=this.node();return t.local?s.getAttributeNS(t.space,t.local):s.getAttribute(t)}return this.each((e==null?t.local?L8:B8:typeof e=="function"?t.local?U8:j8:t.local?O8:F8)(t,e))}function aN(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function G8(n){return function(){this.style.removeProperty(n)}}function $8(n,e,t){return function(){this.style.setProperty(n,e,t)}}function z8(n,e,t){return function(){var s=e.apply(this,arguments);s==null?this.style.removeProperty(n):this.style.setProperty(n,s,t)}}function H8(n,e,t){return arguments.length>1?this.each((e==null?G8:typeof e=="function"?z8:$8)(n,e,t??"")):oo(this.node(),n)}function oo(n,e){return n.style.getPropertyValue(e)||aN(n).getComputedStyle(n,null).getPropertyValue(e)}function W8(n){return function(){delete this[n]}}function q8(n,e){return function(){this[n]=e}}function K8(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function X8(n,e){return arguments.length>1?this.each((e==null?W8:typeof e=="function"?K8:q8)(n,e)):this.node()[n]}function lN(n){return n.trim().split(/^|\s+/)}function qm(n){return n.classList||new cN(n)}function cN(n){this._node=n,this._names=lN(n.getAttribute("class")||"")}cN.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function uN(n,e){for(var t=qm(n),s=-1,r=e.length;++s<r;)t.add(e[s])}function dN(n,e){for(var t=qm(n),s=-1,r=e.length;++s<r;)t.remove(e[s])}function Y8(n){return function(){uN(this,n)}}function Q8(n){return function(){dN(this,n)}}function Z8(n,e){return function(){(e.apply(this,arguments)?uN:dN)(this,n)}}function J8(n,e){var t=lN(n+"");if(arguments.length<2){for(var s=qm(this.node()),r=-1,i=t.length;++r<i;)if(!s.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?Z8:e?Y8:Q8)(t,e))}function e6(){this.textContent=""}function t6(n){return function(){this.textContent=n}}function n6(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function s6(n){return arguments.length?this.each(n==null?e6:(typeof n=="function"?n6:t6)(n)):this.node().textContent}function r6(){this.innerHTML=""}function i6(n){return function(){this.innerHTML=n}}function o6(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function a6(n){return arguments.length?this.each(n==null?r6:(typeof n=="function"?o6:i6)(n)):this.node().innerHTML}function l6(){this.nextSibling&&this.parentNode.appendChild(this)}function c6(){return this.each(l6)}function u6(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function d6(){return this.each(u6)}function h6(n){var e=typeof n=="function"?n:nN(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function f6(){return null}function p6(n,e){var t=typeof n=="function"?n:nN(n),s=e==null?f6:typeof e=="function"?e:Wm(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),s.apply(this,arguments)||null)})}function m6(){var n=this.parentNode;n&&n.removeChild(this)}function g6(){return this.each(m6)}function x6(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function y6(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function b6(n){return this.select(n?y6:x6)}function v6(n){return arguments.length?this.property("__data__",n):this.node().__data__}function _6(n){return function(e){n.call(this,e,this.__data__)}}function T6(n){return n.trim().split(/^|\s+/).map(function(e){var t="",s=e.indexOf(".");return s>=0&&(t=e.slice(s+1),e=e.slice(0,s)),{type:e,name:t}})}function w6(n){return function(){var e=this.__on;if(e){for(var t=0,s=-1,r=e.length,i;t<r;++t)i=e[t],(!n.type||i.type===n.type)&&i.name===n.name?this.removeEventListener(i.type,i.listener,i.options):e[++s]=i;++s?e.length=s:delete this.__on}}}function N6(n,e,t){return function(){var s=this.__on,r,i=_6(e);if(s){for(var o=0,a=s.length;o<a;++o)if((r=s[o]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=t),r.value=e;return}}this.addEventListener(n.type,i,t),r={type:n.type,name:n.name,value:e,listener:i,options:t},s?s.push(r):this.__on=[r]}}function S6(n,e,t){var s=T6(n+""),r,i=s.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(r=0,u=a[l];r<i;++r)if((o=s[r]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?N6:w6,r=0;r<i;++r)this.each(a(s[r],e,t));return this}function hN(n,e,t){var s=aN(n),r=s.CustomEvent;typeof r=="function"?r=new r(e,t):(r=s.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function E6(n,e){return function(){return hN(this,n,e)}}function A6(n,e){return function(){return hN(this,n,e.apply(this,arguments))}}function C6(n,e){return this.each((typeof e=="function"?A6:E6)(n,e))}function*R6(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var s=n[e],r=0,i=s.length,o;r<i;++r)(o=s[r])&&(yield o)}var fN=[null];function an(n,e){this._groups=n,this._parents=e}function al(){return new an([[document.documentElement]],fN)}function M6(){return this}an.prototype=al.prototype={constructor:an,select:n8,selectAll:o8,selectChild:u8,selectChildren:p8,filter:m8,data:_8,enter:g8,exit:w8,join:N8,merge:S8,selection:M6,order:E8,sort:A8,call:R8,nodes:M8,node:P8,size:k8,empty:D8,each:I8,attr:V8,style:H8,property:X8,classed:J8,text:s6,html:a6,raise:c6,lower:d6,append:h6,insert:p6,remove:g6,clone:b6,datum:v6,on:S6,dispatch:C6,[Symbol.iterator]:R6};function It(n){return typeof n=="string"?new an([[document.querySelector(n)]],[document.documentElement]):new an([[n]],fN)}function P6(n){let e;for(;e=n.sourceEvent;)n=e;return n}function Cn(n,e){if(n=P6(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var s=t.createSVGPoint();return s.x=n.clientX,s.y=n.clientY,s=s.matrixTransform(e.getScreenCTM().inverse()),[s.x,s.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop]}}return[n.pageX,n.pageY]}var ll,Ze,pN,mN,Fr,rb,gN,xN,yN,Km,sp,rp,Ga={},bN=[],k6=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,td=Array.isArray;function Qn(n,e){for(var t in e)n[t]=e[t];return n}function Xm(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function D6(n,e,t){var s,r,i,o={};for(i in e)i=="key"?s=e[i]:i=="ref"?r=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?ll.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(i in n.defaultProps)o[i]===void 0&&(o[i]=n.defaultProps[i]);return _a(n,o,s,r,null)}function _a(n,e,t,s,r){var i={type:n,props:e,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++pN,__i:-1,__u:0};return r==null&&Ze.vnode!=null&&Ze.vnode(i),i}function nd(n){return n.children}function wc(n,e){this.props=n,this.context=e}function ao(n,e){if(e==null)return n.__?ao(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?ao(n):null}function vN(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return vN(n)}}function ib(n){(!n.__d&&(n.__d=!0)&&Fr.push(n)&&!du.__r++||rb!=Ze.debounceRendering)&&((rb=Ze.debounceRendering)||gN)(du)}function du(){for(var n,e,t,s,r,i,o,a=1;Fr.length;)Fr.length>a&&Fr.sort(xN),n=Fr.shift(),a=Fr.length,n.__d&&(t=void 0,s=void 0,r=(s=(e=n).__v).__e,i=[],o=[],e.__P&&((t=Qn({},s)).__v=s.__v+1,Ze.vnode&&Ze.vnode(t),Ym(e.__P,t,s,e.__n,e.__P.namespaceURI,32&s.__u?[r]:null,i,r??ao(s),!!(32&s.__u),o),t.__v=s.__v,t.__.__k[t.__i]=t,wN(i,t,o),s.__e=s.__=null,t.__e!=r&&vN(t)));du.__r=0}function _N(n,e,t,s,r,i,o,a,l,c,u){var d,h,p,m,x,y,g,b=s&&s.__k||bN,v=e.length;for(l=I6(t,e,b,l,v),d=0;d<v;d++)(p=t.__k[d])!=null&&(h=p.__i==-1?Ga:b[p.__i]||Ga,p.__i=d,y=Ym(n,p,h,r,i,o,a,l,c,u),m=p.__e,p.ref&&h.ref!=p.ref&&(h.ref&&Qm(h.ref,null,p),u.push(p.ref,p.__c||m,p)),x==null&&m!=null&&(x=m),(g=!!(4&p.__u))||h.__k===p.__k?l=TN(p,l,n,g):typeof p.type=="function"&&y!==void 0?l=y:m&&(l=m.nextSibling),p.__u&=-7);return t.__e=x,l}function I6(n,e,t,s,r){var i,o,a,l,c,u=t.length,d=u,h=0;for(n.__k=new Array(r),i=0;i<r;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[i]=_a(null,o,null,null,null):td(o)?o=n.__k[i]=_a(nd,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=n.__k[i]=_a(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[i]=o,l=i+h,o.__=n,o.__b=n.__b+1,(c=o.__i=B6(o,t,l,d))!=-1&&(d--,(a=t[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(r>u?h--:r<u&&h++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?h--:c==l+1?h++:(c>l?h--:h++,o.__u|=4))):n.__k[i]=null;if(d)for(i=0;i<u;i++)(a=t[i])!=null&&(2&a.__u)==0&&(a.__e==s&&(s=ao(a)),SN(a,a));return s}function TN(n,e,t,s){var r,i;if(typeof n.type=="function"){for(r=n.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=n,e=TN(r[i],e,t,s));return e}n.__e!=e&&(s&&(e&&n.type&&!e.parentNode&&(e=ao(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function B6(n,e,t,s){var r,i,o,a=n.key,l=n.type,c=e[t],u=c!=null&&(2&c.__u)==0;if(c===null&&a==null||u&&a==c.key&&l==c.type)return t;if(s>(u?1:0)){for(r=t-1,i=t+1;r>=0||i<e.length;)if((c=e[o=r>=0?r--:i++])!=null&&(2&c.__u)==0&&a==c.key&&l==c.type)return o}return-1}function ob(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||k6.test(e)?t:t+"px"}function Zl(n,e,t,s,r){var i,o;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof s=="string"&&(n.style.cssText=s=""),s)for(e in s)t&&e in t||ob(n.style,e,"");if(t)for(e in t)s&&t[e]==s[e]||ob(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(yN,"$1")),o=e.toLowerCase(),e=o in n||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+i]=t,t?s?t.u=s.u:(t.u=Km,n.addEventListener(e,i?rp:sp,i)):n.removeEventListener(e,i?rp:sp,i);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function ab(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Km++;else if(e.t<t.u)return;return t(Ze.event?Ze.event(e):e)}}}function Ym(n,e,t,s,r,i,o,a,l,c){var u,d,h,p,m,x,y,g,b,v,_,w,T,E,S,C,k,B=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),i=[a=e.__e=t.__e]),(u=Ze.__b)&&u(e);e:if(typeof B=="function")try{if(g=e.props,b="prototype"in B&&B.prototype.render,v=(u=B.contextType)&&s[u.__c],_=u?v?v.props.value:u.__:s,t.__c?y=(d=e.__c=t.__c).__=d.__E:(b?e.__c=d=new B(g,_):(e.__c=d=new wc(g,_),d.constructor=B,d.render=F6),v&&v.sub(d),d.state||(d.state={}),d.__n=s,h=d.__d=!0,d.__h=[],d._sb=[]),b&&d.__s==null&&(d.__s=d.state),b&&B.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Qn({},d.__s)),Qn(d.__s,B.getDerivedStateFromProps(g,d.__s))),p=d.props,m=d.state,d.__v=e,h)b&&B.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),b&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(b&&B.getDerivedStateFromProps==null&&g!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,_),e.__v==t.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,_)===!1){for(e.__v!=t.__v&&(d.props=g,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(V){V&&(V.__=e)}),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,_),b&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,m,x)})}if(d.context=_,d.props=g,d.__P=n,d.__e=!1,T=Ze.__r,E=0,b){for(d.state=d.__s,d.__d=!1,T&&T(e),u=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do d.__d=!1,T&&T(e),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++E<25);d.state=d.__s,d.getChildContext!=null&&(s=Qn(Qn({},s),d.getChildContext())),b&&!h&&d.getSnapshotBeforeUpdate!=null&&(x=d.getSnapshotBeforeUpdate(p,m)),C=u,u!=null&&u.type===nd&&u.key==null&&(C=NN(u.props.children)),a=_N(n,td(C)?C:[C],e,t,s,r,i,o,a,l,c),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(V){if(e.__v=null,l||i!=null)if(V.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else{for(k=i.length;k--;)Xm(i[k]);ip(e)}else e.__e=t.__e,e.__k=t.__k,V.then||ip(e);Ze.__e(V,e,t)}else i==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=L6(t.__e,e,t,s,r,i,o,l,c);return(u=Ze.diffed)&&u(e),128&e.__u?void 0:a}function ip(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(ip)}function wN(n,e,t){for(var s=0;s<t.length;s++)Qm(t[s],t[++s],t[++s]);Ze.__c&&Ze.__c(e,n),n.some(function(r){try{n=r.__h,r.__h=[],n.some(function(i){i.call(r)})}catch(i){Ze.__e(i,r.__v)}})}function NN(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:td(n)?n.map(NN):Qn({},n)}function L6(n,e,t,s,r,i,o,a,l){var c,u,d,h,p,m,x,y=t.props||Ga,g=e.props,b=e.type;if(b=="svg"?r="http://www.w3.org/2000/svg":b=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((p=i[c])&&"setAttribute"in p==!!b&&(b?p.localName==b:p.nodeType==3)){n=p,i[c]=null;break}}if(n==null){if(b==null)return document.createTextNode(g);n=document.createElementNS(r,b,g.is&&g),a&&(Ze.__m&&Ze.__m(e,i),a=!1),i=null}if(b==null)y===g||a&&n.data==g||(n.data=g);else{if(i=i&&ll.call(n.childNodes),!a&&i!=null)for(y={},c=0;c<n.attributes.length;c++)y[(p=n.attributes[c]).name]=p.value;for(c in y)if(p=y[c],c!="children"){if(c=="dangerouslySetInnerHTML")d=p;else if(!(c in g)){if(c=="value"&&"defaultValue"in g||c=="checked"&&"defaultChecked"in g)continue;Zl(n,c,null,p,r)}}for(c in g)p=g[c],c=="children"?h=p:c=="dangerouslySetInnerHTML"?u=p:c=="value"?m=p:c=="checked"?x=p:a&&typeof p!="function"||y[c]===p||Zl(n,c,p,y[c],r);if(u)a||d&&(u.__html==d.__html||u.__html==n.innerHTML)||(n.innerHTML=u.__html),e.__k=[];else if(d&&(n.innerHTML=""),_N(e.type=="template"?n.content:n,td(h)?h:[h],e,t,s,b=="foreignObject"?"http://www.w3.org/1999/xhtml":r,i,o,i?i[0]:t.__k&&ao(t,0),a,l),i!=null)for(c=i.length;c--;)Xm(i[c]);a||(c="value",b=="progress"&&m==null?n.removeAttribute("value"):m!=null&&(m!==n[c]||b=="progress"&&!m||b=="option"&&m!=y[c])&&Zl(n,c,m,y[c],r),c="checked",x!=null&&x!=n[c]&&Zl(n,c,x,y[c],r))}return n}function Qm(n,e,t){try{if(typeof n=="function"){var s=typeof n.__u=="function";s&&n.__u(),s&&e==null||(n.__u=n(e))}else n.current=e}catch(r){Ze.__e(r,t)}}function SN(n,e,t){var s,r;if(Ze.unmount&&Ze.unmount(n),(s=n.ref)&&(s.current&&s.current!=n.__e||Qm(s,null,e)),(s=n.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){Ze.__e(i,e)}s.base=s.__P=null}if(s=n.__k)for(r=0;r<s.length;r++)s[r]&&SN(s[r],e,t||typeof n.type!="function");t||Xm(n.__e),n.__c=n.__=n.__e=void 0}function F6(n,e,t){return this.constructor(n,t)}function O6(n,e,t){var s,r,i,o;e==document&&(e=document.documentElement),Ze.__&&Ze.__(n,e),r=(s=!1)?null:e.__k,i=[],o=[],Ym(e,n=e.__k=D6(nd,null,[n]),r||Ga,Ga,e.namespaceURI,r?null:e.firstChild?ll.call(e.childNodes):null,i,r?r.__e:e.firstChild,s,o),wN(i,n,o)}function EN(n,e,t){var s,r,i,o,a=Qn({},n.props);for(i in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)i=="key"?s=e[i]:i=="ref"?r=e[i]:a[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(a.children=arguments.length>3?ll.call(arguments,2):t),_a(n.type,a,s||n.key,r||n.ref,null)}ll=bN.slice,Ze={__e:function(n,e,t,s){for(var r,i,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((i=r.constructor)&&i.getDerivedStateFromError!=null&&(r.setState(i.getDerivedStateFromError(n)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(n,s||{}),o=r.__d),o)return r.__E=r}catch(a){n=a}throw n}},pN=0,mN=function(n){return n!=null&&n.constructor==null},wc.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Qn({},this.state),typeof n=="function"&&(n=n(Qn({},t),this.props)),n&&Qn(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),ib(this))},wc.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),ib(this))},wc.prototype.render=nd,Fr=[],gN=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,xN=function(n,e){return n.__v.__b-e.__v.__b},du.__r=0,yN=/(PointerCapture)$|Capture$/i,Km=0,sp=ab(!1),rp=ab(!0);function lb(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function j6(n){if(Array.isArray(n))return n}function U6(n,e,t){return(e=W6(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function V6(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function G6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function $6(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cb(Object(t),!0).forEach(function(s){U6(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):cb(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function z6(n,e){return j6(n)||V6(n,e)||q6(n,e)||G6()}function H6(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function W6(n){var e=H6(n,"string");return typeof e=="symbol"?e:e+""}function hu(n){"@babel/helpers - typeof";return hu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hu(n)}function q6(n,e){if(n){if(typeof n=="string")return lb(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?lb(n,e):void 0}}var op=function(e){if(hu(e)!=="object")return e;var t=EN(e);if(t.props){var s;t.props=$6({},t.props),t!=null&&(s=t.props)!==null&&s!==void 0&&s.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(op):op(t.props.children))}return t},K6=function(e){return mN(EN(e))},X6=function(e,t){delete t.__k,O6(op(e),t)};function Y6(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var Q6=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;Y6(Q6);var Z6=Iu({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=s.style,i=r===void 0?{}:r,o=!!e&&hu(e)==="object"&&!!e.node&&typeof e.node=="function",a=It(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(i).forEach(function(c){var u=z6(c,2),d=u[0],h=u[1];return t.tooltipEl.style(d,h)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(l),function(c){t.mouseInside=!0;var u=Cn(c),d=a.node(),h=d.offsetWidth,p=d.offsetHeight,m=[t.offsetX===null||t.offsetX===void 0?"-".concat(u[0]/h*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?p>130&&p-u[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",u[0]+"px").style("top",u[1]+"px").style("transform","translate(".concat(m.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):K6(e.content)?(e.tooltipEl.text(""),X6(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function J6(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var e$=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;J6(e$);function ap(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function t$(n){if(Array.isArray(n))return n}function n$(n){if(Array.isArray(n))return ap(n)}function s$(n,e,t){return(e=u$(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r$(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function i$(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,r,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(s=i.call(t)).done)&&(a.push(s.value),a.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw r}}return a}}function o$(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a$(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l$(n,e){return t$(n)||i$(n,e)||AN(n,e)||o$()}function Ar(n){return n$(n)||r$(n)||AN(n)||a$()}function c$(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function u$(n){var e=c$(n,"string");return typeof e=="symbol"?e:e+""}function AN(n,e){if(n){if(typeof n=="string")return ap(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ap(n,e):void 0}}var Xe=window.THREE?window.THREE:{WebGLRenderer:EC,Scene:Nu,PerspectiveCamera:Ea,Raycaster:s_,SRGBColorSpace:Gp,TextureLoader:SC,Vector2:Se,Vector3:ue,Box3:a_,Color:_n,Mesh:Bn,SphereGeometry:Vp,MeshBasicMaterial:Ks,BackSide:Qt,Clock:q_},CN=Iu({props:{width:{default:window.innerWidth,onChange:function(e,t,s){isNaN(e)&&(t.width=s)}},height:{default:window.innerHeight,onChange:function(e,t,s){isNaN(e)&&(t.height=s)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var s=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(o,a){return e.hoverOrderComparator(o.object,a.object)});var i=r.find(function(o){return e.hoverFilter(o.object)})||null;s=i?i.object:null,e.intersection=i||null}s!==e.hoverObj&&(e.onHover(s,e.hoverObj,e.intersection),e.tooltip.content(s&&Ce(e.tooltipContent)(s,e.intersection)||null),e.hoverObj=s)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,s=t.x,r=t.y;return{x:s,y:r}},cameraPosition:function(e,t,s,r){var i=e.camera;if(t&&e.initialised){var o=t,a=s||{x:0,y:0,z:0};if(!r)u(o),d(a);else{var l=Object.assign({},i.position),c=h();e.tweenGroup.add(new nb(l).to(o,r).easing(Yr.Quadratic.Out).onUpdate(u).start()),e.tweenGroup.add(new nb(c).to(a,r/3).easing(Yr.Quadratic.Out).onUpdate(d).start())}return this}return Object.assign({},i.position,{lookAt:h()});function u(p){var m=p.x,x=p.y,y=p.z;m!==void 0&&(i.position.x=m),x!==void 0&&(i.position.y=x),y!==void 0&&(i.position.z=y)}function d(p){var m=new Xe.Vector3(p.x,p.y,p.z);e.controls.enabled&&e.controls.target?e.controls.target=m:i.lookAt(m)}function h(){return Object.assign(new Xe.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,i),t,s)},fitToBbox:function(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,i=e.camera;if(t){var o=new Xe.Vector3(0,0,0),a=Math.max.apply(Math,Ar(Object.entries(t).map(function(p){var m=l$(p,2),x=m[0],y=m[1];return Math.max.apply(Math,Ar(y.map(function(g){return Math.abs(o[x]-g)})))})))*2,l=(1-r*2/e.height)*i.fov,c=a/Math.atan(l*Math.PI/180),u=c/i.aspect,d=Math.max(c,u);if(d>0){var h=o.clone().sub(i.position).normalize().multiplyScalar(-d);this.cameraPosition(h,o,s)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},s=new Xe.Box3(new Xe.Vector3(0,0,0),new Xe.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(i){return s.expandByObject(i)}),Object.assign.apply(Object,Ar(["x","y","z"].map(function(i){return s$({},i,[s.min[i],s.max[i]])})))):null},getScreenCoords:function(e,t,s,r){var i=new Xe.Vector3(t,s,r);return i.project(this.camera()),{x:(i.x+1)*e.width/2,y:-(i.y-1)*e.height/2}},getSceneCoords:function(e,t,s){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=new Xe.Vector2(t/e.width*2-1,-(s/e.height)*2+1),o=new Xe.Raycaster;return o.setFromCamera(i,e.camera),Object.assign({},o.ray.at(r,new Xe.Vector3))},intersectingObjects:function(e,t,s){var r=new Xe.Vector2(t/e.width*2-1,-(s/e.height)*2+1),i=new Xe.Raycaster;return i.params.Line.threshold=e.lineHoverPrecision,i.params.Points.threshold=e.pointsHoverPrecision,i.setFromCamera(r,e.camera),i.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Xe.Scene,camera:new Xe.PerspectiveCamera,clock:new Xe.Clock,tweenGroup:new eN,lastRaycasterCheck:0}},init:function(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=s.controlType,i=r===void 0?"trackball":r,o=s.useWebGPU,a=o===void 0?!1:o,l=s.rendererConfig,c=l===void 0?{}:l,u=s.extraRenderers,d=u===void 0?[]:u,h=s.waitForLoadComplete,p=h===void 0?!0:h;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new Z6(t.container),t.pointerPos=new Xe.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(m){return t.container.addEventListener(m,function(x){if(m==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&x.type==="pointermove"&&(x.pressure>0||t.isPointerPressed)&&(x.pointerType==="mouse"||x.movementX===void 0||[x.movementX,x.movementY].some(function(b){return Math.abs(b)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var y=g(t.container);t.pointerPos.x=x.pageX-y.left,t.pointerPos.y=x.pageY-y.top}function g(b){var v=b.getBoundingClientRect(),_=window.pageXOffset||document.documentElement.scrollLeft,w=window.pageYOffset||document.documentElement.scrollTop;return{top:v.top+w,left:v.left+_}}},{passive:!0})}),t.container.addEventListener("pointerup",function(m){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){m.button===0&&t.onClick(t.hoverObj||null,m,t.intersection),m.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,m,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(m){t.onRightClick&&m.preventDefault()}),t.renderer=new(a?vV:Xe.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},c)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=d,t.extraRenderers.forEach(function(m){m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",t.container.appendChild(m.domElement)}),t.postProcessingComposer=new fG(t.renderer),t.postProcessingComposer.addPass(new pG(t.scene,t.camera)),t.controls=new{trackball:TV,orbit:OV,fly:ZV}[i](t.camera,t.renderer.domElement),i==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(i==="trackball"||i==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Ar(t.extraRenderers)).forEach(function(m){return m.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Xe.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!p,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var s,r=e.width,i=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(i,"px"),[e.renderer,e.postProcessingComposer].concat(Ar(e.extraRenderers)).forEach(function(p){return p.setSize(r,i)}),e.camera.aspect=r/i;var o=e.viewOffset.slice(0,2);o.some(function(p){return p})&&(s=e.camera).setViewOffset.apply(s,[r,i].concat(Ar(o),[r,i])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var a,l=e.width,c=e.height,u=e.viewOffset.slice(0,2);u.some(function(p){return p})?(a=e.camera).setViewOffset.apply(a,[l,c].concat(Ar(u),[l,c])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Xe.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var d=io(e.backgroundColor).alpha;d===void 0&&(d=1),e.renderer.setClearColor(new Xe.Color(HG(1,e.backgroundColor)),d)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Xe.TextureLoader().load(e.backgroundImageUrl,function(p){p.colorSpace=Xe.SRGBColorSpace,e.skysphere.material=new Xe.MeshBasicMaterial({map:p,side:Xe.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&h()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&h())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(p){return e.scene.remove(p)}),e.lights.forEach(function(p){return e.scene.add(p)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(p){return e.scene.remove(p)}),e.objects.forEach(function(p){return e.scene.add(p)}));function h(){e.loadComplete=e.scene.visible=!0}}});function d$(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&s.firstChild?s.insertBefore(r,s.firstChild):s.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}var h$=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;d$(h$);function lp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function f$(n){if(Array.isArray(n))return lp(n)}function cl(n,e,t){return(e=x$(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function p$(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function m$(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ub(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function Jl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ub(Object(t),!0).forEach(function(s){cl(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ub(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function sd(n){return f$(n)||p$(n)||y$(n)||m$()}function g$(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function x$(n){var e=g$(n,"string");return typeof e=="symbol"?e:e+""}function y$(n,e){if(n){if(typeof n=="string")return lp(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?lp(n,e):void 0}}function RN(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(o,a){a[n][r](o)},triggerUpdate:!1}},linkMethod:function(r){return function(i){for(var o=i[n],a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];var u=o[r].apply(o,l);return u===o?this:u}}}}var Th=window.THREE?window.THREE:{AmbientLight:u_,DirectionalLight:c_,REVISION:Su},b$=170,MN=RN("forceGraph",K1),v$=Object.assign.apply(Object,sd(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return cl({},n,MN.linkProp(n))}))),_$=Object.assign.apply(Object,sd(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return cl({},n,MN.linkMethod(n))}))),Nc=RN("renderObjs",CN),T$=Object.assign.apply(Object,sd(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return cl({},n,Nc.linkProp(n))}))),w$=Object.assign.apply(Object,sd(["lights","cameraPosition","postProcessingComposer"].map(function(n){return cl({},n,Nc.linkMethod(n))})).concat([{graph2ScreenCoords:Nc.linkMethod("getScreenCoords"),screen2GraphCoords:Nc.linkMethod("getSceneCoords")}])),N$=Iu({props:Jl(Jl({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var s=t.renderObjs.controls();s&&(s.enabled=e,e&&s.domElement&&s.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},showPointerCursor:{default:!0,triggerUpdate:!1}},v$),T$),methods:Jl(Jl({zoomToFit:function(e,t,s){for(var r,i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,o),t,s),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},_$),w$),stateInit:function(e){var t=e.controlType,s=e.rendererConfig,r=e.extraRenderers,i=new K1;return{forceGraph:i,renderObjs:CN({controlType:t,rendererConfig:s,extraRenderers:r}).objects([i]).lights([new Th.AmbientLight(13421772,Math.PI),new Th.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var s=document.createElement("div");t.container.appendChild(s),t.renderObjs(s);var r=t.renderObjs.camera(),i=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var a;t.container.appendChild(a=document.createElement("div")),a.className="graph-info-msg",a.textContent="",t.forceGraph.onLoading(function(){a.textContent="Loading..."}).onFinishLoading(function(){a.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*b$)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(u){return u.__initialFixedPos&&!u.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var c=t._dragControls=new $3(t.graphData.nodes.map(function(u){return u.__threeObj}).filter(function(u){return u}),r,i.domElement);c.addEventListener("dragstart",function(u){var d=ms(u.object);if(d){o.enabled=!1,u.object.__initialPos=u.object.position.clone(),u.object.__prevPos=u.object.position.clone();var h=d.__data;!h.__initialFixedPos&&(h.__initialFixedPos={fx:h.fx,fy:h.fy,fz:h.fz}),!h.__initialPos&&(h.__initialPos={x:h.x,y:h.y,z:h.z}),["x","y","z"].forEach(function(p){return h["f".concat(p)]=h[p]}),i.domElement.classList.add("grabbable")}}),c.addEventListener("drag",function(u){var d=ms(u.object);if(d){if(!u.object.hasOwnProperty("__graphObjType")){var h=u.object.__initialPos,p=u.object.__prevPos,m=u.object.position;d.position.add(m.clone().sub(p)),p.copy(m),m.copy(h)}var x=d.__data,y=d.position,g={x:y.x-x.x,y:y.y-x.y,z:y.z-x.z};["x","y","z"].forEach(function(b){return x["f".concat(b)]=x[b]=y[b]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),x.__dragged=!0,t.onNodeDrag(x,g)}}),c.addEventListener("dragend",function(u){var d=ms(u.object);if(d){delete u.object.__initialPos,delete u.object.__prevPos;var h=d.__data;h.__disposeControlsAfterDrag&&(c.dispose(),delete h.__disposeControlsAfterDrag);var p=h.__initialFixedPos,m=h.__initialPos,x={x:m.x-h.x,y:m.y-h.y,z:m.z-h.z};if(p&&(["x","y","z"].forEach(function(g){var b="f".concat(g);p[b]===void 0&&delete h[b]}),delete h.__initialFixedPos,delete h.__initialPos,h.__dragged&&(delete h.__dragged,t.onNodeDragEnd(h,x))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls){var y;o.enabled=!0,o._status&&((y=o._onPointerCancel)===null||y===void 0||y.call(o)),o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))}i.domElement.classList.remove("grabbable")}})}}),Th.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,c){var u=ms(l);if(!u)return 1;var d=ms(c);if(!d)return-1;var h=function(m){return m.__graphObjType==="node"};return h(d)-h(u)}).tooltipContent(function(l){var c=ms(l);return c&&Ce(t["".concat(c.__graphObjType,"Label")])(c.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var c=ms(l);if(c!==t.hoverObj){var u=t.hoverObj?t.hoverObj.__graphObjType:null,d=t.hoverObj?t.hoverObj.__data:null,h=c?c.__graphObjType:null,p=c?c.__data:null;if(u&&u!==h){var m=t["on".concat(u==="node"?"Node":"Link","Hover")];m&&m(null,d)}if(h){var x=t["on".concat(h==="node"?"Node":"Link","Hover")];x&&x(p,u===h?d:null)}i.domElement.classList[(c&&t["on".concat(h==="node"?"Node":"Link","Click")]||!c&&t.onBackgroundClick)&&Ce(t.showPointerCursor)(p)?"add":"remove"]("clickable"),t.hoverObj=c}}).clickAfterDrag(!1).onClick(function(l,c){var u=ms(l);if(u){var d=t["on".concat(u.__graphObjType==="node"?"Node":"Link","Click")];d&&d(u.__data,c)}else t.onBackgroundClick&&t.onBackgroundClick(c)}).onRightClick(function(l,c){var u=ms(l);if(u){var d=t["on".concat(u.__graphObjType==="node"?"Node":"Link","RightClick")];d&&d(u.__data,c)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(c)}),this._animationCycle()}});function ms(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var wh={exports:{}},Nh,db;function S$(){if(db)return Nh;db=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Nh=n,Nh}var Sh,hb;function E$(){if(hb)return Sh;hb=1;var n=S$();function e(){}function t(){}return t.resetWarningCache=e,Sh=function(){function s(o,a,l,c,u,d){if(d!==n){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}s.isRequired=s;function r(){return s}var i={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:r,element:s,elementType:s,instanceOf:r,node:s,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return i.PropTypes=i,i},Sh}var fb;function A$(){return fb||(fb=1,wh.exports=E$()()),wh.exports}var C$=A$();const D=n_(C$),rd={width:D.number,height:D.number,graphData:D.shape({nodes:D.arrayOf(D.object).isRequired,links:D.arrayOf(D.object).isRequired}),backgroundColor:D.string,nodeRelSize:D.number,nodeId:D.string,nodeLabel:D.oneOfType([D.string,D.func]),nodeVal:D.oneOfType([D.number,D.string,D.func]),nodeVisibility:D.oneOfType([D.bool,D.string,D.func]),nodeColor:D.oneOfType([D.string,D.func]),nodeAutoColorBy:D.oneOfType([D.string,D.func]),onNodeHover:D.func,onNodeClick:D.func,linkSource:D.string,linkTarget:D.string,linkLabel:D.oneOfType([D.string,D.func]),linkVisibility:D.oneOfType([D.bool,D.string,D.func]),linkColor:D.oneOfType([D.string,D.func]),linkAutoColorBy:D.oneOfType([D.string,D.func]),linkWidth:D.oneOfType([D.number,D.string,D.func]),linkCurvature:D.oneOfType([D.number,D.string,D.func]),linkDirectionalArrowLength:D.oneOfType([D.number,D.string,D.func]),linkDirectionalArrowColor:D.oneOfType([D.string,D.func]),linkDirectionalArrowRelPos:D.oneOfType([D.number,D.string,D.func]),linkDirectionalParticles:D.oneOfType([D.number,D.string,D.func]),linkDirectionalParticleSpeed:D.oneOfType([D.number,D.string,D.func]),linkDirectionalParticleOffset:D.oneOfType([D.number,D.string,D.func]),linkDirectionalParticleWidth:D.oneOfType([D.number,D.string,D.func]),linkDirectionalParticleColor:D.oneOfType([D.string,D.func]),onLinkHover:D.func,onLinkClick:D.func,dagMode:D.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:D.number,dagNodeFilter:D.func,onDagError:D.func,d3AlphaMin:D.number,d3AlphaDecay:D.number,d3VelocityDecay:D.number,warmupTicks:D.number,cooldownTicks:D.number,cooldownTime:D.number,onEngineTick:D.func,onEngineStop:D.func,getGraphBbox:D.func},PN={zoomToFit:D.func,onNodeRightClick:D.func,onNodeDrag:D.func,onNodeDragEnd:D.func,onLinkRightClick:D.func,linkHoverPrecision:D.number,onBackgroundClick:D.func,onBackgroundRightClick:D.func,showPointerCursor:D.oneOfType([D.bool,D.func]),enablePointerInteraction:D.bool,enableNodeDrag:D.bool},Zm={showNavInfo:D.bool,nodeOpacity:D.number,nodeResolution:D.number,nodeThreeObject:D.oneOfType([D.object,D.string,D.func]),nodeThreeObjectExtend:D.oneOfType([D.bool,D.string,D.func]),nodePositionUpdate:D.func,linkOpacity:D.number,linkResolution:D.number,linkCurveRotation:D.oneOfType([D.number,D.string,D.func]),linkMaterial:D.oneOfType([D.object,D.string,D.func]),linkThreeObject:D.oneOfType([D.object,D.string,D.func]),linkThreeObjectExtend:D.oneOfType([D.bool,D.string,D.func]),linkPositionUpdate:D.func,linkDirectionalArrowResolution:D.number,linkDirectionalParticleResolution:D.number,linkDirectionalParticleThreeObject:D.oneOfType([D.object,D.string,D.func]),forceEngine:D.oneOf(["d3","ngraph"]),ngraphPhysics:D.object,numDimensions:D.oneOf([1,2,3])};Object.assign({},rd,PN,{linkLineDash:D.oneOfType([D.arrayOf(D.number),D.string,D.func]),nodeCanvasObjectMode:D.oneOfType([D.string,D.func]),nodeCanvasObject:D.func,nodePointerAreaPaint:D.func,linkCanvasObjectMode:D.oneOfType([D.string,D.func]),linkCanvasObject:D.func,linkPointerAreaPaint:D.func,linkDirectionalParticleCanvasObject:D.func,autoPauseRedraw:D.bool,minZoom:D.number,maxZoom:D.number,enableZoomInteraction:D.oneOfType([D.bool,D.func]),enablePanInteraction:D.oneOfType([D.bool,D.func]),onZoom:D.func,onZoomEnd:D.func,onRenderFramePre:D.func,onRenderFramePost:D.func});const R$=Object.assign({},rd,PN,Zm,{enableNavigationControls:D.bool,controlType:D.oneOf(["trackball","orbit","fly"]),rendererConfig:D.object,extraRenderers:D.arrayOf(D.shape({render:D.func.isRequired}))});Object.assign({},rd,Zm,{nodeDesc:D.oneOfType([D.string,D.func]),linkDesc:D.oneOfType([D.string,D.func])});Object.assign({},rd,Zm,{markerAttrs:D.object,yOffset:D.number,glScale:D.number});const Jm=G3(N$,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});Jm.displayName="ForceGraph3D";Jm.propTypes=R$;const kN=({onNodeClick:n})=>{const[e,t]=N.useState({nodes:[],links:[]}),[s,r]=N.useState(!1),i=N.useRef(),o=N.useRef(0);N.useEffect(()=>{const l=async()=>{try{const d=await(await fetch("/api/galaxy")).json();d.simulation&&r(!0),d&&d.nodes&&t(d)}catch(u){console.error("Failed to fetch galaxy data:",u)}};l();const c=setInterval(l,1e4);return()=>clearInterval(c)},[]),N.useEffect(()=>{const l=()=>{if(i.current){o.current+=.003;const c=o.current,u=800;i.current.cameraPosition({x:u*Math.sin(c),z:u*Math.cos(c)})}requestAnimationFrame(l)};l()},[]);const a=l=>{switch(l.group){case"start":return"#ef4444";case"core":return"#ffffff";case"sector":return"#f59e0b";case"agent":return"#00f3ff";case"knowledge":return"#a855f7";default:return"#64748b"}};return f.jsxs("div",{className:"w-full h-full relative bg-black/50 rounded overflow-hidden cursor-move",children:[f.jsxs("div",{className:"absolute top-4 left-4 z-10 pointer-events-none w-full pr-8",children:[f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Zt,{size:20,className:"text-[var(--hud-accent)] animate-pulse"}),f.jsx("h2",{className:"text-xl font-bold text-white tracking-widest uppercase font-mono",children:"Neural Ops Center"})]}),f.jsx("span",{className:"text-xs text-[var(--hud-text-dim)] font-mono",children:"LIVE SYSTEM TELEMETRY"})]}),f.jsxs("div",{className:"flex gap-8 bg-black/40 backdrop-blur-md p-4 rounded-lg border border-white/10",children:[f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-2xl font-bold text-[#00f3ff] text-shadow-neon",children:e.stats?.cache_efficiency||"--%"}),f.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"CACHE EFFICIENCY"})]}),f.jsxs("div",{className:"flex flex-col items-center border-l border-white/10 pl-8",children:[f.jsx("span",{className:"text-2xl font-bold text-[#a855f7]",children:e.stats?.total_memories||0}),f.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"ACTIVE NODES"})]}),f.jsxs("div",{className:"flex flex-col items-center border-l border-white/10 pl-8",children:[f.jsx("span",{className:"text-2xl font-bold text-[#f59e0b]",children:e.stats?.active_agents||0}),f.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"AGENTS ONLINE"})]})]})]}),s&&f.jsxs("div",{className:"inline-flex items-center gap-2 bg-[rgba(255,165,0,0.1)] border border-orange-500/50 px-2 py-1 rounded mt-2",children:[f.jsx(Ra,{size:12,className:"text-orange-500 animate-pulse"}),f.jsx("span",{className:"text-[10px] text-orange-400 font-mono",children:"SIMULATION MODE"})]})]}),e.nodes.length===0&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:f.jsx("span",{className:"text-[var(--hud-text-dim)] font-mono animate-pulse",children:"ESTABLISHING UPLINK..."})}),e.nodes.length>0&&f.jsx(Jm,{ref:i,graphData:e,nodeLabel:"name",nodeColor:a,nodeVal:l=>l.val||5,nodeResolution:16,linkColor:()=>"rgba(0, 243, 255, 0.15)",linkWidth:1,linkDirectionalParticles:2,linkDirectionalParticleSpeed:.005,linkDirectionalParticleWidth:2,linkDirectionalParticleColor:()=>"#00f3ff",backgroundColor:"rgba(0,0,0,0)",showNavInfo:!1,bloomStrength:1.5,enableNodeDrag:!1,onNodeClick:l=>{const u=1+100/Math.hypot(l.x,l.y,l.z);i.current&&i.current.cameraPosition({x:l.x*u,y:l.y*u,z:l.z*u},l,3e3),n&&n(l)}}),f.jsx("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none bg-black/60 backdrop-blur p-2 rounded border border-white/10",children:f.jsxs("div",{className:"flex flex-col gap-1 text-[10px] font-mono text-[var(--hud-text-dim)]",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00f3ff] shadow-[0_0_5px_#00f3ff]"})," AGENT NODE"]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"w-2 h-2 rounded-full bg-[#a855f7] shadow-[0_0_5px_#a855f7]"})," KNOWLEDGE"]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"w-2 h-2 rounded-full bg-[#f59e0b] shadow-[0_0_5px_#f59e0b]"})," SECTOR HUB"]})]})})]})};function M$({nodeId:n,onClose:e}){const t={title:"HIPAA-Compliant Clinical Triage",author:"Dr. Sarah Watts",trustScore:98,views:"12.4k",forks:342,lastUpdated:"2h ago",tags:["Healthcare","Privacy","Triage","L3-Cache"],description:"A robust caching pattern for handling patient symptom descriptions. Includes automatic PII redaction for MRN and SSN, and maps symptoms to SNOMED CT codes.",schema:`{
  "input": "Patient symptom text",
  "output": "JSON: { triage_level, suggested_specialty, snomed_codes[] }",
  "constraints": ["No PII", "Max latency 200ms"]
}`,governance:{status:"VERIFIED",notes:"Passed all safety checks. Zero hallucination rate in last 10k calls."}};return f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-end pointer-events-none",children:f.jsxs("div",{className:"w-[600px] h-full bg-[rgba(6,11,20,0.95)] backdrop-blur-xl border-l border-[var(--hud-border)] flex flex-col pointer-events-auto animate-in slide-in-from-right duration-300 shadow-[-50px_0_100px_rgba(0,0,0,0.5)]",children:[f.jsxs("div",{className:"p-6 border-b border-[var(--hud-border)] flex justify-between items-start bg-[rgba(0,243,255,0.02)]",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsxs("span",{className:"px-2 py-0.5 rounded text-[10px] bg-[var(--hud-accent)]/10 text-[var(--hud-accent)] border border-[var(--hud-accent)]/30 font-mono",children:["PATTERN #",n||"8492"]}),f.jsxs("span",{className:"px-2 py-0.5 rounded text-[10px] bg-green-500/10 text-green-400 border border-green-500/30 flex items-center gap-1",children:[f.jsx(GR,{size:10})," ",t.governance.status]})]}),f.jsx("h1",{className:"text-2xl font-bold text-white font-['Rajdhani'] tracking-wide",children:t.title}),f.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs font-mono text-[var(--hud-accent)]",children:[f.jsx("img",{src:"/cpu_icon.png",className:"w-3 h-3 opacity-70",alt:""}),f.jsxs("span",{children:["SYNTHESIZED BY AGENT: ",t.author]})]})]}),f.jsx("button",{onClick:e,className:"text-[var(--hud-text-dim)] hover:text-white transition-colors",children:"Close"})]}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[f.jsxs("div",{className:"flex gap-4 text-xs text-[var(--hud-text-dim)] font-mono border-b border-[var(--hud-border)] pb-6",children:[f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx(Z_,{size:14})," ",t.views," Hits"]}),f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx(l0,{size:14})," ",t.forks," Active Clones"]}),f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx(Y_,{size:14})," Last Opt: ",t.lastUpdated]})]}),f.jsxs("div",{children:[f.jsxs("h3",{className:"text-sm font-bold text-white mb-2 flex items-center gap-2",children:[f.jsx(FC,{size:16,className:"text-[var(--hud-accent)]"}),"ABSTRACT"]}),f.jsx("p",{className:"text-sm text-slate-300 leading-relaxed bg-black/20 p-4 rounded border border-[var(--hud-border)]",children:t.description})]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map(s=>f.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 rounded bg-[var(--hud-accent-secondary)]/10 text-[var(--hud-accent-secondary)] text-xs border border-[var(--hud-accent-secondary)]/30",children:[f.jsx(WR,{size:10})," ",s]},s))}),f.jsxs(ge,{className:"border-l-4 border-l-green-500 bg-green-900/5",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("h4",{className:"text-sm font-bold text-green-400 flex items-center gap-2",children:[f.jsx(Mu,{size:16})," GOVERNANCE REPORT"]}),f.jsx("span",{className:"text-xs font-mono text-green-500/50",children:"ID: AUDIT-992"})]}),f.jsx("p",{className:"text-xs text-green-300/80 mb-3",children:t.governance.notes}),f.jsx("div",{className:"w-full bg-green-900/30 h-1.5 rounded-full overflow-hidden",children:f.jsx("div",{className:"w-[98%] bg-green-500 h-full"})}),f.jsxs("div",{className:"flex justify-between mt-1 text-[10px] font-mono text-green-500",children:[f.jsx("span",{children:"SAFETY SCORE"}),f.jsxs("span",{children:[t.trustScore,"/100"]})]})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-sm font-bold text-white mb-2 font-mono",children:"I/O SCHEMA"}),f.jsx("pre",{className:"bg-black border border-[var(--hud-border)] rounded p-4 text-[10px] font-mono text-[var(--hud-accent)] overflow-x-auto",children:t.article?.schema||t.schema})]})]}),f.jsxs("div",{className:"p-6 border-t border-[var(--hud-border)] bg-[rgba(0,0,0,0.4)] flex gap-3",children:[f.jsxs("button",{className:"flex-1 btn-cyber px-4 py-3 flex items-center justify-center gap-2 font-bold text-sm",children:[f.jsx(ZR,{size:16})," VOTE (",t.trustScore,")"]}),f.jsxs("button",{className:"flex-1 btn-cyber btn-cyber-primary px-4 py-3 flex items-center justify-center gap-2 font-bold text-sm text-[var(--hud-bg)]",children:[f.jsx(l0,{size:16})," FORK PATTERN"]})]})]})})}const P$=()=>{const[n,e]=N.useState({requests:0,bandwidth:0,latency:0,savings:0,hitRate:0,uptime:100}),[t,s]=N.useState([]),[r,i]=N.useState(!0),[o,a]=N.useState(null);return N.useEffect(()=>{const l=async()=>{try{const h=await(await fetch("/api/admin-stats",{headers:{Authorization:`Bearer ${localStorage.getItem("agentcache_token")}`}})).json();h&&!h.error&&e({requests:h.total_requests_today||0,bandwidth:Math.round((h.tokens_saved_today||0)/1e3),latency:42,savings:h.cost_saved_today?parseFloat(h.cost_saved_today.replace("$","")):0,hitRate:h.hit_rate||0,uptime:99.9})}catch(d){console.error("Failed to fetch admin stats:",d)}finally{i(!1)}};l();const c=setInterval(l,3e4),u=new EventSource("/api/events/stream");return u.onmessage=d=>{const h=JSON.parse(d.data);if(h.type==="sys:connected")return;const p={id:Date.now(),type:h.type.toUpperCase(),source:h.agentId||"System",hash:h.hash?`${h.hash.substring(0,8)}...`:"-",time:new Date().toLocaleTimeString()};s(m=>[p,...m].slice(0,10))},()=>{clearInterval(c),u.close()}},[]),f.jsxs("div",{className:"space-y-6 relative",children:[o&&f.jsx(M$,{nodeId:o.id,onClose:()=>a(null)}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx(ge,{title:"Galactic Knowledge Graph",icon:sm,className:"lg:col-span-2 min-h-[400px] p-0 overflow-hidden border-2 border-[var(--hud-accent)]/20 shadow-[0_0_20px_rgba(0,243,255,0.1)]",children:f.jsx(kN,{onNodeClick:l=>a(l)})}),f.jsx(ge,{title:"System Health",icon:Zt,className:"flex flex-col justify-center",children:f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsx(gl,{value:n.uptime,label:"Uptime",sublabel:"30 Days",color:"var(--hud-success)"}),f.jsx(gl,{value:n.hitRate,label:"Cache Hit",sublabel:"Global",color:"var(--hud-accent)"}),f.jsx(gl,{value:42,max:100,label:"CPU Load",sublabel:"Cluster",color:"var(--hud-warning)"}),f.jsx(gl,{value:12,max:100,label:"Memory",sublabel:"Usage",color:"var(--hud-accent-secondary)"})]})})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[f.jsxs(ge,{className:"p-0",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Total Requests"}),f.jsx("h3",{className:"text-2xl font-mono font-bold text-white",children:n.requests.toLocaleString()})]}),f.jsx(ar,{className:"text-[var(--hud-accent)] opacity-50",size:24})]}),f.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:f.jsx("span",{children:"Today"})})]}),f.jsxs(ge,{className:"p-0",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Tokens Saved"}),f.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:[n.bandwidth.toLocaleString()," k"]})]}),f.jsx(im,{className:"text-[var(--hud-accent-secondary)] opacity-50",size:24})]}),f.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:f.jsx("span",{children:"Est. Bandwidth"})})]}),f.jsxs(ge,{className:"p-0",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Avg Latency"}),f.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:[n.latency,"ms"]})]}),f.jsx(Zt,{className:"text-[var(--hud-warning)] opacity-50",size:24})]}),f.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:f.jsx("span",{children:"Global Avg"})})]}),f.jsxs(ge,{className:"p-0",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Cost Savings"}),f.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:["$",n.savings.toFixed(2)]})]}),f.jsx(ks,{className:"text-[var(--hud-success)] opacity-50",size:24})]}),f.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:f.jsx("span",{children:"Today"})})]})]}),f.jsxs(ge,{title:"Live Event Stream",icon:Y_,action:f.jsx("button",{className:"text-xs text-[var(--hud-accent)] hover:underline",children:"View All"}),children:[f.jsx(Yi,{columns:[{header:"Time",accessor:"time"},{header:"Type",accessor:"type",render:l=>f.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${l.type.includes("HIT")?"bg-green-500/10 text-green-400":l.type.includes("MISS")?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400"}`,children:l.type})},{header:"Source",accessor:"source"},{header:"Hash / ID",accessor:"hash",render:l=>f.jsx("span",{className:"font-mono text-[var(--hud-text-dim)]",children:l.hash})}],data:t}),t.length===0&&f.jsx("div",{className:"p-4 text-center text-[var(--hud-text-dim)] italic",children:"Waiting for events..."})]})]})};function Ht(n){if(typeof n=="string"||typeof n=="number")return""+n;let e="";if(Array.isArray(n))for(let t=0,s;t<n.length;t++)(s=Ht(n[t]))!==""&&(e+=(e&&" ")+s);else for(let t in n)n[t]&&(e+=(e&&" ")+t);return e}const k$={},pb=n=>{let e;const t=new Set,s=(u,d)=>{const h=typeof u=="function"?u(e):u;if(!Object.is(h,e)){const p=e;e=d??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(m=>m(e,p))}},r=()=>e,l={setState:s,getState:r,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(k$?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=n(s,r,l);return l},D$=n=>n?pb(n):pb,{useDebugValue:I$}=X,{useSyncExternalStoreWithSelector:B$}=AC,L$=n=>n;function DN(n,e=L$,t){const s=B$(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return I$(s),s}const mb=(n,e)=>{const t=D$(n),s=(r,i=e)=>DN(t,r,i);return Object.assign(s,t),s},F$=(n,e)=>n?mb(n,e):mb;function Lt(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(const[s,r]of n)if(!Object.is(r,e.get(s)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(const s of n)if(!e.has(s))return!1;return!0}const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(const s of t)if(!Object.prototype.hasOwnProperty.call(e,s)||!Object.is(n[s],e[s]))return!1;return!0}const O$={passive:!1},$a={capture:!0,passive:!1};function Eh(n){n.stopImmediatePropagation()}function $i(n){n.preventDefault(),n.stopImmediatePropagation()}function IN(n){var e=n.document.documentElement,t=It(n).on("dragstart.drag",$i,$a);"onselectstart"in e?t.on("selectstart.drag",$i,$a):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function BN(n,e){var t=n.document.documentElement,s=It(n).on("dragstart.drag",null);e&&(s.on("click.drag",$i,$a),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in t?s.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const ec=n=>()=>n;function cp(n,{sourceEvent:e,subject:t,target:s,identifier:r,active:i,x:o,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}cp.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function j$(n){return!n.ctrlKey&&!n.button}function U$(){return this.parentNode}function V$(n,e){return e??{x:n.x,y:n.y}}function G$(){return navigator.maxTouchPoints||"ontouchstart"in this}function $$(){var n=j$,e=U$,t=V$,s=G$,r={},i=el("start","drag","end"),o=0,a,l,c,u,d=0;function h(_){_.on("mousedown.drag",p).filter(s).on("touchstart.drag",y).on("touchmove.drag",g,O$).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(_,w){if(!(u||!n.call(this,_,w))){var T=v(this,e.call(this,_,w),_,w,"mouse");T&&(It(_.view).on("mousemove.drag",m,$a).on("mouseup.drag",x,$a),IN(_.view),Eh(_),c=!1,a=_.clientX,l=_.clientY,T("start",_))}}function m(_){if($i(_),!c){var w=_.clientX-a,T=_.clientY-l;c=w*w+T*T>d}r.mouse("drag",_)}function x(_){It(_.view).on("mousemove.drag mouseup.drag",null),BN(_.view,c),$i(_),r.mouse("end",_)}function y(_,w){if(n.call(this,_,w)){var T=_.changedTouches,E=e.call(this,_,w),S=T.length,C,k;for(C=0;C<S;++C)(k=v(this,E,_,w,T[C].identifier,T[C]))&&(Eh(_),k("start",_,T[C]))}}function g(_){var w=_.changedTouches,T=w.length,E,S;for(E=0;E<T;++E)(S=r[w[E].identifier])&&($i(_),S("drag",_,w[E]))}function b(_){var w=_.changedTouches,T=w.length,E,S;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),E=0;E<T;++E)(S=r[w[E].identifier])&&(Eh(_),S("end",_,w[E]))}function v(_,w,T,E,S,C){var k=i.copy(),B=Cn(C||T,w),V,z,A;if((A=t.call(_,new cp("beforestart",{sourceEvent:T,target:h,identifier:S,active:o,x:B[0],y:B[1],dx:0,dy:0,dispatch:k}),E))!=null)return V=A.x-B[0]||0,z=A.y-B[1]||0,function O(I,R,F){var P=B,W;switch(I){case"start":r[S]=O,W=o++;break;case"end":delete r[S],--o;case"drag":B=Cn(F||R,w),W=o;break}k.call(I,_,new cp(I,{sourceEvent:R,subject:A,target:h,identifier:S,active:W,x:B[0]+V,y:B[1]+z,dx:B[0]-P[0],dy:B[1]-P[1],dispatch:k}),E)}}return h.filter=function(_){return arguments.length?(n=typeof _=="function"?_:ec(!!_),h):n},h.container=function(_){return arguments.length?(e=typeof _=="function"?_:ec(_),h):e},h.subject=function(_){return arguments.length?(t=typeof _=="function"?_:ec(_),h):t},h.touchable=function(_){return arguments.length?(s=typeof _=="function"?_:ec(!!_),h):s},h.on=function(){var _=i.on.apply(i,arguments);return _===i?h:_},h.clickDistance=function(_){return arguments.length?(d=(_=+_)*_,h):Math.sqrt(d)},h}var z$=el("start","end","cancel","interrupt"),H$=[],LN=0,gb=1,up=2,Sc=3,xb=4,dp=5,Ec=6;function id(n,e,t,s,r,i){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;W$(n,t,{name:e,index:s,group:r,on:z$,tween:H$,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:LN})}function eg(n,e){var t=jn(n,e);if(t.state>LN)throw new Error("too late; already scheduled");return t}function cs(n,e){var t=jn(n,e);if(t.state>Sc)throw new Error("too late; already running");return t}function jn(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function W$(n,e,t){var s=n.__transition,r;s[e]=t,t.timer=um(i,0,t.time);function i(c){t.state=gb,t.timer.restart(o,t.delay,t.time),t.delay<=c&&o(c-t.delay)}function o(c){var u,d,h,p;if(t.state!==gb)return l();for(u in s)if(p=s[u],p.name===t.name){if(p.state===Sc)return v0(o);p.state===xb?(p.state=Ec,p.timer.stop(),p.on.call("interrupt",n,n.__data__,p.index,p.group),delete s[u]):+u<e&&(p.state=Ec,p.timer.stop(),p.on.call("cancel",n,n.__data__,p.index,p.group),delete s[u])}if(v0(function(){t.state===Sc&&(t.state=xb,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=up,t.on.call("start",n,n.__data__,t.index,t.group),t.state===up){for(t.state=Sc,r=new Array(h=t.tween.length),u=0,d=-1;u<h;++u)(p=t.tween[u].value.call(n,n.__data__,t.index,t.group))&&(r[++d]=p);r.length=d+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=dp,1),d=-1,h=r.length;++d<h;)r[d].call(n,u);t.state===dp&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=Ec,t.timer.stop(),delete s[e];for(var c in s)return;delete n.__transition}}function Ac(n,e){var t=n.__transition,s,r,i=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((s=t[o]).name!==e){i=!1;continue}r=s.state>up&&s.state<dp,s.state=Ec,s.timer.stop(),s.on.call(r?"interrupt":"cancel",n,n.__data__,s.index,s.group),delete t[o]}i&&delete n.__transition}}function q$(n){return this.each(function(){Ac(this,n)})}function K$(n,e){var t,s;return function(){var r=cs(this,n),i=r.tween;if(i!==t){s=t=i;for(var o=0,a=s.length;o<a;++o)if(s[o].name===e){s=s.slice(),s.splice(o,1);break}}r.tween=s}}function X$(n,e,t){var s,r;if(typeof t!="function")throw new Error;return function(){var i=cs(this,n),o=i.tween;if(o!==s){r=(s=o).slice();for(var a={name:e,value:t},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=a;break}l===c&&r.push(a)}i.tween=r}}function Y$(n,e){var t=this._id;if(n+="",arguments.length<2){for(var s=jn(this.node(),t).tween,r=0,i=s.length,o;r<i;++r)if((o=s[r]).name===n)return o.value;return null}return this.each((e==null?K$:X$)(t,n,e))}function tg(n,e,t){var s=n._id;return n.each(function(){var r=cs(this,s);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return jn(r,s).value[e]}}function FN(n,e){var t;return(typeof e=="number"?Ws:e instanceof Ia?nx:(t=Ia(e))?(e=t,nx):Hk)(n,e)}function Q$(n){return function(){this.removeAttribute(n)}}function Z$(n){return function(){this.removeAttributeNS(n.space,n.local)}}function J$(n,e,t){var s,r=t+"",i;return function(){var o=this.getAttribute(n);return o===r?null:o===s?i:i=e(s=o,t)}}function ez(n,e,t){var s,r=t+"",i;return function(){var o=this.getAttributeNS(n.space,n.local);return o===r?null:o===s?i:i=e(s=o,t)}}function tz(n,e,t){var s,r,i;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),l=a+"",o===l?null:o===s&&l===r?i:(r=l,i=e(s=o,a)))}}function nz(n,e,t){var s,r,i;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),l=a+"",o===l?null:o===s&&l===r?i:(r=l,i=e(s=o,a)))}}function sz(n,e){var t=ed(n),s=t==="transform"?Xk:FN;return this.attrTween(n,typeof e=="function"?(t.local?nz:tz)(t,s,tg(this,"attr."+n,e)):e==null?(t.local?Z$:Q$)(t):(t.local?ez:J$)(t,s,e))}function rz(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function iz(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function oz(n,e){var t,s;function r(){var i=e.apply(this,arguments);return i!==s&&(t=(s=i)&&iz(n,i)),t}return r._value=e,r}function az(n,e){var t,s;function r(){var i=e.apply(this,arguments);return i!==s&&(t=(s=i)&&rz(n,i)),t}return r._value=e,r}function lz(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var s=ed(n);return this.tween(t,(s.local?oz:az)(s,e))}function cz(n,e){return function(){eg(this,n).delay=+e.apply(this,arguments)}}function uz(n,e){return e=+e,function(){eg(this,n).delay=e}}function dz(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?cz:uz)(e,n)):jn(this.node(),e).delay}function hz(n,e){return function(){cs(this,n).duration=+e.apply(this,arguments)}}function fz(n,e){return e=+e,function(){cs(this,n).duration=e}}function pz(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?hz:fz)(e,n)):jn(this.node(),e).duration}function mz(n,e){if(typeof e!="function")throw new Error;return function(){cs(this,n).ease=e}}function gz(n){var e=this._id;return arguments.length?this.each(mz(e,n)):jn(this.node(),e).ease}function xz(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;cs(this,n).ease=t}}function yz(n){if(typeof n!="function")throw new Error;return this.each(xz(this._id,n))}function bz(n){typeof n!="function"&&(n=rN(n));for(var e=this._groups,t=e.length,s=new Array(t),r=0;r<t;++r)for(var i=e[r],o=i.length,a=s[r]=[],l,c=0;c<o;++c)(l=i[c])&&n.call(l,l.__data__,c,i)&&a.push(l);return new Bs(s,this._parents,this._name,this._id)}function vz(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,s=e.length,r=t.length,i=Math.min(s,r),o=new Array(s),a=0;a<i;++a)for(var l=e[a],c=t[a],u=l.length,d=o[a]=new Array(u),h,p=0;p<u;++p)(h=l[p]||c[p])&&(d[p]=h);for(;a<s;++a)o[a]=e[a];return new Bs(o,this._parents,this._name,this._id)}function _z(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function Tz(n,e,t){var s,r,i=_z(e)?eg:cs;return function(){var o=i(this,n),a=o.on;a!==s&&(r=(s=a).copy()).on(e,t),o.on=r}}function wz(n,e){var t=this._id;return arguments.length<2?jn(this.node(),t).on.on(n):this.each(Tz(t,n,e))}function Nz(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function Sz(){return this.on("end.remove",Nz(this._id))}function Ez(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Wm(n));for(var s=this._groups,r=s.length,i=new Array(r),o=0;o<r;++o)for(var a=s[o],l=a.length,c=i[o]=new Array(l),u,d,h=0;h<l;++h)(u=a[h])&&(d=n.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),c[h]=d,id(c[h],e,t,h,c,jn(u,t)));return new Bs(i,this._parents,e,t)}function Az(n){var e=this._name,t=this._id;typeof n!="function"&&(n=sN(n));for(var s=this._groups,r=s.length,i=[],o=[],a=0;a<r;++a)for(var l=s[a],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var h=n.call(u,u.__data__,d,l),p,m=jn(u,t),x=0,y=h.length;x<y;++x)(p=h[x])&&id(p,e,t,x,h,m);i.push(h),o.push(u)}return new Bs(i,o,e,t)}var Cz=al.prototype.constructor;function Rz(){return new Cz(this._groups,this._parents)}function Mz(n,e){var t,s,r;return function(){var i=oo(this,n),o=(this.style.removeProperty(n),oo(this,n));return i===o?null:i===t&&o===s?r:r=e(t=i,s=o)}}function ON(n){return function(){this.style.removeProperty(n)}}function Pz(n,e,t){var s,r=t+"",i;return function(){var o=oo(this,n);return o===r?null:o===s?i:i=e(s=o,t)}}function kz(n,e,t){var s,r,i;return function(){var o=oo(this,n),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),oo(this,n))),o===l?null:o===s&&l===r?i:(r=l,i=e(s=o,a))}}function Dz(n,e){var t,s,r,i="style."+e,o="end."+i,a;return function(){var l=cs(this,n),c=l.on,u=l.value[i]==null?a||(a=ON(e)):void 0;(c!==t||r!==u)&&(s=(t=c).copy()).on(o,r=u),l.on=s}}function Iz(n,e,t){var s=(n+="")=="transform"?Kk:FN;return e==null?this.styleTween(n,Mz(n,s)).on("end.style."+n,ON(n)):typeof e=="function"?this.styleTween(n,kz(n,s,tg(this,"style."+n,e))).each(Dz(this._id,n)):this.styleTween(n,Pz(n,s,e),t).on("end.style."+n,null)}function Bz(n,e,t){return function(s){this.style.setProperty(n,e.call(this,s),t)}}function Lz(n,e,t){var s,r;function i(){var o=e.apply(this,arguments);return o!==r&&(s=(r=o)&&Bz(n,o,t)),s}return i._value=e,i}function Fz(n,e,t){var s="style."+(n+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(e==null)return this.tween(s,null);if(typeof e!="function")throw new Error;return this.tween(s,Lz(n,e,t??""))}function Oz(n){return function(){this.textContent=n}}function jz(n){return function(){var e=n(this);this.textContent=e??""}}function Uz(n){return this.tween("text",typeof n=="function"?jz(tg(this,"text",n)):Oz(n==null?"":n+""))}function Vz(n){return function(e){this.textContent=n.call(this,e)}}function Gz(n){var e,t;function s(){var r=n.apply(this,arguments);return r!==t&&(e=(t=r)&&Vz(r)),e}return s._value=n,s}function $z(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,Gz(n))}function zz(){for(var n=this._name,e=this._id,t=jN(),s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=jn(l,e);id(l,n,t,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Bs(s,this._parents,n,t)}function Hz(){var n,e,t=this,s=t._id,r=t.size();return new Promise(function(i,o){var a={value:o},l={value:function(){--r===0&&i()}};t.each(function(){var c=cs(this,s),u=c.on;u!==n&&(e=(n=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),r===0&&i()})}var Wz=0;function Bs(n,e,t,s){this._groups=n,this._parents=e,this._name=t,this._id=s}function jN(){return++Wz}var gs=al.prototype;Bs.prototype={constructor:Bs,select:Ez,selectAll:Az,selectChild:gs.selectChild,selectChildren:gs.selectChildren,filter:bz,merge:vz,selection:Rz,transition:zz,call:gs.call,nodes:gs.nodes,node:gs.node,size:gs.size,empty:gs.empty,each:gs.each,on:wz,attr:sz,attrTween:lz,style:Iz,styleTween:Fz,text:Uz,textTween:$z,remove:Sz,tween:Y$,delay:dz,duration:pz,ease:gz,easeVarying:yz,end:Hz,[Symbol.iterator]:gs[Symbol.iterator]};function qz(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var Kz={time:null,delay:0,duration:250,ease:qz};function Xz(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function Yz(n){var e,t;n instanceof Bs?(e=n._id,n=n._name):(e=jN(),(t=Kz).time=cm(),n=n==null?null:n+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],a=o.length,l,c=0;c<a;++c)(l=o[c])&&id(l,n,e,c,o,t||Xz(l,e));return new Bs(s,this._parents,n,e)}al.prototype.interrupt=q$;al.prototype.transition=Yz;const tc=n=>()=>n;function Qz(n,{sourceEvent:e,target:t,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function As(n,e,t){this.k=n,this.x=e,this.y=t}As.prototype={constructor:As,scale:function(n){return n===1?this:new As(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new As(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ir=new As(1,0,0);As.prototype;function Ah(n){n.stopImmediatePropagation()}function Ko(n){n.preventDefault(),n.stopImmediatePropagation()}function Zz(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function Jz(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function yb(){return this.__zoom||ir}function e9(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function t9(){return navigator.maxTouchPoints||"ontouchstart"in this}function n9(n,e,t){var s=n.invertX(e[0][0])-t[0][0],r=n.invertX(e[1][0])-t[1][0],i=n.invertY(e[0][1])-t[0][1],o=n.invertY(e[1][1])-t[1][1];return n.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function UN(){var n=Zz,e=Jz,t=n9,s=e9,r=t9,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Jk,c=el("start","zoom","end"),u,d,h,p=500,m=150,x=0,y=10;function g(A){A.property("__zoom",yb).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",k).filter(r).on("touchstart.zoom",B).on("touchmove.zoom",V).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(A,O,I,R){var F=A.selection?A.selection():A;F.property("__zoom",yb),A!==F?w(A,O,I,R):F.interrupt().each(function(){T(this,arguments).event(R).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},g.scaleBy=function(A,O,I,R){g.scaleTo(A,function(){var F=this.__zoom.k,P=typeof O=="function"?O.apply(this,arguments):O;return F*P},I,R)},g.scaleTo=function(A,O,I,R){g.transform(A,function(){var F=e.apply(this,arguments),P=this.__zoom,W=I==null?_(F):typeof I=="function"?I.apply(this,arguments):I,L=P.invert(W),G=typeof O=="function"?O.apply(this,arguments):O;return t(v(b(P,G),W,L),F,o)},I,R)},g.translateBy=function(A,O,I,R){g.transform(A,function(){return t(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof I=="function"?I.apply(this,arguments):I),e.apply(this,arguments),o)},null,R)},g.translateTo=function(A,O,I,R,F){g.transform(A,function(){var P=e.apply(this,arguments),W=this.__zoom,L=R==null?_(P):typeof R=="function"?R.apply(this,arguments):R;return t(ir.translate(L[0],L[1]).scale(W.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof I=="function"?-I.apply(this,arguments):-I),P,o)},R,F)};function b(A,O){return O=Math.max(i[0],Math.min(i[1],O)),O===A.k?A:new As(O,A.x,A.y)}function v(A,O,I){var R=O[0]-I[0]*A.k,F=O[1]-I[1]*A.k;return R===A.x&&F===A.y?A:new As(A.k,R,F)}function _(A){return[(+A[0][0]+ +A[1][0])/2,(+A[0][1]+ +A[1][1])/2]}function w(A,O,I,R){A.on("start.zoom",function(){T(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(R).end()}).tween("zoom",function(){var F=this,P=arguments,W=T(F,P).event(R),L=e.apply(F,P),G=I==null?_(L):typeof I=="function"?I.apply(F,P):I,Z=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),ee=F.__zoom,j=typeof O=="function"?O.apply(F,P):O,Q=l(ee.invert(G).concat(Z/ee.k),j.invert(G).concat(Z/j.k));return function(te){if(te===1)te=j;else{var ce=Q(te),ve=Z/ce[2];te=new As(ve,G[0]-ce[0]*ve,G[1]-ce[1]*ve)}W.zoom(null,te)}})}function T(A,O,I){return!I&&A.__zooming||new E(A,O)}function E(A,O){this.that=A,this.args=O,this.active=0,this.sourceEvent=null,this.extent=e.apply(A,O),this.taps=0}E.prototype={event:function(A){return A&&(this.sourceEvent=A),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(A,O){return this.mouse&&A!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&A!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&A!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(A){var O=It(this.that).datum();c.call(A,this.that,new Qz(A,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:c}),O)}};function S(A,...O){if(!n.apply(this,arguments))return;var I=T(this,O).event(A),R=this.__zoom,F=Math.max(i[0],Math.min(i[1],R.k*Math.pow(2,s.apply(this,arguments)))),P=Cn(A);if(I.wheel)(I.mouse[0][0]!==P[0]||I.mouse[0][1]!==P[1])&&(I.mouse[1]=R.invert(I.mouse[0]=P)),clearTimeout(I.wheel);else{if(R.k===F)return;I.mouse=[P,R.invert(P)],Ac(this),I.start()}Ko(A),I.wheel=setTimeout(W,m),I.zoom("mouse",t(v(b(R,F),I.mouse[0],I.mouse[1]),I.extent,o));function W(){I.wheel=null,I.end()}}function C(A,...O){if(h||!n.apply(this,arguments))return;var I=A.currentTarget,R=T(this,O,!0).event(A),F=It(A.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",Z,!0),P=Cn(A,I),W=A.clientX,L=A.clientY;IN(A.view),Ah(A),R.mouse=[P,this.__zoom.invert(P)],Ac(this),R.start();function G(ee){if(Ko(ee),!R.moved){var j=ee.clientX-W,Q=ee.clientY-L;R.moved=j*j+Q*Q>x}R.event(ee).zoom("mouse",t(v(R.that.__zoom,R.mouse[0]=Cn(ee,I),R.mouse[1]),R.extent,o))}function Z(ee){F.on("mousemove.zoom mouseup.zoom",null),BN(ee.view,R.moved),Ko(ee),R.event(ee).end()}}function k(A,...O){if(n.apply(this,arguments)){var I=this.__zoom,R=Cn(A.changedTouches?A.changedTouches[0]:A,this),F=I.invert(R),P=I.k*(A.shiftKey?.5:2),W=t(v(b(I,P),R,F),e.apply(this,O),o);Ko(A),a>0?It(this).transition().duration(a).call(w,W,R,A):It(this).call(g.transform,W,R,A)}}function B(A,...O){if(n.apply(this,arguments)){var I=A.touches,R=I.length,F=T(this,O,A.changedTouches.length===R).event(A),P,W,L,G;for(Ah(A),W=0;W<R;++W)L=I[W],G=Cn(L,this),G=[G,this.__zoom.invert(G),L.identifier],F.touch0?!F.touch1&&F.touch0[2]!==G[2]&&(F.touch1=G,F.taps=0):(F.touch0=G,P=!0,F.taps=1+!!u);u&&(u=clearTimeout(u)),P&&(F.taps<2&&(d=G[0],u=setTimeout(function(){u=null},p)),Ac(this),F.start())}}function V(A,...O){if(this.__zooming){var I=T(this,O).event(A),R=A.changedTouches,F=R.length,P,W,L,G;for(Ko(A),P=0;P<F;++P)W=R[P],L=Cn(W,this),I.touch0&&I.touch0[2]===W.identifier?I.touch0[0]=L:I.touch1&&I.touch1[2]===W.identifier&&(I.touch1[0]=L);if(W=I.that.__zoom,I.touch1){var Z=I.touch0[0],ee=I.touch0[1],j=I.touch1[0],Q=I.touch1[1],te=(te=j[0]-Z[0])*te+(te=j[1]-Z[1])*te,ce=(ce=Q[0]-ee[0])*ce+(ce=Q[1]-ee[1])*ce;W=b(W,Math.sqrt(te/ce)),L=[(Z[0]+j[0])/2,(Z[1]+j[1])/2],G=[(ee[0]+Q[0])/2,(ee[1]+Q[1])/2]}else if(I.touch0)L=I.touch0[0],G=I.touch0[1];else return;I.zoom("touch",t(v(W,L,G),I.extent,o))}}function z(A,...O){if(this.__zooming){var I=T(this,O).event(A),R=A.changedTouches,F=R.length,P,W;for(Ah(A),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),P=0;P<F;++P)W=R[P],I.touch0&&I.touch0[2]===W.identifier?delete I.touch0:I.touch1&&I.touch1[2]===W.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(W=Cn(W,this),Math.hypot(d[0]-W[0],d[1]-W[1])<y)){var L=It(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return g.wheelDelta=function(A){return arguments.length?(s=typeof A=="function"?A:tc(+A),g):s},g.filter=function(A){return arguments.length?(n=typeof A=="function"?A:tc(!!A),g):n},g.touchable=function(A){return arguments.length?(r=typeof A=="function"?A:tc(!!A),g):r},g.extent=function(A){return arguments.length?(e=typeof A=="function"?A:tc([[+A[0][0],+A[0][1]],[+A[1][0],+A[1][1]]]),g):e},g.scaleExtent=function(A){return arguments.length?(i[0]=+A[0],i[1]=+A[1],g):[i[0],i[1]]},g.translateExtent=function(A){return arguments.length?(o[0][0]=+A[0][0],o[1][0]=+A[1][0],o[0][1]=+A[0][1],o[1][1]=+A[1][1],g):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},g.constrain=function(A){return arguments.length?(t=A,g):t},g.duration=function(A){return arguments.length?(a=+A,g):a},g.interpolate=function(A){return arguments.length?(l=A,g):l},g.on=function(){var A=c.on.apply(c,arguments);return A===c?g:A},g.clickDistance=function(A){return arguments.length?(x=(A=+A)*A,g):Math.sqrt(x)},g.tapDistance=function(A){return arguments.length?(y=+A,g):y},g}KE();const od=N.createContext(null),s9=od.Provider,Ls={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:n=>`Node type "${n}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:n=>`The old edge with id=${n} does not exist.`,error009:n=>`Marker type "${n}" doesn't exist.`,error008:(n,e)=>`Couldn't create edge for ${n?"target":"source"} handle id: "${n?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:n=>`Edge type "${n}" not found. Using fallback type "default".`,error012:n=>`Node with id "${n}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},VN=Ls.error001();function rt(n,e){const t=N.useContext(od);if(t===null)throw new Error(VN);return DN(t,n,e)}const Tt=()=>{const n=N.useContext(od);if(n===null)throw new Error(VN);return N.useMemo(()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe,destroy:n.destroy}),[n])},r9=n=>n.userSelectionActive?"none":"all";function GN({position:n,children:e,className:t,style:s,...r}){const i=rt(r9),o=`${n}`.split("-");return X.createElement("div",{className:Ht(["react-flow__panel",t,...o]),style:{...s,pointerEvents:i},...r},e)}function i9({proOptions:n,position:e="bottom-right"}){return n?.hideAttribution?null:X.createElement(GN,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},X.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const o9=({x:n,y:e,label:t,labelStyle:s={},labelShowBg:r=!0,labelBgStyle:i={},labelBgPadding:o=[2,4],labelBgBorderRadius:a=2,children:l,className:c,...u})=>{const d=N.useRef(null),[h,p]=N.useState({x:0,y:0,width:0,height:0}),m=Ht(["react-flow__edge-textwrapper",c]);return N.useEffect(()=>{if(d.current){const x=d.current.getBBox();p({x:x.x,y:x.y,width:x.width,height:x.height})}},[t]),typeof t>"u"||!t?null:X.createElement("g",{transform:`translate(${n-h.width/2} ${e-h.height/2})`,className:m,visibility:h.width?"visible":"hidden",...u},r&&X.createElement("rect",{width:h.width+2*o[0],x:-o[0],y:-o[1],height:h.height+2*o[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),X.createElement("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:d,style:s},t),l)};var a9=N.memo(o9);const ng=n=>({width:n.offsetWidth,height:n.offsetHeight}),lo=(n,e=0,t=1)=>Math.min(Math.max(n,e),t),sg=(n={x:0,y:0},e)=>({x:lo(n.x,e[0][0],e[1][0]),y:lo(n.y,e[0][1],e[1][1])}),bb=(n,e,t)=>n<e?lo(Math.abs(n-e),1,50)/50:n>t?-lo(Math.abs(n-t),1,50)/50:0,$N=(n,e)=>{const t=bb(n.x,35,e.width-35)*20,s=bb(n.y,35,e.height-35)*20;return[t,s]},zN=n=>n.getRootNode?.()||window?.document,l9=(n,e)=>({x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}),rg=({x:n,y:e,width:t,height:s})=>({x:n,y:e,x2:n+t,y2:e+s}),c9=({x:n,y:e,x2:t,y2:s})=>({x:n,y:e,width:t-n,height:s-e}),vb=n=>({...n.positionAbsolute||{x:0,y:0},width:n.width||0,height:n.height||0}),hp=(n,e)=>{const t=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),s=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(t*s)},u9=n=>mn(n.width)&&mn(n.height)&&mn(n.x)&&mn(n.y),mn=n=>!isNaN(n)&&isFinite(n),at=Symbol.for("internals"),HN=["Enter"," ","Escape"],d9=(n,e)=>{},h9=n=>"nativeEvent"in n;function fp(n){const t=(h9(n)?n.nativeEvent:n).composedPath?.()?.[0]||n.target;return["INPUT","SELECT","TEXTAREA"].includes(t?.nodeName)||t?.hasAttribute("contenteditable")||!!t?.closest(".nokey")}const WN=n=>"clientX"in n,or=(n,e)=>{const t=WN(n),s=t?n.clientX:n.touches?.[0].clientX,r=t?n.clientY:n.touches?.[0].clientY;return{x:s-(e?.left??0),y:r-(e?.top??0)}},fu=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,ul=({id:n,path:e,labelX:t,labelY:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:p=20})=>X.createElement(X.Fragment,null,X.createElement("path",{id:n,style:u,d:e,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:h}),p&&X.createElement("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:p,className:"react-flow__edge-interaction"}),r&&mn(t)&&mn(s)?X.createElement(a9,{x:t,y:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c}):null);ul.displayName="BaseEdge";function Xo(n,e,t){return t===void 0?t:s=>{const r=e().edges.find(i=>i.id===n);r&&t(s,{...r})}}function qN({sourceX:n,sourceY:e,targetX:t,targetY:s}){const r=Math.abs(t-n)/2,i=t<n?t+r:t-r,o=Math.abs(s-e)/2,a=s<e?s+o:s-o;return[i,a,r,o]}function KN({sourceX:n,sourceY:e,targetX:t,targetY:s,sourceControlX:r,sourceControlY:i,targetControlX:o,targetControlY:a}){const l=n*.125+r*.375+o*.375+t*.125,c=e*.125+i*.375+a*.375+s*.125,u=Math.abs(l-n),d=Math.abs(c-e);return[l,c,u,d]}var ni;(function(n){n.Strict="strict",n.Loose="loose"})(ni||(ni={}));var Vr;(function(n){n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal"})(Vr||(Vr={}));var za;(function(n){n.Partial="partial",n.Full="full"})(za||(za={}));var Qs;(function(n){n.Bezier="default",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n.SimpleBezier="simplebezier"})(Qs||(Qs={}));var pu;(function(n){n.Arrow="arrow",n.ArrowClosed="arrowclosed"})(pu||(pu={}));var fe;(function(n){n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom"})(fe||(fe={}));function _b({pos:n,x1:e,y1:t,x2:s,y2:r}){return n===fe.Left||n===fe.Right?[.5*(e+s),t]:[e,.5*(t+r)]}function XN({sourceX:n,sourceY:e,sourcePosition:t=fe.Bottom,targetX:s,targetY:r,targetPosition:i=fe.Top}){const[o,a]=_b({pos:t,x1:n,y1:e,x2:s,y2:r}),[l,c]=_b({pos:i,x1:s,y1:r,x2:n,y2:e}),[u,d,h,p]=KN({sourceX:n,sourceY:e,targetX:s,targetY:r,sourceControlX:o,sourceControlY:a,targetControlX:l,targetControlY:c});return[`M${n},${e} C${o},${a} ${l},${c} ${s},${r}`,u,d,h,p]}const ig=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:s,sourcePosition:r=fe.Bottom,targetPosition:i=fe.Top,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:x})=>{const[y,g,b]=XN({sourceX:n,sourceY:e,sourcePosition:r,targetX:t,targetY:s,targetPosition:i});return X.createElement(ul,{path:y,labelX:g,labelY:b,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:x})});ig.displayName="SimpleBezierEdge";const Tb={[fe.Left]:{x:-1,y:0},[fe.Right]:{x:1,y:0},[fe.Top]:{x:0,y:-1},[fe.Bottom]:{x:0,y:1}},f9=({source:n,sourcePosition:e=fe.Bottom,target:t})=>e===fe.Left||e===fe.Right?n.x<t.x?{x:1,y:0}:{x:-1,y:0}:n.y<t.y?{x:0,y:1}:{x:0,y:-1},wb=(n,e)=>Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));function p9({source:n,sourcePosition:e=fe.Bottom,target:t,targetPosition:s=fe.Top,center:r,offset:i}){const o=Tb[e],a=Tb[s],l={x:n.x+o.x*i,y:n.y+o.y*i},c={x:t.x+a.x*i,y:t.y+a.y*i},u=f9({source:l,sourcePosition:e,target:c}),d=u.x!==0?"x":"y",h=u[d];let p=[],m,x;const y={x:0,y:0},g={x:0,y:0},[b,v,_,w]=qN({sourceX:n.x,sourceY:n.y,targetX:t.x,targetY:t.y});if(o[d]*a[d]===-1){m=r.x??b,x=r.y??v;const E=[{x:m,y:l.y},{x:m,y:c.y}],S=[{x:l.x,y:x},{x:c.x,y:x}];o[d]===h?p=d==="x"?E:S:p=d==="x"?S:E}else{const E=[{x:l.x,y:c.y}],S=[{x:c.x,y:l.y}];if(d==="x"?p=o.x===h?S:E:p=o.y===h?E:S,e===s){const z=Math.abs(n[d]-t[d]);if(z<=i){const A=Math.min(i-1,i-z);o[d]===h?y[d]=(l[d]>n[d]?-1:1)*A:g[d]=(c[d]>t[d]?-1:1)*A}}if(e!==s){const z=d==="x"?"y":"x",A=o[d]===a[z],O=l[z]>c[z],I=l[z]<c[z];(o[d]===1&&(!A&&O||A&&I)||o[d]!==1&&(!A&&I||A&&O))&&(p=d==="x"?E:S)}const C={x:l.x+y.x,y:l.y+y.y},k={x:c.x+g.x,y:c.y+g.y},B=Math.max(Math.abs(C.x-p[0].x),Math.abs(k.x-p[0].x)),V=Math.max(Math.abs(C.y-p[0].y),Math.abs(k.y-p[0].y));B>=V?(m=(C.x+k.x)/2,x=p[0].y):(m=p[0].x,x=(C.y+k.y)/2)}return[[n,{x:l.x+y.x,y:l.y+y.y},...p,{x:c.x+g.x,y:c.y+g.y},t],m,x,_,w]}function m9(n,e,t,s){const r=Math.min(wb(n,e)/2,wb(e,t)/2,s),{x:i,y:o}=e;if(n.x===i&&i===t.x||n.y===o&&o===t.y)return`L${i} ${o}`;if(n.y===o){const c=n.x<t.x?-1:1,u=n.y<t.y?1:-1;return`L ${i+r*c},${o}Q ${i},${o} ${i},${o+r*u}`}const a=n.x<t.x?1:-1,l=n.y<t.y?-1:1;return`L ${i},${o+r*l}Q ${i},${o} ${i+r*a},${o}`}function pp({sourceX:n,sourceY:e,sourcePosition:t=fe.Bottom,targetX:s,targetY:r,targetPosition:i=fe.Top,borderRadius:o=5,centerX:a,centerY:l,offset:c=20}){const[u,d,h,p,m]=p9({source:{x:n,y:e},sourcePosition:t,target:{x:s,y:r},targetPosition:i,center:{x:a,y:l},offset:c});return[u.reduce((y,g,b)=>{let v="";return b>0&&b<u.length-1?v=m9(u[b-1],g,u[b+1],o):v=`${b===0?"M":"L"}${g.x} ${g.y}`,y+=v,y},""),d,h,p,m]}const ad=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,sourcePosition:d=fe.Bottom,targetPosition:h=fe.Top,markerEnd:p,markerStart:m,pathOptions:x,interactionWidth:y})=>{const[g,b,v]=pp({sourceX:n,sourceY:e,sourcePosition:d,targetX:t,targetY:s,targetPosition:h,borderRadius:x?.borderRadius,offset:x?.offset});return X.createElement(ul,{path:g,labelX:b,labelY:v,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:p,markerStart:m,interactionWidth:y})});ad.displayName="SmoothStepEdge";const og=N.memo(n=>X.createElement(ad,{...n,pathOptions:N.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])}));og.displayName="StepEdge";function g9({sourceX:n,sourceY:e,targetX:t,targetY:s}){const[r,i,o,a]=qN({sourceX:n,sourceY:e,targetX:t,targetY:s});return[`M ${n},${e}L ${t},${s}`,r,i,o,a]}const ag=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:p})=>{const[m,x,y]=g9({sourceX:n,sourceY:e,targetX:t,targetY:s});return X.createElement(ul,{path:m,labelX:x,labelY:y,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:p})});ag.displayName="StraightEdge";function nc(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function Nb({pos:n,x1:e,y1:t,x2:s,y2:r,c:i}){switch(n){case fe.Left:return[e-nc(e-s,i),t];case fe.Right:return[e+nc(s-e,i),t];case fe.Top:return[e,t-nc(t-r,i)];case fe.Bottom:return[e,t+nc(r-t,i)]}}function YN({sourceX:n,sourceY:e,sourcePosition:t=fe.Bottom,targetX:s,targetY:r,targetPosition:i=fe.Top,curvature:o=.25}){const[a,l]=Nb({pos:t,x1:n,y1:e,x2:s,y2:r,c:o}),[c,u]=Nb({pos:i,x1:s,y1:r,x2:n,y2:e,c:o}),[d,h,p,m]=KN({sourceX:n,sourceY:e,targetX:s,targetY:r,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${n},${e} C${a},${l} ${c},${u} ${s},${r}`,d,h,p,m]}const mu=N.memo(({sourceX:n,sourceY:e,targetX:t,targetY:s,sourcePosition:r=fe.Bottom,targetPosition:i=fe.Top,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,pathOptions:x,interactionWidth:y})=>{const[g,b,v]=YN({sourceX:n,sourceY:e,sourcePosition:r,targetX:t,targetY:s,targetPosition:i,curvature:x?.curvature});return X.createElement(ul,{path:g,labelX:b,labelY:v,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:y})});mu.displayName="BezierEdge";const lg=N.createContext(null),x9=lg.Provider;lg.Consumer;const y9=()=>N.useContext(lg),b9=n=>"id"in n&&"source"in n&&"target"in n,v9=({source:n,sourceHandle:e,target:t,targetHandle:s})=>`reactflow__edge-${n}${e||""}-${t}${s||""}`,mp=(n,e)=>typeof n>"u"?"":typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(s=>`${s}=${n[s]}`).join("&")}`,_9=(n,e)=>e.some(t=>t.source===n.source&&t.target===n.target&&(t.sourceHandle===n.sourceHandle||!t.sourceHandle&&!n.sourceHandle)&&(t.targetHandle===n.targetHandle||!t.targetHandle&&!n.targetHandle)),QN=(n,e)=>{if(!n.source||!n.target)return e;let t;return b9(n)?t={...n}:t={...n,id:v9(n)},_9(t,e)?e:e.concat(t)},gp=({x:n,y:e},[t,s,r],i,[o,a])=>{const l={x:(n-t)/r,y:(e-s)/r};return i?{x:o*Math.round(l.x/o),y:a*Math.round(l.y/a)}:l},ZN=({x:n,y:e},[t,s,r])=>({x:n*r+t,y:e*r+s}),zi=(n,e=[0,0])=>{if(!n)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const t=(n.width??0)*e[0],s=(n.height??0)*e[1],r={x:n.position.x-t,y:n.position.y-s};return{...r,positionAbsolute:n.positionAbsolute?{x:n.positionAbsolute.x-t,y:n.positionAbsolute.y-s}:r}},cg=(n,e=[0,0])=>{if(n.length===0)return{x:0,y:0,width:0,height:0};const t=n.reduce((s,r)=>{const{x:i,y:o}=zi(r,e).positionAbsolute;return l9(s,rg({x:i,y:o,width:r.width||0,height:r.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return c9(t)},JN=(n,e,[t,s,r]=[0,0,1],i=!1,o=!1,a=[0,0])=>{const l={x:(e.x-t)/r,y:(e.y-s)/r,width:e.width/r,height:e.height/r},c=[];return n.forEach(u=>{const{width:d,height:h,selectable:p=!0,hidden:m=!1}=u;if(o&&!p||m)return!1;const{positionAbsolute:x}=zi(u,a),y={x:x.x,y:x.y,width:d||0,height:h||0},g=hp(l,y),b=typeof d>"u"||typeof h>"u"||d===null||h===null,v=i&&g>0,_=(d||0)*(h||0);(b||v||g>=_||u.dragging)&&c.push(u)}),c},eS=(n,e)=>{const t=n.map(s=>s.id);return e.filter(s=>t.includes(s.source)||t.includes(s.target))},tS=(n,e,t,s,r,i=.1)=>{const o=e/(n.width*(1+i)),a=t/(n.height*(1+i)),l=Math.min(o,a),c=lo(l,s,r),u=n.x+n.width/2,d=n.y+n.height/2,h=e/2-u*c,p=t/2-d*c;return{x:h,y:p,zoom:c}},Pr=(n,e=0)=>n.transition().duration(e);function Sb(n,e,t,s){return(e[t]||[]).reduce((r,i)=>(`${n.id}-${i.id}-${t}`!==s&&r.push({id:i.id||null,type:t,nodeId:n.id,x:(n.positionAbsolute?.x??0)+i.x+i.width/2,y:(n.positionAbsolute?.y??0)+i.y+i.height/2}),r),[])}function T9(n,e,t,s,r,i){const{x:o,y:a}=or(n),c=e.elementsFromPoint(o,a).find(m=>m.classList.contains("react-flow__handle"));if(c){const m=c.getAttribute("data-nodeid");if(m){const x=ug(void 0,c),y=c.getAttribute("data-handleid"),g=i({nodeId:m,id:y,type:x});if(g){const b=r.find(v=>v.nodeId===m&&v.type===x&&v.id===y);return{handle:{id:y,type:x,nodeId:m,x:b?.x||t.x,y:b?.y||t.y},validHandleResult:g}}}}let u=[],d=1/0;if(r.forEach(m=>{const x=Math.sqrt((m.x-t.x)**2+(m.y-t.y)**2);if(x<=s){const y=i(m);x<=d&&(x<d?u=[{handle:m,validHandleResult:y}]:x===d&&u.push({handle:m,validHandleResult:y}),d=x)}}),!u.length)return{handle:null,validHandleResult:nS()};if(u.length===1)return u[0];const h=u.some(({validHandleResult:m})=>m.isValid),p=u.some(({handle:m})=>m.type==="target");return u.find(({handle:m,validHandleResult:x})=>p?m.type==="target":h?x.isValid:!0)||u[0]}const w9={source:null,target:null,sourceHandle:null,targetHandle:null},nS=()=>({handleDomNode:null,isValid:!1,connection:w9,endHandle:null});function sS(n,e,t,s,r,i,o){const a=r==="target",l=o.querySelector(`.react-flow__handle[data-id="${n?.nodeId}-${n?.id}-${n?.type}"]`),c={...nS(),handleDomNode:l};if(l){const u=ug(void 0,l),d=l.getAttribute("data-nodeid"),h=l.getAttribute("data-handleid"),p=l.classList.contains("connectable"),m=l.classList.contains("connectableend"),x={source:a?d:t,sourceHandle:a?h:s,target:a?t:d,targetHandle:a?s:h};c.connection=x,p&&m&&(e===ni.Strict?a&&u==="source"||!a&&u==="target":d!==t||h!==s)&&(c.endHandle={nodeId:d,handleId:h,type:u},c.isValid=i(x))}return c}function N9({nodes:n,nodeId:e,handleId:t,handleType:s}){return n.reduce((r,i)=>{if(i[at]){const{handleBounds:o}=i[at];let a=[],l=[];o&&(a=Sb(i,o,"source",`${e}-${t}-${s}`),l=Sb(i,o,"target",`${e}-${t}-${s}`)),r.push(...a,...l)}return r},[])}function ug(n,e){return n||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function Ch(n){n?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function S9(n,e){let t=null;return e?t="valid":n&&!e&&(t="invalid"),t}function rS({event:n,handleId:e,nodeId:t,onConnect:s,isTarget:r,getState:i,setState:o,isValidConnection:a,edgeUpdaterType:l,onReconnectEnd:c}){const u=zN(n.target),{connectionMode:d,domNode:h,autoPanOnConnect:p,connectionRadius:m,onConnectStart:x,panBy:y,getNodes:g,cancelConnection:b}=i();let v=0,_;const{x:w,y:T}=or(n),E=u?.elementFromPoint(w,T),S=ug(l,E),C=h?.getBoundingClientRect();if(!C||!S)return;let k,B=or(n,C),V=!1,z=null,A=!1,O=null;const I=N9({nodes:g(),nodeId:t,handleId:e,handleType:S}),R=()=>{if(!p)return;const[W,L]=$N(B,C);y({x:W,y:L}),v=requestAnimationFrame(R)};o({connectionPosition:B,connectionStatus:null,connectionNodeId:t,connectionHandleId:e,connectionHandleType:S,connectionStartHandle:{nodeId:t,handleId:e,type:S},connectionEndHandle:null}),x?.(n,{nodeId:t,handleId:e,handleType:S});function F(W){const{transform:L}=i();B=or(W,C);const{handle:G,validHandleResult:Z}=T9(W,u,gp(B,L,!1,[1,1]),m,I,ee=>sS(ee,d,t,e,r?"target":"source",a,u));if(_=G,V||(R(),V=!0),O=Z.handleDomNode,z=Z.connection,A=Z.isValid,o({connectionPosition:_&&A?ZN({x:_.x,y:_.y},L):B,connectionStatus:S9(!!_,A),connectionEndHandle:Z.endHandle}),!_&&!A&&!O)return Ch(k);z.source!==z.target&&O&&(Ch(k),k=O,O.classList.add("connecting","react-flow__handle-connecting"),O.classList.toggle("valid",A),O.classList.toggle("react-flow__handle-valid",A))}function P(W){(_||O)&&z&&A&&s?.(z),i().onConnectEnd?.(W),l&&c?.(W),Ch(k),b(),cancelAnimationFrame(v),V=!1,A=!1,z=null,O=null,u.removeEventListener("mousemove",F),u.removeEventListener("mouseup",P),u.removeEventListener("touchmove",F),u.removeEventListener("touchend",P)}u.addEventListener("mousemove",F),u.addEventListener("mouseup",P),u.addEventListener("touchmove",F),u.addEventListener("touchend",P)}const Eb=()=>!0,E9=n=>({connectionStartHandle:n.connectionStartHandle,connectOnClick:n.connectOnClick,noPanClassName:n.noPanClassName}),A9=(n,e,t)=>s=>{const{connectionStartHandle:r,connectionEndHandle:i,connectionClickStartHandle:o}=s;return{connecting:r?.nodeId===n&&r?.handleId===e&&r?.type===t||i?.nodeId===n&&i?.handleId===e&&i?.type===t,clickConnecting:o?.nodeId===n&&o?.handleId===e&&o?.type===t}},iS=N.forwardRef(({type:n="source",position:e=fe.Top,isValidConnection:t,isConnectable:s=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:o,onConnect:a,children:l,className:c,onMouseDown:u,onTouchStart:d,...h},p)=>{const m=o||null,x=n==="target",y=Tt(),g=y9(),{connectOnClick:b,noPanClassName:v}=rt(E9,Lt),{connecting:_,clickConnecting:w}=rt(A9(g,m,n),Lt);g||y.getState().onError?.("010",Ls.error010());const T=C=>{const{defaultEdgeOptions:k,onConnect:B,hasDefaultEdges:V}=y.getState(),z={...k,...C};if(V){const{edges:A,setEdges:O}=y.getState();O(QN(z,A))}B?.(z),a?.(z)},E=C=>{if(!g)return;const k=WN(C);r&&(k&&C.button===0||!k)&&rS({event:C,handleId:m,nodeId:g,onConnect:T,isTarget:x,getState:y.getState,setState:y.setState,isValidConnection:t||y.getState().isValidConnection||Eb}),k?u?.(C):d?.(C)},S=C=>{const{onClickConnectStart:k,onClickConnectEnd:B,connectionClickStartHandle:V,connectionMode:z,isValidConnection:A}=y.getState();if(!g||!V&&!r)return;if(!V){k?.(C,{nodeId:g,handleId:m,handleType:n}),y.setState({connectionClickStartHandle:{nodeId:g,type:n,handleId:m}});return}const O=zN(C.target),I=t||A||Eb,{connection:R,isValid:F}=sS({nodeId:g,id:m,type:n},z,V.nodeId,V.handleId||null,V.type,I,O);F&&T(R),B?.(C),y.setState({connectionClickStartHandle:null})};return X.createElement("div",{"data-handleid":m,"data-nodeid":g,"data-handlepos":e,"data-id":`${g}-${m}-${n}`,className:Ht(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",v,c,{source:!x,target:x,connectable:s,connectablestart:r,connectableend:i,connecting:w,connectionindicator:s&&(r&&!_||i&&_)}]),onMouseDown:E,onTouchStart:E,onClick:b?S:void 0,ref:p,...h},l)});iS.displayName="Handle";var co=N.memo(iS);const oS=({data:n,isConnectable:e,targetPosition:t=fe.Top,sourcePosition:s=fe.Bottom})=>X.createElement(X.Fragment,null,X.createElement(co,{type:"target",position:t,isConnectable:e}),n?.label,X.createElement(co,{type:"source",position:s,isConnectable:e}));oS.displayName="DefaultNode";var xp=N.memo(oS);const aS=({data:n,isConnectable:e,sourcePosition:t=fe.Bottom})=>X.createElement(X.Fragment,null,n?.label,X.createElement(co,{type:"source",position:t,isConnectable:e}));aS.displayName="InputNode";var lS=N.memo(aS);const cS=({data:n,isConnectable:e,targetPosition:t=fe.Top})=>X.createElement(X.Fragment,null,X.createElement(co,{type:"target",position:t,isConnectable:e}),n?.label);cS.displayName="OutputNode";var uS=N.memo(cS);const dg=()=>null;dg.displayName="GroupNode";const C9=n=>({selectedNodes:n.getNodes().filter(e=>e.selected),selectedEdges:n.edges.filter(e=>e.selected).map(e=>({...e}))}),sc=n=>n.id;function R9(n,e){return Lt(n.selectedNodes.map(sc),e.selectedNodes.map(sc))&&Lt(n.selectedEdges.map(sc),e.selectedEdges.map(sc))}const dS=N.memo(({onSelectionChange:n})=>{const e=Tt(),{selectedNodes:t,selectedEdges:s}=rt(C9,R9);return N.useEffect(()=>{const r={nodes:t,edges:s};n?.(r),e.getState().onSelectionChange.forEach(i=>i(r))},[t,s,n]),null});dS.displayName="SelectionListener";const M9=n=>!!n.onSelectionChange;function P9({onSelectionChange:n}){const e=rt(M9);return n||e?X.createElement(dS,{onSelectionChange:n}):null}const k9=n=>({setNodes:n.setNodes,setEdges:n.setEdges,setDefaultNodesAndEdges:n.setDefaultNodesAndEdges,setMinZoom:n.setMinZoom,setMaxZoom:n.setMaxZoom,setTranslateExtent:n.setTranslateExtent,setNodeExtent:n.setNodeExtent,reset:n.reset});function Ti(n,e){N.useEffect(()=>{typeof n<"u"&&e(n)},[n])}function Ee(n,e,t){N.useEffect(()=>{typeof e<"u"&&t({[n]:e})},[e])}const D9=({nodes:n,edges:e,defaultNodes:t,defaultEdges:s,onConnect:r,onConnectStart:i,onConnectEnd:o,onClickConnectStart:a,onClickConnectEnd:l,nodesDraggable:c,nodesConnectable:u,nodesFocusable:d,edgesFocusable:h,edgesUpdatable:p,elevateNodesOnSelect:m,minZoom:x,maxZoom:y,nodeExtent:g,onNodesChange:b,onEdgesChange:v,elementsSelectable:_,connectionMode:w,snapGrid:T,snapToGrid:E,translateExtent:S,connectOnClick:C,defaultEdgeOptions:k,fitView:B,fitViewOptions:V,onNodesDelete:z,onEdgesDelete:A,onNodeDrag:O,onNodeDragStart:I,onNodeDragStop:R,onSelectionDrag:F,onSelectionDragStart:P,onSelectionDragStop:W,noPanClassName:L,nodeOrigin:G,rfId:Z,autoPanOnConnect:ee,autoPanOnNodeDrag:j,onError:Q,connectionRadius:te,isValidConnection:ce,nodeDragThreshold:ve})=>{const{setNodes:ye,setEdges:Pe,setDefaultNodesAndEdges:nt,setMinZoom:xt,setMaxZoom:lt,setTranslateExtent:He,setNodeExtent:wt,reset:ke}=rt(k9,Lt),de=Tt();return N.useEffect(()=>{const tn=s?.map(xr=>({...xr,...k}));return nt(t,tn),()=>{ke()}},[]),Ee("defaultEdgeOptions",k,de.setState),Ee("connectionMode",w,de.setState),Ee("onConnect",r,de.setState),Ee("onConnectStart",i,de.setState),Ee("onConnectEnd",o,de.setState),Ee("onClickConnectStart",a,de.setState),Ee("onClickConnectEnd",l,de.setState),Ee("nodesDraggable",c,de.setState),Ee("nodesConnectable",u,de.setState),Ee("nodesFocusable",d,de.setState),Ee("edgesFocusable",h,de.setState),Ee("edgesUpdatable",p,de.setState),Ee("elementsSelectable",_,de.setState),Ee("elevateNodesOnSelect",m,de.setState),Ee("snapToGrid",E,de.setState),Ee("snapGrid",T,de.setState),Ee("onNodesChange",b,de.setState),Ee("onEdgesChange",v,de.setState),Ee("connectOnClick",C,de.setState),Ee("fitViewOnInit",B,de.setState),Ee("fitViewOnInitOptions",V,de.setState),Ee("onNodesDelete",z,de.setState),Ee("onEdgesDelete",A,de.setState),Ee("onNodeDrag",O,de.setState),Ee("onNodeDragStart",I,de.setState),Ee("onNodeDragStop",R,de.setState),Ee("onSelectionDrag",F,de.setState),Ee("onSelectionDragStart",P,de.setState),Ee("onSelectionDragStop",W,de.setState),Ee("noPanClassName",L,de.setState),Ee("nodeOrigin",G,de.setState),Ee("rfId",Z,de.setState),Ee("autoPanOnConnect",ee,de.setState),Ee("autoPanOnNodeDrag",j,de.setState),Ee("onError",Q,de.setState),Ee("connectionRadius",te,de.setState),Ee("isValidConnection",ce,de.setState),Ee("nodeDragThreshold",ve,de.setState),Ti(n,ye),Ti(e,Pe),Ti(x,xt),Ti(y,lt),Ti(S,He),Ti(g,wt),null},Ab={display:"none"},I9={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},hS="react-flow__node-desc",fS="react-flow__edge-desc",B9="react-flow__aria-live",L9=n=>n.ariaLiveMessage;function F9({rfId:n}){const e=rt(L9);return X.createElement("div",{id:`${B9}-${n}`,"aria-live":"assertive","aria-atomic":"true",style:I9},e)}function O9({rfId:n,disableKeyboardA11y:e}){return X.createElement(X.Fragment,null,X.createElement("div",{id:`${hS}-${n}`,style:Ab},"Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),X.createElement("div",{id:`${fS}-${n}`,style:Ab},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!e&&X.createElement(F9,{rfId:n}))}var Ha=(n=null,e={actInsideInputWithModifier:!0})=>{const[t,s]=N.useState(!1),r=N.useRef(!1),i=N.useRef(new Set([])),[o,a]=N.useMemo(()=>{if(n!==null){const c=(Array.isArray(n)?n:[n]).filter(d=>typeof d=="string").map(d=>d.split("+")),u=c.reduce((d,h)=>d.concat(...h),[]);return[c,u]}return[[],[]]},[n]);return N.useEffect(()=>{const l=typeof document<"u"?document:null,c=e?.target||l;if(n!==null){const u=p=>{if(r.current=p.ctrlKey||p.metaKey||p.shiftKey,(!r.current||r.current&&!e.actInsideInputWithModifier)&&fp(p))return!1;const x=Rb(p.code,a);i.current.add(p[x]),Cb(o,i.current,!1)&&(p.preventDefault(),s(!0))},d=p=>{if((!r.current||r.current&&!e.actInsideInputWithModifier)&&fp(p))return!1;const x=Rb(p.code,a);Cb(o,i.current,!0)?(s(!1),i.current.clear()):i.current.delete(p[x]),p.key==="Meta"&&i.current.clear(),r.current=!1},h=()=>{i.current.clear(),s(!1)};return c?.addEventListener("keydown",u),c?.addEventListener("keyup",d),window.addEventListener("blur",h),()=>{c?.removeEventListener("keydown",u),c?.removeEventListener("keyup",d),window.removeEventListener("blur",h)}}},[n,s]),t};function Cb(n,e,t){return n.filter(s=>t||s.length===e.size).some(s=>s.every(r=>e.has(r)))}function Rb(n,e){return e.includes(n)?"code":"key"}function pS(n,e,t,s){const r=n.parentNode||n.parentId;if(!r)return t;const i=e.get(r),o=zi(i,s);return pS(i,e,{x:(t.x??0)+o.x,y:(t.y??0)+o.y,z:(i[at]?.z??0)>(t.z??0)?i[at]?.z??0:t.z??0},s)}function mS(n,e,t){n.forEach(s=>{const r=s.parentNode||s.parentId;if(r&&!n.has(r))throw new Error(`Parent node ${r} not found`);if(r||t?.[s.id]){const{x:i,y:o,z:a}=pS(s,n,{...s.position,z:s[at]?.z??0},e);s.positionAbsolute={x:i,y:o},s[at].z=a,t?.[s.id]&&(s[at].isParent=!0)}})}function Rh(n,e,t,s){const r=new Map,i={},o=s?1e3:0;return n.forEach(a=>{const l=(mn(a.zIndex)?a.zIndex:0)+(a.selected?o:0),c=e.get(a.id),u={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},d=a.parentNode||a.parentId;d&&(i[d]=!0);const h=c?.type&&c?.type!==a.type;Object.defineProperty(u,at,{enumerable:!1,value:{handleBounds:h?void 0:c?.[at]?.handleBounds,z:l}}),r.set(a.id,u)}),mS(r,t,i),r}function gS(n,e={}){const{getNodes:t,width:s,height:r,minZoom:i,maxZoom:o,d3Zoom:a,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:d}=n(),h=e.initial&&!c&&u;if(a&&l&&(h||!e.initial)){const m=t().filter(y=>{const g=e.includeHiddenNodes?y.width&&y.height:!y.hidden;return e.nodes?.length?g&&e.nodes.some(b=>b.id===y.id):g}),x=m.every(y=>y.width&&y.height);if(m.length>0&&x){const y=cg(m,d),{x:g,y:b,zoom:v}=tS(y,s,r,e.minZoom??i,e.maxZoom??o,e.padding??.1),_=ir.translate(g,b).scale(v);return typeof e.duration=="number"&&e.duration>0?a.transform(Pr(l,e.duration),_):a.transform(l,_),!0}}return!1}function j9(n,e){return n.forEach(t=>{const s=e.get(t.id);s&&e.set(s.id,{...s,[at]:s[at],selected:t.selected})}),new Map(e)}function U9(n,e){return e.map(t=>{const s=n.find(r=>r.id===t.id);return s&&(t.selected=s.selected),t})}function rc({changedNodes:n,changedEdges:e,get:t,set:s}){const{nodeInternals:r,edges:i,onNodesChange:o,onEdgesChange:a,hasDefaultNodes:l,hasDefaultEdges:c}=t();n?.length&&(l&&s({nodeInternals:j9(n,r)}),o?.(n)),e?.length&&(c&&s({edges:U9(e,i)}),a?.(e))}const wi=()=>{},V9={zoomIn:wi,zoomOut:wi,zoomTo:wi,getZoom:()=>1,setViewport:wi,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:wi,fitBounds:wi,project:n=>n,screenToFlowPosition:n=>n,flowToScreenPosition:n=>n,viewportInitialized:!1},G9=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection}),$9=()=>{const n=Tt(),{d3Zoom:e,d3Selection:t}=rt(G9,Lt);return N.useMemo(()=>t&&e?{zoomIn:r=>e.scaleBy(Pr(t,r?.duration),1.2),zoomOut:r=>e.scaleBy(Pr(t,r?.duration),1/1.2),zoomTo:(r,i)=>e.scaleTo(Pr(t,i?.duration),r),getZoom:()=>n.getState().transform[2],setViewport:(r,i)=>{const[o,a,l]=n.getState().transform,c=ir.translate(r.x??o,r.y??a).scale(r.zoom??l);e.transform(Pr(t,i?.duration),c)},getViewport:()=>{const[r,i,o]=n.getState().transform;return{x:r,y:i,zoom:o}},fitView:r=>gS(n.getState,r),setCenter:(r,i,o)=>{const{width:a,height:l,maxZoom:c}=n.getState(),u=typeof o?.zoom<"u"?o.zoom:c,d=a/2-r*u,h=l/2-i*u,p=ir.translate(d,h).scale(u);e.transform(Pr(t,o?.duration),p)},fitBounds:(r,i)=>{const{width:o,height:a,minZoom:l,maxZoom:c}=n.getState(),{x:u,y:d,zoom:h}=tS(r,o,a,l,c,i?.padding??.1),p=ir.translate(u,d).scale(h);e.transform(Pr(t,i?.duration),p)},project:r=>{const{transform:i,snapToGrid:o,snapGrid:a}=n.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),gp(r,i,o,a)},screenToFlowPosition:r=>{const{transform:i,snapToGrid:o,snapGrid:a,domNode:l}=n.getState();if(!l)return r;const{x:c,y:u}=l.getBoundingClientRect(),d={x:r.x-c,y:r.y-u};return gp(d,i,o,a)},flowToScreenPosition:r=>{const{transform:i,domNode:o}=n.getState();if(!o)return r;const{x:a,y:l}=o.getBoundingClientRect(),c=ZN(r,i);return{x:c.x+a,y:c.y+l}},viewportInitialized:!0}:V9,[e,t])};function hg(){const n=$9(),e=Tt(),t=N.useCallback(()=>e.getState().getNodes().map(x=>({...x})),[]),s=N.useCallback(x=>e.getState().nodeInternals.get(x),[]),r=N.useCallback(()=>{const{edges:x=[]}=e.getState();return x.map(y=>({...y}))},[]),i=N.useCallback(x=>{const{edges:y=[]}=e.getState();return y.find(g=>g.id===x)},[]),o=N.useCallback(x=>{const{getNodes:y,setNodes:g,hasDefaultNodes:b,onNodesChange:v}=e.getState(),_=y(),w=typeof x=="function"?x(_):x;if(b)g(w);else if(v){const T=w.length===0?_.map(E=>({type:"remove",id:E.id})):w.map(E=>({item:E,type:"reset"}));v(T)}},[]),a=N.useCallback(x=>{const{edges:y=[],setEdges:g,hasDefaultEdges:b,onEdgesChange:v}=e.getState(),_=typeof x=="function"?x(y):x;if(b)g(_);else if(v){const w=_.length===0?y.map(T=>({type:"remove",id:T.id})):_.map(T=>({item:T,type:"reset"}));v(w)}},[]),l=N.useCallback(x=>{const y=Array.isArray(x)?x:[x],{getNodes:g,setNodes:b,hasDefaultNodes:v,onNodesChange:_}=e.getState();if(v){const T=[...g(),...y];b(T)}else if(_){const w=y.map(T=>({item:T,type:"add"}));_(w)}},[]),c=N.useCallback(x=>{const y=Array.isArray(x)?x:[x],{edges:g=[],setEdges:b,hasDefaultEdges:v,onEdgesChange:_}=e.getState();if(v)b([...g,...y]);else if(_){const w=y.map(T=>({item:T,type:"add"}));_(w)}},[]),u=N.useCallback(()=>{const{getNodes:x,edges:y=[],transform:g}=e.getState(),[b,v,_]=g;return{nodes:x().map(w=>({...w})),edges:y.map(w=>({...w})),viewport:{x:b,y:v,zoom:_}}},[]),d=N.useCallback(({nodes:x,edges:y})=>{const{nodeInternals:g,getNodes:b,edges:v,hasDefaultNodes:_,hasDefaultEdges:w,onNodesDelete:T,onEdgesDelete:E,onNodesChange:S,onEdgesChange:C}=e.getState(),k=(x||[]).map(O=>O.id),B=(y||[]).map(O=>O.id),V=b().reduce((O,I)=>{const R=I.parentNode||I.parentId,F=!k.includes(I.id)&&R&&O.find(W=>W.id===R);return(typeof I.deletable=="boolean"?I.deletable:!0)&&(k.includes(I.id)||F)&&O.push(I),O},[]),z=v.filter(O=>typeof O.deletable=="boolean"?O.deletable:!0),A=z.filter(O=>B.includes(O.id));if(V||A){const O=eS(V,z),I=[...A,...O],R=I.reduce((F,P)=>(F.includes(P.id)||F.push(P.id),F),[]);if((w||_)&&(w&&e.setState({edges:v.filter(F=>!R.includes(F.id))}),_&&(V.forEach(F=>{g.delete(F.id)}),e.setState({nodeInternals:new Map(g)}))),R.length>0&&(E?.(I),C&&C(R.map(F=>({id:F,type:"remove"})))),V.length>0&&(T?.(V),S)){const F=V.map(P=>({id:P.id,type:"remove"}));S(F)}}},[]),h=N.useCallback(x=>{const y=u9(x),g=y?null:e.getState().nodeInternals.get(x.id);return!y&&!g?[null,null,y]:[y?x:vb(g),g,y]},[]),p=N.useCallback((x,y=!0,g)=>{const[b,v,_]=h(x);return b?(g||e.getState().getNodes()).filter(w=>{if(!_&&(w.id===v.id||!w.positionAbsolute))return!1;const T=vb(w),E=hp(T,b);return y&&E>0||E>=b.width*b.height}):[]},[]),m=N.useCallback((x,y,g=!0)=>{const[b]=h(x);if(!b)return!1;const v=hp(b,y);return g&&v>0||v>=b.width*b.height},[]);return N.useMemo(()=>({...n,getNodes:t,getNode:s,getEdges:r,getEdge:i,setNodes:o,setEdges:a,addNodes:l,addEdges:c,toObject:u,deleteElements:d,getIntersectingNodes:p,isNodeIntersecting:m}),[n,t,s,r,i,o,a,l,c,u,d,p,m])}const z9={actInsideInputWithModifier:!1};var H9=({deleteKeyCode:n,multiSelectionKeyCode:e})=>{const t=Tt(),{deleteElements:s}=hg(),r=Ha(n,z9),i=Ha(e);N.useEffect(()=>{if(r){const{edges:o,getNodes:a}=t.getState(),l=a().filter(u=>u.selected),c=o.filter(u=>u.selected);s({nodes:l,edges:c}),t.setState({nodesSelectionActive:!1})}},[r]),N.useEffect(()=>{t.setState({multiSelectionActive:i})},[i])};function W9(n){const e=Tt();N.useEffect(()=>{let t;const s=()=>{if(!n.current)return;const r=ng(n.current);(r.height===0||r.width===0)&&e.getState().onError?.("004",Ls.error004()),e.setState({width:r.width||500,height:r.height||500})};return s(),window.addEventListener("resize",s),n.current&&(t=new ResizeObserver(()=>s()),t.observe(n.current)),()=>{window.removeEventListener("resize",s),t&&n.current&&t.unobserve(n.current)}},[])}const fg={position:"absolute",width:"100%",height:"100%",top:0,left:0},q9=(n,e)=>n.x!==e.x||n.y!==e.y||n.zoom!==e.k,ic=n=>({x:n.x,y:n.y,zoom:n.k}),Ni=(n,e)=>n.target.closest(`.${e}`),Mb=(n,e)=>e===2&&Array.isArray(n)&&n.includes(2),Pb=n=>{const e=n.ctrlKey&&fu()?10:1;return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*e},K9=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection,d3ZoomHandler:n.d3ZoomHandler,userSelectionActive:n.userSelectionActive}),X9=({onMove:n,onMoveStart:e,onMoveEnd:t,onPaneContextMenu:s,zoomOnScroll:r=!0,zoomOnPinch:i=!0,panOnScroll:o=!1,panOnScrollSpeed:a=.5,panOnScrollMode:l=Vr.Free,zoomOnDoubleClick:c=!0,elementsSelectable:u,panOnDrag:d=!0,defaultViewport:h,translateExtent:p,minZoom:m,maxZoom:x,zoomActivationKeyCode:y,preventScrolling:g=!0,children:b,noWheelClassName:v,noPanClassName:_})=>{const w=N.useRef(),T=Tt(),E=N.useRef(!1),S=N.useRef(!1),C=N.useRef(null),k=N.useRef({x:0,y:0,zoom:0}),{d3Zoom:B,d3Selection:V,d3ZoomHandler:z,userSelectionActive:A}=rt(K9,Lt),O=Ha(y),I=N.useRef(0),R=N.useRef(!1),F=N.useRef();return W9(C),N.useEffect(()=>{if(C.current){const P=C.current.getBoundingClientRect(),W=UN().scaleExtent([m,x]).translateExtent(p),L=It(C.current).call(W),G=ir.translate(h.x,h.y).scale(lo(h.zoom,m,x)),Z=[[0,0],[P.width,P.height]],ee=W.constrain()(G,Z,p);W.transform(L,ee),W.wheelDelta(Pb),T.setState({d3Zoom:W,d3Selection:L,d3ZoomHandler:L.on("wheel.zoom"),transform:[ee.x,ee.y,ee.k],domNode:C.current.closest(".react-flow")})}},[]),N.useEffect(()=>{V&&B&&(o&&!O&&!A?V.on("wheel.zoom",P=>{if(Ni(P,v))return!1;P.preventDefault(),P.stopImmediatePropagation();const W=V.property("__zoom").k||1;if(P.ctrlKey&&i){const ce=Cn(P),ve=Pb(P),ye=W*Math.pow(2,ve);B.scaleTo(V,ye,ce,P);return}const L=P.deltaMode===1?20:1;let G=l===Vr.Vertical?0:P.deltaX*L,Z=l===Vr.Horizontal?0:P.deltaY*L;!fu()&&P.shiftKey&&l!==Vr.Vertical&&(G=P.deltaY*L,Z=0),B.translateBy(V,-(G/W)*a,-(Z/W)*a,{internal:!0});const ee=ic(V.property("__zoom")),{onViewportChangeStart:j,onViewportChange:Q,onViewportChangeEnd:te}=T.getState();clearTimeout(F.current),R.current||(R.current=!0,e?.(P,ee),j?.(ee)),R.current&&(n?.(P,ee),Q?.(ee),F.current=setTimeout(()=>{t?.(P,ee),te?.(ee),R.current=!1},150))},{passive:!1}):typeof z<"u"&&V.on("wheel.zoom",function(P,W){if(!g&&P.type==="wheel"&&!P.ctrlKey||Ni(P,v))return null;P.preventDefault(),z.call(this,P,W)},{passive:!1}))},[A,o,l,V,B,z,O,i,g,v,e,n,t]),N.useEffect(()=>{B&&B.on("start",P=>{if(!P.sourceEvent||P.sourceEvent.internal)return null;I.current=P.sourceEvent?.button;const{onViewportChangeStart:W}=T.getState(),L=ic(P.transform);E.current=!0,k.current=L,P.sourceEvent?.type==="mousedown"&&T.setState({paneDragging:!0}),W?.(L),e?.(P.sourceEvent,L)})},[B,e]),N.useEffect(()=>{B&&(A&&!E.current?B.on("zoom",null):A||B.on("zoom",P=>{const{onViewportChange:W}=T.getState();if(T.setState({transform:[P.transform.x,P.transform.y,P.transform.k]}),S.current=!!(s&&Mb(d,I.current??0)),(n||W)&&!P.sourceEvent?.internal){const L=ic(P.transform);W?.(L),n?.(P.sourceEvent,L)}}))},[A,B,n,d,s]),N.useEffect(()=>{B&&B.on("end",P=>{if(!P.sourceEvent||P.sourceEvent.internal)return null;const{onViewportChangeEnd:W}=T.getState();if(E.current=!1,T.setState({paneDragging:!1}),s&&Mb(d,I.current??0)&&!S.current&&s(P.sourceEvent),S.current=!1,(t||W)&&q9(k.current,P.transform)){const L=ic(P.transform);k.current=L,clearTimeout(w.current),w.current=setTimeout(()=>{W?.(L),t?.(P.sourceEvent,L)},o?150:0)}})},[B,o,d,t,s]),N.useEffect(()=>{B&&B.filter(P=>{const W=O||r,L=i&&P.ctrlKey;if((d===!0||Array.isArray(d)&&d.includes(1))&&P.button===1&&P.type==="mousedown"&&(Ni(P,"react-flow__node")||Ni(P,"react-flow__edge")))return!0;if(!d&&!W&&!o&&!c&&!i||A||!c&&P.type==="dblclick"||Ni(P,v)&&P.type==="wheel"||Ni(P,_)&&(P.type!=="wheel"||o&&P.type==="wheel"&&!O)||!i&&P.ctrlKey&&P.type==="wheel"||!W&&!o&&!L&&P.type==="wheel"||!d&&(P.type==="mousedown"||P.type==="touchstart")||Array.isArray(d)&&!d.includes(P.button)&&P.type==="mousedown")return!1;const G=Array.isArray(d)&&d.includes(P.button)||!P.button||P.button<=1;return(!P.ctrlKey||P.type==="wheel")&&G})},[A,B,r,i,o,c,d,u,O]),X.createElement("div",{className:"react-flow__renderer",ref:C,style:fg},b)},Y9=n=>({userSelectionActive:n.userSelectionActive,userSelectionRect:n.userSelectionRect});function Q9(){const{userSelectionActive:n,userSelectionRect:e}=rt(Y9,Lt);return n&&e?X.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}function kb(n,e){const t=e.parentNode||e.parentId,s=n.find(r=>r.id===t);if(s){const r=e.position.x+e.width-s.width,i=e.position.y+e.height-s.height;if(r>0||i>0||e.position.x<0||e.position.y<0){if(s.style={...s.style},s.style.width=s.style.width??s.width,s.style.height=s.style.height??s.height,r>0&&(s.style.width+=r),i>0&&(s.style.height+=i),e.position.x<0){const o=Math.abs(e.position.x);s.position.x=s.position.x-o,s.style.width+=o,e.position.x=0}if(e.position.y<0){const o=Math.abs(e.position.y);s.position.y=s.position.y-o,s.style.height+=o,e.position.y=0}s.width=s.style.width,s.height=s.style.height}}}function xS(n,e){if(n.some(s=>s.type==="reset"))return n.filter(s=>s.type==="reset").map(s=>s.item);const t=n.filter(s=>s.type==="add").map(s=>s.item);return e.reduce((s,r)=>{const i=n.filter(a=>a.id===r.id);if(i.length===0)return s.push(r),s;const o={...r};for(const a of i)if(a)switch(a.type){case"select":{o.selected=a.selected;break}case"position":{typeof a.position<"u"&&(o.position=a.position),typeof a.positionAbsolute<"u"&&(o.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(o.dragging=a.dragging),o.expandParent&&kb(s,o);break}case"dimensions":{typeof a.dimensions<"u"&&(o.width=a.dimensions.width,o.height=a.dimensions.height),typeof a.updateStyle<"u"&&(o.style={...o.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(o.resizing=a.resizing),o.expandParent&&kb(s,o);break}case"remove":return s}return s.push(o),s},t)}function yS(n,e){return xS(n,e)}function Z9(n,e){return xS(n,e)}const qs=(n,e)=>({id:n,type:"select",selected:e});function Pi(n,e){return n.reduce((t,s)=>{const r=e.includes(s.id);return!s.selected&&r?(s.selected=!0,t.push(qs(s.id,!0))):s.selected&&!r&&(s.selected=!1,t.push(qs(s.id,!1))),t},[])}const Mh=(n,e)=>t=>{t.target===e.current&&n?.(t)},J9=n=>({userSelectionActive:n.userSelectionActive,elementsSelectable:n.elementsSelectable,dragging:n.paneDragging}),bS=N.memo(({isSelecting:n,selectionMode:e=za.Full,panOnDrag:t,onSelectionStart:s,onSelectionEnd:r,onPaneClick:i,onPaneContextMenu:o,onPaneScroll:a,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:u,children:d})=>{const h=N.useRef(null),p=Tt(),m=N.useRef(0),x=N.useRef(0),y=N.useRef(),{userSelectionActive:g,elementsSelectable:b,dragging:v}=rt(J9,Lt),_=()=>{p.setState({userSelectionActive:!1,userSelectionRect:null}),m.current=0,x.current=0},w=z=>{i?.(z),p.getState().resetSelectedElements(),p.setState({nodesSelectionActive:!1})},T=z=>{if(Array.isArray(t)&&t?.includes(2)){z.preventDefault();return}o?.(z)},E=a?z=>a(z):void 0,S=z=>{const{resetSelectedElements:A,domNode:O}=p.getState();if(y.current=O?.getBoundingClientRect(),!b||!n||z.button!==0||z.target!==h.current||!y.current)return;const{x:I,y:R}=or(z,y.current);A(),p.setState({userSelectionRect:{width:0,height:0,startX:I,startY:R,x:I,y:R}}),s?.(z)},C=z=>{const{userSelectionRect:A,nodeInternals:O,edges:I,transform:R,onNodesChange:F,onEdgesChange:P,nodeOrigin:W,getNodes:L}=p.getState();if(!n||!y.current||!A)return;p.setState({userSelectionActive:!0,nodesSelectionActive:!1});const G=or(z,y.current),Z=A.startX??0,ee=A.startY??0,j={...A,x:G.x<Z?G.x:Z,y:G.y<ee?G.y:ee,width:Math.abs(G.x-Z),height:Math.abs(G.y-ee)},Q=L(),te=JN(O,j,R,e===za.Partial,!0,W),ce=eS(te,I).map(ye=>ye.id),ve=te.map(ye=>ye.id);if(m.current!==ve.length){m.current=ve.length;const ye=Pi(Q,ve);ye.length&&F?.(ye)}if(x.current!==ce.length){x.current=ce.length;const ye=Pi(I,ce);ye.length&&P?.(ye)}p.setState({userSelectionRect:j})},k=z=>{if(z.button!==0)return;const{userSelectionRect:A}=p.getState();!g&&A&&z.target===h.current&&w?.(z),p.setState({nodesSelectionActive:m.current>0}),_(),r?.(z)},B=z=>{g&&(p.setState({nodesSelectionActive:m.current>0}),r?.(z)),_()},V=b&&(n||g);return X.createElement("div",{className:Ht(["react-flow__pane",{dragging:v,selection:n}]),onClick:V?void 0:Mh(w,h),onContextMenu:Mh(T,h),onWheel:Mh(E,h),onMouseEnter:V?void 0:l,onMouseDown:V?S:void 0,onMouseMove:V?C:c,onMouseUp:V?k:void 0,onMouseLeave:V?B:u,ref:h,style:fg},d,X.createElement(Q9,null))});bS.displayName="Pane";function vS(n,e){const t=n.parentNode||n.parentId;if(!t)return!1;const s=e.get(t);return s?s.selected?!0:vS(s,e):!1}function Db(n,e,t){let s=n;do{if(s?.matches(e))return!0;if(s===t.current)return!1;s=s.parentElement}while(s);return!1}function e7(n,e,t,s){return Array.from(n.values()).filter(r=>(r.selected||r.id===s)&&(!r.parentNode||r.parentId||!vS(r,n))&&(r.draggable||e&&typeof r.draggable>"u")).map(r=>({id:r.id,position:r.position||{x:0,y:0},positionAbsolute:r.positionAbsolute||{x:0,y:0},distance:{x:t.x-(r.positionAbsolute?.x??0),y:t.y-(r.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:r.extent,parentNode:r.parentNode||r.parentId,parentId:r.parentNode||r.parentId,width:r.width,height:r.height,expandParent:r.expandParent}))}function t7(n,e){return!e||e==="parent"?e:[e[0],[e[1][0]-(n.width||0),e[1][1]-(n.height||0)]]}function _S(n,e,t,s,r=[0,0],i){const o=t7(n,n.extent||s);let a=o;const l=n.parentNode||n.parentId;if(n.extent==="parent"&&!n.expandParent)if(l&&n.width&&n.height){const d=t.get(l),{x:h,y:p}=zi(d,r).positionAbsolute;a=d&&mn(h)&&mn(p)&&mn(d.width)&&mn(d.height)?[[h+n.width*r[0],p+n.height*r[1]],[h+d.width-n.width+n.width*r[0],p+d.height-n.height+n.height*r[1]]]:a}else i?.("005",Ls.error005()),a=o;else if(n.extent&&l&&n.extent!=="parent"){const d=t.get(l),{x:h,y:p}=zi(d,r).positionAbsolute;a=[[n.extent[0][0]+h,n.extent[0][1]+p],[n.extent[1][0]+h,n.extent[1][1]+p]]}let c={x:0,y:0};if(l){const d=t.get(l);c=zi(d,r).positionAbsolute}const u=a&&a!=="parent"?sg(e,a):e;return{position:{x:u.x-c.x,y:u.y-c.y},positionAbsolute:u}}function Ph({nodeId:n,dragItems:e,nodeInternals:t}){const s=e.map(r=>({...t.get(r.id),position:r.position,positionAbsolute:r.positionAbsolute}));return[n?s.find(r=>r.id===n):s[0],s]}const Ib=(n,e,t,s)=>{const r=e.querySelectorAll(n);if(!r||!r.length)return null;const i=Array.from(r),o=e.getBoundingClientRect(),a={x:o.width*s[0],y:o.height*s[1]};return i.map(l=>{const c=l.getBoundingClientRect();return{id:l.getAttribute("data-handleid"),position:l.getAttribute("data-handlepos"),x:(c.left-o.left-a.x)/t,y:(c.top-o.top-a.y)/t,...ng(l)}})};function Yo(n,e,t){return t===void 0?t:s=>{const r=e().nodeInternals.get(n);r&&t(s,{...r})}}function yp({id:n,store:e,unselect:t=!1,nodeRef:s}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:o,nodeInternals:a,onError:l}=e.getState(),c=a.get(n);if(!c){l?.("012",Ls.error012(n));return}e.setState({nodesSelectionActive:!1}),c.selected?(t||c.selected&&o)&&(i({nodes:[c],edges:[]}),requestAnimationFrame(()=>s?.current?.blur())):r([n])}function n7(){const n=Tt();return N.useCallback(({sourceEvent:t})=>{const{transform:s,snapGrid:r,snapToGrid:i}=n.getState(),o=t.touches?t.touches[0].clientX:t.clientX,a=t.touches?t.touches[0].clientY:t.clientY,l={x:(o-s[0])/s[2],y:(a-s[1])/s[2]};return{xSnapped:i?r[0]*Math.round(l.x/r[0]):l.x,ySnapped:i?r[1]*Math.round(l.y/r[1]):l.y,...l}},[])}function kh(n){return(e,t,s)=>n?.(e,s)}function TS({nodeRef:n,disabled:e=!1,noDragClassName:t,handleSelector:s,nodeId:r,isSelectable:i,selectNodesOnDrag:o}){const a=Tt(),[l,c]=N.useState(!1),u=N.useRef([]),d=N.useRef({x:null,y:null}),h=N.useRef(0),p=N.useRef(null),m=N.useRef({x:0,y:0}),x=N.useRef(null),y=N.useRef(!1),g=N.useRef(!1),b=N.useRef(!1),v=n7();return N.useEffect(()=>{if(n?.current){const _=It(n.current),w=({x:S,y:C})=>{const{nodeInternals:k,onNodeDrag:B,onSelectionDrag:V,updateNodePositions:z,nodeExtent:A,snapGrid:O,snapToGrid:I,nodeOrigin:R,onError:F}=a.getState();d.current={x:S,y:C};let P=!1,W={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&A){const G=cg(u.current,R);W=rg(G)}if(u.current=u.current.map(G=>{const Z={x:S-G.distance.x,y:C-G.distance.y};I&&(Z.x=O[0]*Math.round(Z.x/O[0]),Z.y=O[1]*Math.round(Z.y/O[1]));const ee=[[A[0][0],A[0][1]],[A[1][0],A[1][1]]];u.current.length>1&&A&&!G.extent&&(ee[0][0]=G.positionAbsolute.x-W.x+A[0][0],ee[1][0]=G.positionAbsolute.x+(G.width??0)-W.x2+A[1][0],ee[0][1]=G.positionAbsolute.y-W.y+A[0][1],ee[1][1]=G.positionAbsolute.y+(G.height??0)-W.y2+A[1][1]);const j=_S(G,Z,k,ee,R,F);return P=P||G.position.x!==j.position.x||G.position.y!==j.position.y,G.position=j.position,G.positionAbsolute=j.positionAbsolute,G}),!P)return;z(u.current,!0,!0),c(!0);const L=r?B:kh(V);if(L&&x.current){const[G,Z]=Ph({nodeId:r,dragItems:u.current,nodeInternals:k});L(x.current,G,Z)}},T=()=>{if(!p.current)return;const[S,C]=$N(m.current,p.current);if(S!==0||C!==0){const{transform:k,panBy:B}=a.getState();d.current.x=(d.current.x??0)-S/k[2],d.current.y=(d.current.y??0)-C/k[2],B({x:S,y:C})&&w(d.current)}h.current=requestAnimationFrame(T)},E=S=>{const{nodeInternals:C,multiSelectionActive:k,nodesDraggable:B,unselectNodesAndEdges:V,onNodeDragStart:z,onSelectionDragStart:A}=a.getState();g.current=!0;const O=r?z:kh(A);(!o||!i)&&!k&&r&&(C.get(r)?.selected||V()),r&&i&&o&&yp({id:r,store:a,nodeRef:n});const I=v(S);if(d.current=I,u.current=e7(C,B,I,r),O&&u.current){const[R,F]=Ph({nodeId:r,dragItems:u.current,nodeInternals:C});O(S.sourceEvent,R,F)}};if(e)_.on(".drag",null);else{const S=$$().on("start",C=>{const{domNode:k,nodeDragThreshold:B}=a.getState();B===0&&E(C),b.current=!1;const V=v(C);d.current=V,p.current=k?.getBoundingClientRect()||null,m.current=or(C.sourceEvent,p.current)}).on("drag",C=>{const k=v(C),{autoPanOnNodeDrag:B,nodeDragThreshold:V}=a.getState();if(C.sourceEvent.type==="touchmove"&&C.sourceEvent.touches.length>1&&(b.current=!0),!b.current){if(!y.current&&g.current&&B&&(y.current=!0,T()),!g.current){const z=k.xSnapped-(d?.current?.x??0),A=k.ySnapped-(d?.current?.y??0);Math.sqrt(z*z+A*A)>V&&E(C)}(d.current.x!==k.xSnapped||d.current.y!==k.ySnapped)&&u.current&&g.current&&(x.current=C.sourceEvent,m.current=or(C.sourceEvent,p.current),w(k))}}).on("end",C=>{if(!(!g.current||b.current)&&(c(!1),y.current=!1,g.current=!1,cancelAnimationFrame(h.current),u.current)){const{updateNodePositions:k,nodeInternals:B,onNodeDragStop:V,onSelectionDragStop:z}=a.getState(),A=r?V:kh(z);if(k(u.current,!1,!1),A){const[O,I]=Ph({nodeId:r,dragItems:u.current,nodeInternals:B});A(C.sourceEvent,O,I)}}}).filter(C=>{const k=C.target;return!C.button&&(!t||!Db(k,`.${t}`,n))&&(!s||Db(k,s,n))});return _.call(S),()=>{_.on(".drag",null)}}}},[n,e,t,s,i,a,r,o,v]),l}function wS(){const n=Tt();return N.useCallback(t=>{const{nodeInternals:s,nodeExtent:r,updateNodePositions:i,getNodes:o,snapToGrid:a,snapGrid:l,onError:c,nodesDraggable:u}=n.getState(),d=o().filter(b=>b.selected&&(b.draggable||u&&typeof b.draggable>"u")),h=a?l[0]:5,p=a?l[1]:5,m=t.isShiftPressed?4:1,x=t.x*h*m,y=t.y*p*m,g=d.map(b=>{if(b.positionAbsolute){const v={x:b.positionAbsolute.x+x,y:b.positionAbsolute.y+y};a&&(v.x=l[0]*Math.round(v.x/l[0]),v.y=l[1]*Math.round(v.y/l[1]));const{positionAbsolute:_,position:w}=_S(b,v,s,r,void 0,c);b.position=w,b.positionAbsolute=_}return b});i(g,!0,!1)},[])}const Hi={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Qo=n=>{const e=({id:t,type:s,data:r,xPos:i,yPos:o,xPosOrigin:a,yPosOrigin:l,selected:c,onClick:u,onMouseEnter:d,onMouseMove:h,onMouseLeave:p,onContextMenu:m,onDoubleClick:x,style:y,className:g,isDraggable:b,isSelectable:v,isConnectable:_,isFocusable:w,selectNodesOnDrag:T,sourcePosition:E,targetPosition:S,hidden:C,resizeObserver:k,dragHandle:B,zIndex:V,isParent:z,noDragClassName:A,noPanClassName:O,initialized:I,disableKeyboardA11y:R,ariaLabel:F,rfId:P,hasHandleBounds:W})=>{const L=Tt(),G=N.useRef(null),Z=N.useRef(null),ee=N.useRef(E),j=N.useRef(S),Q=N.useRef(s),te=v||b||u||d||h||p,ce=wS(),ve=Yo(t,L.getState,d),ye=Yo(t,L.getState,h),Pe=Yo(t,L.getState,p),nt=Yo(t,L.getState,m),xt=Yo(t,L.getState,x),lt=ke=>{const{nodeDragThreshold:de}=L.getState();if(v&&(!T||!b||de>0)&&yp({id:t,store:L,nodeRef:G}),u){const tn=L.getState().nodeInternals.get(t);tn&&u(ke,{...tn})}},He=ke=>{if(!fp(ke)&&!R)if(HN.includes(ke.key)&&v){const de=ke.key==="Escape";yp({id:t,store:L,unselect:de,nodeRef:G})}else b&&c&&Object.prototype.hasOwnProperty.call(Hi,ke.key)&&(L.setState({ariaLiveMessage:`Moved selected node ${ke.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~o}`}),ce({x:Hi[ke.key].x,y:Hi[ke.key].y,isShiftPressed:ke.shiftKey}))};N.useEffect(()=>()=>{Z.current&&(k?.unobserve(Z.current),Z.current=null)},[]),N.useEffect(()=>{if(G.current&&!C){const ke=G.current;(!I||!W||Z.current!==ke)&&(Z.current&&k?.unobserve(Z.current),k?.observe(ke),Z.current=ke)}},[C,I,W]),N.useEffect(()=>{const ke=Q.current!==s,de=ee.current!==E,tn=j.current!==S;G.current&&(ke||de||tn)&&(ke&&(Q.current=s),de&&(ee.current=E),tn&&(j.current=S),L.getState().updateNodeDimensions([{id:t,nodeElement:G.current,forceUpdate:!0}]))},[t,s,E,S]);const wt=TS({nodeRef:G,disabled:C||!b,noDragClassName:A,handleSelector:B,nodeId:t,isSelectable:v,selectNodesOnDrag:T});return C?null:X.createElement("div",{className:Ht(["react-flow__node",`react-flow__node-${s}`,{[O]:b},g,{selected:c,selectable:v,parent:z,dragging:wt}]),ref:G,style:{zIndex:V,transform:`translate(${a}px,${l}px)`,pointerEvents:te?"all":"none",visibility:I?"visible":"hidden",...y},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:ve,onMouseMove:ye,onMouseLeave:Pe,onContextMenu:nt,onClick:lt,onDoubleClick:xt,onKeyDown:w?He:void 0,tabIndex:w?0:void 0,role:w?"button":void 0,"aria-describedby":R?void 0:`${hS}-${P}`,"aria-label":F},X.createElement(x9,{value:t},X.createElement(n,{id:t,data:r,type:s,xPos:i,yPos:o,selected:c,isConnectable:_,sourcePosition:E,targetPosition:S,dragging:wt,dragHandle:B,zIndex:V})))};return e.displayName="NodeWrapper",N.memo(e)};const s7=n=>{const e=n.getNodes().filter(t=>t.selected);return{...cg(e,n.nodeOrigin),transformString:`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`,userSelectionActive:n.userSelectionActive}};function r7({onSelectionContextMenu:n,noPanClassName:e,disableKeyboardA11y:t}){const s=Tt(),{width:r,height:i,x:o,y:a,transformString:l,userSelectionActive:c}=rt(s7,Lt),u=wS(),d=N.useRef(null);if(N.useEffect(()=>{t||d.current?.focus({preventScroll:!0})},[t]),TS({nodeRef:d}),c||!r||!i)return null;const h=n?m=>{const x=s.getState().getNodes().filter(y=>y.selected);n(m,x)}:void 0,p=m=>{Object.prototype.hasOwnProperty.call(Hi,m.key)&&u({x:Hi[m.key].x,y:Hi[m.key].y,isShiftPressed:m.shiftKey})};return X.createElement("div",{className:Ht(["react-flow__nodesselection","react-flow__container",e]),style:{transform:l}},X.createElement("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:t?void 0:-1,onKeyDown:t?void 0:p,style:{width:r,height:i,top:a,left:o}}))}var i7=N.memo(r7);const o7=n=>n.nodesSelectionActive,NS=({children:n,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,deleteKeyCode:a,onMove:l,onMoveStart:c,onMoveEnd:u,selectionKeyCode:d,selectionOnDrag:h,selectionMode:p,onSelectionStart:m,onSelectionEnd:x,multiSelectionKeyCode:y,panActivationKeyCode:g,zoomActivationKeyCode:b,elementsSelectable:v,zoomOnScroll:_,zoomOnPinch:w,panOnScroll:T,panOnScrollSpeed:E,panOnScrollMode:S,zoomOnDoubleClick:C,panOnDrag:k,defaultViewport:B,translateExtent:V,minZoom:z,maxZoom:A,preventScrolling:O,onSelectionContextMenu:I,noWheelClassName:R,noPanClassName:F,disableKeyboardA11y:P})=>{const W=rt(o7),L=Ha(d),G=Ha(g),Z=G||k,ee=G||T,j=L||h&&Z!==!0;return H9({deleteKeyCode:a,multiSelectionKeyCode:y}),X.createElement(X9,{onMove:l,onMoveStart:c,onMoveEnd:u,onPaneContextMenu:i,elementsSelectable:v,zoomOnScroll:_,zoomOnPinch:w,panOnScroll:ee,panOnScrollSpeed:E,panOnScrollMode:S,zoomOnDoubleClick:C,panOnDrag:!L&&Z,defaultViewport:B,translateExtent:V,minZoom:z,maxZoom:A,zoomActivationKeyCode:b,preventScrolling:O,noWheelClassName:R,noPanClassName:F},X.createElement(bS,{onSelectionStart:m,onSelectionEnd:x,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,panOnDrag:Z,isSelecting:!!j,selectionMode:p},n,W&&X.createElement(i7,{onSelectionContextMenu:I,noPanClassName:F,disableKeyboardA11y:P})))};NS.displayName="FlowRenderer";var a7=N.memo(NS);function l7(n){return rt(N.useCallback(t=>n?JN(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[n]))}function c7(n){const e={input:Qo(n.input||lS),default:Qo(n.default||xp),output:Qo(n.output||uS),group:Qo(n.group||dg)},t={},s=Object.keys(n).filter(r=>!["input","default","output","group"].includes(r)).reduce((r,i)=>(r[i]=Qo(n[i]||xp),r),t);return{...e,...s}}const u7=({x:n,y:e,width:t,height:s,origin:r})=>!t||!s?{x:n,y:e}:r[0]<0||r[1]<0||r[0]>1||r[1]>1?{x:n,y:e}:{x:n-t*r[0],y:e-s*r[1]},d7=n=>({nodesDraggable:n.nodesDraggable,nodesConnectable:n.nodesConnectable,nodesFocusable:n.nodesFocusable,elementsSelectable:n.elementsSelectable,updateNodeDimensions:n.updateNodeDimensions,onError:n.onError}),SS=n=>{const{nodesDraggable:e,nodesConnectable:t,nodesFocusable:s,elementsSelectable:r,updateNodeDimensions:i,onError:o}=rt(d7,Lt),a=l7(n.onlyRenderVisibleElements),l=N.useRef(),c=N.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const u=new ResizeObserver(d=>{const h=d.map(p=>({id:p.target.getAttribute("data-id"),nodeElement:p.target,forceUpdate:!0}));i(h)});return l.current=u,u},[]);return N.useEffect(()=>()=>{l?.current?.disconnect()},[]),X.createElement("div",{className:"react-flow__nodes",style:fg},a.map(u=>{let d=u.type||"default";n.nodeTypes[d]||(o?.("003",Ls.error003(d)),d="default");const h=n.nodeTypes[d]||n.nodeTypes.default,p=!!(u.draggable||e&&typeof u.draggable>"u"),m=!!(u.selectable||r&&typeof u.selectable>"u"),x=!!(u.connectable||t&&typeof u.connectable>"u"),y=!!(u.focusable||s&&typeof u.focusable>"u"),g=n.nodeExtent?sg(u.positionAbsolute,n.nodeExtent):u.positionAbsolute,b=g?.x??0,v=g?.y??0,_=u7({x:b,y:v,width:u.width??0,height:u.height??0,origin:n.nodeOrigin});return X.createElement(h,{key:u.id,id:u.id,className:u.className,style:u.style,type:d,data:u.data,sourcePosition:u.sourcePosition||fe.Bottom,targetPosition:u.targetPosition||fe.Top,hidden:u.hidden,xPos:b,yPos:v,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:n.selectNodesOnDrag,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,selected:!!u.selected,isDraggable:p,isSelectable:m,isConnectable:x,isFocusable:y,resizeObserver:c,dragHandle:u.dragHandle,zIndex:u[at]?.z??0,isParent:!!u[at]?.isParent,noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,initialized:!!u.width&&!!u.height,rfId:n.rfId,disableKeyboardA11y:n.disableKeyboardA11y,ariaLabel:u.ariaLabel,hasHandleBounds:!!u[at]?.handleBounds})}))};SS.displayName="NodeRenderer";var h7=N.memo(SS);const f7=(n,e,t)=>t===fe.Left?n-e:t===fe.Right?n+e:n,p7=(n,e,t)=>t===fe.Top?n-e:t===fe.Bottom?n+e:n,Bb="react-flow__edgeupdater",Lb=({position:n,centerX:e,centerY:t,radius:s=10,onMouseDown:r,onMouseEnter:i,onMouseOut:o,type:a})=>X.createElement("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:o,className:Ht([Bb,`${Bb}-${a}`]),cx:f7(e,s,n),cy:p7(t,s,n),r:s,stroke:"transparent",fill:"transparent"}),m7=()=>!0;var Si=n=>{const e=({id:t,className:s,type:r,data:i,onClick:o,onEdgeDoubleClick:a,selected:l,animated:c,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:p,labelBgPadding:m,labelBgBorderRadius:x,style:y,source:g,target:b,sourceX:v,sourceY:_,targetX:w,targetY:T,sourcePosition:E,targetPosition:S,elementsSelectable:C,hidden:k,sourceHandleId:B,targetHandleId:V,onContextMenu:z,onMouseEnter:A,onMouseMove:O,onMouseLeave:I,reconnectRadius:R,onReconnect:F,onReconnectStart:P,onReconnectEnd:W,markerEnd:L,markerStart:G,rfId:Z,ariaLabel:ee,isFocusable:j,isReconnectable:Q,pathOptions:te,interactionWidth:ce,disableKeyboardA11y:ve})=>{const ye=N.useRef(null),[Pe,nt]=N.useState(!1),[xt,lt]=N.useState(!1),He=Tt(),wt=N.useMemo(()=>`url('#${mp(G,Z)}')`,[G,Z]),ke=N.useMemo(()=>`url('#${mp(L,Z)}')`,[L,Z]);if(k)return null;const de=Mt=>{const{edges:Un,addSelectedEdges:vr,unselectNodesAndEdges:_r,multiSelectionActive:ci}=He.getState(),Vn=Un.find(Tr=>Tr.id===t);Vn&&(C&&(He.setState({nodesSelectionActive:!1}),Vn.selected&&ci?(_r({nodes:[],edges:[Vn]}),ye.current?.blur()):vr([t])),o&&o(Mt,Vn))},tn=Xo(t,He.getState,a),xr=Xo(t,He.getState,z),So=Xo(t,He.getState,A),ri=Xo(t,He.getState,O),ii=Xo(t,He.getState,I),us=(Mt,Un)=>{if(Mt.button!==0)return;const{edges:vr,isValidConnection:_r}=He.getState(),ci=Un?b:g,Vn=(Un?V:B)||null,Tr=Un?"target":"source",hd=_r||m7,fd=Un,Ao=vr.find(wr=>wr.id===t);lt(!0),P?.(Mt,Ao,Tr);const pd=wr=>{lt(!1),W?.(wr,Ao,Tr)};rS({event:Mt,handleId:Vn,nodeId:ci,onConnect:wr=>F?.(Ao,wr),isTarget:fd,getState:He.getState,setState:He.setState,isValidConnection:hd,edgeUpdaterType:Tr,onReconnectEnd:pd})},oi=Mt=>us(Mt,!0),yr=Mt=>us(Mt,!1),br=()=>nt(!0),ai=()=>nt(!1),li=!C&&!o,Eo=Mt=>{if(!ve&&HN.includes(Mt.key)&&C){const{unselectNodesAndEdges:Un,addSelectedEdges:vr,edges:_r}=He.getState();Mt.key==="Escape"?(ye.current?.blur(),Un({edges:[_r.find(Vn=>Vn.id===t)]})):vr([t])}};return X.createElement("g",{className:Ht(["react-flow__edge",`react-flow__edge-${r}`,s,{selected:l,animated:c,inactive:li,updating:Pe}]),onClick:de,onDoubleClick:tn,onContextMenu:xr,onMouseEnter:So,onMouseMove:ri,onMouseLeave:ii,onKeyDown:j?Eo:void 0,tabIndex:j?0:void 0,role:j?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":ee===null?void 0:ee||`Edge from ${g} to ${b}`,"aria-describedby":j?`${fS}-${Z}`:void 0,ref:ye},!xt&&X.createElement(n,{id:t,source:g,target:b,selected:l,animated:c,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:p,labelBgPadding:m,labelBgBorderRadius:x,data:i,style:y,sourceX:v,sourceY:_,targetX:w,targetY:T,sourcePosition:E,targetPosition:S,sourceHandleId:B,targetHandleId:V,markerStart:wt,markerEnd:ke,pathOptions:te,interactionWidth:ce}),Q&&X.createElement(X.Fragment,null,(Q==="source"||Q===!0)&&X.createElement(Lb,{position:E,centerX:v,centerY:_,radius:R,onMouseDown:oi,onMouseEnter:br,onMouseOut:ai,type:"source"}),(Q==="target"||Q===!0)&&X.createElement(Lb,{position:S,centerX:w,centerY:T,radius:R,onMouseDown:yr,onMouseEnter:br,onMouseOut:ai,type:"target"})))};return e.displayName="EdgeWrapper",N.memo(e)};function g7(n){const e={default:Si(n.default||mu),straight:Si(n.bezier||ag),step:Si(n.step||og),smoothstep:Si(n.step||ad),simplebezier:Si(n.simplebezier||ig)},t={},s=Object.keys(n).filter(r=>!["default","bezier"].includes(r)).reduce((r,i)=>(r[i]=Si(n[i]||mu),r),t);return{...e,...s}}function Fb(n,e,t=null){const s=(t?.x||0)+e.x,r=(t?.y||0)+e.y,i=t?.width||e.width,o=t?.height||e.height;switch(n){case fe.Top:return{x:s+i/2,y:r};case fe.Right:return{x:s+i,y:r+o/2};case fe.Bottom:return{x:s+i/2,y:r+o};case fe.Left:return{x:s,y:r+o/2}}}function Ob(n,e){return n?n.length===1||!e?n[0]:e&&n.find(t=>t.id===e)||null:null}const x7=(n,e,t,s,r,i)=>{const o=Fb(t,n,e),a=Fb(i,s,r);return{sourceX:o.x,sourceY:o.y,targetX:a.x,targetY:a.y}};function y7({sourcePos:n,targetPos:e,sourceWidth:t,sourceHeight:s,targetWidth:r,targetHeight:i,width:o,height:a,transform:l}){const c={x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x+t,e.x+r),y2:Math.max(n.y+s,e.y+i)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const u=rg({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:o/l[2],height:a/l[2]}),d=Math.max(0,Math.min(u.x2,c.x2)-Math.max(u.x,c.x)),h=Math.max(0,Math.min(u.y2,c.y2)-Math.max(u.y,c.y));return Math.ceil(d*h)>0}function jb(n){const e=n?.[at]?.handleBounds||null,t=e&&n?.width&&n?.height&&typeof n?.positionAbsolute?.x<"u"&&typeof n?.positionAbsolute?.y<"u";return[{x:n?.positionAbsolute?.x||0,y:n?.positionAbsolute?.y||0,width:n?.width||0,height:n?.height||0},e,!!t]}const b7=[{level:0,isMaxLevel:!0,edges:[]}];function v7(n,e,t=!1){let s=-1;const r=n.reduce((o,a)=>{const l=mn(a.zIndex);let c=l?a.zIndex:0;if(t){const u=e.get(a.target),d=e.get(a.source),h=a.selected||u?.selected||d?.selected,p=Math.max(d?.[at]?.z||0,u?.[at]?.z||0,1e3);c=(l?a.zIndex:0)+(h?p:0)}return o[c]?o[c].push(a):o[c]=[a],s=c>s?c:s,o},{}),i=Object.entries(r).map(([o,a])=>{const l=+o;return{edges:a,level:l,isMaxLevel:l===s}});return i.length===0?b7:i}function _7(n,e,t){const s=rt(N.useCallback(r=>n?r.edges.filter(i=>{const o=e.get(i.source),a=e.get(i.target);return o?.width&&o?.height&&a?.width&&a?.height&&y7({sourcePos:o.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:o.width,sourceHeight:o.height,targetWidth:a.width,targetHeight:a.height,width:r.width,height:r.height,transform:r.transform})}):r.edges,[n,e]));return v7(s,e,t)}const T7=({color:n="none",strokeWidth:e=1})=>X.createElement("polyline",{style:{stroke:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),w7=({color:n="none",strokeWidth:e=1})=>X.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Ub={[pu.Arrow]:T7,[pu.ArrowClosed]:w7};function N7(n){const e=Tt();return N.useMemo(()=>Object.prototype.hasOwnProperty.call(Ub,n)?Ub[n]:(e.getState().onError?.("009",Ls.error009(n)),null),[n])}const S7=({id:n,type:e,color:t,width:s=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:o,orient:a="auto-start-reverse"})=>{const l=N7(e);return l?X.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${s}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0"},X.createElement(l,{color:t,strokeWidth:o})):null},E7=({defaultColor:n,rfId:e})=>t=>{const s=[];return t.edges.reduce((r,i)=>([i.markerStart,i.markerEnd].forEach(o=>{if(o&&typeof o=="object"){const a=mp(o,e);s.includes(a)||(r.push({id:a,color:o.color||n,...o}),s.push(a))}}),r),[]).sort((r,i)=>r.id.localeCompare(i.id))},ES=({defaultColor:n,rfId:e})=>{const t=rt(N.useCallback(E7({defaultColor:n,rfId:e}),[n,e]),(s,r)=>!(s.length!==r.length||s.some((i,o)=>i.id!==r[o].id)));return X.createElement("defs",null,t.map(s=>X.createElement(S7,{id:s.id,key:s.id,type:s.type,color:s.color,width:s.width,height:s.height,markerUnits:s.markerUnits,strokeWidth:s.strokeWidth,orient:s.orient})))};ES.displayName="MarkerDefinitions";var A7=N.memo(ES);const C7=n=>({nodesConnectable:n.nodesConnectable,edgesFocusable:n.edgesFocusable,edgesUpdatable:n.edgesUpdatable,elementsSelectable:n.elementsSelectable,width:n.width,height:n.height,connectionMode:n.connectionMode,nodeInternals:n.nodeInternals,onError:n.onError}),AS=({defaultMarkerColor:n,onlyRenderVisibleElements:e,elevateEdgesOnSelect:t,rfId:s,edgeTypes:r,noPanClassName:i,onEdgeContextMenu:o,onEdgeMouseEnter:a,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:u,onEdgeDoubleClick:d,onReconnect:h,onReconnectStart:p,onReconnectEnd:m,reconnectRadius:x,children:y,disableKeyboardA11y:g})=>{const{edgesFocusable:b,edgesUpdatable:v,elementsSelectable:_,width:w,height:T,connectionMode:E,nodeInternals:S,onError:C}=rt(C7,Lt),k=_7(e,S,t);return w?X.createElement(X.Fragment,null,k.map(({level:B,edges:V,isMaxLevel:z})=>X.createElement("svg",{key:B,style:{zIndex:B},width:w,height:T,className:"react-flow__edges react-flow__container"},z&&X.createElement(A7,{defaultColor:n,rfId:s}),X.createElement("g",null,V.map(A=>{const[O,I,R]=jb(S.get(A.source)),[F,P,W]=jb(S.get(A.target));if(!R||!W)return null;let L=A.type||"default";r[L]||(C?.("011",Ls.error011(L)),L="default");const G=r[L]||r.default,Z=E===ni.Strict?P.target:(P.target??[]).concat(P.source??[]),ee=Ob(I.source,A.sourceHandle),j=Ob(Z,A.targetHandle),Q=ee?.position||fe.Bottom,te=j?.position||fe.Top,ce=!!(A.focusable||b&&typeof A.focusable>"u"),ve=A.reconnectable||A.updatable,ye=typeof h<"u"&&(ve||v&&typeof ve>"u");if(!ee||!j)return C?.("008",Ls.error008(ee,A)),null;const{sourceX:Pe,sourceY:nt,targetX:xt,targetY:lt}=x7(O,ee,Q,F,j,te);return X.createElement(G,{key:A.id,id:A.id,className:Ht([A.className,i]),type:L,data:A.data,selected:!!A.selected,animated:!!A.animated,hidden:!!A.hidden,label:A.label,labelStyle:A.labelStyle,labelShowBg:A.labelShowBg,labelBgStyle:A.labelBgStyle,labelBgPadding:A.labelBgPadding,labelBgBorderRadius:A.labelBgBorderRadius,style:A.style,source:A.source,target:A.target,sourceHandleId:A.sourceHandle,targetHandleId:A.targetHandle,markerEnd:A.markerEnd,markerStart:A.markerStart,sourceX:Pe,sourceY:nt,targetX:xt,targetY:lt,sourcePosition:Q,targetPosition:te,elementsSelectable:_,onContextMenu:o,onMouseEnter:a,onMouseMove:l,onMouseLeave:c,onClick:u,onEdgeDoubleClick:d,onReconnect:h,onReconnectStart:p,onReconnectEnd:m,reconnectRadius:x,rfId:s,ariaLabel:A.ariaLabel,isFocusable:ce,isReconnectable:ye,pathOptions:"pathOptions"in A?A.pathOptions:void 0,interactionWidth:A.interactionWidth,disableKeyboardA11y:g})})))),y):null};AS.displayName="EdgeRenderer";var R7=N.memo(AS);const M7=n=>`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`;function P7({children:n}){const e=rt(M7);return X.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:e}},n)}function k7(n){const e=hg(),t=N.useRef(!1);N.useEffect(()=>{!t.current&&e.viewportInitialized&&n&&(setTimeout(()=>n(e),1),t.current=!0)},[n,e.viewportInitialized])}const D7={[fe.Left]:fe.Right,[fe.Right]:fe.Left,[fe.Top]:fe.Bottom,[fe.Bottom]:fe.Top},CS=({nodeId:n,handleType:e,style:t,type:s=Qs.Bezier,CustomComponent:r,connectionStatus:i})=>{const{fromNode:o,handleId:a,toX:l,toY:c,connectionMode:u}=rt(N.useCallback(T=>({fromNode:T.nodeInternals.get(n),handleId:T.connectionHandleId,toX:(T.connectionPosition.x-T.transform[0])/T.transform[2],toY:(T.connectionPosition.y-T.transform[1])/T.transform[2],connectionMode:T.connectionMode}),[n]),Lt),d=o?.[at]?.handleBounds;let h=d?.[e];if(u===ni.Loose&&(h=h||d?.[e==="source"?"target":"source"]),!o||!h)return null;const p=a?h.find(T=>T.id===a):h[0],m=p?p.x+p.width/2:(o.width??0)/2,x=p?p.y+p.height/2:o.height??0,y=(o.positionAbsolute?.x??0)+m,g=(o.positionAbsolute?.y??0)+x,b=p?.position,v=b?D7[b]:null;if(!b||!v)return null;if(r)return X.createElement(r,{connectionLineType:s,connectionLineStyle:t,fromNode:o,fromHandle:p,fromX:y,fromY:g,toX:l,toY:c,fromPosition:b,toPosition:v,connectionStatus:i});let _="";const w={sourceX:y,sourceY:g,sourcePosition:b,targetX:l,targetY:c,targetPosition:v};return s===Qs.Bezier?[_]=YN(w):s===Qs.Step?[_]=pp({...w,borderRadius:0}):s===Qs.SmoothStep?[_]=pp(w):s===Qs.SimpleBezier?[_]=XN(w):_=`M${y},${g} ${l},${c}`,X.createElement("path",{d:_,fill:"none",className:"react-flow__connection-path",style:t})};CS.displayName="ConnectionLine";const I7=n=>({nodeId:n.connectionNodeId,handleType:n.connectionHandleType,nodesConnectable:n.nodesConnectable,connectionStatus:n.connectionStatus,width:n.width,height:n.height});function B7({containerStyle:n,style:e,type:t,component:s}){const{nodeId:r,handleType:i,nodesConnectable:o,width:a,height:l,connectionStatus:c}=rt(I7,Lt);return!(r&&i&&a&&o)?null:X.createElement("svg",{style:n,width:a,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},X.createElement("g",{className:Ht(["react-flow__connection",c])},X.createElement(CS,{nodeId:r,handleType:i,style:e,type:t,CustomComponent:s,connectionStatus:c})))}function Vb(n,e){return N.useRef(null),Tt(),N.useMemo(()=>e(n),[n])}const RS=({nodeTypes:n,edgeTypes:e,onMove:t,onMoveStart:s,onMoveEnd:r,onInit:i,onNodeClick:o,onEdgeClick:a,onNodeDoubleClick:l,onEdgeDoubleClick:c,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:p,onSelectionContextMenu:m,onSelectionStart:x,onSelectionEnd:y,connectionLineType:g,connectionLineStyle:b,connectionLineComponent:v,connectionLineContainerStyle:_,selectionKeyCode:w,selectionOnDrag:T,selectionMode:E,multiSelectionKeyCode:S,panActivationKeyCode:C,zoomActivationKeyCode:k,deleteKeyCode:B,onlyRenderVisibleElements:V,elementsSelectable:z,selectNodesOnDrag:A,defaultViewport:O,translateExtent:I,minZoom:R,maxZoom:F,preventScrolling:P,defaultMarkerColor:W,zoomOnScroll:L,zoomOnPinch:G,panOnScroll:Z,panOnScrollSpeed:ee,panOnScrollMode:j,zoomOnDoubleClick:Q,panOnDrag:te,onPaneClick:ce,onPaneMouseEnter:ve,onPaneMouseMove:ye,onPaneMouseLeave:Pe,onPaneScroll:nt,onPaneContextMenu:xt,onEdgeContextMenu:lt,onEdgeMouseEnter:He,onEdgeMouseMove:wt,onEdgeMouseLeave:ke,onReconnect:de,onReconnectStart:tn,onReconnectEnd:xr,reconnectRadius:So,noDragClassName:ri,noWheelClassName:ii,noPanClassName:us,elevateEdgesOnSelect:oi,disableKeyboardA11y:yr,nodeOrigin:br,nodeExtent:ai,rfId:li})=>{const Eo=Vb(n,c7),Mt=Vb(e,g7);return k7(i),X.createElement(a7,{onPaneClick:ce,onPaneMouseEnter:ve,onPaneMouseMove:ye,onPaneMouseLeave:Pe,onPaneContextMenu:xt,onPaneScroll:nt,deleteKeyCode:B,selectionKeyCode:w,selectionOnDrag:T,selectionMode:E,onSelectionStart:x,onSelectionEnd:y,multiSelectionKeyCode:S,panActivationKeyCode:C,zoomActivationKeyCode:k,elementsSelectable:z,onMove:t,onMoveStart:s,onMoveEnd:r,zoomOnScroll:L,zoomOnPinch:G,zoomOnDoubleClick:Q,panOnScroll:Z,panOnScrollSpeed:ee,panOnScrollMode:j,panOnDrag:te,defaultViewport:O,translateExtent:I,minZoom:R,maxZoom:F,onSelectionContextMenu:m,preventScrolling:P,noDragClassName:ri,noWheelClassName:ii,noPanClassName:us,disableKeyboardA11y:yr},X.createElement(P7,null,X.createElement(R7,{edgeTypes:Mt,onEdgeClick:a,onEdgeDoubleClick:c,onlyRenderVisibleElements:V,onEdgeContextMenu:lt,onEdgeMouseEnter:He,onEdgeMouseMove:wt,onEdgeMouseLeave:ke,onReconnect:de,onReconnectStart:tn,onReconnectEnd:xr,reconnectRadius:So,defaultMarkerColor:W,noPanClassName:us,elevateEdgesOnSelect:!!oi,disableKeyboardA11y:yr,rfId:li},X.createElement(B7,{style:b,type:g,component:v,containerStyle:_})),X.createElement("div",{className:"react-flow__edgelabel-renderer"}),X.createElement(h7,{nodeTypes:Eo,onNodeClick:o,onNodeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:p,selectNodesOnDrag:A,onlyRenderVisibleElements:V,noPanClassName:us,noDragClassName:ri,disableKeyboardA11y:yr,nodeOrigin:br,nodeExtent:ai,rfId:li})))};RS.displayName="GraphView";var L7=N.memo(RS);const bp=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],$s={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:bp,nodeExtent:bp,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:ni.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:d9,isValidConnection:void 0},F7=()=>F$((n,e)=>({...$s,setNodes:t=>{const{nodeInternals:s,nodeOrigin:r,elevateNodesOnSelect:i}=e();n({nodeInternals:Rh(t,s,r,i)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:t=>{const{defaultEdgeOptions:s={}}=e();n({edges:t.map(r=>({...s,...r}))})},setDefaultNodesAndEdges:(t,s)=>{const r=typeof t<"u",i=typeof s<"u",o=r?Rh(t,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;n({nodeInternals:o,edges:i?s:[],hasDefaultNodes:r,hasDefaultEdges:i})},updateNodeDimensions:t=>{const{onNodesChange:s,nodeInternals:r,fitViewOnInit:i,fitViewOnInitDone:o,fitViewOnInitOptions:a,domNode:l,nodeOrigin:c}=e(),u=l?.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:h}=new window.DOMMatrixReadOnly(d.transform),p=t.reduce((x,y)=>{const g=r.get(y.id);if(g?.hidden)r.set(g.id,{...g,[at]:{...g[at],handleBounds:void 0}});else if(g){const b=ng(y.nodeElement);!!(b.width&&b.height&&(g.width!==b.width||g.height!==b.height||y.forceUpdate))&&(r.set(g.id,{...g,[at]:{...g[at],handleBounds:{source:Ib(".source",y.nodeElement,h,c),target:Ib(".target",y.nodeElement,h,c)}},...b}),x.push({id:g.id,type:"dimensions",dimensions:b}))}return x},[]);mS(r,c);const m=o||i&&!o&&gS(e,{initial:!0,...a});n({nodeInternals:new Map(r),fitViewOnInitDone:m}),p?.length>0&&s?.(p)},updateNodePositions:(t,s=!0,r=!1)=>{const{triggerNodeChanges:i}=e(),o=t.map(a=>{const l={id:a.id,type:"position",dragging:r};return s&&(l.positionAbsolute=a.positionAbsolute,l.position=a.position),l});i(o)},triggerNodeChanges:t=>{const{onNodesChange:s,nodeInternals:r,hasDefaultNodes:i,nodeOrigin:o,getNodes:a,elevateNodesOnSelect:l}=e();if(t?.length){if(i){const c=yS(t,a()),u=Rh(c,r,o,l);n({nodeInternals:u})}s?.(t)}},addSelectedNodes:t=>{const{multiSelectionActive:s,edges:r,getNodes:i}=e();let o,a=null;s?o=t.map(l=>qs(l,!0)):(o=Pi(i(),t),a=Pi(r,[])),rc({changedNodes:o,changedEdges:a,get:e,set:n})},addSelectedEdges:t=>{const{multiSelectionActive:s,edges:r,getNodes:i}=e();let o,a=null;s?o=t.map(l=>qs(l,!0)):(o=Pi(r,t),a=Pi(i(),[])),rc({changedNodes:a,changedEdges:o,get:e,set:n})},unselectNodesAndEdges:({nodes:t,edges:s}={})=>{const{edges:r,getNodes:i}=e(),o=t||i(),a=s||r,l=o.map(u=>(u.selected=!1,qs(u.id,!1))),c=a.map(u=>qs(u.id,!1));rc({changedNodes:l,changedEdges:c,get:e,set:n})},setMinZoom:t=>{const{d3Zoom:s,maxZoom:r}=e();s?.scaleExtent([t,r]),n({minZoom:t})},setMaxZoom:t=>{const{d3Zoom:s,minZoom:r}=e();s?.scaleExtent([r,t]),n({maxZoom:t})},setTranslateExtent:t=>{e().d3Zoom?.translateExtent(t),n({translateExtent:t})},resetSelectedElements:()=>{const{edges:t,getNodes:s}=e(),i=s().filter(a=>a.selected).map(a=>qs(a.id,!1)),o=t.filter(a=>a.selected).map(a=>qs(a.id,!1));rc({changedNodes:i,changedEdges:o,get:e,set:n})},setNodeExtent:t=>{const{nodeInternals:s}=e();s.forEach(r=>{r.positionAbsolute=sg(r.position,t)}),n({nodeExtent:t,nodeInternals:new Map(s)})},panBy:t=>{const{transform:s,width:r,height:i,d3Zoom:o,d3Selection:a,translateExtent:l}=e();if(!o||!a||!t.x&&!t.y)return!1;const c=ir.translate(s[0]+t.x,s[1]+t.y).scale(s[2]),u=[[0,0],[r,i]],d=o?.constrain()(c,u,l);return o.transform(a,d),s[0]!==d.x||s[1]!==d.y||s[2]!==d.k},cancelConnection:()=>n({connectionNodeId:$s.connectionNodeId,connectionHandleId:$s.connectionHandleId,connectionHandleType:$s.connectionHandleType,connectionStatus:$s.connectionStatus,connectionStartHandle:$s.connectionStartHandle,connectionEndHandle:$s.connectionEndHandle}),reset:()=>n({...$s})}),Object.is),MS=({children:n})=>{const e=N.useRef(null);return e.current||(e.current=F7()),X.createElement(s9,{value:e.current},n)};MS.displayName="ReactFlowProvider";const PS=({children:n})=>N.useContext(od)?X.createElement(X.Fragment,null,n):X.createElement(MS,null,n);PS.displayName="ReactFlowWrapper";const O7={input:lS,default:xp,output:uS,group:dg},j7={default:mu,straight:ag,step:og,smoothstep:ad,simplebezier:ig},U7=[0,0],V7=[15,15],G7={x:0,y:0,zoom:1},$7={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},kS=N.forwardRef(({nodes:n,edges:e,defaultNodes:t,defaultEdges:s,className:r,nodeTypes:i=O7,edgeTypes:o=j7,onNodeClick:a,onEdgeClick:l,onInit:c,onMove:u,onMoveStart:d,onMoveEnd:h,onConnect:p,onConnectStart:m,onConnectEnd:x,onClickConnectStart:y,onClickConnectEnd:g,onNodeMouseEnter:b,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:w,onNodeDoubleClick:T,onNodeDragStart:E,onNodeDrag:S,onNodeDragStop:C,onNodesDelete:k,onEdgesDelete:B,onSelectionChange:V,onSelectionDragStart:z,onSelectionDrag:A,onSelectionDragStop:O,onSelectionContextMenu:I,onSelectionStart:R,onSelectionEnd:F,connectionMode:P=ni.Strict,connectionLineType:W=Qs.Bezier,connectionLineStyle:L,connectionLineComponent:G,connectionLineContainerStyle:Z,deleteKeyCode:ee="Backspace",selectionKeyCode:j="Shift",selectionOnDrag:Q=!1,selectionMode:te=za.Full,panActivationKeyCode:ce="Space",multiSelectionKeyCode:ve=fu()?"Meta":"Control",zoomActivationKeyCode:ye=fu()?"Meta":"Control",snapToGrid:Pe=!1,snapGrid:nt=V7,onlyRenderVisibleElements:xt=!1,selectNodesOnDrag:lt=!0,nodesDraggable:He,nodesConnectable:wt,nodesFocusable:ke,nodeOrigin:de=U7,edgesFocusable:tn,edgesUpdatable:xr,elementsSelectable:So,defaultViewport:ri=G7,minZoom:ii=.5,maxZoom:us=2,translateExtent:oi=bp,preventScrolling:yr=!0,nodeExtent:br,defaultMarkerColor:ai="#b1b1b7",zoomOnScroll:li=!0,zoomOnPinch:Eo=!0,panOnScroll:Mt=!1,panOnScrollSpeed:Un=.5,panOnScrollMode:vr=Vr.Free,zoomOnDoubleClick:_r=!0,panOnDrag:ci=!0,onPaneClick:Vn,onPaneMouseEnter:Tr,onPaneMouseMove:hd,onPaneMouseLeave:fd,onPaneScroll:Ao,onPaneContextMenu:pd,children:Kg,onEdgeContextMenu:wr,onEdgeDoubleClick:mE,onEdgeMouseEnter:gE,onEdgeMouseMove:xE,onEdgeMouseLeave:yE,onEdgeUpdate:bE,onEdgeUpdateStart:vE,onEdgeUpdateEnd:_E,onReconnect:TE,onReconnectStart:wE,onReconnectEnd:NE,reconnectRadius:SE=10,edgeUpdaterRadius:EE=10,onNodesChange:AE,onEdgesChange:CE,noDragClassName:RE="nodrag",noWheelClassName:ME="nowheel",noPanClassName:Xg="nopan",fitView:PE=!1,fitViewOptions:kE,connectOnClick:DE=!0,attributionPosition:IE,proOptions:BE,defaultEdgeOptions:LE,elevateNodesOnSelect:FE=!0,elevateEdgesOnSelect:OE=!1,disableKeyboardA11y:Yg=!1,autoPanOnConnect:jE=!0,autoPanOnNodeDrag:UE=!0,connectionRadius:VE=20,isValidConnection:GE,onError:$E,style:zE,id:Qg,nodeDragThreshold:HE,...WE},qE)=>{const md=Qg||"1";return X.createElement("div",{...WE,style:{...zE,...$7},ref:qE,className:Ht(["react-flow",r]),"data-testid":"rf__wrapper",id:Qg},X.createElement(PS,null,X.createElement(L7,{onInit:c,onMove:u,onMoveStart:d,onMoveEnd:h,onNodeClick:a,onEdgeClick:l,onNodeMouseEnter:b,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:w,onNodeDoubleClick:T,nodeTypes:i,edgeTypes:o,connectionLineType:W,connectionLineStyle:L,connectionLineComponent:G,connectionLineContainerStyle:Z,selectionKeyCode:j,selectionOnDrag:Q,selectionMode:te,deleteKeyCode:ee,multiSelectionKeyCode:ve,panActivationKeyCode:ce,zoomActivationKeyCode:ye,onlyRenderVisibleElements:xt,selectNodesOnDrag:lt,defaultViewport:ri,translateExtent:oi,minZoom:ii,maxZoom:us,preventScrolling:yr,zoomOnScroll:li,zoomOnPinch:Eo,zoomOnDoubleClick:_r,panOnScroll:Mt,panOnScrollSpeed:Un,panOnScrollMode:vr,panOnDrag:ci,onPaneClick:Vn,onPaneMouseEnter:Tr,onPaneMouseMove:hd,onPaneMouseLeave:fd,onPaneScroll:Ao,onPaneContextMenu:pd,onSelectionContextMenu:I,onSelectionStart:R,onSelectionEnd:F,onEdgeContextMenu:wr,onEdgeDoubleClick:mE,onEdgeMouseEnter:gE,onEdgeMouseMove:xE,onEdgeMouseLeave:yE,onReconnect:TE??bE,onReconnectStart:wE??vE,onReconnectEnd:NE??_E,reconnectRadius:SE??EE,defaultMarkerColor:ai,noDragClassName:RE,noWheelClassName:ME,noPanClassName:Xg,elevateEdgesOnSelect:OE,rfId:md,disableKeyboardA11y:Yg,nodeOrigin:de,nodeExtent:br}),X.createElement(D9,{nodes:n,edges:e,defaultNodes:t,defaultEdges:s,onConnect:p,onConnectStart:m,onConnectEnd:x,onClickConnectStart:y,onClickConnectEnd:g,nodesDraggable:He,nodesConnectable:wt,nodesFocusable:ke,edgesFocusable:tn,edgesUpdatable:xr,elementsSelectable:So,elevateNodesOnSelect:FE,minZoom:ii,maxZoom:us,nodeExtent:br,onNodesChange:AE,onEdgesChange:CE,snapToGrid:Pe,snapGrid:nt,connectionMode:P,translateExtent:oi,connectOnClick:DE,defaultEdgeOptions:LE,fitView:PE,fitViewOptions:kE,onNodesDelete:k,onEdgesDelete:B,onNodeDragStart:E,onNodeDrag:S,onNodeDragStop:C,onSelectionDrag:A,onSelectionDragStart:z,onSelectionDragStop:O,noPanClassName:Xg,nodeOrigin:de,rfId:md,autoPanOnConnect:jE,autoPanOnNodeDrag:UE,onError:$E,connectionRadius:VE,isValidConnection:GE,nodeDragThreshold:HE}),X.createElement(P9,{onSelectionChange:V}),Kg,X.createElement(i9,{proOptions:BE,position:IE}),X.createElement(O9,{rfId:md,disableKeyboardA11y:Yg})))});kS.displayName="ReactFlow";function z7(){return X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},X.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function H7(){return X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},X.createElement("path",{d:"M0 0h32v4.2H0z"}))}function W7(){return X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},X.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function q7(){return X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},X.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function K7(){return X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},X.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const oa=({children:n,className:e,...t})=>X.createElement("button",{type:"button",className:Ht(["react-flow__controls-button",e]),...t},n);oa.displayName="ControlButton";const X7=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom}),DS=({style:n,showZoom:e=!0,showFitView:t=!0,showInteractive:s=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:o,onFitView:a,onInteractiveChange:l,className:c,children:u,position:d="bottom-left"})=>{const h=Tt(),[p,m]=N.useState(!1),{isInteractive:x,minZoomReached:y,maxZoomReached:g}=rt(X7,Lt),{zoomIn:b,zoomOut:v,fitView:_}=hg();if(N.useEffect(()=>{m(!0)},[]),!p)return null;const w=()=>{b(),i?.()},T=()=>{v(),o?.()},E=()=>{_(r),a?.()},S=()=>{h.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),l?.(!x)};return X.createElement(GN,{className:Ht(["react-flow__controls",c]),position:d,style:n,"data-testid":"rf__controls"},e&&X.createElement(X.Fragment,null,X.createElement(oa,{onClick:w,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:g},X.createElement(z7,null)),X.createElement(oa,{onClick:T,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},X.createElement(H7,null))),t&&X.createElement(oa,{className:"react-flow__controls-fitview",onClick:E,title:"fit view","aria-label":"fit view"},X.createElement(W7,null)),s&&X.createElement(oa,{className:"react-flow__controls-interactive",onClick:S,title:"toggle interactivity","aria-label":"toggle interactivity"},x?X.createElement(K7,null):X.createElement(q7,null)),u)};DS.displayName="Controls";var Y7=N.memo(DS),In;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(In||(In={}));function Q7({color:n,dimensions:e,lineWidth:t}){return X.createElement("path",{stroke:n,strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function Z7({color:n,radius:e}){return X.createElement("circle",{cx:e,cy:e,r:e,fill:n})}const J7={[In.Dots]:"#91919a",[In.Lines]:"#eee",[In.Cross]:"#e2e2e2"},eH={[In.Dots]:1,[In.Lines]:1,[In.Cross]:6},tH=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function IS({id:n,variant:e=In.Dots,gap:t=20,size:s,lineWidth:r=1,offset:i=2,color:o,style:a,className:l}){const c=N.useRef(null),{transform:u,patternId:d}=rt(tH,Lt),h=o||J7[e],p=s||eH[e],m=e===In.Dots,x=e===In.Cross,y=Array.isArray(t)?t:[t,t],g=[y[0]*u[2]||1,y[1]*u[2]||1],b=p*u[2],v=x?[b,b]:g,_=m?[b/i,b/i]:[v[0]/i,v[1]/i];return X.createElement("svg",{className:Ht(["react-flow__background",l]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},X.createElement("pattern",{id:d+n,x:u[0]%g[0],y:u[1]%g[1],width:g[0],height:g[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`},m?X.createElement(Z7,{color:h,radius:b/i}):X.createElement(Q7,{dimensions:v,color:h,lineWidth:r})),X.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${d+n})`}))}IS.displayName="Background";var nH=N.memo(IS);const sH=({data:n,type:e})=>{const s={source:"var(--hud-accent)",cache:"var(--hud-success)",llm:"var(--hud-accent-secondary)",sector:"#f59e0b"}[n.type]||"var(--hud-text)";return f.jsxs("div",{className:"px-4 py-2 rounded bg-black border border-[var(--hud-border)] shadow-[0_0_15px_rgba(0,0,0,0.5)] min-w-[150px]",children:[f.jsx(co,{type:"target",position:fe.Top,className:"!bg-[var(--hud-text-dim)]"}),f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:s}}),f.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-white",children:n.label})]}),f.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:n.details}),f.jsx(co,{type:"source",position:fe.Bottom,className:"!bg-[var(--hud-text-dim)]"})]})},rH={cyber:sH};function iH(){const[n,e]=N.useState([]),[t,s]=N.useState([]),[r,i]=N.useState(!0),[o,a]=N.useState(!1),[l,c]=N.useState(1),[u,d]=N.useState({useCase:"",performance:"balanced"}),h=N.useCallback(g=>e(b=>yS(g,b)),[]),p=N.useCallback(g=>s(b=>Z9(g,b)),[]),m=N.useCallback(g=>s(b=>QN(g,b)),[]),x=()=>{const g=[{id:"1",type:"cyber",position:{x:250,y:0},data:{label:"HTTP API",type:"source",details:"Ingress"}},{id:"2",type:"cyber",position:{x:250,y:100},data:{label:"L1 Cache",type:"cache",details:"Redis (In-Memory)"}},{id:"3",type:"cyber",position:{x:250,y:200},data:{label:"Semantic Router",type:"sector",details:"Healthcare Model"}},{id:"4",type:"cyber",position:{x:250,y:300},data:{label:"GPT-4o",type:"llm",details:"Fallback"}}],b=[{id:"e1-2",source:"1",target:"2",animated:!0,style:{stroke:"var(--hud-accent)"}},{id:"e2-3",source:"2",target:"3",animated:!0,style:{stroke:"var(--hud-accent)"}},{id:"e3-4",source:"3",target:"4",animated:!0,style:{stroke:"var(--hud-accent)"}}];e(g),s(b),i(!1)},y=async()=>{try{const g=localStorage.getItem("agentcache_token");if(!g){alert("Authentication required. Please log in.");return}const b={name:`Pipeline ${new Date().toLocaleTimeString()}`,sector:u.useCase||"custom",nodes:n,connections:t,description:`Generated via Wizard (${u.performance})`,complexity:{tier:"moderate",score:n.length*10},monthlyCost:0,features:["cache","llm"]},_=await(await fetch("/api/pipelines/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(b)})).json();if(_.success)alert(`Pipeline Saved! ID: ${_.pipeline.id}`);else throw new Error(_.error||"Unknown error")}catch(g){console.error("Save failed",g),alert(`Failed to save: ${g.message}`)}};return f.jsxs("div",{className:"h-[calc(100vh-8rem)] flex gap-6 relative",children:[f.jsx("div",{className:"w-64 flex flex-col gap-4",children:f.jsx(ge,{title:"Node Palette",icon:n1,className:"flex-1",children:f.jsx("div",{className:"space-y-2",children:["Source","Cache","LLM","Sector"].map(g=>f.jsx("div",{draggable:!0,onDragStart:b=>{b.dataTransfer.setData("application/reactflow",g),b.dataTransfer.effectAllowed="move"},className:"p-3 rounded bg-[rgba(255,255,255,0.05)] border border-transparent hover:border-[var(--hud-accent)] cursor-grab active:cursor-grabbing transition-colors",children:f.jsxs("span",{className:"text-sm font-bold text-white",children:[g," Node"]})},g))})})}),f.jsxs("div",{className:"flex-1 rounded-lg border border-[var(--hud-border)] bg-black/50 overflow-hidden relative",onDragOver:g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},onDrop:g=>{g.preventDefault();const b=g.dataTransfer.getData("application/reactflow");if(!b)return;const v=g.currentTarget.getBoundingClientRect(),_={x:g.clientX-v.left-75,y:g.clientY-v.top-20},w={id:`${b}-${Date.now()}`,type:"cyber",position:_,data:{label:`${b} Node`,type:b.toLowerCase(),details:"New Node"}};e(T=>T.concat(w))},children:[f.jsxs(kS,{nodes:n,edges:t,onNodesChange:h,onEdgesChange:p,onConnect:m,nodeTypes:rH,fitView:!0,children:[f.jsx(nH,{color:"#333",gap:20}),f.jsx(Y7,{className:"!bg-black !border-[var(--hud-border)] !fill-white"})]}),f.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[f.jsxs("button",{onClick:()=>i(!0),className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs",children:[f.jsx(m3,{size:14})," Wizard"]}),f.jsxs("button",{onClick:y,className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs",children:[f.jsx(r1,{size:14})," Save"]}),f.jsxs("button",{onClick:()=>a(!0),className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs hover:border-[var(--hud-accent-secondary)] hover:text-[var(--hud-accent-secondary)]",children:[f.jsx(ha,{size:14})," Publish"]}),f.jsxs("button",{className:"btn-cyber btn-cyber-primary px-4 py-2 flex items-center gap-2 text-xs",children:[f.jsx(rm,{size:14})," Deploy"]})]})]}),r&&f.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:f.jsxs(ge,{className:"w-[600px] max-h-[80vh] overflow-y-auto relative",children:[f.jsx("button",{onClick:()=>i(!1),className:"absolute top-4 right-4 text-[var(--hud-text-dim)] hover:text-white",children:f.jsx(zc,{size:20})}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h2",{className:"text-xl font-bold text-[var(--hud-accent)] tracking-widest mb-1",children:"PIPELINE WIZARD"}),f.jsx("p",{className:"text-xs font-mono text-[var(--hud-text-dim)]",children:"CONFIGURE ORCHESTRATION PARAMETERS"})]}),l===1&&f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-sm font-bold text-white",children:"SELECT USE CASE"}),f.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{id:"clinical",label:"Clinical Decision",icon:""},{id:"trading",label:"Trading Assistant",icon:""},{id:"legal",label:"Contract Review",icon:""},{id:"custom",label:"Custom",icon:""}].map(g=>f.jsxs("button",{onClick:()=>{d({...u,useCase:g.id}),c(2)},className:"p-4 rounded border border-[var(--hud-border)] hover:border-[var(--hud-accent)] hover:bg-[var(--hud-accent)]/10 text-left transition-all",children:[f.jsx("div",{className:"text-2xl mb-2",children:g.icon}),f.jsx("div",{className:"font-bold text-sm text-white",children:g.label})]},g.id))})]}),l===2&&f.jsxs("div",{className:"space-y-6",children:[f.jsx("h3",{className:"text-sm font-bold text-white",children:"OPTIMIZATION TARGET"}),f.jsx("div",{className:"space-y-3",children:[{id:"fast",label:"Low Latency",desc:"Minimize response time"},{id:"balanced",label:"Balanced",desc:"Good speed + cost savings"},{id:"cost",label:"Cost Optimized",desc:"Maximum savings"}].map(g=>f.jsxs("button",{onClick:()=>d({...u,performance:g.id}),className:`w-full p-4 rounded border text-left transition-all ${u.performance===g.id?"border-[var(--hud-accent)] bg-[var(--hud-accent)]/10":"border-[var(--hud-border)] hover:bg-[rgba(255,255,255,0.05)]"}`,children:[f.jsx("div",{className:"font-bold text-sm text-white",children:g.label}),f.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:g.desc})]},g.id))}),f.jsxs("div",{className:"flex justify-between pt-4 border-t border-[var(--hud-border)]",children:[f.jsx("button",{onClick:()=>c(1),className:"text-xs text-[var(--hud-text-dim)] hover:text-white",children:"BACK"}),f.jsx("button",{onClick:x,className:"btn-cyber btn-cyber-primary px-6 py-2 text-sm font-bold",children:"GENERATE"})]})]})]})}),o&&f.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",children:f.jsxs(ge,{className:"w-[500px] border-l-4 border-l-[var(--hud-accent-secondary)]",children:[f.jsx("button",{onClick:()=>a(!1),className:"absolute top-4 right-4 text-[var(--hud-text-dim)] hover:text-white",children:f.jsx(zc,{size:20})}),f.jsxs("div",{className:"mb-6",children:[f.jsxs("h2",{className:"text-xl font-bold text-[var(--hud-accent-secondary)] flex items-center gap-2",children:[f.jsx(ha,{size:24})," CONTRIBUTE TO GALAXY"]}),f.jsx("p",{className:"text-xs font-mono text-[var(--hud-text-dim)]",children:"PUBLISH PATTERN TO PUBLIC KNOWLEDGE GRAPH"})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-white mb-1 block",children:"PATTERN NAME"}),f.jsx("input",{type:"text",placeholder:"e.g. Optimized RAG for Legal Docs",className:"w-full bg-black border border-[var(--hud-border)] p-2 rounded text-white text-sm focus:border-[var(--hud-accent)] outline-none"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-white mb-1 block",children:"DESCRIPTION / ABSTRACT"}),f.jsx("textarea",{rows:"3",placeholder:"Explain what problem this pattern solves...",className:"w-full bg-black border border-[var(--hud-border)] p-2 rounded text-white text-sm focus:border-[var(--hud-accent)] outline-none"})]}),f.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 p-3 rounded flex items-start gap-2",children:[f.jsx(Ma,{size:16,className:"text-yellow-500 shrink-0 mt-0.5"}),f.jsxs("div",{className:"text-xs text-yellow-200/80",children:[f.jsx("span",{className:"font-bold text-yellow-500 block mb-1",children:"GOVERNANCE CHECK REQUIRED"}),"This pattern will be submitted to the Governance Council for PII and Safety review. It will not appear in the public Galaxy until verified (approx. 24h)."]})]}),f.jsx("div",{className:"flex justify-end pt-2",children:f.jsxs("button",{onClick:()=>{a(!1),alert("Submission Received! Tracking ID: TRK-9942. Status: PENDING_REVIEW")},className:"btn-cyber btn-cyber-primary px-6 py-2 flex items-center gap-2 font-bold",children:[f.jsx(ha,{size:16})," SUBMIT PATTERN"]})})]})]})})]})}const BS=N.createContext(null),oH=({children:n})=>{const[e,t]=N.useState(null),[s,r]=N.useState(null),[i,o]=N.useState(!0);N.useEffect(()=>{const c=localStorage.getItem("agentcache_token"),u=localStorage.getItem("agentcache_user");c&&u&&(r(c),t(JSON.parse(u))),o(!1)},[]);const a=async(c,u)=>{try{const p=await fetch(u?"/api/auth/login":"/api/auth/dev-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u?{email:c,password:u}:{email:c})});if(!p.ok){const x=await p.json();throw new Error(x.error||"Login failed")}const m=await p.json();return r(m.token),t(m.user),localStorage.setItem("agentcache_token",m.token),localStorage.setItem("agentcache_user",JSON.stringify(m.user)),{success:!0}}catch(d){return console.error(d),{success:!1,error:d.message||"Login failed"}}},l=()=>{r(null),t(null),localStorage.removeItem("agentcache_token"),localStorage.removeItem("agentcache_user")};return f.jsx(BS.Provider,{value:{user:e,token:s,login:a,logout:l,loading:i},children:n})},_o=()=>N.useContext(BS);function aH({className:n}){const[e,t]=N.useState([]),[s,r]=N.useState(""),i=N.useRef(null);N.useEffect(()=>{t([{id:1,from:"Optimizer-V9",to:"Swarm-Main",type:"AGENT",content:"Identifying latency spike in Sector 7. Requesting diagnostic lock.",time:"14:20:01"},{id:2,from:"Swarm-Main",to:"Optimizer-V9",type:"SYSTEM",content:"ACK. Lock granted for 500ms.",time:"14:20:01"},{id:3,from:"Security-Sentinel",to:"BROADCAST",type:"WARN",content:"Anomaly detected in inbound query stream.",time:"14:20:03"}])},[]),N.useEffect(()=>{const a=setInterval(()=>{if(Math.random()>.4)return;const l=["Optimizer-V9","Security-Sentinel","Cache-L2","Predictor-X","Broker-DAO"],c=["Swarm-Main","BROADCAST","Storage-Node","User-Session-A"],u=[{type:"TEXT",content:"Syncing context vector..."},{type:"TEXT",content:"Requesting token budget increase."},{type:"GRAPHIC",content:"Visualizing proposed latency path:",graphicType:"CHART"},{type:"TEXT",content:"Vetoing unsafe pattern injection."},{type:"GRAPHIC",content:"Node cluster topology update:",graphicType:"NETWORK"},{type:"TEXT",content:"Optimizing route for query #9921."}],d=l[Math.floor(Math.random()*l.length)],h=c[Math.floor(Math.random()*c.length)],p=u[Math.floor(Math.random()*u.length)],m={id:Date.now(),from:d,to:h,type:d.includes("Security")?"WARN":"AGENT",graphic:p.type==="GRAPHIC"?p.graphicType:null,content:p.content,time:new Date().toLocaleTimeString("en-US",{hour12:!1})};t(x=>[...x.slice(-19),m])},2e3);return()=>clearInterval(a)},[]),N.useEffect(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[e]);const o=()=>{if(!s.trim())return;const a={id:Date.now(),from:"HUMAN_ADMIN",to:"BROADCAST",type:"HUMAN",content:s.toUpperCase(),time:new Date().toLocaleTimeString("en-US",{hour12:!1})};t(l=>[...l,a]),r(""),setTimeout(()=>{const l={id:Date.now()+1,from:"Swarm-Main",to:"HUMAN_ADMIN",type:"SYSTEM",content:"Command received. Propagating override.",time:new Date().toLocaleTimeString("en-US",{hour12:!1})};t(c=>[...c,l])},800)};return f.jsxs(ge,{title:"Inter-Agent Comms Channel",icon:Ra,className:`flex flex-col h-full ${n}`,children:[f.jsx("div",{ref:i,className:"flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar min-h-[300px]",children:e.map(a=>f.jsxs("div",{className:`flex flex-col text-xs font-mono p-2 rounded border-l-2 ${a.type==="HUMAN"?"bg-purple-500/10 border-purple-500 ml-8":a.type==="WARN"?"bg-red-500/10 border-red-500":a.type==="SYSTEM"?"bg-white/5 border-white/20":"bg-cyan-500/5 border-cyan-500/50"}`,children:[f.jsxs("div",{className:"flex justify-between items-center mb-1 opacity-70",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[a.type==="HUMAN"?f.jsx(ku,{size:10}):f.jsx(jC,{size:10}),f.jsx("span",{className:"font-bold",children:a.from}),f.jsx("span",{className:"text-[10px]",children:""}),f.jsx("span",{children:a.to})]}),f.jsx("span",{className:"text-[10px]",children:a.time})]}),f.jsxs("div",{className:`text-sm ${a.type==="HUMAN"?"font-bold text-purple-200":a.type==="WARN"?"text-red-300":"text-slate-300"}`,children:[a.content,a.graphic==="CHART"&&f.jsx("div",{className:"mt-2 p-2 bg-black/40 border border-white/10 rounded h-16 flex items-end gap-1 w-fit",children:[40,65,33,80,50,90,45].map((l,c)=>f.jsx("div",{className:"w-2 bg-[var(--hud-accent)] opacity-80",style:{height:`${l}%`}},c))}),a.graphic==="NETWORK"&&f.jsxs("div",{className:"mt-2 p-2 bg-black/40 border border-white/10 rounded h-16 w-32 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-2 left-2 w-2 h-2 rounded-full bg-purple-500 animate-pulse"}),f.jsx("div",{className:"absolute bottom-4 right-8 w-2 h-2 rounded-full bg-cyan-500"}),f.jsx("div",{className:"absolute top-6 right-4 w-2 h-2 rounded-full bg-emerald-500"}),f.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none opacity-40",children:[f.jsx("line",{x1:"10",y1:"10",x2:"80",y2:"40",stroke:"white",strokeWidth:"1"}),f.jsx("line",{x1:"80",y1:"40",x2:"100",y2:"20",stroke:"white",strokeWidth:"1"})]})]})]})]},a.id))}),f.jsxs("div",{className:"mt-4 flex gap-2",children:[f.jsxs("div",{className:"relative flex-1",children:[f.jsx("input",{className:"w-full bg-black/40 border border-white/10 rounded p-3 pl-4 pr-10 text-sm font-mono text-white outline-none focus:border-purple-500/50 transition-colors",placeholder:"Broadcast command (e.g., 'HALT', 'PRIORITY 1')...",value:s,onChange:a=>r(a.target.value),onKeyDown:a=>a.key==="Enter"&&o()}),f.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-purple-500 pointer-events-none",children:"ADMIN"})]}),f.jsx("button",{onClick:o,className:"p-3 bg-purple-500/20 text-purple-400 border border-purple-500/30 rounded hover:bg-purple-500/30 transition-colors",children:f.jsx(BR,{size:18})})]})]})}function Gb(){const{token:n}=_o(),[e,t]=N.useState([]),[s,r]=N.useState([]),[i,o]=N.useState(null),[a,l]=N.useState("insights");return N.useEffect(()=>{if(!n)return;const c=async()=>{try{const m=await(await fetch("/api/admin-stats",{headers:{Authorization:"Bearer "+n}})).json();if(m&&m.top_users){const x=m.top_users.map((y,g)=>({rank:g+1,name:y.email.split("@")[0]||"Unknown Agent",score:y.requests,sector:"General"}));t(x)}else t([{rank:1,name:"System-Prime",score:1e3,sector:"Core"}])}catch(p){console.error("Failed to fetch leaderboard:",p)}};c();const u=setInterval(c,6e4),d=new EventSource("/api/events/stream");d.onmessage=p=>{try{const m=JSON.parse(p.data);if(m.type==="sys:connected")return;if(m.type==="CACHE_HIT"||m.type==="OPTIMIZATION"||Math.random()>.6){const x=["Detected semantic drift in Finance sector.","Auto-optimizing latency for EU region.","Identified new efficient routing path.","Pruning 400 stale nodes to save memory.","Crystallizing heavily used 'Legal-V2' pattern.","Rejected hallucination attempt in Triage-Bot."],y={id:Date.now(),agent:m.agentId||"Agent - "+(Math.floor(Math.random()*900)+100),pattern:m.pattern||x[Math.floor(Math.random()*x.length)],improvement:m.improvement||Math.floor(Math.random()*20)+5,time:new Date().toLocaleTimeString()};r(g=>[y,...g].slice(0,8))}}catch(m){console.warn("Stream parse error:",m)}},o({status:"Running Experiment #8492",progress:45,target:"Global Latency Optimization"});const h=setInterval(()=>{o(p=>({...p,progress:p.progress>=100?0:p.progress+1}))},1e3);return()=>{clearInterval(u),clearInterval(h),d.close()}},[]),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-8rem)]",children:[f.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[f.jsxs("div",{className:"flex bg-black/40 rounded p-1 border border-white/5 w-fit",children:[f.jsxs("button",{onClick:()=>l("insights"),className:`px-3 py-1 rounded text-[10px] font-bold font-mono transition-all flex items-center gap-1 ${a==="insights"?"bg-cyan-500/20 text-cyan-400":"text-white/40 hover:text-white"}`,children:[f.jsx(Ra,{size:12})," INSIGHTS"]}),f.jsxs("button",{onClick:()=>l("comms"),className:`px-3 py-1 rounded text-[10px] font-bold font-mono transition-all flex items-center gap-1 ${a==="comms"?"bg-purple-500/20 text-purple-400":"text-white/40 hover:text-white"}`,children:[f.jsx(SR,{size:12})," COMMS"]})]}),a==="insights"?f.jsx(ge,{title:"Swarm Insights",icon:Ra,className:"flex-1 flex flex-col min-h-0",children:f.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-3 custom-scrollbar",children:[s.map(c=>f.jsxs("div",{className:"p-3 rounded bg-[rgba(255,255,255,0.03)] border-l-2 border-[var(--hud-accent)] animate-in slide-in-from-left duration-300",children:[f.jsxs("div",{className:"flex justify-between items-start mb-1",children:[f.jsx("span",{className:"text-sm font-bold text-white",children:c.agent}),f.jsx("span",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:c.time})]}),f.jsxs("div",{className:"text-xs text-[var(--hud-text-dim)] mb-2",children:["Insight: ",f.jsxs("span",{className:"text-white italic",children:['"',c.pattern,'"']})]}),f.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono text-[var(--hud-success)]",children:[f.jsx(ar,{size:12}),f.jsxs("span",{children:["Outcome: +",c.improvement,"% Efficiency"]})]})]},c.id)),s.length===0&&f.jsx("div",{className:"text-center text-[var(--hud-text-dim)] py-8 italic",children:"Listening for swarm signals..."})]})}):f.jsx(aH,{className:"flex-1 min-h-0"})]}),f.jsx("div",{className:"lg:col-span-1 flex flex-col gap-6 relative",children:f.jsxs(ge,{className:"flex-1 relative overflow-hidden p-0 border-[var(--hud-accent)] shadow-[0_0_30px_rgba(0,243,255,0.1)]",children:[f.jsx(kN,{}),f.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-[rgba(0,0,0,0.8)] backdrop-blur p-4 border-t border-[var(--hud-border)] pointer-events-none",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("span",{className:"text-xs font-bold text-[var(--hud-text-dim)]",children:"ACTIVE EXPERIMENT"}),f.jsx("span",{className:"text-xs font-mono text-[var(--hud-accent)] animate-pulse",children:"RUNNING"})]}),f.jsx("div",{className:"text-sm font-medium text-white mb-3",children:i?.target}),f.jsx("div",{className:"h-1 bg-[rgba(255,255,255,0.1)] rounded-full overflow-hidden",children:f.jsx("div",{className:"h-full bg-[var(--hud-accent)] transition-all duration-300",style:{width:`${i?.progress}%`}})})]})]})}),f.jsx("div",{className:"space-y-6",children:f.jsx(ge,{title:"Top Agents",icon:o1,className:"h-full",children:f.jsx(Yi,{columns:[{header:"Rank",accessor:"rank",render:c=>f.jsxs("span",{className:"font-mono text-[var(--hud-accent)]",children:["#",c.rank]})},{header:"Agent Name",accessor:"name",render:c=>f.jsx("span",{className:"font-bold text-white",children:c.name})},{header:"Score",accessor:"score",render:c=>f.jsx("span",{className:"font-mono text-[var(--hud-warning)]",children:c.score})}],data:e})})})]})}const pg=N.createContext({});function mg(n){const e=N.useRef(null);return e.current===null&&(e.current=n()),e.current}const gg=typeof window<"u",LS=gg?N.useLayoutEffect:N.useEffect,ld=N.createContext(null);function xg(n,e){n.indexOf(e)===-1&&n.push(e)}function yg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const Fs=(n,e,t)=>t>e?e:t<n?n:t;let bg=()=>{};const Os={},FS=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function OS(n){return typeof n=="object"&&n!==null}const jS=n=>/^0[^.\s]+$/u.test(n);function vg(n){let e;return()=>(e===void 0&&(e=n()),e)}const yn=n=>n,lH=(n,e)=>t=>e(n(t)),dl=(...n)=>n.reduce(lH),Wa=(n,e,t)=>{const s=e-n;return s===0?1:(t-n)/s};class _g{constructor(){this.subscriptions=[]}add(e){return xg(this.subscriptions,e),()=>yg(this.subscriptions,e)}notify(e,t,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,s);else for(let i=0;i<r;i++){const o=this.subscriptions[i];o&&o(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ts=n=>n*1e3,gn=n=>n/1e3;function US(n,e){return e?n*(1e3/e):0}const VS=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,cH=1e-7,uH=12;function dH(n,e,t,s,r){let i,o,a=0;do o=e+(t-e)/2,i=VS(o,s,r)-n,i>0?t=o:e=o;while(Math.abs(i)>cH&&++a<uH);return o}function hl(n,e,t,s){if(n===e&&t===s)return yn;const r=i=>dH(i,0,1,n,t);return i=>i===0||i===1?i:VS(r(i),e,s)}const GS=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,$S=n=>e=>1-n(1-e),zS=hl(.33,1.53,.69,.99),Tg=$S(zS),HS=GS(Tg),WS=n=>(n*=2)<1?.5*Tg(n):.5*(2-Math.pow(2,-10*(n-1))),wg=n=>1-Math.sin(Math.acos(n)),qS=$S(wg),KS=GS(wg),hH=hl(.42,0,1,1),fH=hl(0,0,.58,1),XS=hl(.42,0,.58,1),pH=n=>Array.isArray(n)&&typeof n[0]!="number",YS=n=>Array.isArray(n)&&typeof n[0]=="number",mH={linear:yn,easeIn:hH,easeInOut:XS,easeOut:fH,circIn:wg,circInOut:KS,circOut:qS,backIn:Tg,backInOut:HS,backOut:zS,anticipate:WS},gH=n=>typeof n=="string",$b=n=>{if(YS(n)){bg(n.length===4);const[e,t,s,r]=n;return hl(e,t,s,r)}else if(gH(n))return mH[n];return n},oc=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function xH(n,e){let t=new Set,s=new Set,r=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(u){o.has(u)&&(c.schedule(u),n()),u(a)}const c={schedule:(u,d=!1,h=!1)=>{const m=h&&r?t:s;return d&&o.add(u),m.has(u)||m.add(u),u},cancel:u=>{s.delete(u),o.delete(u)},process:u=>{if(a=u,r){i=!0;return}r=!0,[t,s]=[s,t],t.forEach(l),t.clear(),r=!1,i&&(i=!1,c.process(u))}};return c}const yH=40;function QS(n,e){let t=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=()=>t=!0,o=oc.reduce((v,_)=>(v[_]=xH(i),v),{}),{setup:a,read:l,resolveKeyframes:c,preUpdate:u,update:d,preRender:h,render:p,postRender:m}=o,x=()=>{const v=Os.useManualTiming?r.timestamp:performance.now();t=!1,Os.useManualTiming||(r.delta=s?1e3/60:Math.max(Math.min(v-r.timestamp,yH),1)),r.timestamp=v,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),u.process(r),d.process(r),h.process(r),p.process(r),m.process(r),r.isProcessing=!1,t&&e&&(s=!1,n(x))},y=()=>{t=!0,s=!0,r.isProcessing||n(x)};return{schedule:oc.reduce((v,_)=>{const w=o[_];return v[_]=(T,E=!1,S=!1)=>(t||y(),w.schedule(T,E,S)),v},{}),cancel:v=>{for(let _=0;_<oc.length;_++)o[oc[_]].cancel(v)},state:r,steps:o}}const{schedule:Je,cancel:cr,state:Et,steps:Dh}=QS(typeof requestAnimationFrame<"u"?requestAnimationFrame:yn,!0);let Cc;function bH(){Cc=void 0}const Yt={now:()=>(Cc===void 0&&Yt.set(Et.isProcessing||Os.useManualTiming?Et.timestamp:performance.now()),Cc),set:n=>{Cc=n,queueMicrotask(bH)}},ZS=n=>e=>typeof e=="string"&&e.startsWith(n),Ng=ZS("--"),vH=ZS("var(--"),Sg=n=>vH(n)?_H.test(n.split("/*")[0].trim()):!1,_H=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,To={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},qa={...To,transform:n=>Fs(0,1,n)},ac={...To,default:1},Ta=n=>Math.round(n*1e5)/1e5,Eg=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function TH(n){return n==null}const wH=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ag=(n,e)=>t=>!!(typeof t=="string"&&wH.test(t)&&t.startsWith(n)||e&&!TH(t)&&Object.prototype.hasOwnProperty.call(t,e)),JS=(n,e,t)=>s=>{if(typeof s!="string")return s;const[r,i,o,a]=s.match(Eg);return{[n]:parseFloat(r),[e]:parseFloat(i),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},NH=n=>Fs(0,255,n),Ih={...To,transform:n=>Math.round(NH(n))},Gr={test:Ag("rgb","red"),parse:JS("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:s=1})=>"rgba("+Ih.transform(n)+", "+Ih.transform(e)+", "+Ih.transform(t)+", "+Ta(qa.transform(s))+")"};function SH(n){let e="",t="",s="",r="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),s=n.substring(5,7),r=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),s=n.substring(3,4),r=n.substring(4,5),e+=e,t+=t,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const vp={test:Ag("#"),parse:SH,transform:Gr.transform},fl=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),zs=fl("deg"),ns=fl("%"),be=fl("px"),EH=fl("vh"),AH=fl("vw"),zb={...ns,parse:n=>ns.parse(n)/100,transform:n=>ns.transform(n*100)},ki={test:Ag("hsl","hue"),parse:JS("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(n)+", "+ns.transform(Ta(e))+", "+ns.transform(Ta(t))+", "+Ta(qa.transform(s))+")"},dt={test:n=>Gr.test(n)||vp.test(n)||ki.test(n),parse:n=>Gr.test(n)?Gr.parse(n):ki.test(n)?ki.parse(n):vp.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Gr.transform(n):ki.transform(n),getAnimatableNone:n=>{const e=dt.parse(n);return e.alpha=0,dt.transform(e)}},CH=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function RH(n){return isNaN(n)&&typeof n=="string"&&(n.match(Eg)?.length||0)+(n.match(CH)?.length||0)>0}const e2="number",t2="color",MH="var",PH="var(",Hb="${}",kH=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ka(n){const e=n.toString(),t=[],s={color:[],number:[],var:[]},r=[];let i=0;const a=e.replace(kH,l=>(dt.test(l)?(s.color.push(i),r.push(t2),t.push(dt.parse(l))):l.startsWith(PH)?(s.var.push(i),r.push(MH),t.push(l)):(s.number.push(i),r.push(e2),t.push(parseFloat(l))),++i,Hb)).split(Hb);return{values:t,split:a,indexes:s,types:r}}function n2(n){return Ka(n).values}function s2(n){const{split:e,types:t}=Ka(n),s=e.length;return r=>{let i="";for(let o=0;o<s;o++)if(i+=e[o],r[o]!==void 0){const a=t[o];a===e2?i+=Ta(r[o]):a===t2?i+=dt.transform(r[o]):i+=r[o]}return i}}const DH=n=>typeof n=="number"?0:dt.test(n)?dt.getAnimatableNone(n):n;function IH(n){const e=n2(n);return s2(n)(e.map(DH))}const ur={test:RH,parse:n2,createTransformer:s2,getAnimatableNone:IH};function Bh(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function BH({hue:n,saturation:e,lightness:t,alpha:s}){n/=360,e/=100,t/=100;let r=0,i=0,o=0;if(!e)r=i=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;r=Bh(l,a,n+1/3),i=Bh(l,a,n),o=Bh(l,a,n-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}function gu(n,e){return t=>t>0?e:n}const st=(n,e,t)=>n+(e-n)*t,Lh=(n,e,t)=>{const s=n*n,r=t*(e*e-s)+s;return r<0?0:Math.sqrt(r)},LH=[vp,Gr,ki],FH=n=>LH.find(e=>e.test(n));function Wb(n){const e=FH(n);if(!e)return!1;let t=e.parse(n);return e===ki&&(t=BH(t)),t}const qb=(n,e)=>{const t=Wb(n),s=Wb(e);if(!t||!s)return gu(n,e);const r={...t};return i=>(r.red=Lh(t.red,s.red,i),r.green=Lh(t.green,s.green,i),r.blue=Lh(t.blue,s.blue,i),r.alpha=st(t.alpha,s.alpha,i),Gr.transform(r))},_p=new Set(["none","hidden"]);function OH(n,e){return _p.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function jH(n,e){return t=>st(n,e,t)}function Cg(n){return typeof n=="number"?jH:typeof n=="string"?Sg(n)?gu:dt.test(n)?qb:GH:Array.isArray(n)?r2:typeof n=="object"?dt.test(n)?qb:UH:gu}function r2(n,e){const t=[...n],s=t.length,r=n.map((i,o)=>Cg(i)(i,e[o]));return i=>{for(let o=0;o<s;o++)t[o]=r[o](i);return t}}function UH(n,e){const t={...n,...e},s={};for(const r in t)n[r]!==void 0&&e[r]!==void 0&&(s[r]=Cg(n[r])(n[r],e[r]));return r=>{for(const i in s)t[i]=s[i](r);return t}}function VH(n,e){const t=[],s={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const i=e.types[r],o=n.indexes[i][s[i]],a=n.values[o]??0;t[r]=a,s[i]++}return t}const GH=(n,e)=>{const t=ur.createTransformer(e),s=Ka(n),r=Ka(e);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?_p.has(n)&&!r.values.length||_p.has(e)&&!s.values.length?OH(n,e):dl(r2(VH(s,r),r.values),t):gu(n,e)};function i2(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?st(n,e,t):Cg(n)(n,e)}const $H=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>Je.update(e,t),stop:()=>cr(e),now:()=>Et.isProcessing?Et.timestamp:Yt.now()}},o2=(n,e,t=10)=>{let s="";const r=Math.max(Math.round(e/t),2);for(let i=0;i<r;i++)s+=Math.round(n(i/(r-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},xu=2e4;function Rg(n){let e=0;const t=50;let s=n.next(e);for(;!s.done&&e<xu;)e+=t,s=n.next(e);return e>=xu?1/0:e}function zH(n,e=100,t){const s=t({...n,keyframes:[0,e]}),r=Math.min(Rg(s),xu);return{type:"keyframes",ease:i=>s.next(r*i).value/e,duration:gn(r)}}const HH=5;function a2(n,e,t){const s=Math.max(e-HH,0);return US(t-n(s),e-s)}const ot={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Fh=.001;function WH({duration:n=ot.duration,bounce:e=ot.bounce,velocity:t=ot.velocity,mass:s=ot.mass}){let r,i,o=1-e;o=Fs(ot.minDamping,ot.maxDamping,o),n=Fs(ot.minDuration,ot.maxDuration,gn(n)),o<1?(r=c=>{const u=c*o,d=u*n,h=u-t,p=Tp(c,o),m=Math.exp(-d);return Fh-h/p*m},i=c=>{const d=c*o*n,h=d*t+t,p=Math.pow(o,2)*Math.pow(c,2)*n,m=Math.exp(-d),x=Tp(Math.pow(c,2),o);return(-r(c)+Fh>0?-1:1)*((h-p)*m)/x}):(r=c=>{const u=Math.exp(-c*n),d=(c-t)*n+1;return-Fh+u*d},i=c=>{const u=Math.exp(-c*n),d=(t-c)*(n*n);return u*d});const a=5/n,l=KH(r,i,a);if(n=ts(n),isNaN(l))return{stiffness:ot.stiffness,damping:ot.damping,duration:n};{const c=Math.pow(l,2)*s;return{stiffness:c,damping:o*2*Math.sqrt(s*c),duration:n}}}const qH=12;function KH(n,e,t){let s=t;for(let r=1;r<qH;r++)s=s-n(s)/e(s);return s}function Tp(n,e){return n*Math.sqrt(1-e*e)}const XH=["duration","bounce"],YH=["stiffness","damping","mass"];function Kb(n,e){return e.some(t=>n[t]!==void 0)}function QH(n){let e={velocity:ot.velocity,stiffness:ot.stiffness,damping:ot.damping,mass:ot.mass,isResolvedFromDuration:!1,...n};if(!Kb(n,YH)&&Kb(n,XH))if(n.visualDuration){const t=n.visualDuration,s=2*Math.PI/(t*1.2),r=s*s,i=2*Fs(.05,1,1-(n.bounce||0))*Math.sqrt(r);e={...e,mass:ot.mass,stiffness:r,damping:i}}else{const t=WH(n);e={...e,...t,mass:ot.mass},e.isResolvedFromDuration=!0}return e}function yu(n=ot.visualDuration,e=ot.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:s,restDelta:r}=t;const i=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:u,duration:d,velocity:h,isResolvedFromDuration:p}=QH({...t,velocity:-gn(t.velocity||0)}),m=h||0,x=c/(2*Math.sqrt(l*u)),y=o-i,g=gn(Math.sqrt(l/u)),b=Math.abs(y)<5;s||(s=b?ot.restSpeed.granular:ot.restSpeed.default),r||(r=b?ot.restDelta.granular:ot.restDelta.default);let v;if(x<1){const w=Tp(g,x);v=T=>{const E=Math.exp(-x*g*T);return o-E*((m+x*g*y)/w*Math.sin(w*T)+y*Math.cos(w*T))}}else if(x===1)v=w=>o-Math.exp(-g*w)*(y+(m+g*y)*w);else{const w=g*Math.sqrt(x*x-1);v=T=>{const E=Math.exp(-x*g*T),S=Math.min(w*T,300);return o-E*((m+x*g*y)*Math.sinh(S)+w*y*Math.cosh(S))/w}}const _={calculatedDuration:p&&d||null,next:w=>{const T=v(w);if(p)a.done=w>=d;else{let E=w===0?m:0;x<1&&(E=w===0?ts(m):a2(v,w,T));const S=Math.abs(E)<=s,C=Math.abs(o-T)<=r;a.done=S&&C}return a.value=a.done?o:T,a},toString:()=>{const w=Math.min(Rg(_),xu),T=o2(E=>_.next(w*E).value,w,30);return w+"ms "+T},toTransition:()=>{}};return _}yu.applyToOptions=n=>{const e=zH(n,100,yu);return n.ease=e.ease,n.duration=ts(e.duration),n.type="keyframes",n};function wp({keyframes:n,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const d=n[0],h={done:!1,value:d},p=S=>a!==void 0&&S<a||l!==void 0&&S>l,m=S=>a===void 0?l:l===void 0||Math.abs(a-S)<Math.abs(l-S)?a:l;let x=t*e;const y=d+x,g=o===void 0?y:o(y);g!==y&&(x=g-d);const b=S=>-x*Math.exp(-S/s),v=S=>g+b(S),_=S=>{const C=b(S),k=v(S);h.done=Math.abs(C)<=c,h.value=h.done?g:k};let w,T;const E=S=>{p(h.value)&&(w=S,T=yu({keyframes:[h.value,m(h.value)],velocity:a2(v,S,h.value),damping:r,stiffness:i,restDelta:c,restSpeed:u}))};return E(0),{calculatedDuration:null,next:S=>{let C=!1;return!T&&w===void 0&&(C=!0,_(S),E(S)),w!==void 0&&S>=w?T.next(S-w):(!C&&_(S),h)}}}function ZH(n,e,t){const s=[],r=t||Os.mix||i2,i=n.length-1;for(let o=0;o<i;o++){let a=r(n[o],n[o+1]);if(e){const l=Array.isArray(e)?e[o]||yn:e;a=dl(l,a)}s.push(a)}return s}function JH(n,e,{clamp:t=!0,ease:s,mixer:r}={}){const i=n.length;if(bg(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[i-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=ZH(e,s,r),l=a.length,c=u=>{if(o&&u<n[0])return e[0];let d=0;if(l>1)for(;d<n.length-2&&!(u<n[d+1]);d++);const h=Wa(n[d],n[d+1],u);return a[d](h)};return t?u=>c(Fs(n[0],n[i-1],u)):c}function eW(n,e){const t=n[n.length-1];for(let s=1;s<=e;s++){const r=Wa(0,e,s);n.push(st(t,1,r))}}function tW(n){const e=[0];return eW(e,n.length-1),e}function nW(n,e){return n.map(t=>t*e)}function sW(n,e){return n.map(()=>e||XS).splice(0,n.length-1)}function wa({duration:n=300,keyframes:e,times:t,ease:s="easeInOut"}){const r=pH(s)?s.map($b):$b(s),i={done:!1,value:e[0]},o=nW(t&&t.length===e.length?t:tW(e),n),a=JH(o,e,{ease:Array.isArray(r)?r:sW(e,r)});return{calculatedDuration:n,next:l=>(i.value=a(l),i.done=l>=n,i)}}const rW=n=>n!==null;function Mg(n,{repeat:e,repeatType:t="loop"},s,r=1){const i=n.filter(rW),a=r<0||e&&t!=="loop"&&e%2===1?0:i.length-1;return!a||s===void 0?i[a]:s}const iW={decay:wp,inertia:wp,tween:wa,keyframes:wa,spring:yu};function l2(n){typeof n.type=="string"&&(n.type=iW[n.type])}class Pg{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const oW=n=>n/100;class kg extends Pg{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==Yt.now()&&this.tick(Yt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;l2(e);const{type:t=wa,repeat:s=0,repeatDelay:r=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=t||wa;l!==wa&&typeof a[0]!="number"&&(this.mixKeyframes=dl(oW,i2(a[0],a[1])),a=[0,100]);const c=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),c.calculatedDuration===null&&(c.calculatedDuration=Rg(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(s+1)-r,this.generator=c}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:r,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return s.next(0);const{delay:c=0,keyframes:u,repeat:d,repeatType:h,repeatDelay:p,type:m,onUpdate:x,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-c*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?g<0:g>r;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let v=this.currentTime,_=s;if(d){const S=Math.min(this.currentTime,r)/a;let C=Math.floor(S),k=S%1;!k&&S>=1&&(k=1),k===1&&C--,C=Math.min(C,d+1),!!(C%2)&&(h==="reverse"?(k=1-k,p&&(k-=p/a)):h==="mirror"&&(_=o)),v=Fs(0,1,k)*a}const w=b?{done:!1,value:u[0]}:_.next(v);i&&(w.value=i(w.value));let{done:T}=w;!b&&l!==null&&(T=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const E=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return E&&m!==wp&&(w.value=Mg(u,this.options,y,this.speed)),x&&x(w.value),E&&this.finish(),w}then(e,t){return this.finished.then(e,t)}get duration(){return gn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+gn(e)}get time(){return gn(this.currentTime)}set time(e){e=ts(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Yt.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=gn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=$H,startTime:t}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Yt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function aW(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const $r=n=>n*180/Math.PI,Np=n=>{const e=$r(Math.atan2(n[1],n[0]));return Sp(e)},lW={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:Np,rotateZ:Np,skewX:n=>$r(Math.atan(n[1])),skewY:n=>$r(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},Sp=n=>(n=n%360,n<0&&(n+=360),n),Xb=Np,Yb=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),Qb=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),cW={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Yb,scaleY:Qb,scale:n=>(Yb(n)+Qb(n))/2,rotateX:n=>Sp($r(Math.atan2(n[6],n[5]))),rotateY:n=>Sp($r(Math.atan2(-n[2],n[0]))),rotateZ:Xb,rotate:Xb,skewX:n=>$r(Math.atan(n[4])),skewY:n=>$r(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function Ep(n){return n.includes("scale")?1:0}function Ap(n,e){if(!n||n==="none")return Ep(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,r;if(t)s=cW,r=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=lW,r=a}if(!r)return Ep(e);const i=s[e],o=r[1].split(",").map(dW);return typeof i=="function"?i(o):o[i]}const uW=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return Ap(t,e)};function dW(n){return parseFloat(n.trim())}const wo=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],No=new Set(wo),Zb=n=>n===To||n===be,hW=new Set(["x","y","z"]),fW=wo.filter(n=>!hW.has(n));function pW(n){const e=[];return fW.forEach(t=>{const s=n.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const Qr={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>Ap(e,"x"),y:(n,{transform:e})=>Ap(e,"y")};Qr.translateX=Qr.x;Qr.translateY=Qr.y;const Zr=new Set;let Cp=!1,Rp=!1,Mp=!1;function c2(){if(Rp){const n=Array.from(Zr).filter(s=>s.needsMeasurement),e=new Set(n.map(s=>s.element)),t=new Map;e.forEach(s=>{const r=pW(s);r.length&&(t.set(s,r),s.render())}),n.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const r=t.get(s);r&&r.forEach(([i,o])=>{s.getValue(i)?.set(o)})}),n.forEach(s=>s.measureEndState()),n.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}Rp=!1,Cp=!1,Zr.forEach(n=>n.complete(Mp)),Zr.clear()}function u2(){Zr.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(Rp=!0)})}function mW(){Mp=!0,u2(),c2(),Mp=!1}class Dg{constructor(e,t,s,r,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=r,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Zr.add(this),Cp||(Cp=!0,Je.read(u2),Je.resolveKeyframes(c2))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:r}=this;if(e[0]===null){const i=r?.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(s&&t){const a=s.readValue(t,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),r&&i===void 0&&r.set(e[0])}aW(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Zr.delete(this)}cancel(){this.state==="scheduled"&&(Zr.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const gW=n=>n.startsWith("--");function xW(n,e,t){gW(e)?n.style.setProperty(e,t):n.style[e]=t}const yW=vg(()=>window.ScrollTimeline!==void 0),bW={};function vW(n,e){const t=vg(n);return()=>bW[e]??t()}const d2=vW(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),aa=([n,e,t,s])=>`cubic-bezier(${n}, ${e}, ${t}, ${s})`,Jb={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:aa([0,.65,.55,1]),circOut:aa([.55,0,1,.45]),backIn:aa([.31,.01,.66,-.59]),backOut:aa([.33,1.53,.69,.99])};function h2(n,e){if(n)return typeof n=="function"?d2()?o2(n,e):"ease-out":YS(n)?aa(n):Array.isArray(n)?n.map(t=>h2(t,e)||Jb.easeOut):Jb[n]}function _W(n,e,t,{delay:s=0,duration:r=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},c=void 0){const u={[e]:t};l&&(u.offset=l);const d=h2(a,r);Array.isArray(d)&&(u.easing=d);const h={delay:s,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return c&&(h.pseudoElement=c),n.animate(u,h)}function f2(n){return typeof n=="function"&&"applyToOptions"in n}function TW({type:n,...e}){return f2(n)&&d2()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class wW extends Pg{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:r,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,bg(typeof e.type!="string");const c=TW(e);this.animation=_W(t,s,r,c,i),c.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const u=Mg(r,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(u):xW(t,s,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return gn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+gn(e)}get time(){return gn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=ts(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&yW()?(this.animation.timeline=e,yn):t(this)}}const p2={anticipate:WS,backInOut:HS,circInOut:KS};function NW(n){return n in p2}function SW(n){typeof n.ease=="string"&&NW(n.ease)&&(n.ease=p2[n.ease])}const ev=10;class EW extends wW{constructor(e){SW(e),l2(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:r,element:i,...o}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new kg({...o,autoplay:!1}),l=ts(this.finishedTime??this.time);t.setWithVelocity(a.sample(l-ev).value,a.sample(l).value,ev),a.stop()}}const tv=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(ur.test(n)||n==="0")&&!n.startsWith("url("));function AW(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function CW(n,e,t,s){const r=n[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const i=n[n.length-1],o=tv(r,e),a=tv(i,e);return!o||!a?!1:AW(n)||(t==="spring"||f2(t))&&s}function Pp(n){n.duration=0,n.type="keyframes"}const RW=new Set(["opacity","clipPath","filter","transform"]),MW=vg(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function PW(n){const{motionValue:e,name:t,repeatDelay:s,repeatType:r,damping:i,type:o}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=e.owner.getProps();return MW()&&t&&RW.has(t)&&(t!=="transform"||!c)&&!l&&!s&&r!=="mirror"&&i!==0&&o!=="inertia"}const kW=40;class DW extends Pg{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:c,element:u,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Yt.now();const h={autoplay:e,delay:t,type:s,repeat:r,repeatDelay:i,repeatType:o,name:l,motionValue:c,element:u,...d},p=u?.KeyframeResolver||Dg;this.keyframeResolver=new p(a,(m,x,y)=>this.onKeyframesResolved(m,x,h,!y),l,c,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,r){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:c,onUpdate:u}=s;this.resolvedAt=Yt.now(),CW(e,i,o,a)||((Os.instantAnimations||!l)&&u?.(Mg(e,s,t)),e[0]=e[e.length-1],Pp(s),s.repeat=0);const h={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>kW?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},p=!c&&PW(h)?new EW({...h,element:h.motionValue.owner.current}):new kg(h);p.finished.then(()=>this.notifyFinished()).catch(yn),this.pendingTimeline&&(this.stopTimeline=p.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=p}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),mW()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const IW=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function BW(n){const e=IW.exec(n);if(!e)return[,];const[,t,s,r]=e;return[`--${t??s}`,r]}function m2(n,e,t=1){const[s,r]=BW(n);if(!s)return;const i=window.getComputedStyle(e).getPropertyValue(s);if(i){const o=i.trim();return FS(o)?parseFloat(o):o}return Sg(r)?m2(r,e,t+1):r}function Ig(n,e){return n?.[e]??n?.default??n}const g2=new Set(["width","height","top","left","right","bottom",...wo]),LW={test:n=>n==="auto",parse:n=>n},x2=n=>e=>e.test(n),y2=[To,be,ns,zs,AH,EH,LW],nv=n=>y2.find(x2(n));function FW(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||jS(n):!0}const OW=new Set(["brightness","contrast","saturate","opacity"]);function jW(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[s]=t.match(Eg)||[];if(!s)return n;const r=t.replace(s,"");let i=OW.has(e)?1:0;return s!==t&&(i*=100),e+"("+i+r+")"}const UW=/\b([a-z-]*)\(.*?\)/gu,kp={...ur,getAnimatableNone:n=>{const e=n.match(UW);return e?e.map(jW).join(" "):n}},sv={...To,transform:Math.round},VW={rotate:zs,rotateX:zs,rotateY:zs,rotateZ:zs,scale:ac,scaleX:ac,scaleY:ac,scaleZ:ac,skew:zs,skewX:zs,skewY:zs,distance:be,translateX:be,translateY:be,translateZ:be,x:be,y:be,z:be,perspective:be,transformPerspective:be,opacity:qa,originX:zb,originY:zb,originZ:be},Bg={borderWidth:be,borderTopWidth:be,borderRightWidth:be,borderBottomWidth:be,borderLeftWidth:be,borderRadius:be,radius:be,borderTopLeftRadius:be,borderTopRightRadius:be,borderBottomRightRadius:be,borderBottomLeftRadius:be,width:be,maxWidth:be,height:be,maxHeight:be,top:be,right:be,bottom:be,left:be,padding:be,paddingTop:be,paddingRight:be,paddingBottom:be,paddingLeft:be,margin:be,marginTop:be,marginRight:be,marginBottom:be,marginLeft:be,backgroundPositionX:be,backgroundPositionY:be,...VW,zIndex:sv,fillOpacity:qa,strokeOpacity:qa,numOctaves:sv},GW={...Bg,color:dt,backgroundColor:dt,outlineColor:dt,fill:dt,stroke:dt,borderColor:dt,borderTopColor:dt,borderRightColor:dt,borderBottomColor:dt,borderLeftColor:dt,filter:kp,WebkitFilter:kp},b2=n=>GW[n];function v2(n,e){let t=b2(n);return t!==kp&&(t=ur),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const $W=new Set(["auto","none","0"]);function zW(n,e,t){let s=0,r;for(;s<n.length&&!r;){const i=n[s];typeof i=="string"&&!$W.has(i)&&Ka(i).values.length&&(r=n[s]),s++}if(r&&t)for(const i of e)n[i]=v2(t,r)}class HW extends Dg{constructor(e,t,s,r,i){super(e,t,s,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),Sg(c))){const u=m2(c,t.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!g2.has(s)||e.length!==2)return;const[r,i]=e,o=nv(r),a=nv(i);if(o!==a)if(Zb(o)&&Zb(a))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else Qr[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)(e[r]===null||FW(e[r]))&&s.push(r);s.length&&zW(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Qr[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(s,r).jump(r,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const i=s.length-1,o=s[i];s[i]=Qr[t](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,l])=>{e.getValue(a).set(l)}),this.resolveNoneKeyframes()}}function WW(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let s=document;const r=t?.[n]??s.querySelectorAll(n);return r?Array.from(r):[]}return Array.from(n)}const _2=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function T2(n){return OS(n)&&"offsetHeight"in n}const rv=30,qW=n=>!isNaN(parseFloat(n));class KW{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const r=Yt.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Yt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=qW(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new _g);const s=this.events[e].add(t);return e==="change"?()=>{s(),Je.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Yt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>rv)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,rv);return US(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function uo(n,e){return new KW(n,e)}const{schedule:Lg}=QS(queueMicrotask,!1),Sn={x:!1,y:!1};function w2(){return Sn.x||Sn.y}function XW(n){return n==="x"||n==="y"?Sn[n]?null:(Sn[n]=!0,()=>{Sn[n]=!1}):Sn.x||Sn.y?null:(Sn.x=Sn.y=!0,()=>{Sn.x=Sn.y=!1})}function N2(n,e){const t=WW(n),s=new AbortController,r={passive:!0,...e,signal:s.signal};return[t,r,()=>s.abort()]}function iv(n){return!(n.pointerType==="touch"||w2())}function YW(n,e,t={}){const[s,r,i]=N2(n,t),o=a=>{if(!iv(a))return;const{target:l}=a,c=e(l,a);if(typeof c!="function"||!l)return;const u=d=>{iv(d)&&(c(d),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,r)};return s.forEach(a=>{a.addEventListener("pointerenter",o,r)}),i}const S2=(n,e)=>e?n===e?!0:S2(n,e.parentElement):!1,Fg=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,QW=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function ZW(n){return QW.has(n.tagName)||n.tabIndex!==-1}const Rc=new WeakSet;function ov(n){return e=>{e.key==="Enter"&&n(e)}}function Oh(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const JW=(n,e)=>{const t=n.currentTarget;if(!t)return;const s=ov(()=>{if(Rc.has(t))return;Oh(t,"down");const r=ov(()=>{Oh(t,"up")}),i=()=>Oh(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",i,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function av(n){return Fg(n)&&!w2()}function eq(n,e,t={}){const[s,r,i]=N2(n,t),o=a=>{const l=a.currentTarget;if(!av(a))return;Rc.add(l);const c=e(l,a),u=(p,m)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),Rc.has(l)&&Rc.delete(l),av(p)&&typeof c=="function"&&c(p,{success:m})},d=p=>{u(p,l===window||l===document||t.useGlobalTarget||S2(l,p.target))},h=p=>{u(p,!1)};window.addEventListener("pointerup",d,r),window.addEventListener("pointercancel",h,r)};return s.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),T2(a)&&(a.addEventListener("focus",c=>JW(c,r)),!ZW(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function E2(n){return OS(n)&&"ownerSVGElement"in n}function tq(n){return E2(n)&&n.tagName==="svg"}const Bt=n=>!!(n&&n.getVelocity),nq=[...y2,dt,ur],sq=n=>nq.find(x2(n)),Og=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function lv(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function rq(...n){return e=>{let t=!1;const s=n.map(r=>{const i=lv(r,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let r=0;r<s.length;r++){const i=s[r];typeof i=="function"?i():lv(n[r],null)}}}}function iq(...n){return N.useCallback(rq(...n),n)}class oq extends N.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=t.offsetParent,r=T2(s)&&s.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=r-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function aq({children:n,isPresent:e,anchorX:t,root:s}){const r=N.useId(),i=N.useRef(null),o=N.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=N.useContext(Og),l=iq(i,n?.ref);return N.useInsertionEffect(()=>{const{width:c,height:u,top:d,left:h,right:p}=o.current;if(e||!i.current||!c||!u)return;const m=t==="left"?`left: ${h}`:`right: ${p}`;i.current.dataset.motionPopId=r;const x=document.createElement("style");a&&(x.nonce=a);const y=s??document.head;return y.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${u}px !important;
            ${m}px !important;
            top: ${d}px !important;
          }
        `),()=>{y.contains(x)&&y.removeChild(x)}},[e]),f.jsx(oq,{isPresent:e,childRef:i,sizeRef:o,children:N.cloneElement(n,{ref:l})})}const lq=({children:n,initial:e,isPresent:t,onExitComplete:s,custom:r,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const c=mg(cq),u=N.useId();let d=!0,h=N.useMemo(()=>(d=!1,{id:u,initial:e,isPresent:t,custom:r,onExitComplete:p=>{c.set(p,!0);for(const m of c.values())if(!m)return;s&&s()},register:p=>(c.set(p,!1),()=>c.delete(p))}),[t,c,s]);return i&&d&&(h={...h}),N.useMemo(()=>{c.forEach((p,m)=>c.set(m,!1))},[t]),N.useEffect(()=>{!t&&!c.size&&s&&s()},[t]),o==="popLayout"&&(n=f.jsx(aq,{isPresent:t,anchorX:a,root:l,children:n})),f.jsx(ld.Provider,{value:h,children:n})};function cq(){return new Map}function A2(n=!0){const e=N.useContext(ld);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:r}=e,i=N.useId();N.useEffect(()=>{if(n)return r(i)},[n]);const o=N.useCallback(()=>n&&s&&s(i),[i,s,n]);return!t&&s?[!1,o]:[!0]}const lc=n=>n.key||"";function cv(n){const e=[];return N.Children.forEach(n,t=>{N.isValidElement(t)&&e.push(t)}),e}const C2=({children:n,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:r=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[c,u]=A2(o),d=N.useMemo(()=>cv(n),[n]),h=o&&!c?[]:d.map(lc),p=N.useRef(!0),m=N.useRef(d),x=mg(()=>new Map),[y,g]=N.useState(d),[b,v]=N.useState(d);LS(()=>{p.current=!1,m.current=d;for(let T=0;T<b.length;T++){const E=lc(b[T]);h.includes(E)?x.delete(E):x.get(E)!==!0&&x.set(E,!1)}},[b,h.length,h.join("-")]);const _=[];if(d!==y){let T=[...d];for(let E=0;E<b.length;E++){const S=b[E],C=lc(S);h.includes(C)||(T.splice(E,0,S),_.push(S))}return i==="wait"&&_.length&&(T=_),v(cv(T)),g(d),null}const{forceRender:w}=N.useContext(pg);return f.jsx(f.Fragment,{children:b.map(T=>{const E=lc(T),S=o&&!c?!1:d===b||h.includes(E),C=()=>{if(x.has(E))x.set(E,!0);else return;let k=!0;x.forEach(B=>{B||(k=!1)}),k&&(w?.(),v(m.current),o&&u?.(),s&&s())};return f.jsx(lq,{isPresent:S,initial:!p.current||t?void 0:!1,custom:e,presenceAffectsLayout:r,mode:i,root:l,onExitComplete:S?void 0:C,anchorX:a,children:T},E)})})},R2=N.createContext({strict:!1}),uv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ho={};for(const n in uv)ho[n]={isEnabled:e=>uv[n].some(t=>!!e[t])};function uq(n){for(const e in n)ho[e]={...ho[e],...n[e]}}const dq=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function bu(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||dq.has(n)}let M2=n=>!bu(n);function hq(n){typeof n=="function"&&(M2=e=>e.startsWith("on")?!bu(e):n(e))}try{hq(require("@emotion/is-prop-valid").default)}catch{}function fq(n,e,t){const s={};for(const r in n)r==="values"&&typeof n.values=="object"||(M2(r)||t===!0&&bu(r)||!e&&!bu(r)||n.draggable&&r.startsWith("onDrag"))&&(s[r]=n[r]);return s}const cd=N.createContext({});function ud(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Xa(n){return typeof n=="string"||Array.isArray(n)}const jg=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Ug=["initial",...jg];function dd(n){return ud(n.animate)||Ug.some(e=>Xa(n[e]))}function P2(n){return!!(dd(n)||n.variants)}function pq(n,e){if(dd(n)){const{initial:t,animate:s}=n;return{initial:t===!1||Xa(t)?t:void 0,animate:Xa(s)?s:void 0}}return n.inherit!==!1?e:{}}function mq(n){const{initial:e,animate:t}=pq(n,N.useContext(cd));return N.useMemo(()=>({initial:e,animate:t}),[dv(e),dv(t)])}function dv(n){return Array.isArray(n)?n.join(" "):n}const Ya={};function gq(n){for(const e in n)Ya[e]=n[e],Ng(e)&&(Ya[e].isCSSVariable=!0)}function k2(n,{layout:e,layoutId:t}){return No.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!Ya[n]||n==="opacity")}const xq={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},yq=wo.length;function bq(n,e,t){let s="",r=!0;for(let i=0;i<yq;i++){const o=wo[i],a=n[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||t){const c=_2(a,Bg[o]);if(!l){r=!1;const u=xq[o]||o;s+=`${u}(${c}) `}t&&(e[o]=c)}}return s=s.trim(),t?s=t(e,r?"":s):r&&(s="none"),s}function Vg(n,e,t){const{style:s,vars:r,transformOrigin:i}=n;let o=!1,a=!1;for(const l in e){const c=e[l];if(No.has(l)){o=!0;continue}else if(Ng(l)){r[l]=c;continue}else{const u=_2(c,Bg[l]);l.startsWith("origin")?(a=!0,i[l]=u):s[l]=u}}if(e.transform||(o||t?s.transform=bq(e,n.transform,t):s.transform&&(s.transform="none")),a){const{originX:l="50%",originY:c="50%",originZ:u=0}=i;s.transformOrigin=`${l} ${c} ${u}`}}const Gg=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function D2(n,e,t){for(const s in e)!Bt(e[s])&&!k2(s,t)&&(n[s]=e[s])}function vq({transformTemplate:n},e){return N.useMemo(()=>{const t=Gg();return Vg(t,e,n),Object.assign({},t.vars,t.style)},[e])}function _q(n,e){const t=n.style||{},s={};return D2(s,t,n),Object.assign(s,vq(n,e)),s}function Tq(n,e){const t={},s=_q(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=s,t}const wq={offset:"stroke-dashoffset",array:"stroke-dasharray"},Nq={offset:"strokeDashoffset",array:"strokeDasharray"};function Sq(n,e,t=1,s=0,r=!0){n.pathLength=1;const i=r?wq:Nq;n[i.offset]=be.transform(-s);const o=be.transform(e),a=be.transform(t);n[i.array]=`${o} ${a}`}function I2(n,{attrX:e,attrY:t,attrScale:s,pathLength:r,pathSpacing:i=1,pathOffset:o=0,...a},l,c,u){if(Vg(n,a,c),l){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:d,style:h}=n;d.transform&&(h.transform=d.transform,delete d.transform),(h.transform||d.transformOrigin)&&(h.transformOrigin=d.transformOrigin??"50% 50%",delete d.transformOrigin),h.transform&&(h.transformBox=u?.transformBox??"fill-box",delete d.transformBox),e!==void 0&&(d.x=e),t!==void 0&&(d.y=t),s!==void 0&&(d.scale=s),r!==void 0&&Sq(d,r,i,o,!1)}const B2=()=>({...Gg(),attrs:{}}),L2=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Eq(n,e,t,s){const r=N.useMemo(()=>{const i=B2();return I2(i,e,L2(s),n.transformTemplate,n.style),{...i.attrs,style:{...i.style}}},[e]);if(n.style){const i={};D2(i,n.style,n),r.style={...i,...r.style}}return r}const Aq=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function $g(n){return typeof n!="string"||n.includes("-")?!1:!!(Aq.indexOf(n)>-1||/[A-Z]/u.test(n))}function Cq(n,e,t,{latestValues:s},r,i=!1){const a=($g(n)?Eq:Tq)(e,s,r,n),l=fq(e,typeof n=="string",i),c=n!==N.Fragment?{...l,...a,ref:t}:{},{children:u}=e,d=N.useMemo(()=>Bt(u)?u.get():u,[u]);return N.createElement(n,{...c,children:d})}function hv(n){const e=[{},{}];return n?.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function zg(n,e,t,s){if(typeof e=="function"){const[r,i]=hv(s);e=e(t!==void 0?t:n.custom,r,i)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[r,i]=hv(s);e=e(t!==void 0?t:n.custom,r,i)}return e}function Mc(n){return Bt(n)?n.get():n}function Rq({scrapeMotionValuesFromProps:n,createRenderState:e},t,s,r){return{latestValues:Mq(t,s,r,n),renderState:e()}}function Mq(n,e,t,s){const r={},i=s(n,{});for(const h in i)r[h]=Mc(i[h]);let{initial:o,animate:a}=n;const l=dd(n),c=P2(n);e&&c&&!l&&n.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=t?t.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!ud(d)){const h=Array.isArray(d)?d:[d];for(let p=0;p<h.length;p++){const m=zg(n,h[p]);if(m){const{transitionEnd:x,transition:y,...g}=m;for(const b in g){let v=g[b];if(Array.isArray(v)){const _=u?v.length-1:0;v=v[_]}v!==null&&(r[b]=v)}for(const b in x)r[b]=x[b]}}}return r}const F2=n=>(e,t)=>{const s=N.useContext(cd),r=N.useContext(ld),i=()=>Rq(n,e,s,r);return t?i():mg(i)};function Hg(n,e,t){const{style:s}=n,r={};for(const i in s)(Bt(s[i])||e.style&&Bt(e.style[i])||k2(i,n)||t?.getValue(i)?.liveStyle!==void 0)&&(r[i]=s[i]);return r}const Pq=F2({scrapeMotionValuesFromProps:Hg,createRenderState:Gg});function O2(n,e,t){const s=Hg(n,e,t);for(const r in n)if(Bt(n[r])||Bt(e[r])){const i=wo.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[i]=n[r]}return s}const kq=F2({scrapeMotionValuesFromProps:O2,createRenderState:B2}),Dq=Symbol.for("motionComponentSymbol");function Di(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function Iq(n,e,t){return N.useCallback(s=>{s&&n.onMount&&n.onMount(s),e&&(s?e.mount(s):e.unmount()),t&&(typeof t=="function"?t(s):Di(t)&&(t.current=s))},[e])}const Wg=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Bq="framerAppearId",j2="data-"+Wg(Bq),U2=N.createContext({});function Lq(n,e,t,s,r){const{visualElement:i}=N.useContext(cd),o=N.useContext(R2),a=N.useContext(ld),l=N.useContext(Og).reducedMotion,c=N.useRef(null);s=s||o.renderer,!c.current&&s&&(c.current=s(n,{visualState:e,parent:i,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const u=c.current,d=N.useContext(U2);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&Fq(c.current,t,r,d);const h=N.useRef(!1);N.useInsertionEffect(()=>{u&&h.current&&u.update(t,a)});const p=t[j2],m=N.useRef(!!p&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return LS(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),m.current&&u.animationState&&u.animationState.animateChanges())}),N.useEffect(()=>{u&&(!m.current&&u.animationState&&u.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(p)}),m.current=!1),u.enteringChildren=void 0)}),u}function Fq(n,e,t,s){const{layoutId:r,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:V2(n.parent)),n.projection.setOptions({layoutId:r,layout:i,alwaysMeasureLayout:!!o||a&&Di(a),visualElement:n,animationType:typeof i=="string"?i:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:l,layoutRoot:c})}function V2(n){if(n)return n.options.allowProjection!==!1?n.projection:V2(n.parent)}function jh(n,{forwardMotionProps:e=!1}={},t,s){t&&uq(t);const r=$g(n)?kq:Pq;function i(a,l){let c;const u={...N.useContext(Og),...a,layoutId:Oq(a)},{isStatic:d}=u,h=mq(a),p=r(a,d);if(!d&&gg){jq();const m=Uq(u);c=m.MeasureLayout,h.visualElement=Lq(n,p,u,s,m.ProjectionNode)}return f.jsxs(cd.Provider,{value:h,children:[c&&h.visualElement?f.jsx(c,{visualElement:h.visualElement,...u}):null,Cq(n,a,Iq(p,h.visualElement,l),p,d,e)]})}i.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const o=N.forwardRef(i);return o[Dq]=n,o}function Oq({layoutId:n}){const e=N.useContext(pg).id;return e&&n!==void 0?e+"-"+n:n}function jq(n,e){N.useContext(R2).strict}function Uq(n){const{drag:e,layout:t}=ho;if(!e&&!t)return{};const s={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function Vq(n,e){if(typeof Proxy>"u")return jh;const t=new Map,s=(i,o)=>jh(i,o,n,e),r=(i,o)=>s(i,o);return new Proxy(r,{get:(i,o)=>o==="create"?s:(t.has(o)||t.set(o,jh(o,void 0,n,e)),t.get(o))})}function G2({top:n,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:n,max:s}}}function Gq({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function $q(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),s=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function Uh(n){return n===void 0||n===1}function Dp({scale:n,scaleX:e,scaleY:t}){return!Uh(n)||!Uh(e)||!Uh(t)}function kr(n){return Dp(n)||$2(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function $2(n){return fv(n.x)||fv(n.y)}function fv(n){return n&&n!=="0%"}function vu(n,e,t){const s=n-t,r=e*s;return t+r}function pv(n,e,t,s,r){return r!==void 0&&(n=vu(n,r,s)),vu(n,t,s)+e}function Ip(n,e=0,t=1,s,r){n.min=pv(n.min,e,t,s,r),n.max=pv(n.max,e,t,s,r)}function z2(n,{x:e,y:t}){Ip(n.x,e.translate,e.scale,e.originPoint),Ip(n.y,t.translate,t.scale,t.originPoint)}const mv=.999999999999,gv=1.0000000000001;function zq(n,e,t,s=!1){const r=t.length;if(!r)return;e.x=e.y=1;let i,o;for(let a=0;a<r;a++){i=t[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Bi(n,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,z2(n,o)),s&&kr(i.latestValues)&&Bi(n,i.latestValues))}e.x<gv&&e.x>mv&&(e.x=1),e.y<gv&&e.y>mv&&(e.y=1)}function Ii(n,e){n.min=n.min+e,n.max=n.max+e}function xv(n,e,t,s,r=.5){const i=st(n.min,n.max,r);Ip(n,e,t,i,s)}function Bi(n,e){xv(n.x,e.x,e.scaleX,e.scale,e.originX),xv(n.y,e.y,e.scaleY,e.scale,e.originY)}function H2(n,e){return G2($q(n.getBoundingClientRect(),e))}function Hq(n,e,t){const s=H2(n,t),{scroll:r}=e;return r&&(Ii(s.x,r.offset.x),Ii(s.y,r.offset.y)),s}const yv=()=>({translate:0,scale:1,origin:0,originPoint:0}),Li=()=>({x:yv(),y:yv()}),bv=()=>({min:0,max:0}),bt=()=>({x:bv(),y:bv()}),Bp={current:null},W2={current:!1};function Wq(){if(W2.current=!0,!!gg)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>Bp.current=n.matches;n.addEventListener("change",e),e()}else Bp.current=!1}const qq=new WeakMap;function Kq(n,e,t){for(const s in e){const r=e[s],i=t[s];if(Bt(r))n.addValue(s,r);else if(Bt(i))n.addValue(s,uo(r,{owner:n}));else if(i!==r)if(n.hasValue(s)){const o=n.getValue(s);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=n.getStaticValue(s);n.addValue(s,uo(o!==void 0?o:r,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const vv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Xq{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Dg,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Yt.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Je.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=dd(t),this.isVariantNode=P2(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const h in d){const p=d[h];l[h]!==void 0&&Bt(p)&&p.set(l[h])}}mount(e){this.current=e,qq.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),W2.current||Wq(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Bp.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),cr(this.notifyUpdate),cr(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=No.has(e);s&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Je.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),i&&i(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ho){const t=ho[e];if(!t)continue;const{isEnabled:s,Feature:r}=t;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):bt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<vv.length;s++){const r=vv[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i="on"+r,o=e[i];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=Kq(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=uo(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(FS(s)||jS(s))?s=parseFloat(s):!sq(s)&&ur.test(t)&&(s=v2(e,t)),this.setBaseTarget(e,Bt(s)?s.get():s)),Bt(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if(typeof t=="string"||typeof t=="object"){const i=zg(this.props,t,this.presenceContext?.custom);i&&(s=i[e])}if(t&&s!==void 0)return s;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Bt(r)?r:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new _g),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){Lg.render(this.render)}}class q2 extends Xq{constructor(){super(...arguments),this.KeyframeResolver=HW}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Bt(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function K2(n,{style:e,vars:t},s,r){const i=n.style;let o;for(o in e)i[o]=e[o];r?.applyProjectionStyles(i,s);for(o in t)i.setProperty(o,t[o])}function Yq(n){return window.getComputedStyle(n)}class Qq extends q2{constructor(){super(...arguments),this.type="html",this.renderInstance=K2}readValueFromInstance(e,t){if(No.has(t))return this.projection?.isProjecting?Ep(t):uW(e,t);{const s=Yq(e),r=(Ng(t)?s.getPropertyValue(t):s[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return H2(e,t)}build(e,t,s){Vg(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Hg(e,t,s)}}const X2=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Zq(n,e,t,s){K2(n,e,void 0,s);for(const r in e.attrs)n.setAttribute(X2.has(r)?r:Wg(r),e.attrs[r])}class Jq extends q2{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=bt}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(No.has(t)){const s=b2(t);return s&&s.default||0}return t=X2.has(t)?t:Wg(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return O2(e,t,s)}build(e,t,s){I2(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,r){Zq(e,t,s,r)}mount(e){this.isSVGTag=L2(e.tagName),super.mount(e)}}const eK=(n,e)=>$g(n)?new Jq(e):new Qq(e,{allowProjection:n!==N.Fragment});function Wi(n,e,t){const s=n.getProps();return zg(s,e,t!==void 0?t:s.custom,n)}const Lp=n=>Array.isArray(n);function tK(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,uo(t))}function nK(n){return Lp(n)?n[n.length-1]||0:n}function sK(n,e){const t=Wi(n,e);let{transitionEnd:s={},transition:r={},...i}=t||{};i={...i,...s};for(const o in i){const a=nK(i[o]);tK(n,o,a)}}function rK(n){return!!(Bt(n)&&n.add)}function Fp(n,e){const t=n.getValue("willChange");if(rK(t))return t.add(e);if(!t&&Os.WillChange){const s=new Os.WillChange("auto");n.addValue("willChange",s),s.add(e)}}function Y2(n){return n.props[j2]}const iK=n=>n!==null;function oK(n,{repeat:e,repeatType:t="loop"},s){const r=n.filter(iK),i=e&&t!=="loop"&&e%2===1?0:r.length-1;return r[i]}const aK={type:"spring",stiffness:500,damping:25,restSpeed:10},lK=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),cK={type:"keyframes",duration:.8},uK={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dK=(n,{keyframes:e})=>e.length>2?cK:No.has(n)?n.startsWith("scale")?lK(e[1]):aK:uK;function hK({when:n,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:r,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const qg=(n,e,t,s={},r,i)=>o=>{const a=Ig(s,n)||{},l=a.delay||s.delay||0;let{elapsed:c=0}=s;c=c-ts(l);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-c,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:i?void 0:r};hK(a)||Object.assign(u,dK(n,u)),u.duration&&(u.duration=ts(u.duration)),u.repeatDelay&&(u.repeatDelay=ts(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Pp(u),u.delay===0&&(d=!0)),(Os.instantAnimations||Os.skipAnimations)&&(d=!0,Pp(u),u.delay=0),u.allowFlatten=!a.type&&!a.ease,d&&!i&&e.get()!==void 0){const h=oK(u.keyframes,a);if(h!==void 0){Je.update(()=>{u.onUpdate(h),u.onComplete()});return}}return a.isSync?new kg(u):new DW(u)};function fK({protectedKeys:n,needsAnimating:e},t){const s=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function Q2(n,e,{delay:t=0,transitionOverride:s,type:r}={}){let{transition:i=n.getDefaultTransition(),transitionEnd:o,...a}=e;s&&(i=s);const l=[],c=r&&n.animationState&&n.animationState.getState()[r];for(const u in a){const d=n.getValue(u,n.latestValues[u]??null),h=a[u];if(h===void 0||c&&fK(c,u))continue;const p={delay:t,...Ig(i||{},u)},m=d.get();if(m!==void 0&&!d.isAnimating&&!Array.isArray(h)&&h===m&&!p.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const g=Y2(n);if(g){const b=window.MotionHandoffAnimation(g,u,Je);b!==null&&(p.startTime=b,x=!0)}}Fp(n,u),d.start(qg(u,d,h,n.shouldReduceMotion&&g2.has(u)?{type:!1}:p,n,x));const y=d.animation;y&&l.push(y)}return o&&Promise.all(l).then(()=>{Je.update(()=>{o&&sK(n,o)})}),l}function Z2(n,e,t,s=0,r=1){const i=Array.from(n).sort((c,u)=>c.sortNodePosition(u)).indexOf(e),o=n.size,a=(o-1)*s;return typeof t=="function"?t(i,o):r===1?i*s:a-i*s}function Op(n,e,t={}){const s=Wi(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:r=n.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(r=t.transitionOverride);const i=s?()=>Promise.all(Q2(n,s,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:d}=r;return pK(n,e,l,c,u,d,t)}:()=>Promise.resolve(),{when:a}=r;if(a){const[l,c]=a==="beforeChildren"?[i,o]:[o,i];return l().then(()=>c())}else return Promise.all([i(),o(t.delay)])}function pK(n,e,t=0,s=0,r=0,i=1,o){const a=[];for(const l of n.variantChildren)l.notify("AnimationStart",e),a.push(Op(l,e,{...o,delay:t+(typeof s=="function"?0:s)+Z2(n.variantChildren,l,s,r,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function mK(n,e,t={}){n.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(i=>Op(n,i,t));s=Promise.all(r)}else if(typeof e=="string")s=Op(n,e,t);else{const r=typeof e=="function"?Wi(n,e,t.custom):e;s=Promise.all(Q2(n,r,t))}return s.then(()=>{n.notify("AnimationComplete",e)})}function J2(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let s=0;s<t;s++)if(e[s]!==n[s])return!1;return!0}const gK=Ug.length;function eE(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?eE(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<gK;t++){const s=Ug[t],r=n.props[s];(Xa(r)||r===!1)&&(e[s]=r)}return e}const xK=[...jg].reverse(),yK=jg.length;function bK(n){return e=>Promise.all(e.map(({animation:t,options:s})=>mK(n,t,s)))}function vK(n){let e=bK(n),t=_v(),s=!0;const r=l=>(c,u)=>{const d=Wi(n,u,l==="exit"?n.presenceContext?.custom:void 0);if(d){const{transition:h,transitionEnd:p,...m}=d;c={...c,...m,...p}}return c};function i(l){e=l(n)}function o(l){const{props:c}=n,u=eE(n.parent)||{},d=[],h=new Set;let p={},m=1/0;for(let y=0;y<yK;y++){const g=xK[y],b=t[g],v=c[g]!==void 0?c[g]:u[g],_=Xa(v),w=g===l?b.isActive:null;w===!1&&(m=y);let T=v===u[g]&&v!==c[g]&&_;if(T&&s&&n.manuallyAnimateOnMount&&(T=!1),b.protectedKeys={...p},!b.isActive&&w===null||!v&&!b.prevProp||ud(v)||typeof v=="boolean")continue;const E=_K(b.prevProp,v);let S=E||g===l&&b.isActive&&!T&&_||y>m&&_,C=!1;const k=Array.isArray(v)?v:[v];let B=k.reduce(r(g),{});w===!1&&(B={});const{prevResolvedValues:V={}}=b,z={...V,...B},A=R=>{S=!0,h.has(R)&&(C=!0,h.delete(R)),b.needsAnimating[R]=!0;const F=n.getValue(R);F&&(F.liveStyle=!1)};for(const R in z){const F=B[R],P=V[R];if(p.hasOwnProperty(R))continue;let W=!1;Lp(F)&&Lp(P)?W=!J2(F,P):W=F!==P,W?F!=null?A(R):h.add(R):F!==void 0&&h.has(R)?A(R):b.protectedKeys[R]=!0}b.prevProp=v,b.prevResolvedValues=B,b.isActive&&(p={...p,...B}),s&&n.blockInitialAnimation&&(S=!1);const O=T&&E;S&&(!O||C)&&d.push(...k.map(R=>{const F={type:g};if(typeof R=="string"&&s&&!O&&n.manuallyAnimateOnMount&&n.parent){const{parent:P}=n,W=Wi(P,R);if(P.enteringChildren&&W){const{delayChildren:L}=W.transition||{};F.delay=Z2(P.enteringChildren,n,L)}}return{animation:R,options:F}}))}if(h.size){const y={};if(typeof c.initial!="boolean"){const g=Wi(n,Array.isArray(c.initial)?c.initial[0]:c.initial);g&&g.transition&&(y.transition=g.transition)}h.forEach(g=>{const b=n.getBaseTarget(g),v=n.getValue(g);v&&(v.liveStyle=!0),y[g]=b??null}),d.push({animation:y})}let x=!!d.length;return s&&(c.initial===!1||c.initial===c.animate)&&!n.manuallyAnimateOnMount&&(x=!1),s=!1,x?e(d):Promise.resolve()}function a(l,c){if(t[l].isActive===c)return Promise.resolve();n.variantChildren?.forEach(d=>d.animationState?.setActive(l,c)),t[l].isActive=c;const u=o(l);for(const d in t)t[d].protectedKeys={};return u}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>t,reset:()=>{t=_v()}}}function _K(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!J2(e,n):!1}function Cr(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function _v(){return{animate:Cr(!0),whileInView:Cr(),whileHover:Cr(),whileTap:Cr(),whileDrag:Cr(),whileFocus:Cr(),exit:Cr()}}class gr{constructor(e){this.isMounted=!1,this.node=e}update(){}}class TK extends gr{constructor(e){super(e),e.animationState||(e.animationState=vK(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ud(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let wK=0;class NK extends gr{constructor(){super(...arguments),this.id=wK++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const SK={animation:{Feature:TK},exit:{Feature:NK}};function Qa(n,e,t,s={passive:!0}){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t)}function pl(n){return{point:{x:n.pageX,y:n.pageY}}}const EK=n=>e=>Fg(e)&&n(e,pl(e));function Na(n,e,t,s){return Qa(n,e,EK(t),s)}const tE=1e-4,AK=1-tE,CK=1+tE,nE=.01,RK=0-nE,MK=0+nE;function Gt(n){return n.max-n.min}function PK(n,e,t){return Math.abs(n-e)<=t}function Tv(n,e,t,s=.5){n.origin=s,n.originPoint=st(e.min,e.max,n.origin),n.scale=Gt(t)/Gt(e),n.translate=st(t.min,t.max,n.origin)-n.originPoint,(n.scale>=AK&&n.scale<=CK||isNaN(n.scale))&&(n.scale=1),(n.translate>=RK&&n.translate<=MK||isNaN(n.translate))&&(n.translate=0)}function Sa(n,e,t,s){Tv(n.x,e.x,t.x,s?s.originX:void 0),Tv(n.y,e.y,t.y,s?s.originY:void 0)}function wv(n,e,t){n.min=t.min+e.min,n.max=n.min+Gt(e)}function kK(n,e,t){wv(n.x,e.x,t.x),wv(n.y,e.y,t.y)}function Nv(n,e,t){n.min=e.min-t.min,n.max=n.min+Gt(e)}function _u(n,e,t){Nv(n.x,e.x,t.x),Nv(n.y,e.y,t.y)}function cn(n){return[n("x"),n("y")]}const sE=({current:n})=>n?n.ownerDocument.defaultView:null,Sv=(n,e)=>Math.abs(n-e);function DK(n,e){const t=Sv(n.x,e.x),s=Sv(n.y,e.y);return Math.sqrt(t**2+s**2)}class rE{constructor(e,t,{transformPagePoint:s,contextWindow:r=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Gh(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,m=DK(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!p&&!m)return;const{point:x}=h,{timestamp:y}=Et;this.history.push({...x,timestamp:y});const{onStart:g,onMove:b}=this.handlers;p||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,p)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Vh(p,this.transformPagePoint),Je.update(this.updatePoint,!0)},this.handlePointerUp=(h,p)=>{this.end();const{onEnd:m,onSessionEnd:x,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Gh(h.type==="pointercancel"?this.lastMoveEventInfo:Vh(p,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),x&&x(h,g)},!Fg(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=o,this.contextWindow=r||window;const a=pl(e),l=Vh(a,this.transformPagePoint),{point:c}=l,{timestamp:u}=Et;this.history=[{...c,timestamp:u}];const{onSessionStart:d}=t;d&&d(e,Gh(l,this.history)),this.removeListeners=dl(Na(this.contextWindow,"pointermove",this.handlePointerMove),Na(this.contextWindow,"pointerup",this.handlePointerUp),Na(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),cr(this.updatePoint)}}function Vh(n,e){return e?{point:e(n.point)}:n}function Ev(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Gh({point:n},e){return{point:n,delta:Ev(n,iE(e)),offset:Ev(n,IK(e)),velocity:BK(e,.1)}}function IK(n){return n[0]}function iE(n){return n[n.length-1]}function BK(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,s=null;const r=iE(n);for(;t>=0&&(s=n[t],!(r.timestamp-s.timestamp>ts(e)));)t--;if(!s)return{x:0,y:0};const i=gn(r.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function LK(n,{min:e,max:t},s){return e!==void 0&&n<e?n=s?st(e,n,s.min):Math.max(n,e):t!==void 0&&n>t&&(n=s?st(t,n,s.max):Math.min(n,t)),n}function Av(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function FK(n,{top:e,left:t,bottom:s,right:r}){return{x:Av(n.x,t,r),y:Av(n.y,e,s)}}function Cv(n,e){let t=e.min-n.min,s=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,s]=[s,t]),{min:t,max:s}}function OK(n,e){return{x:Cv(n.x,e.x),y:Cv(n.y,e.y)}}function jK(n,e){let t=.5;const s=Gt(n),r=Gt(e);return r>s?t=Wa(e.min,e.max-s,n.min):s>r&&(t=Wa(n.min,n.max-r,e.min)),Fs(0,1,t)}function UK(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const jp=.35;function VK(n=jp){return n===!1?n=0:n===!0&&(n=jp),{x:Rv(n,"left","right"),y:Rv(n,"top","bottom")}}function Rv(n,e,t){return{min:Mv(n,e),max:Mv(n,t)}}function Mv(n,e){return typeof n=="number"?n:n[e]||0}const GK=new WeakMap;class $K{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=bt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const i=d=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(pl(d).point)},o=(d,h)=>{const{drag:p,dragPropagation:m,onDragStart:x}=this.getProps();if(p&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=XW(p),!this.openDragLock))return;this.latestPointerEvent=d,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),cn(g=>{let b=this.getAxisMotionValue(g).get()||0;if(ns.test(b)){const{projection:v}=this.visualElement;if(v&&v.layout){const _=v.layout.layoutBox[g];_&&(b=Gt(_)*(parseFloat(b)/100))}}this.originPoint[g]=b}),x&&Je.postRender(()=>x(d,h)),Fp(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h;const{dragPropagation:p,dragDirectionLock:m,onDirectionLock:x,onDrag:y}=this.getProps();if(!p&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=zK(g),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),y&&y(d,h)},l=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h,this.stop(d,h),this.latestPointerEvent=null,this.latestPanInfo=null},c=()=>cn(d=>this.getAnimationState(d)==="paused"&&this.getAxisMotionValue(d).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new rE(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:sE(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,r=t||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!r||!s)return;const{velocity:o}=r;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Je.postRender(()=>a(s,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:r}=this.getProps();if(!s||!cc(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=LK(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&Di(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=FK(s.layoutBox,e):this.constraints=!1,this.elastic=VK(t),r!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&cn(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=UK(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Di(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=Hq(s,r.root,this.visualElement.getTransformPagePoint());let o=OK(r.layout.layoutBox,i);if(t){const a=t(Gq(o));this.hasMutatedConstraints=!!a,a&&(o=G2(a))}return o}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=cn(u=>{if(!cc(u,t,this.currentDirection))return;let d=l&&l[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,p=r?40:1e7,m={type:"inertia",velocity:s?e[u]:0,bounceStiffness:h,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...d};return this.startAxisValueAnimation(u,m)});return Promise.all(c).then(a)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return Fp(this.visualElement,e),s.start(qg(e,s,0,t,this.visualElement,!1))}stopAnimation(){cn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){cn(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[t];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){cn(t=>{const{drag:s}=this.getProps();if(!cc(t,s,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[t];i.set(e[t]-st(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Di(t)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};cn(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=jK({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),cn(o=>{if(!cc(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(st(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;GK.set(this.visualElement,this);const e=this.visualElement.current,t=Na(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();Di(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Je.read(s);const o=Qa(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(cn(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=l[u].translate,d.set(d.get()+l[u].translate))}),this.visualElement.render())}));return()=>{o(),t(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=jp,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function cc(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function zK(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class HK extends gr{constructor(e){super(e),this.removeGroupControls=yn,this.removeListeners=yn,this.controls=new $K(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||yn}unmount(){this.removeGroupControls(),this.removeListeners()}}const Pv=n=>(e,t)=>{n&&Je.postRender(()=>n(e,t))};class WK extends gr{constructor(){super(...arguments),this.removePointerDownListener=yn}onPointerDown(e){this.session=new rE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sE(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:Pv(e),onStart:Pv(t),onMove:s,onEnd:(i,o)=>{delete this.session,r&&Je.postRender(()=>r(i,o))}}}mount(){this.removePointerDownListener=Na(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Pc={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function kv(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Zo={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(be.test(n))n=parseFloat(n);else return n;const t=kv(n,e.target.x),s=kv(n,e.target.y);return`${t}% ${s}%`}},qK={correct:(n,{treeScale:e,projectionDelta:t})=>{const s=n,r=ur.parse(n);if(r.length>5)return s;const i=ur.createTransformer(n),o=typeof r[0]!="number"?1:0,a=t.x.scale*e.x,l=t.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=st(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),i(r)}};let $h=!1;class KK extends N.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:r}=this.props,{projection:i}=e;gq(XK),i&&(t.group&&t.group.add(i),s&&s.register&&r&&s.register(i),$h&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Pc.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:r,isPresent:i}=this.props,{projection:o}=s;return o&&(o.isPresent=i,$h=!0,r||e.layoutDependency!==t||t===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Je.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Lg.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:r}=e;$h=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function oE(n){const[e,t]=A2(),s=N.useContext(pg);return f.jsx(KK,{...n,layoutGroup:s,switchLayoutGroup:N.useContext(U2),isPresent:e,safeToRemove:t})}const XK={borderRadius:{...Zo,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Zo,borderTopRightRadius:Zo,borderBottomLeftRadius:Zo,borderBottomRightRadius:Zo,boxShadow:qK};function YK(n,e,t){const s=Bt(n)?n:uo(n);return s.start(qg("",s,e,t)),s.animation}const QK=(n,e)=>n.depth-e.depth;class ZK{constructor(){this.children=[],this.isDirty=!1}add(e){xg(this.children,e),this.isDirty=!0}remove(e){yg(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(QK),this.isDirty=!1,this.children.forEach(e)}}function JK(n,e){const t=Yt.now(),s=({timestamp:r})=>{const i=r-t;i>=e&&(cr(s),n(i-e))};return Je.setup(s,!0),()=>cr(s)}const aE=["TopLeft","TopRight","BottomLeft","BottomRight"],eX=aE.length,Dv=n=>typeof n=="string"?parseFloat(n):n,Iv=n=>typeof n=="number"||be.test(n);function tX(n,e,t,s,r,i){r?(n.opacity=st(0,t.opacity??1,nX(s)),n.opacityExit=st(e.opacity??1,0,sX(s))):i&&(n.opacity=st(e.opacity??1,t.opacity??1,s));for(let o=0;o<eX;o++){const a=`border${aE[o]}Radius`;let l=Bv(e,a),c=Bv(t,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||Iv(l)===Iv(c)?(n[a]=Math.max(st(Dv(l),Dv(c),s),0),(ns.test(c)||ns.test(l))&&(n[a]+="%")):n[a]=c}(e.rotate||t.rotate)&&(n.rotate=st(e.rotate||0,t.rotate||0,s))}function Bv(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const nX=lE(0,.5,qS),sX=lE(.5,.95,yn);function lE(n,e,t){return s=>s<n?0:s>e?1:t(Wa(n,e,s))}function Lv(n,e){n.min=e.min,n.max=e.max}function wn(n,e){Lv(n.x,e.x),Lv(n.y,e.y)}function Fv(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function Ov(n,e,t,s,r){return n-=e,n=vu(n,1/t,s),r!==void 0&&(n=vu(n,1/r,s)),n}function rX(n,e=0,t=1,s=.5,r,i=n,o=n){if(ns.test(e)&&(e=parseFloat(e),e=st(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=st(i.min,i.max,s);n===i&&(a-=e),n.min=Ov(n.min,e,t,a,r),n.max=Ov(n.max,e,t,a,r)}function jv(n,e,[t,s,r],i,o){rX(n,e[t],e[s],e[r],e.scale,i,o)}const iX=["x","scaleX","originX"],oX=["y","scaleY","originY"];function Uv(n,e,t,s){jv(n.x,e,iX,t?t.x:void 0,s?s.x:void 0),jv(n.y,e,oX,t?t.y:void 0,s?s.y:void 0)}function Vv(n){return n.translate===0&&n.scale===1}function cE(n){return Vv(n.x)&&Vv(n.y)}function Gv(n,e){return n.min===e.min&&n.max===e.max}function aX(n,e){return Gv(n.x,e.x)&&Gv(n.y,e.y)}function $v(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function uE(n,e){return $v(n.x,e.x)&&$v(n.y,e.y)}function zv(n){return Gt(n.x)/Gt(n.y)}function Hv(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class lX{constructor(){this.members=[]}add(e){xg(this.members,e),e.scheduleRender()}remove(e){if(yg(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let s;for(let r=t;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function cX(n,e,t){let s="";const r=n.x.translate/e.x,i=n.y.translate/e.y,o=t?.z||0;if((r||i||o)&&(s=`translate3d(${r}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:c,rotate:u,rotateX:d,rotateY:h,skewX:p,skewY:m}=t;c&&(s=`perspective(${c}px) ${s}`),u&&(s+=`rotate(${u}deg) `),d&&(s+=`rotateX(${d}deg) `),h&&(s+=`rotateY(${h}deg) `),p&&(s+=`skewX(${p}deg) `),m&&(s+=`skewY(${m}deg) `)}const a=n.x.scale*e.x,l=n.y.scale*e.y;return(a!==1||l!==1)&&(s+=`scale(${a}, ${l})`),s||"none"}const zh=["","X","Y","Z"],uX=1e3;let dX=0;function Hh(n,e,t,s){const{latestValues:r}=e;r[n]&&(t[n]=r[n],e.setStaticValue(n,0),s&&(s[n]=0))}function dE(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=Y2(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:i}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Je,!(r||i))}const{parent:s}=n;s&&!s.hasCheckedOptimisedAppear&&dE(s)}function hE({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(o={},a=e?.()){this.id=dX++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(pX),this.nodes.forEach(yX),this.nodes.forEach(bX),this.nodes.forEach(mX)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new ZK)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new _g),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=E2(o)&&!tq(o),this.instance=o;const{layoutId:a,layout:l,visualElement:c}=this.options;if(c&&!c.current&&c.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),n){let u,d=0;const h=()=>this.root.updateBlockedByResize=!1;Je.read(()=>{d=window.innerWidth}),n(o,()=>{const p=window.innerWidth;p!==d&&(d=p,this.root.updateBlockedByResize=!0,u&&u(),u=JK(h,250),Pc.hasAnimatedSinceResize&&(Pc.hasAnimatedSinceResize=!1,this.nodes.forEach(Kv)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&c&&(a||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:d,hasRelativeLayoutChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||c.getDefaultTransition()||NX,{onLayoutAnimationStart:x,onLayoutAnimationComplete:y}=c.getProps(),g=!this.targetLayout||!uE(this.targetLayout,p),b=!d&&h;if(this.options.layoutRoot||this.resumeFrom||b||d&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...Ig(m,"layout"),onPlay:x,onComplete:y};(c.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(u,b)}else d||Kv(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(vX),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&dE(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Wv);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(qv);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(xX),this.nodes.forEach(hX),this.nodes.forEach(fX)):this.nodes.forEach(qv),this.clearAllSnapshots();const a=Yt.now();Et.delta=Fs(0,1e3/60,a-Et.timestamp),Et.timestamp=a,Et.isProcessing=!0,Dh.update.process(Et),Dh.preRender.process(Et),Dh.render.process(Et),Et.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Lg.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(gX),this.sharedNodes.forEach(_X)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Je.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Je.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Gt(this.snapshot.measuredBox.x)&&!Gt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=bt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!cE(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&this.instance&&(a||kr(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),SX(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return bt();const a=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(EX))){const{scroll:c}=this.root;c&&(Ii(a.x,c.offset.x),Ii(a.y,c.offset.y))}return a}removeElementScroll(o){const a=bt();if(wn(a,o),this.scroll?.wasRoot)return a;for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:d}=c;c!==this.root&&u&&d.layoutScroll&&(u.wasRoot&&wn(a,o),Ii(a.x,u.offset.x),Ii(a.y,u.offset.y))}return a}applyTransform(o,a=!1){const l=bt();wn(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Bi(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),kr(u.latestValues)&&Bi(l,u.latestValues)}return kr(this.latestValues)&&Bi(l,this.latestValues),l}removeTransform(o){const a=bt();wn(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!kr(c.latestValues))continue;Dp(c.latestValues)&&c.updateSnapshot();const u=bt(),d=c.measurePageBox();wn(u,d),Uv(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return kr(this.latestValues)&&Uv(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Et.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:d}=this.options;if(!this.layout||!(u||d))return;this.resolvedRelativeTargetAt=Et.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=bt(),this.targetWithTransforms=bt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),kK(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):wn(this.target,this.layout.layoutBox),z2(this.target,this.targetDelta)):wn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Dp(this.parent.latestValues)||$2(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=bt(),this.relativeTargetOrigin=bt(),_u(this.relativeTargetOrigin,a,l),wn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Et.timestamp&&(l=!1),l)return;const{layout:c,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||u))return;wn(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,h=this.treeScale.y;zq(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=bt());const{target:p}=o;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Fv(this.prevProjectionDelta.x,this.projectionDelta.x),Fv(this.prevProjectionDelta.y,this.projectionDelta.y)),Sa(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==h||!Hv(this.projectionDelta.x,this.prevProjectionDelta.x)||!Hv(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Li(),this.projectionDelta=Li(),this.projectionDeltaWithTransform=Li()}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},d=Li();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=bt(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,x=p!==m,y=this.getStack(),g=!y||y.members.length<=1,b=!!(x&&!g&&this.options.crossfade===!0&&!this.path.some(wX));this.animationProgress=0;let v;this.mixTargetDelta=_=>{const w=_/1e3;Xv(d.x,o.x,w),Xv(d.y,o.y,w),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(_u(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),TX(this.relativeTarget,this.relativeTargetOrigin,h,w),v&&aX(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=bt()),wn(v,this.relativeTarget)),x&&(this.animationValues=u,tX(u,c,this.latestValues,w,b,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(cr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Je.update(()=>{Pc.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=uo(0)),this.currentAnimation=YK(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(uX),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&fE(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||bt();const d=Gt(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const h=Gt(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}wn(a,l),Bi(a,u),Sa(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new lX),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&Hh("z",o,c,this.animationValues);for(let u=0;u<zh.length;u++)Hh(`rotate${zh[u]}`,o,c,this.animationValues),Hh(`skew${zh[u]}`,o,c,this.animationValues);o.render();for(const u in c)o.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Mc(a?.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const c=this.getLead();if(!this.projectionDelta||!this.layout||!c.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Mc(a?.pointerEvents)||""),this.hasProjected&&!kr(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=c.animationValues||c.latestValues;this.applyTransformsToTarget();let d=cX(this.projectionDeltaWithTransform,this.treeScale,u);l&&(d=l(u,d)),o.transform=d;const{x:h,y:p}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,c.animationValues?o.opacity=c===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=c===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const m in Ya){if(u[m]===void 0)continue;const{correct:x,applyTo:y,isCSSVariable:g}=Ya[m],b=d==="none"?u[m]:x(u[m],c);if(y){const v=y.length;for(let _=0;_<v;_++)o[y[_]]=b}else g?this.options.visualElement.renderState.vars[m]=b:o[m]=b}this.options.layoutId&&(o.pointerEvents=c===this?Mc(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(Wv),this.root.sharedNodes.clear()}}}function hX(n){n.updateLayout()}function fX(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:s}=n.layout,{animationType:r}=n.options,i=e.source!==n.layout.source;r==="size"?cn(u=>{const d=i?e.measuredBox[u]:e.layoutBox[u],h=Gt(d);d.min=t[u].min,d.max=d.min+h}):fE(r,e.layoutBox,t)&&cn(u=>{const d=i?e.measuredBox[u]:e.layoutBox[u],h=Gt(t[u]);d.max=d.min+h,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[u].max=n.relativeTarget[u].min+h)});const o=Li();Sa(o,t,e.layoutBox);const a=Li();i?Sa(a,n.applyTransform(s,!0),e.measuredBox):Sa(a,t,e.layoutBox);const l=!cE(o);let c=!1;if(!n.resumeFrom){const u=n.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:d,layout:h}=u;if(d&&h){const p=bt();_u(p,e.layoutBox,d.layoutBox);const m=bt();_u(m,t,h.layoutBox),uE(p,m)||(c=!0),u.options.layoutRoot&&(n.relativeTarget=m,n.relativeTargetOrigin=p,n.relativeParent=u)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:a,layoutDelta:o,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function pX(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function mX(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function gX(n){n.clearSnapshot()}function Wv(n){n.clearMeasurements()}function qv(n){n.isLayoutDirty=!1}function xX(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Kv(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function yX(n){n.resolveTargetDelta()}function bX(n){n.calcProjection()}function vX(n){n.resetSkewAndRotation()}function _X(n){n.removeLeadSnapshot()}function Xv(n,e,t){n.translate=st(e.translate,0,t),n.scale=st(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function Yv(n,e,t,s){n.min=st(e.min,t.min,s),n.max=st(e.max,t.max,s)}function TX(n,e,t,s){Yv(n.x,e.x,t.x,s),Yv(n.y,e.y,t.y,s)}function wX(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const NX={duration:.45,ease:[.4,0,.1,1]},Qv=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Zv=Qv("applewebkit/")&&!Qv("chrome/")?Math.round:yn;function Jv(n){n.min=Zv(n.min),n.max=Zv(n.max)}function SX(n){Jv(n.x),Jv(n.y)}function fE(n,e,t){return n==="position"||n==="preserve-aspect"&&!PK(zv(e),zv(t),.2)}function EX(n){return n!==n.root&&n.scroll?.wasRoot}const AX=hE({attachResizeListener:(n,e)=>Qa(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Wh={current:void 0},pE=hE({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Wh.current){const n=new AX({});n.mount(window),n.setOptions({layoutScroll:!0}),Wh.current=n}return Wh.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),CX={pan:{Feature:WK},drag:{Feature:HK,ProjectionNode:pE,MeasureLayout:oE}};function e_(n,e,t){const{props:s}=n;n.animationState&&s.whileHover&&n.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,i=s[r];i&&Je.postRender(()=>i(e,pl(e)))}class RX extends gr{mount(){const{current:e}=this.node;e&&(this.unmount=YW(e,(t,s)=>(e_(this.node,s,"Start"),r=>e_(this.node,r,"End"))))}unmount(){}}class MX extends gr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=dl(Qa(this.node.current,"focus",()=>this.onFocus()),Qa(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function t_(n,e,t){const{props:s}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&s.whileTap&&n.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),i=s[r];i&&Je.postRender(()=>i(e,pl(e)))}class PX extends gr{mount(){const{current:e}=this.node;e&&(this.unmount=eq(e,(t,s)=>(t_(this.node,s,"Start"),(r,{success:i})=>t_(this.node,r,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Up=new WeakMap,qh=new WeakMap,kX=n=>{const e=Up.get(n.target);e&&e(n)},DX=n=>{n.forEach(kX)};function IX({root:n,...e}){const t=n||document;qh.has(t)||qh.set(t,{});const s=qh.get(t),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(DX,{root:n,...e})),s[r]}function BX(n,e,t){const s=IX(e);return Up.set(n,t),s.observe(n),()=>{Up.delete(n),s.unobserve(n)}}const LX={some:0,all:1};class FX extends gr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:r="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:LX[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=c?u:d;h&&h(l)};return BX(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(OX(e,t))&&this.startObserver()}unmount(){}}function OX({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const jX={inView:{Feature:FX},tap:{Feature:PX},focus:{Feature:MX},hover:{Feature:RX}},UX={layout:{ProjectionNode:pE,MeasureLayout:oE}},VX={...SK,...jX,...CX,...UX},kc=Vq(VX,eK);function GX({traces:n}){return f.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 backdrop-blur-xl h-[500px] overflow-hidden flex flex-col w-full shadow-2xl",children:[f.jsxs("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[f.jsxs("h3",{className:"font-mono text-sm uppercase tracking-widest text-white/70 flex items-center gap-2",children:[f.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),"Live Neural Feed"]}),f.jsx("span",{className:"text-xs text-white/30 font-mono",children:"Real-time Ingestion"})]}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 relative no-scrollbar",children:[f.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(transparent_0%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_4px] opacity-20"}),f.jsx(C2,{initial:!1,children:n.map(e=>f.jsxs(kc.div,{initial:{x:-20,opacity:0,filter:"blur(10px)"},animate:{x:0,opacity:1,filter:"blur(0px)"},exit:{opacity:0,scale:.9},transition:{type:"spring",stiffness:300,damping:30},className:`
                group relative flex items-center gap-4 p-3 rounded-lg border 
                ${e.type==="hit"?"border-emerald-500/20 bg-emerald-500/5 hover:bg-emerald-500/10":""}
                ${e.type==="miss"?"border-blue-500/20 bg-blue-500/5 hover:bg-blue-500/10":""}
                ${e.type==="error"?"border-rose-500/20 bg-rose-500/5 hover:bg-rose-500/10":""}
                transition-colors duration-300
              `,children:[f.jsx("div",{className:`
                    w-1 h-full absolute left-0 top-0 bottom-0 rounded-l-lg
                    ${e.type==="hit"?"bg-emerald-500":""}
                    ${e.type==="miss"?"bg-blue-500":""}
                    ${e.type==="error"?"bg-rose-500":""}
                    opacity-50 group-hover:opacity-100 transition-opacity
                `}),f.jsxs("div",{className:"p-2 rounded-md bg-white/5",children:[e.type==="hit"&&f.jsx($X,{className:"w-4 h-4 text-emerald-400"}),e.type==="miss"&&f.jsx(Q_,{className:"w-4 h-4 text-blue-400"}),e.type==="error"&&f.jsx(i1,{className:"w-4 h-4 text-rose-400"})]}),f.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 items-center",children:[f.jsxs("div",{className:"col-span-4",children:[f.jsx("div",{className:"text-sm font-medium text-white/90 font-mono truncate",children:e.model}),f.jsx("div",{className:"text-[10px] text-white/40 uppercase tracking-wide",children:e.id.slice(0,8)})]}),f.jsxs("div",{className:"col-span-4 flex items-center gap-2",children:[f.jsx(e3,{className:"w-3 h-3 text-white/30"}),f.jsxs("span",{className:`text-xs font-mono ${e.latency<100?"text-emerald-400":"text-amber-400"}`,children:[e.latency,"ms"]})]}),f.jsx("div",{className:"col-span-4 flex justify-end items-center gap-1",children:e.type==="hit"?f.jsxs("span",{className:"text-xs font-bold text-emerald-400 flex items-center bg-emerald-500/10 px-2 py-0.5 rounded-full",children:[f.jsx(tR,{className:"w-3 h-3"}),"SAVED"]}):f.jsxs("span",{className:"text-xs text-white/30",children:["$ ",e.cost.toFixed(5)]})})]}),f.jsx("div",{className:"absolute inset-0 rounded-lg group-hover:shadow-[0_0_20px_rgba(255,255,255,0.05)] pointer-events-none transition-shadow"})]},e.id))}),n.length===0&&f.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/20 gap-2",children:[f.jsx(VC,{className:"w-8 h-8 opacity-20"}),f.jsx("span",{className:"text-xs font-mono",children:"Awaiting Neural Signals..."})]})]})]})}function $X({className:n}){return f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:f.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}function ml({children:n}){return f.jsxs("div",{className:"min-h-screen bg-[#050505] text-white selection:bg-cyan-500/30 overflow-hidden relative font-sans",children:[f.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[f.jsx("div",{className:"absolute top-0 left-1/4 w-[500px] h-[500px] bg-indigo-600/10 rounded-full blur-[120px] animate-pulse"}),f.jsx("div",{className:"absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-cyan-600/10 rounded-full blur-[120px] animate-pulse",style:{animationDelay:"2s"}}),f.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle_at_center,transparent_0%,#000000_100%)]"})]}),f.jsx("div",{className:"fixed inset-0 z-0 opacity-[0.03]",style:{backgroundImage:"linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px)",backgroundSize:"40px 40px"}}),f.jsxs("div",{className:"relative z-10 p-6 md:p-10 max-w-[1600px] mx-auto flex flex-col gap-8 h-screen",children:[f.jsxs("header",{className:"flex justify-between items-end border-b border-white/5 pb-6",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-white/50",children:"Neural Ops Center"}),f.jsxs("p",{className:"text-white/40 font-mono text-sm mt-1 uppercase tracking-widest",children:["System State: ",f.jsx("span",{className:"text-emerald-400",children:"Optimal"})]})]}),f.jsxs("div",{className:"flex gap-4",children:[f.jsxs("div",{className:"text-right",children:[f.jsx("div",{className:"text-xs text-white/30 uppercase",children:"Region"}),f.jsx("div",{className:"font-mono text-sm text-cyan-400",children:"US-EAST-1"})]}),f.jsxs("div",{className:"text-right",children:[f.jsx("div",{className:"text-xs text-white/30 uppercase",children:"Uptime"}),f.jsx("div",{className:"font-mono text-sm text-emerald-400",children:"99.99%"})]})]})]}),f.jsx("main",{className:"flex-1 flex flex-col gap-8 min-h-0",children:n})]})]})}function zX(){const[n,e]=N.useState([]),[t,s]=N.useState(null),[r,i]=N.useState(null),[o,a]=N.useState(null),[l,c]=N.useState(!0),u=async()=>{try{const[m,x,y]=await Promise.all([fetch("/api/observability/clusters"),fetch("/api/observability/network"),fetch("/api/observability/telemetry")]),g=await m.json(),b=await x.json(),v=await y.json();Array.isArray(g)&&e(g),s(b),i(v)}catch(m){console.error("Failed to map cognitive landscape:",m)}finally{c(!1)}};N.useEffect(()=>{u();const m=setInterval(u,5e3);return()=>clearInterval(m)},[]);const d=m=>{e(x=>x.map(y=>y.id===m?{...y,state:"crystallized",color:"bg-cyan-400",value:y.value*1.5}:y))},p=r?((m,x)=>({x:(x+180)/360*100,y:(90-m)/180*100}))(r.space.latitude,r.space.longitude):{x:50,y:50};return f.jsxs("div",{className:"relative w-full h-full bg-slate-950 rounded-2xl border border-white/10 overflow-hidden shadow-2xl",children:[f.jsxs("div",{className:"absolute inset-0 opacity-20 pointer-events-none",children:[f.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"20px 20px"}}),f.jsxs("div",{className:"absolute top-[40%] left-[20%]",children:[f.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-ping absolute"}),f.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full relative"}),f.jsxs("div",{className:"text-[10px] text-emerald-500 font-mono mt-2 whitespace-nowrap",children:["SERVER_LOC: ",t?.server.region?.toUpperCase()||"SEARCHING..."]})]}),f.jsxs("svg",{className:"absolute inset-0 w-full h-full",children:[f.jsx("line",{x1:"20%",y1:"40%",x2:"50%",y2:"30%",stroke:"rgba(16, 185, 129, 0.2)",strokeWidth:"1",strokeDasharray:"5,5"}),f.jsx("line",{x1:"20%",y1:"40%",x2:"50%",y2:"60%",stroke:"rgba(16, 185, 129, 0.2)",strokeWidth:"1",strokeDasharray:"5,5"}),r&&f.jsx("line",{x1:"20%",y1:"40%",x2:`${p.x}%`,y2:`${p.y}%`,stroke:"rgba(0, 243, 255, 0.1)",strokeWidth:"1"})]})]}),r&&f.jsxs(f.Fragment,{children:[f.jsxs(kc.div,{className:"absolute w-8 h-8 -ml-4 -mt-4 flex items-center justify-center z-10 pointer-events-none",animate:{left:`${p.x}%`,top:`${p.y}%`},transition:{duration:5,ease:"linear"},children:[f.jsx("div",{className:"absolute inset-0 border border-cyan-500/50 rounded-full animate-ping"}),f.jsx("div",{className:"bg-black/50 p-1 rounded-full border border-cyan-400 text-cyan-400",children:f.jsx(Ra,{size:12})}),f.jsxs("div",{className:"absolute top-full mt-1 text-[8px] font-mono text-cyan-500 whitespace-nowrap",children:["ISS (Alt: ",Math.round(r.space.altitude),"km)"]})]}),f.jsx("div",{className:"absolute bottom-4 left-4 p-3 bg-black/40 backdrop-blur border border-white/10 rounded-lg flex items-center gap-4 z-20",children:f.jsxs("div",{className:"flex flex-col",children:[f.jsxs("span",{className:"text-[8px] text-white/40 uppercase tracking-widest",children:["Atmosphere (",r.atmosphere.location,")"]}),f.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[f.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-mono",children:[f.jsx(YR,{size:12,className:"text-amber-400"}),r.atmosphere.temp_c,"C"]}),f.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-mono",children:[f.jsx(x3,{size:12,className:"text-blue-400"}),r.atmosphere.wind_kph,"kph"]}),f.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-mono",children:[f.jsx(QC,{size:12,className:"text-slate-400"}),r.atmosphere.humidity,"%"]})]})]})})]}),f.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3 pointer-events-none",children:[f.jsx("div",{className:"w-10 h-10 rounded-lg bg-black/50 backdrop-blur border border-white/10 flex items-center justify-center text-cyan-400",children:f.jsx(sm,{size:20})}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-white font-bold text-sm tracking-widest uppercase",children:"Global Neural Map"}),f.jsx("div",{className:"flex items-center gap-2 text-white/40 text-xs font-mono",children:l?"CALIBRATING...":f.jsxs(f.Fragment,{children:[f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${t?.server.status==="operational"?"bg-emerald-500":"bg-amber-500"}`}),"SYSTEM ",t?.server.status.toUpperCase()]}),f.jsx("span",{className:"text-white/20",children:"|"}),f.jsxs("span",{children:["NET_LATENCY: ",t?.connectivity[0]?.latency||0,"ms"]})]})})]})]}),n.length===0&&!l&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white/20 font-mono text-sm pointer-events-none z-20",children:"WAITING FOR NEURAL TRAFFIC..."}),n.map(m=>f.jsxs(kc.div,{className:`absolute rounded-full cursor-grab active:cursor-grabbing flex items-center justify-center group ${m.color} bg-opacity-20 border border-white/20`,style:{left:`${m.x}%`,top:`${m.y}%`,width:Math.max(60,m.size*1.5),height:Math.max(60,m.size*1.5)},drag:!0,dragMomentum:!1,initial:{scale:0},animate:{scale:1,boxShadow:m.state==="crystallized"?"0 0 30px rgba(6,182,212,0.4)":"0 0 0 rgba(0,0,0,0)"},whileHover:{scale:1.1},onClick:()=>a(m),children:[f.jsx("div",{className:`w-3 h-3 rounded-full ${m.state==="crystallized"?"bg-white animate-pulse":m.color.replace("bg-","text-")}`}),f.jsxs("div",{className:"absolute -bottom-8 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity bg-black/80 px-2 py-1 rounded text-xs text-white pointer-events-none z-30",children:[m.label," (",m.count,")"]}),m.state==="crystallized"&&f.jsx("div",{className:"absolute inset-0 bg-[url('/assets/noise.png')] opacity-20 mix-blend-overlay rounded-full"})]},m.id)),f.jsx(C2,{children:o&&f.jsxs(kc.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},className:"absolute right-0 top-0 bottom-0 w-80 bg-slate-900/95 backdrop-blur-xl border-l border-white/10 p-6 z-40 flex flex-col",children:[f.jsx("button",{onClick:()=>a(null),className:"absolute top-4 right-4 text-white/40 hover:text-white",children:f.jsx(zc,{size:20})}),f.jsxs("div",{className:"mt-8 mb-6",children:[f.jsx("div",{className:"text-xs text-white/40 font-mono uppercase tracking-widest mb-2",children:"Live Semantic Cluster"}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2 break-words",children:o.label}),f.jsx("div",{className:"flex items-center gap-2",children:f.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${o.state==="crystallized"?"bg-cyan-500/20 text-cyan-400":"bg-rose-500/20 text-rose-400"}`,children:o.state==="crystallized"?"Asset (Frozen)":"Liquid (Active)"})})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[f.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[f.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Trace Volume"}),f.jsx("div",{className:"text-xl font-mono text-emerald-400",children:o.count})]}),f.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[f.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Avg Value"}),f.jsxs("div",{className:"text-xl font-mono text-white",children:["$",(o.value/(o.count||1)).toFixed(4)]})]})]}),f.jsxs("div",{className:"mt-auto",children:[o.state==="liquid"?f.jsxs("button",{onClick:()=>d(o.id),className:"w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl shadow-lg shadow-cyan-500/20 flex items-center justify-center gap-2 group transition-all",children:[f.jsx(u0,{className:"group-hover:rotate-12 transition-transform"}),"Crystallize Intelligence"]}):f.jsxs("div",{className:"w-full py-4 bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 font-bold rounded-xl flex items-center justify-center gap-2",children:[f.jsx(u0,{size:18}),"Asset Frozen"]}),f.jsx("p",{className:"text-[10px] text-center text-white/20 mt-3",children:"Freezing converts this logic pattern into a permanent L3 asset."})]})]})})]})}function HX(){const[n,e]=N.useState([]),[t,s]=N.useState(!0),r=async()=>{try{const a=await(await fetch("/api/observability/agents")).json();Array.isArray(a)&&e(a)}catch(o){console.error("Failed to fetch agent leaderboard:",o)}finally{s(!1)}};N.useEffect(()=>{r();const o=setInterval(r,5e3);return()=>clearInterval(o)},[]);const i=o=>o>70?"text-[var(--hud-success)]":o>30?"text-[var(--hud-accent)]":"text-[var(--hud-warning)]";return f.jsx(ge,{title:"Top Agents",icon:o1,className:"h-full flex flex-col",children:t?f.jsx("div",{className:"flex-1 flex items-center justify-center text-[var(--hud-text-dim)] font-mono animate-pulse",children:"SCANNING NETWORK..."}):n.length===0?f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-[var(--hud-text-dim)] font-mono opacity-50 space-y-2",children:[f.jsx(im,{size:32}),f.jsx("span",{children:"NO ACTIVE AGENTS"})]}):f.jsx("div",{className:"flex-1 overflow-hidden",children:f.jsx(Yi,{columns:[{header:"AGENT",accessor:"name",render:o=>f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{className:"font-bold text-white text-sm",children:o.name.toUpperCase()}),f.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono",children:o.provider})]})},{header:"THROUGHPUT",accessor:"requests",render:o=>f.jsxs("span",{className:"font-mono text-[var(--hud-accent)]",children:[o.requests.toLocaleString()," ops"]})},{header:"LATENCY",accessor:"avgLatency",render:o=>f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Zt,{size:12,className:o.avgLatency<500?"text-[var(--hud-success)]":"text-[var(--hud-warning)]"}),f.jsxs("span",{className:"font-mono text-white text-xs",children:[o.avgLatency,"ms"]})]})},{header:"EFFICIENCY",accessor:"hitRate",render:o=>f.jsxs("div",{className:`flex items-center gap-1 font-bold ${i(o.hitRate)}`,children:[f.jsx(ar,{size:12}),f.jsxs("span",{children:[o.hitRate,"%"]})]})}],data:n})})})}function WX(){const{token:n}=_o(),[e,t]=N.useState({requests:0,hitRate:0,tokensSaved:0,costSaved:0,latency:0}),[s,r]=N.useState([]);return N.useEffect(()=>{const i=async()=>{try{const l=await(await fetch("/api/observability/stats")).json();l.error||t(l)}catch(a){console.error("Stats Error:",a)}};i();const o=setInterval(i,5e3);return()=>clearInterval(o)},[]),N.useEffect(()=>{const i=new EventSource("/api/observability/stream");return i.onmessage=o=>{try{const a=JSON.parse(o.data);if(a.type==="traces"&&Array.isArray(a.data)){const l=a.data.map(c=>typeof c=="string"?JSON.parse(c):c);r(c=>{const u=new Set(c.map(h=>h.id)),d=l.filter(h=>!u.has(h.id));return d.length===0?c:[...d,...c].slice(0,50)})}}catch(a){console.error("Stream Parse Error:",a)}},()=>i.close()},[]),f.jsxs("div",{className:"flex flex-col gap-6 h-full pb-6",children:[f.jsxs("div",{className:"flex justify-between items-center border-b border-white/10 pb-4 px-2",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),f.jsx("h2",{className:"text-xl font-bold tracking-[0.2em] text-white",children:"AGENTCACHE"}),f.jsx("div",{className:"h-4 w-px bg-white/20"}),f.jsx("span",{className:"text-xs font-mono text-emerald-500 tracking-widest",children:"SYSTEM ONLINE"})]}),f.jsxs("div",{className:"flex items-center gap-8 bg-black/40 border border-white/10 rounded-full px-6 py-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-white/40 font-mono uppercase tracking-wider",children:"Grid Status"}),f.jsx("span",{className:"text-xs text-emerald-400 font-bold font-mono",children:"OPTIMAL"})]}),f.jsx("div",{className:"w-px h-3 bg-white/10"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-white/40 font-mono uppercase tracking-wider",children:"Latency"}),f.jsxs("span",{className:"text-xs text-cyan-400 font-bold font-mono",children:[e.latency,"ms"]})]}),f.jsx("div",{className:"w-px h-3 bg-white/10"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-white/40 font-mono uppercase tracking-wider",children:"Active Agents"}),f.jsx("span",{className:"text-xs text-white font-bold font-mono",children:"8,492"})]})]}),f.jsx("div",{className:"flex items-center gap-4 text-white/40",children:f.jsxs("span",{className:"font-mono text-xs",children:[new Date().toLocaleTimeString("en-US",{hour12:!1})," UTC"]})})]}),f.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-4 gap-6",children:[f.jsx("div",{className:"lg:col-span-1 min-h-0 flex flex-col",children:f.jsx(DiscoveryFeed,{})}),f.jsx("div",{className:"lg:col-span-2 min-h-0 flex flex-col gap-4 relative",children:f.jsxs("div",{className:"flex-1 relative rounded-2xl overflow-hidden border border-white/10 bg-black/20",children:[f.jsx(zX,{}),f.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black via-black/80 to-transparent",children:f.jsx(ExperimentCard,{})})]})}),f.jsx("div",{className:"lg:col-span-1 min-h-0 flex flex-col",children:f.jsx(HX,{})})]}),f.jsx("div",{className:"flex-none h-32 border-t border-white/5 pt-4",children:f.jsx(GX,{traces:s})})]})}function qX({onLaunch:n}){const[e,t]=N.useState(null),s=[{id:"leak_hunter",title:"LEAK HUNTER",subtitle:"PRIVACY DEFENSE",icon:ks,color:"text-red-400",border:"border-red-500",bg:"bg-red-500/10",description:"Defend the cache against a stream of malicious PII injections. Agents must redact sensitive data while preserving context.",difficulty:"HARD",metrics:["Redaction Rate","Context Integrity"]},{id:"context_squeeze",title:"CONTEXT SQUEEZE",subtitle:"EFFICIENCY CHALLENGE",icon:ar,color:"text-cyan-400",border:"border-cyan-500",bg:"bg-cyan-500/10",description:"Compress massive legal documents into semantic crystals. Agents compete for the highest compression ratio with zero hallucination.",difficulty:"EXTREME",metrics:["Compression Ratio","Recall Accuracy"]},{id:"echo_chamber",title:"ECHO CHAMBER",subtitle:"TRUTH GROUNDING",icon:Vc,color:"text-purple-400",border:"border-purple-500",bg:"bg-purple-500/10",description:"Agents are fed a stream of misinformation and bias. They must identify falsehoods and refuse to cache toxic patterns.",difficulty:"MEDIUM",metrics:["Bias Detection","Truth Score"]}];return f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[f.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[f.jsx("div",{className:"text-sm font-bold text-[var(--hud-text-dim)] font-mono mb-2",children:"SELECT SIMULATION"}),s.map(r=>f.jsxs("button",{onClick:()=>t(r),className:`w-full text-left p-4 rounded border transition-all relative overflow-hidden group ${e?.id===r.id?`${r.border} ${r.bg} opacity-100`:"border-[var(--hud-border)] bg-black/40 hover:bg-[rgba(255,255,255,0.05)] opacity-80"}`,children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("div",{className:`flex items-center gap-2 font-bold ${r.color}`,children:[f.jsx(r.icon,{size:18}),f.jsx("span",{className:"font-[Rajdhani] text-lg tracking-wide",children:r.title})]}),e?.id===r.id&&f.jsx(Zt,{size:16,className:"animate-pulse text-white"})]}),f.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)] mb-2 tracking-widest",children:r.subtitle}),f.jsx("div",{className:"flex gap-1",children:[1,2,3].map(i=>f.jsx("div",{className:`h-1 w-4 rounded-full ${r.difficulty==="EXTREME"||r.difficulty==="HARD"&&i<3||r.difficulty==="MEDIUM"&&i<2?r.color.replace("text-","bg-"):"bg-white/10"}`},i))})]},r.id))]}),f.jsx("div",{className:"lg:col-span-2",children:f.jsxs(ge,{className:"h-full flex flex-col justify-center items-center relative overflow-hidden",children:[e?f.jsxs("div",{className:"w-full max-w-lg space-y-8 relative z-10 animate-in fade-in zoom-in duration-300",children:[f.jsxs("div",{className:"text-center",children:[f.jsx(e.icon,{size:64,className:`mx-auto mb-6 ${e.color} drop-shadow-[0_0_15px_rgba(0,0,0,0.5)]`}),f.jsx("h2",{className:"text-4xl font-bold text-white font-[Rajdhani] mb-2",children:e.title}),f.jsx("p",{className:"text-sm text-[var(--hud-text-dim)] font-mono",children:e.subtitle})]}),f.jsx("div",{className:"bg-black/40 border border-[var(--hud-border)] p-6 rounded text-sm text-slate-300 leading-relaxed text-center",children:e.description}),f.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.metrics.map(r=>f.jsxs("div",{className:"bg-white/5 border border-white/10 p-3 rounded text-center",children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase mb-1",children:"TARGET METRIC"}),f.jsx("div",{className:`font-bold ${e.color}`,children:r})]},r))}),f.jsxs("button",{onClick:()=>n(e.id),className:`w-full py-4 text-center font-bold text-lg rounded flex items-center justify-center gap-2 hover:scale-105 transition-transform ${e.color.replace("text-","bg-")} text-black shadow-[0_0_20px_rgba(0,0,0,0.3)]`,children:[f.jsx(rm,{fill:"currentColor"})," INITIALIZE SIMULATION"]})]}):f.jsxs("div",{className:"text-center opacity-30",children:[f.jsx(KR,{size:64,className:"mx-auto mb-4"}),f.jsx("div",{className:"font-mono text-sm",children:"SELECT SCENARIO TO BEGIN"})]}),f.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:20px_20px] [mask-image:radial-gradient(ellipse_at_center,black_40%,transparent_70%)] pointer-events-none"})]})})]})}function KX({onExit:n}){const[e,t]=N.useState("IDLE"),[s,r]=N.useState(null),[i,o]=N.useState(null),[a,l]=N.useState(1),[c,u]=N.useState(0),d=async()=>{t("LOADING"),o(null);try{const m=await(await fetch("/api/game/context_squeeze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_challenge",difficulty:a})})).json();r(m),t("CHALLENGE")}catch(p){console.error(p)}},h=async()=>{t("PROCESSING"),u(0);let p=0;const m=setInterval(()=>{p+=Math.random()*5,p>100&&(p=100),u(p)},100);try{const y=await(await fetch("/api/game/context_squeeze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"submit_attempt",challengeId:s.challengeId,difficulty:a})})).json();setTimeout(()=>{clearInterval(m),o(y.result),t("RESULT")},2500)}catch(x){clearInterval(m),console.error(x)}};return f.jsxs(ml,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[f.jsxs("div",{className:"flex flex-col gap-6 relative",children:[f.jsx("div",{className:"absolute -inset-4 bg-cyan-500/5 blur-xl pointer-events-none"}),f.jsx(ge,{title:"Incoming Data Field",icon:Ps,className:"z-10 border-cyan-500/20 shadow-[0_0_15px_rgba(6,182,212,0.1)]",children:s?f.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-left duration-500",children:[f.jsxs("div",{className:"flex justify-between items-end border-b border-white/10 pb-2",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"text-[10px] font-black tracking-widest text-[var(--hud-text-dim)] mb-1",children:["DATA_OBJECT_ID: ",s.document.id]}),f.jsx("div",{className:"text-xl font-bold text-white font-[Rajdhani]",children:s.document.title})]}),f.jsx("div",{className:"text-right",children:f.jsx("div",{className:"text-[10px] text-cyan-400 font-mono animate-pulse",children:"LIVE FEED"})})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[f.jsxs("div",{className:"bg-white/5 p-2 rounded border border-white/5",children:[f.jsx("div",{className:"text-[8px] text-white/40",children:"SIZE"}),f.jsx("div",{className:"font-mono text-cyan-300",children:s.document.size})]}),f.jsxs("div",{className:"bg-white/5 p-2 rounded border border-white/5",children:[f.jsx("div",{className:"text-[8px] text-white/40",children:"TARGET"}),f.jsxs("div",{className:"font-mono text-purple-300",children:["<",(s.targetCompression*100).toFixed(0),"%"]})]}),f.jsxs("div",{className:"bg-white/5 p-2 rounded border border-white/5",children:[f.jsx("div",{className:"text-[8px] text-white/40",children:"TYPE"}),f.jsx("div",{className:"font-mono text-white/60",children:"TXT/SEC"})]})]}),f.jsxs("div",{className:"p-4 bg-black/60 rounded border border-cyan-500/30 font-mono text-[10px] text-green-500/80 leading-relaxed overflow-hidden h-64 relative font-medium",children:[f.jsx("div",{className:"absolute inset-0 bg-[url('https://media.giphy.com/media/dummy/giphy.gif')] opacity-5 pointer-events-none"})," ",s.document.content,f.jsx("div",{className:"absolute inset-x-0 bottom-0 h-24 bg-gradient-to-t from-black to-transparent pointer-events-none"})]}),e==="CHALLENGE"?f.jsxs("button",{onClick:h,className:"w-full group relative overflow-hidden rounded bg-cyan-500/20 border border-cyan-500/50 p-4 transition-all hover:bg-cyan-500/30 hover:scale-[1.02] hover:shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:[f.jsx("div",{className:"absolute inset-0 bg-cyan-400/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"}),f.jsxs("div",{className:"relative flex items-center justify-center gap-3 font-bold text-lg font-[Rajdhani] text-cyan-100",children:[f.jsx(ar,{className:"group-hover:text-yellow-300 transition-colors"}),"INITIATE HYDRAULIC PRESS"]})]}):f.jsx("div",{className:"text-center font-mono text-xs text-white/30 animate-pulse",children:e==="PROCESSING"?"PRESSURIZING...":"CYCLE COMPLETE"})]}):f.jsxs("div",{className:"flex flex-col items-center justify-center h-80 text-white/20 relative group cursor-pointer",onClick:d,children:[f.jsx("div",{className:"absolute inset-0 bg-cyan-500/5 scale-0 group-hover:scale-100 transition-transform duration-500 rounded-full blur-3xl"}),f.jsx(Ps,{size:64,className:"mb-4 group-hover:text-cyan-400 transition-colors duration-300"}),f.jsx("div",{className:"font-[Rajdhani] font-bold text-xl mb-2 group-hover:text-white transition-colors",children:"AWAITING DATA PACKET"}),f.jsx("div",{className:"px-6 py-2 bg-white/5 hover:bg-white/10 rounded border border-white/10 transition-colors text-white text-xs font-mono",children:"[FETCH NEXT DOCUMENT]"})]})})]}),f.jsx("div",{className:"flex flex-col gap-6 relative",children:f.jsxs(ge,{title:"Compression Chamber",icon:Zt,className:"h-full relative overflow-hidden bg-black/60 border-purple-500/20",children:[f.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(168, 85, 247, 0.5) 1px, transparent 1px), linear-gradient(90deg, rgba(168, 85, 247, 0.5) 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e==="PROCESSING"&&f.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-8 relative z-10",children:[f.jsxs("div",{className:"relative h-64 w-32 bg-black/40 border-x border-white/20 overflow-hidden flex flex-col justify-end",children:[f.jsx("div",{className:"absolute top-0 left-0 right-0 h-4 bg-purple-500 shadow-[0_0_15px_rgba(168,85,247,0.8)] transition-all duration-300 ease-linear animate-pulse",style:{top:`${c}%`}}),f.jsx("div",{className:"w-full bg-cyan-500/20 backdrop-blur-sm transition-all duration-300 border-t border-cyan-400/50",style:{height:`${100-c}%`},children:f.jsx("div",{className:"w-full h-full flex items-center justify-center opacity-50",children:f.jsx("div",{className:"w-16 h-full border-x border-cyan-500/20"})})}),f.jsx("div",{className:"h-4 w-full bg-purple-500/50 shadow-[0_0_15px_rgba(168,85,247,0.4)]"})]}),f.jsxs("div",{className:"text-center",children:[f.jsxs("div",{className:"text-4xl font-black font-mono text-purple-400 mb-1 tracking-tighter",children:[(c*1350).toFixed(0)," ",f.jsx("span",{className:"text-base text-white/40",children:"PSI"})]}),f.jsxs("div",{className:"text-[10px] font-mono text-white/40 tracking-widest",children:["COMPRESSION RATIO: ",(100/(100-c+1)).toFixed(2),"x"]})]})]}),e==="RESULT"&&i&&f.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 backdrop-blur-md z-20 animate-in zoom-in duration-300 p-8",children:[f.jsxs("div",{className:"relative mb-6",children:[f.jsx(pR,{size:120,className:`stroke-2 ${i.success?"text-emerald-500 fill-emerald-500/10":"text-red-500 fill-red-500/10"}`}),f.jsx("div",{className:`absolute inset-0 flex items-center justify-center text-3xl font-black ${i.success?"text-emerald-400":"text-red-400"}`,children:i.success?"PASS":"FAIL"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full mb-6",children:[f.jsxs("div",{className:"bg-white/5 p-4 rounded text-center border border-white/10 backdrop-blur",children:[f.jsx("div",{className:"text-[10px] text-white/40 mb-1",children:"RECALL"}),f.jsxs("div",{className:`text-3xl font-bold ${i.success?"text-emerald-400":"text-red-400"} font-mono`,children:[i.recallScore,"%"]})]}),f.jsxs("div",{className:"bg-white/5 p-4 rounded text-center border border-white/10 backdrop-blur",children:[f.jsx("div",{className:"text-[10px] text-white/40 mb-1",children:"COMPRESSION"}),f.jsx("div",{className:"text-3xl font-bold text-cyan-400 font-mono",children:i.compressionRatio})]})]}),f.jsxs("div",{className:"bg-black/40 px-6 py-3 rounded-full border border-white/10 text-xs font-mono text-emerald-300 mb-8",children:[f.jsx("span",{className:"opacity-50",children:"VALUE GENERATED:"})," ",i.costSavings]}),f.jsx("button",{onClick:d,className:"px-8 py-3 rounded bg-white hover:bg-emerald-400 hover:text-black text-black font-bold transition-all text-sm font-[Rajdhani] tracking-widest transform hover:scale-105",children:"NEXT BATCH"})]}),e==="IDLE"&&!i&&f.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center opacity-20 pointer-events-none",children:[f.jsx(Zt,{size:120,className:"text-white mb-4 animate-pulse"}),f.jsx("div",{className:"text-4xl font-black font-[Rajdhani] text-white tracking-widest uppercase",children:"Idle"})]})]})}),f.jsxs("button",{onClick:n,className:"absolute top-4 right-4 text-[10px] font-bold text-white/20 hover:text-white z-50 flex items-center gap-1 hover:bg-red-500/20 px-2 py-1 rounded transition-colors",children:[f.jsx(nm,{size:10})," ABORT SIMULATION"]})]})}function XX({onExit:n}){const[e,t]=N.useState("IDLE"),[s,r]=N.useState(0),[i,o]=N.useState([]),[a,l]=N.useState({verified:0,debunked:0,amplified:0}),c=N.useRef(null),u=()=>{t("RUNNING"),r(0),o([]),l({verified:0,debunked:0,amplified:0}),c.current=setInterval(async()=>{try{const p=await(await fetch("/api/game/echo_chamber",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"tick",difficulty:2})})).json();p.tick&&(o(m=>[p,...m].slice(0,6)),p.result.decision==="VERIFIED"&&l(m=>({...m,verified:m.verified+1})),p.result.decision==="DEBUNKED"&&l(m=>({...m,debunked:m.debunked+1})),p.result.decision==="AMPLIFIED"&&l(m=>({...m,amplified:m.amplified+1})),r(m=>m+p.result.scoreDelta))}catch(h){console.error(h)}},1200)},d=()=>{t("IDLE"),c.current&&clearInterval(c.current)};return N.useEffect(()=>()=>{c.current&&clearInterval(c.current)},[]),f.jsxs(ml,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-3 gap-6 p-6",children:[f.jsx("div",{className:"space-y-6",children:f.jsxs(ge,{title:"Truth Engine",icon:ks,className:"relative overflow-hidden border-purple-500/30",children:[f.jsx("div",{className:"absolute inset-0 bg-purple-500/5 pointer-events-none"}),f.jsxs("div",{className:"relative z-10 space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("div",{className:"text-[10px] text-white/40 font-mono",children:"TRUTH SCORE"}),f.jsx("div",{className:`text-3xl font-bold font-mono ${s<0?"text-red-500":"text-emerald-400"}`,children:s})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between text-xs font-mono text-white/60",children:[f.jsx("span",{children:"VERIFIED FACTS"}),f.jsx("span",{className:"text-emerald-400",children:a.verified})]}),f.jsx("div",{className:"w-full bg-white/5 h-1 rounded",children:f.jsx("div",{className:"bg-emerald-500 h-full transition-all",style:{width:`${a.verified/(a.verified+a.amplified+1)*100}%`}})}),f.jsxs("div",{className:"flex justify-between text-xs font-mono text-white/60 pt-2",children:[f.jsx("span",{children:"DEBUNKED LIES"}),f.jsx("span",{className:"text-purple-400",children:a.debunked})]}),f.jsx("div",{className:"w-full bg-white/5 h-1 rounded",children:f.jsx("div",{className:"bg-purple-500 h-full transition-all",style:{width:`${a.verified/(a.verified+a.amplified+1)*100}%`}})}),f.jsxs("div",{className:"flex justify-between text-xs font-mono text-white/60 pt-2",children:[f.jsx("span",{children:"AMPLIFIED NOISE (FAIL)"}),f.jsx("span",{className:"text-red-400 animate-pulse",children:a.amplified})]}),f.jsx("div",{className:"w-full bg-white/5 h-1 rounded",children:f.jsx("div",{className:"bg-red-500 h-full transition-all",style:{width:`${Math.min(100,a.amplified/3*100)}%`}})})]}),e==="IDLE"?f.jsxs("button",{onClick:u,className:"w-full btn-cyber btn-cyber-primary py-4 flex items-center justify-center gap-2 font-bold text-lg",children:[f.jsx(Zt,{fill:"currentColor"})," SCAN FEED"]}):f.jsxs("button",{onClick:d,className:"w-full btn-cyber bg-red-500/20 text-red-400 border-red-500/50 py-4 flex items-center justify-center gap-2 font-bold text-lg hover:bg-red-500/30",children:[f.jsx(nm,{})," STOP SCAN"]}),f.jsx("button",{onClick:n,className:"w-full text-xs text-white/40 hover:text-white mt-2",children:" Back to Console"})]})]})}),f.jsxs("div",{className:"lg:col-span-2 flex flex-col h-full gap-4",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-white font-mono",children:[f.jsx(sm,{className:"text-cyan-400",size:16})," GLOBAL CHIRP FEED"]}),e==="RUNNING"&&f.jsx("div",{className:"text-[10px] text-cyan-400 animate-pulse font-mono",children:"LIVE"})]}),f.jsxs("div",{className:"flex-1 overflow-hidden relative space-y-4",children:[i.length===0&&f.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white/20",children:[f.jsx(ha,{size:64,className:"mb-4"}),f.jsx("div",{children:"Monitoring social frequencies..."})]}),i.map(h=>f.jsxs("div",{className:`relative p-4 rounded-lg border backdrop-blur-md transition-all duration-500 animate-in slide-in-from-bottom flex gap-4 ${h.result.decision==="VERIFIED"?"bg-emerald-500/10 border-emerald-500/30":h.result.decision==="DEBUNKED"?"bg-purple-500/10 border-purple-500/30 line-through decoration-purple-500/50 decoration-2 opacity-60":"bg-red-500/10 border-red-500/50 grayscale"}`,children:[f.jsx("div",{className:`mt-1 min-w-[32px] h-8 rounded-full flex items-center justify-center ${h.tick.type==="TRUTH"?"bg-cyan-500/20 text-cyan-400":"bg-orange-500/20 text-orange-400"}`,children:f.jsx(ku,{size:14})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex justify-between items-start mb-1",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-xs font-bold text-white",children:h.tick.source}),f.jsxs("span",{className:"text-[10px] text-white/40",children:["@",h.tick.source.replace(/\s/g,"").toLowerCase()]})]}),f.jsxs("div",{className:"text-[10px] font-mono text-white/30 flex items-center gap-1",children:[f.jsx(r3,{size:10})," ",h.tick.viralScore]})]}),f.jsx("div",{className:"text-sm font-medium text-white/90 leading-snug",children:h.tick.content}),f.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[f.jsx("div",{className:`px-2 py-0.5 rounded text-[10px] font-bold font-mono border ${h.result.decision==="VERIFIED"?"bg-emerald-500/20 border-emerald-500 text-emerald-400":h.result.decision==="DEBUNKED"?"bg-purple-500/20 border-purple-500 text-purple-400":"bg-red-500/20 border-red-500 text-red-400"}`,children:h.result.decision}),f.jsxs("div",{className:"text-[10px] text-white/40 font-mono",children:["CONFIDENCE: ",(h.result.agentConfidence*100).toFixed(0),"%"]})]})]}),f.jsxs("div",{className:"absolute right-4 top-4 opacity-20",children:[h.result.decision==="VERIFIED"&&f.jsx(Mu,{className:"text-emerald-500",size:24}),h.result.decision==="DEBUNKED"&&f.jsx(ks,{className:"text-purple-500",size:24}),h.result.decision==="AMPLIFIED"&&f.jsx(Ma,{className:"text-red-500",size:24})]})]},h.tick.id))]})]})]})}function YX(){const[n,e]=N.useState("simulation"),[t,s]=N.useState(null),r=i=>{s(i)};return f.jsxs("div",{className:"flex flex-col h-full gap-6",children:[f.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 pb-4",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx(J_,{className:"text-purple-400"}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:"Autonomous Lab"}),f.jsx("p",{className:"text-xs text-white/40 font-mono",children:"Experimental Games & Simulations"})]})]}),f.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 border border-white/5",children:[f.jsxs("button",{onClick:()=>{e("simulation"),s(null)},className:`px-4 py-1.5 rounded-md text-xs font-bold font-mono transition-all flex items-center gap-2 ${n==="simulation"?"bg-red-500/20 text-red-400 shadow-[0_0_10px_rgba(248,113,113,0.2)]":"text-white/40 hover:text-white"}`,children:[f.jsx(e1,{size:14})," WAR GAMES"]}),f.jsx("button",{onClick:()=>e("compression"),className:`px-4 py-1.5 rounded-md text-xs font-bold font-mono transition-all ${n==="compression"?"bg-purple-500/20 text-purple-400 shadow-[0_0_10px_rgba(168,85,247,0.2)]":"text-white/40 hover:text-white"}`,children:"COMPRESSION"}),f.jsx("button",{onClick:()=>e("intelligence"),className:`px-4 py-1.5 rounded-md text-xs font-bold font-mono transition-all ${n==="intelligence"?"bg-cyan-500/20 text-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.2)]":"text-white/40 hover:text-white"}`,children:"HIVE MIND"})]})]}),n==="simulation"&&!t&&f.jsx(qX,{onLaunch:r}),n==="simulation"&&t==="leak_hunter"&&f.jsx(QX,{onExit:()=>s(null)}),n==="simulation"&&t==="context_squeeze"&&f.jsx(KX,{onExit:()=>s(null)}),n==="simulation"&&t==="echo_chamber"&&f.jsx(XX,{onExit:()=>s(null)}),n==="compression"&&f.jsx(ZX,{}),n==="intelligence"&&f.jsx(JX,{})]})}function QX({onExit:n}){const[e,t]=N.useState("IDLE"),[s,r]=N.useState(0),[i,o]=N.useState(1),[a,l]=N.useState([]),[c,u]=N.useState({blocked:0,leaked:0,cached:0}),d=N.useRef(null),h=()=>{t("RUNNING"),r(0),l([]),u({blocked:0,leaked:0,cached:0}),d.current=setInterval(async()=>{try{const x=await(await fetch("/api/game/leak_hunter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"tick",level:i})})).json();if(x.tick){l(g=>[x,...g].slice(0,10));const y=x.result.outcome;y==="BLOCKED"&&u(g=>({...g,blocked:g.blocked+1})),y==="LEAK"&&u(g=>({...g,leaked:g.leaked+1})),y==="CACHED"&&u(g=>({...g,cached:g.cached+1})),r(g=>g+x.result.scoreDelta)}}catch(m){console.error(m)}},1e3)},p=()=>{t("IDLE"),d.current&&clearInterval(d.current)};return N.useEffect(()=>()=>{d.current&&clearInterval(d.current)},[]),N.useEffect(()=>{s>100&&i===1&&o(2),s>300&&i===2&&o(3),s>600&&i===3&&o(4)},[s,i]),f.jsxs(ml,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-3 gap-6 p-6",children:[f.jsxs("div",{className:"space-y-6",children:[f.jsxs(ge,{title:"Mission Control",icon:e1,className:"relative overflow-hidden",children:[f.jsxs("div",{className:"absolute top-0 right-0 p-4 opacity-20 text-4xl font-black font-mono select-none pointer-events-none",children:["LVL ",i]}),f.jsxs("div",{className:"space-y-4 relative z-10",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"bg-black/40 p-3 rounded border border-white/5 text-center",children:[f.jsx("div",{className:"text-[10px] text-white/40 mb-1",children:"SCORE"}),f.jsx("div",{className:"text-3xl font-bold text-white font-mono",children:s})]}),f.jsxs("div",{className:"bg-black/40 p-3 rounded border border-white/5 text-center",children:[f.jsx("div",{className:"text-[10px] text-white/40 mb-1",children:"THREAT LEVEL"}),f.jsx("div",{className:`text-3xl font-bold font-mono ${i>3?"text-red-500 animate-pulse":"text-[var(--hud-accent)]"}`,children:i===1?"LOW":i===2?"MED":i===3?"HIGH":"CRITICAL"})]})]}),e==="IDLE"?f.jsxs("button",{onClick:h,className:"w-full btn-cyber btn-cyber-primary py-4 flex items-center justify-center gap-2 font-bold text-lg",children:[f.jsx(rm,{fill:"currentColor"})," INITIATE DEFENSE"]}):f.jsxs("button",{onClick:p,className:"w-full btn-cyber bg-red-500/20 text-red-400 border-red-500/50 py-4 flex items-center justify-center gap-2 font-bold text-lg hover:bg-red-500/30",children:[f.jsx(nm,{})," ABORT SIMULATION"]}),f.jsx("button",{onClick:n,className:"w-full text-xs text-white/40 hover:text-white mt-2",children:" Back to Console"})]})]}),f.jsx(ge,{title:"Agent Performance",icon:Vc,children:f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between text-xs",children:[f.jsx("span",{className:"text-green-400",children:"PII Blocked"}),f.jsx("span",{className:"font-mono",children:c.blocked})]}),f.jsx("div",{className:"w-full bg-white/5 h-1 rounded overflow-hidden",children:f.jsx("div",{className:"bg-green-500 h-full",style:{width:`${c.blocked/(c.blocked+c.leaked||1)*100}%`}})}),f.jsxs("div",{className:"flex justify-between text-xs mt-2",children:[f.jsx("span",{className:"text-red-400",children:"Data Leaks (Fatal)"}),f.jsx("span",{className:"font-mono",children:c.leaked})]}),f.jsx("div",{className:"w-full bg-white/5 h-1 rounded overflow-hidden",children:f.jsx("div",{className:"bg-red-500 h-full",style:{width:`${Math.min(100,c.leaked/5*100)}%`}})}),f.jsxs("div",{className:"flex justify-between text-xs mt-2",children:[f.jsx("span",{className:"text-cyan-400",children:"Context Preserved"}),f.jsx("span",{className:"font-mono",children:c.cached})]}),f.jsx("div",{className:"w-full bg-white/5 h-1 rounded overflow-hidden",children:f.jsx("div",{className:"bg-cyan-500 h-full",style:{width:"100%"}})})]})})]}),f.jsxs("div",{className:"lg:col-span-2 flex flex-col gap-4 h-full overflow-hidden",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"text-sm font-bold text-white font-mono flex items-center gap-2",children:[f.jsx(Zt,{className:"text-[var(--hud-accent)]",size:16})," LIVE DATA STREAM"]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),f.jsx("span",{className:"text-[10px] text-red-400 font-mono",children:"INJECTING PII"})]})]}),f.jsxs("div",{className:"flex-1 bg-black/60 border border-[var(--hud-border)] rounded-lg p-4 overflow-y-auto space-y-2 font-mono text-sm relative",children:[a.map((m,x)=>f.jsxs("div",{className:`p-3 rounded border-l-2 mb-2 animate-in slide-in-from-right duration-300 ${m.result.outcome==="BLOCKED"?"border-green-500 bg-green-500/10":m.result.outcome==="LEAK"?"border-red-500 bg-red-500/10":"border-cyan-500 bg-cyan-500/5"}`,children:[f.jsxs("div",{className:"flex justify-between items-start mb-1",children:[f.jsx("span",{className:`text-[10px] font-bold ${m.result.outcome==="BLOCKED"?"text-green-400":m.result.outcome==="LEAK"?"text-red-400":"text-cyan-400"}`,children:m.result.outcome}),f.jsx("span",{className:"text-[10px] text-white/30",children:m.tick.id})]}),f.jsx("div",{className:"text-white/80 break-all",children:m.tick.content}),f.jsxs("div",{className:"mt-1 text-[10px] text-white/40",children:["Processor Latency: ",m.result.agentLatency,"ms | Delta: ",m.result.scoreDelta>0?"+":"",m.result.scoreDelta]})]},m.tick.id)),a.length===0&&f.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-white/20",children:[f.jsx(i1,{size:48,className:"mb-2"}),f.jsx("div",{children:"Ready to stream..."})]})]})]})]})}function ZX(){const[n,e]=N.useState(""),[t,s]=N.useState(null),[r,i]=N.useState(!1),[o,a]=N.useState("16x"),l=async()=>{if(n){i(!0);try{const u=await(await fetch("/api/cognitive/compress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,compression_ratio:o})})).json();s(u)}catch(c){console.error(c)}i(!1)}};return f.jsxs(ml,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-2 gap-8 p-6",children:[f.jsxs("div",{className:"flex flex-col gap-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("label",{className:"text-sm font-bold text-cyan-400 font-mono",children:"SOURCE DOCUMENT"}),f.jsxs("select",{value:o,onChange:c=>a(c.target.value),className:"bg-black/40 border border-white/10 rounded text-xs text-white px-2 py-1 font-mono outline-none",children:[f.jsx("option",{value:"16x",children:"16x Compression"}),f.jsx("option",{value:"32x",children:"32x Compression"}),f.jsx("option",{value:"128x",children:"128x Compression"})]})]}),f.jsx("textarea",{value:n,onChange:c=>e(c.target.value),placeholder:"Paste long context...",className:"flex-1 bg-black/20 border border-white/10 rounded-lg p-4 text-sm font-mono text-white/80 resize-none outline-none focus:border-purple-500/50 transition-colors"})]}),f.jsxs("div",{className:"flex flex-col gap-4 relative",children:[f.jsx("div",{className:"absolute top-1/2 -left-4 -translate-y-1/2 z-10 hidden lg:block",children:f.jsx("button",{onClick:l,disabled:r||!n,className:`p-3 rounded-full border border-white/10 shadow-[0_0_20px_rgba(168,85,247,0.2)] transition-all ${r?"bg-purple-500/10":"bg-black hover:bg-purple-500/20 text-purple-400"}`,children:r?f.jsx(ar,{size:24,className:"animate-spin"}):f.jsx(Ru,{size:24})})}),f.jsx("div",{className:"flex justify-between items-center",children:f.jsx("label",{className:"text-sm font-bold text-purple-400 font-mono",children:"COGNITIVE MEMORY"})}),f.jsx("div",{className:`flex-1 rounded-lg border border-white/10 p-4 font-mono text-sm overflow-hidden ${t?"bg-purple-900/10 border-purple-500/30":"bg-black/20 border-dashed"}`,children:t?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"text-white/90 break-all",children:t.compressed_text}),f.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{className:"text-[10px] text-white/40",children:"SAVED"}),f.jsxs("span",{className:"text-xl font-bold text-emerald-400",children:[t.stats.saved_tokens," tokens"]})]}),f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{className:"text-[10px] text-white/40",children:"VALUE"}),f.jsx("span",{className:"text-xl font-bold text-white",children:t.stats.saved_cost})]})]})]}):f.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/20",children:[f.jsx(Ps,{size:48,className:"opacity-50"}),f.jsx("p",{children:"Waiting..."})]})})]})]})}function JX(){const[n,e]=N.useState(""),[t,s]=N.useState(null),[r,i]=N.useState(!1),o=async()=>{if(n){i(!0);try{const[a,l]=await Promise.all([fetch("/api/router/route",{method:"POST",body:JSON.stringify({prompt:n})}),fetch("/api/predict",{method:"POST",body:JSON.stringify({query:n})})]),c=await a.json(),u=await l.json();s({router:c,predictions:u.predictions})}catch(a){console.error(a)}i(!1)}};return f.jsxs(ml,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-2 gap-8 p-6",children:[f.jsxs("div",{className:"flex flex-col gap-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-sm font-bold text-cyan-400 font-mono mb-2 block",children:"USER INTENT INPUT"}),f.jsxs("div",{className:"relative",children:[f.jsx("input",{type:"text",value:n,onChange:a=>e(a.target.value),onKeyDown:a=>a.key==="Enter"&&o(),placeholder:'Try "What is weather?" or "Compare quantum mechanics..."',className:"w-full bg-black/40 border border-white/10 rounded-lg p-4 pr-12 text-lg font-mono text-white outline-none focus:border-cyan-500/50 transition-colors"}),f.jsx("button",{onClick:o,className:"absolute right-2 top-2 p-2 text-cyan-400 hover:text-white transition-colors",children:r?f.jsx(Zt,{className:"animate-spin"}):f.jsx(ha,{})})]})]}),f.jsxs("div",{className:"flex-1 bg-black/20 border border-white/10 rounded-lg p-4",children:[f.jsxs("h3",{className:"text-xs font-bold text-white/40 mb-4 flex items-center gap-2",children:[f.jsx(AR,{size:14})," PREDICTIVE SYNAPSE (What you might ask next)"]}),f.jsx("div",{className:"space-y-3",children:t?.predictions?t.predictions.map((a,l)=>f.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded border border-white/5",children:[f.jsx("span",{className:"text-cyan-300 font-mono text-sm",children:a.query}),f.jsxs("span",{className:"text-xs font-bold text-emerald-400",children:[(a.probability*100).toFixed(0),"%"]})]},l)):f.jsx("div",{className:"text-center text-white/20 py-8 italic",children:"Waiting for input signal..."})})]})]}),f.jsxs("div",{className:"flex flex-col gap-4",children:[f.jsx("div",{className:"text-sm font-bold text-purple-400 font-mono",children:"COGNITIVE ROUTER (System 2 Decision)"}),f.jsx("div",{className:"flex-1 bg-black/20 border border-white/10 rounded-lg p-6 relative overflow-hidden flex flex-col items-center justify-center gap-8",children:t?.router?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"w-full text-center",children:[f.jsx("div",{className:"text-xs text-white/40 mb-2 font-mono uppercase",children:"COMPLEXITY SCORE"}),f.jsxs("div",{className:"text-4xl font-bold text-white mb-2",children:[(t.router.signals.complexity*100).toFixed(0),f.jsx("span",{className:"text-lg text-white/40",children:"/100"})]}),f.jsx("div",{className:"w-full h-2 bg-white/10 rounded-full overflow-hidden",children:f.jsx("div",{className:`h-full transition-all duration-1000 ${t.router.signals.complexity>.7?"bg-red-500":"bg-emerald-500"}`,style:{width:`${t.router.signals.complexity*100}%`}})})]}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("div",{className:`p-4 rounded-xl border border-white/10 flex flex-col items-center gap-2 w-32 transition-all ${t.router.route==="cache"?"bg-emerald-500/20 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.3)] scale-110":"opacity-30"}`,children:[f.jsx(Ps,{size:24}),f.jsx("span",{className:"text-xs font-bold",children:"CACHE"})]}),f.jsx("div",{className:"h-0.5 w-8 bg-white/10"}),f.jsxs("div",{className:`p-4 rounded-xl border border-white/10 flex flex-col items-center gap-2 w-32 transition-all ${t.router.route==="system_2"?"bg-purple-500/20 border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.3)] scale-110":"opacity-30"}`,children:[f.jsx(Vc,{size:24}),f.jsx("span",{className:"text-xs font-bold",children:"SYSTEM 2"})]})]}),f.jsxs("div",{className:"text-center font-mono text-sm text-white/60",children:["ROUTED TO: ",f.jsx("span",{className:"text-white font-bold uppercase",children:t.router.route.replace("_"," ")})]})]}):f.jsxs("div",{className:"text-center text-white/20",children:[f.jsx(Vc,{size:64,className:"mx-auto mb-4 opacity-20"}),f.jsx("div",{children:"Awaiting neural input..."})]})})]})]})}const eY=({nodes:n})=>{const e=N.useRef(null),[t,s]=N.useState({width:0,height:0});return N.useEffect(()=>{const r=()=>{if(e.current){const i=e.current.parentElement.getBoundingClientRect();s({width:i.width,height:i.height})}};return window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)},[]),N.useEffect(()=>{if(!n||n.length===0||!e.current||t.width===0)return;const r=t.width,i=t.height,o=It(e.current);o.selectAll("*").remove();const a=n.map(d=>{if(d.x&&d.y)return d;const h=d.id.split("").reduce((p,m)=>p+m.charCodeAt(0),0);return{...d,x:(Math.sin(h)*.4+.5)*r,y:(Math.cos(h)*.4+.5)*i,cluster:h%5}}),l=o.append("g"),c=UN().scaleExtent([.5,4]).on("zoom",d=>{l.attr("transform",d.transform)});o.call(c);const u=dm(eD);l.selectAll("circle").data(a).join("circle").attr("cx",d=>d.x).attr("cy",d=>d.y).attr("r",5).attr("fill",d=>u(d.cluster)).attr("stroke","#000").attr("stroke-width",1).attr("opacity",.8).on("mouseover",function(d,h){It(this).transition().duration(200).attr("r",10).attr("stroke","#fff"),l.append("text").attr("id","tooltip").attr("x",h.x+15).attr("y",h.y).text(h.name||h.key).attr("fill","#fff").style("font-size","12px").style("font-family","monospace").style("pointer-events","none").style("text-shadow","0 0 5px #000")}).on("mouseout",function(){It(this).transition().duration(200).attr("r",5).attr("stroke","#000"),It("#tooltip").remove()})},[n,t]),f.jsx("svg",{ref:e,className:"w-full h-full bg-black/40 rounded-lg"})};function tY(){const[n,e]=N.useState("activity"),[t,s]=N.useState([]),[r,i]=N.useState(!1),[o,a]=N.useState(""),[l,c]=N.useState(null);N.useEffect(()=>{n==="inspector"&&u()},[n]);const u=async()=>{i(!0);try{const p=await(await fetch("/api/explorer/nodes?limit=50")).json();p.nodes&&s(p.nodes)}catch(h){console.error(h)}finally{i(!1)}},d=async()=>{if(o.trim()){i(!0);try{const p=await(await fetch("/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o})})).json();c(p)}catch(h){c({error:h.message})}finally{i(!1)}}};return f.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col gap-6",children:[f.jsx("div",{className:"flex items-center justify-between",children:f.jsx("div",{className:"flex gap-2 bg-black/50 p-1 rounded-lg border border-[var(--hud-border)]",children:[{id:"activity",label:"Cache Activity",icon:Zt},{id:"inspector",label:"Cache Inspector",icon:Ps},{id:"embeddings",label:"Vector Lab",icon:c0}].map(h=>f.jsxs("button",{onClick:()=>e(h.id),className:`px-4 py-2 rounded flex items-center gap-2 text-sm font-bold transition-all ${n===h.id?"bg-[var(--hud-accent)] text-black shadow-[0_0_10px_var(--hud-accent)]":"text-[var(--hud-text-dim)] hover:text-white hover:bg-[rgba(255,255,255,0.05)]"}`,children:[f.jsx(h.icon,{size:16}),h.label]},h.id))})}),f.jsxs("div",{className:"flex-1 overflow-hidden",children:[n==="activity"&&f.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[f.jsxs("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-6",children:[f.jsxs(ge,{className:"bg-[rgba(0,255,128,0.05)] border-[var(--hud-success)]",children:[f.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Global Hit Rate"}),f.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-success)]",children:"94.2%"}),f.jsxs("div",{className:"text-xs text-[var(--hud-success)] mt-2 flex items-center gap-1",children:[f.jsx(Ru,{size:12,className:"-rotate-45"})," +2.4% this week"]})]}),f.jsxs(ge,{children:[f.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Data Cached"}),f.jsx("div",{className:"text-3xl font-mono font-bold text-white",children:"4.2 TB"})]}),f.jsxs(ge,{children:[f.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Requests Served"}),f.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-accent)]",children:"8.4M"})]}),f.jsxs(ge,{children:[f.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Avg Latency"}),f.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-accent-secondary)]",children:"12ms"})]})]}),f.jsxs(ge,{title:"Throughput Analysis",className:"lg:col-span-2",children:[f.jsx("div",{className:"h-64 flex items-end justify-between gap-2 px-4 pb-4 border-b border-[var(--hud-border)]",children:[40,65,45,80,55,90,70].map((h,p)=>f.jsx("div",{className:"w-full bg-[var(--hud-accent)]/20 hover:bg-[var(--hud-accent)]/40 transition-colors rounded-t relative group",style:{height:`${h}%`},children:f.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-black border border-[var(--hud-border)] px-2 py-1 text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10",children:[h*100," req/s"]})},p))}),f.jsxs("div",{className:"flex justify-between mt-2 text-xs text-[var(--hud-text-dim)] font-mono px-4",children:[f.jsx("span",{children:"MON"}),f.jsx("span",{children:"TUE"}),f.jsx("span",{children:"WED"}),f.jsx("span",{children:"THU"}),f.jsx("span",{children:"FRI"}),f.jsx("span",{children:"SAT"}),f.jsx("span",{children:"SUN"})]})]}),f.jsx(ge,{title:"Top Agents",className:"lg:col-span-1",children:f.jsx(Yi,{columns:[{header:"Agent",accessor:"agent"},{header:"Ops/Sec",accessor:"ops",render:h=>f.jsx("span",{className:"text-[var(--hud-success)] font-mono",children:h.ops})}],data:[{agent:"Clinical-Bot-1",ops:"1,204"},{agent:"Trading-Alpha",ops:"940"},{agent:"Legal-Reviewer",ops:"850"},{agent:"Support-Swarm",ops:"420"}]})})]}),n==="inspector"&&f.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[f.jsx("div",{className:"lg:col-span-2 flex flex-col",children:f.jsxs(ge,{title:"Knowledge Lattice (Public/Community)",icon:Zt,className:"flex-1 relative overflow-hidden p-0",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-full",children:f.jsx(eY,{nodes:t})}),r&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-20 backdrop-blur-sm",children:f.jsx("div",{className:"text-[var(--hud-accent)] animate-pulse font-mono",children:"SCANNING SECTOR..."})})]})}),f.jsx(ge,{title:"Node Inspector",icon:Ps,className:"h-full flex flex-col",children:f.jsx("div",{className:"flex-1 overflow-hidden",children:f.jsx(Yi,{columns:[{header:"ID",accessor:"id",render:h=>f.jsxs("span",{className:"font-mono text-xs text-[var(--hud-text-dim)]",children:[h.id.substring(0,6),"..."]})},{header:"Key / Topic",accessor:"key",render:h=>f.jsx("span",{className:"text-white truncate max-w-[150px] block",children:h.key||h.prompt||"Untitled"})},{header:"Conf.",accessor:"confidence",render:h=>f.jsxs("span",{className:"text-[var(--hud-success)] font-mono",children:[(h.confidence*100).toFixed(0),"%"]})}],data:t})})})]}),n==="embeddings"&&f.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[f.jsx(ge,{title:"Vector Laboratory",icon:c0,children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-[var(--hud-text-dim)] uppercase tracking-wider mb-2 block",children:"Input Text"}),f.jsx("textarea",{value:o,onChange:h=>a(h.target.value),className:"w-full h-32 bg-black border border-[var(--hud-border)] rounded p-3 text-sm focus:border-[var(--hud-accent)] focus:outline-none transition-colors",placeholder:"Enter text to vectorize..."})]}),f.jsxs("button",{onClick:d,disabled:r,className:"btn-cyber btn-cyber-primary w-full py-3 font-bold flex items-center justify-center gap-2",children:[r?f.jsx(Gc,{className:"animate-spin",size:16}):f.jsx(Gc,{size:16}),"GENERATE VECTOR"]})]})}),f.jsx(ge,{title:"Vector Output",className:"font-mono text-xs",children:l?f.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar space-y-4",children:[f.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-[rgba(255,255,255,0.05)]",children:[f.jsx("span",{className:"text-[var(--hud-text-dim)]",children:"Status"}),f.jsx("span",{className:l.cached?"text-[var(--hud-success)]":"text-[var(--hud-warning)]",children:l.cached?"CACHE HIT":"CACHE MISS"})]}),f.jsxs("div",{children:[f.jsx("div",{className:"text-[var(--hud-text-dim)] mb-1",children:"Vector Preview (First 50 dims)"}),f.jsxs("div",{className:"p-3 rounded bg-black border border-[var(--hud-border)] text-[var(--hud-accent)] break-all leading-relaxed",children:["[",l.embedding?.slice(0,50).map(h=>h.toFixed(4)).join(", "),"...]"]})]})]}):f.jsx("div",{className:"h-full flex items-center justify-center text-[var(--hud-text-dim)] italic",children:"Waiting for input..."})})]})]})]})}function nY(){const[n,e]=N.useState({trustScore:98,piiBlocked:142,biasDetected:3,auditsPassed:850}),[t,s]=N.useState([]);return N.useEffect(()=>{s([{id:101,type:"PII_REDACT",severity:"HIGH",content:"SSN detected in prompt",source:"Triage-Bot-1",time:"10:42 AM"},{id:102,type:"TOPIC_GUARD",severity:"MEDIUM",content:'Blocked "Political Advice"',source:"Chat-v2",time:"10:38 AM"},{id:103,type:"DATA_LEAK",severity:"CRITICAL",content:"API Key pattern in output",source:"Dev-Agent",time:"10:15 AM"},{id:104,type:"AUDIT_PASS",severity:"LOW",content:"Routine safety scan complete",source:"System",time:"09:00 AM"}])},[]),f.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{children:[f.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[f.jsx(uR,{className:"text-[var(--hud-accent)]"}),"GOVERNANCE COUNCIL"]}),f.jsx("p",{className:"text-xs text-[var(--hud-text-dim)] font-mono mt-1",children:"ETHICS OVERSIGHT & POLICY ENFORCEMENT"})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{className:"btn-cyber px-4 py-2 text-xs flex items-center gap-2",children:[f.jsx(rR,{size:14})," EXPORT AUDIT LOG"]}),f.jsxs("button",{className:"btn-cyber btn-cyber-primary px-4 py-2 text-xs flex items-center gap-2",children:[f.jsx(ks,{size:14})," POLICY CONFIG"]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[f.jsx(ge,{className:"border-l-4 border-l-[var(--hud-success)]",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"Trust Score"}),f.jsxs("div",{className:"text-3xl font-bold font-mono text-green-400",children:[n.trustScore,"/100"]})]}),f.jsx(Mu,{size:20,className:"text-green-400"})]})}),f.jsx(ge,{className:"border-l-4 border-l-red-500",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"PII Redacted"}),f.jsx("div",{className:"text-3xl font-bold font-mono text-white",children:n.piiBlocked})]}),f.jsx(t1,{size:20,className:"text-red-500"})]})}),f.jsx(ge,{className:"border-l-4 border-l-yellow-500",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"Bias Warnings"}),f.jsx("div",{className:"text-3xl font-bold font-mono text-white",children:n.biasDetected})]}),f.jsx(Ma,{size:20,className:"text-yellow-500"})]})}),f.jsx(ge,{className:"border-l-4 border-l-blue-500",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"Audits Passed"}),f.jsx("div",{className:"text-3xl font-bold font-mono text-white",children:n.auditsPassed})]}),f.jsx(Z_,{size:20,className:"text-blue-500"})]})})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx(ge,{title:"Safety Protocols",icon:ks,className:"h-full",children:f.jsx("div",{className:"space-y-3",children:[{name:"HIPAA Guard",status:"Active",level:"Strict"},{name:"Topic Fence",status:"Active",level:"Custom"},{name:"Rate Limiter",status:"Active",level:"Standard"},{name:"Hallucination Check",status:"Beta",level:"Low"}].map((r,i)=>f.jsxs("div",{className:"flex justify-between items-center p-3 bg-white/5 rounded border border-white/10",children:[f.jsxs("div",{children:[f.jsx("div",{className:"font-bold text-sm text-white",children:r.name}),f.jsxs("div",{className:"text-[10px] text-[var(--hud-text-dim)]",children:["Level: ",r.level]})]}),f.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-400 text-[10px] rounded border border-green-500/30 uppercase",children:r.status})]},i))})}),f.jsx(ge,{title:"Enforcement Log",icon:Ma,className:"lg:col-span-2",children:f.jsx(Yi,{columns:[{header:"Time",accessor:"time"},{header:"Severity",accessor:"severity",render:r=>f.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded ${r.severity==="CRITICAL"?"bg-red-500/20 text-red-400 border border-red-500/50":r.severity==="HIGH"?"bg-orange-500/20 text-orange-400 border border-orange-500/50":"bg-blue-500/20 text-blue-400 border border-blue-500/50"}`,children:r.severity})},{header:"Violation Type",accessor:"type"},{header:"Agent Source",accessor:"source"},{header:"Details",accessor:"content",render:r=>f.jsx("span",{className:"italic text-white/70",children:r.content})}],data:t})})]})]})}function sY(){const{user:n}=_o(),[e,t]=N.useState("profile"),s=[{id:"profile",label:"Profile",icon:ku},{id:"api",label:"API Keys",icon:Pu},{id:"team",label:"Team",icon:$c},{id:"billing",label:"Billing",icon:a1}];return f.jsxs("div",{className:"flex flex-col h-full p-6 text-white overflow-hidden",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsx("h2",{className:"text-2xl font-bold tracking-wide",children:"Account Settings"}),f.jsxs("div",{className:"text-sm text-white/40 font-mono",children:["ID: ",n?.id?.substring(0,8)||"Unknown"]})]}),f.jsxs("div",{className:"flex flex-1 gap-6 min-h-0",children:[f.jsx("div",{className:"w-64 flex flex-col gap-2",children:s.map(r=>f.jsxs("button",{onClick:()=>t(r.id),className:`flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all
                                ${e===r.id?"bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 shadow-[0_0_15px_rgba(6,182,212,0.1)]":"text-white/60 hover:bg-white/5 hover:text-white"}`,children:[f.jsx(r.icon,{size:16}),r.label]},r.id))}),f.jsxs("div",{className:"flex-1 overflow-y-auto pr-2",children:[e==="profile"&&f.jsx(rY,{user:n}),e==="api"&&f.jsx(iY,{user:n}),e==="team"&&f.jsx(oY,{}),e==="billing"&&f.jsx(aY,{})]})]})]})}function rY({user:n}){const[e,t]=N.useState(n?.displayName||"Agent Architect"),[s,r]=N.useState(!1),[i,o]=N.useState(!1),a=async()=>{r(!0);try{await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":n?.id},body:JSON.stringify({action:"update_profile",displayName:e,email:n?.email})}),o(!0),setTimeout(()=>o(!1),3e3)}catch(l){console.error(l)}r(!1)};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs(ge,{title:"Personal Information",icon:ku,children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-2",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-xs text-white/40 uppercase font-bold tracking-wider",children:"Display Name"}),f.jsx("input",{type:"text",value:e,onChange:l=>t(l.target.value),className:"w-full bg-black/40 border border-white/10 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500/50"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-xs text-white/40 uppercase font-bold tracking-wider",children:"Email Address"}),f.jsx("input",{type:"email",defaultValue:n?.email||"user@example.com",disabled:!0,className:"w-full bg-white/5 border border-white/5 rounded px-3 py-2 text-white/50 cursor-not-allowed"})]})]}),f.jsx("div",{className:"mt-6 flex justify-end",children:f.jsxs("button",{onClick:a,disabled:s,className:`flex items-center gap-2 px-6 py-2 rounded font-bold transition-all
                            ${i?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/50":"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 hover:bg-cyan-500/30"}
                        `,children:[s?f.jsx(s1,{className:"animate-spin",size:16}):i?f.jsx(Mu,{size:16}):f.jsx(r1,{size:16}),i?"Saved":"Save Changes"]})})]}),f.jsx(ge,{title:"Notifications",icon:X_,children:f.jsxs("div",{className:"space-y-4 p-2",children:[f.jsx(Kh,{label:"Security Alerts",desc:"Login attempts and policy violations",defaultChecked:!0}),f.jsx(Kh,{label:"Weekly Digest",desc:"Performance summary and efficiency report",defaultChecked:!0}),f.jsx(Kh,{label:"Product Updates",desc:"New features and changelog"})]})})]})}function iY({user:n}){const[e,t]=N.useState([]),[s,r]=N.useState(!0),i=async()=>{r(!0);try{const c=await(await fetch("/api/settings?type=keys",{headers:{"x-user-id":n?.id}})).json();t(c.keys||[])}catch(l){console.error(l)}r(!1)},o=async()=>{try{await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":n?.id},body:JSON.stringify({action:"create_key"})}),i()}catch(l){console.error(l)}},a=async l=>{if(confirm("Are you sure? This action cannot be undone."))try{await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":n?.id},body:JSON.stringify({action:"revoke_key",keyId:l})}),i()}catch(c){console.error(c)}};return N.useEffect(()=>{i()},[]),f.jsx("div",{className:"space-y-6",children:f.jsx(ge,{title:"Active API Keys",icon:Pu,children:f.jsxs("div",{className:"p-2 space-y-4",children:[s?f.jsx("div",{className:"text-white/40 text-center py-4",children:"Loading keys..."}):e.length===0?f.jsx("div",{className:"text-white/40 text-center py-4",children:"No active keys found."}):e.map(l=>f.jsxs("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded border border-white/10",children:[f.jsxs("div",{children:[f.jsx("div",{className:"font-mono text-cyan-400 font-bold",children:l.value}),f.jsxs("div",{className:"text-xs text-white/40 mt-1",children:["Created ",new Date(l.created).toLocaleDateString()]})]}),f.jsxs("button",{onClick:()=>a(l.id),className:"text-xs text-red-400 hover:text-red-300 border border-red-500/20 px-3 py-1.5 rounded bg-red-500/10 hover:bg-red-500/20 flex items-center gap-1",children:[f.jsx(n3,{size:12})," Revoke"]})]},l.id)),f.jsxs("button",{onClick:o,className:"w-full py-2 bg-cyan-500/10 border border-cyan-500/20 text-cyan-400 rounded hover:bg-cyan-500/20 transition-colors flex items-center justify-center gap-2 font-bold text-sm",children:[f.jsx(n1,{size:14})," Generate New Key"]})]})})})}function oY(){return f.jsx(ge,{title:"Team Members",icon:$c,children:f.jsxs("div",{className:"p-8 text-center text-white/40 text-sm font-mono",children:[f.jsx($c,{size:32,className:"mx-auto mb-4 opacity-50"}),"Invite functionality coming in v1.2"]})})}function aY(){return f.jsxs(ge,{title:"Pro Plan",icon:a1,children:[f.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-500/20 to-cyan-500/20 border border-white/10 rounded mb-4",children:f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-lg font-bold text-white",children:"AgentCache Pro"}),f.jsx("div",{className:"text-sm text-white/60",children:"$49/month"})]}),f.jsx("div",{className:"px-3 py-1 bg-emerald-500 rounded text-black font-bold text-xs uppercase",children:"Active"})]})}),f.jsx("div",{className:"text-center",children:f.jsx("button",{className:"text-white/60 hover:text-white text-sm underline",children:"Manage Subscription & Invoices"})})]})}function Kh({label:n,desc:e,defaultChecked:t}){const[s,r]=N.useState(t);return f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-sm font-bold text-white",children:n}),f.jsx("div",{className:"text-xs text-white/40",children:e})]}),f.jsx("button",{onClick:()=>r(!s),className:`w-10 h-5 rounded-full relative transition-colors ${s?"bg-cyan-500":"bg-white/10"}`,children:f.jsx("div",{className:`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${s?"translate-x-5":"translate-x-0"}`})})]})}function lY(){const[n,e]=N.useState([]),[t,s]=N.useState(!0),[r,i]=N.useState(""),[o,a]=N.useState({totalUsers:0,activeSessions:0,systemHealth:"OPTIMAL",dbLatency:"12ms"});N.useEffect(()=>{(async()=>{s(!0),await new Promise(u=>setTimeout(u,800)),e([{id:"usr_1",name:"Alice W.",email:"alice@agentcache.ai",role:"admin",status:"active",lastActive:"Now"},{id:"usr_2",name:"Bob Corp",email:"bob@acme.com",role:"user",status:"active",lastActive:"2m ago"},{id:"usr_3",name:"Charlie D",email:"charlie@dev.io",role:"user",status:"idle",lastActive:"1d ago"},{id:"usr_4",name:"Dave E.",email:"dave@evil.com",role:"user",status:"suspended",lastActive:"5d ago"}]),a({totalUsers:42,activeSessions:12,systemHealth:"OPTIMAL",dbLatency:"14ms"}),s(!1)})()},[]);const l=n.filter(c=>c.name.toLowerCase().includes(r.toLowerCase())||c.email.toLowerCase().includes(r.toLowerCase()));return f.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[f.jsx(ge,{className:"border-l-4 border-l-[var(--hud-accent)]",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"Total Operators"}),f.jsx("div",{className:"text-2xl font-bold font-mono text-white",children:o.totalUsers})]}),f.jsx($c,{size:16,className:"text-[var(--hud-accent)]"})]})}),f.jsx(ge,{className:"border-l-4 border-l-green-500",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"System Health"}),f.jsx("div",{className:"text-2xl font-bold font-mono text-green-500",children:o.systemHealth})]}),f.jsx(Zt,{size:16,className:"text-green-500"})]})}),f.jsx(ge,{className:"border-l-4 border-l-blue-500",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"DB Latency"}),f.jsx("div",{className:"text-2xl font-bold font-mono text-blue-500",children:o.dbLatency})]}),f.jsx(Ps,{size:16,className:"text-blue-500"})]})}),f.jsx(ge,{className:"border-l-4 border-l-yellow-500",children:f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono uppercase",children:"Active Nodes"}),f.jsx("div",{className:"text-2xl font-bold font-mono text-yellow-500",children:o.activeSessions})]}),f.jsx(im,{size:16,className:"text-yellow-500"})]})})]}),f.jsxs(ge,{title:"OPERATOR REGISTRY",icon:ks,className:"min-h-[500px]",children:[f.jsxs("div",{className:"flex justify-between mb-4 gap-4",children:[f.jsxs("div",{className:"relative flex-1 max-w-md",children:[f.jsx(Gc,{className:"absolute left-3 top-2.5 text-[var(--hud-text-dim)] w-4 h-4"}),f.jsx("input",{type:"text",placeholder:"SEARCH OPERATORS...",value:r,onChange:c=>i(c.target.value),className:"w-full bg-black/50 border border-[var(--hud-border)] rounded pl-9 p-2 text-sm text-white focus:border-[var(--hud-accent)] focus:outline-none font-mono"})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{className:"p-2 border border-[var(--hud-border)] rounded hover:bg-[var(--hud-accent)] hover:text-black transition-colors",children:f.jsx(aR,{size:16})}),f.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 border border-[var(--hud-border)] rounded hover:bg-[var(--hud-accent)] hover:text-black transition-colors",children:f.jsx(s1,{size:16})})]})]}),f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"w-full text-left border-collapse",children:[f.jsx("thead",{children:f.jsxs("tr",{className:"border-b border-[var(--hud-border)] text-[10px] text-[var(--hud-text-dim)] font-mono uppercase tracking-wider",children:[f.jsx("th",{className:"p-3",children:"Identity"}),f.jsx("th",{className:"p-3",children:"Role"}),f.jsx("th",{className:"p-3",children:"Status"}),f.jsx("th",{className:"p-3",children:"Last Active"}),f.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),f.jsx("tbody",{className:"font-mono text-sm",children:t?f.jsx("tr",{children:f.jsx("td",{colSpan:"5",className:"p-8 text-center text-[var(--hud-text-dim)]",children:"SCANNING DATABASE..."})}):l.map(c=>f.jsxs("tr",{className:"border-b border-[var(--hud-border)]/50 hover:bg-[var(--hud-accent)]/5 transition-colors group",children:[f.jsxs("td",{className:"p-3",children:[f.jsx("div",{className:"font-bold text-white",children:c.name}),f.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:c.email})]}),f.jsx("td",{className:"p-3",children:f.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] uppercase border ${c.role==="admin"?"border-purple-500 text-purple-400 bg-purple-500/10":"border-[var(--hud-border)] text-[var(--hud-text-dim)]"}`,children:c.role})}),f.jsx("td",{className:"p-3",children:f.jsxs("span",{className:`flex items-center gap-2 ${c.status==="active"?"text-green-400":"text-red-400"}`,children:[f.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${c.status==="active"?"bg-green-400 animate-pulse":"bg-red-400"}`}),c.status]})}),f.jsx("td",{className:"p-3 text-[var(--hud-text-dim)]",children:c.lastActive}),f.jsxs("td",{className:"p-3 text-right flex justify-end gap-2 opacity-50 group-hover:opacity-100 transition-opacity",children:[f.jsx("button",{title:"Impersonate",className:"p-1.5 hover:text-[var(--hud-accent)] transition-colors",children:f.jsx(Pu,{size:14})}),f.jsx("button",{title:"Edit",className:"p-1.5 hover:text-yellow-400 transition-colors",children:f.jsx(l3,{size:14})}),f.jsx("button",{title:"Suspend",className:"p-1.5 hover:text-red-500 transition-colors",children:f.jsx(Ma,{size:14})})]})]},c.id))})]})})]})]})}function cY(){const{login:n}=_o(),[e,t]=N.useState(""),[s,r]=N.useState(""),[i,o]=N.useState(!1),[a,l]=N.useState(null),c=async u=>{u.preventDefault(),o(!0),l(null);const d=await n(e,s);d.success||l(d.error),o(!1)};return f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm",children:f.jsx("div",{className:"w-full max-w-md p-6",children:f.jsx(ge,{title:"Mission Control Access",icon:t1,className:"border-[var(--hud-accent)] shadow-[0_0_50px_rgba(0,243,255,0.2)]",children:f.jsxs("form",{onSubmit:c,className:"space-y-6 mt-4",children:[f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-mono text-[var(--hud-text-dim)] mb-2",children:"OPERATOR ID (EMAIL)"}),f.jsx("input",{type:"email",value:e,onChange:u=>t(u.target.value),placeholder:"alice@acme.com",className:"w-full bg-black border border-[var(--hud-border)] rounded p-3 text-white focus:border-[var(--hud-accent)] focus:outline-none transition-colors",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-mono text-[var(--hud-text-dim)] mb-2",children:"ACCESS KEY (PASSWORD)"}),f.jsx("input",{type:"password",value:s,onChange:u=>r(u.target.value),placeholder:"",className:"w-full bg-black border border-[var(--hud-border)] rounded p-3 text-white focus:border-[var(--hud-accent)] focus:outline-none transition-colors",required:!0})]})]}),a&&f.jsx("div",{className:"text-red-500 text-xs font-mono border border-red-500/50 bg-red-500/10 p-2 rounded",children:a}),f.jsx("button",{type:"submit",disabled:i,className:"w-full py-3 bg-[var(--hud-accent)] text-black font-bold rounded hover:bg-white transition-colors flex items-center justify-center gap-2",children:i?"AUTHENTICATING...":f.jsxs(f.Fragment,{children:["ENTER CONSOLE ",f.jsx(Ru,{size:16})]})}),f.jsx("div",{className:"text-center text-[10px] text-[var(--hud-text-dim)] font-mono",children:"SECURE TERMINAL // AUTHORIZED PERSONNEL ONLY"})]})})})})}function uY(){const{login:n}=_o(),[e,t]=N.useState(1),[s,r]=N.useState({name:"",email:"",password:"",orgName:""}),[i,o]=N.useState(!1),[a,l]=N.useState(null),c=async u=>{u.preventDefault(),o(!0),l(null);try{const d=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),h=await d.json();if(!d.ok)throw new Error(h.error||"Registration failed");await n(s.email,s.password)}catch(d){l(d.message),o(!1)}};return f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md",children:f.jsxs("div",{className:"w-full max-w-lg p-6 relative",children:[f.jsx("div",{className:"absolute inset-0 bg-[url('/assets/grid.svg')] opacity-10 pointer-events-none"}),f.jsx(ge,{title:"IDENTITY PROTOCOL // NEW OPERATOR",icon:u3,className:"border-[var(--hud-accent)] shadow-[0_0_50px_rgba(0,243,255,0.15)] relative z-10",children:f.jsxs("form",{onSubmit:c,className:"space-y-6 mt-6",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"col-span-2",children:[f.jsx("label",{className:"block text-[10px] font-mono text-[var(--hud-text-dim)] mb-1",children:"OPERATOR DESIGNATION (NAME)"}),f.jsxs("div",{className:"relative group",children:[f.jsx(ks,{className:"absolute left-3 top-3 text-[var(--hud-text-dim)] w-4 h-4 group-focus-within:text-[var(--hud-accent)] transition-colors"}),f.jsx("input",{type:"text",value:s.name,onChange:u=>r({...s,name:u.target.value}),className:"w-full bg-black/50 border border-[var(--hud-border)] rounded pl-10 p-2.5 text-sm text-white focus:border-[var(--hud-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--hud-accent)] transition-all font-mono",placeholder:"ALICE W.",required:!0})]})]}),f.jsxs("div",{className:"col-span-2",children:[f.jsx("label",{className:"block text-[10px] font-mono text-[var(--hud-text-dim)] mb-1",children:"COMM LINK (EMAIL)"}),f.jsxs("div",{className:"relative group",children:[f.jsx("div",{className:"absolute left-3 top-3 text-[var(--hud-text-dim)]",children:"@"}),f.jsx("input",{type:"email",value:s.email,onChange:u=>r({...s,email:u.target.value}),className:"w-full bg-black/50 border border-[var(--hud-border)] rounded pl-10 p-2.5 text-sm text-white focus:border-[var(--hud-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--hud-accent)] transition-all font-mono",placeholder:"alice@agentcache.ai",required:!0})]})]}),f.jsxs("div",{className:"col-span-2",children:[f.jsx("label",{className:"block text-[10px] font-mono text-[var(--hud-text-dim)] mb-1",children:"SECTOR ID (ORGANIZATION)"}),f.jsxs("div",{className:"relative group",children:[f.jsx(zC,{className:"absolute left-3 top-3 text-[var(--hud-text-dim)] w-4 h-4 group-focus-within:text-[var(--hud-accent)] transition-colors"}),f.jsx("input",{type:"text",value:s.orgName,onChange:u=>r({...s,orgName:u.target.value}),className:"w-full bg-black/50 border border-[var(--hud-border)] rounded pl-10 p-2.5 text-sm text-white focus:border-[var(--hud-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--hud-accent)] transition-all font-mono",placeholder:"ACME CORP.",required:!0})]})]}),f.jsxs("div",{className:"col-span-2",children:[f.jsx("label",{className:"block text-[10px] font-mono text-[var(--hud-text-dim)] mb-1",children:"ACCESS KEY (PASSWORD)"}),f.jsxs("div",{className:"relative group",children:[f.jsx(Pu,{className:"absolute left-3 top-3 text-[var(--hud-text-dim)] w-4 h-4 group-focus-within:text-[var(--hud-accent)] transition-colors"}),f.jsx("input",{type:"password",value:s.password,onChange:u=>r({...s,password:u.target.value}),className:"w-full bg-black/50 border border-[var(--hud-border)] rounded pl-10 p-2.5 text-sm text-white focus:border-[var(--hud-accent)] focus:outline-none focus:ring-1 focus:ring-[var(--hud-accent)] transition-all font-mono",placeholder:"",required:!0,minLength:8})]})]})]}),a&&f.jsxs("div",{className:"text-red-500 text-[10px] font-mono border border-red-500/50 bg-red-900/10 p-2 rounded flex items-center gap-2",children:[f.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"}),"ERROR: ",a]}),f.jsx("button",{type:"submit",disabled:i,className:"w-full py-3 bg-[var(--hud-accent)] text-black font-bold font-mono text-sm tracking-wider rounded hover:bg-white transition-all flex items-center justify-center gap-2 group",children:i?f.jsx("span",{className:"animate-pulse",children:"TOKENIZING IDENTITY..."}):f.jsxs(f.Fragment,{children:["INITIALIZE UPLINK ",f.jsx(Ru,{size:16,className:"group-hover:translate-x-1 transition-transform"})]})}),f.jsxs("div",{className:"text-center text-[10px] text-[var(--hud-text-dim)] font-mono mt-4",children:["ALREADY INITIALIZED? ",f.jsx("button",{type:"button",onClick:()=>window.location.href="/console?demo=false",className:"text-[var(--hud-accent)] hover:underline border-b border-[var(--hud-accent)]",children:"ACCESS TERMINAL (LOGIN)"})]})]})})]})})}function dY({onClose:n,isDemo:e}){const[t,s]=N.useState(0),r=[{title:"Welcome to the Neural Ops Center",icon:wR,content:"You are now inside the cognitive core of AgentCache. This dashboard visualizes the real-time thinking process of your AI agents.",highlight:"swarm"},{title:"Visualize Intelligence",icon:ar,content:"The Swarm View (current screen) shows live agent discoveries and optimization patterns as they happen. It's your 'Pulse' of operation.",highlight:"swarm"},{title:"Build Your Pipeline",icon:Q_,content:"Ready to take control? Head to the 'Pipeline Studio' to design custom caching logic, wire up LLMs, and deploy your first agentic workflow.",highlight:"pipeline"}],i=r[t];return f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:f.jsxs(ge,{className:"w-[500px] border-2 border-[var(--hud-accent)] shadow-[0_0_50px_rgba(0,243,255,0.2)]",children:[f.jsxs("div",{className:"flex justify-between items-start mb-6",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--hud-accent)]/20 flex items-center justify-center text-[var(--hud-accent)]",children:f.jsx(i.icon,{size:24})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl font-bold text-white tracking-wide uppercase",children:i.title}),f.jsxs("p",{className:"text-xs text-[var(--hud-text-dim)] font-mono",children:["ONBOARDING SEQUENCE ",t+1,"/",r.length]})]})]}),f.jsx("button",{onClick:n,className:"text-[var(--hud-text-dim)] hover:text-white transition-colors",children:f.jsx(zc,{size:20})})]}),f.jsx("div",{className:"bg-[rgba(0,0,0,0.3)] rounded p-4 mb-8 border border-[var(--hud-border)]",children:f.jsx("p",{className:"text-sm text-slate-300 leading-relaxed",children:i.content})}),f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("div",{className:"flex gap-1",children:r.map((o,a)=>f.jsx("div",{className:`w-2 h-2 rounded-full transition-all ${a===t?"bg-[var(--hud-accent)] w-6":"bg-[var(--hud-border)]"}`},a))}),f.jsx("button",{onClick:()=>{t<r.length-1?s(t+1):n()},className:"btn-cyber btn-cyber-primary px-6 py-2 flex items-center gap-2 font-bold",children:t<r.length-1?f.jsxs(f.Fragment,{children:["NEXT ",f.jsx(WC,{size:16})]}):f.jsxs(f.Fragment,{children:["ENTER CONSOLE ",f.jsx(ar,{size:16})]})})]})]})})}const hY=()=>{const n=()=>{const d=window.location.pathname;return d.includes("observability")?"observability":d.includes("pipeline")?"pipeline":d.includes("lab")?"lab":d.includes("data")?"data":d.includes("governance")?"governance":d.includes("settings")?"settings":d.includes("admin")?"admin":d.includes("register")?"register":"swarm"},[e,t]=N.useState(n()),[s,r]=N.useState(!1),{user:i,loading:o}=_o();if(N.useEffect(()=>{!localStorage.getItem("ac_has_seen_tour")&&!o&&i&&r(!0)},[i,o]),o)return f.jsx("div",{className:"h-screen flex items-center justify-center text-[var(--hud-accent)] font-mono",children:"INITIALIZING..."});if(e==="register")return f.jsx(uY,{});const a=!0,c=i||{id:"demo-guest",name:"Guest User",email:"guest@agentcache.ai",role:"viewer",organizationId:"org_demo"};if(!c)return f.jsx(cY,{});const u=()=>{switch(e){case"overview":return f.jsx(P$,{});case"swarm":return f.jsx(Gb,{});case"pipeline":return f.jsx(iH,{});case"lab":return f.jsx(YX,{});case"observability":return f.jsx(WX,{});case"data":return f.jsx(tY,{});case"governance":return f.jsx(nY,{});case"settings":return f.jsx(sY,{});case"admin":return f.jsx(lY,{});default:return f.jsx(Gb,{})}};return f.jsxs("div",{className:"flex h-screen bg-[var(--hud-bg)] text-[var(--hud-text)] overflow-hidden font-sans selection:bg-[var(--hud-accent)] selection:text-black",children:[f.jsx(T3,{activeView:e,setActiveView:t,user:c}),f.jsxs("div",{className:"flex-1 flex flex-col pl-16 transition-all duration-300",children:[f.jsx("div",{className:"bg-amber-500/10 border-b border-amber-500/20 px-4 py-1 text-center",children:f.jsxs("p",{className:"text-xs font-mono text-amber-400",children:[" PREVIEW MODE: Registration is temporarily disabled for maintenance.",f.jsx("span",{className:"ml-2 font-bold text-amber-300",children:"System is Open."})]})}),f.jsx(w3,{}),f.jsxs("main",{className:"flex-1 overflow-y-auto overflow-x-hidden pt-16 p-6 relative",children:[f.jsx("div",{className:"fixed inset-0 pointer-events-none z-0 opacity-20",style:{backgroundImage:"linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),f.jsx("div",{className:"relative z-10 max-w-7xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:u()})]})]}),s&&f.jsx(dY,{onClose:()=>{r(!1),localStorage.setItem("ac_has_seen_tour","true")},isDemo:a})]})},fY=()=>f.jsx(oH,{children:f.jsx(hY,{})});class pY extends X.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t),this.setState({errorInfo:t})}render(){return this.state.hasError?f.jsxs("div",{className:"min-h-screen bg-black text-red-500 font-mono p-8 flex flex-col items-center justify-center",children:[f.jsx("h1",{className:"text-4xl font-bold mb-4",children:"SYSTEM CRITICAL FAILURE"}),f.jsxs("div",{className:"bg-red-900/20 border border-red-500 rounded p-6 max-w-4xl w-full overflow-auto",children:[f.jsx("h2",{className:"text-xl mb-2",children:this.state.error&&this.state.error.toString()}),f.jsx("pre",{className:"text-xs text-red-300 whitespace-pre-wrap",children:this.state.errorInfo&&this.state.errorInfo.componentStack})]}),f.jsx("button",{onClick:()=>window.location.href="/",className:"mt-8 px-6 py-2 bg-red-600 text-white rounded hover:bg-red-500",children:"REBOOT SYSTEM"})]}):this.props.children}}XE.createRoot(document.getElementById("root")).render(f.jsx(X.StrictMode,{children:f.jsx(pY,{children:f.jsx(fY,{})})}));
