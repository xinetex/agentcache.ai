import"./modulepreload-polyfill-B5Qt9EMX.js";import{j as a,r as N,R as Mt,a as ln}from"./client-BeBNXGLe.js";/* empty css              */function cn({activeView:e,onViewChange:t}){const n=[{id:"overview",label:"Overview",icon:"ðŸ“Š"},{id:"pipelines",label:"Pipelines",icon:"âš¡"},{id:"swarm",label:"Swarm",icon:"ðŸŒŒ"},{id:"data",label:"Data Explorer",icon:"ðŸ’¾"},{id:"governance",label:"Governance",icon:"âš–ï¸"}];return a.jsxs("div",{className:"w-64 bg-slate-900 border-r border-slate-800 flex flex-col",children:[a.jsxs("div",{className:"p-6 border-b border-slate-800",children:[a.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-green-400 to-cyan-400 bg-clip-text text-transparent",children:"AgentCache"}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Mission Control"})]}),a.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[n.map(r=>a.jsxs("button",{onClick:()=>t(r.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${e===r.id?"bg-green-500/10 text-green-400 border border-green-500/20":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[a.jsx("span",{children:r.icon}),r.label]},r.id)),a.jsxs("button",{onClick:()=>t("lab"),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ${e==="lab"?"bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 shadow-[0_0_10px_rgba(6,182,212,0.1)]":"text-slate-400 hover:text-slate-100 hover:bg-slate-800/50"}`,children:[a.jsx("span",{className:"text-lg",children:"ðŸ§¬"}),"Lab"]}),a.jsxs("button",{onClick:()=>t("observability"),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ${e==="observability"?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 shadow-[0_0_10px_rgba(16,185,129,0.1)]":"text-slate-400 hover:text-slate-100 hover:bg-slate-800/50"}`,children:[a.jsx("span",{className:"text-lg",children:"ðŸ‘ï¸"}),"Observability"]}),a.jsx("div",{className:"my-4 border-t border-slate-800/50"}),a.jsxs("button",{onClick:()=>t("governance"),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ${e==="governance"?"bg-purple-500/10 text-purple-400 border border-purple-500/20 shadow-[0_0_10px_rgba(168,85,247,0.1)]":"text-slate-400 hover:text-slate-100 hover:bg-slate-800/50"}`,children:[a.jsx("span",{className:"text-lg",children:"âš–ï¸"}),"Governance"]})]}),a.jsx("div",{className:"p-4 border-t border-slate-800",children:a.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-xs font-bold text-white",children:"AC"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-white",children:"Admin"}),a.jsx("div",{className:"text-xs text-slate-500",children:"Pro Plan"})]})]})})]})}function at(){const[e,t]=N.useState(null),[n,r]=N.useState(!0);return N.useEffect(()=>{const i=async()=>{try{const o=localStorage.getItem("ac_api_key");if(!o)return;const c=await fetch("/api/stats",{headers:{"X-API-Key":o}});if(c.ok){const u=await c.json();t(u)}}catch(o){console.error(o)}finally{r(!1)}};i();const s=setInterval(i,5e3);return()=>clearInterval(s)},[]),n?a.jsx("div",{className:"p-8 text-slate-400",children:"Loading stats..."}):a.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[a.jsxs("header",{className:"mb-8",children:[a.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Overview"}),a.jsx("p",{className:"text-slate-400",children:"Real-time platform metrics"})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 flex flex-col items-center justify-center relative overflow-hidden",children:[a.jsx("h3",{className:"text-slate-400 text-sm font-medium absolute top-6 left-6",children:"Cache Hit Rate"}),a.jsxs("div",{className:"relative w-48 h-24 mt-8",children:[a.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 200 100",children:[a.jsx("path",{d:"M 20 100 A 80 80 0 0 1 180 100",fill:"none",stroke:"#1e293b",strokeWidth:"20",strokeLinecap:"round"}),a.jsx("path",{d:"M 20 100 A 80 80 0 0 1 180 100",fill:"none",stroke:"#4ade80",strokeWidth:"20",strokeLinecap:"round",strokeDasharray:"251.2",strokeDashoffset:251.2*(1-(e?.hitRate||0)/100),className:"transition-all duration-1000 ease-out"})]}),a.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 text-center",children:a.jsxs("div",{className:"text-4xl font-bold text-white",children:[e?.hitRate||0,"%"]})})]}),a.jsxs("div",{className:"mt-4 text-xs text-slate-500",children:[e?.hits||0," hits / ",e?.misses||0," misses"]})]}),a.jsxs("div",{className:"lg:col-span-2 bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsx("h3",{className:"text-slate-400 text-sm font-medium mb-4",children:"Request Traffic (24h)"}),a.jsx("div",{className:"h-48 w-full flex items-end gap-1",children:[...Array(24)].map((i,s)=>{const o=Math.random()*80+20;return a.jsx("div",{className:"flex-1 bg-slate-800 hover:bg-cyan-500/50 transition-colors rounded-t-sm relative group",style:{height:`${o}%`},children:a.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-slate-900 text-xs text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10 border border-slate-700",children:[Math.floor(o*10)," reqs"]})},s)})}),a.jsxs("div",{className:"flex justify-between text-xs text-slate-600 mt-2",children:[a.jsx("span",{children:"24h ago"}),a.jsx("span",{children:"12h ago"}),a.jsx("span",{children:"Now"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsx(Re,{label:"Requests Today",value:e?.requestsToday||0,sub:`${(e?.monthlyQuota||1e4)-(e?.used||0)} remaining`,icon:"ðŸ“‰"}),a.jsx(Re,{label:"Money Saved",value:`$${(e?.costSaved||0).toFixed(2)}`,valueColor:"text-green-400",sub:"This month",icon:"ðŸ’°"}),a.jsx(Re,{label:"Avg Latency",value:`${e?.avgLatency||0}ms`,valueColor:"text-cyan-400",sub:`P95: ${e?.latencyP95||0}ms`,icon:"âš¡"})]}),a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Cache Freshness Distribution"}),a.jsxs("div",{className:"flex h-4 rounded-full overflow-hidden mb-4",children:[a.jsx("div",{className:"bg-green-500 h-full transition-all duration-500",style:{width:`${(e?.freshness?.fresh||0)/((e?.freshness?.fresh||1)+(e?.freshness?.stale||0)+(e?.freshness?.expired||0))*100}%`}}),a.jsx("div",{className:"bg-yellow-500 h-full transition-all duration-500",style:{width:`${(e?.freshness?.stale||0)/((e?.freshness?.fresh||1)+(e?.freshness?.stale||0)+(e?.freshness?.expired||0))*100}%`}}),a.jsx("div",{className:"bg-red-500 h-full transition-all duration-500",style:{width:`${(e?.freshness?.expired||0)/((e?.freshness?.fresh||1)+(e?.freshness?.stale||0)+(e?.freshness?.expired||0))*100}%`}})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-bold text-green-500",children:e?.freshness?.fresh||0}),a.jsx("div",{className:"text-xs text-slate-400",children:"Fresh"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:e?.freshness?.stale||0}),a.jsx("div",{className:"text-xs text-slate-400",children:"Stale"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-bold text-red-500",children:e?.freshness?.expired||0}),a.jsx("div",{className:"text-xs text-slate-400",children:"Expired"})]})]})]})]})}function Re({label:e,value:t,sub:n,valueColor:r="text-white",icon:i}){return a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 relative overflow-hidden group hover:border-slate-700 transition-colors",children:[a.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity text-4xl grayscale",children:i}),a.jsx("div",{className:"text-sm text-slate-400 mb-2",children:e}),a.jsx("div",{className:`text-3xl font-bold mb-1 ${r}`,children:t}),a.jsx("div",{className:"text-xs text-slate-500",children:n})]})}function un(){const[e,t]=N.useState([]),[n,r]=N.useState([]),[i,s]=N.useState(null);return N.useEffect(()=>{t([{rank:1,name:"Alpha-Zero-Cache",score:9850,sector:"Finance"},{rank:2,name:"Medi-Bot-V9",score:8720,sector:"Healthcare"},{rank:3,name:"Deep-Seeker",score:8100,sector:"Research"}]);const o=setInterval(()=>{const c={id:Date.now(),agent:["Alpha","Beta","Gamma"][Math.floor(Math.random()*3)],pattern:"L1-L3-Hybrid",improvement:Math.floor(Math.random()*20)+5,time:new Date().toLocaleTimeString()};r(u=>[c,...u].slice(0,5))},5e3);return s({status:"Running Experiment #8492",progress:45,target:"Optimize Latency (Healthcare)"}),()=>clearInterval(o)},[]),a.jsxs("div",{className:"relative w-full h-full bg-black overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 z-0",children:a.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-800",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-6xl animate-pulse",children:"ðŸŒŒ"}),a.jsx("p",{className:"mt-4",children:"Neural Galaxy Visualization"})]})})}),a.jsx("div",{className:"absolute top-6 left-6 z-10 w-80",children:a.jsxs("div",{className:"bg-slate-900/80 backdrop-blur border border-slate-700/50 rounded-xl p-4",children:[a.jsxs("h3",{className:"text-xs font-bold text-sky-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[a.jsx("span",{className:"animate-pulse",children:"â—"})," Live Discoveries"]}),a.jsxs("div",{className:"space-y-3",children:[n.map(o=>a.jsxs("div",{className:"text-xs border-l-2 border-emerald-500 pl-3 animate-in slide-in-from-left duration-500",children:[a.jsxs("div",{className:"text-slate-300 font-medium",children:[o.agent," found pattern"]}),a.jsxs("div",{className:"text-emerald-400",children:["+",o.improvement,"% Efficiency"]}),a.jsx("div",{className:"text-slate-600 text-[10px]",children:o.time})]},o.id)),n.length===0&&a.jsx("div",{className:"text-slate-500 text-xs italic",children:"Listening for signals..."})]})]})}),a.jsx("div",{className:"absolute top-6 right-6 z-10 w-64",children:a.jsxs("div",{className:"bg-slate-900/80 backdrop-blur border border-slate-700/50 rounded-xl p-4",children:[a.jsx("h3",{className:"text-xs font-bold text-amber-400 uppercase tracking-wider mb-3",children:"ðŸ† Top Agents"}),a.jsx("div",{className:"space-y-2",children:e.map(o=>a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"font-mono text-slate-500",children:["#",o.rank]}),a.jsx("span",{className:"text-slate-200",children:o.name})]}),a.jsx("span",{className:"font-mono text-amber-500",children:o.score})]},o.rank))})]})}),a.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-10 w-96",children:a.jsxs("div",{className:"bg-slate-900/80 backdrop-blur border border-slate-700/50 rounded-xl p-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-xs font-bold text-slate-400",children:"ACTIVE EXPERIMENT"}),a.jsx("span",{className:"text-xs font-mono text-sky-400",children:"RUNNING"})]}),a.jsx("div",{className:"text-sm font-medium text-white mb-3",children:i?.target}),a.jsx("div",{className:"h-1.5 bg-slate-800 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-gradient-to-r from-sky-500 to-emerald-500 transition-all duration-1000",style:{width:`${i?.progress}%`}})}),a.jsxs("div",{className:"flex justify-between mt-1 text-[10px] text-slate-500 font-mono",children:[a.jsx("span",{children:"STEP 4/10"}),a.jsxs("span",{children:[i?.progress,"% COMPLETE"]})]})]})})]})}function dn(){const[e,t]=N.useState(""),[n,r]=N.useState(null),[i,s]=N.useState(!1),o=async()=>{if(e.trim()){s(!0),r(null);try{const c=localStorage.getItem("ac_api_key"),l=await(await fetch("/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":c||""},body:JSON.stringify({text:e})})).json();r(l)}catch(c){console.error(c),r({error:c.message})}finally{s(!1)}}};return a.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[a.jsxs("header",{className:"mb-8",children:[a.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Data Explorer"}),a.jsx("p",{className:"text-slate-400",children:"Inspect L3 Cache and test Embeddings"})]}),a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 mb-8",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Embedding Generator"}),a.jsxs("div",{className:"flex gap-4 mb-4",children:[a.jsx("input",{type:"text",value:e,onChange:c=>t(c.target.value),placeholder:"Enter text to vectorize...",className:"flex-1 bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500",onKeyDown:c=>c.key==="Enter"&&o()}),a.jsx("button",{onClick:o,disabled:i,className:"px-6 py-2 bg-green-600 hover:bg-green-500 text-white font-semibold rounded-lg disabled:opacity-50",children:i?"Generating...":"Generate"})]}),n&&a.jsxs("div",{className:"bg-slate-950 rounded-lg p-4 border border-slate-800 overflow-hidden",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${n.cached?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:n.cached?"CACHE HIT":"CACHE MISS"}),a.jsx("span",{className:"text-xs text-slate-500",children:n.model})]}),n.embedding?a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-slate-400 mb-2",children:"Vector (first 5 dims):"}),a.jsxs("code",{className:"text-cyan-400 text-sm",children:["[",n.embedding.slice(0,5).map(c=>c.toFixed(4)).join(", "),", ...]"]}),a.jsxs("div",{className:"text-xs text-slate-500 mt-2",children:["Total dimensions: ",n.embedding.length]})]}):a.jsx("div",{className:"text-red-400",children:n.error})]})]})]})}var hn={value:()=>{}};function $e(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new we(n)}function we(e){this._=e}function fn(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}we.prototype=$e.prototype={constructor:we,on:function(e,t){var n=this._,r=fn(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=pn(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=ot(n[i],e.name,t);else if(t==null)for(i in n)n[i]=ot(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new we(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function pn(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function ot(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=hn,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var He="http://www.w3.org/1999/xhtml";const lt={svg:"http://www.w3.org/2000/svg",xhtml:He,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Pe(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),lt.hasOwnProperty(t)?{space:lt[t],local:e}:e}function xn(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===He&&t.documentElement.namespaceURI===He?t.createElement(e):t.createElementNS(n,e)}}function mn(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function It(e){var t=Pe(e);return(t.local?mn:xn)(t)}function gn(){}function Ue(e){return e==null?gn:function(){return this.querySelector(e)}}function vn(e){typeof e!="function"&&(e=Ue(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,c=r[i]=new Array(o),u,l,d=0;d<o;++d)(u=s[d])&&(l=e.call(u,u.__data__,d,s))&&("__data__"in u&&(l.__data__=u.__data__),c[d]=l);return new T(r,this._parents)}function yn(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function bn(){return[]}function Tt(e){return e==null?bn:function(){return this.querySelectorAll(e)}}function wn(e){return function(){return yn(e.apply(this,arguments))}}function _n(e){typeof e=="function"?e=wn(e):e=Tt(e);for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],c=o.length,u,l=0;l<c;++l)(u=o[l])&&(r.push(e.call(u,u.__data__,l,o)),i.push(u));return new T(r,i)}function Dt(e){return function(){return this.matches(e)}}function Rt(e){return function(t){return t.matches(e)}}var Nn=Array.prototype.find;function jn(e){return function(){return Nn.call(this.children,e)}}function Sn(){return this.firstElementChild}function An(e){return this.select(e==null?Sn:jn(typeof e=="function"?e:Rt(e)))}var Cn=Array.prototype.filter;function En(){return Array.from(this.children)}function kn(e){return function(){return Cn.call(this.children,e)}}function $n(e){return this.selectAll(e==null?En:kn(typeof e=="function"?e:Rt(e)))}function Pn(e){typeof e!="function"&&(e=Dt(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,c=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&e.call(u,u.__data__,l,s)&&c.push(u);return new T(r,this._parents)}function Lt(e){return new Array(e.length)}function Mn(){return new T(this._enter||this._groups.map(Lt),this._parents)}function je(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}je.prototype={constructor:je,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function In(e){return function(){return e}}function Tn(e,t,n,r,i,s){for(var o=0,c,u=t.length,l=s.length;o<l;++o)(c=t[o])?(c.__data__=s[o],r[o]=c):n[o]=new je(e,s[o]);for(;o<u;++o)(c=t[o])&&(i[o]=c)}function Dn(e,t,n,r,i,s,o){var c,u,l=new Map,d=t.length,m=s.length,x=new Array(d),p;for(c=0;c<d;++c)(u=t[c])&&(x[c]=p=o.call(u,u.__data__,c,t)+"",l.has(p)?i[c]=u:l.set(p,u));for(c=0;c<m;++c)p=o.call(e,s[c],c,s)+"",(u=l.get(p))?(r[c]=u,u.__data__=s[c],l.delete(p)):n[c]=new je(e,s[c]);for(c=0;c<d;++c)(u=t[c])&&l.get(x[c])===u&&(i[c]=u)}function Rn(e){return e.__data__}function Ln(e,t){if(!arguments.length)return Array.from(this,Rn);var n=t?Dn:Tn,r=this._parents,i=this._groups;typeof e!="function"&&(e=In(e));for(var s=i.length,o=new Array(s),c=new Array(s),u=new Array(s),l=0;l<s;++l){var d=r[l],m=i[l],x=m.length,p=Fn(e.call(d,d&&d.__data__,l,r)),w=p.length,g=c[l]=new Array(w),f=o[l]=new Array(w),v=u[l]=new Array(x);n(d,m,g,f,v,p,t);for(var _=0,y=0,h,b;_<w;++_)if(h=g[_]){for(_>=y&&(y=_+1);!(b=f[y])&&++y<w;);h._next=b||null}}return o=new T(o,r),o._enter=c,o._exit=u,o}function Fn(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function On(){return new T(this._exit||this._groups.map(Lt),this._parents)}function zn(e,t,n){var r=this.enter(),i=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function Hn(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=r.length,o=Math.min(i,s),c=new Array(i),u=0;u<o;++u)for(var l=n[u],d=r[u],m=l.length,x=c[u]=new Array(m),p,w=0;w<m;++w)(p=l[w]||d[w])&&(x[w]=p);for(;u<i;++u)c[u]=n[u];return new T(c,this._parents)}function qn(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Xn(e){e||(e=Gn);function t(m,x){return m&&x?e(m.__data__,x.__data__):!m-!x}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],c=o.length,u=i[s]=new Array(c),l,d=0;d<c;++d)(l=o[d])&&(u[d]=l);u.sort(t)}return new T(i,this._parents).order()}function Gn(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Vn(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Yn(){return Array.from(this)}function Bn(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function Kn(){let e=0;for(const t of this)++e;return e}function Un(){return!this.node()}function Jn(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,c;s<o;++s)(c=i[s])&&e.call(c,c.__data__,s,i);return this}function Wn(e){return function(){this.removeAttribute(e)}}function Qn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Zn(e,t){return function(){this.setAttribute(e,t)}}function er(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function tr(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function nr(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function rr(e,t){var n=Pe(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Qn:Wn:typeof t=="function"?n.local?nr:tr:n.local?er:Zn)(n,t))}function Ft(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ir(e){return function(){this.style.removeProperty(e)}}function sr(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ar(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function or(e,t,n){return arguments.length>1?this.each((t==null?ir:typeof t=="function"?ar:sr)(e,t,n??"")):Q(this.node(),e)}function Q(e,t){return e.style.getPropertyValue(t)||Ft(e).getComputedStyle(e,null).getPropertyValue(t)}function lr(e){return function(){delete this[e]}}function cr(e,t){return function(){this[e]=t}}function ur(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function dr(e,t){return arguments.length>1?this.each((t==null?lr:typeof t=="function"?ur:cr)(e,t)):this.node()[e]}function Ot(e){return e.trim().split(/^|\s+/)}function Je(e){return e.classList||new zt(e)}function zt(e){this._node=e,this._names=Ot(e.getAttribute("class")||"")}zt.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Ht(e,t){for(var n=Je(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function qt(e,t){for(var n=Je(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function hr(e){return function(){Ht(this,e)}}function fr(e){return function(){qt(this,e)}}function pr(e,t){return function(){(t.apply(this,arguments)?Ht:qt)(this,e)}}function xr(e,t){var n=Ot(e+"");if(arguments.length<2){for(var r=Je(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?pr:t?hr:fr)(n,t))}function mr(){this.textContent=""}function gr(e){return function(){this.textContent=e}}function vr(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function yr(e){return arguments.length?this.each(e==null?mr:(typeof e=="function"?vr:gr)(e)):this.node().textContent}function br(){this.innerHTML=""}function wr(e){return function(){this.innerHTML=e}}function _r(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Nr(e){return arguments.length?this.each(e==null?br:(typeof e=="function"?_r:wr)(e)):this.node().innerHTML}function jr(){this.nextSibling&&this.parentNode.appendChild(this)}function Sr(){return this.each(jr)}function Ar(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Cr(){return this.each(Ar)}function Er(e){var t=typeof e=="function"?e:It(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function kr(){return null}function $r(e,t){var n=typeof e=="function"?e:It(e),r=t==null?kr:typeof t=="function"?t:Ue(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Pr(){var e=this.parentNode;e&&e.removeChild(this)}function Mr(){return this.each(Pr)}function Ir(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Tr(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Dr(e){return this.select(e?Tr:Ir)}function Rr(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Lr(e){return function(t){e.call(this,t,this.__data__)}}function Fr(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function Or(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function zr(e,t,n){return function(){var r=this.__on,i,s=Lr(t);if(r){for(var o=0,c=r.length;o<c;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=t;return}}this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function Hr(e,t,n){var r=Fr(e+""),i,s=r.length,o;if(arguments.length<2){var c=this.node().__on;if(c){for(var u=0,l=c.length,d;u<l;++u)for(i=0,d=c[u];i<s;++i)if((o=r[i]).type===d.type&&o.name===d.name)return d.value}return}for(c=t?zr:Or,i=0;i<s;++i)this.each(c(r[i],t,n));return this}function Xt(e,t,n){var r=Ft(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function qr(e,t){return function(){return Xt(this,e,t)}}function Xr(e,t){return function(){return Xt(this,e,t.apply(this,arguments))}}function Gr(e,t){return this.each((typeof t=="function"?Xr:qr)(e,t))}function*Vr(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Gt=[null];function T(e,t){this._groups=e,this._parents=t}function he(){return new T([[document.documentElement]],Gt)}function Yr(){return this}T.prototype=he.prototype={constructor:T,select:vn,selectAll:_n,selectChild:An,selectChildren:$n,filter:Pn,data:Ln,enter:Mn,exit:On,join:zn,merge:Hn,selection:Yr,order:qn,sort:Xn,call:Vn,nodes:Yn,node:Bn,size:Kn,empty:Un,each:Jn,attr:rr,style:or,property:dr,classed:xr,text:yr,html:Nr,raise:Sr,lower:Cr,append:Er,insert:$r,remove:Mr,clone:Dr,datum:Rr,on:Hr,dispatch:Gr,[Symbol.iterator]:Vr};function ae(e){return typeof e=="string"?new T([[document.querySelector(e)]],[document.documentElement]):new T([[e]],Gt)}function Br(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ct(e,t){if(e=Br(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const Kr={passive:!1},oe={capture:!0,passive:!1};function Le(e){e.stopImmediatePropagation()}function J(e){e.preventDefault(),e.stopImmediatePropagation()}function Ur(e){var t=e.document.documentElement,n=ae(e).on("dragstart.drag",J,oe);"onselectstart"in t?n.on("selectstart.drag",J,oe):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Jr(e,t){var n=e.document.documentElement,r=ae(e).on("dragstart.drag",null);t&&(r.on("click.drag",J,oe),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const xe=e=>()=>e;function qe(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:s,x:o,y:c,dx:u,dy:l,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:d}})}qe.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Wr(e){return!e.ctrlKey&&!e.button}function Qr(){return this.parentNode}function Zr(e,t){return t??{x:e.x,y:e.y}}function ei(){return navigator.maxTouchPoints||"ontouchstart"in this}function ti(){var e=Wr,t=Qr,n=Zr,r=ei,i={},s=$e("start","drag","end"),o=0,c,u,l,d,m=0;function x(h){h.on("mousedown.drag",p).filter(r).on("touchstart.drag",f).on("touchmove.drag",v,Kr).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(h,b){if(!(d||!e.call(this,h,b))){var j=y(this,t.call(this,h,b),h,b,"mouse");j&&(ae(h.view).on("mousemove.drag",w,oe).on("mouseup.drag",g,oe),Ur(h.view),Le(h),l=!1,c=h.clientX,u=h.clientY,j("start",h))}}function w(h){if(J(h),!l){var b=h.clientX-c,j=h.clientY-u;l=b*b+j*j>m}i.mouse("drag",h)}function g(h){ae(h.view).on("mousemove.drag mouseup.drag",null),Jr(h.view,l),J(h),i.mouse("end",h)}function f(h,b){if(e.call(this,h,b)){var j=h.changedTouches,S=t.call(this,h,b),A=j.length,E,C;for(E=0;E<A;++E)(C=y(this,S,h,b,j[E].identifier,j[E]))&&(Le(h),C("start",h,j[E]))}}function v(h){var b=h.changedTouches,j=b.length,S,A;for(S=0;S<j;++S)(A=i[b[S].identifier])&&(J(h),A("drag",h,b[S]))}function _(h){var b=h.changedTouches,j=b.length,S,A;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),S=0;S<j;++S)(A=i[b[S].identifier])&&(Le(h),A("end",h,b[S]))}function y(h,b,j,S,A,E){var C=s.copy(),k=ct(E||j,b),R,D,pe;if((pe=n.call(h,new qe("beforestart",{sourceEvent:j,target:x,identifier:A,active:o,x:k[0],y:k[1],dx:0,dy:0,dispatch:C}),S))!=null)return R=pe.x-k[0]||0,D=pe.y-k[1]||0,function an(Te,it,on){var st=k,De;switch(Te){case"start":i[A]=an,De=o++;break;case"end":delete i[A],--o;case"drag":k=ct(on||it,b),De=o;break}C.call(Te,h,new qe(Te,{sourceEvent:it,subject:pe,target:x,identifier:A,active:De,x:k[0]+R,y:k[1]+D,dx:k[0]-st[0],dy:k[1]-st[1],dispatch:C}),S)}}return x.filter=function(h){return arguments.length?(e=typeof h=="function"?h:xe(!!h),x):e},x.container=function(h){return arguments.length?(t=typeof h=="function"?h:xe(h),x):t},x.subject=function(h){return arguments.length?(n=typeof h=="function"?h:xe(h),x):n},x.touchable=function(h){return arguments.length?(r=typeof h=="function"?h:xe(!!h),x):r},x.on=function(){var h=s.on.apply(s,arguments);return h===s?x:h},x.clickDistance=function(h){return arguments.length?(m=(h=+h)*h,x):Math.sqrt(m)},x}function We(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Vt(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function fe(){}var le=.7,Se=1/le,W="\\s*([+-]?\\d+)\\s*",ce="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",O="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ni=/^#([0-9a-f]{3,8})$/,ri=new RegExp(`^rgb\\(${W},${W},${W}\\)$`),ii=new RegExp(`^rgb\\(${O},${O},${O}\\)$`),si=new RegExp(`^rgba\\(${W},${W},${W},${ce}\\)$`),ai=new RegExp(`^rgba\\(${O},${O},${O},${ce}\\)$`),oi=new RegExp(`^hsl\\(${ce},${O},${O}\\)$`),li=new RegExp(`^hsla\\(${ce},${O},${O},${ce}\\)$`),ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};We(fe,ue,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:dt,formatHex:dt,formatHex8:ci,formatHsl:ui,formatRgb:ht,toString:ht});function dt(){return this.rgb().formatHex()}function ci(){return this.rgb().formatHex8()}function ui(){return Yt(this).formatHsl()}function ht(){return this.rgb().formatRgb()}function ue(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ni.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ft(t):n===3?new M(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?me(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?me(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=ri.exec(e))?new M(t[1],t[2],t[3],1):(t=ii.exec(e))?new M(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=si.exec(e))?me(t[1],t[2],t[3],t[4]):(t=ai.exec(e))?me(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=oi.exec(e))?mt(t[1],t[2]/100,t[3]/100,1):(t=li.exec(e))?mt(t[1],t[2]/100,t[3]/100,t[4]):ut.hasOwnProperty(e)?ft(ut[e]):e==="transparent"?new M(NaN,NaN,NaN,0):null}function ft(e){return new M(e>>16&255,e>>8&255,e&255,1)}function me(e,t,n,r){return r<=0&&(e=t=n=NaN),new M(e,t,n,r)}function di(e){return e instanceof fe||(e=ue(e)),e?(e=e.rgb(),new M(e.r,e.g,e.b,e.opacity)):new M}function Xe(e,t,n,r){return arguments.length===1?di(e):new M(e,t,n,r??1)}function M(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}We(M,Xe,Vt(fe,{brighter(e){return e=e==null?Se:Math.pow(Se,e),new M(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?le:Math.pow(le,e),new M(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new M(Y(this.r),Y(this.g),Y(this.b),Ae(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:pt,formatHex:pt,formatHex8:hi,formatRgb:xt,toString:xt}));function pt(){return`#${V(this.r)}${V(this.g)}${V(this.b)}`}function hi(){return`#${V(this.r)}${V(this.g)}${V(this.b)}${V((isNaN(this.opacity)?1:this.opacity)*255)}`}function xt(){const e=Ae(this.opacity);return`${e===1?"rgb(":"rgba("}${Y(this.r)}, ${Y(this.g)}, ${Y(this.b)}${e===1?")":`, ${e})`}`}function Ae(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Y(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function V(e){return e=Y(e),(e<16?"0":"")+e.toString(16)}function mt(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new L(e,t,n,r)}function Yt(e){if(e instanceof L)return new L(e.h,e.s,e.l,e.opacity);if(e instanceof fe||(e=ue(e)),!e)return new L;if(e instanceof L)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,c=s-i,u=(s+i)/2;return c?(t===s?o=(n-r)/c+(n<r)*6:n===s?o=(r-t)/c+2:o=(t-n)/c+4,c/=u<.5?s+i:2-s-i,o*=60):c=u>0&&u<1?0:o,new L(o,c,u,e.opacity)}function fi(e,t,n,r){return arguments.length===1?Yt(e):new L(e,t,n,r??1)}function L(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}We(L,fi,Vt(fe,{brighter(e){return e=e==null?Se:Math.pow(Se,e),new L(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?le:Math.pow(le,e),new L(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new M(Fe(e>=240?e-240:e+120,i,r),Fe(e,i,r),Fe(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new L(gt(this.h),ge(this.s),ge(this.l),Ae(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ae(this.opacity);return`${e===1?"hsl(":"hsla("}${gt(this.h)}, ${ge(this.s)*100}%, ${ge(this.l)*100}%${e===1?")":`, ${e})`}`}}));function gt(e){return e=(e||0)%360,e<0?e+360:e}function ge(e){return Math.max(0,Math.min(1,e||0))}function Fe(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Bt=e=>()=>e;function pi(e,t){return function(n){return e+n*t}}function xi(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function mi(e){return(e=+e)==1?Kt:function(t,n){return n-t?xi(t,n,e):Bt(isNaN(t)?n:t)}}function Kt(e,t){var n=t-e;return n?pi(e,n):Bt(isNaN(e)?t:e)}const vt=(function e(t){var n=mi(t);function r(i,s){var o=n((i=Xe(i)).r,(s=Xe(s)).r),c=n(i.g,s.g),u=n(i.b,s.b),l=Kt(i.opacity,s.opacity);return function(d){return i.r=o(d),i.g=c(d),i.b=u(d),i.opacity=l(d),i+""}}return r.gamma=e,r})(1);function X(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Ge=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Oe=new RegExp(Ge.source,"g");function gi(e){return function(){return e}}function vi(e){return function(t){return e(t)+""}}function yi(e,t){var n=Ge.lastIndex=Oe.lastIndex=0,r,i,s,o=-1,c=[],u=[];for(e=e+"",t=t+"";(r=Ge.exec(e))&&(i=Oe.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),c[o]?c[o]+=s:c[++o]=s),(r=r[0])===(i=i[0])?c[o]?c[o]+=i:c[++o]=i:(c[++o]=null,u.push({i:o,x:X(r,i)})),n=Oe.lastIndex;return n<t.length&&(s=t.slice(n),c[o]?c[o]+=s:c[++o]=s),c.length<2?u[0]?vi(u[0].x):gi(t):(t=u.length,function(l){for(var d=0,m;d<t;++d)c[(m=u[d]).i]=m.x(l);return c.join("")})}var yt=180/Math.PI,Ve={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ut(e,t,n,r,i,s){var o,c,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(c=Math.sqrt(n*n+r*r))&&(n/=c,r/=c,u/=c),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*yt,skewX:Math.atan(u)*yt,scaleX:o,scaleY:c}}var ve;function bi(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ve:Ut(t.a,t.b,t.c,t.d,t.e,t.f)}function wi(e){return e==null||(ve||(ve=document.createElementNS("http://www.w3.org/2000/svg","g")),ve.setAttribute("transform",e),!(e=ve.transform.baseVal.consolidate()))?Ve:(e=e.matrix,Ut(e.a,e.b,e.c,e.d,e.e,e.f))}function Jt(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,d,m,x,p,w){if(l!==m||d!==x){var g=p.push("translate(",null,t,null,n);w.push({i:g-4,x:X(l,m)},{i:g-2,x:X(d,x)})}else(m||x)&&p.push("translate("+m+t+x+n)}function o(l,d,m,x){l!==d?(l-d>180?d+=360:d-l>180&&(l+=360),x.push({i:m.push(i(m)+"rotate(",null,r)-2,x:X(l,d)})):d&&m.push(i(m)+"rotate("+d+r)}function c(l,d,m,x){l!==d?x.push({i:m.push(i(m)+"skewX(",null,r)-2,x:X(l,d)}):d&&m.push(i(m)+"skewX("+d+r)}function u(l,d,m,x,p,w){if(l!==m||d!==x){var g=p.push(i(p)+"scale(",null,",",null,")");w.push({i:g-4,x:X(l,m)},{i:g-2,x:X(d,x)})}else(m!==1||x!==1)&&p.push(i(p)+"scale("+m+","+x+")")}return function(l,d){var m=[],x=[];return l=e(l),d=e(d),s(l.translateX,l.translateY,d.translateX,d.translateY,m,x),o(l.rotate,d.rotate,m,x),c(l.skewX,d.skewX,m,x),u(l.scaleX,l.scaleY,d.scaleX,d.scaleY,m,x),l=d=null,function(p){for(var w=-1,g=x.length,f;++w<g;)m[(f=x[w]).i]=f.x(p);return m.join("")}}}var _i=Jt(bi,"px, ","px)","deg)"),Ni=Jt(wi,", ",")",")"),Z=0,re=0,ee=0,Wt=1e3,Ce,ie,Ee=0,K=0,Me=0,de=typeof performance=="object"&&performance.now?performance:Date,Qt=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Qe(){return K||(Qt(ji),K=de.now()+Me)}function ji(){K=0}function ke(){this._call=this._time=this._next=null}ke.prototype=Ze.prototype={constructor:ke,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Qe():+n)+(t==null?0:+t),!this._next&&ie!==this&&(ie?ie._next=this:Ce=this,ie=this),this._call=e,this._time=n,Ye()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ye())}};function Ze(e,t,n){var r=new ke;return r.restart(e,t,n),r}function Si(){Qe(),++Z;for(var e=Ce,t;e;)(t=K-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Z}function bt(){K=(Ee=de.now())+Me,Z=re=0;try{Si()}finally{Z=0,Ci(),K=0}}function Ai(){var e=de.now(),t=e-Ee;t>Wt&&(Me-=t,Ee=e)}function Ci(){for(var e,t=Ce,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Ce=n);ie=e,Ye(r)}function Ye(e){if(!Z){re&&(re=clearTimeout(re));var t=e-K;t>24?(e<1/0&&(re=setTimeout(bt,e-de.now()-Me)),ee&&(ee=clearInterval(ee))):(ee||(Ee=de.now(),ee=setInterval(Ai,Wt)),Z=1,Qt(bt))}}function wt(e,t,n){var r=new ke;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var Ei=$e("start","end","cancel","interrupt"),ki=[],Zt=0,_t=1,Be=2,_e=3,Nt=4,Ke=5,Ne=6;function Ie(e,t,n,r,i,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;$i(e,n,{name:t,index:r,group:i,on:Ei,tween:ki,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Zt})}function et(e,t){var n=F(e,t);if(n.state>Zt)throw new Error("too late; already scheduled");return n}function z(e,t){var n=F(e,t);if(n.state>_e)throw new Error("too late; already running");return n}function F(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function $i(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=Ze(s,0,n.time);function s(l){n.state=_t,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var d,m,x,p;if(n.state!==_t)return u();for(d in r)if(p=r[d],p.name===n.name){if(p.state===_e)return wt(o);p.state===Nt?(p.state=Ne,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[d]):+d<t&&(p.state=Ne,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[d])}if(wt(function(){n.state===_e&&(n.state=Nt,n.timer.restart(c,n.delay,n.time),c(l))}),n.state=Be,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Be){for(n.state=_e,i=new Array(x=n.tween.length),d=0,m=-1;d<x;++d)(p=n.tween[d].value.call(e,e.__data__,n.index,n.group))&&(i[++m]=p);i.length=m+1}}function c(l){for(var d=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=Ke,1),m=-1,x=i.length;++m<x;)i[m].call(e,d);n.state===Ke&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){n.state=Ne,n.timer.stop(),delete r[t];for(var l in r)return;delete e.__transition}}function Pi(e,t){var n=e.__transition,r,i,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((r=n[o]).name!==t){s=!1;continue}i=r.state>Be&&r.state<Ke,r.state=Ne,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[o]}s&&delete e.__transition}}function Mi(e){return this.each(function(){Pi(this,e)})}function Ii(e,t){var n,r;return function(){var i=z(this,e),s=i.tween;if(s!==n){r=n=s;for(var o=0,c=r.length;o<c;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Ti(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=z(this,e),o=s.tween;if(o!==r){i=(r=o).slice();for(var c={name:t,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===t){i[u]=c;break}u===l&&i.push(c)}s.tween=i}}function Di(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=F(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?Ii:Ti)(n,e,t))}function tt(e,t,n){var r=e._id;return e.each(function(){var i=z(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return F(i,r).value[t]}}function en(e,t){var n;return(typeof t=="number"?X:t instanceof ue?vt:(n=ue(t))?(t=n,vt):yi)(e,t)}function Ri(e){return function(){this.removeAttribute(e)}}function Li(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Fi(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttribute(e);return o===i?null:o===r?s:s=t(r=o,n)}}function Oi(e,t,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?s:s=t(r=o,n)}}function zi(e,t,n){var r,i,s;return function(){var o,c=n(this),u;return c==null?void this.removeAttribute(e):(o=this.getAttribute(e),u=c+"",o===u?null:o===r&&u===i?s:(i=u,s=t(r=o,c)))}}function Hi(e,t,n){var r,i,s;return function(){var o,c=n(this),u;return c==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),u=c+"",o===u?null:o===r&&u===i?s:(i=u,s=t(r=o,c)))}}function qi(e,t){var n=Pe(e),r=n==="transform"?Ni:en;return this.attrTween(e,typeof t=="function"?(n.local?Hi:zi)(n,r,tt(this,"attr."+e,t)):t==null?(n.local?Li:Ri)(n):(n.local?Oi:Fi)(n,r,t))}function Xi(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Gi(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Vi(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&Gi(e,s)),n}return i._value=t,i}function Yi(e,t){var n,r;function i(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&Xi(e,s)),n}return i._value=t,i}function Bi(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=Pe(e);return this.tween(n,(r.local?Vi:Yi)(r,t))}function Ki(e,t){return function(){et(this,e).delay=+t.apply(this,arguments)}}function Ui(e,t){return t=+t,function(){et(this,e).delay=t}}function Ji(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ki:Ui)(t,e)):F(this.node(),t).delay}function Wi(e,t){return function(){z(this,e).duration=+t.apply(this,arguments)}}function Qi(e,t){return t=+t,function(){z(this,e).duration=t}}function Zi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Wi:Qi)(t,e)):F(this.node(),t).duration}function es(e,t){if(typeof t!="function")throw new Error;return function(){z(this,e).ease=t}}function ts(e){var t=this._id;return arguments.length?this.each(es(t,e)):F(this.node(),t).ease}function ns(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;z(this,e).ease=n}}function rs(e){if(typeof e!="function")throw new Error;return this.each(ns(this._id,e))}function is(e){typeof e!="function"&&(e=Dt(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,c=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&e.call(u,u.__data__,l,s)&&c.push(u);return new q(r,this._parents,this._name,this._id)}function ss(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),c=0;c<s;++c)for(var u=t[c],l=n[c],d=u.length,m=o[c]=new Array(d),x,p=0;p<d;++p)(x=u[p]||l[p])&&(m[p]=x);for(;c<r;++c)o[c]=t[c];return new q(o,this._parents,this._name,this._id)}function as(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function os(e,t,n){var r,i,s=as(t)?et:z;return function(){var o=s(this,e),c=o.on;c!==r&&(i=(r=c).copy()).on(t,n),o.on=i}}function ls(e,t){var n=this._id;return arguments.length<2?F(this.node(),n).on.on(e):this.each(os(n,e,t))}function cs(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function us(){return this.on("end.remove",cs(this._id))}function ds(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ue(e));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var c=r[o],u=c.length,l=s[o]=new Array(u),d,m,x=0;x<u;++x)(d=c[x])&&(m=e.call(d,d.__data__,x,c))&&("__data__"in d&&(m.__data__=d.__data__),l[x]=m,Ie(l[x],t,n,x,l,F(d,n)));return new q(s,this._parents,t,n)}function hs(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Tt(e));for(var r=this._groups,i=r.length,s=[],o=[],c=0;c<i;++c)for(var u=r[c],l=u.length,d,m=0;m<l;++m)if(d=u[m]){for(var x=e.call(d,d.__data__,m,u),p,w=F(d,n),g=0,f=x.length;g<f;++g)(p=x[g])&&Ie(p,t,n,g,x,w);s.push(x),o.push(d)}return new q(s,o,t,n)}var fs=he.prototype.constructor;function ps(){return new fs(this._groups,this._parents)}function xs(e,t){var n,r,i;return function(){var s=Q(this,e),o=(this.style.removeProperty(e),Q(this,e));return s===o?null:s===n&&o===r?i:i=t(n=s,r=o)}}function tn(e){return function(){this.style.removeProperty(e)}}function ms(e,t,n){var r,i=n+"",s;return function(){var o=Q(this,e);return o===i?null:o===r?s:s=t(r=o,n)}}function gs(e,t,n){var r,i,s;return function(){var o=Q(this,e),c=n(this),u=c+"";return c==null&&(u=c=(this.style.removeProperty(e),Q(this,e))),o===u?null:o===r&&u===i?s:(i=u,s=t(r=o,c))}}function vs(e,t){var n,r,i,s="style."+t,o="end."+s,c;return function(){var u=z(this,e),l=u.on,d=u.value[s]==null?c||(c=tn(t)):void 0;(l!==n||i!==d)&&(r=(n=l).copy()).on(o,i=d),u.on=r}}function ys(e,t,n){var r=(e+="")=="transform"?_i:en;return t==null?this.styleTween(e,xs(e,r)).on("end.style."+e,tn(e)):typeof t=="function"?this.styleTween(e,gs(e,r,tt(this,"style."+e,t))).each(vs(this._id,e)):this.styleTween(e,ms(e,r,t),n).on("end.style."+e,null)}function bs(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function ws(e,t,n){var r,i;function s(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&bs(e,o,n)),r}return s._value=t,s}function _s(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,ws(e,t,n??""))}function Ns(e){return function(){this.textContent=e}}function js(e){return function(){var t=e(this);this.textContent=t??""}}function Ss(e){return this.tween("text",typeof e=="function"?js(tt(this,"text",e)):Ns(e==null?"":e+""))}function As(e){return function(t){this.textContent=e.call(this,t)}}function Cs(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&As(i)),t}return r._value=e,r}function Es(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Cs(e))}function ks(){for(var e=this._name,t=this._id,n=nn(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],c=o.length,u,l=0;l<c;++l)if(u=o[l]){var d=F(u,t);Ie(u,e,n,l,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new q(r,this._parents,e,n)}function $s(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var c={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var l=z(this,r),d=l.on;d!==e&&(t=(e=d).copy(),t._.cancel.push(c),t._.interrupt.push(c),t._.end.push(u)),l.on=t}),i===0&&s()})}var Ps=0;function q(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function nn(){return++Ps}var H=he.prototype;q.prototype={constructor:q,select:ds,selectAll:hs,selectChild:H.selectChild,selectChildren:H.selectChildren,filter:is,merge:ss,selection:ps,transition:ks,call:H.call,nodes:H.nodes,node:H.node,size:H.size,empty:H.empty,each:H.each,on:ls,attr:qi,attrTween:Bi,style:ys,styleTween:_s,text:Ss,textTween:Es,remove:us,tween:Di,delay:Ji,duration:Zi,ease:ts,easeVarying:rs,end:$s,[Symbol.iterator]:H[Symbol.iterator]};function Ms(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Is={time:null,delay:0,duration:250,ease:Ms};function Ts(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Ds(e){var t,n;e instanceof q?(t=e._id,e=e._name):(t=nn(),(n=Is).time=Qe(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],c=o.length,u,l=0;l<c;++l)(u=o[l])&&Ie(u,e,t,l,o,n||Ts(u,t));return new q(r,this._parents,e,t)}he.prototype.interrupt=Mi;he.prototype.transition=Ds;function Rs(e,t){var n,r=1;e==null&&(e=0),t==null&&(t=0);function i(){var s,o=n.length,c,u=0,l=0;for(s=0;s<o;++s)c=n[s],u+=c.x,l+=c.y;for(u=(u/o-e)*r,l=(l/o-t)*r,s=0;s<o;++s)c=n[s],c.x-=u,c.y-=l}return i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i}function Ls(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return rn(this.cover(t,n),t,n,e)}function rn(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s=e._root,o={data:r},c=e._x0,u=e._y0,l=e._x1,d=e._y1,m,x,p,w,g,f,v,_;if(!s)return e._root=o,e;for(;s.length;)if((g=t>=(m=(c+l)/2))?c=m:l=m,(f=n>=(x=(u+d)/2))?u=x:d=x,i=s,!(s=s[v=f<<1|g]))return i[v]=o,e;if(p=+e._x.call(null,s.data),w=+e._y.call(null,s.data),t===p&&n===w)return o.next=s,i?i[v]=o:e._root=o,e;do i=i?i[v]=new Array(4):e._root=new Array(4),(g=t>=(m=(c+l)/2))?c=m:l=m,(f=n>=(x=(u+d)/2))?u=x:d=x;while((v=f<<1|g)===(_=(w>=x)<<1|p>=m));return i[_]=s,i[v]=o,e}function Fs(e){var t,n,r=e.length,i,s,o=new Array(r),c=new Array(r),u=1/0,l=1/0,d=-1/0,m=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(o[n]=i,c[n]=s,i<u&&(u=i),i>d&&(d=i),s<l&&(l=s),s>m&&(m=s));if(u>d||l>m)return this;for(this.cover(u,l).cover(d,m),n=0;n<r;++n)rn(this,o[n],c[n],e[n]);return this}function Os(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var o=i-n||1,c=this._root,u,l;n>e||e>=i||r>t||t>=s;)switch(l=(t<r)<<1|e<n,u=new Array(4),u[l]=c,c=u,o*=2,l){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function zs(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Hs(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function $(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function qs(e,t,n){var r,i=this._x0,s=this._y0,o,c,u,l,d=this._x1,m=this._y1,x=[],p=this._root,w,g;for(p&&x.push(new $(p,i,s,d,m)),n==null?n=1/0:(i=e-n,s=t-n,d=e+n,m=t+n,n*=n);w=x.pop();)if(!(!(p=w.node)||(o=w.x0)>d||(c=w.y0)>m||(u=w.x1)<i||(l=w.y1)<s))if(p.length){var f=(o+u)/2,v=(c+l)/2;x.push(new $(p[3],f,v,u,l),new $(p[2],o,v,f,l),new $(p[1],f,c,u,v),new $(p[0],o,c,f,v)),(g=(t>=v)<<1|e>=f)&&(w=x[x.length-1],x[x.length-1]=x[x.length-1-g],x[x.length-1-g]=w)}else{var _=e-+this._x.call(null,p.data),y=t-+this._y.call(null,p.data),h=_*_+y*y;if(h<n){var b=Math.sqrt(n=h);i=e-b,s=t-b,d=e+b,m=t+b,r=p.data}}return r}function Xs(e){if(isNaN(d=+this._x.call(null,e))||isNaN(m=+this._y.call(null,e)))return this;var t,n=this._root,r,i,s,o=this._x0,c=this._y0,u=this._x1,l=this._y1,d,m,x,p,w,g,f,v;if(!n)return this;if(n.length)for(;;){if((w=d>=(x=(o+u)/2))?o=x:u=x,(g=m>=(p=(c+l)/2))?c=p:l=p,t=n,!(n=n[f=g<<1|w]))return this;if(!n.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(r=t,v=f)}for(;n.data!==e;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):t?(s?t[f]=s:delete t[f],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(r?r[v]=n:this._root=n),this):(this._root=s,this)}function Gs(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function Vs(){return this._root}function Ys(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function Bs(e){var t=[],n,r=this._root,i,s,o,c,u;for(r&&t.push(new $(r,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(r=n.node,s=n.x0,o=n.y0,c=n.x1,u=n.y1)&&r.length){var l=(s+c)/2,d=(o+u)/2;(i=r[3])&&t.push(new $(i,l,d,c,u)),(i=r[2])&&t.push(new $(i,s,d,l,u)),(i=r[1])&&t.push(new $(i,l,o,c,d)),(i=r[0])&&t.push(new $(i,s,o,l,d))}return this}function Ks(e){var t=[],n=[],r;for(this._root&&t.push(new $(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var i=r.node;if(i.length){var s,o=r.x0,c=r.y0,u=r.x1,l=r.y1,d=(o+u)/2,m=(c+l)/2;(s=i[0])&&t.push(new $(s,o,c,d,m)),(s=i[1])&&t.push(new $(s,d,c,u,m)),(s=i[2])&&t.push(new $(s,o,m,d,l)),(s=i[3])&&t.push(new $(s,d,m,u,l))}n.push(r)}for(;r=n.pop();)e(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Us(e){return e[0]}function Js(e){return arguments.length?(this._x=e,this):this._x}function Ws(e){return e[1]}function Qs(e){return arguments.length?(this._y=e,this):this._y}function nt(e,t,n){var r=new rt(t??Us,n??Ws,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function rt(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function jt(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var P=nt.prototype=rt.prototype;P.copy=function(){var e=new rt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=jt(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var i=0;i<4;++i)(r=t.source[i])&&(r.length?n.push({source:r,target:t.target[i]=new Array(4)}):t.target[i]=jt(r));return e};P.add=Ls;P.addAll=Fs;P.cover=Os;P.data=zs;P.extent=Hs;P.find=qs;P.remove=Xs;P.removeAll=Gs;P.root=Vs;P.size=Ys;P.visit=Bs;P.visitAfter=Ks;P.x=Js;P.y=Qs;function B(e){return function(){return e}}function G(e){return(e()-.5)*1e-6}function Zs(e){return e.x+e.vx}function ea(e){return e.y+e.vy}function ta(e){var t,n,r,i=1,s=1;typeof e!="function"&&(e=B(e==null?1:+e));function o(){for(var l,d=t.length,m,x,p,w,g,f,v=0;v<s;++v)for(m=nt(t,Zs,ea).visitAfter(c),l=0;l<d;++l)x=t[l],g=n[x.index],f=g*g,p=x.x+x.vx,w=x.y+x.vy,m.visit(_);function _(y,h,b,j,S){var A=y.data,E=y.r,C=g+E;if(A){if(A.index>x.index){var k=p-A.x-A.vx,R=w-A.y-A.vy,D=k*k+R*R;D<C*C&&(k===0&&(k=G(r),D+=k*k),R===0&&(R=G(r),D+=R*R),D=(C-(D=Math.sqrt(D)))/D*i,x.vx+=(k*=D)*(C=(E*=E)/(f+E)),x.vy+=(R*=D)*C,A.vx-=k*(C=1-C),A.vy-=R*C)}return}return h>p+C||j<p-C||b>w+C||S<w-C}}function c(l){if(l.data)return l.r=n[l.data.index];for(var d=l.r=0;d<4;++d)l[d]&&l[d].r>l.r&&(l.r=l[d].r)}function u(){if(t){var l,d=t.length,m;for(n=new Array(d),l=0;l<d;++l)m=t[l],n[m.index]=+e(m,l,t)}}return o.initialize=function(l,d){t=l,r=d,u()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(i=+l,o):i},o.radius=function(l){return arguments.length?(e=typeof l=="function"?l:B(+l),u(),o):e},o}function na(e){return e.index}function St(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function ra(e){var t=na,n=m,r,i=B(30),s,o,c,u,l,d=1;e==null&&(e=[]);function m(f){return 1/Math.min(c[f.source.index],c[f.target.index])}function x(f){for(var v=0,_=e.length;v<d;++v)for(var y=0,h,b,j,S,A,E,C;y<_;++y)h=e[y],b=h.source,j=h.target,S=j.x+j.vx-b.x-b.vx||G(l),A=j.y+j.vy-b.y-b.vy||G(l),E=Math.sqrt(S*S+A*A),E=(E-s[y])/E*f*r[y],S*=E,A*=E,j.vx-=S*(C=u[y]),j.vy-=A*C,b.vx+=S*(C=1-C),b.vy+=A*C}function p(){if(o){var f,v=o.length,_=e.length,y=new Map(o.map((b,j)=>[t(b,j,o),b])),h;for(f=0,c=new Array(v);f<_;++f)h=e[f],h.index=f,typeof h.source!="object"&&(h.source=St(y,h.source)),typeof h.target!="object"&&(h.target=St(y,h.target)),c[h.source.index]=(c[h.source.index]||0)+1,c[h.target.index]=(c[h.target.index]||0)+1;for(f=0,u=new Array(_);f<_;++f)h=e[f],u[f]=c[h.source.index]/(c[h.source.index]+c[h.target.index]);r=new Array(_),w(),s=new Array(_),g()}}function w(){if(o)for(var f=0,v=e.length;f<v;++f)r[f]=+n(e[f],f,e)}function g(){if(o)for(var f=0,v=e.length;f<v;++f)s[f]=+i(e[f],f,e)}return x.initialize=function(f,v){o=f,l=v,p()},x.links=function(f){return arguments.length?(e=f,p(),x):e},x.id=function(f){return arguments.length?(t=f,x):t},x.iterations=function(f){return arguments.length?(d=+f,x):d},x.strength=function(f){return arguments.length?(n=typeof f=="function"?f:B(+f),w(),x):n},x.distance=function(f){return arguments.length?(i=typeof f=="function"?f:B(+f),g(),x):i},x}const ia=1664525,sa=1013904223,At=4294967296;function aa(){let e=1;return()=>(e=(ia*e+sa)%At)/At}function oa(e){return e.x}function la(e){return e.y}var ca=10,ua=Math.PI*(3-Math.sqrt(5));function da(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,c=new Map,u=Ze(m),l=$e("tick","end"),d=aa();e==null&&(e=[]);function m(){x(),l.call("tick",t),n<r&&(u.stop(),l.call("end",t))}function x(g){var f,v=e.length,_;g===void 0&&(g=1);for(var y=0;y<g;++y)for(n+=(s-n)*i,c.forEach(function(h){h(n)}),f=0;f<v;++f)_=e[f],_.fx==null?_.x+=_.vx*=o:(_.x=_.fx,_.vx=0),_.fy==null?_.y+=_.vy*=o:(_.y=_.fy,_.vy=0);return t}function p(){for(var g=0,f=e.length,v;g<f;++g){if(v=e[g],v.index=g,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),isNaN(v.x)||isNaN(v.y)){var _=ca*Math.sqrt(.5+g),y=g*ua;v.x=_*Math.cos(y),v.y=_*Math.sin(y)}(isNaN(v.vx)||isNaN(v.vy))&&(v.vx=v.vy=0)}}function w(g){return g.initialize&&g.initialize(e,d),g}return p(),t={tick:x,restart:function(){return u.restart(m),t},stop:function(){return u.stop(),t},nodes:function(g){return arguments.length?(e=g,p(),c.forEach(w),t):e},alpha:function(g){return arguments.length?(n=+g,t):n},alphaMin:function(g){return arguments.length?(r=+g,t):r},alphaDecay:function(g){return arguments.length?(i=+g,t):+i},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(o=1-g,t):1-o},randomSource:function(g){return arguments.length?(d=g,c.forEach(w),t):d},force:function(g,f){return arguments.length>1?(f==null?c.delete(g):c.set(g,w(f)),t):c.get(g)},find:function(g,f,v){var _=0,y=e.length,h,b,j,S,A;for(v==null?v=1/0:v*=v,_=0;_<y;++_)S=e[_],h=g-S.x,b=f-S.y,j=h*h+b*b,j<v&&(A=S,v=j);return A},on:function(g,f){return arguments.length>1?(l.on(g,f),t):l.on(g)}}}function ha(){var e,t,n,r,i=B(-30),s,o=1,c=1/0,u=.81;function l(p){var w,g=e.length,f=nt(e,oa,la).visitAfter(m);for(r=p,w=0;w<g;++w)t=e[w],f.visit(x)}function d(){if(e){var p,w=e.length,g;for(s=new Array(w),p=0;p<w;++p)g=e[p],s[g.index]=+i(g,p,e)}}function m(p){var w=0,g,f,v=0,_,y,h;if(p.length){for(_=y=h=0;h<4;++h)(g=p[h])&&(f=Math.abs(g.value))&&(w+=g.value,v+=f,_+=f*g.x,y+=f*g.y);p.x=_/v,p.y=y/v}else{g=p,g.x=g.data.x,g.y=g.data.y;do w+=s[g.data.index];while(g=g.next)}p.value=w}function x(p,w,g,f){if(!p.value)return!0;var v=p.x-t.x,_=p.y-t.y,y=f-w,h=v*v+_*_;if(y*y/u<h)return h<c&&(v===0&&(v=G(n),h+=v*v),_===0&&(_=G(n),h+=_*_),h<o&&(h=Math.sqrt(o*h)),t.vx+=v*p.value*r/h,t.vy+=_*p.value*r/h),!0;if(p.length||h>=c)return;(p.data!==t||p.next)&&(v===0&&(v=G(n),h+=v*v),_===0&&(_=G(n),h+=_*_),h<o&&(h=Math.sqrt(o*h)));do p.data!==t&&(y=s[p.data.index]*r/h,t.vx+=v*y,t.vy+=_*y);while(p=p.next)}return l.initialize=function(p,w){e=p,n=w,d()},l.strength=function(p){return arguments.length?(i=typeof p=="function"?p:B(+p),d(),l):i},l.distanceMin=function(p){return arguments.length?(o=p*p,l):Math.sqrt(o)},l.distanceMax=function(p){return arguments.length?(c=p*p,l):Math.sqrt(c)},l.theta=function(p){return arguments.length?(u=p*p,l):Math.sqrt(u)},l}function se(e,t,n){this.k=e,this.x=t,this.y=n}se.prototype={constructor:se,scale:function(e){return e===1?this:new se(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new se(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};se.prototype;const fa=["START","L1_CHECK","L2_CHECK","L3_SEARCH","COGNITIVE","LLM_CALL","END"];function pa(){const[e,t]=N.useState([]),[n,r]=N.useState(null),i=N.useRef(null);return N.useEffect(()=>{(async()=>{try{const c=await(await fetch("/api/lab/genomes?limit=20")).json();c.genomes&&c.genomes.length>0&&(t(c.genomes),r(c.genomes[0]))}catch(o){console.error("Failed to fetch genomes:",o)}})()},[]),N.useEffect(()=>{if(!n||!i.current)return;const s=ae(i.current);s.selectAll("*").remove();const o=i.current.clientWidth,c=i.current.clientHeight,u=fa.map(f=>({id:f})),l=[];Object.entries(n.transitions).forEach(([f,v])=>{Object.entries(v).forEach(([_,y])=>{y>.05&&l.push({source:f,target:_,value:y})})});const d=da(u).force("link",ra(l).id(f=>f.id).distance(150)).force("charge",ha().strength(-500)).force("center",Rs(o/2,c/2)).force("collide",ta(50)),m=s.append("g").selectAll("line").data(l).join("line").attr("stroke","#0ea5e9").attr("stroke-opacity",f=>f.value).attr("stroke-width",f=>f.value*5),x=s.append("g").selectAll("g").data(u).join("g").call(ti().on("start",p).on("drag",w).on("end",g));x.append("circle").attr("r",20).attr("fill","#0f172a").attr("stroke","#0ea5e9").attr("stroke-width",2),x.append("text").text(f=>f.id).attr("x",25).attr("y",5).attr("fill","#94a3b8").attr("font-size","12px").attr("font-family","monospace"),d.on("tick",()=>{m.attr("x1",f=>f.source.x).attr("y1",f=>f.source.y).attr("x2",f=>f.target.x).attr("y2",f=>f.target.y),x.attr("transform",f=>`translate(${f.x},${f.y})`)});function p(f){f.active||d.alphaTarget(.3).restart(),f.subject.fx=f.subject.x,f.subject.fy=f.subject.y}function w(f){f.subject.fx=f.x,f.subject.fy=f.y}function g(f){f.active||d.alphaTarget(0),f.subject.fx=null,f.subject.fy=null}},[n]),a.jsxs("div",{className:"flex h-full bg-slate-950 text-slate-100 font-sans",children:[a.jsxs("div",{className:"w-80 border-r border-slate-800 flex flex-col bg-slate-900/50 backdrop-blur",children:[a.jsxs("div",{className:"p-4 border-b border-slate-800",children:[a.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[a.jsx("span",{className:"text-cyan-500",children:"ðŸ§¬"})," Evolutionary Lab"]}),a.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Observing Generation ",e.length>0?e[0].generation:0]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:e.map(s=>a.jsxs("div",{onClick:()=>r(s),className:`p-3 rounded-lg cursor-pointer transition-all border ${n?.id===s.id?"bg-cyan-500/10 border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.15)]":"bg-slate-800/50 border-slate-700/50 hover:bg-slate-800 hover:border-slate-600"}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsxs("span",{className:"text-xs font-mono text-slate-400",children:["Gen ",s.generation]}),a.jsxs("span",{className:"text-xs font-bold text-emerald-400",children:["Fit: ",Math.round(s.fitness||0)]})]}),a.jsx("div",{className:"text-xs text-slate-500 truncate font-mono",children:s.id.split("-").pop()}),a.jsx("div",{className:"mt-2 flex gap-1 overflow-hidden opacity-50",children:s.phenotype?.slice(0,5).map((o,c)=>a.jsx("div",{className:"w-1 h-3 rounded-full bg-slate-600",title:o},c))})]},s.id))})]}),a.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[a.jsxs("div",{className:"absolute top-4 left-4 z-10 pointer-events-none",children:[a.jsx("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Genome Visualization"}),a.jsx("p",{className:"text-slate-400 text-sm",children:"Markov Chain Probability Matrix"})]}),a.jsx("svg",{ref:i,className:"w-full h-full cursor-grab active:cursor-grabbing"}),a.jsxs("div",{className:"absolute bottom-4 right-4 bg-slate-900/80 backdrop-blur border border-slate-700 p-4 rounded-lg max-w-xs text-xs text-slate-400",children:[a.jsx("h3",{className:"text-white font-bold mb-2",children:"Structure Analysis"}),a.jsxs("p",{className:"mb-2",children:["Thicker lines indicate higher transition probability. This genome favors ",a.jsx("span",{className:"text-cyan-400",children:"L1 â†’ L3"})," transitions, optimizing for semantic recall over raw LLM calls."]}),a.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-500"}),a.jsx("span",{children:"High Probability"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-500/20"}),a.jsx("span",{children:"Low Probability"})]})]})]})]})}function xa(){const[e,t]=N.useState([]),[n,r]=N.useState(null),[i,s]=N.useState(!0),[o,c]=N.useState([]),u=async()=>{try{const d=await(await fetch("/api/decisions?limit=50")).json();d.decisions&&t(d.decisions)}catch(l){console.error("Failed to fetch decisions:",l)}finally{s(!1)}};return N.useEffect(()=>{u();const l=new EventSource("/api/events/stream");return l.onmessage=d=>{const m=JSON.parse(d.data);if(m.type!=="sys:connected"){const x=Math.random().toString(36).substr(2,9);c(p=>[...p,{id:x,...m,x:Math.random()*80+10,y:Math.random()*80+10}]),setTimeout(()=>{c(p=>p.filter(w=>w.id!==x))},2e3)}m.type==="decision:recorded"&&u()},()=>{l.close()}},[]),a.jsxs("div",{className:"flex h-full bg-slate-950 text-slate-100 font-sans relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 pointer-events-none z-50",children:o.map(l=>a.jsx("div",{className:"absolute w-3 h-3 rounded-full bg-emerald-400 shadow-[0_0_10px_#34d399] animate-ping",style:{left:`${l.x}%`,top:`${l.y}%`}},l.id))}),a.jsxs("div",{className:"w-96 border-r border-slate-800 flex flex-col bg-slate-900/50 backdrop-blur z-10",children:[a.jsxs("div",{className:"p-4 border-b border-slate-800 flex justify-between items-center",children:[a.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[a.jsx("span",{className:"text-emerald-500",children:"ðŸ‘ï¸"})," Observability"]}),a.jsx("span",{className:"text-xs text-slate-500 font-mono animate-pulse",children:"LIVE STREAM"})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[i&&a.jsx("div",{className:"p-4 text-center text-slate-500",children:"Loading stream..."}),e.map(l=>a.jsxs("div",{onClick:()=>r(l),className:`p-3 rounded-lg cursor-pointer transition-all border ${n?.id===l.id?"bg-emerald-500/10 border-emerald-500/50 shadow-[0_0_15px_rgba(16,185,129,0.15)]":"bg-slate-800/50 border-slate-700/50 hover:bg-slate-800 hover:border-slate-600"}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("span",{className:"text-xs font-bold text-white uppercase tracking-wider",children:l.action}),a.jsx("span",{className:"text-[10px] font-mono text-slate-500",children:new Date(l.timestamp).toLocaleTimeString()})]}),a.jsx("div",{className:"text-xs text-slate-400 line-clamp-2 font-mono",children:l.reasoning||"No reasoning provided."})]},l.id))]})]}),a.jsx("div",{className:"flex-1 p-8 overflow-y-auto z-10",children:n?a.jsxs("div",{className:"max-w-3xl mx-auto space-y-8",children:[a.jsxs("header",{children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:"px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs font-bold uppercase border border-emerald-500/30",children:n.action}),a.jsx("span",{className:"text-slate-500 text-sm font-mono",children:n.id})]}),a.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Decision Trace"})]}),a.jsxs("section",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider mb-3",children:"Reasoning Chain"}),a.jsx("p",{className:"text-slate-300 leading-relaxed font-mono text-sm",children:n.reasoning})]}),a.jsxs("section",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsx("h3",{className:"text-sm font-bold text-slate-400 uppercase tracking-wider mb-3",children:"Outcome"}),a.jsx("div",{className:"bg-slate-950 rounded-lg p-4 font-mono text-xs text-emerald-400 overflow-x-auto border border-slate-800",children:JSON.stringify(n.outcome,null,2)})]})]}):a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-600",children:[a.jsx("div",{className:"text-6xl mb-4",children:"ðŸ‘ï¸"}),a.jsx("p",{className:"text-lg font-medium",children:"Select a decision to inspect details"})]})})]})}const ma=[{id:"Darwin",icon:"ðŸ¦",label:"Darwin",desc:"Survival of the fittest. High mutation, ruthless culling.",color:"text-orange-400",border:"border-orange-500/50",bg:"bg-orange-500/10"},{id:"Utopia",icon:"ðŸ¤",label:"Utopia",desc:"High cooperation, shared rewards, altruistic caching.",color:"text-cyan-400",border:"border-cyan-500/50",bg:"bg-cyan-500/10"},{id:"WallStreet",icon:"ðŸ“ˆ",label:"Wall Street",desc:"Profit maximization. High competition for tokens.",color:"text-emerald-400",border:"border-emerald-500/50",bg:"bg-emerald-500/10"},{id:"ArtistColony",icon:"ðŸŽ¨",label:"Artist Colony",desc:"High temperature, novelty seeking, creative risks.",color:"text-pink-400",border:"border-pink-500/50",bg:"bg-pink-500/10"},{id:"DoomerPrepper",icon:"ðŸ›¡ï¸",label:"Doomer Prepper",desc:"Extreme safety, redundancy, low risk tolerance.",color:"text-slate-400",border:"border-slate-500/50",bg:"bg-slate-500/10"}];function ga(){const[e,t]=N.useState(null),[n,r]=N.useState(null),[i,s]=N.useState(!0),[o,c]=N.useState(!1);N.useEffect(()=>{fetch("/api/governance/presets").then(l=>l.json()).then(l=>t(l.mode||"Default")).catch(l=>console.error("Failed to fetch mode:",l)),setTimeout(()=>{r({name:"Acme Corp",id:"org_123456789",plan:"Professional",role:"Owner",members:[{id:"u_1",name:"Alice Admin",email:"alice@acme.com",role:"owner"},{id:"u_2",name:"Bob Builder",email:"bob@acme.com",role:"member"},{id:"u_3",name:"Charlie Cache",email:"charlie@acme.com",role:"viewer"}],apiKeys:[{prefix:"ac_live_",created:"2025-11-01",scopes:["cache:read","cache:write"]},{prefix:"ac_test_",created:"2025-11-15",scopes:["cache:read"]}]}),s(!1)},800)},[]);const u=async l=>{c(!0);try{(await fetch("/api/governance/presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:l,parameters:{timestamp:Date.now()}})})).ok&&t(l)}catch(d){console.error("Failed to switch mode:",d)}finally{c(!1)}};return i?a.jsx("div",{className:"p-8 text-slate-400",children:"Loading governance data..."}):a.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[a.jsxs("header",{className:"mb-8",children:[a.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Governance"}),a.jsxs("p",{className:"text-slate-400",children:["Organization settings, access control, and ",a.jsx("span",{className:"text-purple-400",children:"Reality Switching"}),"."]})]}),a.jsxs("section",{className:"mb-12",children:[a.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[a.jsx("span",{className:"text-purple-500",children:"ðŸ”®"})," Reality Switcher",a.jsx("span",{className:"text-xs font-normal text-slate-500 ml-2 border border-slate-700 px-2 py-0.5 rounded",children:"Global Simulation Parameters"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ma.map(l=>{const d=e===l.id;return a.jsxs("button",{onClick:()=>u(l.id),disabled:o,className:`relative p-4 rounded-xl border text-left transition-all ${d?`${l.bg} ${l.border} shadow-[0_0_20px_rgba(0,0,0,0.3)] scale-[1.02]`:"bg-slate-900/40 border-slate-800 hover:border-slate-600 hover:bg-slate-800/60"}`,children:[d&&a.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.8)]"}),a.jsx("div",{className:"text-2xl mb-2",children:l.icon}),a.jsx("div",{className:`font-bold mb-1 ${d?"text-white":"text-slate-300"}`,children:l.label}),a.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:l.desc})]},l.id)})})]}),a.jsx("div",{className:"border-t border-slate-800/50 my-8"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[a.jsxs("div",{className:"lg:col-span-2 bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-white",children:n.name}),a.jsxs("div",{className:"text-sm text-slate-500 font-mono mt-1",children:["ID: ",n.id]})]}),a.jsxs("span",{className:"px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-xs font-bold border border-purple-500/30",children:[n.plan.toUpperCase()," PLAN"]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[a.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Your Role"}),a.jsx("div",{className:"font-semibold text-green-400",children:n.role})]}),a.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[a.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Region"}),a.jsx("div",{className:"font-semibold text-white",children:"US-East (N. Virginia)"})]})]})]}),a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Compliance"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(ze,{label:"SOC 2 Type II",status:"active"}),a.jsx(ze,{label:"GDPR",status:"active"}),a.jsx(ze,{label:"HIPAA",status:"pending"})]})]})]}),a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 mb-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h3",{className:"text-lg font-bold",children:"Team Members"}),a.jsx("button",{className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Invite Member"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-left text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-slate-800 text-slate-400",children:[a.jsx("th",{className:"pb-3 pl-2",children:"User"}),a.jsx("th",{className:"pb-3",children:"Role"}),a.jsx("th",{className:"pb-3",children:"2FA"}),a.jsx("th",{className:"pb-3 text-right pr-2",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-800",children:n.members.map(l=>a.jsxs("tr",{className:"group hover:bg-slate-800/30 transition-colors",children:[a.jsxs("td",{className:"py-3 pl-2",children:[a.jsx("div",{className:"font-medium text-white",children:l.name}),a.jsx("div",{className:"text-slate-500",children:l.email})]}),a.jsx("td",{className:"py-3",children:a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize
                      ${l.role==="owner"?"bg-purple-500/10 text-purple-400":l.role==="admin"?"bg-blue-500/10 text-blue-400":"bg-slate-700/50 text-slate-400"}`,children:l.role})}),a.jsx("td",{className:"py-3",children:a.jsx("span",{className:"text-green-400",children:"Enabled"})}),a.jsx("td",{className:"py-3 text-right pr-2",children:a.jsx("button",{className:"text-slate-500 hover:text-white",children:"â€¢â€¢â€¢"})})]},l.id))})]})})]}),a.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Active API Keys"}),a.jsx("div",{className:"space-y-3",children:n.apiKeys.map((l,d)=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950 rounded-lg border border-slate-800",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded bg-slate-900 flex items-center justify-center text-slate-400",children:"ðŸ”‘"}),a.jsxs("div",{children:[a.jsxs("div",{className:"font-mono text-sm text-white",children:[l.prefix,"****************"]}),a.jsxs("div",{className:"text-xs text-slate-500",children:["Created ",l.created]})]})]}),a.jsx("div",{className:"flex gap-2",children:l.scopes.map(m=>a.jsx("span",{className:"px-2 py-1 bg-slate-800 text-slate-300 text-xs rounded border border-slate-700",children:m},m))})]},d))})]})]})}function ze({label:e,status:t}){const n={active:"bg-green-500",pending:"bg-yellow-500",inactive:"bg-slate-500"};return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-slate-300",children:e}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`w-2 h-2 rounded-full ${n[t]}`}),a.jsx("span",{className:"text-xs text-slate-500 capitalize",children:t})]})]})}const Ct={healthcare:[{id:"patient_records",title:"âš•ï¸ Patient Records",description:"Cache medical records with HIPAA compliance",prompt:"Cache patient medical records with HIPAA compliance and PHI detection",nodes:["input","phi_filter","cache_l1","cache_l2","hipaa_audit","openai","output"]},{id:"clinical_decision",title:"ðŸ”¬ Clinical Decision Support",description:"AI-powered diagnosis with audit trails",prompt:"Cache clinical decision support AI with full audit logging",nodes:["input","phi_filter","cache_l1","anthropic","hipaa_audit","output"]},{id:"ehr_integration",title:"ðŸ¥ EHR Integration",description:"Electronic health record system caching",prompt:"Cache EHR system queries with encryption and compliance",nodes:["input","cache_l1","cache_l2","phi_filter","hipaa_audit","output"]},{id:"custom",title:"âœï¸ Custom Healthcare",description:"Describe your own healthcare use case",prompt:"",nodes:[]}],finance:[{id:"risk_analysis",title:"ðŸ“Š Risk Analysis",description:"Fraud detection and risk scoring",prompt:"Cache risk analysis and fraud detection for financial transactions",nodes:["input","fraud_detector","cache_l1","cache_l2","openai","pci_audit","output"]},{id:"transaction_processing",title:"ðŸ’³ Transaction Processing",description:"High-speed payment validation",prompt:"Cache transaction validation with PCI-DSS compliance",nodes:["input","transaction_validator","cache_l1","pci_audit","output"]},{id:"kyc_compliance",title:"ðŸ” KYC Compliance",description:"Know Your Customer verification",prompt:"Cache KYC verification results with audit trail",nodes:["input","cache_l1","cache_l2","anthropic","pci_audit","output"]},{id:"custom",title:"âœï¸ Custom Finance",description:"Describe your own financial use case",prompt:"",nodes:[]}],legal:[{id:"document_analysis",title:"ðŸ“„ Document Analysis",description:"Legal document review and search",prompt:"Cache legal document analysis with retention policies",nodes:["input","cache_l1","cache_l2","anthropic","retention_policy","output"]},{id:"case_research",title:"âš–ï¸ Case Research",description:"Case law and precedent lookup",prompt:"Cache case law research with audit logging",nodes:["input","semantic_dedup","cache_l2","cache_l3","openai","audit_logger","output"]},{id:"custom",title:"âœï¸ Custom Legal",description:"Describe your own legal use case",prompt:"",nodes:[]}],ecommerce:[{id:"product_search",title:"ðŸ” Product Search",description:"Fast product catalog search",prompt:"Cache product search and recommendations",nodes:["input","cache_l1","semantic_dedup","openai","output"]},{id:"inventory_sync",title:"ðŸ“¦ Inventory Sync",description:"Real-time inventory availability",prompt:"Cache inventory status with short TTL for freshness",nodes:["input","cache_l1","output"]},{id:"personalization",title:"âœ¨ Personalization",description:"User recommendations and preferences",prompt:"Cache personalized recommendations per user",nodes:["input","cache_l1","cache_l2","gemini","output"]},{id:"custom",title:"âœï¸ Custom E-commerce",description:"Describe your own e-commerce use case",prompt:"",nodes:[]}],saas:[{id:"api_caching",title:"ðŸ”Œ API Caching",description:"Multi-tenant API response caching",prompt:"Cache API responses with tenant isolation",nodes:["input","cache_l1","cache_l2","output"]},{id:"ai_features",title:"ðŸ¤– AI Features",description:"AI-powered product features",prompt:"Cache AI completions for SaaS features",nodes:["input","semantic_dedup","cache_l1","cache_l2","openai","output"]},{id:"analytics",title:"ðŸ“Š Analytics",description:"Dashboard data aggregation",prompt:"Cache analytics queries and dashboard data",nodes:["input","cache_l2","cache_l3","output"]},{id:"custom",title:"âœï¸ Custom SaaS",description:"Describe your own SaaS use case",prompt:"",nodes:[]}],general:[{id:"api_basic",title:"ðŸ”Œ API Caching",description:"Basic API response caching",prompt:"Cache API responses to reduce latency",nodes:["input","cache_l1","cache_l2","output"]},{id:"llm_caching",title:"ðŸ¤– LLM Caching",description:"Cache AI model responses",prompt:"Cache LLM completions to save costs",nodes:["input","semantic_dedup","cache_l1","cache_l2","openai","output"]},{id:"database",title:"ðŸ—„ï¸ Database Query",description:"Cache expensive database queries",prompt:"Cache database query results",nodes:["input","cache_l1","cache_l2","cache_l3","output"]},{id:"custom",title:"âœï¸ Custom",description:"Describe your own use case",prompt:"",nodes:[]}]},Et={healthcare:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup","phi_filter"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["hipaa_audit","encrypted_cache"]},{category:"output",types:["output"]}],finance:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup","fraud_detector","transaction_validator"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["pci_audit","sox_logger"]},{category:"output",types:["output"]}],legal:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"compliance",types:["retention_policy","audit_logger"]},{category:"output",types:["output"]}],ecommerce:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}],saas:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}],general:[{category:"input",types:["input"]},{category:"cache",types:["cache_l1","cache_l2","cache_l3"]},{category:"intelligence",types:["semantic_dedup"]},{category:"llm",types:["openai","anthropic","gemini"]},{category:"output",types:["output"]}]},kt={healthcare:{required:["hipaa","phi"],autoAddNodes:["phi_filter","hipaa_audit"],retention:"7 years",encryption:"required"},finance:{required:["pci_dss","sox"],autoAddNodes:["pci_audit"],retention:"7 years",encryption:"required"},legal:{required:["data_retention"],autoAddNodes:["retention_policy","audit_logger"],retention:"10 years",encryption:"recommended"},ecommerce:{required:["pci_dss","gdpr"],autoAddNodes:[],retention:"2 years",encryption:"recommended"},saas:{required:["soc2"],autoAddNodes:[],retention:"1 year",encryption:"recommended"},general:{required:[],autoAddNodes:[],retention:"30 days",encryption:"optional"}};function $t(e){return{templates:Ct[e]||Ct.general,nodes:Et[e]||Et.general,compliance:kt[e]||kt.general}}const sn=N.createContext();function va({children:e}){const[t,n]=N.useState(null),[r,i]=N.useState(null),[s,o]=N.useState(!1);N.useEffect(()=>{const l=localStorage.getItem("agentcache_sector");l?(n(l),i($t(l))):o(!0)},[]);const c=l=>{n(l),i($t(l)),localStorage.setItem("agentcache_sector",l),o(!1)},u=()=>{o(!0)};return a.jsx(sn.Provider,{value:{sector:t,config:r,selectSector:c,changeSector:u,showSectorModal:s,setShowSectorModal:o},children:e})}function ya(){const e=N.useContext(sn);if(!e)throw new Error("useSector must be used within SectorProvider");return e}class I extends Error{constructor(t,n=null){super(t),this.name="ValidationError",this.field=n}}function Pt(e){if(!e||typeof e!="object")throw new I("Pipeline must be an object");if(!e.name||typeof e.name!="string")throw new I("Pipeline must have a valid name","name");if(e.name.length>255)throw new I("Pipeline name must be less than 255 characters","name");if(!Array.isArray(e.nodes))throw new I("Pipeline must have a nodes array","nodes");if(e.nodes.length===0)throw new I("Pipeline must have at least one node","nodes");if(!Array.isArray(e.edges))throw new I("Pipeline must have an edges array","edges");const t=new Set;for(const r of e.nodes){if(!r.id)throw new I("All nodes must have an ID","nodes");if(t.has(r.id))throw new I(`Duplicate node ID found: ${r.id}`,"nodes");t.add(r.id)}for(const r of e.edges){if(!r.source||!r.target)throw new I("All edges must have source and target","edges");if(!t.has(r.source))throw new I(`Edge references non-existent source node: ${r.source}`,"edges");if(!t.has(r.target))throw new I(`Edge references non-existent target node: ${r.target}`,"edges")}if(ba(e.nodes,e.edges))throw new I("Pipeline contains circular dependencies","edges");const n=["healthcare","finance","legal","ecommerce","saas","general"];if(e.sector&&!n.includes(e.sector))throw new I(`Invalid sector: ${e.sector}`,"sector");return!0}function ba(e,t){const n={};e.forEach(o=>{n[o.id]=[]}),t.forEach(o=>{n[o.source].push(o.target)});const r=new Set,i=new Set;function s(o){r.add(o),i.add(o);for(const c of n[o]||[])if(r.has(c)){if(i.has(c))return!0}else if(s(c))return!0;return i.delete(o),!1}for(const o of Object.keys(n))if(!r.has(o)&&s(o))return!0;return!1}function wa(e){return typeof e!="string"?"":e.replace(/<[^>]*>/g,"").replace(/[\x00-\x1F\x7F]/g,"").slice(0,255).trim()}const ye=2,te="agentcache_",U=5*1024*1024;class be{static save(t,n){try{const r=te+t,i=JSON.stringify(n);return i.length>U?{success:!1,error:"quota",message:"Data exceeds 5MB storage limit. Consider deleting old pipelines.",size:i.length}:(localStorage.setItem(r,i),{success:!0,size:i.length})}catch(r){return r.name==="QuotaExceededError"?{success:!1,error:"quota",message:"Storage quota exceeded. Clear old data to continue.",cause:r}:{success:!1,error:"storage",message:`Failed to save data: ${r.message}`,cause:r}}}static load(t,n=null){try{const r=te+t,i=localStorage.getItem(r);return i===null?n:JSON.parse(i)}catch(r){return console.error(`Failed to load ${t}:`,r),n}}static remove(t){try{const n=te+t;return localStorage.removeItem(n),!0}catch(n){return console.error(`Failed to remove ${t}:`,n),!1}}static getStorageStats(){try{let t=0,n=0;for(let r=0;r<localStorage.length;r++){const i=localStorage.key(r);if(i.startsWith(te)){const s=localStorage.getItem(i);t+=s?s.length:0,n++}}return{totalSize:t,itemCount:n,percentUsed:t/U*100,maxSize:U,available:U-t}}catch(t){return console.error("Failed to get storage stats:",t),{totalSize:0,itemCount:0,percentUsed:0,maxSize:U,available:U}}}static clearAll(){try{const t=[];for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);r.startsWith(te)&&t.push(r)}return t.forEach(n=>localStorage.removeItem(n)),!0}catch(t){return console.error("Failed to clear storage:",t),!1}}}class ne{static savePipeline(t){try{t.name=wa(t.name),Pt(t);const n={...t,_v:ye,savedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},r=this.loadAllPipelines(),i=r.findIndex(o=>o.name===t.name);i!==-1?r[i]={...n,savedAt:r[i].savedAt}:r.push(n);const s=be.save("pipelines",r);return s.success?{success:!0,pipeline:n,isNew:i===-1}:s}catch(n){return{success:!1,error:"validation",message:n.message,field:n.field||null}}}static loadAllPipelines(){return be.load("pipelines",[]).map(n=>this.migratePipeline(n))}static loadPipeline(t){return this.loadAllPipelines().find(r=>r.name===t)||null}static deletePipeline(t){try{const n=this.loadAllPipelines(),r=n.filter(s=>s.name!==t);return r.length===n.length?{success:!1,error:"not_found",message:`Pipeline "${t}" not found`}:be.save("pipelines",r)}catch(n){return{success:!1,error:"storage",message:n.message}}}static migratePipeline(t){return t._v?(t._v===ye,t):{...t,_v:ye,updatedAt:t.savedAt||new Date().toISOString()}}static getPipelineStats(){const t=this.loadAllPipelines(),n={total:t.length,active:t.filter(r=>r.isActive).length,inactive:t.filter(r=>!r.isActive).length,bySector:{}};return t.forEach(r=>{const i=r.sector||"general";n.bySector[i]=(n.bySector[i]||0)+1}),n}static exportPipelines(t=null){const n=this.loadAllPipelines(),r=t?n.filter(i=>t.includes(i.name)):n;return JSON.stringify({version:ye,exportedAt:new Date().toISOString(),pipelines:r},null,2)}static importPipelines(t){try{const n=JSON.parse(t);if(!n.pipelines||!Array.isArray(n.pipelines))return{success:!1,error:"invalid_format",message:"Invalid import format"};const r=this.loadAllPipelines();let i=0,s=0;for(const c of n.pipelines)try{Pt(c),r.find(u=>u.name===c.name)?s++:(r.push(this.migratePipeline(c)),i++)}catch(u){console.warn(`Skipping invalid pipeline: ${u.message}`),s++}const o=be.save("pipelines",r);return o.success?{success:!0,imported:i,skipped:s}:o}catch(n){return{success:!1,error:"parse_error",message:`Failed to parse JSON: ${n.message}`}}}}const _a=Mt.memo(({pipeline:e,formatDate:t,onLoad:n,onToggleStatus:r,onDuplicate:i,onDelete:s})=>a.jsxs("div",{className:"pipeline-card",children:[a.jsxs("div",{className:`status-indicator ${e.isActive?"active":"inactive"}`,children:[a.jsx("div",{className:"status-dot"}),e.isActive?"Active":"Inactive"]}),a.jsxs("div",{className:"card-content",onClick:()=>n(e),children:[a.jsx("h3",{className:"pipeline-name",children:e.name}),a.jsxs("div",{className:"pipeline-stats",children:[a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-label",children:"Nodes"}),a.jsx("span",{className:"stat-value",children:e.nodes?.length||0})]}),a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-label",children:"Est. Savings"}),a.jsx("span",{className:"stat-value savings",children:e.estimatedSavings})]}),a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-label",children:"Modified"}),a.jsx("span",{className:"stat-value",children:t(e.lastModified)})]})]}),a.jsxs("div",{className:"node-preview",children:[e.nodes?.slice(0,5).map((o,c)=>a.jsx("div",{className:`node-thumb ${o.type||"default"}`,children:o.type?.replace(/_/g," ").substring(0,3).toUpperCase()},c)),e.nodes?.length>5&&a.jsxs("div",{className:"node-thumb more",children:["+",e.nodes.length-5]})]})]}),a.jsxs("div",{className:"card-actions",children:[a.jsx("button",{className:`btn-toggle ${e.isActive?"active":""}`,onClick:o=>{o.stopPropagation(),r(e.name)},title:e.isActive?"Deactivate":"Activate",children:e.isActive?"â¸":"â–¶"}),a.jsx("button",{className:"btn-action",onClick:o=>{o.stopPropagation(),n(e)},title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"btn-action",onClick:o=>{o.stopPropagation(),i(e)},title:"Duplicate",children:"ðŸ“‹"}),a.jsx("button",{className:"btn-action danger",onClick:o=>{o.stopPropagation(),s(e.name)},title:"Delete",children:"ðŸ—‘ï¸"})]})]}));function Na({onLoadPipeline:e,onNewPipeline:t}){const{sector:n}=ya(),[r,i]=N.useState([]),[s,o]=N.useState("all"),[c,u]=N.useState("recent"),[l,d]=N.useState("grid");N.useEffect(()=>{m()},[n]);const m=N.useCallback(()=>{try{const h=ne.loadAllPipelines().filter(b=>b.sector===n).map(b=>({...b,isActive:b.isActive!==void 0?b.isActive:!1,lastModified:b.updatedAt||b.savedAt||new Date().toISOString()}));i(h)}catch(y){console.error("Failed to load pipelines:",y),alert("Error loading pipelines. Please refresh the page.")}},[n]);N.useMemo(()=>y=>`$${((y.nodes?.filter(b=>b.type?.includes("cache")||b.id?.includes("cache")).length||0)*800+400).toLocaleString()}/mo`,[]);const x=N.useCallback(y=>{try{const h=ne.loadPipeline(y);if(!h){alert("Pipeline not found");return}h.isActive=!h.isActive;const b=ne.savePipeline(h);if(!b.success){alert(`Failed to update pipeline: ${b.message}`);return}m()}catch(h){console.error("Failed to toggle pipeline status:",h),alert("Error updating pipeline status")}},[n,m]),p=N.useCallback(y=>{if(confirm(`Delete pipeline "${y}"? This cannot be undone.`))try{const h=ne.deletePipeline(y);if(!h.success){alert(`Failed to delete pipeline: ${h.message}`);return}m()}catch(h){console.error("Failed to delete pipeline:",h),alert("Error deleting pipeline")}},[m]),w=N.useCallback(y=>{try{const h={...y,name:`${y.name} (Copy)`,isActive:!1},b=ne.savePipeline(h);if(!b.success){b.error==="quota"?alert(`Storage quota exceeded: ${b.message}`):b.error==="validation"?alert(`Validation error: ${b.message}`):alert(`Failed to duplicate pipeline: ${b.message}`);return}m()}catch(h){console.error("Failed to duplicate pipeline:",h),alert("Error duplicating pipeline")}},[m]),g=N.useMemo(()=>{let y=[...r];return s==="active"?y=y.filter(h=>h.isActive):s==="inactive"&&(y=y.filter(h=>!h.isActive)),c==="name"?y.sort((h,b)=>h.name.localeCompare(b.name)):c==="savings"?y.sort((h,b)=>{const j=parseInt((h.estimatedSavings||"0").replace(/[^0-9]/g,""));return parseInt((b.estimatedSavings||"0").replace(/[^0-9]/g,""))-j}):y.sort((h,b)=>new Date(b.lastModified)-new Date(h.lastModified)),y},[r,s,c]),f=N.useCallback(y=>{const h=new Date(y),j=new Date-h,S=Math.floor(j/6e4),A=Math.floor(j/36e5),E=Math.floor(j/864e5);return S<1?"Just now":S<60?`${S}m ago`:A<24?`${A}h ago`:E<7?`${E}d ago`:h.toLocaleDateString()},[]),v=N.useMemo(()=>r.filter(y=>y.isActive).length,[r]),_=N.useMemo(()=>r.filter(y=>!y.isActive).length,[r]);return a.jsxs("div",{className:"workspace-dashboard",children:[a.jsxs("div",{className:"dashboard-header",children:[a.jsxs("div",{className:"dashboard-title-section",children:[a.jsx("h1",{children:"ðŸ—‚ï¸ My Workspaces"}),a.jsxs("p",{className:"dashboard-subtitle",children:[r.length," pipeline",r.length!==1?"s":""," in ",n," â€¢ ",v," active"]})]}),a.jsx("button",{className:"btn-new-pipeline",onClick:t,children:"âž• New Pipeline"})]}),a.jsxs("div",{className:"dashboard-controls",children:[a.jsxs("div",{className:"control-group",children:[a.jsx("label",{children:"Filter:"}),a.jsxs("div",{className:"button-group",children:[a.jsxs("button",{className:s==="all"?"active":"",onClick:()=>o("all"),children:["All (",r.length,")"]}),a.jsxs("button",{className:s==="active"?"active":"",onClick:()=>o("active"),children:["Active (",v,")"]}),a.jsxs("button",{className:s==="inactive"?"active":"",onClick:()=>o("inactive"),children:["Inactive (",_,")"]})]})]}),a.jsxs("div",{className:"control-group",children:[a.jsx("label",{children:"Sort by:"}),a.jsxs("div",{className:"button-group",children:[a.jsx("button",{className:c==="recent"?"active":"",onClick:()=>u("recent"),children:"ðŸ“… Recent"}),a.jsx("button",{className:c==="name"?"active":"",onClick:()=>u("name"),children:"ðŸ”¤ Name"}),a.jsx("button",{className:c==="savings"?"active":"",onClick:()=>u("savings"),children:"ðŸ’° Savings"})]})]}),a.jsxs("div",{className:"control-group",children:[a.jsx("label",{children:"View:"}),a.jsxs("div",{className:"button-group",children:[a.jsx("button",{className:l==="grid"?"active":"",onClick:()=>d("grid"),children:"âŠž Grid"}),a.jsx("button",{className:l==="list"?"active":"",onClick:()=>d("list"),children:"â˜° List"})]})]})]}),a.jsx("div",{className:`pipeline-container ${l}`,children:g.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:"ðŸ“¦"}),a.jsx("h3",{children:"No pipelines found"}),a.jsx("p",{children:s!=="all"?`No ${s} pipelines. Try changing the filter.`:"Get started by creating a new pipeline or loading a preset."}),a.jsx("button",{className:"btn-primary",onClick:t,children:"âž• Create Your First Pipeline"})]}):g.map(y=>a.jsx(_a,{pipeline:y,formatDate:f,onLoad:e,onToggleStatus:x,onDuplicate:w,onDelete:p},y.name))})]})}function ja(){const[e,t]=N.useState("swarm"),n=()=>{switch(e){case"overview":return a.jsx(at,{});case"pipelines":return a.jsx(va,{children:a.jsx(Na,{onLoadPipeline:r=>window.location.href=`/studio.html?pipeline=${r.id}`,onNewPipeline:()=>window.location.href="/studio.html?new=true"})});case"swarm":return a.jsx(un,{});case"lab":return a.jsx(pa,{});case"observability":return a.jsx(xa,{});case"data":return a.jsx(dn,{});case"governance":return a.jsx(ga,{});default:return a.jsx(at,{})}};return a.jsxs("div",{className:"flex h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[a.jsx(cn,{activeView:e,onViewChange:t}),a.jsx("main",{className:"flex-1 overflow-auto relative",children:n()})]})}ln.createRoot(document.getElementById("root")).render(a.jsx(Mt.StrictMode,{children:a.jsx(ja,{})}));
