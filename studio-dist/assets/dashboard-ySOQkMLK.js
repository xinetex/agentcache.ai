import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{r as E,j as g,R as K,a as DE,g as Hv,b as BE}from"./client-DwJ0wxic.js";import{u as kE,C as du,R as Wv,M as Et,T as wr,V as we,P as hu,a as ce,b as In,G as qv,c as kn,S as Bp,d as vn,e as Xv,B as Wa,f as rc,L as FE,g as Kv,h as Yv,i as LE,Q as IE,j as Qv,k as OE,l as UE,w as ie,H as jt,m as kp,N as Fs,n as VE,o as fu,p as ft,q as se,r as pt,s as co,t as Fn,v as Pn,x as et,F as jE,y as GE,z as Qt,A as sa,D as js,W as Ac,E as qn,I as $E,J as Zv,K as zE,O as Fp,U as Jv,X as HE,Y as WE,Z as qE,_ as XE,$ as KE,a0 as YE,a1 as QE,a2 as ZE,a3 as Lp,a4 as e_,a5 as Qn,a6 as Ip,a7 as jg,a8 as _a,a9 as JE,aa as e2,ab as sn,ac as Qr,ad as mt,ae as Zr,af as Jr,ag as Hr,ah as ia,ai as br,aj as Gr,ak as zi,al as t2,am as Op,an as Up,ao as Ih,ap as Vp,aq as jp,ar as wi,as as be,at as n2,au as qa,av as pu,aw as mu,ax as r2,ay as Ot,az as gu,aA as Ta,aB as xu,aC as Gs,aD as Oh,aE as wa,aF as t_,aG as Cn,aH as n_,aI as r_,aJ as s_,aK as i_,aL as o_,aM as Gp,aN as a_,aO as l_,aP as Gg,aQ as Hi,aR as dn,aS as s2,aT as c_,aU as u_,aV as d_,aW as h_,aX as f_,aY as p_,aZ as m_,a_ as g_,a$ as x_,b0 as y_,b1 as b_,b2 as v_,b3 as i2,b4 as o2,b5 as a2,b6 as Wi,b7 as Ec,b8 as Cc,b9 as Rc,ba as $s,bb as __,bc as T_,bd as w_,be as S_,bf as N_,bg as A_,bh as E_,bi as C_,bj as l2,bk as c2,bl as R_,bm as M_,bn as oa,bo as aa,bp as Si,bq as u2,br as $p,bs as zp,bt as Hp,bu as Kr,bv as Wp,bw as qp,bx as sc,by as ic,bz as oc,bA as ac,bB as $g,bC as zg,bD as Hg,bE as Wg,bF as Uh,bG as Vh,bH as jh,bI as Gh,bJ as $h,bK as zh,bL as Hh,bM as Wh,bN as qh,bO as Xh,bP as Kh,bQ as Yh,bR as Qh,bS as Zh,bT as Jh,bU as ef,bV as tf,bW as nf,bX as rf,bY as sf,bZ as of,b_ as af,b$ as P_,c0 as d2,c1 as h2,c2 as f2,c3 as p2,c4 as m2,c5 as g2,c6 as x2,c7 as y2,c8 as b2,c9 as v2,ca as Mc,cb as _2,cc as T2,cd as w2,ce as S2,cf as D_,cg as N2,ch as A2,ci as E2,cj as C2,ck as R2,cl as M2,cm as P2,cn as D2,co as B2,cp as k2,cq as F2,cr as L2,cs as I2,ct as O2,cu as U2,cv as V2,cw as j2,cx as G2,cy as B_,cz as $2,cA as z2,cB as H2,cC as W2,cD as Pc,cE as q2,cF as k_,cG as X2,cH as F_,cI as K2,cJ as Y2,cK as Q2,cL as lc,cM as Dc,cN as Bc,cO as qg,cP as Z2,cQ as J2,cR as eC,cS as tC,cT as nC,cU as rC,cV as sC,cW as iC,cX as oC,cY as Xg,cZ as aC,c_ as Kg,c$ as lC,d0 as cC,d1 as L_,d2 as yn,d3 as uC,d4 as dC}from"./extends-EVGp5csO.js";const hC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),fC=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Yg=n=>{const e=fC(n);return e.charAt(0).toUpperCase()+e.slice(1)},I_=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),pC=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var mC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const gC=E.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:o,...a},l)=>E.createElement("svg",{ref:l,...mC,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:I_("lucide",s),...!i&&!pC(a)&&{"aria-hidden":"true"},...a},[...o.map(([c,u])=>E.createElement(c,u)),...Array.isArray(i)?i:[i]]));const Se=(n,e)=>{const t=E.forwardRef(({className:r,...s},i)=>E.createElement(gC,{ref:i,iconNode:e,className:I_(`lucide-${hC(Yg(n))}`,`lucide-${n}`,r),...s}));return t.displayName=Yg(n),t};const xC=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ss=Se("activity",xC);const yC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],O_=Se("arrow-right",yC);const bC=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],U_=Se("bell",bC);const vC=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],_C=Se("box",vC);const TC=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Qg=Se("brain",TC);const wC=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],SC=Se("clock",wC);const NC=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],AC=Se("cloud",NC);const EC=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],CC=Se("cpu",EC);const RC=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],qi=Se("database",RC);const MC=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],PC=Se("dollar-sign",MC);const DC=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],V_=Se("flask-conical",DC);const BC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],lf=Se("globe",BC);const kC=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],cf=Se("key",kC);const FC=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Zg=Se("layers",FC);const LC=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],IC=Se("layout-grid",LC);const OC=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],UC=Se("log-out",OC);const VC=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],jC=Se("network",VC);const GC=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],$C=Se("play",GC);const zC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],HC=Se("plus",zC);const WC=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Xp=Se("radio",WC);const qC=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],XC=Se("save",qC);const KC=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],uf=Se("search",KC);const YC=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],j_=Se("server",YC);const QC=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ZC=Se("settings",QC);const JC=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],eR=Se("share-2",JC);const tR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],nR=Se("shield-alert",tR);const rR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],G_=Se("shield",rR);const sR=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],Jg=Se("snowflake",sR);const iR=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],oR=Se("thermometer",iR);const aR=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],lR=Se("timer",aR);const cR=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],$_=Se("trophy",cR);const uR=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],z_=Se("user",uR);const dR=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],df=Se("users",dR);const hR=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],H_=Se("wallet",hR);const fR=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],pR=Se("wand-sparkles",fR);const mR=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],gR=Se("wind",mR);const xR=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],yR=Se("workflow",xR);const bR=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],W_=Se("x",bR);const vR=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],yu=Se("zap",vR),_R=({activeView:n,setActiveView:e,user:t})=>{const[r,s]=E.useState(!1),i=[{id:"swarm",label:"Neural Ops Center",icon:ss},{id:"overview",label:"System Overview",icon:IC},{id:"pipeline",label:"Pipeline Studio",icon:yR},{id:"observability",label:"Observability",icon:qi},{id:"lab",label:"Research Lab",icon:V_},{id:"data",label:"Data Explorer",icon:qi},{id:"governance",label:"Governance",icon:G_},{id:"settings",label:"Settings",icon:ZC}];return g.jsxs("div",{className:`fixed left-0 top-16 bottom-0 z-40 flex flex-col bg-[rgba(6,11,20,0.95)] border-r border-[rgba(0,243,255,0.2)] backdrop-blur-xl transition-all duration-300 ${r?"w-64":"w-16"}`,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[g.jsx("div",{className:"flex-1 py-6 flex flex-col gap-2",children:i.map(o=>{const a=o.icon,l=n===o.id;return g.jsxs("button",{onClick:()=>e(o.id),className:`relative flex items-center h-12 px-4 mx-2 rounded-lg transition-all duration-200 group ${l?"bg-[rgba(0,243,255,0.1)] text-[var(--hud-accent)] shadow-[0_0_15px_rgba(0,243,255,0.2)]":"text-[var(--hud-text-dim)] hover:bg-[rgba(255,255,255,0.05)] hover:text-white"}`,children:[g.jsx(a,{size:20,className:`min-w-[20px] transition-transform duration-300 ${l?"scale-110":"group-hover:scale-110"}`}),g.jsx("span",{className:`ml-4 font-['Rajdhani'] font-semibold tracking-wide whitespace-nowrap overflow-hidden transition-all duration-300 ${r?"opacity-100 w-auto":"opacity-0 w-0"}`,children:o.label}),l&&g.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-[var(--hud-accent)] rounded-r-full shadow-[0_0_10px_var(--hud-accent)]"})]},o.id)})}),g.jsxs("div",{className:"p-2 border-t border-[rgba(0,243,255,0.1)]",children:[g.jsxs("div",{className:`flex items-center p-2 rounded-lg bg-[rgba(0,0,0,0.3)] border border-[rgba(255,255,255,0.05)] ${r?"justify-start":"justify-center"}`,children:[g.jsx("div",{className:"w-8 h-8 rounded bg-gradient-to-br from-[var(--hud-accent)] to-[var(--hud-accent-secondary)] flex items-center justify-center text-black font-bold text-xs shadow-[0_0_10px_rgba(0,243,255,0.3)]",children:t?.name?.charAt(0)||"G"}),g.jsxs("div",{className:`ml-3 overflow-hidden transition-all duration-300 ${r?"w-auto opacity-100":"w-0 opacity-0"}`,children:[g.jsx("div",{className:"text-sm font-bold text-white truncate",children:t?.name||"Guest"}),g.jsx("div",{className:"text-xs text-[var(--hud-accent)] font-mono",children:t?.role||"Viewer"})]})]}),g.jsxs("button",{onClick:()=>{localStorage.removeItem("agentcache_token"),localStorage.removeItem("agentcache_user"),window.location.href="/login.html"},className:`mt-2 w-full flex items-center justify-center h-10 rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors ${!r&&"hidden"}`,children:[g.jsx(UC,{size:16,className:"mr-2"}),g.jsx("span",{className:"font-['Rajdhani'] font-semibold",children:"LOGOUT"})]})]})]})},TR=()=>{const[n,e]=E.useState(new Date),[t,r]=E.useState(!1);return E.useEffect(()=>{const s=setInterval(()=>e(new Date),1e3),i=()=>r(window.scrollY>20);return window.addEventListener("scroll",i),()=>{clearInterval(s),window.removeEventListener("scroll",i)}},[]),g.jsx("header",{className:`fixed top-0 left-0 right-0 h-16 z-50 transition-all duration-300 ${t?"bg-[rgba(3,5,8,0.9)] backdrop-blur-md border-b border-[rgba(0,243,255,0.2)]":"bg-transparent border-b border-transparent"}`,children:g.jsxs("div",{className:"h-full px-6 flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsxs("div",{className:"relative group cursor-pointer",children:[g.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-[var(--hud-accent)] to-[var(--hud-accent-secondary)] rounded-lg blur opacity-40 group-hover:opacity-75 transition duration-500"}),g.jsx("div",{className:"relative w-10 h-10 bg-black border border-[var(--hud-accent)] rounded-lg flex items-center justify-center",children:g.jsx("div",{className:"w-4 h-4 bg-[var(--hud-accent)] rotate-45 group-hover:rotate-90 transition-transform duration-500"})})]}),g.jsxs("div",{children:[g.jsxs("h1",{className:"text-xl font-['Rajdhani'] font-bold tracking-widest text-white",children:["AGENT",g.jsx("span",{className:"text-[var(--hud-accent)]",children:"CACHE"})]}),g.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-mono text-[var(--hud-text-dim)]",children:[g.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),"SYSTEM ONLINE"]})]})]}),g.jsxs("div",{className:"hidden md:flex items-center gap-8 px-8 py-2 bg-[rgba(255,255,255,0.03)] rounded-full border border-[rgba(255,255,255,0.05)]",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Grid Status"}),g.jsx("span",{className:"text-xs font-mono text-[var(--hud-success)]",children:"OPTIMAL"})]}),g.jsx("div",{className:"w-px h-4 bg-[rgba(255,255,255,0.1)]"}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Latency"}),g.jsx("span",{className:"text-xs font-mono text-[var(--hud-accent)]",children:"42ms"})]}),g.jsx("div",{className:"w-px h-4 bg-[rgba(255,255,255,0.1)]"}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] uppercase tracking-wider",children:"Active Agents"}),g.jsx("span",{className:"text-xs font-mono text-white",children:"8,492"})]})]}),g.jsxs("div",{className:"flex items-center gap-6",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("button",{className:"text-[var(--hud-text-dim)] hover:text-white transition-colors",children:g.jsx(uf,{size:20})}),g.jsxs("button",{className:"relative text-[var(--hud-text-dim)] hover:text-white transition-colors",children:[g.jsx(U_,{size:20}),g.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-[var(--hud-accent)] rounded-full animate-pulse"})]})]}),g.jsxs("div",{className:"text-right hidden sm:block",children:[g.jsx("div",{className:"text-sm font-mono font-bold text-white",children:n.toLocaleTimeString([],{hour12:!1})}),g.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:"UTC"})]})]})]})})},Ue=({title:n,children:e,className:t="",icon:r,action:s})=>g.jsxs("div",{className:`relative group bg-[var(--hud-panel-bg)] border border-[var(--hud-border)] rounded-lg overflow-hidden transition-all duration-300 hover:shadow-[0_0_20px_rgba(0,243,255,0.1)] hover:border-[var(--hud-accent)] ${t}`,children:[g.jsx("div",{className:"absolute top-0 left-0 w-2 h-2 border-t-2 border-l-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),g.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),g.jsx("div",{className:"absolute bottom-0 left-0 w-2 h-2 border-b-2 border-l-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),g.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 border-b-2 border-r-2 border-[var(--hud-accent)] opacity-50 group-hover:opacity-100 transition-opacity"}),(n||r)&&g.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[var(--hud-border)] bg-[rgba(0,0,0,0.2)]",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[r&&g.jsx(r,{size:18,className:"text-[var(--hud-accent)]"}),g.jsxs("h3",{className:"font-['Rajdhani'] font-bold text-lg tracking-wider text-white uppercase",children:[g.jsx("span",{className:"text-[var(--hud-accent)] mr-2",children:"::"}),n]})]}),s&&g.jsx("div",{className:"text-sm",children:s})]}),g.jsx("div",{className:"p-6",children:e})]}),cl=({value:n,max:e=100,label:t,sublabel:r,color:s="var(--hud-accent)"})=>{const i=Math.min(100,Math.max(0,n/e*100)),o=36,a=2*Math.PI*o,l=a-i/100*a;return g.jsxs("div",{className:"flex flex-col items-center justify-center",children:[g.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[g.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[g.jsx("circle",{cx:"64",cy:"64",r:o,stroke:"rgba(255,255,255,0.1)",strokeWidth:"8",fill:"transparent"}),g.jsx("circle",{cx:"64",cy:"64",r:o,stroke:s,strokeWidth:"8",fill:"transparent",strokeDasharray:a,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out",style:{filter:`drop-shadow(0 0 4px ${s})`}})]}),g.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:g.jsxs("span",{className:"text-2xl font-['Rajdhani'] font-bold text-white",children:[n,"%"]})})]}),g.jsxs("div",{className:"text-center mt-2",children:[g.jsx("div",{className:"text-sm font-bold text-white tracking-wide",children:t}),r&&g.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:r})]})]})},Sa=({columns:n,data:e,onRowClick:t})=>g.jsx("div",{className:"w-full overflow-x-auto",children:g.jsxs("table",{className:"w-full text-left border-collapse",children:[g.jsx("thead",{children:g.jsx("tr",{className:"border-b border-[var(--hud-border)]",children:n.map((r,s)=>g.jsx("th",{className:"py-3 px-4 text-xs font-['Rajdhani'] font-bold text-[var(--hud-text-dim)] uppercase tracking-wider whitespace-nowrap bg-[rgba(0,0,0,0.2)]",children:r.header},s))})}),g.jsx("tbody",{className:"font-mono text-sm",children:e.map((r,s)=>g.jsx("tr",{onClick:()=>t&&t(r),className:`
                border-b border-[rgba(255,255,255,0.05)] transition-colors duration-200
                ${t?"cursor-pointer hover:bg-[rgba(0,243,255,0.05)]":""}
                group
              `,children:n.map((i,o)=>g.jsx("td",{className:"py-3 px-4 text-white group-hover:text-[var(--hud-accent)] transition-colors",children:i.render?i.render(r):r[i.accessor]},o))},r.id||s))})]})}),e0=()=>{const[n,e]=E.useState({requests:0,bandwidth:0,latency:0,savings:0,hitRate:0,uptime:100}),[t,r]=E.useState([]),[s,i]=E.useState(!0);return E.useEffect(()=>{const o=async()=>{try{const u=await(await fetch("/api/admin-stats",{headers:{Authorization:`Bearer ${localStorage.getItem("agentcache_token")}`}})).json();u&&!u.error&&e({requests:u.total_requests_today||0,bandwidth:Math.round((u.tokens_saved_today||0)/1e3),latency:42,savings:u.cost_saved_today?parseFloat(u.cost_saved_today.replace("$","")):0,hitRate:u.hit_rate||0,uptime:99.9})}catch(c){console.error("Failed to fetch admin stats:",c)}finally{i(!1)}};o();const a=setInterval(o,3e4),l=new EventSource("/api/events/stream");return l.onmessage=c=>{const u=JSON.parse(c.data);if(u.type==="sys:connected")return;const d={id:Date.now(),type:u.type.toUpperCase(),source:u.agentId||"System",hash:u.hash?`${u.hash.substring(0,8)}...`:"-",time:new Date().toLocaleTimeString()};r(h=>[d,...h].slice(0,10))},()=>{clearInterval(a),l.close()}},[]),g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[g.jsx(Ue,{title:"Global Grid Status",icon:lf,className:"lg:col-span-2 min-h-[300px]",children:g.jsxs("div",{className:"w-full h-full flex items-center justify-center bg-[rgba(0,0,0,0.3)] rounded border border-[rgba(255,255,255,0.05)] relative overflow-hidden",children:[g.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--hud-accent)_0%,_transparent_70%)] opacity-10 animate-pulse"}),g.jsxs("div",{className:"text-center",children:[g.jsx(lf,{size:64,className:"mx-auto text-[var(--hud-accent)] opacity-50 mb-4"}),g.jsxs("p",{className:"text-[var(--hud-text-dim)] font-mono text-sm",children:["GRID VISUALIZATION ONLINE",g.jsx("br",{}),g.jsx("span",{className:"text-[var(--hud-success)]",children:"3 REGIONS ACTIVE"})]})]})]})}),g.jsx(Ue,{title:"System Health",icon:ss,className:"flex flex-col justify-center",children:g.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[g.jsx(cl,{value:n.uptime,label:"Uptime",sublabel:"30 Days",color:"var(--hud-success)"}),g.jsx(cl,{value:n.hitRate,label:"Cache Hit",sublabel:"Global",color:"var(--hud-accent)"}),g.jsx(cl,{value:42,max:100,label:"CPU Load",sublabel:"Cluster",color:"var(--hud-warning)"}),g.jsx(cl,{value:12,max:100,label:"Memory",sublabel:"Usage",color:"var(--hud-accent-secondary)"})]})})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[g.jsxs(Ue,{className:"p-0",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Total Requests"}),g.jsx("h3",{className:"text-2xl font-mono font-bold text-white",children:n.requests.toLocaleString()})]}),g.jsx(yu,{className:"text-[var(--hud-accent)] opacity-50",size:24})]}),g.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:g.jsx("span",{children:"Today"})})]}),g.jsxs(Ue,{className:"p-0",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Tokens Saved"}),g.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:[n.bandwidth.toLocaleString()," k"]})]}),g.jsx(j_,{className:"text-[var(--hud-accent-secondary)] opacity-50",size:24})]}),g.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:g.jsx("span",{children:"Est. Bandwidth"})})]}),g.jsxs(Ue,{className:"p-0",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Avg Latency"}),g.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:[n.latency,"ms"]})]}),g.jsx(ss,{className:"text-[var(--hud-warning)] opacity-50",size:24})]}),g.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:g.jsx("span",{children:"Global Avg"})})]}),g.jsxs(Ue,{className:"p-0",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Cost Savings"}),g.jsxs("h3",{className:"text-2xl font-mono font-bold text-white",children:["$",n.savings.toFixed(2)]})]}),g.jsx(G_,{className:"text-[var(--hud-success)] opacity-50",size:24})]}),g.jsx("div",{className:"mt-2 text-xs text-[var(--hud-success)] flex items-center",children:g.jsx("span",{children:"Today"})})]})]}),g.jsxs(Ue,{title:"Live Event Stream",icon:SC,action:g.jsx("button",{className:"text-xs text-[var(--hud-accent)] hover:underline",children:"View All"}),children:[g.jsx(Sa,{columns:[{header:"Time",accessor:"time"},{header:"Type",accessor:"type",render:o=>g.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${o.type.includes("HIT")?"bg-green-500/10 text-green-400":o.type.includes("MISS")?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400"}`,children:o.type})},{header:"Source",accessor:"source"},{header:"Hash / ID",accessor:"hash",render:o=>g.jsx("span",{className:"font-mono text-[var(--hud-text-dim)]",children:o.hash})}],data:t}),t.length===0&&g.jsx("div",{className:"p-4 text-center text-[var(--hud-text-dim)] italic",children:"Waiting for events..."})]})]})};function zt(n){if(typeof n=="string"||typeof n=="number")return""+n;let e="";if(Array.isArray(n))for(let t=0,r;t<n.length;t++)(r=zt(n[t]))!==""&&(e+=(e&&" ")+r);else for(let t in n)n[t]&&(e+=(e&&" ")+t);return e}const wR={},t0=n=>{let e;const t=new Set,r=(u,d)=>{const h=typeof u=="function"?u(e):u;if(!Object.is(h,e)){const f=e;e=d??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(p=>p(e,f))}},s=()=>e,l={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(wR?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=n(r,s,l);return l},SR=n=>n?t0(n):t0,{useDebugValue:NR}=K,{useSyncExternalStoreWithSelector:AR}=kE,ER=n=>n;function q_(n,e=ER,t){const r=AR(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return NR(r),r}const n0=(n,e)=>{const t=SR(n),r=(s,i=e)=>q_(t,s,i);return Object.assign(r,t),r},CR=(n,e)=>n?n0(n,e):n0;function Lt(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(const[r,s]of n)if(!Object.is(s,e.get(r)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(const r of n)if(!e.has(r))return!1;return!0}const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(const r of t)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(n[r],e[r]))return!1;return!0}var RR={value:()=>{}};function Xa(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new cc(t)}function cc(n){this._=n}function MR(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",s=t.indexOf(".");if(s>=0&&(r=t.slice(s+1),t=t.slice(0,s)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}cc.prototype=Xa.prototype={constructor:cc,on:function(n,e){var t=this._,r=MR(n+"",t),s,i=-1,o=r.length;if(arguments.length<2){for(;++i<o;)if((s=(n=r[i]).type)&&(s=PR(t[s],n.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<o;)if(s=(n=r[i]).type)t[s]=r0(t[s],n.name,e);else if(e==null)for(s in t)t[s]=r0(t[s],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new cc(n)},call:function(n,e){if((s=arguments.length-2)>0)for(var t=new Array(s),r=0,s,i;r<s;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(i=this._[n],r=0,s=i.length;r<s;++r)i[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],s=0,i=r.length;s<i;++s)r[s].value.apply(e,t)}};function PR(n,e){for(var t=0,r=n.length,s;t<r;++t)if((s=n[t]).name===e)return s.value}function r0(n,e,t){for(var r=0,s=n.length;r<s;++r)if(n[r].name===e){n[r]=RR,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var hf="http://www.w3.org/1999/xhtml";const s0={svg:"http://www.w3.org/2000/svg",xhtml:hf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bu(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),s0.hasOwnProperty(e)?{space:s0[e],local:n}:n}function DR(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===hf&&e.documentElement.namespaceURI===hf?e.createElement(n):e.createElementNS(t,n)}}function BR(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function X_(n){var e=bu(n);return(e.local?BR:DR)(e)}function kR(){}function Kp(n){return n==null?kR:function(){return this.querySelector(n)}}function FR(n){typeof n!="function"&&(n=Kp(n));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var i=e[s],o=i.length,a=r[s]=new Array(o),l,c,u=0;u<o;++u)(l=i[u])&&(c=n.call(l,l.__data__,u,i))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new on(r,this._parents)}function LR(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function IR(){return[]}function K_(n){return n==null?IR:function(){return this.querySelectorAll(n)}}function OR(n){return function(){return LR(n.apply(this,arguments))}}function UR(n){typeof n=="function"?n=OR(n):n=K_(n);for(var e=this._groups,t=e.length,r=[],s=[],i=0;i<t;++i)for(var o=e[i],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(r.push(n.call(l,l.__data__,c,o)),s.push(l));return new on(r,s)}function Y_(n){return function(){return this.matches(n)}}function Q_(n){return function(e){return e.matches(n)}}var VR=Array.prototype.find;function jR(n){return function(){return VR.call(this.children,n)}}function GR(){return this.firstElementChild}function $R(n){return this.select(n==null?GR:jR(typeof n=="function"?n:Q_(n)))}var zR=Array.prototype.filter;function HR(){return Array.from(this.children)}function WR(n){return function(){return zR.call(this.children,n)}}function qR(n){return this.selectAll(n==null?HR:WR(typeof n=="function"?n:Q_(n)))}function XR(n){typeof n!="function"&&(n=Y_(n));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var i=e[s],o=i.length,a=r[s]=[],l,c=0;c<o;++c)(l=i[c])&&n.call(l,l.__data__,c,i)&&a.push(l);return new on(r,this._parents)}function Z_(n){return new Array(n.length)}function KR(){return new on(this._enter||this._groups.map(Z_),this._parents)}function kc(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}kc.prototype={constructor:kc,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function YR(n){return function(){return n}}function QR(n,e,t,r,s,i){for(var o=0,a,l=e.length,c=i.length;o<c;++o)(a=e[o])?(a.__data__=i[o],r[o]=a):t[o]=new kc(n,i[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function ZR(n,e,t,r,s,i,o){var a,l,c=new Map,u=e.length,d=i.length,h=new Array(u),f;for(a=0;a<u;++a)(l=e[a])&&(h[a]=f=o.call(l,l.__data__,a,e)+"",c.has(f)?s[a]=l:c.set(f,l));for(a=0;a<d;++a)f=o.call(n,i[a],a,i)+"",(l=c.get(f))?(r[a]=l,l.__data__=i[a],c.delete(f)):t[a]=new kc(n,i[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(h[a])===l&&(s[a]=l)}function JR(n){return n.__data__}function eM(n,e){if(!arguments.length)return Array.from(this,JR);var t=e?ZR:QR,r=this._parents,s=this._groups;typeof n!="function"&&(n=YR(n));for(var i=s.length,o=new Array(i),a=new Array(i),l=new Array(i),c=0;c<i;++c){var u=r[c],d=s[c],h=d.length,f=tM(n.call(u,u&&u.__data__,c,r)),p=f.length,m=a[c]=new Array(p),y=o[c]=new Array(p),x=l[c]=new Array(h);t(u,d,m,y,x,f,e);for(var b=0,v=0,_,w;b<p;++b)if(_=m[b]){for(b>=v&&(v=b+1);!(w=y[v])&&++v<p;);_._next=w||null}}return o=new on(o,r),o._enter=a,o._exit=l,o}function tM(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function nM(){return new on(this._exit||this._groups.map(Z_),this._parents)}function rM(n,e,t){var r=this.enter(),s=this,i=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(s=e(s),s&&(s=s.selection())),t==null?i.remove():t(i),r&&s?r.merge(s).order():s}function sM(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,s=t.length,i=r.length,o=Math.min(s,i),a=new Array(s),l=0;l<o;++l)for(var c=t[l],u=r[l],d=c.length,h=a[l]=new Array(d),f,p=0;p<d;++p)(f=c[p]||u[p])&&(h[p]=f);for(;l<s;++l)a[l]=t[l];return new on(a,this._parents)}function iM(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],s=r.length-1,i=r[s],o;--s>=0;)(o=r[s])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function oM(n){n||(n=aM);function e(d,h){return d&&h?n(d.__data__,h.__data__):!d-!h}for(var t=this._groups,r=t.length,s=new Array(r),i=0;i<r;++i){for(var o=t[i],a=o.length,l=s[i]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new on(s,this._parents).order()}function aM(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function lM(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function cM(){return Array.from(this)}function uM(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],s=0,i=r.length;s<i;++s){var o=r[s];if(o)return o}return null}function dM(){let n=0;for(const e of this)++n;return n}function hM(){return!this.node()}function fM(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var s=e[t],i=0,o=s.length,a;i<o;++i)(a=s[i])&&n.call(a,a.__data__,i,s);return this}function pM(n){return function(){this.removeAttribute(n)}}function mM(n){return function(){this.removeAttributeNS(n.space,n.local)}}function gM(n,e){return function(){this.setAttribute(n,e)}}function xM(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function yM(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function bM(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function vM(n,e){var t=bu(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?mM:pM:typeof e=="function"?t.local?bM:yM:t.local?xM:gM)(t,e))}function J_(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function _M(n){return function(){this.style.removeProperty(n)}}function TM(n,e,t){return function(){this.style.setProperty(n,e,t)}}function wM(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function SM(n,e,t){return arguments.length>1?this.each((e==null?_M:typeof e=="function"?wM:TM)(n,e,t??"")):Xi(this.node(),n)}function Xi(n,e){return n.style.getPropertyValue(e)||J_(n).getComputedStyle(n,null).getPropertyValue(e)}function NM(n){return function(){delete this[n]}}function AM(n,e){return function(){this[n]=e}}function EM(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function CM(n,e){return arguments.length>1?this.each((e==null?NM:typeof e=="function"?EM:AM)(n,e)):this.node()[n]}function eT(n){return n.trim().split(/^|\s+/)}function Yp(n){return n.classList||new tT(n)}function tT(n){this._node=n,this._names=eT(n.getAttribute("class")||"")}tT.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function nT(n,e){for(var t=Yp(n),r=-1,s=e.length;++r<s;)t.add(e[r])}function rT(n,e){for(var t=Yp(n),r=-1,s=e.length;++r<s;)t.remove(e[r])}function RM(n){return function(){nT(this,n)}}function MM(n){return function(){rT(this,n)}}function PM(n,e){return function(){(e.apply(this,arguments)?nT:rT)(this,n)}}function DM(n,e){var t=eT(n+"");if(arguments.length<2){for(var r=Yp(this.node()),s=-1,i=t.length;++s<i;)if(!r.contains(t[s]))return!1;return!0}return this.each((typeof e=="function"?PM:e?RM:MM)(t,e))}function BM(){this.textContent=""}function kM(n){return function(){this.textContent=n}}function FM(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function LM(n){return arguments.length?this.each(n==null?BM:(typeof n=="function"?FM:kM)(n)):this.node().textContent}function IM(){this.innerHTML=""}function OM(n){return function(){this.innerHTML=n}}function UM(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function VM(n){return arguments.length?this.each(n==null?IM:(typeof n=="function"?UM:OM)(n)):this.node().innerHTML}function jM(){this.nextSibling&&this.parentNode.appendChild(this)}function GM(){return this.each(jM)}function $M(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function zM(){return this.each($M)}function HM(n){var e=typeof n=="function"?n:X_(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function WM(){return null}function qM(n,e){var t=typeof n=="function"?n:X_(n),r=e==null?WM:typeof e=="function"?e:Kp(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function XM(){var n=this.parentNode;n&&n.removeChild(this)}function KM(){return this.each(XM)}function YM(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function QM(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function ZM(n){return this.select(n?QM:YM)}function JM(n){return arguments.length?this.property("__data__",n):this.node().__data__}function e3(n){return function(e){n.call(this,e,this.__data__)}}function t3(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function n3(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,s=e.length,i;t<s;++t)i=e[t],(!n.type||i.type===n.type)&&i.name===n.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function r3(n,e,t){return function(){var r=this.__on,s,i=e3(e);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===n.type&&s.name===n.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=i,s.options=t),s.value=e;return}}this.addEventListener(n.type,i,t),s={type:n.type,name:n.name,value:e,listener:i,options:t},r?r.push(s):this.__on=[s]}}function s3(n,e,t){var r=t3(n+""),s,i=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(s=0,u=a[l];s<i;++s)if((o=r[s]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?r3:n3,s=0;s<i;++s)this.each(a(r[s],e,t));return this}function sT(n,e,t){var r=J_(n),s=r.CustomEvent;typeof s=="function"?s=new s(e,t):(s=r.document.createEvent("Event"),t?(s.initEvent(e,t.bubbles,t.cancelable),s.detail=t.detail):s.initEvent(e,!1,!1)),n.dispatchEvent(s)}function i3(n,e){return function(){return sT(this,n,e)}}function o3(n,e){return function(){return sT(this,n,e.apply(this,arguments))}}function a3(n,e){return this.each((typeof e=="function"?o3:i3)(n,e))}function*l3(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],s=0,i=r.length,o;s<i;++s)(o=r[s])&&(yield o)}var iT=[null];function on(n,e){this._groups=n,this._parents=e}function Ka(){return new on([[document.documentElement]],iT)}function c3(){return this}on.prototype=Ka.prototype={constructor:on,select:FR,selectAll:UR,selectChild:$R,selectChildren:qR,filter:XR,data:eM,enter:KR,exit:nM,join:rM,merge:sM,selection:c3,order:iM,sort:oM,call:lM,nodes:cM,node:uM,size:dM,empty:hM,each:fM,attr:vM,style:SM,property:CM,classed:DM,text:LM,html:VM,raise:GM,lower:zM,append:HM,insert:qM,remove:KM,clone:ZM,datum:JM,on:s3,dispatch:a3,[Symbol.iterator]:l3};function Bt(n){return typeof n=="string"?new on([[document.querySelector(n)]],[document.documentElement]):new on([[n]],iT)}function u3(n){let e;for(;e=n.sourceEvent;)n=e;return n}function Nn(n,e){if(n=u3(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[n.clientX-s.left-e.clientLeft,n.clientY-s.top-e.clientTop]}}return[n.pageX,n.pageY]}const d3={passive:!1},Na={capture:!0,passive:!1};function rd(n){n.stopImmediatePropagation()}function ki(n){n.preventDefault(),n.stopImmediatePropagation()}function oT(n){var e=n.document.documentElement,t=Bt(n).on("dragstart.drag",ki,Na);"onselectstart"in e?t.on("selectstart.drag",ki,Na):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function aT(n,e){var t=n.document.documentElement,r=Bt(n).on("dragstart.drag",null);e&&(r.on("click.drag",ki,Na),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const ul=n=>()=>n;function ff(n,{sourceEvent:e,subject:t,target:r,identifier:s,active:i,x:o,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}ff.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function h3(n){return!n.ctrlKey&&!n.button}function f3(){return this.parentNode}function p3(n,e){return e??{x:n.x,y:n.y}}function m3(){return navigator.maxTouchPoints||"ontouchstart"in this}function g3(){var n=h3,e=f3,t=p3,r=m3,s={},i=Xa("start","drag","end"),o=0,a,l,c,u,d=0;function h(_){_.on("mousedown.drag",f).filter(r).on("touchstart.drag",y).on("touchmove.drag",x,d3).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(_,w){if(!(u||!n.call(this,_,w))){var T=v(this,e.call(this,_,w),_,w,"mouse");T&&(Bt(_.view).on("mousemove.drag",p,Na).on("mouseup.drag",m,Na),oT(_.view),rd(_),c=!1,a=_.clientX,l=_.clientY,T("start",_))}}function p(_){if(ki(_),!c){var w=_.clientX-a,T=_.clientY-l;c=w*w+T*T>d}s.mouse("drag",_)}function m(_){Bt(_.view).on("mousemove.drag mouseup.drag",null),aT(_.view,c),ki(_),s.mouse("end",_)}function y(_,w){if(n.call(this,_,w)){var T=_.changedTouches,N=e.call(this,_,w),S=T.length,C,D;for(C=0;C<S;++C)(D=v(this,N,_,w,T[C].identifier,T[C]))&&(rd(_),D("start",_,T[C]))}}function x(_){var w=_.changedTouches,T=w.length,N,S;for(N=0;N<T;++N)(S=s[w[N].identifier])&&(ki(_),S("drag",_,w[N]))}function b(_){var w=_.changedTouches,T=w.length,N,S;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),N=0;N<T;++N)(S=s[w[N].identifier])&&(rd(_),S("end",_,w[N]))}function v(_,w,T,N,S,C){var D=i.copy(),F=Nn(C||T,w),j,z,A;if((A=t.call(_,new ff("beforestart",{sourceEvent:T,target:h,identifier:S,active:o,x:F[0],y:F[1],dx:0,dy:0,dispatch:D}),N))!=null)return j=A.x-F[0]||0,z=A.y-F[1]||0,function O(k,R,I){var P=F,W;switch(k){case"start":s[S]=O,W=o++;break;case"end":delete s[S],--o;case"drag":F=Nn(I||R,w),W=o;break}D.call(k,_,new ff(k,{sourceEvent:R,subject:A,target:h,identifier:S,active:W,x:F[0]+j,y:F[1]+z,dx:F[0]-P[0],dy:F[1]-P[1],dispatch:D}),N)}}return h.filter=function(_){return arguments.length?(n=typeof _=="function"?_:ul(!!_),h):n},h.container=function(_){return arguments.length?(e=typeof _=="function"?_:ul(_),h):e},h.subject=function(_){return arguments.length?(t=typeof _=="function"?_:ul(_),h):t},h.touchable=function(_){return arguments.length?(r=typeof _=="function"?_:ul(!!_),h):r},h.on=function(){var _=i.on.apply(i,arguments);return _===i?h:_},h.clickDistance=function(_){return arguments.length?(d=(_=+_)*_,h):Math.sqrt(d)},h}function Qp(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function lT(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function Ya(){}var Aa=.7,Fc=1/Aa,Fi="\\s*([+-]?\\d+)\\s*",Ea="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",x3=/^#([0-9a-f]{3,8})$/,y3=new RegExp(`^rgb\\(${Fi},${Fi},${Fi}\\)$`),b3=new RegExp(`^rgb\\(${Zn},${Zn},${Zn}\\)$`),v3=new RegExp(`^rgba\\(${Fi},${Fi},${Fi},${Ea}\\)$`),_3=new RegExp(`^rgba\\(${Zn},${Zn},${Zn},${Ea}\\)$`),T3=new RegExp(`^hsl\\(${Ea},${Zn},${Zn}\\)$`),w3=new RegExp(`^hsla\\(${Ea},${Zn},${Zn},${Ea}\\)$`),i0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Qp(Ya,Ca,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:o0,formatHex:o0,formatHex8:S3,formatHsl:N3,formatRgb:a0,toString:a0});function o0(){return this.rgb().formatHex()}function S3(){return this.rgb().formatHex8()}function N3(){return cT(this).formatHsl()}function a0(){return this.rgb().formatRgb()}function Ca(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=x3.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?l0(e):t===3?new qt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?dl(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?dl(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=y3.exec(n))?new qt(e[1],e[2],e[3],1):(e=b3.exec(n))?new qt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=v3.exec(n))?dl(e[1],e[2],e[3],e[4]):(e=_3.exec(n))?dl(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=T3.exec(n))?d0(e[1],e[2]/100,e[3]/100,1):(e=w3.exec(n))?d0(e[1],e[2]/100,e[3]/100,e[4]):i0.hasOwnProperty(n)?l0(i0[n]):n==="transparent"?new qt(NaN,NaN,NaN,0):null}function l0(n){return new qt(n>>16&255,n>>8&255,n&255,1)}function dl(n,e,t,r){return r<=0&&(n=e=t=NaN),new qt(n,e,t,r)}function A3(n){return n instanceof Ya||(n=Ca(n)),n?(n=n.rgb(),new qt(n.r,n.g,n.b,n.opacity)):new qt}function pf(n,e,t,r){return arguments.length===1?A3(n):new qt(n,e,t,r??1)}function qt(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}Qp(qt,pf,lT(Ya,{brighter(n){return n=n==null?Fc:Math.pow(Fc,n),new qt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Aa:Math.pow(Aa,n),new qt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new qt(zs(this.r),zs(this.g),zs(this.b),Lc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:c0,formatHex:c0,formatHex8:E3,formatRgb:u0,toString:u0}));function c0(){return`#${Ls(this.r)}${Ls(this.g)}${Ls(this.b)}`}function E3(){return`#${Ls(this.r)}${Ls(this.g)}${Ls(this.b)}${Ls((isNaN(this.opacity)?1:this.opacity)*255)}`}function u0(){const n=Lc(this.opacity);return`${n===1?"rgb(":"rgba("}${zs(this.r)}, ${zs(this.g)}, ${zs(this.b)}${n===1?")":`, ${n})`}`}function Lc(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function zs(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Ls(n){return n=zs(n),(n<16?"0":"")+n.toString(16)}function d0(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Rn(n,e,t,r)}function cT(n){if(n instanceof Rn)return new Rn(n.h,n.s,n.l,n.opacity);if(n instanceof Ya||(n=Ca(n)),!n)return new Rn;if(n instanceof Rn)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,s=Math.min(e,t,r),i=Math.max(e,t,r),o=NaN,a=i-s,l=(i+s)/2;return a?(e===i?o=(t-r)/a+(t<r)*6:t===i?o=(r-e)/a+2:o=(e-t)/a+4,a/=l<.5?i+s:2-i-s,o*=60):a=l>0&&l<1?0:o,new Rn(o,a,l,n.opacity)}function C3(n,e,t,r){return arguments.length===1?cT(n):new Rn(n,e,t,r??1)}function Rn(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}Qp(Rn,C3,lT(Ya,{brighter(n){return n=n==null?Fc:Math.pow(Fc,n),new Rn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Aa:Math.pow(Aa,n),new Rn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,s=2*t-r;return new qt(sd(n>=240?n-240:n+120,s,r),sd(n,s,r),sd(n<120?n+240:n-120,s,r),this.opacity)},clamp(){return new Rn(h0(this.h),hl(this.s),hl(this.l),Lc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Lc(this.opacity);return`${n===1?"hsl(":"hsla("}${h0(this.h)}, ${hl(this.s)*100}%, ${hl(this.l)*100}%${n===1?")":`, ${n})`}`}}));function h0(n){return n=(n||0)%360,n<0?n+360:n}function hl(n){return Math.max(0,Math.min(1,n||0))}function sd(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const uT=n=>()=>n;function R3(n,e){return function(t){return n+t*e}}function M3(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function P3(n){return(n=+n)==1?dT:function(e,t){return t-e?M3(e,t,n):uT(isNaN(e)?t:e)}}function dT(n,e){var t=e-n;return t?R3(n,t):uT(isNaN(n)?e:n)}const f0=(function n(e){var t=P3(e);function r(s,i){var o=t((s=pf(s)).r,(i=pf(i)).r),a=t(s.g,i.g),l=t(s.b,i.b),c=dT(s.opacity,i.opacity);return function(u){return s.r=o(u),s.g=a(u),s.b=l(u),s.opacity=c(u),s+""}}return r.gamma=n,r})(1);function $r(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var mf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,id=new RegExp(mf.source,"g");function D3(n){return function(){return n}}function B3(n){return function(e){return n(e)+""}}function k3(n,e){var t=mf.lastIndex=id.lastIndex=0,r,s,i,o=-1,a=[],l=[];for(n=n+"",e=e+"";(r=mf.exec(n))&&(s=id.exec(e));)(i=s.index)>t&&(i=e.slice(t,i),a[o]?a[o]+=i:a[++o]=i),(r=r[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:$r(r,s)})),t=id.lastIndex;return t<e.length&&(i=e.slice(t),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?B3(l[0].x):D3(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}var p0=180/Math.PI,gf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hT(n,e,t,r,s,i){var o,a,l;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(l=n*t+e*r)&&(t-=n*l,r-=e*l),(a=Math.sqrt(t*t+r*r))&&(t/=a,r/=a,l/=a),n*r<e*t&&(n=-n,e=-e,l=-l,o=-o),{translateX:s,translateY:i,rotate:Math.atan2(e,n)*p0,skewX:Math.atan(l)*p0,scaleX:o,scaleY:a}}var fl;function F3(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?gf:hT(e.a,e.b,e.c,e.d,e.e,e.f)}function L3(n){return n==null||(fl||(fl=document.createElementNS("http://www.w3.org/2000/svg","g")),fl.setAttribute("transform",n),!(n=fl.transform.baseVal.consolidate()))?gf:(n=n.matrix,hT(n.a,n.b,n.c,n.d,n.e,n.f))}function fT(n,e,t,r){function s(c){return c.length?c.pop()+" ":""}function i(c,u,d,h,f,p){if(c!==d||u!==h){var m=f.push("translate(",null,e,null,t);p.push({i:m-4,x:$r(c,d)},{i:m-2,x:$r(u,h)})}else(d||h)&&f.push("translate("+d+e+h+t)}function o(c,u,d,h){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),h.push({i:d.push(s(d)+"rotate(",null,r)-2,x:$r(c,u)})):u&&d.push(s(d)+"rotate("+u+r)}function a(c,u,d,h){c!==u?h.push({i:d.push(s(d)+"skewX(",null,r)-2,x:$r(c,u)}):u&&d.push(s(d)+"skewX("+u+r)}function l(c,u,d,h,f,p){if(c!==d||u!==h){var m=f.push(s(f)+"scale(",null,",",null,")");p.push({i:m-4,x:$r(c,d)},{i:m-2,x:$r(u,h)})}else(d!==1||h!==1)&&f.push(s(f)+"scale("+d+","+h+")")}return function(c,u){var d=[],h=[];return c=n(c),u=n(u),i(c.translateX,c.translateY,u.translateX,u.translateY,d,h),o(c.rotate,u.rotate,d,h),a(c.skewX,u.skewX,d,h),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,h),c=u=null,function(f){for(var p=-1,m=h.length,y;++p<m;)d[(y=h[p]).i]=y.x(f);return d.join("")}}}var I3=fT(F3,"px, ","px)","deg)"),O3=fT(L3,", ",")",")"),U3=1e-12;function m0(n){return((n=Math.exp(n))+1/n)/2}function V3(n){return((n=Math.exp(n))-1/n)/2}function j3(n){return((n=Math.exp(2*n))-1)/(n+1)}const G3=(function n(e,t,r){function s(i,o){var a=i[0],l=i[1],c=i[2],u=o[0],d=o[1],h=o[2],f=u-a,p=d-l,m=f*f+p*p,y,x;if(m<U3)x=Math.log(h/c)/e,y=function(N){return[a+N*f,l+N*p,c*Math.exp(e*N*x)]};else{var b=Math.sqrt(m),v=(h*h-c*c+r*m)/(2*c*t*b),_=(h*h-c*c-r*m)/(2*h*t*b),w=Math.log(Math.sqrt(v*v+1)-v),T=Math.log(Math.sqrt(_*_+1)-_);x=(T-w)/e,y=function(N){var S=N*x,C=m0(w),D=c/(t*b)*(C*j3(e*S+w)-V3(w));return[a+D*f,l+D*p,c*C/m0(e*S+w)]}}return y.duration=x*1e3*e/Math.SQRT2,y}return s.rho=function(i){var o=Math.max(.001,+i),a=o*o,l=a*a;return n(o,a,l)},s})(Math.SQRT2,2,4);var Ki=0,Ko=0,So=0,pT=1e3,Ic,Yo,Oc=0,Ys=0,vu=0,Ra=typeof performance=="object"&&performance.now?performance:Date,mT=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Zp(){return Ys||(mT($3),Ys=Ra.now()+vu)}function $3(){Ys=0}function Uc(){this._call=this._time=this._next=null}Uc.prototype=Jp.prototype={constructor:Uc,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?Zp():+t)+(e==null?0:+e),!this._next&&Yo!==this&&(Yo?Yo._next=this:Ic=this,Yo=this),this._call=n,this._time=t,xf()},stop:function(){this._call&&(this._call=null,this._time=1/0,xf())}};function Jp(n,e,t){var r=new Uc;return r.restart(n,e,t),r}function z3(){Zp(),++Ki;for(var n=Ic,e;n;)(e=Ys-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Ki}function g0(){Ys=(Oc=Ra.now())+vu,Ki=Ko=0;try{z3()}finally{Ki=0,W3(),Ys=0}}function H3(){var n=Ra.now(),e=n-Oc;e>pT&&(vu-=e,Oc=n)}function W3(){for(var n,e=Ic,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Ic=t);Yo=n,xf(r)}function xf(n){if(!Ki){Ko&&(Ko=clearTimeout(Ko));var e=n-Ys;e>24?(n<1/0&&(Ko=setTimeout(g0,n-Ra.now()-vu)),So&&(So=clearInterval(So))):(So||(Oc=Ra.now(),So=setInterval(H3,pT)),Ki=1,mT(g0))}}function x0(n,e,t){var r=new Uc;return e=e==null?0:+e,r.restart(s=>{r.stop(),n(s+e)},e,t),r}var q3=Xa("start","end","cancel","interrupt"),X3=[],gT=0,y0=1,yf=2,uc=3,b0=4,bf=5,dc=6;function _u(n,e,t,r,s,i){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;K3(n,t,{name:e,index:r,group:s,on:q3,tween:X3,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:gT})}function em(n,e){var t=On(n,e);if(t.state>gT)throw new Error("too late; already scheduled");return t}function or(n,e){var t=On(n,e);if(t.state>uc)throw new Error("too late; already running");return t}function On(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function K3(n,e,t){var r=n.__transition,s;r[e]=t,t.timer=Jp(i,0,t.time);function i(c){t.state=y0,t.timer.restart(o,t.delay,t.time),t.delay<=c&&o(c-t.delay)}function o(c){var u,d,h,f;if(t.state!==y0)return l();for(u in r)if(f=r[u],f.name===t.name){if(f.state===uc)return x0(o);f.state===b0?(f.state=dc,f.timer.stop(),f.on.call("interrupt",n,n.__data__,f.index,f.group),delete r[u]):+u<e&&(f.state=dc,f.timer.stop(),f.on.call("cancel",n,n.__data__,f.index,f.group),delete r[u])}if(x0(function(){t.state===uc&&(t.state=b0,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=yf,t.on.call("start",n,n.__data__,t.index,t.group),t.state===yf){for(t.state=uc,s=new Array(h=t.tween.length),u=0,d=-1;u<h;++u)(f=t.tween[u].value.call(n,n.__data__,t.index,t.group))&&(s[++d]=f);s.length=d+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=bf,1),d=-1,h=s.length;++d<h;)s[d].call(n,u);t.state===bf&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=dc,t.timer.stop(),delete r[e];for(var c in r)return;delete n.__transition}}function hc(n,e){var t=n.__transition,r,s,i=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((r=t[o]).name!==e){i=!1;continue}s=r.state>yf&&r.state<bf,r.state=dc,r.timer.stop(),r.on.call(s?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[o]}i&&delete n.__transition}}function Y3(n){return this.each(function(){hc(this,n)})}function Q3(n,e){var t,r;return function(){var s=or(this,n),i=s.tween;if(i!==t){r=t=i;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}s.tween=r}}function Z3(n,e,t){var r,s;if(typeof t!="function")throw new Error;return function(){var i=or(this,n),o=i.tween;if(o!==r){s=(r=o).slice();for(var a={name:e,value:t},l=0,c=s.length;l<c;++l)if(s[l].name===e){s[l]=a;break}l===c&&s.push(a)}i.tween=s}}function J3(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=On(this.node(),t).tween,s=0,i=r.length,o;s<i;++s)if((o=r[s]).name===n)return o.value;return null}return this.each((e==null?Q3:Z3)(t,n,e))}function tm(n,e,t){var r=n._id;return n.each(function(){var s=or(this,r);(s.value||(s.value={}))[e]=t.apply(this,arguments)}),function(s){return On(s,r).value[e]}}function xT(n,e){var t;return(typeof e=="number"?$r:e instanceof Ca?f0:(t=Ca(e))?(e=t,f0):k3)(n,e)}function eP(n){return function(){this.removeAttribute(n)}}function tP(n){return function(){this.removeAttributeNS(n.space,n.local)}}function nP(n,e,t){var r,s=t+"",i;return function(){var o=this.getAttribute(n);return o===s?null:o===r?i:i=e(r=o,t)}}function rP(n,e,t){var r,s=t+"",i;return function(){var o=this.getAttributeNS(n.space,n.local);return o===s?null:o===r?i:i=e(r=o,t)}}function sP(n,e,t){var r,s,i;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),l=a+"",o===l?null:o===r&&l===s?i:(s=l,i=e(r=o,a)))}}function iP(n,e,t){var r,s,i;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),l=a+"",o===l?null:o===r&&l===s?i:(s=l,i=e(r=o,a)))}}function oP(n,e){var t=bu(n),r=t==="transform"?O3:xT;return this.attrTween(n,typeof e=="function"?(t.local?iP:sP)(t,r,tm(this,"attr."+n,e)):e==null?(t.local?tP:eP)(t):(t.local?rP:nP)(t,r,e))}function aP(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function lP(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function cP(n,e){var t,r;function s(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&lP(n,i)),t}return s._value=e,s}function uP(n,e){var t,r;function s(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&aP(n,i)),t}return s._value=e,s}function dP(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=bu(n);return this.tween(t,(r.local?cP:uP)(r,e))}function hP(n,e){return function(){em(this,n).delay=+e.apply(this,arguments)}}function fP(n,e){return e=+e,function(){em(this,n).delay=e}}function pP(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?hP:fP)(e,n)):On(this.node(),e).delay}function mP(n,e){return function(){or(this,n).duration=+e.apply(this,arguments)}}function gP(n,e){return e=+e,function(){or(this,n).duration=e}}function xP(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?mP:gP)(e,n)):On(this.node(),e).duration}function yP(n,e){if(typeof e!="function")throw new Error;return function(){or(this,n).ease=e}}function bP(n){var e=this._id;return arguments.length?this.each(yP(e,n)):On(this.node(),e).ease}function vP(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;or(this,n).ease=t}}function _P(n){if(typeof n!="function")throw new Error;return this.each(vP(this._id,n))}function TP(n){typeof n!="function"&&(n=Y_(n));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var i=e[s],o=i.length,a=r[s]=[],l,c=0;c<o;++c)(l=i[c])&&n.call(l,l.__data__,c,i)&&a.push(l);return new Mr(r,this._parents,this._name,this._id)}function wP(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,s=t.length,i=Math.min(r,s),o=new Array(r),a=0;a<i;++a)for(var l=e[a],c=t[a],u=l.length,d=o[a]=new Array(u),h,f=0;f<u;++f)(h=l[f]||c[f])&&(d[f]=h);for(;a<r;++a)o[a]=e[a];return new Mr(o,this._parents,this._name,this._id)}function SP(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function NP(n,e,t){var r,s,i=SP(e)?em:or;return function(){var o=i(this,n),a=o.on;a!==r&&(s=(r=a).copy()).on(e,t),o.on=s}}function AP(n,e){var t=this._id;return arguments.length<2?On(this.node(),t).on.on(n):this.each(NP(t,n,e))}function EP(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function CP(){return this.on("end.remove",EP(this._id))}function RP(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Kp(n));for(var r=this._groups,s=r.length,i=new Array(s),o=0;o<s;++o)for(var a=r[o],l=a.length,c=i[o]=new Array(l),u,d,h=0;h<l;++h)(u=a[h])&&(d=n.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),c[h]=d,_u(c[h],e,t,h,c,On(u,t)));return new Mr(i,this._parents,e,t)}function MP(n){var e=this._name,t=this._id;typeof n!="function"&&(n=K_(n));for(var r=this._groups,s=r.length,i=[],o=[],a=0;a<s;++a)for(var l=r[a],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var h=n.call(u,u.__data__,d,l),f,p=On(u,t),m=0,y=h.length;m<y;++m)(f=h[m])&&_u(f,e,t,m,h,p);i.push(h),o.push(u)}return new Mr(i,o,e,t)}var PP=Ka.prototype.constructor;function DP(){return new PP(this._groups,this._parents)}function BP(n,e){var t,r,s;return function(){var i=Xi(this,n),o=(this.style.removeProperty(n),Xi(this,n));return i===o?null:i===t&&o===r?s:s=e(t=i,r=o)}}function yT(n){return function(){this.style.removeProperty(n)}}function kP(n,e,t){var r,s=t+"",i;return function(){var o=Xi(this,n);return o===s?null:o===r?i:i=e(r=o,t)}}function FP(n,e,t){var r,s,i;return function(){var o=Xi(this,n),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),Xi(this,n))),o===l?null:o===r&&l===s?i:(s=l,i=e(r=o,a))}}function LP(n,e){var t,r,s,i="style."+e,o="end."+i,a;return function(){var l=or(this,n),c=l.on,u=l.value[i]==null?a||(a=yT(e)):void 0;(c!==t||s!==u)&&(r=(t=c).copy()).on(o,s=u),l.on=r}}function IP(n,e,t){var r=(n+="")=="transform"?I3:xT;return e==null?this.styleTween(n,BP(n,r)).on("end.style."+n,yT(n)):typeof e=="function"?this.styleTween(n,FP(n,r,tm(this,"style."+n,e))).each(LP(this._id,n)):this.styleTween(n,kP(n,r,e),t).on("end.style."+n,null)}function OP(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function UP(n,e,t){var r,s;function i(){var o=e.apply(this,arguments);return o!==s&&(r=(s=o)&&OP(n,o,t)),r}return i._value=e,i}function VP(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,UP(n,e,t??""))}function jP(n){return function(){this.textContent=n}}function GP(n){return function(){var e=n(this);this.textContent=e??""}}function $P(n){return this.tween("text",typeof n=="function"?GP(tm(this,"text",n)):jP(n==null?"":n+""))}function zP(n){return function(e){this.textContent=n.call(this,e)}}function HP(n){var e,t;function r(){var s=n.apply(this,arguments);return s!==t&&(e=(t=s)&&zP(s)),e}return r._value=n,r}function WP(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,HP(n))}function qP(){for(var n=this._name,e=this._id,t=bT(),r=this._groups,s=r.length,i=0;i<s;++i)for(var o=r[i],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=On(l,e);_u(l,n,t,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Mr(r,this._parents,n,t)}function XP(){var n,e,t=this,r=t._id,s=t.size();return new Promise(function(i,o){var a={value:o},l={value:function(){--s===0&&i()}};t.each(function(){var c=or(this,r),u=c.on;u!==n&&(e=(n=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),s===0&&i()})}var KP=0;function Mr(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function bT(){return++KP}var ur=Ka.prototype;Mr.prototype={constructor:Mr,select:RP,selectAll:MP,selectChild:ur.selectChild,selectChildren:ur.selectChildren,filter:TP,merge:wP,selection:DP,transition:qP,call:ur.call,nodes:ur.nodes,node:ur.node,size:ur.size,empty:ur.empty,each:ur.each,on:AP,attr:oP,attrTween:dP,style:IP,styleTween:VP,text:$P,textTween:WP,remove:CP,tween:J3,delay:pP,duration:xP,ease:bP,easeVarying:_P,end:XP,[Symbol.iterator]:ur[Symbol.iterator]};function YP(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var QP={time:null,delay:0,duration:250,ease:YP};function ZP(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function JP(n){var e,t;n instanceof Mr?(e=n._id,n=n._name):(e=bT(),(t=QP).time=Zp(),n=n==null?null:n+"");for(var r=this._groups,s=r.length,i=0;i<s;++i)for(var o=r[i],a=o.length,l,c=0;c<a;++c)(l=o[c])&&_u(l,n,e,c,o,t||ZP(l,e));return new Mr(r,this._parents,n,e)}Ka.prototype.interrupt=Y3;Ka.prototype.transition=JP;const pl=n=>()=>n;function eD(n,{sourceEvent:e,target:t,transform:r,dispatch:s}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function Sr(n,e,t){this.k=n,this.x=e,this.y=t}Sr.prototype={constructor:Sr,scale:function(n){return n===1?this:new Sr(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Sr(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var es=new Sr(1,0,0);Sr.prototype;function od(n){n.stopImmediatePropagation()}function No(n){n.preventDefault(),n.stopImmediatePropagation()}function tD(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function nD(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function v0(){return this.__zoom||es}function rD(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function sD(){return navigator.maxTouchPoints||"ontouchstart"in this}function iD(n,e,t){var r=n.invertX(e[0][0])-t[0][0],s=n.invertX(e[1][0])-t[1][0],i=n.invertY(e[0][1])-t[0][1],o=n.invertY(e[1][1])-t[1][1];return n.translate(s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function vT(){var n=tD,e=nD,t=iD,r=rD,s=sD,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=G3,c=Xa("start","zoom","end"),u,d,h,f=500,p=150,m=0,y=10;function x(A){A.property("__zoom",v0).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",D).filter(s).on("touchstart.zoom",F).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(A,O,k,R){var I=A.selection?A.selection():A;I.property("__zoom",v0),A!==I?w(A,O,k,R):I.interrupt().each(function(){T(this,arguments).event(R).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},x.scaleBy=function(A,O,k,R){x.scaleTo(A,function(){var I=this.__zoom.k,P=typeof O=="function"?O.apply(this,arguments):O;return I*P},k,R)},x.scaleTo=function(A,O,k,R){x.transform(A,function(){var I=e.apply(this,arguments),P=this.__zoom,W=k==null?_(I):typeof k=="function"?k.apply(this,arguments):k,L=P.invert(W),G=typeof O=="function"?O.apply(this,arguments):O;return t(v(b(P,G),W,L),I,o)},k,R)},x.translateBy=function(A,O,k,R){x.transform(A,function(){return t(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof k=="function"?k.apply(this,arguments):k),e.apply(this,arguments),o)},null,R)},x.translateTo=function(A,O,k,R,I){x.transform(A,function(){var P=e.apply(this,arguments),W=this.__zoom,L=R==null?_(P):typeof R=="function"?R.apply(this,arguments):R;return t(es.translate(L[0],L[1]).scale(W.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof k=="function"?-k.apply(this,arguments):-k),P,o)},R,I)};function b(A,O){return O=Math.max(i[0],Math.min(i[1],O)),O===A.k?A:new Sr(O,A.x,A.y)}function v(A,O,k){var R=O[0]-k[0]*A.k,I=O[1]-k[1]*A.k;return R===A.x&&I===A.y?A:new Sr(A.k,R,I)}function _(A){return[(+A[0][0]+ +A[1][0])/2,(+A[0][1]+ +A[1][1])/2]}function w(A,O,k,R){A.on("start.zoom",function(){T(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(R).end()}).tween("zoom",function(){var I=this,P=arguments,W=T(I,P).event(R),L=e.apply(I,P),G=k==null?_(L):typeof k=="function"?k.apply(I,P):k,Z=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),ee=I.__zoom,U=typeof O=="function"?O.apply(I,P):O,Q=l(ee.invert(G).concat(Z/ee.k),U.invert(G).concat(Z/U.k));return function(te){if(te===1)te=U;else{var le=Q(te),ye=Z/le[2];te=new Sr(ye,G[0]-le[0]*ye,G[1]-le[1]*ye)}W.zoom(null,te)}})}function T(A,O,k){return!k&&A.__zooming||new N(A,O)}function N(A,O){this.that=A,this.args=O,this.active=0,this.sourceEvent=null,this.extent=e.apply(A,O),this.taps=0}N.prototype={event:function(A){return A&&(this.sourceEvent=A),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(A,O){return this.mouse&&A!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&A!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&A!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(A){var O=Bt(this.that).datum();c.call(A,this.that,new eD(A,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:c}),O)}};function S(A,...O){if(!n.apply(this,arguments))return;var k=T(this,O).event(A),R=this.__zoom,I=Math.max(i[0],Math.min(i[1],R.k*Math.pow(2,r.apply(this,arguments)))),P=Nn(A);if(k.wheel)(k.mouse[0][0]!==P[0]||k.mouse[0][1]!==P[1])&&(k.mouse[1]=R.invert(k.mouse[0]=P)),clearTimeout(k.wheel);else{if(R.k===I)return;k.mouse=[P,R.invert(P)],hc(this),k.start()}No(A),k.wheel=setTimeout(W,p),k.zoom("mouse",t(v(b(R,I),k.mouse[0],k.mouse[1]),k.extent,o));function W(){k.wheel=null,k.end()}}function C(A,...O){if(h||!n.apply(this,arguments))return;var k=A.currentTarget,R=T(this,O,!0).event(A),I=Bt(A.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",Z,!0),P=Nn(A,k),W=A.clientX,L=A.clientY;oT(A.view),od(A),R.mouse=[P,this.__zoom.invert(P)],hc(this),R.start();function G(ee){if(No(ee),!R.moved){var U=ee.clientX-W,Q=ee.clientY-L;R.moved=U*U+Q*Q>m}R.event(ee).zoom("mouse",t(v(R.that.__zoom,R.mouse[0]=Nn(ee,k),R.mouse[1]),R.extent,o))}function Z(ee){I.on("mousemove.zoom mouseup.zoom",null),aT(ee.view,R.moved),No(ee),R.event(ee).end()}}function D(A,...O){if(n.apply(this,arguments)){var k=this.__zoom,R=Nn(A.changedTouches?A.changedTouches[0]:A,this),I=k.invert(R),P=k.k*(A.shiftKey?.5:2),W=t(v(b(k,P),R,I),e.apply(this,O),o);No(A),a>0?Bt(this).transition().duration(a).call(w,W,R,A):Bt(this).call(x.transform,W,R,A)}}function F(A,...O){if(n.apply(this,arguments)){var k=A.touches,R=k.length,I=T(this,O,A.changedTouches.length===R).event(A),P,W,L,G;for(od(A),W=0;W<R;++W)L=k[W],G=Nn(L,this),G=[G,this.__zoom.invert(G),L.identifier],I.touch0?!I.touch1&&I.touch0[2]!==G[2]&&(I.touch1=G,I.taps=0):(I.touch0=G,P=!0,I.taps=1+!!u);u&&(u=clearTimeout(u)),P&&(I.taps<2&&(d=G[0],u=setTimeout(function(){u=null},f)),hc(this),I.start())}}function j(A,...O){if(this.__zooming){var k=T(this,O).event(A),R=A.changedTouches,I=R.length,P,W,L,G;for(No(A),P=0;P<I;++P)W=R[P],L=Nn(W,this),k.touch0&&k.touch0[2]===W.identifier?k.touch0[0]=L:k.touch1&&k.touch1[2]===W.identifier&&(k.touch1[0]=L);if(W=k.that.__zoom,k.touch1){var Z=k.touch0[0],ee=k.touch0[1],U=k.touch1[0],Q=k.touch1[1],te=(te=U[0]-Z[0])*te+(te=U[1]-Z[1])*te,le=(le=Q[0]-ee[0])*le+(le=Q[1]-ee[1])*le;W=b(W,Math.sqrt(te/le)),L=[(Z[0]+U[0])/2,(Z[1]+U[1])/2],G=[(ee[0]+Q[0])/2,(ee[1]+Q[1])/2]}else if(k.touch0)L=k.touch0[0],G=k.touch0[1];else return;k.zoom("touch",t(v(W,L,G),k.extent,o))}}function z(A,...O){if(this.__zooming){var k=T(this,O).event(A),R=A.changedTouches,I=R.length,P,W;for(od(A),h&&clearTimeout(h),h=setTimeout(function(){h=null},f),P=0;P<I;++P)W=R[P],k.touch0&&k.touch0[2]===W.identifier?delete k.touch0:k.touch1&&k.touch1[2]===W.identifier&&delete k.touch1;if(k.touch1&&!k.touch0&&(k.touch0=k.touch1,delete k.touch1),k.touch0)k.touch0[1]=this.__zoom.invert(k.touch0[0]);else if(k.end(),k.taps===2&&(W=Nn(W,this),Math.hypot(d[0]-W[0],d[1]-W[1])<y)){var L=Bt(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return x.wheelDelta=function(A){return arguments.length?(r=typeof A=="function"?A:pl(+A),x):r},x.filter=function(A){return arguments.length?(n=typeof A=="function"?A:pl(!!A),x):n},x.touchable=function(A){return arguments.length?(s=typeof A=="function"?A:pl(!!A),x):s},x.extent=function(A){return arguments.length?(e=typeof A=="function"?A:pl([[+A[0][0],+A[0][1]],[+A[1][0],+A[1][1]]]),x):e},x.scaleExtent=function(A){return arguments.length?(i[0]=+A[0],i[1]=+A[1],x):[i[0],i[1]]},x.translateExtent=function(A){return arguments.length?(o[0][0]=+A[0][0],o[1][0]=+A[1][0],o[0][1]=+A[0][1],o[1][1]=+A[1][1],x):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},x.constrain=function(A){return arguments.length?(t=A,x):t},x.duration=function(A){return arguments.length?(a=+A,x):a},x.interpolate=function(A){return arguments.length?(l=A,x):l},x.on=function(){var A=c.on.apply(c,arguments);return A===c?x:A},x.clickDistance=function(A){return arguments.length?(m=(A=+A)*A,x):Math.sqrt(m)},x.tapDistance=function(A){return arguments.length?(y=+A,x):y},x}DE();const Tu=E.createContext(null),oD=Tu.Provider,Pr={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:n=>`Node type "${n}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:n=>`The old edge with id=${n} does not exist.`,error009:n=>`Marker type "${n}" doesn't exist.`,error008:(n,e)=>`Couldn't create edge for ${n?"target":"source"} handle id: "${n?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:n=>`Edge type "${n}" not found. Using fallback type "default".`,error012:n=>`Node with id "${n}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},_T=Pr.error001();function st(n,e){const t=E.useContext(Tu);if(t===null)throw new Error(_T);return q_(t,n,e)}const Tt=()=>{const n=E.useContext(Tu);if(n===null)throw new Error(_T);return E.useMemo(()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe,destroy:n.destroy}),[n])},aD=n=>n.userSelectionActive?"none":"all";function TT({position:n,children:e,className:t,style:r,...s}){const i=st(aD),o=`${n}`.split("-");return K.createElement("div",{className:zt(["react-flow__panel",t,...o]),style:{...r,pointerEvents:i},...s},e)}function lD({proOptions:n,position:e="bottom-right"}){return n?.hideAttribution?null:K.createElement(TT,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},K.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const cD=({x:n,y:e,label:t,labelStyle:r={},labelShowBg:s=!0,labelBgStyle:i={},labelBgPadding:o=[2,4],labelBgBorderRadius:a=2,children:l,className:c,...u})=>{const d=E.useRef(null),[h,f]=E.useState({x:0,y:0,width:0,height:0}),p=zt(["react-flow__edge-textwrapper",c]);return E.useEffect(()=>{if(d.current){const m=d.current.getBBox();f({x:m.x,y:m.y,width:m.width,height:m.height})}},[t]),typeof t>"u"||!t?null:K.createElement("g",{transform:`translate(${n-h.width/2} ${e-h.height/2})`,className:p,visibility:h.width?"visible":"hidden",...u},s&&K.createElement("rect",{width:h.width+2*o[0],x:-o[0],y:-o[1],height:h.height+2*o[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),K.createElement("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:d,style:r},t),l)};var uD=E.memo(cD);const nm=n=>({width:n.offsetWidth,height:n.offsetHeight}),Yi=(n,e=0,t=1)=>Math.min(Math.max(n,e),t),rm=(n={x:0,y:0},e)=>({x:Yi(n.x,e[0][0],e[1][0]),y:Yi(n.y,e[0][1],e[1][1])}),_0=(n,e,t)=>n<e?Yi(Math.abs(n-e),1,50)/50:n>t?-Yi(Math.abs(n-t),1,50)/50:0,wT=(n,e)=>{const t=_0(n.x,35,e.width-35)*20,r=_0(n.y,35,e.height-35)*20;return[t,r]},ST=n=>n.getRootNode?.()||window?.document,dD=(n,e)=>({x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}),sm=({x:n,y:e,width:t,height:r})=>({x:n,y:e,x2:n+t,y2:e+r}),hD=({x:n,y:e,x2:t,y2:r})=>({x:n,y:e,width:t-n,height:r-e}),T0=n=>({...n.positionAbsolute||{x:0,y:0},width:n.width||0,height:n.height||0}),vf=(n,e)=>{const t=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),r=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(t*r)},fD=n=>fn(n.width)&&fn(n.height)&&fn(n.x)&&fn(n.y),fn=n=>!isNaN(n)&&isFinite(n),at=Symbol.for("internals"),NT=["Enter"," ","Escape"],pD=(n,e)=>{},mD=n=>"nativeEvent"in n;function _f(n){const t=(mD(n)?n.nativeEvent:n).composedPath?.()?.[0]||n.target;return["INPUT","SELECT","TEXTAREA"].includes(t?.nodeName)||t?.hasAttribute("contenteditable")||!!t?.closest(".nokey")}const AT=n=>"clientX"in n,ts=(n,e)=>{const t=AT(n),r=t?n.clientX:n.touches?.[0].clientX,s=t?n.clientY:n.touches?.[0].clientY;return{x:r-(e?.left??0),y:s-(e?.top??0)}},Vc=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Qa=({id:n,path:e,labelX:t,labelY:r,label:s,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:f=20})=>K.createElement(K.Fragment,null,K.createElement("path",{id:n,style:u,d:e,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:h}),f&&K.createElement("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),s&&fn(t)&&fn(r)?K.createElement(uD,{x:t,y:r,label:s,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c}):null);Qa.displayName="BaseEdge";function Ao(n,e,t){return t===void 0?t:r=>{const s=e().edges.find(i=>i.id===n);s&&t(r,{...s})}}function ET({sourceX:n,sourceY:e,targetX:t,targetY:r}){const s=Math.abs(t-n)/2,i=t<n?t+s:t-s,o=Math.abs(r-e)/2,a=r<e?r+o:r-o;return[i,a,s,o]}function CT({sourceX:n,sourceY:e,targetX:t,targetY:r,sourceControlX:s,sourceControlY:i,targetControlX:o,targetControlY:a}){const l=n*.125+s*.375+o*.375+t*.125,c=e*.125+i*.375+a*.375+r*.125,u=Math.abs(l-n),d=Math.abs(c-e);return[l,c,u,d]}var Qs;(function(n){n.Strict="strict",n.Loose="loose"})(Qs||(Qs={}));var Is;(function(n){n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal"})(Is||(Is={}));var Ma;(function(n){n.Partial="partial",n.Full="full"})(Ma||(Ma={}));var Wr;(function(n){n.Bezier="default",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n.SimpleBezier="simplebezier"})(Wr||(Wr={}));var jc;(function(n){n.Arrow="arrow",n.ArrowClosed="arrowclosed"})(jc||(jc={}));var he;(function(n){n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom"})(he||(he={}));function w0({pos:n,x1:e,y1:t,x2:r,y2:s}){return n===he.Left||n===he.Right?[.5*(e+r),t]:[e,.5*(t+s)]}function RT({sourceX:n,sourceY:e,sourcePosition:t=he.Bottom,targetX:r,targetY:s,targetPosition:i=he.Top}){const[o,a]=w0({pos:t,x1:n,y1:e,x2:r,y2:s}),[l,c]=w0({pos:i,x1:r,y1:s,x2:n,y2:e}),[u,d,h,f]=CT({sourceX:n,sourceY:e,targetX:r,targetY:s,sourceControlX:o,sourceControlY:a,targetControlX:l,targetControlY:c});return[`M${n},${e} C${o},${a} ${l},${c} ${r},${s}`,u,d,h,f]}const im=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,sourcePosition:s=he.Bottom,targetPosition:i=he.Top,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,interactionWidth:m})=>{const[y,x,b]=RT({sourceX:n,sourceY:e,sourcePosition:s,targetX:t,targetY:r,targetPosition:i});return K.createElement(Qa,{path:y,labelX:x,labelY:b,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,interactionWidth:m})});im.displayName="SimpleBezierEdge";const S0={[he.Left]:{x:-1,y:0},[he.Right]:{x:1,y:0},[he.Top]:{x:0,y:-1},[he.Bottom]:{x:0,y:1}},gD=({source:n,sourcePosition:e=he.Bottom,target:t})=>e===he.Left||e===he.Right?n.x<t.x?{x:1,y:0}:{x:-1,y:0}:n.y<t.y?{x:0,y:1}:{x:0,y:-1},N0=(n,e)=>Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));function xD({source:n,sourcePosition:e=he.Bottom,target:t,targetPosition:r=he.Top,center:s,offset:i}){const o=S0[e],a=S0[r],l={x:n.x+o.x*i,y:n.y+o.y*i},c={x:t.x+a.x*i,y:t.y+a.y*i},u=gD({source:l,sourcePosition:e,target:c}),d=u.x!==0?"x":"y",h=u[d];let f=[],p,m;const y={x:0,y:0},x={x:0,y:0},[b,v,_,w]=ET({sourceX:n.x,sourceY:n.y,targetX:t.x,targetY:t.y});if(o[d]*a[d]===-1){p=s.x??b,m=s.y??v;const N=[{x:p,y:l.y},{x:p,y:c.y}],S=[{x:l.x,y:m},{x:c.x,y:m}];o[d]===h?f=d==="x"?N:S:f=d==="x"?S:N}else{const N=[{x:l.x,y:c.y}],S=[{x:c.x,y:l.y}];if(d==="x"?f=o.x===h?S:N:f=o.y===h?N:S,e===r){const z=Math.abs(n[d]-t[d]);if(z<=i){const A=Math.min(i-1,i-z);o[d]===h?y[d]=(l[d]>n[d]?-1:1)*A:x[d]=(c[d]>t[d]?-1:1)*A}}if(e!==r){const z=d==="x"?"y":"x",A=o[d]===a[z],O=l[z]>c[z],k=l[z]<c[z];(o[d]===1&&(!A&&O||A&&k)||o[d]!==1&&(!A&&k||A&&O))&&(f=d==="x"?N:S)}const C={x:l.x+y.x,y:l.y+y.y},D={x:c.x+x.x,y:c.y+x.y},F=Math.max(Math.abs(C.x-f[0].x),Math.abs(D.x-f[0].x)),j=Math.max(Math.abs(C.y-f[0].y),Math.abs(D.y-f[0].y));F>=j?(p=(C.x+D.x)/2,m=f[0].y):(p=f[0].x,m=(C.y+D.y)/2)}return[[n,{x:l.x+y.x,y:l.y+y.y},...f,{x:c.x+x.x,y:c.y+x.y},t],p,m,_,w]}function yD(n,e,t,r){const s=Math.min(N0(n,e)/2,N0(e,t)/2,r),{x:i,y:o}=e;if(n.x===i&&i===t.x||n.y===o&&o===t.y)return`L${i} ${o}`;if(n.y===o){const c=n.x<t.x?-1:1,u=n.y<t.y?1:-1;return`L ${i+s*c},${o}Q ${i},${o} ${i},${o+s*u}`}const a=n.x<t.x?1:-1,l=n.y<t.y?-1:1;return`L ${i},${o+s*l}Q ${i},${o} ${i+s*a},${o}`}function Tf({sourceX:n,sourceY:e,sourcePosition:t=he.Bottom,targetX:r,targetY:s,targetPosition:i=he.Top,borderRadius:o=5,centerX:a,centerY:l,offset:c=20}){const[u,d,h,f,p]=xD({source:{x:n,y:e},sourcePosition:t,target:{x:r,y:s},targetPosition:i,center:{x:a,y:l},offset:c});return[u.reduce((y,x,b)=>{let v="";return b>0&&b<u.length-1?v=yD(u[b-1],x,u[b+1],o):v=`${b===0?"M":"L"}${x.x} ${x.y}`,y+=v,y},""),d,h,f,p]}const wu=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,label:s,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,sourcePosition:d=he.Bottom,targetPosition:h=he.Top,markerEnd:f,markerStart:p,pathOptions:m,interactionWidth:y})=>{const[x,b,v]=Tf({sourceX:n,sourceY:e,sourcePosition:d,targetX:t,targetY:r,targetPosition:h,borderRadius:m?.borderRadius,offset:m?.offset});return K.createElement(Qa,{path:x,labelX:b,labelY:v,label:s,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:f,markerStart:p,interactionWidth:y})});wu.displayName="SmoothStepEdge";const om=E.memo(n=>K.createElement(wu,{...n,pathOptions:E.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])}));om.displayName="StepEdge";function bD({sourceX:n,sourceY:e,targetX:t,targetY:r}){const[s,i,o,a]=ET({sourceX:n,sourceY:e,targetX:t,targetY:r});return[`M ${n},${e}L ${t},${r}`,s,i,o,a]}const am=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,label:s,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:f})=>{const[p,m,y]=bD({sourceX:n,sourceY:e,targetX:t,targetY:r});return K.createElement(Qa,{path:p,labelX:m,labelY:y,label:s,labelStyle:i,labelShowBg:o,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:f})});am.displayName="StraightEdge";function ml(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function A0({pos:n,x1:e,y1:t,x2:r,y2:s,c:i}){switch(n){case he.Left:return[e-ml(e-r,i),t];case he.Right:return[e+ml(r-e,i),t];case he.Top:return[e,t-ml(t-s,i)];case he.Bottom:return[e,t+ml(s-t,i)]}}function MT({sourceX:n,sourceY:e,sourcePosition:t=he.Bottom,targetX:r,targetY:s,targetPosition:i=he.Top,curvature:o=.25}){const[a,l]=A0({pos:t,x1:n,y1:e,x2:r,y2:s,c:o}),[c,u]=A0({pos:i,x1:r,y1:s,x2:n,y2:e,c:o}),[d,h,f,p]=CT({sourceX:n,sourceY:e,targetX:r,targetY:s,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${n},${e} C${a},${l} ${c},${u} ${r},${s}`,d,h,f,p]}const Gc=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,sourcePosition:s=he.Bottom,targetPosition:i=he.Top,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,pathOptions:m,interactionWidth:y})=>{const[x,b,v]=MT({sourceX:n,sourceY:e,sourcePosition:s,targetX:t,targetY:r,targetPosition:i,curvature:m?.curvature});return K.createElement(Qa,{path:x,labelX:b,labelY:v,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:p,interactionWidth:y})});Gc.displayName="BezierEdge";const lm=E.createContext(null),vD=lm.Provider;lm.Consumer;const _D=()=>E.useContext(lm),TD=n=>"id"in n&&"source"in n&&"target"in n,wD=({source:n,sourceHandle:e,target:t,targetHandle:r})=>`reactflow__edge-${n}${e||""}-${t}${r||""}`,wf=(n,e)=>typeof n>"u"?"":typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(r=>`${r}=${n[r]}`).join("&")}`,SD=(n,e)=>e.some(t=>t.source===n.source&&t.target===n.target&&(t.sourceHandle===n.sourceHandle||!t.sourceHandle&&!n.sourceHandle)&&(t.targetHandle===n.targetHandle||!t.targetHandle&&!n.targetHandle)),PT=(n,e)=>{if(!n.source||!n.target)return e;let t;return TD(n)?t={...n}:t={...n,id:wD(n)},SD(t,e)?e:e.concat(t)},Sf=({x:n,y:e},[t,r,s],i,[o,a])=>{const l={x:(n-t)/s,y:(e-r)/s};return i?{x:o*Math.round(l.x/o),y:a*Math.round(l.y/a)}:l},DT=({x:n,y:e},[t,r,s])=>({x:n*s+t,y:e*s+r}),Li=(n,e=[0,0])=>{if(!n)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const t=(n.width??0)*e[0],r=(n.height??0)*e[1],s={x:n.position.x-t,y:n.position.y-r};return{...s,positionAbsolute:n.positionAbsolute?{x:n.positionAbsolute.x-t,y:n.positionAbsolute.y-r}:s}},cm=(n,e=[0,0])=>{if(n.length===0)return{x:0,y:0,width:0,height:0};const t=n.reduce((r,s)=>{const{x:i,y:o}=Li(s,e).positionAbsolute;return dD(r,sm({x:i,y:o,width:s.width||0,height:s.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return hD(t)},BT=(n,e,[t,r,s]=[0,0,1],i=!1,o=!1,a=[0,0])=>{const l={x:(e.x-t)/s,y:(e.y-r)/s,width:e.width/s,height:e.height/s},c=[];return n.forEach(u=>{const{width:d,height:h,selectable:f=!0,hidden:p=!1}=u;if(o&&!f||p)return!1;const{positionAbsolute:m}=Li(u,a),y={x:m.x,y:m.y,width:d||0,height:h||0},x=vf(l,y),b=typeof d>"u"||typeof h>"u"||d===null||h===null,v=i&&x>0,_=(d||0)*(h||0);(b||v||x>=_||u.dragging)&&c.push(u)}),c},kT=(n,e)=>{const t=n.map(r=>r.id);return e.filter(r=>t.includes(r.source)||t.includes(r.target))},FT=(n,e,t,r,s,i=.1)=>{const o=e/(n.width*(1+i)),a=t/(n.height*(1+i)),l=Math.min(o,a),c=Yi(l,r,s),u=n.x+n.width/2,d=n.y+n.height/2,h=e/2-u*c,f=t/2-d*c;return{x:h,y:f,zoom:c}},As=(n,e=0)=>n.transition().duration(e);function E0(n,e,t,r){return(e[t]||[]).reduce((s,i)=>(`${n.id}-${i.id}-${t}`!==r&&s.push({id:i.id||null,type:t,nodeId:n.id,x:(n.positionAbsolute?.x??0)+i.x+i.width/2,y:(n.positionAbsolute?.y??0)+i.y+i.height/2}),s),[])}function ND(n,e,t,r,s,i){const{x:o,y:a}=ts(n),c=e.elementsFromPoint(o,a).find(p=>p.classList.contains("react-flow__handle"));if(c){const p=c.getAttribute("data-nodeid");if(p){const m=um(void 0,c),y=c.getAttribute("data-handleid"),x=i({nodeId:p,id:y,type:m});if(x){const b=s.find(v=>v.nodeId===p&&v.type===m&&v.id===y);return{handle:{id:y,type:m,nodeId:p,x:b?.x||t.x,y:b?.y||t.y},validHandleResult:x}}}}let u=[],d=1/0;if(s.forEach(p=>{const m=Math.sqrt((p.x-t.x)**2+(p.y-t.y)**2);if(m<=r){const y=i(p);m<=d&&(m<d?u=[{handle:p,validHandleResult:y}]:m===d&&u.push({handle:p,validHandleResult:y}),d=m)}}),!u.length)return{handle:null,validHandleResult:LT()};if(u.length===1)return u[0];const h=u.some(({validHandleResult:p})=>p.isValid),f=u.some(({handle:p})=>p.type==="target");return u.find(({handle:p,validHandleResult:m})=>f?p.type==="target":h?m.isValid:!0)||u[0]}const AD={source:null,target:null,sourceHandle:null,targetHandle:null},LT=()=>({handleDomNode:null,isValid:!1,connection:AD,endHandle:null});function IT(n,e,t,r,s,i,o){const a=s==="target",l=o.querySelector(`.react-flow__handle[data-id="${n?.nodeId}-${n?.id}-${n?.type}"]`),c={...LT(),handleDomNode:l};if(l){const u=um(void 0,l),d=l.getAttribute("data-nodeid"),h=l.getAttribute("data-handleid"),f=l.classList.contains("connectable"),p=l.classList.contains("connectableend"),m={source:a?d:t,sourceHandle:a?h:r,target:a?t:d,targetHandle:a?r:h};c.connection=m,f&&p&&(e===Qs.Strict?a&&u==="source"||!a&&u==="target":d!==t||h!==r)&&(c.endHandle={nodeId:d,handleId:h,type:u},c.isValid=i(m))}return c}function ED({nodes:n,nodeId:e,handleId:t,handleType:r}){return n.reduce((s,i)=>{if(i[at]){const{handleBounds:o}=i[at];let a=[],l=[];o&&(a=E0(i,o,"source",`${e}-${t}-${r}`),l=E0(i,o,"target",`${e}-${t}-${r}`)),s.push(...a,...l)}return s},[])}function um(n,e){return n||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function ad(n){n?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function CD(n,e){let t=null;return e?t="valid":n&&!e&&(t="invalid"),t}function OT({event:n,handleId:e,nodeId:t,onConnect:r,isTarget:s,getState:i,setState:o,isValidConnection:a,edgeUpdaterType:l,onReconnectEnd:c}){const u=ST(n.target),{connectionMode:d,domNode:h,autoPanOnConnect:f,connectionRadius:p,onConnectStart:m,panBy:y,getNodes:x,cancelConnection:b}=i();let v=0,_;const{x:w,y:T}=ts(n),N=u?.elementFromPoint(w,T),S=um(l,N),C=h?.getBoundingClientRect();if(!C||!S)return;let D,F=ts(n,C),j=!1,z=null,A=!1,O=null;const k=ED({nodes:x(),nodeId:t,handleId:e,handleType:S}),R=()=>{if(!f)return;const[W,L]=wT(F,C);y({x:W,y:L}),v=requestAnimationFrame(R)};o({connectionPosition:F,connectionStatus:null,connectionNodeId:t,connectionHandleId:e,connectionHandleType:S,connectionStartHandle:{nodeId:t,handleId:e,type:S},connectionEndHandle:null}),m?.(n,{nodeId:t,handleId:e,handleType:S});function I(W){const{transform:L}=i();F=ts(W,C);const{handle:G,validHandleResult:Z}=ND(W,u,Sf(F,L,!1,[1,1]),p,k,ee=>IT(ee,d,t,e,s?"target":"source",a,u));if(_=G,j||(R(),j=!0),O=Z.handleDomNode,z=Z.connection,A=Z.isValid,o({connectionPosition:_&&A?DT({x:_.x,y:_.y},L):F,connectionStatus:CD(!!_,A),connectionEndHandle:Z.endHandle}),!_&&!A&&!O)return ad(D);z.source!==z.target&&O&&(ad(D),D=O,O.classList.add("connecting","react-flow__handle-connecting"),O.classList.toggle("valid",A),O.classList.toggle("react-flow__handle-valid",A))}function P(W){(_||O)&&z&&A&&r?.(z),i().onConnectEnd?.(W),l&&c?.(W),ad(D),b(),cancelAnimationFrame(v),j=!1,A=!1,z=null,O=null,u.removeEventListener("mousemove",I),u.removeEventListener("mouseup",P),u.removeEventListener("touchmove",I),u.removeEventListener("touchend",P)}u.addEventListener("mousemove",I),u.addEventListener("mouseup",P),u.addEventListener("touchmove",I),u.addEventListener("touchend",P)}const C0=()=>!0,RD=n=>({connectionStartHandle:n.connectionStartHandle,connectOnClick:n.connectOnClick,noPanClassName:n.noPanClassName}),MD=(n,e,t)=>r=>{const{connectionStartHandle:s,connectionEndHandle:i,connectionClickStartHandle:o}=r;return{connecting:s?.nodeId===n&&s?.handleId===e&&s?.type===t||i?.nodeId===n&&i?.handleId===e&&i?.type===t,clickConnecting:o?.nodeId===n&&o?.handleId===e&&o?.type===t}},UT=E.forwardRef(({type:n="source",position:e=he.Top,isValidConnection:t,isConnectable:r=!0,isConnectableStart:s=!0,isConnectableEnd:i=!0,id:o,onConnect:a,children:l,className:c,onMouseDown:u,onTouchStart:d,...h},f)=>{const p=o||null,m=n==="target",y=Tt(),x=_D(),{connectOnClick:b,noPanClassName:v}=st(RD,Lt),{connecting:_,clickConnecting:w}=st(MD(x,p,n),Lt);x||y.getState().onError?.("010",Pr.error010());const T=C=>{const{defaultEdgeOptions:D,onConnect:F,hasDefaultEdges:j}=y.getState(),z={...D,...C};if(j){const{edges:A,setEdges:O}=y.getState();O(PT(z,A))}F?.(z),a?.(z)},N=C=>{if(!x)return;const D=AT(C);s&&(D&&C.button===0||!D)&&OT({event:C,handleId:p,nodeId:x,onConnect:T,isTarget:m,getState:y.getState,setState:y.setState,isValidConnection:t||y.getState().isValidConnection||C0}),D?u?.(C):d?.(C)},S=C=>{const{onClickConnectStart:D,onClickConnectEnd:F,connectionClickStartHandle:j,connectionMode:z,isValidConnection:A}=y.getState();if(!x||!j&&!s)return;if(!j){D?.(C,{nodeId:x,handleId:p,handleType:n}),y.setState({connectionClickStartHandle:{nodeId:x,type:n,handleId:p}});return}const O=ST(C.target),k=t||A||C0,{connection:R,isValid:I}=IT({nodeId:x,id:p,type:n},z,j.nodeId,j.handleId||null,j.type,k,O);I&&T(R),F?.(C),y.setState({connectionClickStartHandle:null})};return K.createElement("div",{"data-handleid":p,"data-nodeid":x,"data-handlepos":e,"data-id":`${x}-${p}-${n}`,className:zt(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",v,c,{source:!m,target:m,connectable:r,connectablestart:s,connectableend:i,connecting:w,connectionindicator:r&&(s&&!_||i&&_)}]),onMouseDown:N,onTouchStart:N,onClick:b?S:void 0,ref:f,...h},l)});UT.displayName="Handle";var Qi=E.memo(UT);const VT=({data:n,isConnectable:e,targetPosition:t=he.Top,sourcePosition:r=he.Bottom})=>K.createElement(K.Fragment,null,K.createElement(Qi,{type:"target",position:t,isConnectable:e}),n?.label,K.createElement(Qi,{type:"source",position:r,isConnectable:e}));VT.displayName="DefaultNode";var Nf=E.memo(VT);const jT=({data:n,isConnectable:e,sourcePosition:t=he.Bottom})=>K.createElement(K.Fragment,null,n?.label,K.createElement(Qi,{type:"source",position:t,isConnectable:e}));jT.displayName="InputNode";var GT=E.memo(jT);const $T=({data:n,isConnectable:e,targetPosition:t=he.Top})=>K.createElement(K.Fragment,null,K.createElement(Qi,{type:"target",position:t,isConnectable:e}),n?.label);$T.displayName="OutputNode";var zT=E.memo($T);const dm=()=>null;dm.displayName="GroupNode";const PD=n=>({selectedNodes:n.getNodes().filter(e=>e.selected),selectedEdges:n.edges.filter(e=>e.selected).map(e=>({...e}))}),gl=n=>n.id;function DD(n,e){return Lt(n.selectedNodes.map(gl),e.selectedNodes.map(gl))&&Lt(n.selectedEdges.map(gl),e.selectedEdges.map(gl))}const HT=E.memo(({onSelectionChange:n})=>{const e=Tt(),{selectedNodes:t,selectedEdges:r}=st(PD,DD);return E.useEffect(()=>{const s={nodes:t,edges:r};n?.(s),e.getState().onSelectionChange.forEach(i=>i(s))},[t,r,n]),null});HT.displayName="SelectionListener";const BD=n=>!!n.onSelectionChange;function kD({onSelectionChange:n}){const e=st(BD);return n||e?K.createElement(HT,{onSelectionChange:n}):null}const FD=n=>({setNodes:n.setNodes,setEdges:n.setEdges,setDefaultNodesAndEdges:n.setDefaultNodesAndEdges,setMinZoom:n.setMinZoom,setMaxZoom:n.setMaxZoom,setTranslateExtent:n.setTranslateExtent,setNodeExtent:n.setNodeExtent,reset:n.reset});function ai(n,e){E.useEffect(()=>{typeof n<"u"&&e(n)},[n])}function Ne(n,e,t){E.useEffect(()=>{typeof e<"u"&&t({[n]:e})},[e])}const LD=({nodes:n,edges:e,defaultNodes:t,defaultEdges:r,onConnect:s,onConnectStart:i,onConnectEnd:o,onClickConnectStart:a,onClickConnectEnd:l,nodesDraggable:c,nodesConnectable:u,nodesFocusable:d,edgesFocusable:h,edgesUpdatable:f,elevateNodesOnSelect:p,minZoom:m,maxZoom:y,nodeExtent:x,onNodesChange:b,onEdgesChange:v,elementsSelectable:_,connectionMode:w,snapGrid:T,snapToGrid:N,translateExtent:S,connectOnClick:C,defaultEdgeOptions:D,fitView:F,fitViewOptions:j,onNodesDelete:z,onEdgesDelete:A,onNodeDrag:O,onNodeDragStart:k,onNodeDragStop:R,onSelectionDrag:I,onSelectionDragStart:P,onSelectionDragStop:W,noPanClassName:L,nodeOrigin:G,rfId:Z,autoPanOnConnect:ee,autoPanOnNodeDrag:U,onError:Q,connectionRadius:te,isValidConnection:le,nodeDragThreshold:ye})=>{const{setNodes:ge,setEdges:Me,setDefaultNodesAndEdges:nt,setMinZoom:xt,setMaxZoom:lt,setTranslateExtent:He,setNodeExtent:wt,reset:Pe}=st(FD,Lt),ue=Tt();return E.useEffect(()=>{const en=r?.map(ps=>({...ps,...D}));return nt(t,en),()=>{Pe()}},[]),Ne("defaultEdgeOptions",D,ue.setState),Ne("connectionMode",w,ue.setState),Ne("onConnect",s,ue.setState),Ne("onConnectStart",i,ue.setState),Ne("onConnectEnd",o,ue.setState),Ne("onClickConnectStart",a,ue.setState),Ne("onClickConnectEnd",l,ue.setState),Ne("nodesDraggable",c,ue.setState),Ne("nodesConnectable",u,ue.setState),Ne("nodesFocusable",d,ue.setState),Ne("edgesFocusable",h,ue.setState),Ne("edgesUpdatable",f,ue.setState),Ne("elementsSelectable",_,ue.setState),Ne("elevateNodesOnSelect",p,ue.setState),Ne("snapToGrid",N,ue.setState),Ne("snapGrid",T,ue.setState),Ne("onNodesChange",b,ue.setState),Ne("onEdgesChange",v,ue.setState),Ne("connectOnClick",C,ue.setState),Ne("fitViewOnInit",F,ue.setState),Ne("fitViewOnInitOptions",j,ue.setState),Ne("onNodesDelete",z,ue.setState),Ne("onEdgesDelete",A,ue.setState),Ne("onNodeDrag",O,ue.setState),Ne("onNodeDragStart",k,ue.setState),Ne("onNodeDragStop",R,ue.setState),Ne("onSelectionDrag",I,ue.setState),Ne("onSelectionDragStart",P,ue.setState),Ne("onSelectionDragStop",W,ue.setState),Ne("noPanClassName",L,ue.setState),Ne("nodeOrigin",G,ue.setState),Ne("rfId",Z,ue.setState),Ne("autoPanOnConnect",ee,ue.setState),Ne("autoPanOnNodeDrag",U,ue.setState),Ne("onError",Q,ue.setState),Ne("connectionRadius",te,ue.setState),Ne("isValidConnection",le,ue.setState),Ne("nodeDragThreshold",ye,ue.setState),ai(n,ge),ai(e,Me),ai(m,xt),ai(y,lt),ai(S,He),ai(x,wt),null},R0={display:"none"},ID={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},WT="react-flow__node-desc",qT="react-flow__edge-desc",OD="react-flow__aria-live",UD=n=>n.ariaLiveMessage;function VD({rfId:n}){const e=st(UD);return K.createElement("div",{id:`${OD}-${n}`,"aria-live":"assertive","aria-atomic":"true",style:ID},e)}function jD({rfId:n,disableKeyboardA11y:e}){return K.createElement(K.Fragment,null,K.createElement("div",{id:`${WT}-${n}`,style:R0},"Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),K.createElement("div",{id:`${qT}-${n}`,style:R0},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!e&&K.createElement(VD,{rfId:n}))}var Pa=(n=null,e={actInsideInputWithModifier:!0})=>{const[t,r]=E.useState(!1),s=E.useRef(!1),i=E.useRef(new Set([])),[o,a]=E.useMemo(()=>{if(n!==null){const c=(Array.isArray(n)?n:[n]).filter(d=>typeof d=="string").map(d=>d.split("+")),u=c.reduce((d,h)=>d.concat(...h),[]);return[c,u]}return[[],[]]},[n]);return E.useEffect(()=>{const l=typeof document<"u"?document:null,c=e?.target||l;if(n!==null){const u=f=>{if(s.current=f.ctrlKey||f.metaKey||f.shiftKey,(!s.current||s.current&&!e.actInsideInputWithModifier)&&_f(f))return!1;const m=P0(f.code,a);i.current.add(f[m]),M0(o,i.current,!1)&&(f.preventDefault(),r(!0))},d=f=>{if((!s.current||s.current&&!e.actInsideInputWithModifier)&&_f(f))return!1;const m=P0(f.code,a);M0(o,i.current,!0)?(r(!1),i.current.clear()):i.current.delete(f[m]),f.key==="Meta"&&i.current.clear(),s.current=!1},h=()=>{i.current.clear(),r(!1)};return c?.addEventListener("keydown",u),c?.addEventListener("keyup",d),window.addEventListener("blur",h),()=>{c?.removeEventListener("keydown",u),c?.removeEventListener("keyup",d),window.removeEventListener("blur",h)}}},[n,r]),t};function M0(n,e,t){return n.filter(r=>t||r.length===e.size).some(r=>r.every(s=>e.has(s)))}function P0(n,e){return e.includes(n)?"code":"key"}function XT(n,e,t,r){const s=n.parentNode||n.parentId;if(!s)return t;const i=e.get(s),o=Li(i,r);return XT(i,e,{x:(t.x??0)+o.x,y:(t.y??0)+o.y,z:(i[at]?.z??0)>(t.z??0)?i[at]?.z??0:t.z??0},r)}function KT(n,e,t){n.forEach(r=>{const s=r.parentNode||r.parentId;if(s&&!n.has(s))throw new Error(`Parent node ${s} not found`);if(s||t?.[r.id]){const{x:i,y:o,z:a}=XT(r,n,{...r.position,z:r[at]?.z??0},e);r.positionAbsolute={x:i,y:o},r[at].z=a,t?.[r.id]&&(r[at].isParent=!0)}})}function ld(n,e,t,r){const s=new Map,i={},o=r?1e3:0;return n.forEach(a=>{const l=(fn(a.zIndex)?a.zIndex:0)+(a.selected?o:0),c=e.get(a.id),u={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},d=a.parentNode||a.parentId;d&&(i[d]=!0);const h=c?.type&&c?.type!==a.type;Object.defineProperty(u,at,{enumerable:!1,value:{handleBounds:h?void 0:c?.[at]?.handleBounds,z:l}}),s.set(a.id,u)}),KT(s,t,i),s}function YT(n,e={}){const{getNodes:t,width:r,height:s,minZoom:i,maxZoom:o,d3Zoom:a,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:d}=n(),h=e.initial&&!c&&u;if(a&&l&&(h||!e.initial)){const p=t().filter(y=>{const x=e.includeHiddenNodes?y.width&&y.height:!y.hidden;return e.nodes?.length?x&&e.nodes.some(b=>b.id===y.id):x}),m=p.every(y=>y.width&&y.height);if(p.length>0&&m){const y=cm(p,d),{x,y:b,zoom:v}=FT(y,r,s,e.minZoom??i,e.maxZoom??o,e.padding??.1),_=es.translate(x,b).scale(v);return typeof e.duration=="number"&&e.duration>0?a.transform(As(l,e.duration),_):a.transform(l,_),!0}}return!1}function GD(n,e){return n.forEach(t=>{const r=e.get(t.id);r&&e.set(r.id,{...r,[at]:r[at],selected:t.selected})}),new Map(e)}function $D(n,e){return e.map(t=>{const r=n.find(s=>s.id===t.id);return r&&(t.selected=r.selected),t})}function xl({changedNodes:n,changedEdges:e,get:t,set:r}){const{nodeInternals:s,edges:i,onNodesChange:o,onEdgesChange:a,hasDefaultNodes:l,hasDefaultEdges:c}=t();n?.length&&(l&&r({nodeInternals:GD(n,s)}),o?.(n)),e?.length&&(c&&r({edges:$D(e,i)}),a?.(e))}const li=()=>{},zD={zoomIn:li,zoomOut:li,zoomTo:li,getZoom:()=>1,setViewport:li,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:li,fitBounds:li,project:n=>n,screenToFlowPosition:n=>n,flowToScreenPosition:n=>n,viewportInitialized:!1},HD=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection}),WD=()=>{const n=Tt(),{d3Zoom:e,d3Selection:t}=st(HD,Lt);return E.useMemo(()=>t&&e?{zoomIn:s=>e.scaleBy(As(t,s?.duration),1.2),zoomOut:s=>e.scaleBy(As(t,s?.duration),1/1.2),zoomTo:(s,i)=>e.scaleTo(As(t,i?.duration),s),getZoom:()=>n.getState().transform[2],setViewport:(s,i)=>{const[o,a,l]=n.getState().transform,c=es.translate(s.x??o,s.y??a).scale(s.zoom??l);e.transform(As(t,i?.duration),c)},getViewport:()=>{const[s,i,o]=n.getState().transform;return{x:s,y:i,zoom:o}},fitView:s=>YT(n.getState,s),setCenter:(s,i,o)=>{const{width:a,height:l,maxZoom:c}=n.getState(),u=typeof o?.zoom<"u"?o.zoom:c,d=a/2-s*u,h=l/2-i*u,f=es.translate(d,h).scale(u);e.transform(As(t,o?.duration),f)},fitBounds:(s,i)=>{const{width:o,height:a,minZoom:l,maxZoom:c}=n.getState(),{x:u,y:d,zoom:h}=FT(s,o,a,l,c,i?.padding??.1),f=es.translate(u,d).scale(h);e.transform(As(t,i?.duration),f)},project:s=>{const{transform:i,snapToGrid:o,snapGrid:a}=n.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),Sf(s,i,o,a)},screenToFlowPosition:s=>{const{transform:i,snapToGrid:o,snapGrid:a,domNode:l}=n.getState();if(!l)return s;const{x:c,y:u}=l.getBoundingClientRect(),d={x:s.x-c,y:s.y-u};return Sf(d,i,o,a)},flowToScreenPosition:s=>{const{transform:i,domNode:o}=n.getState();if(!o)return s;const{x:a,y:l}=o.getBoundingClientRect(),c=DT(s,i);return{x:c.x+a,y:c.y+l}},viewportInitialized:!0}:zD,[e,t])};function hm(){const n=WD(),e=Tt(),t=E.useCallback(()=>e.getState().getNodes().map(m=>({...m})),[]),r=E.useCallback(m=>e.getState().nodeInternals.get(m),[]),s=E.useCallback(()=>{const{edges:m=[]}=e.getState();return m.map(y=>({...y}))},[]),i=E.useCallback(m=>{const{edges:y=[]}=e.getState();return y.find(x=>x.id===m)},[]),o=E.useCallback(m=>{const{getNodes:y,setNodes:x,hasDefaultNodes:b,onNodesChange:v}=e.getState(),_=y(),w=typeof m=="function"?m(_):m;if(b)x(w);else if(v){const T=w.length===0?_.map(N=>({type:"remove",id:N.id})):w.map(N=>({item:N,type:"reset"}));v(T)}},[]),a=E.useCallback(m=>{const{edges:y=[],setEdges:x,hasDefaultEdges:b,onEdgesChange:v}=e.getState(),_=typeof m=="function"?m(y):m;if(b)x(_);else if(v){const w=_.length===0?y.map(T=>({type:"remove",id:T.id})):_.map(T=>({item:T,type:"reset"}));v(w)}},[]),l=E.useCallback(m=>{const y=Array.isArray(m)?m:[m],{getNodes:x,setNodes:b,hasDefaultNodes:v,onNodesChange:_}=e.getState();if(v){const T=[...x(),...y];b(T)}else if(_){const w=y.map(T=>({item:T,type:"add"}));_(w)}},[]),c=E.useCallback(m=>{const y=Array.isArray(m)?m:[m],{edges:x=[],setEdges:b,hasDefaultEdges:v,onEdgesChange:_}=e.getState();if(v)b([...x,...y]);else if(_){const w=y.map(T=>({item:T,type:"add"}));_(w)}},[]),u=E.useCallback(()=>{const{getNodes:m,edges:y=[],transform:x}=e.getState(),[b,v,_]=x;return{nodes:m().map(w=>({...w})),edges:y.map(w=>({...w})),viewport:{x:b,y:v,zoom:_}}},[]),d=E.useCallback(({nodes:m,edges:y})=>{const{nodeInternals:x,getNodes:b,edges:v,hasDefaultNodes:_,hasDefaultEdges:w,onNodesDelete:T,onEdgesDelete:N,onNodesChange:S,onEdgesChange:C}=e.getState(),D=(m||[]).map(O=>O.id),F=(y||[]).map(O=>O.id),j=b().reduce((O,k)=>{const R=k.parentNode||k.parentId,I=!D.includes(k.id)&&R&&O.find(W=>W.id===R);return(typeof k.deletable=="boolean"?k.deletable:!0)&&(D.includes(k.id)||I)&&O.push(k),O},[]),z=v.filter(O=>typeof O.deletable=="boolean"?O.deletable:!0),A=z.filter(O=>F.includes(O.id));if(j||A){const O=kT(j,z),k=[...A,...O],R=k.reduce((I,P)=>(I.includes(P.id)||I.push(P.id),I),[]);if((w||_)&&(w&&e.setState({edges:v.filter(I=>!R.includes(I.id))}),_&&(j.forEach(I=>{x.delete(I.id)}),e.setState({nodeInternals:new Map(x)}))),R.length>0&&(N?.(k),C&&C(R.map(I=>({id:I,type:"remove"})))),j.length>0&&(T?.(j),S)){const I=j.map(P=>({id:P.id,type:"remove"}));S(I)}}},[]),h=E.useCallback(m=>{const y=fD(m),x=y?null:e.getState().nodeInternals.get(m.id);return!y&&!x?[null,null,y]:[y?m:T0(x),x,y]},[]),f=E.useCallback((m,y=!0,x)=>{const[b,v,_]=h(m);return b?(x||e.getState().getNodes()).filter(w=>{if(!_&&(w.id===v.id||!w.positionAbsolute))return!1;const T=T0(w),N=vf(T,b);return y&&N>0||N>=b.width*b.height}):[]},[]),p=E.useCallback((m,y,x=!0)=>{const[b]=h(m);if(!b)return!1;const v=vf(b,y);return x&&v>0||v>=b.width*b.height},[]);return E.useMemo(()=>({...n,getNodes:t,getNode:r,getEdges:s,getEdge:i,setNodes:o,setEdges:a,addNodes:l,addEdges:c,toObject:u,deleteElements:d,getIntersectingNodes:f,isNodeIntersecting:p}),[n,t,r,s,i,o,a,l,c,u,d,f,p])}const qD={actInsideInputWithModifier:!1};var XD=({deleteKeyCode:n,multiSelectionKeyCode:e})=>{const t=Tt(),{deleteElements:r}=hm(),s=Pa(n,qD),i=Pa(e);E.useEffect(()=>{if(s){const{edges:o,getNodes:a}=t.getState(),l=a().filter(u=>u.selected),c=o.filter(u=>u.selected);r({nodes:l,edges:c}),t.setState({nodesSelectionActive:!1})}},[s]),E.useEffect(()=>{t.setState({multiSelectionActive:i})},[i])};function KD(n){const e=Tt();E.useEffect(()=>{let t;const r=()=>{if(!n.current)return;const s=nm(n.current);(s.height===0||s.width===0)&&e.getState().onError?.("004",Pr.error004()),e.setState({width:s.width||500,height:s.height||500})};return r(),window.addEventListener("resize",r),n.current&&(t=new ResizeObserver(()=>r()),t.observe(n.current)),()=>{window.removeEventListener("resize",r),t&&n.current&&t.unobserve(n.current)}},[])}const fm={position:"absolute",width:"100%",height:"100%",top:0,left:0},YD=(n,e)=>n.x!==e.x||n.y!==e.y||n.zoom!==e.k,yl=n=>({x:n.x,y:n.y,zoom:n.k}),ci=(n,e)=>n.target.closest(`.${e}`),D0=(n,e)=>e===2&&Array.isArray(n)&&n.includes(2),B0=n=>{const e=n.ctrlKey&&Vc()?10:1;return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*e},QD=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection,d3ZoomHandler:n.d3ZoomHandler,userSelectionActive:n.userSelectionActive}),ZD=({onMove:n,onMoveStart:e,onMoveEnd:t,onPaneContextMenu:r,zoomOnScroll:s=!0,zoomOnPinch:i=!0,panOnScroll:o=!1,panOnScrollSpeed:a=.5,panOnScrollMode:l=Is.Free,zoomOnDoubleClick:c=!0,elementsSelectable:u,panOnDrag:d=!0,defaultViewport:h,translateExtent:f,minZoom:p,maxZoom:m,zoomActivationKeyCode:y,preventScrolling:x=!0,children:b,noWheelClassName:v,noPanClassName:_})=>{const w=E.useRef(),T=Tt(),N=E.useRef(!1),S=E.useRef(!1),C=E.useRef(null),D=E.useRef({x:0,y:0,zoom:0}),{d3Zoom:F,d3Selection:j,d3ZoomHandler:z,userSelectionActive:A}=st(QD,Lt),O=Pa(y),k=E.useRef(0),R=E.useRef(!1),I=E.useRef();return KD(C),E.useEffect(()=>{if(C.current){const P=C.current.getBoundingClientRect(),W=vT().scaleExtent([p,m]).translateExtent(f),L=Bt(C.current).call(W),G=es.translate(h.x,h.y).scale(Yi(h.zoom,p,m)),Z=[[0,0],[P.width,P.height]],ee=W.constrain()(G,Z,f);W.transform(L,ee),W.wheelDelta(B0),T.setState({d3Zoom:W,d3Selection:L,d3ZoomHandler:L.on("wheel.zoom"),transform:[ee.x,ee.y,ee.k],domNode:C.current.closest(".react-flow")})}},[]),E.useEffect(()=>{j&&F&&(o&&!O&&!A?j.on("wheel.zoom",P=>{if(ci(P,v))return!1;P.preventDefault(),P.stopImmediatePropagation();const W=j.property("__zoom").k||1;if(P.ctrlKey&&i){const le=Nn(P),ye=B0(P),ge=W*Math.pow(2,ye);F.scaleTo(j,ge,le,P);return}const L=P.deltaMode===1?20:1;let G=l===Is.Vertical?0:P.deltaX*L,Z=l===Is.Horizontal?0:P.deltaY*L;!Vc()&&P.shiftKey&&l!==Is.Vertical&&(G=P.deltaY*L,Z=0),F.translateBy(j,-(G/W)*a,-(Z/W)*a,{internal:!0});const ee=yl(j.property("__zoom")),{onViewportChangeStart:U,onViewportChange:Q,onViewportChangeEnd:te}=T.getState();clearTimeout(I.current),R.current||(R.current=!0,e?.(P,ee),U?.(ee)),R.current&&(n?.(P,ee),Q?.(ee),I.current=setTimeout(()=>{t?.(P,ee),te?.(ee),R.current=!1},150))},{passive:!1}):typeof z<"u"&&j.on("wheel.zoom",function(P,W){if(!x&&P.type==="wheel"&&!P.ctrlKey||ci(P,v))return null;P.preventDefault(),z.call(this,P,W)},{passive:!1}))},[A,o,l,j,F,z,O,i,x,v,e,n,t]),E.useEffect(()=>{F&&F.on("start",P=>{if(!P.sourceEvent||P.sourceEvent.internal)return null;k.current=P.sourceEvent?.button;const{onViewportChangeStart:W}=T.getState(),L=yl(P.transform);N.current=!0,D.current=L,P.sourceEvent?.type==="mousedown"&&T.setState({paneDragging:!0}),W?.(L),e?.(P.sourceEvent,L)})},[F,e]),E.useEffect(()=>{F&&(A&&!N.current?F.on("zoom",null):A||F.on("zoom",P=>{const{onViewportChange:W}=T.getState();if(T.setState({transform:[P.transform.x,P.transform.y,P.transform.k]}),S.current=!!(r&&D0(d,k.current??0)),(n||W)&&!P.sourceEvent?.internal){const L=yl(P.transform);W?.(L),n?.(P.sourceEvent,L)}}))},[A,F,n,d,r]),E.useEffect(()=>{F&&F.on("end",P=>{if(!P.sourceEvent||P.sourceEvent.internal)return null;const{onViewportChangeEnd:W}=T.getState();if(N.current=!1,T.setState({paneDragging:!1}),r&&D0(d,k.current??0)&&!S.current&&r(P.sourceEvent),S.current=!1,(t||W)&&YD(D.current,P.transform)){const L=yl(P.transform);D.current=L,clearTimeout(w.current),w.current=setTimeout(()=>{W?.(L),t?.(P.sourceEvent,L)},o?150:0)}})},[F,o,d,t,r]),E.useEffect(()=>{F&&F.filter(P=>{const W=O||s,L=i&&P.ctrlKey;if((d===!0||Array.isArray(d)&&d.includes(1))&&P.button===1&&P.type==="mousedown"&&(ci(P,"react-flow__node")||ci(P,"react-flow__edge")))return!0;if(!d&&!W&&!o&&!c&&!i||A||!c&&P.type==="dblclick"||ci(P,v)&&P.type==="wheel"||ci(P,_)&&(P.type!=="wheel"||o&&P.type==="wheel"&&!O)||!i&&P.ctrlKey&&P.type==="wheel"||!W&&!o&&!L&&P.type==="wheel"||!d&&(P.type==="mousedown"||P.type==="touchstart")||Array.isArray(d)&&!d.includes(P.button)&&P.type==="mousedown")return!1;const G=Array.isArray(d)&&d.includes(P.button)||!P.button||P.button<=1;return(!P.ctrlKey||P.type==="wheel")&&G})},[A,F,s,i,o,c,d,u,O]),K.createElement("div",{className:"react-flow__renderer",ref:C,style:fm},b)},JD=n=>({userSelectionActive:n.userSelectionActive,userSelectionRect:n.userSelectionRect});function eB(){const{userSelectionActive:n,userSelectionRect:e}=st(JD,Lt);return n&&e?K.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}function k0(n,e){const t=e.parentNode||e.parentId,r=n.find(s=>s.id===t);if(r){const s=e.position.x+e.width-r.width,i=e.position.y+e.height-r.height;if(s>0||i>0||e.position.x<0||e.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,s>0&&(r.style.width+=s),i>0&&(r.style.height+=i),e.position.x<0){const o=Math.abs(e.position.x);r.position.x=r.position.x-o,r.style.width+=o,e.position.x=0}if(e.position.y<0){const o=Math.abs(e.position.y);r.position.y=r.position.y-o,r.style.height+=o,e.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function QT(n,e){if(n.some(r=>r.type==="reset"))return n.filter(r=>r.type==="reset").map(r=>r.item);const t=n.filter(r=>r.type==="add").map(r=>r.item);return e.reduce((r,s)=>{const i=n.filter(a=>a.id===s.id);if(i.length===0)return r.push(s),r;const o={...s};for(const a of i)if(a)switch(a.type){case"select":{o.selected=a.selected;break}case"position":{typeof a.position<"u"&&(o.position=a.position),typeof a.positionAbsolute<"u"&&(o.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(o.dragging=a.dragging),o.expandParent&&k0(r,o);break}case"dimensions":{typeof a.dimensions<"u"&&(o.width=a.dimensions.width,o.height=a.dimensions.height),typeof a.updateStyle<"u"&&(o.style={...o.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(o.resizing=a.resizing),o.expandParent&&k0(r,o);break}case"remove":return r}return r.push(o),r},t)}function ZT(n,e){return QT(n,e)}function tB(n,e){return QT(n,e)}const zr=(n,e)=>({id:n,type:"select",selected:e});function Ni(n,e){return n.reduce((t,r)=>{const s=e.includes(r.id);return!r.selected&&s?(r.selected=!0,t.push(zr(r.id,!0))):r.selected&&!s&&(r.selected=!1,t.push(zr(r.id,!1))),t},[])}const cd=(n,e)=>t=>{t.target===e.current&&n?.(t)},nB=n=>({userSelectionActive:n.userSelectionActive,elementsSelectable:n.elementsSelectable,dragging:n.paneDragging}),JT=E.memo(({isSelecting:n,selectionMode:e=Ma.Full,panOnDrag:t,onSelectionStart:r,onSelectionEnd:s,onPaneClick:i,onPaneContextMenu:o,onPaneScroll:a,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:u,children:d})=>{const h=E.useRef(null),f=Tt(),p=E.useRef(0),m=E.useRef(0),y=E.useRef(),{userSelectionActive:x,elementsSelectable:b,dragging:v}=st(nB,Lt),_=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),p.current=0,m.current=0},w=z=>{i?.(z),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},T=z=>{if(Array.isArray(t)&&t?.includes(2)){z.preventDefault();return}o?.(z)},N=a?z=>a(z):void 0,S=z=>{const{resetSelectedElements:A,domNode:O}=f.getState();if(y.current=O?.getBoundingClientRect(),!b||!n||z.button!==0||z.target!==h.current||!y.current)return;const{x:k,y:R}=ts(z,y.current);A(),f.setState({userSelectionRect:{width:0,height:0,startX:k,startY:R,x:k,y:R}}),r?.(z)},C=z=>{const{userSelectionRect:A,nodeInternals:O,edges:k,transform:R,onNodesChange:I,onEdgesChange:P,nodeOrigin:W,getNodes:L}=f.getState();if(!n||!y.current||!A)return;f.setState({userSelectionActive:!0,nodesSelectionActive:!1});const G=ts(z,y.current),Z=A.startX??0,ee=A.startY??0,U={...A,x:G.x<Z?G.x:Z,y:G.y<ee?G.y:ee,width:Math.abs(G.x-Z),height:Math.abs(G.y-ee)},Q=L(),te=BT(O,U,R,e===Ma.Partial,!0,W),le=kT(te,k).map(ge=>ge.id),ye=te.map(ge=>ge.id);if(p.current!==ye.length){p.current=ye.length;const ge=Ni(Q,ye);ge.length&&I?.(ge)}if(m.current!==le.length){m.current=le.length;const ge=Ni(k,le);ge.length&&P?.(ge)}f.setState({userSelectionRect:U})},D=z=>{if(z.button!==0)return;const{userSelectionRect:A}=f.getState();!x&&A&&z.target===h.current&&w?.(z),f.setState({nodesSelectionActive:p.current>0}),_(),s?.(z)},F=z=>{x&&(f.setState({nodesSelectionActive:p.current>0}),s?.(z)),_()},j=b&&(n||x);return K.createElement("div",{className:zt(["react-flow__pane",{dragging:v,selection:n}]),onClick:j?void 0:cd(w,h),onContextMenu:cd(T,h),onWheel:cd(N,h),onMouseEnter:j?void 0:l,onMouseDown:j?S:void 0,onMouseMove:j?C:c,onMouseUp:j?D:void 0,onMouseLeave:j?F:u,ref:h,style:fm},d,K.createElement(eB,null))});JT.displayName="Pane";function e1(n,e){const t=n.parentNode||n.parentId;if(!t)return!1;const r=e.get(t);return r?r.selected?!0:e1(r,e):!1}function F0(n,e,t){let r=n;do{if(r?.matches(e))return!0;if(r===t.current)return!1;r=r.parentElement}while(r);return!1}function rB(n,e,t,r){return Array.from(n.values()).filter(s=>(s.selected||s.id===r)&&(!s.parentNode||s.parentId||!e1(s,n))&&(s.draggable||e&&typeof s.draggable>"u")).map(s=>({id:s.id,position:s.position||{x:0,y:0},positionAbsolute:s.positionAbsolute||{x:0,y:0},distance:{x:t.x-(s.positionAbsolute?.x??0),y:t.y-(s.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:s.extent,parentNode:s.parentNode||s.parentId,parentId:s.parentNode||s.parentId,width:s.width,height:s.height,expandParent:s.expandParent}))}function sB(n,e){return!e||e==="parent"?e:[e[0],[e[1][0]-(n.width||0),e[1][1]-(n.height||0)]]}function t1(n,e,t,r,s=[0,0],i){const o=sB(n,n.extent||r);let a=o;const l=n.parentNode||n.parentId;if(n.extent==="parent"&&!n.expandParent)if(l&&n.width&&n.height){const d=t.get(l),{x:h,y:f}=Li(d,s).positionAbsolute;a=d&&fn(h)&&fn(f)&&fn(d.width)&&fn(d.height)?[[h+n.width*s[0],f+n.height*s[1]],[h+d.width-n.width+n.width*s[0],f+d.height-n.height+n.height*s[1]]]:a}else i?.("005",Pr.error005()),a=o;else if(n.extent&&l&&n.extent!=="parent"){const d=t.get(l),{x:h,y:f}=Li(d,s).positionAbsolute;a=[[n.extent[0][0]+h,n.extent[0][1]+f],[n.extent[1][0]+h,n.extent[1][1]+f]]}let c={x:0,y:0};if(l){const d=t.get(l);c=Li(d,s).positionAbsolute}const u=a&&a!=="parent"?rm(e,a):e;return{position:{x:u.x-c.x,y:u.y-c.y},positionAbsolute:u}}function ud({nodeId:n,dragItems:e,nodeInternals:t}){const r=e.map(s=>({...t.get(s.id),position:s.position,positionAbsolute:s.positionAbsolute}));return[n?r.find(s=>s.id===n):r[0],r]}const L0=(n,e,t,r)=>{const s=e.querySelectorAll(n);if(!s||!s.length)return null;const i=Array.from(s),o=e.getBoundingClientRect(),a={x:o.width*r[0],y:o.height*r[1]};return i.map(l=>{const c=l.getBoundingClientRect();return{id:l.getAttribute("data-handleid"),position:l.getAttribute("data-handlepos"),x:(c.left-o.left-a.x)/t,y:(c.top-o.top-a.y)/t,...nm(l)}})};function Eo(n,e,t){return t===void 0?t:r=>{const s=e().nodeInternals.get(n);s&&t(r,{...s})}}function Af({id:n,store:e,unselect:t=!1,nodeRef:r}){const{addSelectedNodes:s,unselectNodesAndEdges:i,multiSelectionActive:o,nodeInternals:a,onError:l}=e.getState(),c=a.get(n);if(!c){l?.("012",Pr.error012(n));return}e.setState({nodesSelectionActive:!1}),c.selected?(t||c.selected&&o)&&(i({nodes:[c],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):s([n])}function iB(){const n=Tt();return E.useCallback(({sourceEvent:t})=>{const{transform:r,snapGrid:s,snapToGrid:i}=n.getState(),o=t.touches?t.touches[0].clientX:t.clientX,a=t.touches?t.touches[0].clientY:t.clientY,l={x:(o-r[0])/r[2],y:(a-r[1])/r[2]};return{xSnapped:i?s[0]*Math.round(l.x/s[0]):l.x,ySnapped:i?s[1]*Math.round(l.y/s[1]):l.y,...l}},[])}function dd(n){return(e,t,r)=>n?.(e,r)}function n1({nodeRef:n,disabled:e=!1,noDragClassName:t,handleSelector:r,nodeId:s,isSelectable:i,selectNodesOnDrag:o}){const a=Tt(),[l,c]=E.useState(!1),u=E.useRef([]),d=E.useRef({x:null,y:null}),h=E.useRef(0),f=E.useRef(null),p=E.useRef({x:0,y:0}),m=E.useRef(null),y=E.useRef(!1),x=E.useRef(!1),b=E.useRef(!1),v=iB();return E.useEffect(()=>{if(n?.current){const _=Bt(n.current),w=({x:S,y:C})=>{const{nodeInternals:D,onNodeDrag:F,onSelectionDrag:j,updateNodePositions:z,nodeExtent:A,snapGrid:O,snapToGrid:k,nodeOrigin:R,onError:I}=a.getState();d.current={x:S,y:C};let P=!1,W={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&A){const G=cm(u.current,R);W=sm(G)}if(u.current=u.current.map(G=>{const Z={x:S-G.distance.x,y:C-G.distance.y};k&&(Z.x=O[0]*Math.round(Z.x/O[0]),Z.y=O[1]*Math.round(Z.y/O[1]));const ee=[[A[0][0],A[0][1]],[A[1][0],A[1][1]]];u.current.length>1&&A&&!G.extent&&(ee[0][0]=G.positionAbsolute.x-W.x+A[0][0],ee[1][0]=G.positionAbsolute.x+(G.width??0)-W.x2+A[1][0],ee[0][1]=G.positionAbsolute.y-W.y+A[0][1],ee[1][1]=G.positionAbsolute.y+(G.height??0)-W.y2+A[1][1]);const U=t1(G,Z,D,ee,R,I);return P=P||G.position.x!==U.position.x||G.position.y!==U.position.y,G.position=U.position,G.positionAbsolute=U.positionAbsolute,G}),!P)return;z(u.current,!0,!0),c(!0);const L=s?F:dd(j);if(L&&m.current){const[G,Z]=ud({nodeId:s,dragItems:u.current,nodeInternals:D});L(m.current,G,Z)}},T=()=>{if(!f.current)return;const[S,C]=wT(p.current,f.current);if(S!==0||C!==0){const{transform:D,panBy:F}=a.getState();d.current.x=(d.current.x??0)-S/D[2],d.current.y=(d.current.y??0)-C/D[2],F({x:S,y:C})&&w(d.current)}h.current=requestAnimationFrame(T)},N=S=>{const{nodeInternals:C,multiSelectionActive:D,nodesDraggable:F,unselectNodesAndEdges:j,onNodeDragStart:z,onSelectionDragStart:A}=a.getState();x.current=!0;const O=s?z:dd(A);(!o||!i)&&!D&&s&&(C.get(s)?.selected||j()),s&&i&&o&&Af({id:s,store:a,nodeRef:n});const k=v(S);if(d.current=k,u.current=rB(C,F,k,s),O&&u.current){const[R,I]=ud({nodeId:s,dragItems:u.current,nodeInternals:C});O(S.sourceEvent,R,I)}};if(e)_.on(".drag",null);else{const S=g3().on("start",C=>{const{domNode:D,nodeDragThreshold:F}=a.getState();F===0&&N(C),b.current=!1;const j=v(C);d.current=j,f.current=D?.getBoundingClientRect()||null,p.current=ts(C.sourceEvent,f.current)}).on("drag",C=>{const D=v(C),{autoPanOnNodeDrag:F,nodeDragThreshold:j}=a.getState();if(C.sourceEvent.type==="touchmove"&&C.sourceEvent.touches.length>1&&(b.current=!0),!b.current){if(!y.current&&x.current&&F&&(y.current=!0,T()),!x.current){const z=D.xSnapped-(d?.current?.x??0),A=D.ySnapped-(d?.current?.y??0);Math.sqrt(z*z+A*A)>j&&N(C)}(d.current.x!==D.xSnapped||d.current.y!==D.ySnapped)&&u.current&&x.current&&(m.current=C.sourceEvent,p.current=ts(C.sourceEvent,f.current),w(D))}}).on("end",C=>{if(!(!x.current||b.current)&&(c(!1),y.current=!1,x.current=!1,cancelAnimationFrame(h.current),u.current)){const{updateNodePositions:D,nodeInternals:F,onNodeDragStop:j,onSelectionDragStop:z}=a.getState(),A=s?j:dd(z);if(D(u.current,!1,!1),A){const[O,k]=ud({nodeId:s,dragItems:u.current,nodeInternals:F});A(C.sourceEvent,O,k)}}}).filter(C=>{const D=C.target;return!C.button&&(!t||!F0(D,`.${t}`,n))&&(!r||F0(D,r,n))});return _.call(S),()=>{_.on(".drag",null)}}}},[n,e,t,r,i,a,s,o,v]),l}function r1(){const n=Tt();return E.useCallback(t=>{const{nodeInternals:r,nodeExtent:s,updateNodePositions:i,getNodes:o,snapToGrid:a,snapGrid:l,onError:c,nodesDraggable:u}=n.getState(),d=o().filter(b=>b.selected&&(b.draggable||u&&typeof b.draggable>"u")),h=a?l[0]:5,f=a?l[1]:5,p=t.isShiftPressed?4:1,m=t.x*h*p,y=t.y*f*p,x=d.map(b=>{if(b.positionAbsolute){const v={x:b.positionAbsolute.x+m,y:b.positionAbsolute.y+y};a&&(v.x=l[0]*Math.round(v.x/l[0]),v.y=l[1]*Math.round(v.y/l[1]));const{positionAbsolute:_,position:w}=t1(b,v,r,s,void 0,c);b.position=w,b.positionAbsolute=_}return b});i(x,!0,!1)},[])}const Ii={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Co=n=>{const e=({id:t,type:r,data:s,xPos:i,yPos:o,xPosOrigin:a,yPosOrigin:l,selected:c,onClick:u,onMouseEnter:d,onMouseMove:h,onMouseLeave:f,onContextMenu:p,onDoubleClick:m,style:y,className:x,isDraggable:b,isSelectable:v,isConnectable:_,isFocusable:w,selectNodesOnDrag:T,sourcePosition:N,targetPosition:S,hidden:C,resizeObserver:D,dragHandle:F,zIndex:j,isParent:z,noDragClassName:A,noPanClassName:O,initialized:k,disableKeyboardA11y:R,ariaLabel:I,rfId:P,hasHandleBounds:W})=>{const L=Tt(),G=E.useRef(null),Z=E.useRef(null),ee=E.useRef(N),U=E.useRef(S),Q=E.useRef(r),te=v||b||u||d||h||f,le=r1(),ye=Eo(t,L.getState,d),ge=Eo(t,L.getState,h),Me=Eo(t,L.getState,f),nt=Eo(t,L.getState,p),xt=Eo(t,L.getState,m),lt=Pe=>{const{nodeDragThreshold:ue}=L.getState();if(v&&(!T||!b||ue>0)&&Af({id:t,store:L,nodeRef:G}),u){const en=L.getState().nodeInternals.get(t);en&&u(Pe,{...en})}},He=Pe=>{if(!_f(Pe)&&!R)if(NT.includes(Pe.key)&&v){const ue=Pe.key==="Escape";Af({id:t,store:L,unselect:ue,nodeRef:G})}else b&&c&&Object.prototype.hasOwnProperty.call(Ii,Pe.key)&&(L.setState({ariaLiveMessage:`Moved selected node ${Pe.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~o}`}),le({x:Ii[Pe.key].x,y:Ii[Pe.key].y,isShiftPressed:Pe.shiftKey}))};E.useEffect(()=>()=>{Z.current&&(D?.unobserve(Z.current),Z.current=null)},[]),E.useEffect(()=>{if(G.current&&!C){const Pe=G.current;(!k||!W||Z.current!==Pe)&&(Z.current&&D?.unobserve(Z.current),D?.observe(Pe),Z.current=Pe)}},[C,k,W]),E.useEffect(()=>{const Pe=Q.current!==r,ue=ee.current!==N,en=U.current!==S;G.current&&(Pe||ue||en)&&(Pe&&(Q.current=r),ue&&(ee.current=N),en&&(U.current=S),L.getState().updateNodeDimensions([{id:t,nodeElement:G.current,forceUpdate:!0}]))},[t,r,N,S]);const wt=n1({nodeRef:G,disabled:C||!b,noDragClassName:A,handleSelector:F,nodeId:t,isSelectable:v,selectNodesOnDrag:T});return C?null:K.createElement("div",{className:zt(["react-flow__node",`react-flow__node-${r}`,{[O]:b},x,{selected:c,selectable:v,parent:z,dragging:wt}]),ref:G,style:{zIndex:j,transform:`translate(${a}px,${l}px)`,pointerEvents:te?"all":"none",visibility:k?"visible":"hidden",...y},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:ye,onMouseMove:ge,onMouseLeave:Me,onContextMenu:nt,onClick:lt,onDoubleClick:xt,onKeyDown:w?He:void 0,tabIndex:w?0:void 0,role:w?"button":void 0,"aria-describedby":R?void 0:`${WT}-${P}`,"aria-label":I},K.createElement(vD,{value:t},K.createElement(n,{id:t,data:s,type:r,xPos:i,yPos:o,selected:c,isConnectable:_,sourcePosition:N,targetPosition:S,dragging:wt,dragHandle:F,zIndex:j})))};return e.displayName="NodeWrapper",E.memo(e)};const oB=n=>{const e=n.getNodes().filter(t=>t.selected);return{...cm(e,n.nodeOrigin),transformString:`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`,userSelectionActive:n.userSelectionActive}};function aB({onSelectionContextMenu:n,noPanClassName:e,disableKeyboardA11y:t}){const r=Tt(),{width:s,height:i,x:o,y:a,transformString:l,userSelectionActive:c}=st(oB,Lt),u=r1(),d=E.useRef(null);if(E.useEffect(()=>{t||d.current?.focus({preventScroll:!0})},[t]),n1({nodeRef:d}),c||!s||!i)return null;const h=n?p=>{const m=r.getState().getNodes().filter(y=>y.selected);n(p,m)}:void 0,f=p=>{Object.prototype.hasOwnProperty.call(Ii,p.key)&&u({x:Ii[p.key].x,y:Ii[p.key].y,isShiftPressed:p.shiftKey})};return K.createElement("div",{className:zt(["react-flow__nodesselection","react-flow__container",e]),style:{transform:l}},K.createElement("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:t?void 0:-1,onKeyDown:t?void 0:f,style:{width:s,height:i,top:a,left:o}}))}var lB=E.memo(aB);const cB=n=>n.nodesSelectionActive,s1=({children:n,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:r,onPaneMouseLeave:s,onPaneContextMenu:i,onPaneScroll:o,deleteKeyCode:a,onMove:l,onMoveStart:c,onMoveEnd:u,selectionKeyCode:d,selectionOnDrag:h,selectionMode:f,onSelectionStart:p,onSelectionEnd:m,multiSelectionKeyCode:y,panActivationKeyCode:x,zoomActivationKeyCode:b,elementsSelectable:v,zoomOnScroll:_,zoomOnPinch:w,panOnScroll:T,panOnScrollSpeed:N,panOnScrollMode:S,zoomOnDoubleClick:C,panOnDrag:D,defaultViewport:F,translateExtent:j,minZoom:z,maxZoom:A,preventScrolling:O,onSelectionContextMenu:k,noWheelClassName:R,noPanClassName:I,disableKeyboardA11y:P})=>{const W=st(cB),L=Pa(d),G=Pa(x),Z=G||D,ee=G||T,U=L||h&&Z!==!0;return XD({deleteKeyCode:a,multiSelectionKeyCode:y}),K.createElement(ZD,{onMove:l,onMoveStart:c,onMoveEnd:u,onPaneContextMenu:i,elementsSelectable:v,zoomOnScroll:_,zoomOnPinch:w,panOnScroll:ee,panOnScrollSpeed:N,panOnScrollMode:S,zoomOnDoubleClick:C,panOnDrag:!L&&Z,defaultViewport:F,translateExtent:j,minZoom:z,maxZoom:A,zoomActivationKeyCode:b,preventScrolling:O,noWheelClassName:R,noPanClassName:I},K.createElement(JT,{onSelectionStart:p,onSelectionEnd:m,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:r,onPaneMouseLeave:s,onPaneContextMenu:i,onPaneScroll:o,panOnDrag:Z,isSelecting:!!U,selectionMode:f},n,W&&K.createElement(lB,{onSelectionContextMenu:k,noPanClassName:I,disableKeyboardA11y:P})))};s1.displayName="FlowRenderer";var uB=E.memo(s1);function dB(n){return st(E.useCallback(t=>n?BT(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[n]))}function hB(n){const e={input:Co(n.input||GT),default:Co(n.default||Nf),output:Co(n.output||zT),group:Co(n.group||dm)},t={},r=Object.keys(n).filter(s=>!["input","default","output","group"].includes(s)).reduce((s,i)=>(s[i]=Co(n[i]||Nf),s),t);return{...e,...r}}const fB=({x:n,y:e,width:t,height:r,origin:s})=>!t||!r?{x:n,y:e}:s[0]<0||s[1]<0||s[0]>1||s[1]>1?{x:n,y:e}:{x:n-t*s[0],y:e-r*s[1]},pB=n=>({nodesDraggable:n.nodesDraggable,nodesConnectable:n.nodesConnectable,nodesFocusable:n.nodesFocusable,elementsSelectable:n.elementsSelectable,updateNodeDimensions:n.updateNodeDimensions,onError:n.onError}),i1=n=>{const{nodesDraggable:e,nodesConnectable:t,nodesFocusable:r,elementsSelectable:s,updateNodeDimensions:i,onError:o}=st(pB,Lt),a=dB(n.onlyRenderVisibleElements),l=E.useRef(),c=E.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const u=new ResizeObserver(d=>{const h=d.map(f=>({id:f.target.getAttribute("data-id"),nodeElement:f.target,forceUpdate:!0}));i(h)});return l.current=u,u},[]);return E.useEffect(()=>()=>{l?.current?.disconnect()},[]),K.createElement("div",{className:"react-flow__nodes",style:fm},a.map(u=>{let d=u.type||"default";n.nodeTypes[d]||(o?.("003",Pr.error003(d)),d="default");const h=n.nodeTypes[d]||n.nodeTypes.default,f=!!(u.draggable||e&&typeof u.draggable>"u"),p=!!(u.selectable||s&&typeof u.selectable>"u"),m=!!(u.connectable||t&&typeof u.connectable>"u"),y=!!(u.focusable||r&&typeof u.focusable>"u"),x=n.nodeExtent?rm(u.positionAbsolute,n.nodeExtent):u.positionAbsolute,b=x?.x??0,v=x?.y??0,_=fB({x:b,y:v,width:u.width??0,height:u.height??0,origin:n.nodeOrigin});return K.createElement(h,{key:u.id,id:u.id,className:u.className,style:u.style,type:d,data:u.data,sourcePosition:u.sourcePosition||he.Bottom,targetPosition:u.targetPosition||he.Top,hidden:u.hidden,xPos:b,yPos:v,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:n.selectNodesOnDrag,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,selected:!!u.selected,isDraggable:f,isSelectable:p,isConnectable:m,isFocusable:y,resizeObserver:c,dragHandle:u.dragHandle,zIndex:u[at]?.z??0,isParent:!!u[at]?.isParent,noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,initialized:!!u.width&&!!u.height,rfId:n.rfId,disableKeyboardA11y:n.disableKeyboardA11y,ariaLabel:u.ariaLabel,hasHandleBounds:!!u[at]?.handleBounds})}))};i1.displayName="NodeRenderer";var mB=E.memo(i1);const gB=(n,e,t)=>t===he.Left?n-e:t===he.Right?n+e:n,xB=(n,e,t)=>t===he.Top?n-e:t===he.Bottom?n+e:n,I0="react-flow__edgeupdater",O0=({position:n,centerX:e,centerY:t,radius:r=10,onMouseDown:s,onMouseEnter:i,onMouseOut:o,type:a})=>K.createElement("circle",{onMouseDown:s,onMouseEnter:i,onMouseOut:o,className:zt([I0,`${I0}-${a}`]),cx:gB(e,r,n),cy:xB(t,r,n),r,stroke:"transparent",fill:"transparent"}),yB=()=>!0;var ui=n=>{const e=({id:t,className:r,type:s,data:i,onClick:o,onEdgeDoubleClick:a,selected:l,animated:c,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,style:y,source:x,target:b,sourceX:v,sourceY:_,targetX:w,targetY:T,sourcePosition:N,targetPosition:S,elementsSelectable:C,hidden:D,sourceHandleId:F,targetHandleId:j,onContextMenu:z,onMouseEnter:A,onMouseMove:O,onMouseLeave:k,reconnectRadius:R,onReconnect:I,onReconnectStart:P,onReconnectEnd:W,markerEnd:L,markerStart:G,rfId:Z,ariaLabel:ee,isFocusable:U,isReconnectable:Q,pathOptions:te,interactionWidth:le,disableKeyboardA11y:ye})=>{const ge=E.useRef(null),[Me,nt]=E.useState(!1),[xt,lt]=E.useState(!1),He=Tt(),wt=E.useMemo(()=>`url('#${wf(G,Z)}')`,[G,Z]),Pe=E.useMemo(()=>`url('#${wf(L,Z)}')`,[L,Z]);if(D)return null;const ue=Mt=>{const{edges:Un,addSelectedEdges:xs,unselectNodesAndEdges:ys,multiSelectionActive:oi}=He.getState(),Vn=Un.find(bs=>bs.id===t);Vn&&(C&&(He.setState({nodesSelectionActive:!1}),Vn.selected&&oi?(ys({nodes:[],edges:[Vn]}),ge.current?.blur()):xs([t])),o&&o(Mt,Vn))},en=Ao(t,He.getState,a),ps=Ao(t,He.getState,z),_o=Ao(t,He.getState,A),ti=Ao(t,He.getState,O),ni=Ao(t,He.getState,k),cr=(Mt,Un)=>{if(Mt.button!==0)return;const{edges:xs,isValidConnection:ys}=He.getState(),oi=Un?b:x,Vn=(Un?j:F)||null,bs=Un?"target":"source",Ju=ys||yB,ed=Un,wo=xs.find(vs=>vs.id===t);lt(!0),P?.(Mt,wo,bs);const td=vs=>{lt(!1),W?.(vs,wo,bs)};OT({event:Mt,handleId:Vn,nodeId:oi,onConnect:vs=>I?.(wo,vs),isTarget:ed,getState:He.getState,setState:He.setState,isValidConnection:Ju,edgeUpdaterType:bs,onReconnectEnd:td})},ri=Mt=>cr(Mt,!0),ms=Mt=>cr(Mt,!1),gs=()=>nt(!0),si=()=>nt(!1),ii=!C&&!o,To=Mt=>{if(!ye&&NT.includes(Mt.key)&&C){const{unselectNodesAndEdges:Un,addSelectedEdges:xs,edges:ys}=He.getState();Mt.key==="Escape"?(ge.current?.blur(),Un({edges:[ys.find(Vn=>Vn.id===t)]})):xs([t])}};return K.createElement("g",{className:zt(["react-flow__edge",`react-flow__edge-${s}`,r,{selected:l,animated:c,inactive:ii,updating:Me}]),onClick:ue,onDoubleClick:en,onContextMenu:ps,onMouseEnter:_o,onMouseMove:ti,onMouseLeave:ni,onKeyDown:U?To:void 0,tabIndex:U?0:void 0,role:U?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":ee===null?void 0:ee||`Edge from ${x} to ${b}`,"aria-describedby":U?`${qT}-${Z}`:void 0,ref:ge},!xt&&K.createElement(n,{id:t,source:x,target:b,selected:l,animated:c,label:u,labelStyle:d,labelShowBg:h,labelBgStyle:f,labelBgPadding:p,labelBgBorderRadius:m,data:i,style:y,sourceX:v,sourceY:_,targetX:w,targetY:T,sourcePosition:N,targetPosition:S,sourceHandleId:F,targetHandleId:j,markerStart:wt,markerEnd:Pe,pathOptions:te,interactionWidth:le}),Q&&K.createElement(K.Fragment,null,(Q==="source"||Q===!0)&&K.createElement(O0,{position:N,centerX:v,centerY:_,radius:R,onMouseDown:ri,onMouseEnter:gs,onMouseOut:si,type:"source"}),(Q==="target"||Q===!0)&&K.createElement(O0,{position:S,centerX:w,centerY:T,radius:R,onMouseDown:ms,onMouseEnter:gs,onMouseOut:si,type:"target"})))};return e.displayName="EdgeWrapper",E.memo(e)};function bB(n){const e={default:ui(n.default||Gc),straight:ui(n.bezier||am),step:ui(n.step||om),smoothstep:ui(n.step||wu),simplebezier:ui(n.simplebezier||im)},t={},r=Object.keys(n).filter(s=>!["default","bezier"].includes(s)).reduce((s,i)=>(s[i]=ui(n[i]||Gc),s),t);return{...e,...r}}function U0(n,e,t=null){const r=(t?.x||0)+e.x,s=(t?.y||0)+e.y,i=t?.width||e.width,o=t?.height||e.height;switch(n){case he.Top:return{x:r+i/2,y:s};case he.Right:return{x:r+i,y:s+o/2};case he.Bottom:return{x:r+i/2,y:s+o};case he.Left:return{x:r,y:s+o/2}}}function V0(n,e){return n?n.length===1||!e?n[0]:e&&n.find(t=>t.id===e)||null:null}const vB=(n,e,t,r,s,i)=>{const o=U0(t,n,e),a=U0(i,r,s);return{sourceX:o.x,sourceY:o.y,targetX:a.x,targetY:a.y}};function _B({sourcePos:n,targetPos:e,sourceWidth:t,sourceHeight:r,targetWidth:s,targetHeight:i,width:o,height:a,transform:l}){const c={x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x+t,e.x+s),y2:Math.max(n.y+r,e.y+i)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const u=sm({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:o/l[2],height:a/l[2]}),d=Math.max(0,Math.min(u.x2,c.x2)-Math.max(u.x,c.x)),h=Math.max(0,Math.min(u.y2,c.y2)-Math.max(u.y,c.y));return Math.ceil(d*h)>0}function j0(n){const e=n?.[at]?.handleBounds||null,t=e&&n?.width&&n?.height&&typeof n?.positionAbsolute?.x<"u"&&typeof n?.positionAbsolute?.y<"u";return[{x:n?.positionAbsolute?.x||0,y:n?.positionAbsolute?.y||0,width:n?.width||0,height:n?.height||0},e,!!t]}const TB=[{level:0,isMaxLevel:!0,edges:[]}];function wB(n,e,t=!1){let r=-1;const s=n.reduce((o,a)=>{const l=fn(a.zIndex);let c=l?a.zIndex:0;if(t){const u=e.get(a.target),d=e.get(a.source),h=a.selected||u?.selected||d?.selected,f=Math.max(d?.[at]?.z||0,u?.[at]?.z||0,1e3);c=(l?a.zIndex:0)+(h?f:0)}return o[c]?o[c].push(a):o[c]=[a],r=c>r?c:r,o},{}),i=Object.entries(s).map(([o,a])=>{const l=+o;return{edges:a,level:l,isMaxLevel:l===r}});return i.length===0?TB:i}function SB(n,e,t){const r=st(E.useCallback(s=>n?s.edges.filter(i=>{const o=e.get(i.source),a=e.get(i.target);return o?.width&&o?.height&&a?.width&&a?.height&&_B({sourcePos:o.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:o.width,sourceHeight:o.height,targetWidth:a.width,targetHeight:a.height,width:s.width,height:s.height,transform:s.transform})}):s.edges,[n,e]));return wB(r,e,t)}const NB=({color:n="none",strokeWidth:e=1})=>K.createElement("polyline",{style:{stroke:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),AB=({color:n="none",strokeWidth:e=1})=>K.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),G0={[jc.Arrow]:NB,[jc.ArrowClosed]:AB};function EB(n){const e=Tt();return E.useMemo(()=>Object.prototype.hasOwnProperty.call(G0,n)?G0[n]:(e.getState().onError?.("009",Pr.error009(n)),null),[n])}const CB=({id:n,type:e,color:t,width:r=12.5,height:s=12.5,markerUnits:i="strokeWidth",strokeWidth:o,orient:a="auto-start-reverse"})=>{const l=EB(e);return l?K.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${r}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0"},K.createElement(l,{color:t,strokeWidth:o})):null},RB=({defaultColor:n,rfId:e})=>t=>{const r=[];return t.edges.reduce((s,i)=>([i.markerStart,i.markerEnd].forEach(o=>{if(o&&typeof o=="object"){const a=wf(o,e);r.includes(a)||(s.push({id:a,color:o.color||n,...o}),r.push(a))}}),s),[]).sort((s,i)=>s.id.localeCompare(i.id))},o1=({defaultColor:n,rfId:e})=>{const t=st(E.useCallback(RB({defaultColor:n,rfId:e}),[n,e]),(r,s)=>!(r.length!==s.length||r.some((i,o)=>i.id!==s[o].id)));return K.createElement("defs",null,t.map(r=>K.createElement(CB,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient})))};o1.displayName="MarkerDefinitions";var MB=E.memo(o1);const PB=n=>({nodesConnectable:n.nodesConnectable,edgesFocusable:n.edgesFocusable,edgesUpdatable:n.edgesUpdatable,elementsSelectable:n.elementsSelectable,width:n.width,height:n.height,connectionMode:n.connectionMode,nodeInternals:n.nodeInternals,onError:n.onError}),a1=({defaultMarkerColor:n,onlyRenderVisibleElements:e,elevateEdgesOnSelect:t,rfId:r,edgeTypes:s,noPanClassName:i,onEdgeContextMenu:o,onEdgeMouseEnter:a,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:u,onEdgeDoubleClick:d,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,reconnectRadius:m,children:y,disableKeyboardA11y:x})=>{const{edgesFocusable:b,edgesUpdatable:v,elementsSelectable:_,width:w,height:T,connectionMode:N,nodeInternals:S,onError:C}=st(PB,Lt),D=SB(e,S,t);return w?K.createElement(K.Fragment,null,D.map(({level:F,edges:j,isMaxLevel:z})=>K.createElement("svg",{key:F,style:{zIndex:F},width:w,height:T,className:"react-flow__edges react-flow__container"},z&&K.createElement(MB,{defaultColor:n,rfId:r}),K.createElement("g",null,j.map(A=>{const[O,k,R]=j0(S.get(A.source)),[I,P,W]=j0(S.get(A.target));if(!R||!W)return null;let L=A.type||"default";s[L]||(C?.("011",Pr.error011(L)),L="default");const G=s[L]||s.default,Z=N===Qs.Strict?P.target:(P.target??[]).concat(P.source??[]),ee=V0(k.source,A.sourceHandle),U=V0(Z,A.targetHandle),Q=ee?.position||he.Bottom,te=U?.position||he.Top,le=!!(A.focusable||b&&typeof A.focusable>"u"),ye=A.reconnectable||A.updatable,ge=typeof h<"u"&&(ye||v&&typeof ye>"u");if(!ee||!U)return C?.("008",Pr.error008(ee,A)),null;const{sourceX:Me,sourceY:nt,targetX:xt,targetY:lt}=vB(O,ee,Q,I,U,te);return K.createElement(G,{key:A.id,id:A.id,className:zt([A.className,i]),type:L,data:A.data,selected:!!A.selected,animated:!!A.animated,hidden:!!A.hidden,label:A.label,labelStyle:A.labelStyle,labelShowBg:A.labelShowBg,labelBgStyle:A.labelBgStyle,labelBgPadding:A.labelBgPadding,labelBgBorderRadius:A.labelBgBorderRadius,style:A.style,source:A.source,target:A.target,sourceHandleId:A.sourceHandle,targetHandleId:A.targetHandle,markerEnd:A.markerEnd,markerStart:A.markerStart,sourceX:Me,sourceY:nt,targetX:xt,targetY:lt,sourcePosition:Q,targetPosition:te,elementsSelectable:_,onContextMenu:o,onMouseEnter:a,onMouseMove:l,onMouseLeave:c,onClick:u,onEdgeDoubleClick:d,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,reconnectRadius:m,rfId:r,ariaLabel:A.ariaLabel,isFocusable:le,isReconnectable:ge,pathOptions:"pathOptions"in A?A.pathOptions:void 0,interactionWidth:A.interactionWidth,disableKeyboardA11y:x})})))),y):null};a1.displayName="EdgeRenderer";var DB=E.memo(a1);const BB=n=>`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`;function kB({children:n}){const e=st(BB);return K.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:e}},n)}function FB(n){const e=hm(),t=E.useRef(!1);E.useEffect(()=>{!t.current&&e.viewportInitialized&&n&&(setTimeout(()=>n(e),1),t.current=!0)},[n,e.viewportInitialized])}const LB={[he.Left]:he.Right,[he.Right]:he.Left,[he.Top]:he.Bottom,[he.Bottom]:he.Top},l1=({nodeId:n,handleType:e,style:t,type:r=Wr.Bezier,CustomComponent:s,connectionStatus:i})=>{const{fromNode:o,handleId:a,toX:l,toY:c,connectionMode:u}=st(E.useCallback(T=>({fromNode:T.nodeInternals.get(n),handleId:T.connectionHandleId,toX:(T.connectionPosition.x-T.transform[0])/T.transform[2],toY:(T.connectionPosition.y-T.transform[1])/T.transform[2],connectionMode:T.connectionMode}),[n]),Lt),d=o?.[at]?.handleBounds;let h=d?.[e];if(u===Qs.Loose&&(h=h||d?.[e==="source"?"target":"source"]),!o||!h)return null;const f=a?h.find(T=>T.id===a):h[0],p=f?f.x+f.width/2:(o.width??0)/2,m=f?f.y+f.height/2:o.height??0,y=(o.positionAbsolute?.x??0)+p,x=(o.positionAbsolute?.y??0)+m,b=f?.position,v=b?LB[b]:null;if(!b||!v)return null;if(s)return K.createElement(s,{connectionLineType:r,connectionLineStyle:t,fromNode:o,fromHandle:f,fromX:y,fromY:x,toX:l,toY:c,fromPosition:b,toPosition:v,connectionStatus:i});let _="";const w={sourceX:y,sourceY:x,sourcePosition:b,targetX:l,targetY:c,targetPosition:v};return r===Wr.Bezier?[_]=MT(w):r===Wr.Step?[_]=Tf({...w,borderRadius:0}):r===Wr.SmoothStep?[_]=Tf(w):r===Wr.SimpleBezier?[_]=RT(w):_=`M${y},${x} ${l},${c}`,K.createElement("path",{d:_,fill:"none",className:"react-flow__connection-path",style:t})};l1.displayName="ConnectionLine";const IB=n=>({nodeId:n.connectionNodeId,handleType:n.connectionHandleType,nodesConnectable:n.nodesConnectable,connectionStatus:n.connectionStatus,width:n.width,height:n.height});function OB({containerStyle:n,style:e,type:t,component:r}){const{nodeId:s,handleType:i,nodesConnectable:o,width:a,height:l,connectionStatus:c}=st(IB,Lt);return!(s&&i&&a&&o)?null:K.createElement("svg",{style:n,width:a,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},K.createElement("g",{className:zt(["react-flow__connection",c])},K.createElement(l1,{nodeId:s,handleType:i,style:e,type:t,CustomComponent:r,connectionStatus:c})))}function $0(n,e){return E.useRef(null),Tt(),E.useMemo(()=>e(n),[n])}const c1=({nodeTypes:n,edgeTypes:e,onMove:t,onMoveStart:r,onMoveEnd:s,onInit:i,onNodeClick:o,onEdgeClick:a,onNodeDoubleClick:l,onEdgeDoubleClick:c,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:f,onSelectionContextMenu:p,onSelectionStart:m,onSelectionEnd:y,connectionLineType:x,connectionLineStyle:b,connectionLineComponent:v,connectionLineContainerStyle:_,selectionKeyCode:w,selectionOnDrag:T,selectionMode:N,multiSelectionKeyCode:S,panActivationKeyCode:C,zoomActivationKeyCode:D,deleteKeyCode:F,onlyRenderVisibleElements:j,elementsSelectable:z,selectNodesOnDrag:A,defaultViewport:O,translateExtent:k,minZoom:R,maxZoom:I,preventScrolling:P,defaultMarkerColor:W,zoomOnScroll:L,zoomOnPinch:G,panOnScroll:Z,panOnScrollSpeed:ee,panOnScrollMode:U,zoomOnDoubleClick:Q,panOnDrag:te,onPaneClick:le,onPaneMouseEnter:ye,onPaneMouseMove:ge,onPaneMouseLeave:Me,onPaneScroll:nt,onPaneContextMenu:xt,onEdgeContextMenu:lt,onEdgeMouseEnter:He,onEdgeMouseMove:wt,onEdgeMouseLeave:Pe,onReconnect:ue,onReconnectStart:en,onReconnectEnd:ps,reconnectRadius:_o,noDragClassName:ti,noWheelClassName:ni,noPanClassName:cr,elevateEdgesOnSelect:ri,disableKeyboardA11y:ms,nodeOrigin:gs,nodeExtent:si,rfId:ii})=>{const To=$0(n,hB),Mt=$0(e,bB);return FB(i),K.createElement(uB,{onPaneClick:le,onPaneMouseEnter:ye,onPaneMouseMove:ge,onPaneMouseLeave:Me,onPaneContextMenu:xt,onPaneScroll:nt,deleteKeyCode:F,selectionKeyCode:w,selectionOnDrag:T,selectionMode:N,onSelectionStart:m,onSelectionEnd:y,multiSelectionKeyCode:S,panActivationKeyCode:C,zoomActivationKeyCode:D,elementsSelectable:z,onMove:t,onMoveStart:r,onMoveEnd:s,zoomOnScroll:L,zoomOnPinch:G,zoomOnDoubleClick:Q,panOnScroll:Z,panOnScrollSpeed:ee,panOnScrollMode:U,panOnDrag:te,defaultViewport:O,translateExtent:k,minZoom:R,maxZoom:I,onSelectionContextMenu:p,preventScrolling:P,noDragClassName:ti,noWheelClassName:ni,noPanClassName:cr,disableKeyboardA11y:ms},K.createElement(kB,null,K.createElement(DB,{edgeTypes:Mt,onEdgeClick:a,onEdgeDoubleClick:c,onlyRenderVisibleElements:j,onEdgeContextMenu:lt,onEdgeMouseEnter:He,onEdgeMouseMove:wt,onEdgeMouseLeave:Pe,onReconnect:ue,onReconnectStart:en,onReconnectEnd:ps,reconnectRadius:_o,defaultMarkerColor:W,noPanClassName:cr,elevateEdgesOnSelect:!!ri,disableKeyboardA11y:ms,rfId:ii},K.createElement(OB,{style:b,type:x,component:v,containerStyle:_})),K.createElement("div",{className:"react-flow__edgelabel-renderer"}),K.createElement(mB,{nodeTypes:To,onNodeClick:o,onNodeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:h,onNodeContextMenu:f,selectNodesOnDrag:A,onlyRenderVisibleElements:j,noPanClassName:cr,noDragClassName:ti,disableKeyboardA11y:ms,nodeOrigin:gs,nodeExtent:si,rfId:ii})))};c1.displayName="GraphView";var UB=E.memo(c1);const Ef=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ir={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:Ef,nodeExtent:Ef,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Qs.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:pD,isValidConnection:void 0},VB=()=>CR((n,e)=>({...Ir,setNodes:t=>{const{nodeInternals:r,nodeOrigin:s,elevateNodesOnSelect:i}=e();n({nodeInternals:ld(t,r,s,i)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:t=>{const{defaultEdgeOptions:r={}}=e();n({edges:t.map(s=>({...r,...s}))})},setDefaultNodesAndEdges:(t,r)=>{const s=typeof t<"u",i=typeof r<"u",o=s?ld(t,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;n({nodeInternals:o,edges:i?r:[],hasDefaultNodes:s,hasDefaultEdges:i})},updateNodeDimensions:t=>{const{onNodesChange:r,nodeInternals:s,fitViewOnInit:i,fitViewOnInitDone:o,fitViewOnInitOptions:a,domNode:l,nodeOrigin:c}=e(),u=l?.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:h}=new window.DOMMatrixReadOnly(d.transform),f=t.reduce((m,y)=>{const x=s.get(y.id);if(x?.hidden)s.set(x.id,{...x,[at]:{...x[at],handleBounds:void 0}});else if(x){const b=nm(y.nodeElement);!!(b.width&&b.height&&(x.width!==b.width||x.height!==b.height||y.forceUpdate))&&(s.set(x.id,{...x,[at]:{...x[at],handleBounds:{source:L0(".source",y.nodeElement,h,c),target:L0(".target",y.nodeElement,h,c)}},...b}),m.push({id:x.id,type:"dimensions",dimensions:b}))}return m},[]);KT(s,c);const p=o||i&&!o&&YT(e,{initial:!0,...a});n({nodeInternals:new Map(s),fitViewOnInitDone:p}),f?.length>0&&r?.(f)},updateNodePositions:(t,r=!0,s=!1)=>{const{triggerNodeChanges:i}=e(),o=t.map(a=>{const l={id:a.id,type:"position",dragging:s};return r&&(l.positionAbsolute=a.positionAbsolute,l.position=a.position),l});i(o)},triggerNodeChanges:t=>{const{onNodesChange:r,nodeInternals:s,hasDefaultNodes:i,nodeOrigin:o,getNodes:a,elevateNodesOnSelect:l}=e();if(t?.length){if(i){const c=ZT(t,a()),u=ld(c,s,o,l);n({nodeInternals:u})}r?.(t)}},addSelectedNodes:t=>{const{multiSelectionActive:r,edges:s,getNodes:i}=e();let o,a=null;r?o=t.map(l=>zr(l,!0)):(o=Ni(i(),t),a=Ni(s,[])),xl({changedNodes:o,changedEdges:a,get:e,set:n})},addSelectedEdges:t=>{const{multiSelectionActive:r,edges:s,getNodes:i}=e();let o,a=null;r?o=t.map(l=>zr(l,!0)):(o=Ni(s,t),a=Ni(i(),[])),xl({changedNodes:a,changedEdges:o,get:e,set:n})},unselectNodesAndEdges:({nodes:t,edges:r}={})=>{const{edges:s,getNodes:i}=e(),o=t||i(),a=r||s,l=o.map(u=>(u.selected=!1,zr(u.id,!1))),c=a.map(u=>zr(u.id,!1));xl({changedNodes:l,changedEdges:c,get:e,set:n})},setMinZoom:t=>{const{d3Zoom:r,maxZoom:s}=e();r?.scaleExtent([t,s]),n({minZoom:t})},setMaxZoom:t=>{const{d3Zoom:r,minZoom:s}=e();r?.scaleExtent([s,t]),n({maxZoom:t})},setTranslateExtent:t=>{e().d3Zoom?.translateExtent(t),n({translateExtent:t})},resetSelectedElements:()=>{const{edges:t,getNodes:r}=e(),i=r().filter(a=>a.selected).map(a=>zr(a.id,!1)),o=t.filter(a=>a.selected).map(a=>zr(a.id,!1));xl({changedNodes:i,changedEdges:o,get:e,set:n})},setNodeExtent:t=>{const{nodeInternals:r}=e();r.forEach(s=>{s.positionAbsolute=rm(s.position,t)}),n({nodeExtent:t,nodeInternals:new Map(r)})},panBy:t=>{const{transform:r,width:s,height:i,d3Zoom:o,d3Selection:a,translateExtent:l}=e();if(!o||!a||!t.x&&!t.y)return!1;const c=es.translate(r[0]+t.x,r[1]+t.y).scale(r[2]),u=[[0,0],[s,i]],d=o?.constrain()(c,u,l);return o.transform(a,d),r[0]!==d.x||r[1]!==d.y||r[2]!==d.k},cancelConnection:()=>n({connectionNodeId:Ir.connectionNodeId,connectionHandleId:Ir.connectionHandleId,connectionHandleType:Ir.connectionHandleType,connectionStatus:Ir.connectionStatus,connectionStartHandle:Ir.connectionStartHandle,connectionEndHandle:Ir.connectionEndHandle}),reset:()=>n({...Ir})}),Object.is),u1=({children:n})=>{const e=E.useRef(null);return e.current||(e.current=VB()),K.createElement(oD,{value:e.current},n)};u1.displayName="ReactFlowProvider";const d1=({children:n})=>E.useContext(Tu)?K.createElement(K.Fragment,null,n):K.createElement(u1,null,n);d1.displayName="ReactFlowWrapper";const jB={input:GT,default:Nf,output:zT,group:dm},GB={default:Gc,straight:am,step:om,smoothstep:wu,simplebezier:im},$B=[0,0],zB=[15,15],HB={x:0,y:0,zoom:1},WB={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},h1=E.forwardRef(({nodes:n,edges:e,defaultNodes:t,defaultEdges:r,className:s,nodeTypes:i=jB,edgeTypes:o=GB,onNodeClick:a,onEdgeClick:l,onInit:c,onMove:u,onMoveStart:d,onMoveEnd:h,onConnect:f,onConnectStart:p,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:x,onNodeMouseEnter:b,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:w,onNodeDoubleClick:T,onNodeDragStart:N,onNodeDrag:S,onNodeDragStop:C,onNodesDelete:D,onEdgesDelete:F,onSelectionChange:j,onSelectionDragStart:z,onSelectionDrag:A,onSelectionDragStop:O,onSelectionContextMenu:k,onSelectionStart:R,onSelectionEnd:I,connectionMode:P=Qs.Strict,connectionLineType:W=Wr.Bezier,connectionLineStyle:L,connectionLineComponent:G,connectionLineContainerStyle:Z,deleteKeyCode:ee="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:Q=!1,selectionMode:te=Ma.Full,panActivationKeyCode:le="Space",multiSelectionKeyCode:ye=Vc()?"Meta":"Control",zoomActivationKeyCode:ge=Vc()?"Meta":"Control",snapToGrid:Me=!1,snapGrid:nt=zB,onlyRenderVisibleElements:xt=!1,selectNodesOnDrag:lt=!0,nodesDraggable:He,nodesConnectable:wt,nodesFocusable:Pe,nodeOrigin:ue=$B,edgesFocusable:en,edgesUpdatable:ps,elementsSelectable:_o,defaultViewport:ti=HB,minZoom:ni=.5,maxZoom:cr=2,translateExtent:ri=Ef,preventScrolling:ms=!0,nodeExtent:gs,defaultMarkerColor:si="#b1b1b7",zoomOnScroll:ii=!0,zoomOnPinch:To=!0,panOnScroll:Mt=!1,panOnScrollSpeed:Un=.5,panOnScrollMode:xs=Is.Free,zoomOnDoubleClick:ys=!0,panOnDrag:oi=!0,onPaneClick:Vn,onPaneMouseEnter:bs,onPaneMouseMove:Ju,onPaneMouseLeave:ed,onPaneScroll:wo,onPaneContextMenu:td,children:Ig,onEdgeContextMenu:vs,onEdgeDoubleClick:JA,onEdgeMouseEnter:eE,onEdgeMouseMove:tE,onEdgeMouseLeave:nE,onEdgeUpdate:rE,onEdgeUpdateStart:sE,onEdgeUpdateEnd:iE,onReconnect:oE,onReconnectStart:aE,onReconnectEnd:lE,reconnectRadius:cE=10,edgeUpdaterRadius:uE=10,onNodesChange:dE,onEdgesChange:hE,noDragClassName:fE="nodrag",noWheelClassName:pE="nowheel",noPanClassName:Og="nopan",fitView:mE=!1,fitViewOptions:gE,connectOnClick:xE=!0,attributionPosition:yE,proOptions:bE,defaultEdgeOptions:vE,elevateNodesOnSelect:_E=!0,elevateEdgesOnSelect:TE=!1,disableKeyboardA11y:Ug=!1,autoPanOnConnect:wE=!0,autoPanOnNodeDrag:SE=!0,connectionRadius:NE=20,isValidConnection:AE,onError:EE,style:CE,id:Vg,nodeDragThreshold:RE,...ME},PE)=>{const nd=Vg||"1";return K.createElement("div",{...ME,style:{...CE,...WB},ref:PE,className:zt(["react-flow",s]),"data-testid":"rf__wrapper",id:Vg},K.createElement(d1,null,K.createElement(UB,{onInit:c,onMove:u,onMoveStart:d,onMoveEnd:h,onNodeClick:a,onEdgeClick:l,onNodeMouseEnter:b,onNodeMouseMove:v,onNodeMouseLeave:_,onNodeContextMenu:w,onNodeDoubleClick:T,nodeTypes:i,edgeTypes:o,connectionLineType:W,connectionLineStyle:L,connectionLineComponent:G,connectionLineContainerStyle:Z,selectionKeyCode:U,selectionOnDrag:Q,selectionMode:te,deleteKeyCode:ee,multiSelectionKeyCode:ye,panActivationKeyCode:le,zoomActivationKeyCode:ge,onlyRenderVisibleElements:xt,selectNodesOnDrag:lt,defaultViewport:ti,translateExtent:ri,minZoom:ni,maxZoom:cr,preventScrolling:ms,zoomOnScroll:ii,zoomOnPinch:To,zoomOnDoubleClick:ys,panOnScroll:Mt,panOnScrollSpeed:Un,panOnScrollMode:xs,panOnDrag:oi,onPaneClick:Vn,onPaneMouseEnter:bs,onPaneMouseMove:Ju,onPaneMouseLeave:ed,onPaneScroll:wo,onPaneContextMenu:td,onSelectionContextMenu:k,onSelectionStart:R,onSelectionEnd:I,onEdgeContextMenu:vs,onEdgeDoubleClick:JA,onEdgeMouseEnter:eE,onEdgeMouseMove:tE,onEdgeMouseLeave:nE,onReconnect:oE??rE,onReconnectStart:aE??sE,onReconnectEnd:lE??iE,reconnectRadius:cE??uE,defaultMarkerColor:si,noDragClassName:fE,noWheelClassName:pE,noPanClassName:Og,elevateEdgesOnSelect:TE,rfId:nd,disableKeyboardA11y:Ug,nodeOrigin:ue,nodeExtent:gs}),K.createElement(LD,{nodes:n,edges:e,defaultNodes:t,defaultEdges:r,onConnect:f,onConnectStart:p,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:x,nodesDraggable:He,nodesConnectable:wt,nodesFocusable:Pe,edgesFocusable:en,edgesUpdatable:ps,elementsSelectable:_o,elevateNodesOnSelect:_E,minZoom:ni,maxZoom:cr,nodeExtent:gs,onNodesChange:dE,onEdgesChange:hE,snapToGrid:Me,snapGrid:nt,connectionMode:P,translateExtent:ri,connectOnClick:xE,defaultEdgeOptions:vE,fitView:mE,fitViewOptions:gE,onNodesDelete:D,onEdgesDelete:F,onNodeDragStart:N,onNodeDrag:S,onNodeDragStop:C,onSelectionDrag:A,onSelectionDragStart:z,onSelectionDragStop:O,noPanClassName:Og,nodeOrigin:ue,rfId:nd,autoPanOnConnect:wE,autoPanOnNodeDrag:SE,onError:EE,connectionRadius:NE,isValidConnection:AE,nodeDragThreshold:RE}),K.createElement(kD,{onSelectionChange:j}),Ig,K.createElement(lD,{proOptions:bE,position:yE}),K.createElement(jD,{rfId:nd,disableKeyboardA11y:Ug})))});h1.displayName="ReactFlow";function qB(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},K.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function XB(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},K.createElement("path",{d:"M0 0h32v4.2H0z"}))}function KB(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},K.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function YB(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},K.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function QB(){return K.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},K.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Qo=({children:n,className:e,...t})=>K.createElement("button",{type:"button",className:zt(["react-flow__controls-button",e]),...t},n);Qo.displayName="ControlButton";const ZB=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom}),f1=({style:n,showZoom:e=!0,showFitView:t=!0,showInteractive:r=!0,fitViewOptions:s,onZoomIn:i,onZoomOut:o,onFitView:a,onInteractiveChange:l,className:c,children:u,position:d="bottom-left"})=>{const h=Tt(),[f,p]=E.useState(!1),{isInteractive:m,minZoomReached:y,maxZoomReached:x}=st(ZB,Lt),{zoomIn:b,zoomOut:v,fitView:_}=hm();if(E.useEffect(()=>{p(!0)},[]),!f)return null;const w=()=>{b(),i?.()},T=()=>{v(),o?.()},N=()=>{_(s),a?.()},S=()=>{h.setState({nodesDraggable:!m,nodesConnectable:!m,elementsSelectable:!m}),l?.(!m)};return K.createElement(TT,{className:zt(["react-flow__controls",c]),position:d,style:n,"data-testid":"rf__controls"},e&&K.createElement(K.Fragment,null,K.createElement(Qo,{onClick:w,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:x},K.createElement(qB,null)),K.createElement(Qo,{onClick:T,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},K.createElement(XB,null))),t&&K.createElement(Qo,{className:"react-flow__controls-fitview",onClick:N,title:"fit view","aria-label":"fit view"},K.createElement(KB,null)),r&&K.createElement(Qo,{className:"react-flow__controls-interactive",onClick:S,title:"toggle interactivity","aria-label":"toggle interactivity"},m?K.createElement(QB,null):K.createElement(YB,null)),u)};f1.displayName="Controls";var JB=E.memo(f1),Bn;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(Bn||(Bn={}));function ek({color:n,dimensions:e,lineWidth:t}){return K.createElement("path",{stroke:n,strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function tk({color:n,radius:e}){return K.createElement("circle",{cx:e,cy:e,r:e,fill:n})}const nk={[Bn.Dots]:"#91919a",[Bn.Lines]:"#eee",[Bn.Cross]:"#e2e2e2"},rk={[Bn.Dots]:1,[Bn.Lines]:1,[Bn.Cross]:6},sk=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function p1({id:n,variant:e=Bn.Dots,gap:t=20,size:r,lineWidth:s=1,offset:i=2,color:o,style:a,className:l}){const c=E.useRef(null),{transform:u,patternId:d}=st(sk,Lt),h=o||nk[e],f=r||rk[e],p=e===Bn.Dots,m=e===Bn.Cross,y=Array.isArray(t)?t:[t,t],x=[y[0]*u[2]||1,y[1]*u[2]||1],b=f*u[2],v=m?[b,b]:x,_=p?[b/i,b/i]:[v[0]/i,v[1]/i];return K.createElement("svg",{className:zt(["react-flow__background",l]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},K.createElement("pattern",{id:d+n,x:u[0]%x[0],y:u[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`},p?K.createElement(tk,{color:h,radius:b/i}):K.createElement(ek,{dimensions:v,color:h,lineWidth:s})),K.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${d+n})`}))}p1.displayName="Background";var ik=E.memo(p1);const ok=({data:n,type:e})=>{const r={source:"var(--hud-accent)",cache:"var(--hud-success)",llm:"var(--hud-accent-secondary)",sector:"#f59e0b"}[n.type]||"var(--hud-text)";return g.jsxs("div",{className:"px-4 py-2 rounded bg-black border border-[var(--hud-border)] shadow-[0_0_15px_rgba(0,0,0,0.5)] min-w-[150px]",children:[g.jsx(Qi,{type:"target",position:he.Top,className:"!bg-[var(--hud-text-dim)]"}),g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:r}}),g.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-white",children:n.label})]}),g.jsx("div",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:n.details}),g.jsx(Qi,{type:"source",position:he.Bottom,className:"!bg-[var(--hud-text-dim)]"})]})},ak={cyber:ok};function lk(){const[n,e]=E.useState([]),[t,r]=E.useState([]),[s,i]=E.useState(!0),[o,a]=E.useState(1),[l,c]=E.useState({useCase:"",performance:"balanced"}),u=E.useCallback(m=>e(y=>ZT(m,y)),[]),d=E.useCallback(m=>r(y=>tB(m,y)),[]),h=E.useCallback(m=>r(y=>PT(m,y)),[]),f=()=>{const m=[{id:"1",type:"cyber",position:{x:250,y:0},data:{label:"HTTP API",type:"source",details:"Ingress"}},{id:"2",type:"cyber",position:{x:250,y:100},data:{label:"L1 Cache",type:"cache",details:"Redis (In-Memory)"}},{id:"3",type:"cyber",position:{x:250,y:200},data:{label:"Semantic Router",type:"sector",details:"Healthcare Model"}},{id:"4",type:"cyber",position:{x:250,y:300},data:{label:"GPT-4o",type:"llm",details:"Fallback"}}],y=[{id:"e1-2",source:"1",target:"2",animated:!0,style:{stroke:"var(--hud-accent)"}},{id:"e2-3",source:"2",target:"3",animated:!0,style:{stroke:"var(--hud-accent)"}},{id:"e3-4",source:"3",target:"4",animated:!0,style:{stroke:"var(--hud-accent)"}}];e(m),r(y),i(!1)},p=async()=>{try{const m=localStorage.getItem("agentcache_token");if(!m){alert("Authentication required. Please log in.");return}const y={name:`Pipeline ${new Date().toLocaleTimeString()}`,sector:l.useCase||"custom",nodes:n,connections:t,description:`Generated via Wizard (${l.performance})`,complexity:{tier:"moderate",score:n.length*10},monthlyCost:0,features:["cache","llm"]},b=await(await fetch("/api/pipelines/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(y)})).json();if(b.success)alert(`Pipeline Saved! ID: ${b.pipeline.id}`);else throw new Error(b.error||"Unknown error")}catch(m){console.error("Save failed",m),alert(`Failed to save: ${m.message}`)}};return g.jsxs("div",{className:"h-[calc(100vh-8rem)] flex gap-6 relative",children:[g.jsx("div",{className:"w-64 flex flex-col gap-4",children:g.jsx(Ue,{title:"Node Palette",icon:HC,className:"flex-1",children:g.jsx("div",{className:"space-y-2",children:["Source","Cache","LLM","Sector"].map(m=>g.jsx("div",{draggable:!0,onDragStart:y=>{y.dataTransfer.setData("application/reactflow",m),y.dataTransfer.effectAllowed="move"},className:"p-3 rounded bg-[rgba(255,255,255,0.05)] border border-transparent hover:border-[var(--hud-accent)] cursor-grab active:cursor-grabbing transition-colors",children:g.jsxs("span",{className:"text-sm font-bold text-white",children:[m," Node"]})},m))})})}),g.jsxs("div",{className:"flex-1 rounded-lg border border-[var(--hud-border)] bg-black/50 overflow-hidden relative",onDragOver:m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},onDrop:m=>{m.preventDefault();const y=m.dataTransfer.getData("application/reactflow");if(!y)return;const x=m.currentTarget.getBoundingClientRect(),b={x:m.clientX-x.left-75,y:m.clientY-x.top-20},v={id:`${y}-${Date.now()}`,type:"cyber",position:b,data:{label:`${y} Node`,type:y.toLowerCase(),details:"New Node"}};e(_=>_.concat(v))},children:[g.jsxs(h1,{nodes:n,edges:t,onNodesChange:u,onEdgesChange:d,onConnect:h,nodeTypes:ak,fitView:!0,children:[g.jsx(ik,{color:"#333",gap:20}),g.jsx(JB,{className:"!bg-black !border-[var(--hud-border)] !fill-white"})]}),g.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[g.jsxs("button",{onClick:()=>i(!0),className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs",children:[g.jsx(pR,{size:14})," Wizard"]}),g.jsxs("button",{onClick:p,className:"btn-cyber px-4 py-2 flex items-center gap-2 text-xs",children:[g.jsx(XC,{size:14})," Save"]}),g.jsxs("button",{className:"btn-cyber btn-cyber-primary px-4 py-2 flex items-center gap-2 text-xs",children:[g.jsx($C,{size:14})," Deploy"]})]})]}),s&&g.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:g.jsxs(Ue,{className:"w-[600px] max-h-[80vh] overflow-y-auto relative",children:[g.jsx("button",{onClick:()=>i(!1),className:"absolute top-4 right-4 text-[var(--hud-text-dim)] hover:text-white",children:g.jsx(W_,{size:20})}),g.jsxs("div",{className:"mb-6",children:[g.jsx("h2",{className:"text-xl font-bold text-[var(--hud-accent)] tracking-widest mb-1",children:"PIPELINE WIZARD"}),g.jsx("p",{className:"text-xs font-mono text-[var(--hud-text-dim)]",children:"CONFIGURE ORCHESTRATION PARAMETERS"})]}),o===1&&g.jsxs("div",{className:"space-y-4",children:[g.jsx("h3",{className:"text-sm font-bold text-white",children:"SELECT USE CASE"}),g.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{id:"clinical",label:"Clinical Decision",icon:""},{id:"trading",label:"Trading Assistant",icon:""},{id:"legal",label:"Contract Review",icon:""},{id:"custom",label:"Custom",icon:""}].map(m=>g.jsxs("button",{onClick:()=>{c({...l,useCase:m.id}),a(2)},className:"p-4 rounded border border-[var(--hud-border)] hover:border-[var(--hud-accent)] hover:bg-[var(--hud-accent)]/10 text-left transition-all",children:[g.jsx("div",{className:"text-2xl mb-2",children:m.icon}),g.jsx("div",{className:"font-bold text-sm text-white",children:m.label})]},m.id))})]}),o===2&&g.jsxs("div",{className:"space-y-6",children:[g.jsx("h3",{className:"text-sm font-bold text-white",children:"OPTIMIZATION TARGET"}),g.jsx("div",{className:"space-y-3",children:[{id:"fast",label:"Low Latency",desc:"Minimize response time"},{id:"balanced",label:"Balanced",desc:"Good speed + cost savings"},{id:"cost",label:"Cost Optimized",desc:"Maximum savings"}].map(m=>g.jsxs("button",{onClick:()=>c({...l,performance:m.id}),className:`w-full p-4 rounded border text-left transition-all ${l.performance===m.id?"border-[var(--hud-accent)] bg-[var(--hud-accent)]/10":"border-[var(--hud-border)] hover:bg-[rgba(255,255,255,0.05)]"}`,children:[g.jsx("div",{className:"font-bold text-sm text-white",children:m.label}),g.jsx("div",{className:"text-xs text-[var(--hud-text-dim)]",children:m.desc})]},m.id))}),g.jsxs("div",{className:"flex justify-between pt-4 border-t border-[var(--hud-border)]",children:[g.jsx("button",{onClick:()=>a(1),className:"text-xs text-[var(--hud-text-dim)] hover:text-white",children:"BACK"}),g.jsx("button",{onClick:f,className:"btn-cyber btn-cyber-primary px-6 py-2 text-sm font-bold",children:"GENERATE"})]})]})]})})]})}function ck(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function uk(n,e,t){return e=yk(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function z0(n,e){return fk(n)||ck(n,e)||m1(n,e)||gk()}function dk(n){return hk(n)||pk(n)||m1(n)||mk()}function hk(n){if(Array.isArray(n))return Cf(n)}function fk(n){if(Array.isArray(n))return n}function pk(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function m1(n,e){if(n){if(typeof n=="string")return Cf(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Cf(n,e)}}function Cf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function mk(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xk(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function yk(n){var e=xk(n,"string");return typeof e=="symbol"?e:String(e)}var bk=function(e,t){var r=new Set(t);return Object.assign.apply(Object,[{}].concat(dk(Object.entries(e).filter(function(s){var i=z0(s,1),o=i[0];return!r.has(o)}).map(function(s){var i=z0(s,2),o=i[0],a=i[1];return uk({},o,a)}))))};function Rf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function vk(n){if(Array.isArray(n))return n}function _k(n){if(Array.isArray(n))return Rf(n)}function Tk(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function wk(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function Sk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nk(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ak(n,e){return vk(n)||wk(n,e)||g1(n,e)||Sk()}function H0(n){return _k(n)||Tk(n)||g1(n)||Nk()}function g1(n,e){if(n){if(typeof n=="string")return Rf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Rf(n,e):void 0}}function Ek(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,r=t===void 0?"div":t,s=e.nodeMapper,i=s===void 0?function(u){return u}:s,o=e.methodNames,a=o===void 0?[]:o,l=e.initPropNames,c=l===void 0?[]:l;return E.forwardRef(function(u,d){var h=E.useRef(),f=E.useMemo(function(){var y=Object.fromEntries(c.filter(function(x){return u.hasOwnProperty(x)}).map(function(x){return[x,u[x]]}));return n(y)},[]);W0(function(){f(i(h.current))},E.useLayoutEffect),W0(function(){return f._destructor instanceof Function?f._destructor:void 0});var p=E.useCallback(function(y){for(var x=arguments.length,b=new Array(x>1?x-1:0),v=1;v<x;v++)b[v-1]=arguments[v];return f[y]instanceof Function?f[y].apply(f,b):void 0},[f]),m=E.useRef({});return Object.keys(bk(u,[].concat(H0(a),H0(c)))).filter(function(y){return m.current[y]!==u[y]}).forEach(function(y){return p(y,u[y])}),m.current=u,E.useImperativeHandle(d,function(){return Object.fromEntries(a.map(function(y){return[y,function(){for(var x=arguments.length,b=new Array(x),v=0;v<x;v++)b[v]=arguments[v];return p.apply(void 0,[y].concat(b))}]}))},[p]),K.createElement(r,{ref:h})})}function W0(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.useEffect,t=E.useRef(),r=E.useRef(!1),s=E.useRef(!1),i=E.useState(0),o=Ak(i,2);o[0];var a=o[1];r.current&&(s.current=!0),e(function(){return r.current||(t.current=n(),r.current=!0),a(function(l){return l+1}),function(){s.current&&t.current&&t.current()}},[])}const Oi=new hu,vr=new we,x1=new ce,hd=new we,fc=new we,$c=new ce,Mf=new ce,y1=new In,b1=new ce,v1=new ce;let Dt=null,Hn=null;const _r=[],ns={NONE:-1,PAN:0,ROTATE:1};class Ck extends du{constructor(e,t,r=null){super(t,r),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new Wv,this.mouseButtons={LEFT:Et.PAN,MIDDLE:Et.PAN,RIGHT:Et.ROTATE},this.touches={ONE:wr.PAN},this._onPointerMove=Rk.bind(this),this._onPointerDown=Mk.bind(this),this._onPointerCancel=Pk.bind(this),this._onContextMenu=Dk.bind(this),r!==null&&this.connect(r)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();vr.x=(e.clientX-t.left)/t.width*2-1,vr.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Et.PAN:case wr.PAN:this.state=ns.PAN;break;case Et.ROTATE:case wr.ROTATE:this.state=ns.ROTATE;break;default:this.state=ns.NONE}}}function Rk(n){const e=this.object,t=this.domElement,r=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),r.setFromCamera(vr,e),Dt)this.state===ns.PAN?r.ray.intersectPlane(Oi,$c)&&(Dt.position.copy($c.sub(x1).applyMatrix4(y1)),this.dispatchEvent({type:"drag",object:Dt})):this.state===ns.ROTATE&&(hd.subVectors(vr,fc).multiplyScalar(this.rotateSpeed),Dt.rotateOnWorldAxis(b1,hd.x),Dt.rotateOnWorldAxis(v1.normalize(),-hd.y),this.dispatchEvent({type:"drag",object:Dt})),fc.copy(vr);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(_r.length=0,r.setFromCamera(vr,e),r.intersectObjects(this.objects,this.recursive,_r),_r.length>0){const s=_r[0].object;Oi.setFromNormalAndCoplanarPoint(e.getWorldDirection(Oi.normal),Mf.setFromMatrixPosition(s.matrixWorld)),Hn!==s&&Hn!==null&&(this.dispatchEvent({type:"hoveroff",object:Hn}),t.style.cursor="auto",Hn=null),Hn!==s&&(this.dispatchEvent({type:"hoveron",object:s}),t.style.cursor="pointer",Hn=s)}else Hn!==null&&(this.dispatchEvent({type:"hoveroff",object:Hn}),t.style.cursor="auto",Hn=null);fc.copy(vr)}}function Mk(n){const e=this.object,t=this.domElement,r=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),_r.length=0,r.setFromCamera(vr,e),r.intersectObjects(this.objects,this.recursive,_r),_r.length>0&&(this.transformGroup===!0?Dt=_1(_r[0].object):Dt=_r[0].object,Oi.setFromNormalAndCoplanarPoint(e.getWorldDirection(Oi.normal),Mf.setFromMatrixPosition(Dt.matrixWorld)),r.ray.intersectPlane(Oi,$c)&&(this.state===ns.PAN?(y1.copy(Dt.parent.matrixWorld).invert(),x1.copy($c).sub(Mf.setFromMatrixPosition(Dt.matrixWorld)),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Dt})):this.state===ns.ROTATE&&(b1.set(0,1,0).applyQuaternion(e.quaternion).normalize(),v1.set(1,0,0).applyQuaternion(e.quaternion).normalize(),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Dt})))),fc.copy(vr))}function Pk(){this.enabled!==!1&&(Dt&&(this.dispatchEvent({type:"dragend",object:Dt}),Dt=null),this.domElement.style.cursor=Hn?"pointer":"auto",this.state=ns.NONE)}function Dk(n){this.enabled!==!1&&n.preventDefault()}function _1(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:_1(n.parent,e)}function Bk(n,e,t){var r,s=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function i(){var o,a=r.length,l,c=0,u=0,d=0;for(o=0;o<a;++o)l=r[o],c+=l.x||0,u+=l.y||0,d+=l.z||0;for(c=(c/a-n)*s,u=(u/a-e)*s,d=(d/a-t)*s,o=0;o<a;++o)l=r[o],c&&(l.x-=c),u&&(l.y-=u),d&&(l.z-=d)}return i.initialize=function(o){r=o},i.x=function(o){return arguments.length?(n=+o,i):n},i.y=function(o){return arguments.length?(e=+o,i):e},i.z=function(o){return arguments.length?(t=+o,i):t},i.strength=function(o){return arguments.length?(s=+o,i):s},i}function kk(n){const e=+this._x.call(null,n);return T1(this.cover(e),e,n)}function T1(n,e,t){if(isNaN(e))return n;var r,s=n._root,i={data:t},o=n._x0,a=n._x1,l,c,u,d,h;if(!s)return n._root=i,n;for(;s.length;)if((u=e>=(l=(o+a)/2))?o=l:a=l,r=s,!(s=s[d=+u]))return r[d]=i,n;if(c=+n._x.call(null,s.data),e===c)return i.next=s,r?r[d]=i:n._root=i,n;do r=r?r[d]=new Array(2):n._root=new Array(2),(u=e>=(l=(o+a)/2))?o=l:a=l;while((d=+u)==(h=+(c>=l)));return r[h]=s,r[d]=i,n}function Fk(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let r=1/0,s=-1/0;for(let i=0,o;i<e;++i)isNaN(o=+this._x.call(null,n[i]))||(t[i]=o,o<r&&(r=o),o>s&&(s=o));if(r>s)return this;this.cover(r).cover(s);for(let i=0;i<e;++i)T1(this,t[i],n[i]);return this}function Lk(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var r=t-e||1,s=this._root,i,o;e>n||n>=t;)switch(o=+(n<e),i=new Array(2),i[o]=s,s=i,r*=2,o){case 0:t=e+r;break;case 1:e=t-r;break}this._root&&this._root.length&&(this._root=s)}return this._x0=e,this._x1=t,this}function Ik(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function Ok(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Er(n,e,t){this.node=n,this.x0=e,this.x1=t}function Uk(n,e){var t,r=this._x0,s,i,o=this._x1,a=[],l=this._root,c,u;for(l&&a.push(new Er(l,r,o)),e==null?e=1/0:(r=n-e,o=n+e);c=a.pop();)if(!(!(l=c.node)||(s=c.x0)>o||(i=c.x1)<r))if(l.length){var d=(s+i)/2;a.push(new Er(l[1],d,i),new Er(l[0],s,d)),(u=+(n>=d))&&(c=a[a.length-1],a[a.length-1]=a[a.length-1-u],a[a.length-1-u]=c)}else{var h=Math.abs(n-+this._x.call(null,l.data));h<e&&(e=h,r=n-h,o=n+h,t=l.data)}return t}function Vk(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,t=this._root,r,s,i,o=this._x0,a=this._x1,l,c,u,d,h;if(!t)return this;if(t.length)for(;;){if((u=l>=(c=(o+a)/2))?o=c:a=c,e=t,!(t=t[d=+u]))return this;if(!t.length)break;e[d+1&1]&&(r=e,h=d)}for(;t.data!==n;)if(s=t,!(t=t.next))return this;return(i=t.next)&&delete t.next,s?(i?s.next=i:delete s.next,this):e?(i?e[d]=i:delete e[d],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(r?r[h]=t:this._root=t),this):(this._root=i,this)}function jk(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function Gk(){return this._root}function $k(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function zk(n){var e=[],t,r=this._root,s,i,o;for(r&&e.push(new Er(r,this._x0,this._x1));t=e.pop();)if(!n(r=t.node,i=t.x0,o=t.x1)&&r.length){var a=(i+o)/2;(s=r[1])&&e.push(new Er(s,a,o)),(s=r[0])&&e.push(new Er(s,i,a))}return this}function Hk(n){var e=[],t=[],r;for(this._root&&e.push(new Er(this._root,this._x0,this._x1));r=e.pop();){var s=r.node;if(s.length){var i,o=r.x0,a=r.x1,l=(o+a)/2;(i=s[0])&&e.push(new Er(i,o,l)),(i=s[1])&&e.push(new Er(i,l,a))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.x1);return this}function Wk(n){return n[0]}function qk(n){return arguments.length?(this._x=n,this):this._x}function w1(n,e){var t=new pm(e??Wk,NaN,NaN);return n==null?t:t.addAll(n)}function pm(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function q0(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Jt=w1.prototype=pm.prototype;Jt.copy=function(){var n=new pm(this._x,this._x0,this._x1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=q0(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var s=0;s<2;++s)(r=e.source[s])&&(r.length?t.push({source:r,target:e.target[s]=new Array(2)}):e.target[s]=q0(r));return n};Jt.add=kk;Jt.addAll=Fk;Jt.cover=Lk;Jt.data=Ik;Jt.extent=Ok;Jt.find=Uk;Jt.remove=Vk;Jt.removeAll=jk;Jt.root=Gk;Jt.size=$k;Jt.visit=zk;Jt.visitAfter=Hk;Jt.x=qk;function Xk(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return S1(this.cover(e,t),e,t,n)}function S1(n,e,t,r){if(isNaN(e)||isNaN(t))return n;var s,i=n._root,o={data:r},a=n._x0,l=n._y0,c=n._x1,u=n._y1,d,h,f,p,m,y,x,b;if(!i)return n._root=o,n;for(;i.length;)if((m=e>=(d=(a+c)/2))?a=d:c=d,(y=t>=(h=(l+u)/2))?l=h:u=h,s=i,!(i=i[x=y<<1|m]))return s[x]=o,n;if(f=+n._x.call(null,i.data),p=+n._y.call(null,i.data),e===f&&t===p)return o.next=i,s?s[x]=o:n._root=o,n;do s=s?s[x]=new Array(4):n._root=new Array(4),(m=e>=(d=(a+c)/2))?a=d:c=d,(y=t>=(h=(l+u)/2))?l=h:u=h;while((x=y<<1|m)===(b=(p>=h)<<1|f>=d));return s[b]=i,s[x]=o,n}function Kk(n){var e,t,r=n.length,s,i,o=new Array(r),a=new Array(r),l=1/0,c=1/0,u=-1/0,d=-1/0;for(t=0;t<r;++t)isNaN(s=+this._x.call(null,e=n[t]))||isNaN(i=+this._y.call(null,e))||(o[t]=s,a[t]=i,s<l&&(l=s),s>u&&(u=s),i<c&&(c=i),i>d&&(d=i));if(l>u||c>d)return this;for(this.cover(l,c).cover(u,d),t=0;t<r;++t)S1(this,o[t],a[t],n[t]);return this}function Yk(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,r=this._y0,s=this._x1,i=this._y1;if(isNaN(t))s=(t=Math.floor(n))+1,i=(r=Math.floor(e))+1;else{for(var o=s-t||1,a=this._root,l,c;t>n||n>=s||r>e||e>=i;)switch(c=(e<r)<<1|n<t,l=new Array(4),l[c]=a,a=l,o*=2,c){case 0:s=t+o,i=r+o;break;case 1:t=s-o,i=r+o;break;case 2:s=t+o,r=i-o;break;case 3:t=s-o,r=i-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=t,this._y0=r,this._x1=s,this._y1=i,this}function Qk(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function Zk(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Vt(n,e,t,r,s){this.node=n,this.x0=e,this.y0=t,this.x1=r,this.y1=s}function Jk(n,e,t){var r,s=this._x0,i=this._y0,o,a,l,c,u=this._x1,d=this._y1,h=[],f=this._root,p,m;for(f&&h.push(new Vt(f,s,i,u,d)),t==null?t=1/0:(s=n-t,i=e-t,u=n+t,d=e+t,t*=t);p=h.pop();)if(!(!(f=p.node)||(o=p.x0)>u||(a=p.y0)>d||(l=p.x1)<s||(c=p.y1)<i))if(f.length){var y=(o+l)/2,x=(a+c)/2;h.push(new Vt(f[3],y,x,l,c),new Vt(f[2],o,x,y,c),new Vt(f[1],y,a,l,x),new Vt(f[0],o,a,y,x)),(m=(e>=x)<<1|n>=y)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-m],h[h.length-1-m]=p)}else{var b=n-+this._x.call(null,f.data),v=e-+this._y.call(null,f.data),_=b*b+v*v;if(_<t){var w=Math.sqrt(t=_);s=n-w,i=e-w,u=n+w,d=e+w,r=f.data}}return r}function eF(n){if(isNaN(u=+this._x.call(null,n))||isNaN(d=+this._y.call(null,n)))return this;var e,t=this._root,r,s,i,o=this._x0,a=this._y0,l=this._x1,c=this._y1,u,d,h,f,p,m,y,x;if(!t)return this;if(t.length)for(;;){if((p=u>=(h=(o+l)/2))?o=h:l=h,(m=d>=(f=(a+c)/2))?a=f:c=f,e=t,!(t=t[y=m<<1|p]))return this;if(!t.length)break;(e[y+1&3]||e[y+2&3]||e[y+3&3])&&(r=e,x=y)}for(;t.data!==n;)if(s=t,!(t=t.next))return this;return(i=t.next)&&delete t.next,s?(i?s.next=i:delete s.next,this):e?(i?e[y]=i:delete e[y],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[x]=t:this._root=t),this):(this._root=i,this)}function tF(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function nF(){return this._root}function rF(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function sF(n){var e=[],t,r=this._root,s,i,o,a,l;for(r&&e.push(new Vt(r,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(r=t.node,i=t.x0,o=t.y0,a=t.x1,l=t.y1)&&r.length){var c=(i+a)/2,u=(o+l)/2;(s=r[3])&&e.push(new Vt(s,c,u,a,l)),(s=r[2])&&e.push(new Vt(s,i,u,c,l)),(s=r[1])&&e.push(new Vt(s,c,o,a,u)),(s=r[0])&&e.push(new Vt(s,i,o,c,u))}return this}function iF(n){var e=[],t=[],r;for(this._root&&e.push(new Vt(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var s=r.node;if(s.length){var i,o=r.x0,a=r.y0,l=r.x1,c=r.y1,u=(o+l)/2,d=(a+c)/2;(i=s[0])&&e.push(new Vt(i,o,a,u,d)),(i=s[1])&&e.push(new Vt(i,u,a,l,d)),(i=s[2])&&e.push(new Vt(i,o,d,u,c)),(i=s[3])&&e.push(new Vt(i,u,d,l,c))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.x1,r.y1);return this}function oF(n){return n[0]}function aF(n){return arguments.length?(this._x=n,this):this._x}function lF(n){return n[1]}function cF(n){return arguments.length?(this._y=n,this):this._y}function N1(n,e,t){var r=new mm(e??oF,t??lF,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function mm(n,e,t,r,s,i){this._x=n,this._y=e,this._x0=t,this._y0=r,this._x1=s,this._y1=i,this._root=void 0}function X0(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ht=N1.prototype=mm.prototype;Ht.copy=function(){var n=new mm(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=X0(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var s=0;s<4;++s)(r=e.source[s])&&(r.length?t.push({source:r,target:e.target[s]=new Array(4)}):e.target[s]=X0(r));return n};Ht.add=Xk;Ht.addAll=Kk;Ht.cover=Yk;Ht.data=Qk;Ht.extent=Zk;Ht.find=Jk;Ht.remove=eF;Ht.removeAll=tF;Ht.root=nF;Ht.size=rF;Ht.visit=sF;Ht.visitAfter=iF;Ht.x=aF;Ht.y=cF;function uF(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),r=+this._z.call(null,n);return A1(this.cover(e,t,r),e,t,r,n)}function A1(n,e,t,r,s){if(isNaN(e)||isNaN(t)||isNaN(r))return n;var i,o=n._root,a={data:s},l=n._x0,c=n._y0,u=n._z0,d=n._x1,h=n._y1,f=n._z1,p,m,y,x,b,v,_,w,T,N,S;if(!o)return n._root=a,n;for(;o.length;)if((_=e>=(p=(l+d)/2))?l=p:d=p,(w=t>=(m=(c+h)/2))?c=m:h=m,(T=r>=(y=(u+f)/2))?u=y:f=y,i=o,!(o=o[N=T<<2|w<<1|_]))return i[N]=a,n;if(x=+n._x.call(null,o.data),b=+n._y.call(null,o.data),v=+n._z.call(null,o.data),e===x&&t===b&&r===v)return a.next=o,i?i[N]=a:n._root=a,n;do i=i?i[N]=new Array(8):n._root=new Array(8),(_=e>=(p=(l+d)/2))?l=p:d=p,(w=t>=(m=(c+h)/2))?c=m:h=m,(T=r>=(y=(u+f)/2))?u=y:f=y;while((N=T<<2|w<<1|_)===(S=(v>=y)<<2|(b>=m)<<1|x>=p));return i[S]=o,i[N]=a,n}function dF(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),r=new Float64Array(e),s=new Float64Array(e);let i=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0;for(let d=0,h,f,p,m;d<e;++d)isNaN(f=+this._x.call(null,h=n[d]))||isNaN(p=+this._y.call(null,h))||isNaN(m=+this._z.call(null,h))||(t[d]=f,r[d]=p,s[d]=m,f<i&&(i=f),f>l&&(l=f),p<o&&(o=p),p>c&&(c=p),m<a&&(a=m),m>u&&(u=m));if(i>l||o>c||a>u)return this;this.cover(i,o,a).cover(l,c,u);for(let d=0;d<e;++d)A1(this,t[d],r[d],s[d],n[d]);return this}function hF(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,s=this._y0,i=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(n))+1,a=(s=Math.floor(e))+1,l=(i=Math.floor(t))+1;else{for(var c=o-r||1,u=this._root,d,h;r>n||n>=o||s>e||e>=a||i>t||t>=l;)switch(h=(t<i)<<2|(e<s)<<1|n<r,d=new Array(8),d[h]=u,u=d,c*=2,h){case 0:o=r+c,a=s+c,l=i+c;break;case 1:r=o-c,a=s+c,l=i+c;break;case 2:o=r+c,s=a-c,l=i+c;break;case 3:r=o-c,s=a-c,l=i+c;break;case 4:o=r+c,a=s+c,i=l-c;break;case 5:r=o-c,a=s+c,i=l-c;break;case 6:o=r+c,s=a-c,i=l-c;break;case 7:r=o-c,s=a-c,i=l-c;break}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=s,this._z0=i,this._x1=o,this._y1=a,this._z1=l,this}function fF(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function pF(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function $e(n,e,t,r,s,i,o){this.node=n,this.x0=e,this.y0=t,this.z0=r,this.x1=s,this.y1=i,this.z1=o}function mF(n,e,t,r){var s,i=this._x0,o=this._y0,a=this._z0,l,c,u,d,h,f,p=this._x1,m=this._y1,y=this._z1,x=[],b=this._root,v,_;for(b&&x.push(new $e(b,i,o,a,p,m,y)),r==null?r=1/0:(i=n-r,o=e-r,a=t-r,p=n+r,m=e+r,y=t+r,r*=r);v=x.pop();)if(!(!(b=v.node)||(l=v.x0)>p||(c=v.y0)>m||(u=v.z0)>y||(d=v.x1)<i||(h=v.y1)<o||(f=v.z1)<a))if(b.length){var w=(l+d)/2,T=(c+h)/2,N=(u+f)/2;x.push(new $e(b[7],w,T,N,d,h,f),new $e(b[6],l,T,N,w,h,f),new $e(b[5],w,c,N,d,T,f),new $e(b[4],l,c,N,w,T,f),new $e(b[3],w,T,u,d,h,N),new $e(b[2],l,T,u,w,h,N),new $e(b[1],w,c,u,d,T,N),new $e(b[0],l,c,u,w,T,N)),(_=(t>=N)<<2|(e>=T)<<1|n>=w)&&(v=x[x.length-1],x[x.length-1]=x[x.length-1-_],x[x.length-1-_]=v)}else{var S=n-+this._x.call(null,b.data),C=e-+this._y.call(null,b.data),D=t-+this._z.call(null,b.data),F=S*S+C*C+D*D;if(F<r){var j=Math.sqrt(r=F);i=n-j,o=e-j,a=t-j,p=n+j,m=e+j,y=t+j,s=b.data}}return s}const gF=(n,e,t,r,s,i)=>Math.sqrt((n-r)**2+(e-s)**2+(t-i)**2);function xF(n,e,t,r){const s=[],i=n-r,o=e-r,a=t-r,l=n+r,c=e+r,u=t+r;return this.visit((d,h,f,p,m,y,x)=>{if(!d.length)do{const b=d.data;gF(n,e,t,this._x(b),this._y(b),this._z(b))<=r&&s.push(b)}while(d=d.next);return h>l||f>c||p>u||m<i||y<o||x<a}),s}function yF(n){if(isNaN(h=+this._x.call(null,n))||isNaN(f=+this._y.call(null,n))||isNaN(p=+this._z.call(null,n)))return this;var e,t=this._root,r,s,i,o=this._x0,a=this._y0,l=this._z0,c=this._x1,u=this._y1,d=this._z1,h,f,p,m,y,x,b,v,_,w,T;if(!t)return this;if(t.length)for(;;){if((b=h>=(m=(o+c)/2))?o=m:c=m,(v=f>=(y=(a+u)/2))?a=y:u=y,(_=p>=(x=(l+d)/2))?l=x:d=x,e=t,!(t=t[w=_<<2|v<<1|b]))return this;if(!t.length)break;(e[w+1&7]||e[w+2&7]||e[w+3&7]||e[w+4&7]||e[w+5&7]||e[w+6&7]||e[w+7&7])&&(r=e,T=w)}for(;t.data!==n;)if(s=t,!(t=t.next))return this;return(i=t.next)&&delete t.next,s?(i?s.next=i:delete s.next,this):e?(i?e[w]=i:delete e[w],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[T]=t:this._root=t),this):(this._root=i,this)}function bF(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function vF(){return this._root}function _F(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function TF(n){var e=[],t,r=this._root,s,i,o,a,l,c,u;for(r&&e.push(new $e(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(r=t.node,i=t.x0,o=t.y0,a=t.z0,l=t.x1,c=t.y1,u=t.z1)&&r.length){var d=(i+l)/2,h=(o+c)/2,f=(a+u)/2;(s=r[7])&&e.push(new $e(s,d,h,f,l,c,u)),(s=r[6])&&e.push(new $e(s,i,h,f,d,c,u)),(s=r[5])&&e.push(new $e(s,d,o,f,l,h,u)),(s=r[4])&&e.push(new $e(s,i,o,f,d,h,u)),(s=r[3])&&e.push(new $e(s,d,h,a,l,c,f)),(s=r[2])&&e.push(new $e(s,i,h,a,d,c,f)),(s=r[1])&&e.push(new $e(s,d,o,a,l,h,f)),(s=r[0])&&e.push(new $e(s,i,o,a,d,h,f))}return this}function wF(n){var e=[],t=[],r;for(this._root&&e.push(new $e(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();){var s=r.node;if(s.length){var i,o=r.x0,a=r.y0,l=r.z0,c=r.x1,u=r.y1,d=r.z1,h=(o+c)/2,f=(a+u)/2,p=(l+d)/2;(i=s[0])&&e.push(new $e(i,o,a,l,h,f,p)),(i=s[1])&&e.push(new $e(i,h,a,l,c,f,p)),(i=s[2])&&e.push(new $e(i,o,f,l,h,u,p)),(i=s[3])&&e.push(new $e(i,h,f,l,c,u,p)),(i=s[4])&&e.push(new $e(i,o,a,p,h,f,d)),(i=s[5])&&e.push(new $e(i,h,a,p,c,f,d)),(i=s[6])&&e.push(new $e(i,o,f,p,h,u,d)),(i=s[7])&&e.push(new $e(i,h,f,p,c,u,d))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function SF(n){return n[0]}function NF(n){return arguments.length?(this._x=n,this):this._x}function AF(n){return n[1]}function EF(n){return arguments.length?(this._y=n,this):this._y}function CF(n){return n[2]}function RF(n){return arguments.length?(this._z=n,this):this._z}function E1(n,e,t,r){var s=new gm(e??SF,t??AF,r??CF,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?s:s.addAll(n)}function gm(n,e,t,r,s,i,o,a,l){this._x=n,this._y=e,this._z=t,this._x0=r,this._y0=s,this._z0=i,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function K0(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Rt=E1.prototype=gm.prototype;Rt.copy=function(){var n=new gm(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=K0(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var s=0;s<8;++s)(r=e.source[s])&&(r.length?t.push({source:r,target:e.target[s]=new Array(8)}):e.target[s]=K0(r));return n};Rt.add=uF;Rt.addAll=dF;Rt.cover=hF;Rt.data=fF;Rt.extent=pF;Rt.find=mF;Rt.findAllWithinRadius=xF;Rt.remove=yF;Rt.removeAll=bF;Rt.root=vF;Rt.size=_F;Rt.visit=TF;Rt.visitAfter=wF;Rt.x=NF;Rt.y=EF;Rt.z=RF;function Nr(n){return function(){return n}}function gr(n){return(n()-.5)*1e-6}function MF(n){return n.index}function Y0(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function PF(n){var e=MF,t=h,r,s=Nr(30),i,o,a,l,c,u,d=1;n==null&&(n=[]);function h(x){return 1/Math.min(l[x.source.index],l[x.target.index])}function f(x){for(var b=0,v=n.length;b<d;++b)for(var _=0,w,T,N,S=0,C=0,D=0,F,j;_<v;++_)w=n[_],T=w.source,N=w.target,S=N.x+N.vx-T.x-T.vx||gr(u),a>1&&(C=N.y+N.vy-T.y-T.vy||gr(u)),a>2&&(D=N.z+N.vz-T.z-T.vz||gr(u)),F=Math.sqrt(S*S+C*C+D*D),F=(F-i[_])/F*x*r[_],S*=F,C*=F,D*=F,N.vx-=S*(j=c[_]),a>1&&(N.vy-=C*j),a>2&&(N.vz-=D*j),T.vx+=S*(j=1-j),a>1&&(T.vy+=C*j),a>2&&(T.vz+=D*j)}function p(){if(o){var x,b=o.length,v=n.length,_=new Map(o.map((T,N)=>[e(T,N,o),T])),w;for(x=0,l=new Array(b);x<v;++x)w=n[x],w.index=x,typeof w.source!="object"&&(w.source=Y0(_,w.source)),typeof w.target!="object"&&(w.target=Y0(_,w.target)),l[w.source.index]=(l[w.source.index]||0)+1,l[w.target.index]=(l[w.target.index]||0)+1;for(x=0,c=new Array(v);x<v;++x)w=n[x],c[x]=l[w.source.index]/(l[w.source.index]+l[w.target.index]);r=new Array(v),m(),i=new Array(v),y()}}function m(){if(o)for(var x=0,b=n.length;x<b;++x)r[x]=+t(n[x],x,n)}function y(){if(o)for(var x=0,b=n.length;x<b;++x)i[x]=+s(n[x],x,n)}return f.initialize=function(x,...b){o=x,u=b.find(v=>typeof v=="function")||Math.random,a=b.find(v=>[1,2,3].includes(v))||2,p()},f.links=function(x){return arguments.length?(n=x,p(),f):n},f.id=function(x){return arguments.length?(e=x,f):e},f.iterations=function(x){return arguments.length?(d=+x,f):d},f.strength=function(x){return arguments.length?(t=typeof x=="function"?x:Nr(+x),m(),f):t},f.distance=function(x){return arguments.length?(s=typeof x=="function"?x:Nr(+x),y(),f):s},f}const DF=1664525,BF=1013904223,Q0=4294967296;function kF(){let n=1;return()=>(n=(DF*n+BF)%Q0)/Q0}var Z0=3;function fd(n){return n.x}function J0(n){return n.y}function FF(n){return n.z}var LF=10,IF=Math.PI*(3-Math.sqrt(5)),OF=Math.PI*20/(9+Math.sqrt(221));function UF(n,e){e=e||2;var t=Math.min(Z0,Math.max(1,Math.round(e))),r,s=1,i=.001,o=1-Math.pow(i,1/300),a=0,l=.6,c=new Map,u=Jp(f),d=Xa("tick","end"),h=kF();n==null&&(n=[]);function f(){p(),d.call("tick",r),s<i&&(u.stop(),d.call("end",r))}function p(x){var b,v=n.length,_;x===void 0&&(x=1);for(var w=0;w<x;++w)for(s+=(a-s)*o,c.forEach(function(T){T(s)}),b=0;b<v;++b)_=n[b],_.fx==null?_.x+=_.vx*=l:(_.x=_.fx,_.vx=0),t>1&&(_.fy==null?_.y+=_.vy*=l:(_.y=_.fy,_.vy=0)),t>2&&(_.fz==null?_.z+=_.vz*=l:(_.z=_.fz,_.vz=0));return r}function m(){for(var x=0,b=n.length,v;x<b;++x){if(v=n[x],v.index=x,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),v.fz!=null&&(v.z=v.fz),isNaN(v.x)||t>1&&isNaN(v.y)||t>2&&isNaN(v.z)){var _=LF*(t>2?Math.cbrt(.5+x):t>1?Math.sqrt(.5+x):x),w=x*IF,T=x*OF;t===1?v.x=_:t===2?(v.x=_*Math.cos(w),v.y=_*Math.sin(w)):(v.x=_*Math.sin(w)*Math.cos(T),v.y=_*Math.cos(w),v.z=_*Math.sin(w)*Math.sin(T))}(isNaN(v.vx)||t>1&&isNaN(v.vy)||t>2&&isNaN(v.vz))&&(v.vx=0,t>1&&(v.vy=0),t>2&&(v.vz=0))}}function y(x){return x.initialize&&x.initialize(n,h,t),x}return m(),r={tick:p,restart:function(){return u.restart(f),r},stop:function(){return u.stop(),r},numDimensions:function(x){return arguments.length?(t=Math.min(Z0,Math.max(1,Math.round(x))),c.forEach(y),r):t},nodes:function(x){return arguments.length?(n=x,m(),c.forEach(y),r):n},alpha:function(x){return arguments.length?(s=+x,r):s},alphaMin:function(x){return arguments.length?(i=+x,r):i},alphaDecay:function(x){return arguments.length?(o=+x,r):+o},alphaTarget:function(x){return arguments.length?(a=+x,r):a},velocityDecay:function(x){return arguments.length?(l=1-x,r):1-l},randomSource:function(x){return arguments.length?(h=x,c.forEach(y),r):h},force:function(x,b){return arguments.length>1?(b==null?c.delete(x):c.set(x,y(b)),r):c.get(x)},find:function(){var x=Array.prototype.slice.call(arguments),b=x.shift()||0,v=(t>1?x.shift():null)||0,_=(t>2?x.shift():null)||0,w=x.shift()||1/0,T=0,N=n.length,S,C,D,F,j,z;for(w*=w,T=0;T<N;++T)j=n[T],S=b-j.x,C=v-(j.y||0),D=_-(j.z||0),F=S*S+C*C+D*D,F<w&&(z=j,w=F);return z},on:function(x,b){return arguments.length>1?(d.on(x,b),r):d.on(x)}}}function VF(){var n,e,t,r,s,i=Nr(-30),o,a=1,l=1/0,c=.81;function u(p){var m,y=n.length,x=(e===1?w1(n,fd):e===2?N1(n,fd,J0):e===3?E1(n,fd,J0,FF):null).visitAfter(h);for(s=p,m=0;m<y;++m)t=n[m],x.visit(f)}function d(){if(n){var p,m=n.length,y;for(o=new Array(m),p=0;p<m;++p)y=n[p],o[y.index]=+i(y,p,n)}}function h(p){var m=0,y,x,b=0,v,_,w,T,N=p.length;if(N){for(v=_=w=T=0;T<N;++T)(y=p[T])&&(x=Math.abs(y.value))&&(m+=y.value,b+=x,v+=x*(y.x||0),_+=x*(y.y||0),w+=x*(y.z||0));m*=Math.sqrt(4/N),p.x=v/b,e>1&&(p.y=_/b),e>2&&(p.z=w/b)}else{y=p,y.x=y.data.x,e>1&&(y.y=y.data.y),e>2&&(y.z=y.data.z);do m+=o[y.data.index];while(y=y.next)}p.value=m}function f(p,m,y,x,b){if(!p.value)return!0;var v=[y,x,b][e-1],_=p.x-t.x,w=e>1?p.y-t.y:0,T=e>2?p.z-t.z:0,N=v-m,S=_*_+w*w+T*T;if(N*N/c<S)return S<l&&(_===0&&(_=gr(r),S+=_*_),e>1&&w===0&&(w=gr(r),S+=w*w),e>2&&T===0&&(T=gr(r),S+=T*T),S<a&&(S=Math.sqrt(a*S)),t.vx+=_*p.value*s/S,e>1&&(t.vy+=w*p.value*s/S),e>2&&(t.vz+=T*p.value*s/S)),!0;if(p.length||S>=l)return;(p.data!==t||p.next)&&(_===0&&(_=gr(r),S+=_*_),e>1&&w===0&&(w=gr(r),S+=w*w),e>2&&T===0&&(T=gr(r),S+=T*T),S<a&&(S=Math.sqrt(a*S)));do p.data!==t&&(N=o[p.data.index]*s/S,t.vx+=_*N,e>1&&(t.vy+=w*N),e>2&&(t.vz+=T*N));while(p=p.next)}return u.initialize=function(p,...m){n=p,r=m.find(y=>typeof y=="function")||Math.random,e=m.find(y=>[1,2,3].includes(y))||2,d()},u.strength=function(p){return arguments.length?(i=typeof p=="function"?p:Nr(+p),d(),u):i},u.distanceMin=function(p){return arguments.length?(a=p*p,u):Math.sqrt(a)},u.distanceMax=function(p){return arguments.length?(l=p*p,u):Math.sqrt(l)},u.theta=function(p){return arguments.length?(c=p*p,u):Math.sqrt(c)},u}function jF(n,e,t,r){var s,i,o=Nr(.1),a,l;typeof n!="function"&&(n=Nr(+n)),e==null&&(e=0),t==null&&(t=0),r==null&&(r=0);function c(d){for(var h=0,f=s.length;h<f;++h){var p=s[h],m=p.x-e||1e-6,y=(p.y||0)-t||1e-6,x=(p.z||0)-r||1e-6,b=Math.sqrt(m*m+y*y+x*x),v=(l[h]-b)*a[h]*d/b;p.vx+=m*v,i>1&&(p.vy+=y*v),i>2&&(p.vz+=x*v)}}function u(){if(s){var d,h=s.length;for(a=new Array(h),l=new Array(h),d=0;d<h;++d)l[d]=+n(s[d],d,s),a[d]=isNaN(l[d])?0:+o(s[d],d,s)}}return c.initialize=function(d,...h){s=d,i=h.find(f=>[1,2,3].includes(f))||2,u()},c.strength=function(d){return arguments.length?(o=typeof d=="function"?d:Nr(+d),u(),c):o},c.radius=function(d){return arguments.length?(n=typeof d=="function"?d:Nr(+d),u(),c):n},c.x=function(d){return arguments.length?(e=+d,c):e},c.y=function(d){return arguments.length?(t=+d,c):t},c.z=function(d){return arguments.length?(r=+d,c):r},c}function GF(n){zF(n);const e=$F(n);return n.on=e.on,n.off=e.off,n.fire=e.fire,n}function $F(n){let e=Object.create(null);return{on:function(t,r,s){if(typeof r!="function")throw new Error("callback is expected to be a function");let i=e[t];return i||(i=e[t]=[]),i.push({callback:r,ctx:s}),n},off:function(t,r){if(typeof t>"u")return e=Object.create(null),n;if(e[t])if(typeof r!="function")delete e[t];else{const o=e[t];for(let a=0;a<o.length;++a)o[a].callback===r&&o.splice(a,1)}return n},fire:function(t){const r=e[t];if(!r)return n;let s;arguments.length>1&&(s=Array.prototype.slice.call(arguments,1));for(let i=0;i<r.length;++i){const o=r[i];o.callback.apply(o.ctx,s)}return n}}}function zF(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");const e=["on","fire","off"];for(let t=0;t<e.length;++t)if(n.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}function HF(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,r={},s=0,i=n.multigraph?_:v,o=[],a=R,l=R,c=R,u=R,d={version:20,addNode:m,addLink:b,removeLink:S,removeNode:x,getNode:y,getNodeCount:w,getLinkCount:T,getEdgeCount:T,getLinksCount:T,getNodesCount:w,getLinks:N,forEachNode:W,forEachLinkedNode:A,forEachLink:z,beginUpdate:c,endUpdate:u,clear:j,hasLink:D,hasNode:y,getLink:D,getLinkById:F};return GF(d),h(),d;function h(){var L=d.on;d.on=G;function G(){return d.beginUpdate=c=I,d.endUpdate=u=P,a=f,l=p,d.on=L,L.apply(d,arguments)}}function f(L,G){o.push({link:L,changeType:G})}function p(L,G){o.push({node:L,changeType:G})}function m(L,G){if(L===void 0)throw new Error("Invalid node identifier");c();var Z=y(L);return Z?(Z.data=G,l(Z,"update")):(Z=new WF(L,G),l(Z,"add")),e.set(L,Z),u(),Z}function y(L){return e.get(L)}function x(L){var G=y(L);if(!G)return!1;c();var Z=G.links;return Z&&(Z.forEach(C),G.links=null),e.delete(L),l(G,"remove"),u(),!0}function b(L,G,Z){c();var ee=y(L)||m(L),U=y(G)||m(G),Q=i(L,G,Z),te=t.has(Q.id);return t.set(Q.id,Q),ex(ee,Q),L!==G&&ex(U,Q),a(Q,te?"update":"add"),u(),Q}function v(L,G,Z){var ee=bl(L,G),U=t.get(ee);return U?(U.data=Z,U):new tx(L,G,Z,ee)}function _(L,G,Z){var ee=bl(L,G),U=r.hasOwnProperty(ee);if(U||D(L,G)){U||(r[ee]=0);var Q="@"+ ++r[ee];ee=bl(L+Q,G+Q)}return new tx(L,G,Z,ee)}function w(){return e.size}function T(){return t.size}function N(L){var G=y(L);return G?G.links:null}function S(L,G){return G!==void 0&&(L=D(L,G)),C(L)}function C(L){if(!L||!t.get(L.id))return!1;c(),t.delete(L.id);var G=y(L.fromId),Z=y(L.toId);return G&&G.links.delete(L),Z&&Z.links.delete(L),a(L,"remove"),u(),!0}function D(L,G){if(!(L===void 0||G===void 0))return t.get(bl(L,G))}function F(L){if(L!==void 0)return t.get(L)}function j(){c(),W(function(L){x(L.id)}),u()}function z(L){if(typeof L=="function")for(var G=t.values(),Z=G.next();!Z.done;){if(L(Z.value))return!0;Z=G.next()}}function A(L,G,Z){var ee=y(L);if(ee&&ee.links&&typeof G=="function")return Z?k(ee.links,L,G):O(ee.links,L,G)}function O(L,G,Z){for(var ee,U=L.values(),Q=U.next();!Q.done;){var te=Q.value,le=te.fromId===G?te.toId:te.fromId;if(ee=Z(e.get(le),te),ee)return!0;Q=U.next()}}function k(L,G,Z){for(var ee,U=L.values(),Q=U.next();!Q.done;){var te=Q.value;if(te.fromId===G&&(ee=Z(e.get(te.toId),te),ee))return!0;Q=U.next()}}function R(){}function I(){s+=1}function P(){s-=1,s===0&&o.length>0&&(d.fire("changed",o),o.length=0)}function W(L){if(typeof L!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+L);for(var G=e.values(),Z=G.next();!Z.done;){if(L(Z.value))return!0;Z=G.next()}}}function WF(n,e){this.id=n,this.links=null,this.data=e}function ex(n,e){n.links?n.links.add(e):n.links=new Set([e])}function tx(n,e,t,r){this.fromId=n,this.toId=e,this.data=t,this.id=r}function bl(n,e){return n.toString()+" "+e.toString()}var vl={exports:{}},di={exports:{}},pd,nx;function C1(){return nx||(nx=1,pd=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),pd}var md,rx;function uo(){if(rx)return md;rx=1;const n=C1();return md=function(t){return r;function r(s,i){let o=i&&i.indent||0,a=i&&i.join!==void 0?i.join:`
`,l=Array(o+1).join(" "),c=[];for(let u=0;u<t;++u){let d=n(u),h=u===0?"":l;c.push(h+s.replace(/{var}/g,d))}return c.join(a)}},md}var sx;function qF(){if(sx)return di.exports;sx=1;const n=uo();di.exports=e,di.exports.generateCreateBodyFunctionBody=t,di.exports.getVectorCode=s,di.exports.getBodyCode=r;function e(i,o){let a=t(i,o),{Body:l}=new Function(a)();return l}function t(i,o){return`
${s(i,o)}
${r(i)}
return {Body: Body, Vector: Vector};
`}function r(i){let o=n(i),a=o("{var}",{join:", "});return`
function Body(${a}) {
  this.isPinned = false;
  this.pos = new Vector(${a});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${a}) {
  ${o("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function s(i,o){let a=n(i),l="";return o&&(l=`${a(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${a("{var}",{join:", "})}) {
  ${l}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${a('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${a("this.{var} = v.{var};",{indent:4})}
    } else {
      ${a('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${a("this.{var} = ",{join:""})}0;
  };`}return di.exports}var dr={exports:{}},ix;function XF(){if(ix)return dr.exports;ix=1;const n=uo(),e=C1();dr.exports=t,dr.exports.generateQuadTreeFunctionBody=r,dr.exports.getInsertStackCode=l,dr.exports.getQuadNodeCode=a,dr.exports.isSamePosition=s,dr.exports.getChildBodyCode=o,dr.exports.setChildBodyCode=i;function t(c){let u=r(c);return new Function(u)()}function r(c){let u=n(c),d=Math.pow(2,c);return`
${l()}
${a(c)}
${s(c)}
${o(c)}
${i(c)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${m("      node.")}
      node.body = null;
      node.mass = ${u("node.mass_{var} = ",{join:""})}0;
      ${u("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${u("var d{var};",{indent:4})}
    var r; 
    ${u("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${u("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${u("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${u("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${u("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${u("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${u("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${u("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${p()}
        }
      }
    }

    ${u("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${u("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${u("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${u("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${u("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${u("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${u("root.min_{var} = {var}min;",{indent:4})}
    ${u("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${u("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${u("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${u("var min_{var} = node.min_{var};",{indent:8})}
        ${u("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${f(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${u("child.min_{var} = min_{var};",{indent:10})}
          ${u("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${u("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${u("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function f(y){let x=[],b=Array(y+1).join(" ");for(let v=0;v<c;++v)x.push(b+`if (${e(v)} > max_${e(v)}) {`),x.push(b+`  quadIdx = quadIdx + ${Math.pow(2,v)};`),x.push(b+`  min_${e(v)} = max_${e(v)};`),x.push(b+`  max_${e(v)} = node.max_${e(v)};`),x.push(b+"}");return x.join(`
`)}function p(){let y=Array(11).join(" "),x=[];for(let b=0;b<d;++b)x.push(y+`if (node.quad${b}) {`),x.push(y+`  queue[pushIdx] = node.quad${b};`),x.push(y+"  queueLength += 1;"),x.push(y+"  pushIdx += 1;"),x.push(y+"}");return x.join(`
`)}function m(y){let x=[];for(let b=0;b<d;++b)x.push(`${y}quad${b} = null;`);return x.join(`
`)}}function s(c){let u=n(c);return`
  function isSamePosition(point1, point2) {
    ${u("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${u("d{var} < 1e-8",{join:" && "})};
  }  
`}function i(c){var u=Math.pow(2,c);return`
function setChild(node, idx, child) {
  ${d()}
}`;function d(){let h=[];for(let f=0;f<u;++f){let p=f===0?"  ":"  else ";h.push(`${p}if (idx === ${f}) node.quad${f} = child;`)}return h.join(`
`)}}function o(c){return`function getChild(node, idx) {
${u()}
  return null;
}`;function u(){let d=[],h=Math.pow(2,c);for(let f=0;f<h;++f)d.push(`  if (idx === ${f}) return node.quad${f};`);return d.join(`
`)}}function a(c){let u=n(c),d=Math.pow(2,c);var h=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${f("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${u("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${u("this.min_{var} = 0;",{indent:2})}
  ${u("this.max_{var} = 0;",{indent:2})}
}
`;return h;function f(p){let m=[];for(let y=0;y<d;++y)m.push(`${p}quad${y} = null;`);return m.join(`
`)}}function l(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return dr.exports}var _l={exports:{}},ox;function KF(){if(ox)return _l.exports;ox=1,_l.exports=e,_l.exports.generateFunctionBody=t;const n=uo();function e(r){let s=t(r);return new Function("bodies","settings","random",s)}function t(r){let s=n(r);return`
  var boundingBox = {
    ${s("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${s("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${s("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${s("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${s("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${s("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${s("var max_{var} = -Infinity;",{indent:4})}
    ${s("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${s("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${s("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${s("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${s("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${s("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return _l.exports}var Tl={exports:{}},ax;function YF(){if(ax)return Tl.exports;ax=1;const n=uo();Tl.exports=e,Tl.exports.generateCreateDragForceFunctionBody=t;function e(r){let s=t(r);return new Function("options",s)}function t(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${n(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return Tl.exports}var wl={exports:{}},lx;function QF(){if(lx)return wl.exports;lx=1;const n=uo();wl.exports=e,wl.exports.generateCreateSpringForceFunctionBody=t;function e(r){let s=t(r);return new Function("options","random",s)}function t(r){let s=n(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${s("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${s("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${s("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${s("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${s("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${s("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return wl.exports}var Sl={exports:{}},cx;function ZF(){if(cx)return Sl.exports;cx=1;const n=uo();Sl.exports=e,Sl.exports.generateIntegratorFunctionBody=t;function e(r){let s=t(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",s)}function t(r){let s=n(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${s("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${s("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${s("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${s("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${s("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${s("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${s("body.pos.{var} += d{var};",{indent:4})}

    ${s("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${s("t{var} * t{var}",{join:" + "})})/length;
`}return Sl.exports}var gd,ux;function JF(){if(ux)return gd;ux=1,gd=n;function n(e,t,r,s){this.from=e,this.to=t,this.length=r,this.coefficient=s}return gd}var xd,dx;function eL(){if(dx)return xd;dx=1,xd=n;function n(e,t){var r;if(e||(e={}),t){for(r in t)if(t.hasOwnProperty(r)){var s=e.hasOwnProperty(r),i=typeof t[r],o=!s||typeof e[r]!==i;o?e[r]=t[r]:i==="object"&&(e[r]=n(e[r],t[r]))}}return e}return xd}var yd,hx;function R1(){if(hx)return yd;hx=1;function n(r){t(r);const s=e(r);return r.on=s.on,r.off=s.off,r.fire=s.fire,r}function e(r){let s=Object.create(null);return{on:function(i,o,a){if(typeof o!="function")throw new Error("callback is expected to be a function");let l=s[i];return l||(l=s[i]=[]),l.push({callback:o,ctx:a}),r},off:function(i,o){if(typeof i>"u")return s=Object.create(null),r;if(s[i])if(typeof o!="function")delete s[i];else{const a=s[i];for(let l=0;l<a.length;++l)a[l].callback===o&&a.splice(l,1)}return r},fire:function(i){const o=s[i];if(!o)return r;let a;arguments.length>1&&(a=Array.prototype.slice.call(arguments,1));for(let l=0;l<o.length;++l){const c=o[l];c.callback.apply(c.ctx,a)}return r}}}function t(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");const s=["on","fire","off"];for(let i=0;i<s.length;++i)if(r.hasOwnProperty(s[i]))throw new Error("Subject cannot be eventified, since it already has property '"+s[i]+"'")}return yd=n,yd}var Ro={exports:{}},fx;function tL(){if(fx)return Ro.exports;fx=1,Ro.exports=n,Ro.exports.random=n,Ro.exports.randomIterator=a;function n(l){var c=typeof l=="number"?l:+new Date;return new e(c)}function e(l){this.seed=l}e.prototype.next=o,e.prototype.nextDouble=i,e.prototype.uniform=i,e.prototype.gaussian=t,e.prototype.random=i;function t(){var l,c,u;do c=this.nextDouble()*2-1,u=this.nextDouble()*2-1,l=c*c+u*u;while(l>=1||l===0);return c*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=r;function r(){var l=1.5,c=Math.pow(s(1+l)*Math.sin(Math.PI*l/2)/(s((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*c/Math.pow(Math.abs(this.gaussian()),1/l)}function s(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function i(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function o(l){return Math.floor(this.nextDouble()*l)}function a(l,c){var u=c||n();if(typeof u.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:h,shuffle:d};function d(){var f,p,m;for(f=l.length-1;f>0;--f)p=u.next(f+1),m=l[p],l[p]=l[f],l[f]=m;return l}function h(f){var p,m,y;for(p=l.length-1;p>0;--p)m=u.next(p+1),y=l[m],l[m]=l[p],l[p]=y,f(y);l.length&&f(l[0])}}return Ro.exports}var bd,px;function mx(){if(px)return bd;px=1,bd=a;var n=qF(),e=XF(),t=KF(),r=YF(),s=QF(),i=ZF(),o={};function a(u){var d=JF(),h=eL(),f=R1();if(u){if(u.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(u.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}u=h(u,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var p=o[u.dimensions];if(!p){var m=u.dimensions;p={Body:n(m,u.debug),createQuadTree:e(m),createBounds:t(m),createDragForce:r(m),createSpringForce:s(m),integrate:i(m)},o[m]=p}var y=p.Body,x=p.createQuadTree,b=p.createBounds,v=p.createDragForce,_=p.createSpringForce,w=p.integrate,T=U=>new y(U),N=tL().random(42),S=[],C=[],D=x(u,N),F=b(S,u,N),j=_(u,N),z=v(u),A=0,O=[],k=new Map,R=0;W("nbody",Z),W("spring",ee);var I={bodies:S,quadTree:D,springs:C,settings:u,addForce:W,removeForce:L,getForces:G,step:function(){for(var U=0;U<O.length;++U)O[U](R);var Q=w(S,u.timeStep,u.adaptiveTimeStepWeight);return R+=1,Q},addBody:function(U){if(!U)throw new Error("Body is required");return S.push(U),U},addBodyAt:function(U){if(!U)throw new Error("Body position is required");var Q=T(U);return S.push(Q),Q},removeBody:function(U){if(U){var Q=S.indexOf(U);if(!(Q<0))return S.splice(Q,1),S.length===0&&F.reset(),!0}},addSpring:function(U,Q,te,le){if(!U||!Q)throw new Error("Cannot add null spring to force simulator");typeof te!="number"&&(te=-1);var ye=new d(U,Q,te,le>=0?le:-1);return C.push(ye),ye},getTotalMovement:function(){return A},removeSpring:function(U){if(U){var Q=C.indexOf(U);if(Q>-1)return C.splice(Q,1),!0}},getBestNewBodyPosition:function(U){return F.getBestNewPosition(U)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(U){return U!==void 0?(u.gravity=U,D.options({gravity:U}),this):u.gravity},theta:function(U){return U!==void 0?(u.theta=U,D.options({theta:U}),this):u.theta},random:N};return l(u,I),f(I),I;function P(){return F.update(),F.box}function W(U,Q){if(k.has(U))throw new Error("Force "+U+" is already added");k.set(U,Q),O.push(Q)}function L(U){var Q=O.indexOf(k.get(U));Q<0||(O.splice(Q,1),k.delete(U))}function G(){return k}function Z(){if(S.length!==0){D.insertBodies(S);for(var U=S.length;U--;){var Q=S[U];Q.isPinned||(Q.reset(),D.updateBodyForce(Q),z.update(Q))}}}function ee(){for(var U=C.length;U--;)j.update(C[U])}}function l(u,d){for(var h in u)c(u,d,h)}function c(u,d,h){if(u.hasOwnProperty(h)&&typeof d[h]!="function"){var f=Number.isFinite(u[h]);f?d[h]=function(p){if(p!==void 0){if(!Number.isFinite(p))throw new Error("Value of "+h+" should be a valid number.");return u[h]=p,d}return u[h]}:d[h]=function(p){return p!==void 0?(u[h]=p,d):u[h]}}}return bd}var gx;function nL(){if(gx)return vl.exports;gx=1,vl.exports=e,vl.exports.simulator=mx();var n=R1();function e(r,s){if(!r)throw new Error("Graph structure cannot be undefined");var i=s&&s.createSimulator||mx(),o=i(s);if(Array.isArray(s))throw new Error("Physics settings is expected to be an object");var a=r.version>19?k:O;s&&typeof s.nodeMass=="function"&&(a=s.nodeMass);var l=new Map,c={},u=0,d=o.settings.springTransform||t;T(),v();var h=!1,f={step:function(){if(u===0)return p(!0),!0;var R=o.step();f.lastMove=R,f.fire("step");var I=R/u,P=I<=.01;return p(P),P},getNodePosition:function(R){return A(R).pos},setNodePosition:function(R){var I=A(R);I.setPosition.apply(I,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(R){var I=c[R];if(I)return{from:I.from.pos,to:I.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:m,pinNode:function(R,I){var P=A(R.id);P.isPinned=!!I},isNodePinned:function(R){return A(R.id).isPinned},dispose:function(){r.off("changed",w),f.fire("disposed")},getBody:b,getSpring:x,getForceVectorLength:y,simulator:o,graph:r,lastMove:0};return n(f),f;function p(R){h!==R&&(h=R,_(R))}function m(R){l.forEach(R)}function y(){var R=0,I=0;return m(function(P){R+=Math.abs(P.force.x),I+=Math.abs(P.force.y)}),Math.sqrt(R*R+I*I)}function x(R,I){var P;if(I===void 0)typeof R!="object"?P=R:P=R.id;else{var W=r.hasLink(R,I);if(!W)return;P=W.id}return c[P]}function b(R){return l.get(R)}function v(){r.on("changed",w)}function _(R){f.fire("stable",R)}function w(R){for(var I=0;I<R.length;++I){var P=R[I];P.changeType==="add"?(P.node&&N(P.node.id),P.link&&C(P.link)):P.changeType==="remove"&&(P.node&&S(P.node),P.link&&D(P.link))}u=r.getNodesCount()}function T(){u=0,r.forEachNode(function(R){N(R.id),u+=1}),r.forEachLink(C)}function N(R){var I=l.get(R);if(!I){var P=r.getNode(R);if(!P)throw new Error("initBody() was called with unknown node id");var W=P.position;if(!W){var L=F(P);W=o.getBestNewBodyPosition(L)}I=o.addBodyAt(W),I.id=R,l.set(R,I),j(R),z(P)&&(I.isPinned=!0)}}function S(R){var I=R.id,P=l.get(I);P&&(l.delete(I),o.removeBody(P))}function C(R){j(R.fromId),j(R.toId);var I=l.get(R.fromId),P=l.get(R.toId),W=o.addSpring(I,P,R.length);d(R,W),c[R.id]=W}function D(R){var I=c[R.id];if(I){var P=r.getNode(R.fromId),W=r.getNode(R.toId);P&&j(P.id),W&&j(W.id),delete c[R.id],o.removeSpring(I)}}function F(R){var I=[];if(!R.links)return I;for(var P=Math.min(R.links.length,2),W=0;W<P;++W){var L=R.links[W],G=L.fromId!==R.id?l.get(L.fromId):l.get(L.toId);G&&G.pos&&I.push(G)}return I}function j(R){var I=l.get(R);if(I.mass=a(R),Number.isNaN(I.mass))throw new Error("Node mass should be a number")}function z(R){return R&&(R.isPinned||R.data&&R.data.isPinned)}function A(R){var I=l.get(R);return I||(N(R),I=l.get(R)),I}function O(R){var I=r.getLinks(R);return I?1+I.length/3:1}function k(R){var I=r.getLinks(R);return I?1+I.size/3:1}}function t(){}return vl.exports}var rL=nL();const sL=Hv(rL);function Pf(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var iL=typeof global=="object"&&global&&global.Object===Object&&global,oL=typeof self=="object"&&self&&self.Object===Object&&self,M1=iL||oL||Function("return this")(),vd=function(){return M1.Date.now()},aL=/\s/;function lL(n){for(var e=n.length;e--&&aL.test(n.charAt(e)););return e}var cL=/^\s+/;function uL(n){return n&&n.slice(0,lL(n)+1).replace(cL,"")}var zc=M1.Symbol,P1=Object.prototype,dL=P1.hasOwnProperty,hL=P1.toString,Mo=zc?zc.toStringTag:void 0;function fL(n){var e=dL.call(n,Mo),t=n[Mo];try{n[Mo]=void 0;var r=!0}catch{}var s=hL.call(n);return r&&(e?n[Mo]=t:delete n[Mo]),s}var pL=Object.prototype,mL=pL.toString;function gL(n){return mL.call(n)}var xL="[object Null]",yL="[object Undefined]",xx=zc?zc.toStringTag:void 0;function bL(n){return n==null?n===void 0?yL:xL:xx&&xx in Object(n)?fL(n):gL(n)}function vL(n){return n!=null&&typeof n=="object"}var _L="[object Symbol]";function TL(n){return typeof n=="symbol"||vL(n)&&bL(n)==_L}var yx=NaN,wL=/^[-+]0x[0-9a-f]+$/i,SL=/^0b[01]+$/i,NL=/^0o[0-7]+$/i,AL=parseInt;function bx(n){if(typeof n=="number")return n;if(TL(n))return yx;if(Pf(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Pf(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=uL(n);var t=SL.test(n);return t||NL.test(n)?AL(n.slice(2),t?2:8):wL.test(n)?yx:+n}var EL="Expected a function",CL=Math.max,RL=Math.min;function ML(n,e,t){var r,s,i,o,a,l,c=0,u=!1,d=!1,h=!0;if(typeof n!="function")throw new TypeError(EL);e=bx(e)||0,Pf(t)&&(u=!!t.leading,d="maxWait"in t,i=d?CL(bx(t.maxWait)||0,e):i,h="trailing"in t?!!t.trailing:h);function f(T){var N=r,S=s;return r=s=void 0,c=T,o=n.apply(S,N),o}function p(T){return c=T,a=setTimeout(x,e),u?f(T):o}function m(T){var N=T-l,S=T-c,C=e-N;return d?RL(C,i-S):C}function y(T){var N=T-l,S=T-c;return l===void 0||N>=e||N<0||d&&S>=i}function x(){var T=vd();if(y(T))return b(T);a=setTimeout(x,m(T))}function b(T){return a=void 0,h&&r?f(T):(r=s=void 0,o)}function v(){a!==void 0&&clearTimeout(a),c=0,r=l=s=a=void 0}function _(){return a===void 0?o:b(vd())}function w(){var T=vd(),N=y(T);if(r=arguments,s=this,l=T,N){if(a===void 0)return p(l);if(d)return clearTimeout(a),a=setTimeout(x,e),f(l)}return a===void 0&&(a=setTimeout(x,e)),o}return w.cancel=v,w.flush=_,w}function vx(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function PL(n){if(Array.isArray(n))return n}function DL(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function BL(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function kL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function FL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LL(n,e){return PL(n)||kL(n,e)||IL(n,e)||FL()}function IL(n,e){if(n){if(typeof n=="string")return vx(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?vx(n,e):void 0}}var OL=BL(function n(e,t){var r=t.default,s=r===void 0?null:r,i=t.triggerUpdate,o=i===void 0?!0:i,a=t.onChange,l=a===void 0?function(c,u){}:a;DL(this,n),this.name=e,this.defaultVal=s,this.triggerUpdate=o,this.onChange=l});function Su(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,r=n.props,s=r===void 0?{}:r,i=n.methods,o=i===void 0?{}:i,a=n.aliases,l=a===void 0?{}:a,c=n.init,u=c===void 0?function(){}:c,d=n.update,h=d===void 0?function(){}:d,f=Object.keys(s).map(function(p){return new OL(p,s[p])});return function p(){for(var m=arguments.length,y=new Array(m),x=0;x<m;x++)y[x]=arguments[x];var b=!!(this instanceof p&&this.constructor),v=b?y.shift():void 0,_=y[0],w=_===void 0?{}:_,T=Object.assign({},t instanceof Function?t(w):t,{initialised:!1}),N={};function S(F){return C(F,w),D(),S}var C=function(j,z){u.call(S,j,T,z),T.initialised=!0},D=ML(function(){T.initialised&&(h.call(S,T,N),N={})},1);return f.forEach(function(F){S[F.name]=j(F);function j(z){var A=z.name,O=z.triggerUpdate,k=O===void 0?!1:O,R=z.onChange,I=R===void 0?function(L,G){}:R,P=z.defaultVal,W=P===void 0?null:P;return function(L){var G=T[A];if(!arguments.length)return G;var Z=L===void 0?W:L;return T[A]=Z,I.call(S,Z,T,G),!N.hasOwnProperty(A)&&(N[A]=G),k&&D(),S}}}),Object.keys(o).forEach(function(F){S[F]=function(){for(var j,z=arguments.length,A=new Array(z),O=0;O<z;O++)A[O]=arguments[O];return(j=o[F]).call.apply(j,[S,T].concat(A))}}),Object.entries(l).forEach(function(F){var j=LL(F,2),z=j[0],A=j[1];return S[z]=S[A]}),S.resetProps=function(){return f.forEach(function(F){S[F.name](F.defaultVal)}),S},S.resetProps(),T._rerender=D,b&&v&&S(v),S}}var Ee=(function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}});class _x extends Map{constructor(e,t=jL){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[r,s]of e)this.set(r,s)}get(e){return super.get(Tx(this,e))}has(e){return super.has(Tx(this,e))}set(e,t){return super.set(UL(this,e),t)}delete(e){return super.delete(VL(this,e))}}function Tx({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):t}function UL({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):(n.set(r,t),t)}function VL({_intern:n,_key:e},t){const r=e(t);return n.has(r)&&(t=n.get(r),n.delete(r)),t}function jL(n){return n!==null&&typeof n=="object"?n.valueOf():n}function GL(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let s of n)(s=e(s,++r,n))!=null&&(t<s||t===void 0&&s>=s)&&(t=s)}return t}function $L(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let s of n)(s=e(s,++r,n))!=null&&(t>s||t===void 0&&s>=s)&&(t=s)}return t}function Df(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function zL(n){if(Array.isArray(n))return n}function HL(n){if(Array.isArray(n))return Df(n)}function D1(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function WL(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function qL(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Pt(n,e){return n.get(D1(n,e))}function hi(n,e,t){WL(n,e),e.set(n,t)}function Nl(n,e,t){return n.set(D1(n,e),t),t}function XL(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,rI(r.key),r)}}function KL(n,e,t){return e&&XL(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function YL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function QL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function ZL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eI(n,e){return zL(n)||QL(n,e)||B1(n,e)||ZL()}function tI(n){return HL(n)||YL(n)||B1(n)||JL()}function nI(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function rI(n){var e=nI(n,"string");return typeof e=="symbol"?e:e+""}function B1(n,e){if(n){if(typeof n=="string")return Df(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Df(n,e):void 0}}var fi=new WeakMap,Po=new WeakMap,pi=new WeakMap,_d=new WeakMap,Td=new WeakMap,wd=new WeakMap,sI=(function(){function n(){qL(this,n),hi(this,fi,new Map),hi(this,Po,new Map),hi(this,pi,function(e){return e}),hi(this,_d,function(){return{}}),hi(this,Td,function(){}),hi(this,wd,function(){})}return KL(n,[{key:"getObj",value:function(t){return Pt(fi,this).get(Pt(pi,this).call(this,t))}},{key:"getData",value:function(t){return Pt(Po,this).get(t)}},{key:"entries",value:function(){return tI(Pt(Po,this).entries()).map(function(t){var r=eI(t,2),s=r[0],i=r[1];return[i,s]})}},{key:"id",value:function(t){return Nl(pi,this,Ee(t)),this}},{key:"onCreateObj",value:function(t){return Nl(_d,this,t),this}},{key:"onUpdateObj",value:function(t){return Nl(Td,this,t),this}},{key:"onRemoveObj",value:function(t){return Nl(wd,this,t),this}},{key:"digest",value:function(t){var r=this;t.filter(function(i){return!Pt(fi,r).has(Pt(pi,r).call(r,i))}).forEach(function(i){var o=Pt(_d,r).call(r,i);Pt(fi,r).set(Pt(pi,r).call(r,i),o),Pt(Po,r).set(o,i)});var s=new Map(t.map(function(i){return[Pt(pi,r).call(r,i),i]}));return Pt(fi,this).forEach(function(i,o){s.has(o)?Pt(Td,r).call(r,i,s.get(o)):(Pt(wd,r).call(r,i,o),Pt(fi,r).delete(o),Pt(Po,r).delete(i))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])})();function iI(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const wx=Symbol("implicit");function xm(){var n=new _x,e=[],t=[],r=wx;function s(i){let o=n.get(i);if(o===void 0){if(r!==wx)return r;n.set(i,o=e.push(i)-1)}return t[o%t.length]}return s.domain=function(i){if(!arguments.length)return e.slice();e=[],n=new _x;for(const o of i)n.has(o)||n.set(o,e.push(o)-1);return s},s.range=function(i){return arguments.length?(t=Array.from(i),s):t.slice()},s.unknown=function(i){return arguments.length?(r=i,s):r},s.copy=function(){return xm(e,t).unknown(r)},iI.apply(s,arguments),s}function k1(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}const oI=k1("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),aI=k1("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Hc(n){"@babel/helpers - typeof";return Hc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hc(n)}var lI=/^\s+/,cI=/\s+$/;function de(n,e){if(n=n||"",e=e||{},n instanceof de)return n;if(!(this instanceof de))return new de(n,e);var t=uI(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}de.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,r,s,i,o,a;return t=e.r/255,r=e.g/255,s=e.b/255,t<=.03928?i=t/12.92:i=Math.pow((t+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),s<=.03928?a=s/12.92:a=Math.pow((s+.055)/1.055,2.4),.2126*i+.7152*o+.0722*a},setAlpha:function(e){return this._a=F1(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=Nx(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=Nx(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+s+"%)":"hsva("+t+", "+r+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var e=Sx(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=Sx(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+s+"%)":"hsla("+t+", "+r+"%, "+s+"%, "+this._roundA+")"},toHex:function(e){return Ax(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return pI(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ye(this._r,255)*100)+"%",g:Math.round(Ye(this._g,255)*100)+"%",b:Math.round(Ye(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ye(this._r,255)*100)+"%, "+Math.round(Ye(this._g,255)*100)+"%, "+Math.round(Ye(this._b,255)*100)+"%)":"rgba("+Math.round(Ye(this._r,255)*100)+"%, "+Math.round(Ye(this._g,255)*100)+"%, "+Math.round(Ye(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:AI[Ax(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+Ex(this._r,this._g,this._b,this._a),r=t,s=this._gradientType?"GradientType = 1, ":"";if(e){var i=de(e);r="#"+Ex(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,s=this._a<1&&this._a>=0,i=!t&&s&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return i?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return de(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(yI,arguments)},brighten:function(){return this._applyModification(bI,arguments)},darken:function(){return this._applyModification(vI,arguments)},desaturate:function(){return this._applyModification(mI,arguments)},saturate:function(){return this._applyModification(gI,arguments)},greyscale:function(){return this._applyModification(xI,arguments)},spin:function(){return this._applyModification(_I,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(SI,arguments)},complement:function(){return this._applyCombination(TI,arguments)},monochromatic:function(){return this._applyCombination(NI,arguments)},splitcomplement:function(){return this._applyCombination(wI,arguments)},triad:function(){return this._applyCombination(Cx,[3])},tetrad:function(){return this._applyCombination(Cx,[4])}};de.fromRatio=function(n,e){if(Hc(n)=="object"){var t={};for(var r in n)n.hasOwnProperty(r)&&(r==="a"?t[r]=n[r]:t[r]=Zo(n[r]));n=t}return de(n,e)};function uI(n){var e={r:0,g:0,b:0},t=1,r=null,s=null,i=null,o=!1,a=!1;return typeof n=="string"&&(n=MI(n)),Hc(n)=="object"&&(hr(n.r)&&hr(n.g)&&hr(n.b)?(e=dI(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):hr(n.h)&&hr(n.s)&&hr(n.v)?(r=Zo(n.s),s=Zo(n.v),e=fI(n.h,r,s),o=!0,a="hsv"):hr(n.h)&&hr(n.s)&&hr(n.l)&&(r=Zo(n.s),i=Zo(n.l),e=hI(n.h,r,i),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=F1(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function dI(n,e,t){return{r:Ye(n,255)*255,g:Ye(e,255)*255,b:Ye(t,255)*255}}function Sx(n,e,t){n=Ye(n,255),e=Ye(e,255),t=Ye(t,255);var r=Math.max(n,e,t),s=Math.min(n,e,t),i,o,a=(r+s)/2;if(r==s)i=o=0;else{var l=r-s;switch(o=a>.5?l/(2-r-s):l/(r+s),r){case n:i=(e-t)/l+(e<t?6:0);break;case e:i=(t-n)/l+2;break;case t:i=(n-e)/l+4;break}i/=6}return{h:i,s:o,l:a}}function hI(n,e,t){var r,s,i;n=Ye(n,360),e=Ye(e,100),t=Ye(t,100);function o(c,u,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?c+(u-c)*6*d:d<1/2?u:d<2/3?c+(u-c)*(2/3-d)*6:c}if(e===0)r=s=i=t;else{var a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;r=o(l,a,n+1/3),s=o(l,a,n),i=o(l,a,n-1/3)}return{r:r*255,g:s*255,b:i*255}}function Nx(n,e,t){n=Ye(n,255),e=Ye(e,255),t=Ye(t,255);var r=Math.max(n,e,t),s=Math.min(n,e,t),i,o,a=r,l=r-s;if(o=r===0?0:l/r,r==s)i=0;else{switch(r){case n:i=(e-t)/l+(e<t?6:0);break;case e:i=(t-n)/l+2;break;case t:i=(n-e)/l+4;break}i/=6}return{h:i,s:o,v:a}}function fI(n,e,t){n=Ye(n,360)*6,e=Ye(e,100),t=Ye(t,100);var r=Math.floor(n),s=n-r,i=t*(1-e),o=t*(1-s*e),a=t*(1-(1-s)*e),l=r%6,c=[t,o,i,i,a,t][l],u=[a,t,t,o,i,i][l],d=[i,i,a,t,t,o][l];return{r:c*255,g:u*255,b:d*255}}function Ax(n,e,t,r){var s=[Dn(Math.round(n).toString(16)),Dn(Math.round(e).toString(16)),Dn(Math.round(t).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function pI(n,e,t,r,s){var i=[Dn(Math.round(n).toString(16)),Dn(Math.round(e).toString(16)),Dn(Math.round(t).toString(16)),Dn(L1(r))];return s&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function Ex(n,e,t,r){var s=[Dn(L1(r)),Dn(Math.round(n).toString(16)),Dn(Math.round(e).toString(16)),Dn(Math.round(t).toString(16))];return s.join("")}de.equals=function(n,e){return!n||!e?!1:de(n).toRgbString()==de(e).toRgbString()};de.random=function(){return de.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function mI(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.s-=e/100,t.s=Nu(t.s),de(t)}function gI(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.s+=e/100,t.s=Nu(t.s),de(t)}function xI(n){return de(n).desaturate(100)}function yI(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.l+=e/100,t.l=Nu(t.l),de(t)}function bI(n,e){e=e===0?0:e||10;var t=de(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),de(t)}function vI(n,e){e=e===0?0:e||10;var t=de(n).toHsl();return t.l-=e/100,t.l=Nu(t.l),de(t)}function _I(n,e){var t=de(n).toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,de(t)}function TI(n){var e=de(n).toHsl();return e.h=(e.h+180)%360,de(e)}function Cx(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=de(n).toHsl(),r=[de(n)],s=360/e,i=1;i<e;i++)r.push(de({h:(t.h+i*s)%360,s:t.s,l:t.l}));return r}function wI(n){var e=de(n).toHsl(),t=e.h;return[de(n),de({h:(t+72)%360,s:e.s,l:e.l}),de({h:(t+216)%360,s:e.s,l:e.l})]}function SI(n,e,t){e=e||6,t=t||30;var r=de(n).toHsl(),s=360/t,i=[de(n)];for(r.h=(r.h-(s*e>>1)+720)%360;--e;)r.h=(r.h+s)%360,i.push(de(r));return i}function NI(n,e){e=e||6;for(var t=de(n).toHsv(),r=t.h,s=t.s,i=t.v,o=[],a=1/e;e--;)o.push(de({h:r,s,v:i})),i=(i+a)%1;return o}de.mix=function(n,e,t){t=t===0?0:t||50;var r=de(n).toRgb(),s=de(e).toRgb(),i=t/100,o={r:(s.r-r.r)*i+r.r,g:(s.g-r.g)*i+r.g,b:(s.b-r.b)*i+r.b,a:(s.a-r.a)*i+r.a};return de(o)};de.readability=function(n,e){var t=de(n),r=de(e);return(Math.max(t.getLuminance(),r.getLuminance())+.05)/(Math.min(t.getLuminance(),r.getLuminance())+.05)};de.isReadable=function(n,e,t){var r=de.readability(n,e),s,i;switch(i=!1,s=PI(t),s.level+s.size){case"AAsmall":case"AAAlarge":i=r>=4.5;break;case"AAlarge":i=r>=3;break;case"AAAsmall":i=r>=7;break}return i};de.mostReadable=function(n,e,t){var r=null,s=0,i,o,a,l;t=t||{},o=t.includeFallbackColors,a=t.level,l=t.size;for(var c=0;c<e.length;c++)i=de.readability(n,e[c]),i>s&&(s=i,r=de(e[c]));return de.isReadable(n,r,{level:a,size:l})||!o?r:(t.includeFallbackColors=!1,de.mostReadable(n,["#fff","#000"],t))};var Bf=de.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},AI=de.hexNames=EI(Bf);function EI(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function F1(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function Ye(n,e){CI(n)&&(n="100%");var t=RI(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function Nu(n){return Math.min(1,Math.max(0,n))}function nn(n){return parseInt(n,16)}function CI(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function RI(n){return typeof n=="string"&&n.indexOf("%")!=-1}function Dn(n){return n.length==1?"0"+n:""+n}function Zo(n){return n<=1&&(n=n*100+"%"),n}function L1(n){return Math.round(parseFloat(n)*255).toString(16)}function Rx(n){return nn(n)/255}var wn=(function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",s="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function hr(n){return!!wn.CSS_UNIT.exec(n)}function MI(n){n=n.replace(lI,"").replace(cI,"").toLowerCase();var e=!1;if(Bf[n])n=Bf[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=wn.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=wn.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=wn.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=wn.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=wn.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=wn.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=wn.hex8.exec(n))?{r:nn(t[1]),g:nn(t[2]),b:nn(t[3]),a:Rx(t[4]),format:e?"name":"hex8"}:(t=wn.hex6.exec(n))?{r:nn(t[1]),g:nn(t[2]),b:nn(t[3]),format:e?"name":"hex"}:(t=wn.hex4.exec(n))?{r:nn(t[1]+""+t[1]),g:nn(t[2]+""+t[2]),b:nn(t[3]+""+t[3]),a:Rx(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=wn.hex3.exec(n))?{r:nn(t[1]+""+t[1]),g:nn(t[2]+""+t[2]),b:nn(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function PI(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function kf(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function DI(n){if(Array.isArray(n))return n}function BI(n){if(Array.isArray(n))return kf(n)}function I1(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function kI(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function O1(n,e,t){return e=Zi(e),GI(n,ym()?Reflect.construct(e,t||[],Zi(n).constructor):e.apply(n,t))}function FI(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function U1(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Sd(n,e){return n.get(I1(n,e))}function Mx(n,e,t){FI(n,e),e.set(n,t)}function Px(n,e,t){return n.set(I1(n,e),t),t}function V1(n,e,t){if(ym())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var s=new(n.bind.apply(n,r));return s}function LI(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,$1(r.key),r)}}function j1(n,e,t){return e&&LI(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function Au(n,e,t){return(e=$1(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ff(){return Ff=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=$I(n,e);if(r){var s=Object.getOwnPropertyDescriptor(r,e);return s.get?s.get.call(arguments.length<3?n:t):s.value}},Ff.apply(null,arguments)}function Zi(n){return Zi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Zi(n)}function G1(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Lf(n,e)}function ym(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ym=function(){return!!n})()}function II(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function OI(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function UI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VI(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function jI(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Dx(Object(t),!0).forEach(function(r){Au(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Dx(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function GI(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kI(n)}function Lf(n,e){return Lf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Lf(n,e)}function la(n,e){return DI(n)||OI(n,e)||z1(n,e)||UI()}function $I(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=Zi(n))!==null;);return n}function Nd(n,e,t,r){var s=Ff(Zi(n.prototype),e,t);return typeof s=="function"?function(i){return s.apply(t,i)}:s}function An(n){return BI(n)||II(n)||z1(n)||VI()}function zI(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function $1(n){var e=zI(n,"string");return typeof e=="symbol"?e:e+""}function If(n){"@babel/helpers - typeof";return If=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},If(n)}function z1(n,e){if(n){if(typeof n=="string")return kf(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?kf(n,e):void 0}}var H1=function(e){e instanceof Array?e.forEach(H1):(e.map&&e.map.dispose(),e.dispose())},W1=function(e){e.geometry&&e.geometry.dispose(),e.material&&H1(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(W1)},Of=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),W1(t)}},Ad=new WeakMap,Al=new WeakMap,Do=(function(n){function e(t){var r,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=s.dataBindAttr,o=i===void 0?"__data":i,a=s.objBindAttr,l=a===void 0?"__threeObj":a;return U1(this,e),r=O1(this,e),Au(r,"scene",void 0),Mx(r,Ad,void 0),Mx(r,Al,void 0),r.scene=t,Px(Ad,r,o),Px(Al,r,l),r.onRemoveObj(function(){}),r}return G1(e,n),j1(e,[{key:"onCreateObj",value:function(r){var s=this;return Nd(e,"onCreateObj",this)([function(i){var o=r(i);return i[Sd(Al,s)]=o,o[Sd(Ad,s)]=i,s.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(r){var s=this;return Nd(e,"onRemoveObj",this)([function(i,o){var a=Nd(e,"getData",s)([i]);r(i,o),s.scene.remove(i),Of(i),delete a[Sd(Al,s)]}]),this}}])})(sI),Bo=function(e){return isNaN(e)?parseInt(de(e).toHex(),16):e},Ed=function(e){return isNaN(e)?de(e).getAlpha():1},HI=xm(aI);function Bx(n,e,t){!e||typeof t!="string"||n.filter(function(r){return!r[t]}).forEach(function(r){r[t]=HI(e(r))})}function WI(n,e){var t=n.nodes,r=n.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=s.nodeFilter,o=i===void 0?function(){return!0}:i,a=s.onLoopError,l=a===void 0?function(f){throw"Invalid DAG structure! Found cycle in node path: ".concat(f.join(" -> "),".")}:a,c={};t.forEach(function(f){return c[e(f)]={data:f,out:[],depth:-1,skip:!o(f)}}),r.forEach(function(f){var p=f.source,m=f.target,y=_(p),x=_(m);if(!c.hasOwnProperty(y))throw"Missing source node with id: ".concat(y);if(!c.hasOwnProperty(x))throw"Missing target node with id: ".concat(x);var b=c[y],v=c[x];b.out.push(v);function _(w){return If(w)==="object"?e(w):w}});var u=[];h(Object.values(c));var d=Object.assign.apply(Object,[{}].concat(An(Object.entries(c).filter(function(f){var p=la(f,2),m=p[1];return!m.skip}).map(function(f){var p=la(f,2),m=p[0],y=p[1];return Au({},m,y.depth)}))));return d;function h(f){for(var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=function(){var _=f[x];if(p.indexOf(_)!==-1){var w=[].concat(An(p.slice(p.indexOf(_))),[_]).map(function(T){return e(T.data)});return u.some(function(T){return T.length===w.length&&T.every(function(N,S){return N===w[S]})})||(u.push(w),l(w)),1}m>_.depth&&(_.depth=m,h(_.out,[].concat(An(p),[_]),m+(_.skip?0:1)))},x=0,b=f.length;x<b;x++)y()}}var me=window.THREE?window.THREE:{Group:qv,Mesh:kn,MeshLambertMaterial:Xv,Color:vn,BufferGeometry:Wa,BufferAttribute:rc,Matrix4:In,Vector3:ce,SphereGeometry:Bp,CylinderGeometry:Kv,TubeGeometry:UE,ConeGeometry:OE,Line:FE,LineBasicMaterial:Qv,QuadraticBezierCurve3:IE,CubicBezierCurve3:LE,Box3:Yv},kx={graph:HF,forcelayout:sL},qI=2,Cd=new me.BufferGeometry().setAttribute?"setAttribute":"addAttribute",El=new me.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",XI=Su({props:{jsonUrl:{onChange:function(e,t){var r=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(s){return s.json()}).then(function(s){t.fetchingJson=!1,t.onFinishLoading(s),r.graphData(s)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var r=t.d3ForceLayout.force("charge");r&&r.strength(e>2?-60:-30),e<3&&s(t.graphData.nodes,"z"),e<2&&s(t.graphData.nodes,"y");function s(i,o){i.forEach(function(a){delete a[o],delete a["v".concat(o)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(r){return r.fx=r.fy=r.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},linkDirectionalParticleThreeObject:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,r){return r===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,r),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&r(),s(),i(),this;function r(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var o=Ee(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(h){var f=la(h,2),p=f[0],m=f[1];if(m){var y=t?p:e.layout.getNodePosition(p[e.nodeId]),x=o(p);(!e.nodePositionUpdate||!e.nodePositionUpdate(x?m.children[0]:m,{x:y.x,y:y.y,z:y.z},p)||x)&&(m.position.x=y.x,m.position.y=y.y||0,m.position.z=y.z||0)}});var a=Ee(e.linkWidth),l=Ee(e.linkCurvature),c=Ee(e.linkCurveRotation),u=Ee(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(h){var f=la(h,2),p=f[0],m=f[1];if(m){var y=t?p:e.layout.getLinkPosition(e.layout.graph.getLink(p.source,p.target).id),x=y[t?"source":"from"],b=y[t?"target":"to"];if(!(!x||!b||!x.hasOwnProperty("x")||!b.hasOwnProperty("x"))){d(p);var v=u(p);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(v?m.children[1]:m,{start:{x:x.x,y:x.y,z:x.z},end:{x:b.x,y:b.y,z:b.z}},p)&&!v)){var _=30,w=p.__curve,T=m.children.length?m.children[0]:m;if(T.type==="Line"){if(w){var S=w.getPoints(_);T.geometry.getAttribute("position").array.length!==S.length*3&&T.geometry[Cd]("position",new me.BufferAttribute(new Float32Array(S.length*3),3)),T.geometry.setFromPoints(S)}else{var N=T.geometry.getAttribute("position");(!N||!N.array||N.array.length!==6)&&T.geometry[Cd]("position",N=new me.BufferAttribute(new Float32Array(6),3)),N.array[0]=x.x,N.array[1]=x.y||0,N.array[2]=x.z||0,N.array[3]=b.x,N.array[4]=b.y||0,N.array[5]=b.z||0,N.needsUpdate=!0}T.geometry.computeBoundingSphere()}else if(T.type==="Mesh")if(w){T.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(T.position.set(0,0,0),T.rotation.set(0,0,0),T.scale.set(1,1,1));var O=Math.ceil(a(p)*10)/10,k=O/2,R=new me.TubeGeometry(w,_,k,e.linkResolution,!1);T.geometry.dispose(),T.geometry=R}else{if(!T.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var C=Math.ceil(a(p)*10)/10,D=C/2,F=new me.CylinderGeometry(D,D,1,e.linkResolution,1,!1);F[El](new me.Matrix4().makeTranslation(0,1/2,0)),F[El](new me.Matrix4().makeRotationX(Math.PI/2)),T.geometry.dispose(),T.geometry=F}var j=new me.Vector3(x.x,x.y||0,x.z||0),z=new me.Vector3(b.x,b.y||0,b.z||0),A=j.distanceTo(z);T.position.x=j.x,T.position.y=j.y,T.position.z=j.z,T.scale.z=A,T.parent.localToWorld(z),T.lookAt(z)}}}}});function d(h){var f=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),p=f[t?"source":"from"],m=f[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var y=l(h);if(!y)h.__curve=null;else{var x=new me.Vector3(p.x,p.y||0,p.z||0),b=new me.Vector3(m.x,m.y||0,m.z||0),v=x.distanceTo(b),_,w=c(h);if(v>0){var T=m.x-p.x,N=m.y-p.y||0,S=new me.Vector3().subVectors(b,x),C=S.clone().multiplyScalar(y).cross(T!==0||N!==0?new me.Vector3(0,0,1):new me.Vector3(0,1,0)).applyAxisAngle(S.normalize(),w).add(new me.Vector3().addVectors(x,b).divideScalar(2));_=new me.QuadraticBezierCurve3(x,C,b)}else{var D=y*70,F=-w,j=F+Math.PI/2;_=new me.CubicBezierCurve3(x,new me.Vector3(D*Math.cos(j),D*Math.sin(j),0).add(x),new me.Vector3(D*Math.cos(F),D*Math.sin(F),0).add(x),b)}h.__curve=_}}}}function s(){var o=Ee(e.linkDirectionalArrowRelPos),a=Ee(e.linkDirectionalArrowLength),l=Ee(e.nodeVal);e.arrowDataMapper.entries().forEach(function(c){var u=la(c,2),d=u[0],h=u[1];if(h){var f=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),p=f[t?"source":"from"],m=f[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var y=Math.cbrt(Math.max(0,l(p)||1))*e.nodeRelSize,x=Math.cbrt(Math.max(0,l(m)||1))*e.nodeRelSize,b=a(d),v=o(d),_=d.__curve?function(D){return d.__curve.getPoint(D)}:function(D){var F=function(z,A,O,k){return A[z]+(O[z]-A[z])*k||0};return{x:F("x",p,m,D),y:F("y",p,m,D),z:F("z",p,m,D)}},w=d.__curve?d.__curve.getLength():Math.sqrt(["x","y","z"].map(function(D){return Math.pow((m[D]||0)-(p[D]||0),2)}).reduce(function(D,F){return D+F},0)),T=y+b+(w-y-x-b)*v,N=_(T/w),S=_((T-b)/w);["x","y","z"].forEach(function(D){return h.position[D]=S[D]});var C=V1(me.Vector3,An(["x","y","z"].map(function(D){return N[D]})));h.parent.localToWorld(C),h.lookAt(C)}}})}function i(){var o=Ee(e.linkDirectionalParticleSpeed),a=Ee(e.linkDirectionalParticleOffset);e.graphData.links.forEach(function(l){var c=e.particlesDataMapper.getObj(l),u=c&&c.children,d=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!d||!d.length)&&(!u||!u.length))){var h=t?l:e.layout.getLinkPosition(e.layout.graph.getLink(l.source,l.target).id),f=h[t?"source":"from"],p=h[t?"target":"to"];if(!(!f||!p||!f.hasOwnProperty("x")||!p.hasOwnProperty("x"))){var m=o(l),y=Math.abs(a(l)),x=l.__curve?function(v){return l.__curve.getPoint(v)}:function(v){var _=function(T,N,S,C){return N[T]+(S[T]-N[T])*C||0};return{x:_("x",f,p,v),y:_("y",f,p,v),z:_("z",f,p,v)}},b=[].concat(An(u||[]),An(d||[]));b.forEach(function(v,_){var w=v.parent.__linkThreeObjType==="singleHopPhotons";if(v.hasOwnProperty("__progressRatio")||(v.__progressRatio=w?0:(_+y)/u.length),v.__progressRatio+=m,v.__progressRatio>=1)if(!w)v.__progressRatio=v.__progressRatio%1;else{v.parent.remove(v),Of(v);return}var T=v.__progressRatio,N=x(T);v.geometry.type!=="SphereGeometry"&&v.lookAt(N.x,N.y,N.z),["x","y","z"].forEach(function(S){return v.position[S]=N[S]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var r=new me.Group;r.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=r,e.graphScene.add(r)}var s=Ee(e.linkDirectionalParticleThreeObject)(t);if(s&&e.linkDirectionalParticleThreeObject===s&&(s=s.clone()),!s){var i=Ee(e.linkDirectionalParticleWidth),o=Math.ceil(i(t)*10)/10/2,a=e.linkDirectionalParticleResolution,l=new me.SphereGeometry(o,a,a),c=Ee(e.linkColor),u=Ee(e.linkDirectionalParticleColor),d=u(t)||c(t)||"#f0f0f0",h=new me.Color(Bo(d)),f=e.linkOpacity*3,p=new me.MeshLambertMaterial({color:h,transparent:!0,opacity:f});s=new me.Mesh(l,p)}t.__singleHopPhotonsObj.add(s)}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var r=(function s(i){var o=[];if(i.geometry){i.geometry.computeBoundingBox();var a=new me.Box3;a.copy(i.geometry.boundingBox).applyMatrix4(i.matrixWorld),o.push(a)}return o.concat.apply(o,An((i.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(s)))})(e.graphScene);return r.length?Object.assign.apply(Object,An(["x","y","z"].map(function(s){return Au({},s,[$L(r,function(i){return i.min[s]}),GL(r,function(i){return i.max[s]})])}))):null}},stateInit:function(){return{d3ForceLayout:UF().force("link",PF()).force("charge",VF()).force("center",Bk()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new Do(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new Do(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new Do(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new Do(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var r=function(Q){return Q.some(function(te){return t.hasOwnProperty(te)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&r(["nodeAutoColorBy","graphData","nodeColor"])&&Bx(e.graphData.nodes,Ee(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&r(["linkAutoColorBy","graphData","linkColor"])&&Bx(e.graphData.links,Ee(e.linkAutoColorBy),e.linkColor),e._flushObjects||r(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var s=Ee(e.nodeThreeObject),i=Ee(e.nodeThreeObjectExtend),o=Ee(e.nodeVal),a=Ee(e.nodeColor),l=Ee(e.nodeVisibility),c={},u={};(e._flushObjects||r(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(U){var Q=s(U),te=i(U);Q&&e.nodeThreeObject===Q&&(Q=Q.clone());var le;return Q&&!te?le=Q:(le=new me.Mesh,le.__graphDefaultObj=!0,Q&&te&&le.add(Q)),le.__graphObjType="node",le}).onUpdateObj(function(U,Q){if(U.__graphDefaultObj){var te=o(Q)||1,le=Math.cbrt(te)*e.nodeRelSize,ye=e.nodeResolution;(!U.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||U.geometry.parameters.radius!==le||U.geometry.parameters.widthSegments!==ye)&&(c.hasOwnProperty(te)||(c[te]=new me.SphereGeometry(le,ye,ye)),U.geometry.dispose(),U.geometry=c[te]);var ge=a(Q),Me=new me.Color(Bo(ge||"#ffffaa")),nt=e.nodeOpacity*Ed(ge);(U.material.type!=="MeshLambertMaterial"||!U.material.color.equals(Me)||U.material.opacity!==nt)&&(u.hasOwnProperty(ge)||(u[ge]=new me.MeshLambertMaterial({color:Me,transparent:!0,opacity:nt})),U.material.dispose(),U.material=u[ge])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||r(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject"])){var d=Ee(e.linkThreeObject),h=Ee(e.linkThreeObjectExtend),f=Ee(e.linkMaterial),p=Ee(e.linkVisibility),m=Ee(e.linkColor),y=Ee(e.linkWidth),x={},b={},v={},_=e.graphData.links.filter(p);if((e._flushObjects||r(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(U){var Q=U.__data&&U.__data.__singleHopPhotonsObj;Q&&(Q.parent.remove(Q),Of(Q),delete U.__data.__singleHopPhotonsObj)}).onCreateObj(function(U){var Q=d(U),te=h(U);Q&&e.linkThreeObject===Q&&(Q=Q.clone());var le;if(!Q||te){var ye=!!y(U);if(ye)le=new me.Mesh;else{var ge=new me.BufferGeometry;ge[Cd]("position",new me.BufferAttribute(new Float32Array(6),3)),le=new me.Line(ge)}}var Me;return Q?te?(Me=new me.Group,Me.__graphDefaultObj=!0,Me.add(le),Me.add(Q)):Me=Q:(Me=le,Me.__graphDefaultObj=!0),Me.renderOrder=10,Me.__graphObjType="link",Me}).onUpdateObj(function(U,Q){if(U.__graphDefaultObj){var te=U.children.length?U.children[0]:U,le=Math.ceil(y(Q)*10)/10,ye=!!le;if(ye){var ge=le/2,Me=e.linkResolution;if(!te.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||te.geometry.parameters.radiusTop!==ge||te.geometry.parameters.radialSegments!==Me){if(!x.hasOwnProperty(le)){var nt=new me.CylinderGeometry(ge,ge,1,Me,1,!1);nt[El](new me.Matrix4().makeTranslation(0,1/2,0)),nt[El](new me.Matrix4().makeRotationX(Math.PI/2)),x[le]=nt}te.geometry.dispose(),te.geometry=x[le]}}var xt=f(Q);if(xt)te.material=xt;else{var lt=m(Q),He=new me.Color(Bo(lt||"#f0f0f0")),wt=e.linkOpacity*Ed(lt),Pe=ye?"MeshLambertMaterial":"LineBasicMaterial";if(te.material.type!==Pe||!te.material.color.equals(He)||te.material.opacity!==wt){var ue=ye?b:v;ue.hasOwnProperty(lt)||(ue[lt]=new me[Pe]({color:He,transparent:wt<1,opacity:wt,depthWrite:wt>=1})),te.material.dispose(),te.material=ue[lt]}}}}).digest(_),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var w=Ee(e.linkDirectionalArrowLength),T=Ee(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var U=new me.Mesh(void 0,new me.MeshLambertMaterial({transparent:!0}));return U.__linkThreeObjType="arrow",U}).onUpdateObj(function(U,Q){var te=w(Q),le=e.linkDirectionalArrowResolution;if(!U.geometry.type.match(/^Cone(Buffer)?Geometry$/)||U.geometry.parameters.height!==te||U.geometry.parameters.radialSegments!==le){var ye=new me.ConeGeometry(te*.25,te,le);ye.translate(0,te/2,0),ye.rotateX(Math.PI/2),U.geometry.dispose(),U.geometry=ye}var ge=T(Q)||m(Q)||"#f0f0f0";U.material.color=new me.Color(Bo(ge)),U.material.opacity=e.linkOpacity*3*Ed(ge)}).digest(_.filter(w))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var N=Ee(e.linkDirectionalParticles),S=Ee(e.linkDirectionalParticleWidth),C=Ee(e.linkDirectionalParticleColor),D=Ee(e.linkDirectionalParticleThreeObject),F={},j={};e.particlesDataMapper.onCreateObj(function(){var U=new me.Group;return U.__linkThreeObjType="photons",U.__photonDataMapper=new Do(U),U}).onUpdateObj(function(U,Q){var te=!!U.children.length&&U.children[0],le=D(Q),ye,ge;if(le)ye=le.geometry,ge=le.material;else{var Me=Math.ceil(S(Q)*10)/10/2,nt=e.linkDirectionalParticleResolution;te&&te.geometry.parameters.radius===Me&&te.geometry.parameters.widthSegments===nt?ye=te.geometry:(j.hasOwnProperty(Me)||(j[Me]=new me.SphereGeometry(Me,nt,nt)),ye=j[Me]);var xt=C(Q)||m(Q)||"#f0f0f0",lt=new me.Color(Bo(xt)),He=e.linkOpacity*3;te&&te.material.color.equals(lt)&&te.material.opacity===He?ge=te.material:(F.hasOwnProperty(xt)||(F[xt]=new me.MeshLambertMaterial({color:lt,transparent:!0,opacity:He})),ge=F[xt])}te&&(te.geometry!==ye&&te.geometry.dispose(),te.material!==ge&&te.material.dispose());var wt=Math.round(Math.abs(N(Q)));U.__photonDataMapper.id(function(Pe){return Pe.idx}).onCreateObj(function(){return new me.Mesh(ye,ge)}).onUpdateObj(function(Pe){Pe.geometry=ye,Pe.material=ge}).digest(An(new Array(wt)).map(function(Pe,ue){return{idx:ue}}))}).digest(_.filter(N))}}if(e._flushObjects=!1,r(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(U){U.source=U[e.linkSource],U.target=U[e.linkTarget]});var z=e.forceEngine!=="ngraph",A;if(z){(A=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var O=e.d3ForceLayout.force("link");O&&O.id(function(U){return U[e.nodeId]}).links(e.graphData.links);var k=e.dagMode&&WI(e.graphData,function(U){return U[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),R=Math.max.apply(Math,An(Object.values(k||[]))),I=e.dagLevelDistance||e.graphData.nodes.length/(R||1)*qI*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var P=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(U){return delete U[P]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var W=["rl","td","zout"].includes(e.dagMode),L=function(Q){return(k[Q[e.nodeId]]-R/2)*I*(W?-1:1)},G=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(U){return U[G]=L(U)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?jF(function(U){var Q=k[U[e.nodeId]]||-1;return(e.dagMode==="radialin"?R-Q:Q)*I}).strength(function(U){return e.dagNodeFilter(U)?1:0}):null)}else{var Z=kx.graph();e.graphData.nodes.forEach(function(U){Z.addNode(U[e.nodeId])}),e.graphData.links.forEach(function(U){Z.addLink(U.source,U.target)}),A=kx.forcelayout(Z,jI({dimensions:e.numDimensions},e.ngraphPhysics)),A.graph=Z}for(var ee=0;ee<e.warmupTicks&&!(z&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);ee++)A[z?"tick":"step"]();e.layout=A,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function KI(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=(function(s){function i(){var o;U1(this,i);for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return o=O1(this,i,[].concat(l)),o.__kapsuleInstance=V1(n,[].concat(An(t?[o]:[]),l)),o}return G1(i,s),j1(i)})(e);return Object.keys(n()).forEach(function(s){return r.prototype[s]=function(){var i,o=(i=this.__kapsuleInstance)[s].apply(i,arguments);return o===this.__kapsuleInstance?this:o}}),r}var YI=window.THREE?window.THREE:{Group:qv},q1=KI(XI,YI.Group,!0);const QI=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Rd=new WeakMap;class ZI{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=QI,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:r,material:s,object:i}=e;if(t={material:this.getMaterialData(s),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const s=e[r];t[r]={version:s.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const s=e[r];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?t[r]={id:s.id,version:s.version}:t[r]=s.clone():t[r]=s)}return t}equals(e,t){const{object:r,material:s,geometry:i}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(r.matrixWorld)!==!0)return o.worldMatrix.copy(r.matrixWorld),!1;const a=o.material;for(const y in a){const x=a[y],b=s[y];if(x.equals!==void 0){if(x.equals(b)===!1)return x.copy(b),!1}else if(b.isTexture===!0){if(x.id!==b.id||x.version!==b.version)return x.id=b.id,x.version=b.version,!1}else if(x!==b)return a[y]=b,!1}if(a.transmission>0){const{width:y,height:x}=e.context;if(o.bufferWidth!==y||o.bufferHeight!==x)return o.bufferWidth=y,o.bufferHeight=x,!1}const l=o.geometry,c=i.attributes,u=l.attributes,d=Object.keys(u),h=Object.keys(c);if(l.id!==i.id)return l.id=i.id,!1;if(d.length!==h.length)return o.geometry.attributes=this.getAttributesData(c),!1;for(const y of d){const x=u[y],b=c[y];if(b===void 0)return delete u[y],!1;if(x.version!==b.version)return x.version=b.version,!1}const f=i.index,p=l.indexVersion,m=f?f.version:null;if(p!==m)return l.indexVersion=m,!1;if(l.drawRange.start!==i.drawRange.start||l.drawRange.count!==i.drawRange.count)return l.drawRange.start=i.drawRange.start,l.drawRange.count=i.drawRange.count,!1;if(o.morphTargetInfluences){let y=!1;for(let x=0;x<o.morphTargetInfluences.length;x++)o.morphTargetInfluences[x]!==r.morphTargetInfluences[x]&&(o.morphTargetInfluences[x]=r.morphTargetInfluences[x],y=!0);if(y)return!1}if(o.lights){for(let y=0;y<t.length;y++)if(o.lights[y].map!==t[y].map)return!1}return o.center&&o.center.equals(r.center)===!1?(o.center.copy(r.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const r of e)r.isSpotLight===!0&&r.map!==null&&t.push({map:r.map.version});return t}getLights(e,t){if(Rd.has(e)){const s=Rd.get(e);if(s.renderId===t)return s.lightsData}const r=this.getLightsData(e.getLights());return Rd.set(e,{renderId:t,lightsData:r}),r}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const s=e.object.static===!0,i=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(s||i)return!1;const o=this.getLights(e.lightsNode,r);return this.equals(e,o)!==!0}}function bm(n,e=0){let t=3735928559^e,r=1103547991^e;if(n instanceof Array)for(let s=0,i;s<n.length;s++)i=n[s],t=Math.imul(t^i,2654435761),r=Math.imul(r^i,1597334677);else for(let s=0,i;s<n.length;s++)i=n.charCodeAt(s),t=Math.imul(t^i,2654435761),r=Math.imul(r^i,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&r)+(t>>>0)}const Eu=n=>bm(n),Za=n=>bm(n),ca=(...n)=>bm(n),JI=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Fx=new WeakMap;function eO(n){return JI.get(n)}function Wc(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function vm(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new vn(...e):t==="vec2"?new we(...e):t==="vec3"?new ce(...e):t==="vec4"?new et(...e):t==="mat2"?new D_(...e):t==="mat3"?new qa(...e):t==="mat4"?new In(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?nO(e[0]):null}function X1(n){let e=Fx.get(n);return e===void 0&&(e={},Fx.set(n,e)),e}function tO(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function nO(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const Cl={VERTEX:"vertex"},_e={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Xn={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},rO=["fragment","vertex"],Lx=["setup","analyze","generate"],Ix=[...rO,"compute"],ho=["x","y","z","w"],sO={analyze:"setup",generate:"analyze"};let iO=0;class ae extends Lp{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=_e.NONE,this.updateBeforeType=_e.NONE,this.updateAfterType=_e.NONE,this.uuid=Pc.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:iO++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,_e.FRAME)}onRenderUpdate(e){return this.onUpdate(e,_e.RENDER)}onObjectUpdate(e){return this.onUpdate(e,_e.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const r of Object.getOwnPropertyNames(this)){const s=this[r];if(!(r.startsWith("_")===!0||e.has(s))){if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const o=s[i];o&&o.isNode===!0&&t.push({property:r,index:i,childNode:o})}else if(s&&s.isNode===!0)t.push({property:r,childNode:s});else if(s&&Object.getPrototypeOf(s)===Object.prototype)for(const i in s){if(i.startsWith("_")===!0)continue;const o=s[i];o&&o.isNode===!0&&t.push({property:r,index:i,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const r=[];for(const{property:s,childNode:i}of this._getChildren(t))r.push(Eu(s.slice(0,-4)),i.getCacheKey(e,t));this._cacheKey=ca(Za(r),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let r=0;for(const s of this.getChildren())t["node"+r++]=s;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(this.parents===!0){const s=e.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[e.shaderStage]=s.stages[e.shaderStage]||[],s.stages[e.shaderStage].push(t)}if(r===1){const s=e.getNodeProperties(this);for(const i of Object.values(s))i&&i.isNode===!0&&i.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){ie("Abstract function.")}updateAfter(){ie("Abstract function.")}update(){ie("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);if(this._beforeNodes!==null){const l=this._beforeNodes;this._beforeNodes=null;for(const c of l)c.build(e,t);this._beforeNodes=l}const s=e.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[e.buildStage]=!0;const i=sO[e.buildStage];if(i&&s.buildStages[i]!==!0){const l=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const c of Object.values(l))if(c&&c.isNode===!0){if(c.parents===!0){const u=e.getNodeProperties(c);u.parents=u.parents||[],u.parents.push(this)}c.build(e)}}o=l.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length<2){const c=this.getNodeType(e),u=e.getDataFromNode(this);o=u.snippet,o===void 0?u.generated===void 0?(u.generated=!0,o=this.generate(e)||"",u.snippet=o):(ie("Node: Recursion detected.",this),o="/* Recursion detected. */"):u.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,c,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(se(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:s,index:i,childNode:o}of t)i!==void 0?(r[s]===void 0&&(r[s]=Number.isInteger(i)?[]:{}),r[s][i]=o.toJSON(e.meta).uuid):r[s]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const s=[];for(const i of e.inputNodes[r])s.push(t[i]);this[r]=s}else if(typeof e.inputNodes[r]=="object"){const s={};for(const i in e.inputNodes[r]){const o=e.inputNodes[r][i];s[i]=t[o]}this[r]=s}else{const s=e.inputNodes[r];this[r]=t[s]}}}toJSON(e){const{uuid:t,type:r}=this,s=e===void 0||typeof e=="string";s&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}if(s){const a=o(e.textures),l=o(e.images),c=o(e.nodes);a.length>0&&(i.textures=a),l.length>0&&(i.images=l),c.length>0&&(i.nodes=c)}return i}}class Ja extends ae{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),r=this.node.build(e),s=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${r}[ ${s} ]`}}class K1 extends ae{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const s of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(s))&&(r=s);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,s=this.getNodeType(e),i=r.build(e,s);return e.format(i,s,t)}}class _t extends ae{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const s=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(i.propertyName!==void 0)return e.format(i.propertyName,s,t);if(s!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,s),a=e.getVarFromNode(this,null,s),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),i.snippet=o,i.propertyName=l,e.format(i.propertyName,s,t)}}return super.build(e,t)}}class oO extends _t{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),s=e.getTypeLength(r),i=this.nodes,o=e.getComponentType(r),a=[];let l=0;for(const u of i){if(l>=s){se(`TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let d=u.getNodeType(e),h=e.getTypeLength(d),f;if(l+h>s&&(se(`TSL: Length of '${r}()' data exceeds maximum length of output type.`),h=s-l,d=e.getTypeFromLength(h)),l+=h,f=u.build(e,d),e.getComponentType(d)!==o){const m=e.getTypeFromLength(h,o);f=e.format(f,d,m)}a.push(f)}const c=`${e.getType(r)}( ${a.join(", ")} )`;return e.format(c,r,t)}}const aO=ho.join("");class lO extends ae{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(ho.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const r=this.node,s=e.getTypeLength(r.getNodeType(e));let i=null;if(s>1){let o=null;this.getVectorLength()>=s&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=r.build(e,o);this.components.length===s&&this.components===aO.slice(0,this.components.length)?i=e.format(l,o,t):i=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else i=r.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class cO extends _t{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:s}=this,i=this.getNodeType(e),o=e.getComponentType(s.getNodeType(e)),a=e.getTypeFromLength(r.length,o),l=s.build(e,a),c=t.build(e,i),u=e.getTypeLength(i),d=[];for(let h=0;h<u;h++){const f=ho[h];f===r[0]?(d.push(l),h+=r.length-1):d.push(c+"."+f)}return`${e.getType(i)}( ${d.join(", ")} )`}}class uO extends _t{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,s=this.getNodeType(e),i=r.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+i,this);const l=e.getTypeLength(s),c=[];let u=0;for(let d=0;d<l;d++){const h=ho[d];h===t[u]?(c.push("1.0 - "+(a+"."+h)),u++):c.push(a+"."+h)}return`${e.getType(s)}( ${c.join(", ")} )`}}class _m extends ae{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Wc(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Wc(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=tO(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?vm(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){ie("Abstract function.")}}const Ox=/float|u?int/;class ar extends _m{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return Ox.test(r)&&Ox.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class dO extends ae{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){ie(`TSL: Member "${this.property}" does not exist in struct.`);const r=this.getNodeType(e);return e.generateConst(r)}return this.structNode.build(e)+"."+this.property}}let Zs=null;const Uf=new Map;function H(n,e){if(Uf.has(n)){ie(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);Uf.set(n,e),n!=="assign"&&(ae.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},ae.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const hO=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Ux=n=>hO(n).split("").sort().join("");ae.prototype.assign=function(...n){if(this.isStackNode!==!0)return Zs!==null?Zs.assign(this,...n):se("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=Uf.get("assign");return this.addToStack(e(...n))}};ae.prototype.toVarIntent=function(){return this};ae.prototype.get=function(n){return new dO(this,n)};const ua={};function Rl(n,e,t){ua[n]=ua[e]=ua[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new lO(this,n),this._cache[n]=o),o},set(o){this[n].assign(J(o))}};const r=n.toUpperCase(),s=e.toUpperCase(),i=t.toUpperCase();ae.prototype["set"+r]=ae.prototype["set"+s]=ae.prototype["set"+i]=function(o){const a=Ux(n);return new cO(this,a,J(o))},ae.prototype["flip"+r]=ae.prototype["flip"+s]=ae.prototype["flip"+i]=function(){const o=Ux(n);return new uO(this,o)}}const jn=["x","y","z","w"],Gn=["r","g","b","a"],$n=["s","t","p","q"];for(let n=0;n<4;n++){let e=jn[n],t=Gn[n],r=$n[n];Rl(e,t,r);for(let s=0;s<4;s++){e=jn[n]+jn[s],t=Gn[n]+Gn[s],r=$n[n]+$n[s],Rl(e,t,r);for(let i=0;i<4;i++){e=jn[n]+jn[s]+jn[i],t=Gn[n]+Gn[s]+Gn[i],r=$n[n]+$n[s]+$n[i],Rl(e,t,r);for(let o=0;o<4;o++)e=jn[n]+jn[s]+jn[i]+jn[o],t=Gn[n]+Gn[s]+Gn[i]+Gn[o],r=$n[n]+$n[s]+$n[i]+$n[o],Rl(e,t,r)}}}for(let n=0;n<32;n++)ua[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new Ja(this,new ar(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(J(e))}};Object.defineProperties(ae.prototype,ua);const Vx=new WeakMap,fO=function(n,e=null){const t=Wc(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?J(Vf(n,e)):t==="shader"?n.isFn?n:Y(n):n},pO=function(n,e=null){for(const t in n)n[t]=J(n[t],e);return n},mO=function(n,e=null){const t=n.length;for(let r=0;r<t;r++)n[r]=J(n[r],e);return n},Y1=function(n,e=null,t=null,r=null){function s(u){return r!==null?(u=J(Object.assign(u,r)),r.intent===!0&&(u=u.toVarIntent())):u=J(u),u}let i,o=e,a,l;function c(u){let d;return o?d=/[a-z]/i.test(o)?o+"()":o:d=n.type,a!==void 0&&u.length<a?(se(`TSL: "${d}" parameter length is less than minimum required.`),u.concat(new Array(a-u.length).fill(0))):l!==void 0&&u.length>l?(se(`TSL: "${d}" parameter length exceeds limit.`),u.slice(0,l)):u}return e===null?i=(...u)=>s(new n(...Ui(c(u)))):t!==null?(t=J(t),i=(...u)=>s(new n(e,...Ui(c(u)),t))):i=(...u)=>s(new n(e,...Ui(c(u)))),i.setParameterLength=(...u)=>(u.length===1?a=l=u[0]:u.length===2&&([a,l]=u),i),i.setName=u=>(o=u,i),i},gO=function(n,...e){return J(new n(...Ui(e)))};class xO extends ae{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:r}=this,s=e.getNodeProperties(t),i=e.getClosestSubBuild(t.subBuilds)||"",o=i||"default";if(s[o])return s[o];const a=e.subBuildFn,l=e.fnCall;e.subBuildFn=i,e.fnCall=this;let c=null;if(t.layout){let u=Vx.get(e.constructor);u===void 0&&(u=new WeakMap,Vx.set(e.constructor,u));let d=u.get(t);d===void 0&&(d=J(e.buildFunctionNode(t)),u.set(t,d)),e.addInclude(d);const h=r?yO(r):null;c=J(d.call(h))}else{const u=new Proxy(e,{get:(m,y,x)=>{let b;return Symbol.iterator===y?b=function*(){yield void 0}:b=Reflect.get(m,y,x),b}}),d=r?bO(r):null,h=Array.isArray(r)?r.length>0:r!==null,f=t.jsFunc,p=h||f.length>1?f(d,u):f(u);c=J(p)}return e.subBuildFn=a,e.fnCall=l,t.once&&(s[o]=c),c}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getSubBuildOutput(this);return t[r]=t[r]||this.setupOutput(e),t[r].subBuild=e.getClosestSubBuild(this),t[r]}build(e,t=null){let r=null;const s=e.getBuildStage(),i=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e),l=e.fnCall;if(e.fnCall=this,s==="setup"){const c=e.getSubBuildProperty("initialized",this);if(i[c]!==!0&&(i[c]=!0,i[o]=this.getOutputNode(e),i[o].build(e),this.shaderNode.subBuilds))for(const u of e.chaining){const d=e.getDataFromNode(u,"any");d.subBuilds=d.subBuilds||new Set;for(const h of this.shaderNode.subBuilds)d.subBuilds.add(h)}r=i[o]}else s==="analyze"?a.build(e,t):s==="generate"&&(r=a.build(e,t)||"");return e.fnCall=l,r}}function yO(n){let e;return Nm(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function bO(n){let e=0;return Nm(n),new Proxy(n,{get:(t,r,s)=>{let i;if(r==="length")return i=n.length,i;if(Symbol.iterator===r)i=function*(){for(const o of n)yield J(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[r]===void 0?i=o[e++]:i=Reflect.get(o,r,s)}else n[0]instanceof ae&&(n[r]===void 0?i=n[e++]:i=Reflect.get(n,r,s));else i=Reflect.get(t,r,s);i=J(i)}return i}})}class vO extends ae{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new xO(this,e)}setup(){return this.call()}}const _O=[!1,!0],TO=[0,1,2,3],wO=[-1,-2],Q1=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Tm=new Map;for(const n of _O)Tm.set(n,new ar(n));const wm=new Map;for(const n of TO)wm.set(n,new ar(n,"uint"));const Sm=new Map([...wm].map(n=>new ar(n.value,"int")));for(const n of wO)Sm.set(n,new ar(n,"int"));const Cu=new Map([...Sm].map(n=>new ar(n.value)));for(const n of Q1)Cu.set(n,new ar(n));for(const n of Q1)Cu.set(-n,new ar(-n));const Ru={bool:Tm,uint:wm,ints:Sm,float:Cu},jx=new Map([...Tm,...Cu]),Vf=(n,e)=>jx.has(n)?jx.get(n):n.isNode===!0?n:new ar(n,e),gt=function(n,e=null){return(...t)=>{for(const s of t)if(s===void 0)return se(`TSL: Invalid parameter for the type "${n}".`),J(new ar(0,n));if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(s=>{const i=typeof s;return i!=="object"&&i!=="function"}))&&(t=[vm(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Ml(e.get(t[0]));if(t.length===1){const s=Vf(t[0],n);return s.nodeType===n?Ml(s):Ml(new K1(s,n))}const r=t.map(s=>Vf(s));return Ml(new oO(r,n))}},Gx=n=>typeof n=="object"&&n!==null?n.value:n,SO=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function Jo(n,e){return new vO(n,e)}const J=(n,e=null)=>fO(n,e),Ml=(n,e=null)=>J(n,e).toVarIntent(),Nm=(n,e=null)=>new pO(n,e),Ui=(n,e=null)=>new mO(n,e),Be=(n,e=null,t=null,r=null)=>new Y1(n,e,t,r),re=(n,...e)=>new gO(n,...e),oe=(n,e=null,t=null,r={})=>new Y1(n,e,t,{...r,intent:!0});let NO=0;class AO extends ae{constructor(e,t=null){super();let r=null;t!==null&&(typeof t=="object"?r=t.return:(typeof t=="string"?r=t:se("TSL: Invalid layout type."),t=null)),this.shaderNode=new Jo(e,r),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const r={name:"fn"+NO++,type:t,inputs:[]};for(const s in e)s!=="return"&&r.inputs.push({name:s,type:e[s]});e=r}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return se('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function Y(n,e=null){const t=new AO(n,e);return new Proxy(()=>{},{apply(r,s,i){return t.call(...i)},get(r,s,i){return Reflect.get(t,s,i)},set(r,s,i,o){return Reflect.set(t,s,i,o)}})}const qc=n=>{Zs=n},Z1=()=>Zs,Xe=(...n)=>Zs.If(...n);function J1(n){return Zs&&Zs.addToStack(n),n}H("toStack",J1);const EO=new gt("color"),$=new gt("float",Ru.float),ze=new gt("int",Ru.ints),it=new gt("uint",Ru.uint),Am=new gt("bool",Ru.bool),ne=new gt("vec2"),xr=new gt("ivec2"),CO=new gt("uvec2"),RO=new gt("bvec2"),X=new gt("vec3"),MO=new gt("ivec3"),PO=new gt("uvec3"),DO=new gt("bvec3"),ve=new gt("vec4"),BO=new gt("ivec4"),kO=new gt("uvec4"),FO=new gt("bvec4"),Em=new gt("mat2"),$t=new gt("mat3"),Vi=new gt("mat4");H("toColor",EO);H("toFloat",$);H("toInt",ze);H("toUint",it);H("toBool",Am);H("toVec2",ne);H("toIVec2",xr);H("toUVec2",CO);H("toBVec2",RO);H("toVec3",X);H("toIVec3",MO);H("toUVec3",PO);H("toBVec3",DO);H("toVec4",ve);H("toIVec4",BO);H("toUVec4",kO);H("toBVec4",FO);H("toMat2",Em);H("toMat3",$t);H("toMat4",Vi);const LO=Be(Ja).setParameterLength(2),IO=(n,e)=>J(new K1(J(n),e));H("element",LO);H("convert",IO);H("append",n=>(ie("TSL: .append() has been renamed to .toStack()."),J1(n)));class Ie extends ae{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Eu(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const rs=(n,e)=>J(new Ie(n,e)),Xc=(n,e)=>J(new Ie(n,e,!0)),Re=re(Ie,"vec4","DiffuseColor"),$x=re(Ie,"vec3","EmissiveColor"),Tr=re(Ie,"float","Roughness"),Kc=re(Ie,"float","Metalness"),jf=re(Ie,"float","Clearcoat"),Yc=re(Ie,"float","ClearcoatRoughness"),Ai=re(Ie,"vec3","Sheen"),Cm=re(Ie,"float","SheenRoughness"),Rm=re(Ie,"float","Iridescence"),ew=re(Ie,"float","IridescenceIOR"),tw=re(Ie,"float","IridescenceThickness"),Gf=re(Ie,"float","AlphaT"),Es=re(Ie,"float","Anisotropy"),pc=re(Ie,"vec3","AnisotropyT"),ji=re(Ie,"vec3","AnisotropyB"),En=re(Ie,"color","SpecularColor"),Qc=re(Ie,"float","SpecularF90"),$f=re(Ie,"float","Shininess"),da=re(Ie,"vec4","Output"),Md=re(Ie,"float","dashSize"),zx=re(Ie,"float","gapSize"),mc=re(Ie,"float","IOR"),zf=re(Ie,"float","Transmission"),nw=re(Ie,"float","Thickness"),rw=re(Ie,"float","AttenuationDistance"),sw=re(Ie,"color","AttenuationColor"),iw=re(Ie,"float","Dispersion");class ow extends ae{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const OO=n=>new ow(n),Mm=(n,e=0)=>new ow(n,!0,e),UO=Mm("frame"),fe=Mm("render"),aw=OO("object");class el extends _m{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=aw}setName(e){return this.name=e,this}label(e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(r=>{const s=e(r,this);s!==void 0&&(this.value=s)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const r=this.getNodeType(e),s=this.getUniformHash(e);let i=e.getNodeFromHash(s);i===void 0&&(e.setHashNode(this,s),i=this);const o=i.getInputType(e),a=e.getUniformFromNode(i,o,e.shaderStage,this.name||e.context.nodeName),l=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let c=l;if(r==="bool"){const u=e.getDataFromNode(this);let d=u.propertyName;if(d===void 0){const h=e.getVarFromNode(this,null,"bool");d=e.getPropertyName(h),u.propertyName=d,c=e.format(l,o,r),e.addLineFlowCode(`${d} = ${c}`,this)}c=d}return e.format(c,r,t)}}const pe=(n,e)=>{const t=SO(e||n);return t===n&&(n=vm(t)),n=n&&n.isNode===!0?n.node&&n.node.value||n.value:n,J(new el(n,t))};class Hx extends _t{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const VO=(...n)=>{let e;if(n.length===1){const t=n[0];e=new Hx(null,t.length,t)}else{const t=n[0],r=n[1];e=new Hx(t,r)}return J(e)};H("toArray",(n,e)=>VO(Array(e).fill(n)));class jO extends _t{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return ho.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,s=t.getScope(),i=e.getNodeProperties(s);i.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=r,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:s}=e.getNodeProperties(this),i=this.needsSplitAssign(e),o=r.build(e),a=r.getNodeType(e),l=s.build(e,a),c=s.getNodeType(e),u=e.getDataFromNode(this);let d;if(u.initialized===!0)t!=="void"&&(d=o);else if(i){const h=e.getVarFromNode(this,null,a),f=e.getPropertyName(h);e.addLineFlowCode(`${f} = ${l}`,this);const p=r.node,y=p.node.context({assign:!0}).build(e);for(let x=0;x<p.components.length;x++){const b=p.components[x];e.addLineFlowCode(`${y}.${b} = ${f}[ ${x} ]`,this)}t!=="void"&&(d=o)}else d=`${o} = ${l}`,(t==="void"||c==="void")&&(e.addLineFlowCode(d,this),t!=="void"&&(d=o));return u.initialized=!0,e.format(d,a,t)}}const GO=Be(jO).setParameterLength(2);H("assign",GO);class $O extends _t{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],r=this.functionNode,s=r.getInputs(e),i=this.parameters,o=(l,c)=>{const u=c.type,d=u==="pointer";let h;return d?h="&"+l.build(e):h=l.build(e,u),h};if(Array.isArray(i)){if(i.length>s.length)se("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=s.length;else if(i.length<s.length)for(se("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<s.length;)i.push($(0));for(let l=0;l<i.length;l++)t.push(o(i[l],s[l]))}else for(const l of s){const c=i[l.name];c!==void 0?t.push(o(c,l)):(se(`TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(o($(0),l)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const zO=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Ui(e):Nm(e[0]),new $O(J(n),e));H("call",zO);const HO={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class tt extends _t{static get type(){return"OperatorNode"}constructor(e,t,r,...s){if(super(),s.length>0){let i=new tt(e,t,r);for(let o=0;o<s.length-1;o++)i=new tt(e,i,s[o]);t=i,r=s[s.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(HO[this.op],t)}getNodeType(e,t=null){const r=this.op,s=this.aNode,i=this.bNode,o=s.getNodeType(e),a=i?i.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(r==="%")return o;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(o);if(r==="!"||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">="){const l=Math.max(e.getTypeLength(o),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const r=this.op,{aNode:s,bNode:i}=this,o=this.getNodeType(e,t);let a=null,l=null;o!=="void"?(a=s.getNodeType(e),l=i?i.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="||r==="!="?e.isVector(a)?l=a:e.isVector(l)?a=l:a!==l&&(a=l="float"):r===">>"||r==="<<"?(a=o,l=e.changeComponentType(l,"uint")):r==="%"?(a=o,l=e.isInteger(a)&&e.isInteger(l)?l:a):e.isMatrix(a)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(a):e.isMatrix(l)||(a=l=o):e.isMatrix(l)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(l):a=l=o:a=l=o):a=l=o;const c=s.build(e,a),u=i?i.build(e,l):null,d=e.getFunctionOperator(r);if(t!=="void"){const h=e.renderer.coordinateSystem===Ac;if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">=")return h?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${c}, ${u} )`,o,t):e.format(`( ${c} ${r} ${u} )`,o,t):e.format(`( ${c} ${r} ${u} )`,o,t);if(r==="%")return e.isInteger(l)?e.format(`( ${c} % ${u} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${c}, ${u} )`,o,t);if(r==="!"||r==="~")return e.format(`(${r}${c})`,a,t);if(d)return e.format(`${d}( ${c}, ${u} )`,o,t);if(e.isMatrix(a)&&l==="float")return e.format(`( ${u} ${r} ${c} )`,o,t);if(a==="float"&&e.isMatrix(l))return e.format(`${c} ${r} ${u}`,o,t);{let f=`( ${c} ${r} ${u} )`;return!h&&o==="bool"&&e.isVector(a)&&e.isVector(l)&&(f=`all${f}`),e.format(f,o,t)}}else if(a!=="void")return d?e.format(`${d}( ${c}, ${u} )`,o,t):e.isMatrix(a)&&l==="float"?e.format(`${u} ${r} ${c}`,o,t):e.format(`${c} ${r} ${u}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Zt=oe(tt,"+").setParameterLength(2,1/0).setName("add"),Ut=oe(tt,"-").setParameterLength(2,1/0).setName("sub"),Te=oe(tt,"*").setParameterLength(2,1/0).setName("mul"),nr=oe(tt,"/").setParameterLength(2,1/0).setName("div"),Pm=oe(tt,"%").setParameterLength(2).setName("mod"),lw=oe(tt,"==").setParameterLength(2).setName("equal"),WO=oe(tt,"!=").setParameterLength(2).setName("notEqual"),qO=oe(tt,"<").setParameterLength(2).setName("lessThan"),XO=oe(tt,">").setParameterLength(2).setName("greaterThan"),KO=oe(tt,"<=").setParameterLength(2).setName("lessThanEqual"),YO=oe(tt,">=").setParameterLength(2).setName("greaterThanEqual"),QO=oe(tt,"&&").setParameterLength(2,1/0).setName("and"),ZO=oe(tt,"||").setParameterLength(2,1/0).setName("or"),JO=oe(tt,"!").setParameterLength(1).setName("not"),eU=oe(tt,"^^").setParameterLength(2).setName("xor"),tU=oe(tt,"&").setParameterLength(2).setName("bitAnd"),nU=oe(tt,"~").setParameterLength(1).setName("bitNot"),rU=oe(tt,"|").setParameterLength(2).setName("bitOr"),sU=oe(tt,"^").setParameterLength(2).setName("bitXor"),iU=oe(tt,"<<").setParameterLength(2).setName("shiftLeft"),oU=oe(tt,">>").setParameterLength(2).setName("shiftRight"),aU=Y(([n])=>(n.addAssign(1),n)),lU=Y(([n])=>(n.subAssign(1),n)),cU=Y(([n])=>{const e=ze(n).toConst();return n.addAssign(1),e}),uU=Y(([n])=>{const e=ze(n).toConst();return n.subAssign(1),e});H("add",Zt);H("sub",Ut);H("mul",Te);H("div",nr);H("mod",Pm);H("equal",lw);H("notEqual",WO);H("lessThan",qO);H("greaterThan",XO);H("lessThanEqual",KO);H("greaterThanEqual",YO);H("and",QO);H("or",ZO);H("not",JO);H("xor",eU);H("bitAnd",tU);H("bitNot",nU);H("bitOr",rU);H("bitXor",sU);H("shiftLeft",iU);H("shiftRight",oU);H("incrementBefore",aU);H("decrementBefore",lU);H("increment",cU);H("decrement",uU);const dU=(n,e)=>(ie('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Pm(ze(n),ze(e)));H("modInt",dU);class V extends _t{static get type(){return"MathNode"}constructor(e,t,r=null,s=null){if(super(),(e===V.MAX||e===V.MIN)&&arguments.length>3){let i=new V(e,t,r);for(let o=2;o<arguments.length-1;o++)i=new V(e,i,arguments[o]);t=i,r=arguments[arguments.length-1],s=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=s,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(r)?0:e.getTypeLength(r),a=e.isMatrix(s)?0:e.getTypeLength(s);return i>o&&i>a?t:o>a?r:a>i?s:t}getNodeType(e){const t=this.method;return t===V.LENGTH||t===V.DISTANCE||t===V.DOT?"float":t===V.CROSS?"vec3":t===V.ALL||t===V.ANY?"bool":t===V.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:s}=this;let i=null;if(s===V.ONE_MINUS)i=Ut(1,t);else if(s===V.RECIPROCAL)i=nr(1,t);else if(s===V.DIFFERENCE)i=rn(Ut(t,r));else if(s===V.TRANSFORM_DIRECTION){let o=t,a=r;e.isMatrix(o.getNodeType(e))?a=ve(X(a),0):o=ve(X(o),0);const l=Te(o,a).xyz;i=Jn(l)}return i!==null?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let s=this.method;const i=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,l=this.bNode,c=this.cNode,u=e.renderer.coordinateSystem;if(s===V.NEGATE)return e.format("( - "+a.build(e,o)+" )",i,t);{const d=[];return s===V.CROSS?d.push(a.build(e,i),l.build(e,i)):u===Ac&&s===V.STEP?d.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),l.build(e,o)):u===Ac&&(s===V.MIN||s===V.MAX)?d.push(a.build(e,o),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o)):s===V.REFRACT?d.push(a.build(e,o),l.build(e,o),c.build(e,"float")):s===V.MIX?d.push(a.build(e,o),l.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(u===mu&&s===V.ATAN&&l!==null&&(s="atan2"),e.shaderStage!=="fragment"&&(s===V.DFDX||s===V.DFDY)&&(ie(`TSL: '${s}' is not supported in the ${e.shaderStage} stage.`),s="/*"+s+"*/"),d.push(a.build(e,o)),l!==null&&d.push(l.build(e,o)),c!==null&&d.push(c.build(e,o))),e.format(`${e.getMethod(s,i)}( ${d.join(", ")} )`,i,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}V.ALL="all";V.ANY="any";V.RADIANS="radians";V.DEGREES="degrees";V.EXP="exp";V.EXP2="exp2";V.LOG="log";V.LOG2="log2";V.SQRT="sqrt";V.INVERSE_SQRT="inversesqrt";V.FLOOR="floor";V.CEIL="ceil";V.NORMALIZE="normalize";V.FRACT="fract";V.SIN="sin";V.COS="cos";V.TAN="tan";V.ASIN="asin";V.ACOS="acos";V.ATAN="atan";V.ABS="abs";V.SIGN="sign";V.LENGTH="length";V.NEGATE="negate";V.ONE_MINUS="oneMinus";V.DFDX="dFdx";V.DFDY="dFdy";V.ROUND="round";V.RECIPROCAL="reciprocal";V.TRUNC="trunc";V.FWIDTH="fwidth";V.TRANSPOSE="transpose";V.DETERMINANT="determinant";V.INVERSE="inverse";V.EQUALS="equals";V.MIN="min";V.MAX="max";V.STEP="step";V.REFLECT="reflect";V.DISTANCE="distance";V.DIFFERENCE="difference";V.DOT="dot";V.CROSS="cross";V.POW="pow";V.TRANSFORM_DIRECTION="transformDirection";V.MIX="mix";V.CLAMP="clamp";V.REFRACT="refract";V.SMOOTHSTEP="smoothstep";V.FACEFORWARD="faceforward";const cw=$(1e-6),hU=$(Math.PI),fU=oe(V,V.ALL).setParameterLength(1),pU=oe(V,V.ANY).setParameterLength(1),mU=oe(V,V.RADIANS).setParameterLength(1),gU=oe(V,V.DEGREES).setParameterLength(1),uw=oe(V,V.EXP).setParameterLength(1),Da=oe(V,V.EXP2).setParameterLength(1),dw=oe(V,V.LOG).setParameterLength(1),Cr=oe(V,V.LOG2).setParameterLength(1),Os=oe(V,V.SQRT).setParameterLength(1),xU=oe(V,V.INVERSE_SQRT).setParameterLength(1),Hs=oe(V,V.FLOOR).setParameterLength(1),Dm=oe(V,V.CEIL).setParameterLength(1),Jn=oe(V,V.NORMALIZE).setParameterLength(1),rr=oe(V,V.FRACT).setParameterLength(1),un=oe(V,V.SIN).setParameterLength(1),yr=oe(V,V.COS).setParameterLength(1),yU=oe(V,V.TAN).setParameterLength(1),bU=oe(V,V.ASIN).setParameterLength(1),hw=oe(V,V.ACOS).setParameterLength(1),fw=oe(V,V.ATAN).setParameterLength(1,2),rn=oe(V,V.ABS).setParameterLength(1),Zc=oe(V,V.SIGN).setParameterLength(1),Rr=oe(V,V.LENGTH).setParameterLength(1),vU=oe(V,V.NEGATE).setParameterLength(1),_U=oe(V,V.ONE_MINUS).setParameterLength(1),pw=oe(V,V.DFDX).setParameterLength(1),mw=oe(V,V.DFDY).setParameterLength(1),TU=oe(V,V.ROUND).setParameterLength(1),wU=oe(V,V.RECIPROCAL).setParameterLength(1),SU=oe(V,V.TRUNC).setParameterLength(1),gw=oe(V,V.FWIDTH).setParameterLength(1),NU=oe(V,V.TRANSPOSE).setParameterLength(1),AU=oe(V,V.DETERMINANT).setParameterLength(1),EU=oe(V,V.INVERSE).setParameterLength(1),CU=(n,e)=>(ie('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),lw(n,e)),Ji=oe(V,V.MIN).setParameterLength(2,1/0),vt=oe(V,V.MAX).setParameterLength(2,1/0),xw=oe(V,V.STEP).setParameterLength(2),RU=oe(V,V.REFLECT).setParameterLength(2),MU=oe(V,V.DISTANCE).setParameterLength(2),PU=oe(V,V.DIFFERENCE).setParameterLength(2),eo=oe(V,V.DOT).setParameterLength(2),Ba=oe(V,V.CROSS).setParameterLength(2),Mu=oe(V,V.POW).setParameterLength(2),yw=n=>Te(n,n),DU=n=>Te(n,n,n),bw=n=>Te(n,n,n,n),BU=oe(V,V.TRANSFORM_DIRECTION).setParameterLength(2),kU=n=>Te(Zc(n),Mu(rn(n),1/3)),vw=n=>eo(n,n),We=oe(V,V.MIX).setParameterLength(3),Dr=(n,e=0,t=1)=>J(new V(V.CLAMP,J(n),J(e),J(t))),_w=n=>Dr(n),Tw=oe(V,V.REFRACT).setParameterLength(3),Br=oe(V,V.SMOOTHSTEP).setParameterLength(3),FU=oe(V,V.FACEFORWARD).setParameterLength(3),LU=Y(([n])=>{const r=43758.5453,s=eo(n.xy,ne(12.9898,78.233)),i=Pm(s,hU);return rr(un(i).mul(r))}),IU=(n,e,t)=>We(e,t,n),OU=(n,e,t)=>Br(e,t,n),UU=(n,e)=>xw(e,n),VU=(n,e)=>(ie('TSL: "atan2" is overloaded. Use "atan" instead.'),fw(n,e));H("all",fU);H("any",pU);H("equals",CU);H("radians",mU);H("degrees",gU);H("exp",uw);H("exp2",Da);H("log",dw);H("log2",Cr);H("sqrt",Os);H("inverseSqrt",xU);H("floor",Hs);H("ceil",Dm);H("normalize",Jn);H("fract",rr);H("sin",un);H("cos",yr);H("tan",yU);H("asin",bU);H("acos",hw);H("atan",fw);H("abs",rn);H("sign",Zc);H("length",Rr);H("lengthSq",vw);H("negate",vU);H("oneMinus",_U);H("dFdx",pw);H("dFdy",mw);H("round",TU);H("reciprocal",wU);H("trunc",SU);H("fwidth",gw);H("atan2",VU);H("min",Ji);H("max",vt);H("step",UU);H("reflect",RU);H("distance",MU);H("dot",eo);H("cross",Ba);H("pow",Mu);H("pow2",yw);H("pow3",DU);H("pow4",bw);H("transformDirection",BU);H("mix",IU);H("clamp",Dr);H("refract",Tw);H("smoothstep",OU);H("faceForward",FU);H("difference",PU);H("saturate",_w);H("cbrt",kU);H("transpose",NU);H("determinant",AU);H("inverse",EU);H("rand",LU);class jU extends ae{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const s=t.getNodeType(e);if(r!==null){const i=r.getNodeType(e);if(e.getTypeLength(i)>e.getTypeLength(s))return i}return s}setup(e){const t=this.condNode,r=this.ifNode.isolate(),s=this.elseNode?this.elseNode.isolate():null,i=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=i,s!==null&&(e.getDataFromNode(s).parentNodeBlock=i);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?r:r.context({nodeBlock:r}),a.elseNode=s?o?s:s.context({nodeBlock:s}):null}generate(e,t){const r=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:i,ifNode:o,elseNode:a}=e.getNodeProperties(this),l=e.currentFunctionNode,c=t!=="void",u=c?rs(r).build(e):"";s.nodeProperty=u;const d=i.build(e,"bool");if(e.context.uniformFlow&&a!==null){const p=o.build(e,r),m=a.build(e,r),y=e.getTernary(d,p,m);return e.format(y,r,t)}e.addFlowCode(`
${e.tab}if ( ${d} ) {

`).addFlowTab();let f=o.build(e,r);if(f&&(c?f=u+" = "+f+";":(f="return "+f+";",l===null&&(ie("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),f="// "+f))),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let p=a.build(e,r);p&&(c?p=u+" = "+p+";":(p="return "+p+";",l===null&&(ie("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),p="// "+p))),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,r,t)}}const Ct=Be(jU).setParameterLength(2,3);H("select",Ct);class ww extends ae{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const r=e.addContext(this.value),s=this.node.build(e,t);return e.setContext(r),s}}const Pu=Be(ww).setParameterLength(1,2),GU=n=>Pu(n,{uniformFlow:!0}),Sw=(n,e)=>Pu(n,{nodeName:e});function $U(n,e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),Sw(n,e)}H("context",Pu);H("label",$U);H("uniformFlow",GU);H("setName",Sw);class gc extends ae{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){let r=e.getNodeProperties(this).assign;return r!==!0&&this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop&&(r=!0),r}build(...e){const t=e[0];return this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)&&t.getBaseStack().addToStack(this),this.intent===!0&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:r,readOnly:s}=this,{renderer:i}=e,o=i.backend.isWebGPUBackend===!0;let a=!1,l=!1;s&&(a=e.isDeterministic(t),l=o?s:a);const c=this.getNodeType(e);if(c=="void")return this.intent!==!0&&se('TSL: ".toVar()" can not be used with void type.'),t.build(e);const u=e.getVectorType(c),d=t.build(e,u),h=e.getVarFromNode(this,r,u,void 0,l),f=e.getPropertyName(h);let p=f;if(l)if(o)p=a?`const ${f}`:`let ${f}`;else{const m=t.getArrayCount(e);p=`const ${e.getVar(h.type,f,m)}`}return e.addLineFlowCode(`${p} = ${d}`,this),f}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const Bm=Be(gc),zU=(n,e=null)=>Bm(n,e).toStack(),HU=(n,e=null)=>Bm(n,e,!0).toStack(),WU=n=>Bm(n).setIntent(!0).toStack();H("toVar",zU);H("toConst",HU);H("toVarIntent",WU);class qU extends ae{static get type(){return"SubBuild"}constructor(e,t,r=null){super(r),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const r=this.node.build(e,...t);return e.removeSubBuild(),r}}const ha=(n,e,t=null)=>J(new qU(J(n),e,t));class XU extends ae{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(r===void 0){const s=this.name,i=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,s,i,o,a),t.node=ha(this.node,"VERTEX")}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Cl.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Cl.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),r=e.getNodeProperties(this),s=this.setupVarying(e);if(r[t]===void 0){const i=this.getNodeType(e),o=e.getPropertyName(s,Cl.VERTEX);e.flowNodeFromShaderStage(Cl.VERTEX,r.node,i,o),r[t]=o}return e.getPropertyName(s)}}const ls=Be(XU).setParameterLength(1,2),KU=n=>ls(n);H("toVarying",ls);H("toVertexStage",KU);H("varying",(...n)=>(ie("TSL: .varying() has been renamed to .toVarying()."),ls(...n)));H("vertexStage",(...n)=>(ie("TSL: .vertexStage() has been renamed to .toVertexStage()."),ls(...n)));const YU=Y(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),r=n.lessThanEqual(.04045);return We(e,t,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),QU=Y(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),r=n.lessThanEqual(.0031308);return We(e,t,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),km="WorkingColorSpace",ZU="OutputColorSpace";class Nw extends _t{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===km?pt.workingColorSpace:t===ZU?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let i=t;return pt.enabled===!1||r===s||!r||!s||(pt.getTransfer(r)===be&&(i=ve(YU(i.rgb),i.a)),pt.getPrimaries(r)!==pt.getPrimaries(s)&&(i=ve($t(pt._getMatrix(new qa,r,s)).mul(i.rgb),i.a)),pt.getTransfer(s)===be&&(i=ve(QU(i.rgb),i.a))),i}}const JU=(n,e)=>J(new Nw(J(n),km,e)),Fm=(n,e)=>J(new Nw(J(n),e,km));H("workingToColorSpace",JU);H("colorSpaceToWorking",Fm);let e5=class extends Ja{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,r,s)}};class Aw extends ae{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,s=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=s,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=_e.OBJECT}setGroup(e){return this.group=e,this}element(e){return J(new e5(this,J(e)))}setNodeType(e){const t=pe(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let s=1;s<t.length;s++)r=r[t[s]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const t5=(n,e,t)=>J(new Aw(n,e,t));class n5 extends Aw{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(fe)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const r5=(n,e,t=null)=>J(new n5(n,e,t));class s5 extends _t{static get type(){return"ToneMappingNode"}constructor(e,t=o5,r=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return ca(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,r=this._toneMapping;if(r===Fs)return t;let s=null;const i=e.renderer.library.getToneMappingFunction(r);return i!==null?s=ve(i(t.rgb,this.exposureNode),t.a):(se("ToneMappingNode: Unsupported Tone Mapping configuration.",r),s=t),s}}const i5=(n,e,t)=>J(new s5(n,J(e),J(t))),o5=r5("toneMappingExposure","float");H("toneMapping",(n,e,t)=>i5(e,t,n));class a5 extends _m{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=s,this.usage=rC,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),r=this.value,s=e.getTypeLength(t),i=this.bufferStride||s,o=this.bufferOffset,a=r.isInterleavedBuffer===!0?r:new sC(r,i),l=new iC(a,s,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),s=e.getPropertyName(r);let i=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,i=s):i=ls(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const Lm=(n,e=null,t=0,r=0)=>J(new a5(n,e,t,r)),l5=(n,e=null,t=0,r=0)=>Lm(n,e,t,r).setUsage(wi),Wx=(n,e=null,t=0,r=0)=>Lm(n,e,t,r).setInstanced(!0),qx=(n,e=null,t=0,r=0)=>l5(n,e,t,r).setInstanced(!0);H("toAttribute",n=>Lm(n.value));class c5 extends ae{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=_e.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const r=e.getNodeProperties(this);r.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if(r==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s,this)}else{const i=e.getNodeProperties(this).outputComputeNode;if(i)return i.build(e,t)}}}const Ew=(n,e=[64])=>{(e.length===0||e.length>3)&&se("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const r=e[t];(typeof r!="number"||r<=0||!Number.isInteger(r))&&se(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return J(new c5(J(n),e))},u5=(n,e,t)=>Ew(n,t).setCount(e);H("compute",u5);H("computeKernel",Ew);class d5 extends ae{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.getNodeType(e);return e.setCache(t),s}build(e,...t){const r=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const i=this.node.build(e,...t);return e.setCache(r),i}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const fa=n=>new d5(J(n));function h5(n,e=!0){return ie('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),fa(n).setParent(e)}H("cache",h5);H("isolate",fa);class f5 extends ae{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const p5=Be(f5).setParameterLength(2);H("bypass",p5);class Cw extends ae{static get type(){return"RemapNode"}constructor(e,t,r,s=$(0),i=$(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=s,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:s,outHighNode:i,doClamp:o}=this;let a=e.sub(t).div(r.sub(t));return o===!0&&(a=a.clamp()),a.mul(i.sub(s)).add(s)}}const m5=Be(Cw,null,null,{doClamp:!1}).setParameterLength(3,5),g5=Be(Cw).setParameterLength(3,5);H("remap",m5);H("remapClamp",g5);class xc extends ae{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),s=this.snippet;if(r==="void")e.addLineFlowCode(s,this);else return e.format(s,r,t)}}const to=Be(xc).setParameterLength(1,2),x5=n=>(n?Ct(n,to("discard")):to("discard")).toStack();H("discard",x5);class y5 extends _t{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const r=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Fs,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Hi;return r!==Fs&&(t=t.toneMapping(r)),s!==Hi&&s!==pt.workingColorSpace&&(t=t.workingToColorSpace(s)),t}}const b5=(n,e=null,t=null)=>J(new y5(J(n),e,t));H("renderOutput",b5);class v5 extends _t{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),s="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(s.length);let o="";return o+="// #"+s+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+r+` /* ... */
`,o+="// #"+i+`#
`,t!==null?t(e,o):oC(o),r}}const _5=(n,e=null)=>J(new v5(J(n),e)).toStack();H("debug",_5);class Rw{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class T5 extends ae{static get type(){return"InspectorNode"}constructor(e,t="",r=null){super(),this.node=e,this.name=t,this.callback=r,this.updateType=_e.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==Rw&&ft('TSL: ".toInspector()" is only available with WebGPU.'),t}}function w5(n,e="",t=null){return n=J(n),n.before(new T5(n,e,t))}H("toInspector",w5);class Mw extends ae{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const s=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(s)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(i),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,r):ls(this).build(e,r)}else return ie(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const is=(n,e=null)=>J(new Mw(n,e)),fo=(n=0)=>is("uv"+(n>0?n:""),"vec2");class S5 extends ae{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),s=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${s} )`,this.getNodeType(e),t)}}const Ws=Be(S5).setParameterLength(1,2);class N5 extends el{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=_e.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&r.width!==void 0){const{width:s,height:i}=r;this.value=Math.log2(Math.max(s,i))}}}const A5=Be(N5).setParameterLength(1),Pw=new jp;class po extends el{static get type(){return"TextureNode"}constructor(e=Pw,t=null,r=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=_e.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===mt?"uvec4":this.value.type===Ot?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return fo(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=pe(this.value.matrix)),this._matrixUniform.mul(X(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=pe(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(ze(Ws(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||r.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const s=Y(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?_e.OBJECT:_e.NONE,o})();let i=this.levelNode;i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,r,s,i,o,a,l,c){const u=this.value;let d;return i?d=e.generateTextureBias(u,t,r,i,o,c):l?d=e.generateTextureGrad(u,t,r,l,o,c):a?d=e.generateTextureCompare(u,t,r,a,o,c):this.sampler===!1?d=e.generateTextureLoad(u,t,r,s,o,c):s?d=e.generateTextureLevel(u,t,r,s,o,c):d=e.generateTexture(u,t,r,o,c),d}generate(e,t){const r=this.value,s=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:u,levelNode:d,biasNode:h,compareNode:f,depthNode:p,gradNode:m,offsetNode:y}=s,x=this.generateUV(e,u),b=d?d.build(e,"float"):null,v=h?h.build(e,"float"):null,_=p?p.build(e,"int"):null,w=f?f.build(e,"float"):null,T=m?[m[0].build(e,"vec2"),m[1].build(e,"vec2")]:null,N=y?this.generateOffset(e,y):null,S=e.getVarFromNode(this);a=e.getPropertyName(S);const C=this.generateSnippet(e,i,x,b,v,_,w,T,N);e.addLineFlowCode(`${a} = ${C}`,this),o.snippet=C,o.propertyName=a}let l=a;const c=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(l=Fm(to(l,c),r.colorSpace).setup(e).build(e,c)),e.format(l,c,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return ie("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=J(e),t.referenceNode=this.getBase(),J(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=J(e).mul(A5(t)),t.referenceNode=this.getBase();const r=t.value;return t.generateMipmaps===!1&&(r&&r.generateMipmaps===!1||r.minFilter===Cn||r.magFilter===Cn)&&(ie("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),J(t)}level(e){const t=this.clone();return t.levelNode=J(e),t.referenceNode=this.getBase(),J(t)}size(e){return Ws(this,e)}bias(e){const t=this.clone();return t.biasNode=J(e),t.referenceNode=this.getBase(),J(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=J(e),t.referenceNode=this.getBase(),J(t)}grad(e,t){const r=this.clone();return r.gradNode=[J(e),J(t)],r.referenceNode=this.getBase(),J(r)}depth(e){const t=this.clone();return t.depthNode=J(e),t.referenceNode=this.getBase(),J(t)}offset(e){const t=this.clone();return t.offsetNode=J(e),t.referenceNode=this.getBase(),J(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const r=this._flipYUniform;r!==null&&(r.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const E5=Be(po).setParameterLength(1,4).setName("texture"),Ce=(n=Pw,e=null,t=null,r=null)=>{let s;return n&&n.isTextureNode===!0?(s=J(n.clone()),s.referenceNode=n.getBase(),e!==null&&(s.uvNode=J(e)),t!==null&&(s.levelNode=J(t)),r!==null&&(s.biasNode=J(r))):s=E5(n,e,t,r),s},cn=(...n)=>Ce(...n).setSampler(!1);class Dw extends el{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Bw=(n,e,t)=>J(new Dw(n,e,t));class C5 extends Ja{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),s=this.node.getPaddedType();return e.format(t,s,r)}}class R5 extends Dw{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Wc(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=_e.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if(r==="float"||r==="int"||r==="uint")for(let s=0;s<e.length;s++){const i=s*4;t[i]=e[s]}else if(r==="color")for(let s=0;s<e.length;s++){const i=s*4,o=e[s];t[i]=o.r,t[i+1]=o.g,t[i+2]=o.b||0}else if(r==="mat2")for(let s=0;s<e.length;s++){const i=s*4,o=e[s];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+3]=o.elements[3]}else if(r==="mat3")for(let s=0;s<e.length;s++){const i=s*16,o=e[s];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+4]=o.elements[3],t[i+5]=o.elements[4],t[i+6]=o.elements[5],t[i+8]=o.elements[6],t[i+9]=o.elements[7],t[i+10]=o.elements[8],t[i+15]=1}else if(r==="mat4")for(let s=0;s<e.length;s++){const i=s*16,o=e[s];for(let a=0;a<o.elements.length;a++)t[i+a]=o.elements[a]}else for(let s=0;s<e.length;s++){const i=s*4,o=e[s];t[i]=o.x,t[i+1]=o.y,t[i+2]=o.z||0,t[i+3]=o.w||0}}setup(e){const t=this.array.length,r=this.elementType;let s=Float32Array;const i=this.paddedType,o=e.getTypeLength(i);return r.charAt(0)==="i"&&(s=Int32Array),r.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(t*o),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return J(new C5(this,J(e)))}}const Mn=(n,e)=>J(new R5(n,e));class M5 extends ae{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const tl=Be(M5).setParameterLength(1);let ko,Fo;class Ge extends ae{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Ge.DPR?"float":this.scope===Ge.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=_e.NONE;return(this.scope===Ge.SIZE||this.scope===Ge.VIEWPORT||this.scope===Ge.DPR)&&(e=_e.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Ge.VIEWPORT?t!==null?Fo.copy(t.viewport):(e.getViewport(Fo),Fo.multiplyScalar(e.getPixelRatio())):this.scope===Ge.DPR?this._output.value=e.getPixelRatio():t!==null?(ko.width=t.width,ko.height=t.height):e.getDrawingBufferSize(ko)}setup(){const e=this.scope;let t=null;return e===Ge.SIZE?t=pe(ko||(ko=new we)):e===Ge.VIEWPORT?t=pe(Fo||(Fo=new et)):e===Ge.DPR?t=pe(1):t=ne(Du.div(Hf)),this._output=t,t}generate(e){if(this.scope===Ge.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(Hf).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}Ge.COORDINATE="coordinate";Ge.VIEWPORT="viewport";Ge.SIZE="size";Ge.UV="uv";Ge.DPR="dpr";const P5=re(Ge,Ge.DPR),Gi=re(Ge,Ge.UV),Hf=re(Ge,Ge.SIZE),Du=re(Ge,Ge.COORDINATE),kw=re(Ge,Ge.VIEWPORT),D5=kw.zw;kw.xy;const Im=pe(0,"uint").setName("u_cameraIndex").setGroup(Mm("cameraIndex")).toVarying("v_cameraIndex"),Ms=pe("float").setName("cameraNear").setGroup(fe).onRenderUpdate(({camera:n})=>n.near),Ps=pe("float").setName("cameraFar").setGroup(fe).onRenderUpdate(({camera:n})=>n.far),Fw=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const s of n.cameras)t.push(s.projectionMatrix);e=Mn(t).setGroup(fe).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?tl("gl_ViewID_OVR"):Im).toConst("cameraProjectionMatrix")}else e=pe("mat4").setName("cameraProjectionMatrix").setGroup(fe).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),Lr=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const s of n.cameras)t.push(s.matrixWorldInverse);e=Mn(t).setGroup(fe).setName("cameraViewMatrices").element(n.isMultiViewCamera?tl("gl_ViewID_OVR"):Im).toConst("cameraViewMatrix")}else e=pe("mat4").setName("cameraViewMatrix").setGroup(fe).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),B5=Y(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let s=0,i=n.cameras.length;s<i;s++)t.push(new ce);e=Mn(t).setGroup(fe).setName("cameraPositions").onRenderUpdate(({camera:s},i)=>{const o=s.cameras,a=i.array;for(let l=0,c=o.length;l<c;l++)a[l].setFromMatrixPosition(o[l].matrixWorld)}).element(n.isMultiViewCamera?tl("gl_ViewID_OVR"):Im).toConst("cameraPosition")}else e=pe(new ce).setName("cameraPosition").setGroup(fe).onRenderUpdate(({camera:t},r)=>r.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),Xx=new Q2;class Oe extends ae{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=_e.OBJECT,this.uniformNode=new el(null)}getNodeType(){const e=this.scope;if(e===Oe.WORLD_MATRIX)return"mat4";if(e===Oe.POSITION||e===Oe.VIEW_POSITION||e===Oe.DIRECTION||e===Oe.SCALE)return"vec3";if(e===Oe.RADIUS)return"float"}update(e){const t=this.object3d,r=this.uniformNode,s=this.scope;if(s===Oe.WORLD_MATRIX)r.value=t.matrixWorld;else if(s===Oe.POSITION)r.value=r.value||new ce,r.value.setFromMatrixPosition(t.matrixWorld);else if(s===Oe.SCALE)r.value=r.value||new ce,r.value.setFromMatrixScale(t.matrixWorld);else if(s===Oe.DIRECTION)r.value=r.value||new ce,t.getWorldDirection(r.value);else if(s===Oe.VIEW_POSITION){const i=e.camera;r.value=r.value||new ce,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(i.matrixWorldInverse)}else if(s===Oe.RADIUS){const i=e.object.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Xx.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),r.value=Xx.radius}}generate(e){const t=this.scope;return t===Oe.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Oe.POSITION||t===Oe.VIEW_POSITION||t===Oe.DIRECTION||t===Oe.SCALE?this.uniformNode.nodeType="vec3":t===Oe.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Oe.WORLD_MATRIX="worldMatrix";Oe.POSITION="position";Oe.SCALE="scale";Oe.VIEW_POSITION="viewPosition";Oe.DIRECTION="direction";Oe.RADIUS="radius";const k5=Be(Oe,Oe.POSITION).setParameterLength(1);class bn extends Oe{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}bn.DIRECTION;const Js=re(bn,bn.WORLD_MATRIX);bn.POSITION;bn.SCALE;bn.VIEW_POSITION;bn.RADIUS;const F5=pe(new qa).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),Bu=Y(n=>n.renderer.overrideNodes.modelViewMatrix||L5).once()().toVar("modelViewMatrix"),L5=Lr.mul(Js),Kx=Y(n=>(n.context.isHighPrecisionModelViewMatrix=!0,pe("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),Yx=Y(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return pe("mat3").onObjectUpdate(({object:t,camera:r})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),ku=is("position","vec3"),kt=ku.toVarying("positionLocal"),Qx=ku.toVarying("positionPrevious"),no=Y(n=>Js.mul(kt).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),Lw=Y(()=>kt.transformDirection(Js).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ct=Y(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Qe=Y(n=>{let e;return n.camera.isOrthographicCamera?e=X(0,0,1):e=ct.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class I5 extends ae{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===Qt?"false":e.getFrontFacing()}}const O5=re(I5),Iw=$(O5).mul(2).sub(1),nl=Y(([n],{material:e})=>{const t=e.side;return t===Qt?n=n.mul(-1):t===js&&(n=n.mul(Iw)),n}),Ow=is("normal","vec3"),sr=Y(n=>n.geometry.hasAttribute("normal")===!1?(ie('TSL: Vertex attribute "normal" not found on geometry.'),X(0,1,0)):Ow,"vec3").once()().toVar("normalLocal"),U5=ct.dFdx().cross(ct.dFdy()).normalize().toVar("normalFlat"),ka=Y(n=>{let e;return n.material.flatShading===!0?e=U5:e=Uw(sr).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),V5=Y(n=>{let e=ka.transformDirection(Lr);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Le=Y(({subBuildFn:n,material:e,context:t})=>{let r;return n==="NORMAL"||n==="VERTEX"?(r=ka,e.flatShading!==!0&&(r=nl(r))):r=t.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),mo=Le.transformDirection(Lr).toVar("normalWorld"),Ei=Y(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=Le:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),j5=Y(([n,e=Js])=>{const t=$t(e),r=n.div(X(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(r).xyz}),Uw=Y(([n],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const r=F5.mul(n);return Lr.transformDirection(r)});Y(()=>(ie('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Le)).once(["NORMAL","VERTEX"])();Y(()=>(ie('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),mo)).once(["NORMAL","VERTEX"])();Y(()=>(ie('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Ei)).once(["NORMAL","VERTEX"])();const Zx=new k_,Pd=new In,G5=pe(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),Dd=pe(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),Vw=pe(new In).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(Zx.copy(t),Pd.makeRotationFromEuler(Zx)):Pd.identity(),Pd}),$5=Qe.negate().reflect(Le),z5=Qe.negate().refract(Le,G5),H5=$5.transformDirection(Lr).toVar("reflectVector"),W5=z5.transformDirection(Lr).toVar("reflectVector"),q5=new Vp;class X5 extends po{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,s=null){super(e,t,r,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Dc?H5:e.mapping===Bc?W5:(se('CubeTextureNode: Mapping "%s" not supported.',e.mapping),X(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return(e.renderer.coordinateSystem===mu||!r.isRenderTargetTexture)&&(t=X(t.x.negate(),t.yz)),Vw.mul(t)}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const K5=Be(X5).setParameterLength(1,4).setName("cubeTexture"),Fa=(n=q5,e=null,t=null,r=null)=>{let s;return n&&n.isCubeTextureNode===!0?(s=J(n.clone()),s.referenceNode=n,e!==null&&(s.uvNode=J(e)),t!==null&&(s.levelNode=J(t)),r!==null&&(s.biasNode=J(r))):s=K5(n,e,t,r),s};class Y5 extends Ja{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,r,s)}}class Om extends ae{static get type(){return"ReferenceNode"}constructor(e,t,r=null,s=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=s,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=_e.OBJECT}element(e){return J(new Y5(this,J(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return ie('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=Bw(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Mn(null,e):e==="texture"?t=Ce(null):e==="cubeTexture"?t=Fa(null):t=pe(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let s=1;s<t.length;s++)r=r[t[s]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Ve=(n,e,t)=>J(new Om(n,e,t)),Jx=(n,e,t,r)=>J(new Om(n,e,r,t));class Q5 extends Om{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const qr=(n,e,t=null)=>J(new Q5(n,e,t)),jw=fo(),Z5=ct.dFdx(),J5=ct.dFdy(),Gw=jw.dFdx(),$w=jw.dFdy(),zw=Le,Hw=J5.cross(zw),Ww=zw.cross(Z5),Wf=Hw.mul(Gw.x).add(Ww.mul($w.x)),qf=Hw.mul(Gw.y).add(Ww.mul($w.y)),ey=Wf.dot(Wf).max(qf.dot(qf)),qw=ey.equal(0).select(0,ey.inverseSqrt()),e4=Wf.mul(qw).toVar("tangentViewFrame"),t4=qf.mul(qw).toVar("bitangentViewFrame"),Xw=Y(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),is("tangent","vec4")))(),Um=Xw.xyz.toVar("tangentLocal"),Kw=Y(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Bu.mul(ve(Um,0)).xyz.toVarying("v_tangentView").normalize():r=e4,t.flatShading!==!0&&(r=nl(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),n4=Y(([n,e],{subBuildFn:t,material:r})=>{let s=n.mul(Xw.w).xyz;return t==="NORMAL"&&r.flatShading!==!0&&(s=s.toVarying(e)),s}).once(["NORMAL"]),r4=Y(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=n4(Le.cross(Kw),"v_bitangentView").normalize():r=t4,t.flatShading!==!0&&(r=nl(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),ea=$t(Kw,r4,Le).toVar("TBNViewMatrix"),s4=Y(()=>{let n=ji.cross(Qe);return n=n.cross(ji).normalize(),n=We(n,Le,Es.mul(Tr.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()();class i4 extends _t{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=qg}setup({material:e}){const{normalMapType:t,scaleNode:r}=this;let s=this.node.mul(2).sub(1);if(r!==null){let o=r;e.flatShading===!0&&(o=nl(o)),s=X(s.xy.mul(o),s.z)}let i=null;return t===Z2?i=Uw(s):t===qg?i=ea.mul(s).normalize():(se(`NodeMaterial: Unsupported normal map type: ${t}`),i=Le),i}}const ty=Be(i4).setParameterLength(1,2),o4=Y(({textureNode:n,bumpScale:e})=>{const t=s=>n.isolate().context({getUV:i=>s(i.uvNode||fo()),forceUVContext:!0}),r=$(t(s=>s));return ne($(t(s=>s.add(s.dFdx()))).sub(r),$(t(s=>s.add(s.dFdy()))).sub(r)).mul(e)}),a4=Y(n=>{const{surf_pos:e,surf_norm:t,dHdxy:r}=n,s=e.dFdx().normalize(),i=e.dFdy().normalize(),o=t,a=i.cross(o),l=o.cross(s),c=s.dot(a).mul(Iw),u=c.sign().mul(r.x.mul(a).add(r.y.mul(l)));return c.abs().mul(t).sub(u).normalize()});class l4 extends _t{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=o4({textureNode:this.textureNode,bumpScale:e});return a4({surf_pos:ct,surf_norm:Le,dHdxy:t})}}const c4=Be(l4).setParameterLength(1,2),ny=new Map;class q extends ae{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=ny.get(e);return r===void 0&&(r=qr(e,t),ny.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let s=null;if(r===q.COLOR){const i=t.color!==void 0?this.getColor(r):X();t.map&&t.map.isTexture===!0?s=i.mul(this.getTexture("map")):s=i}else if(r===q.OPACITY){const i=this.getFloat(r);t.alphaMap&&t.alphaMap.isTexture===!0?s=i.mul(this.getTexture("alpha")):s=i}else if(r===q.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=$(1);else if(r===q.SPECULAR_INTENSITY){const i=this.getFloat(r);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?s=i.mul(this.getTexture(r).a):s=i}else if(r===q.SPECULAR_COLOR){const i=this.getColor(r);t.specularColorMap&&t.specularColorMap.isTexture===!0?s=i.mul(this.getTexture(r).rgb):s=i}else if(r===q.ROUGHNESS){const i=this.getFloat(r);t.roughnessMap&&t.roughnessMap.isTexture===!0?s=i.mul(this.getTexture(r).g):s=i}else if(r===q.METALNESS){const i=this.getFloat(r);t.metalnessMap&&t.metalnessMap.isTexture===!0?s=i.mul(this.getTexture(r).b):s=i}else if(r===q.EMISSIVE){const i=this.getFloat("emissiveIntensity"),o=this.getColor(r).mul(i);t.emissiveMap&&t.emissiveMap.isTexture===!0?s=o.mul(this.getTexture(r)):s=o}else if(r===q.NORMAL)t.normalMap?(s=ty(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=t.normalMapType):t.bumpMap?s=c4(this.getTexture("bump").r,this.getFloat("bumpScale")):s=Le;else if(r===q.CLEARCOAT){const i=this.getFloat(r);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?s=i.mul(this.getTexture(r).r):s=i}else if(r===q.CLEARCOAT_ROUGHNESS){const i=this.getFloat(r);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?s=i.mul(this.getTexture(r).r):s=i}else if(r===q.CLEARCOAT_NORMAL)t.clearcoatNormalMap?s=ty(this.getTexture(r),this.getCache(r+"Scale","vec2")):s=Le;else if(r===q.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?s=i.mul(this.getTexture("sheenColor").rgb):s=i}else if(r===q.SHEEN_ROUGHNESS){const i=this.getFloat(r);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?s=i.mul(this.getTexture(r).a):s=i,s=s.clamp(.07,1)}else if(r===q.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const i=this.getTexture(r);s=Em(Lo.x,Lo.y,Lo.y.negate(),Lo.x).mul(i.rg.mul(2).sub(ne(1)).normalize().mul(i.b))}else s=Lo;else if(r===q.IRIDESCENCE_THICKNESS){const i=Ve("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Ve("0","float",t.iridescenceThicknessRange);s=i.sub(o).mul(this.getTexture(r).g).add(o)}else s=i}else if(r===q.TRANSMISSION){const i=this.getFloat(r);t.transmissionMap?s=i.mul(this.getTexture(r).r):s=i}else if(r===q.THICKNESS){const i=this.getFloat(r);t.thicknessMap?s=i.mul(this.getTexture(r).g):s=i}else if(r===q.IOR)s=this.getFloat(r);else if(r===q.LIGHT_MAP)s=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===q.AO)s=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===q.LINE_DASH_OFFSET)s=t.dashOffset?this.getFloat(r):$(0);else{const i=this.getNodeType(e);s=this.getCache(r,i)}return s}}q.ALPHA_TEST="alphaTest";q.COLOR="color";q.OPACITY="opacity";q.SHININESS="shininess";q.SPECULAR="specular";q.SPECULAR_STRENGTH="specularStrength";q.SPECULAR_INTENSITY="specularIntensity";q.SPECULAR_COLOR="specularColor";q.REFLECTIVITY="reflectivity";q.ROUGHNESS="roughness";q.METALNESS="metalness";q.NORMAL="normal";q.CLEARCOAT="clearcoat";q.CLEARCOAT_ROUGHNESS="clearcoatRoughness";q.CLEARCOAT_NORMAL="clearcoatNormal";q.EMISSIVE="emissive";q.ROTATION="rotation";q.SHEEN="sheen";q.SHEEN_ROUGHNESS="sheenRoughness";q.ANISOTROPY="anisotropy";q.IRIDESCENCE="iridescence";q.IRIDESCENCE_IOR="iridescenceIOR";q.IRIDESCENCE_THICKNESS="iridescenceThickness";q.IOR="ior";q.TRANSMISSION="transmission";q.THICKNESS="thickness";q.ATTENUATION_DISTANCE="attenuationDistance";q.ATTENUATION_COLOR="attenuationColor";q.LINE_SCALE="scale";q.LINE_DASH_SIZE="dashSize";q.LINE_GAP_SIZE="gapSize";q.LINE_WIDTH="linewidth";q.LINE_DASH_OFFSET="dashOffset";q.POINT_SIZE="size";q.DISPERSION="dispersion";q.LIGHT_MAP="light";q.AO="ao";const u4=re(q,q.ALPHA_TEST),d4=re(q,q.COLOR),h4=re(q,q.SHININESS),f4=re(q,q.EMISSIVE),Yw=re(q,q.OPACITY),p4=re(q,q.SPECULAR),ry=re(q,q.SPECULAR_INTENSITY),m4=re(q,q.SPECULAR_COLOR),yc=re(q,q.SPECULAR_STRENGTH),Bd=re(q,q.REFLECTIVITY),g4=re(q,q.ROUGHNESS),x4=re(q,q.METALNESS),y4=re(q,q.NORMAL),b4=re(q,q.CLEARCOAT),v4=re(q,q.CLEARCOAT_ROUGHNESS),_4=re(q,q.CLEARCOAT_NORMAL),T4=re(q,q.ROTATION),w4=re(q,q.SHEEN),S4=re(q,q.SHEEN_ROUGHNESS),N4=re(q,q.ANISOTROPY),A4=re(q,q.IRIDESCENCE),E4=re(q,q.IRIDESCENCE_IOR),C4=re(q,q.IRIDESCENCE_THICKNESS),R4=re(q,q.TRANSMISSION),M4=re(q,q.THICKNESS),P4=re(q,q.IOR),D4=re(q,q.ATTENUATION_DISTANCE),B4=re(q,q.ATTENUATION_COLOR),k4=re(q,q.LINE_SCALE),F4=re(q,q.LINE_DASH_SIZE),L4=re(q,q.LINE_GAP_SIZE);q.LINE_WIDTH;const I4=re(q,q.LINE_DASH_OFFSET),O4=re(q,q.POINT_SIZE),U4=re(q,q.DISPERSION),Qw=re(q,q.LIGHT_MAP),V4=re(q,q.AO),Lo=pe(new we).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),Zw=Y(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class qe extends ae{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let s;if(r===qe.VERTEX)s=e.getVertexIndex();else if(r===qe.INSTANCE)s=e.getInstanceIndex();else if(r===qe.DRAW)s=e.getDrawIndex();else if(r===qe.INVOCATION_LOCAL)s=e.getInvocationLocalIndex();else if(r===qe.INVOCATION_SUBGROUP)s=e.getInvocationSubgroupIndex();else if(r===qe.SUBGROUP)s=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=s:i=ls(this).build(e,t),i}}qe.VERTEX="vertex";qe.INSTANCE="instance";qe.SUBGROUP="subgroup";qe.INVOCATION_LOCAL="invocationLocal";qe.INVOCATION_SUBGROUP="invocationSubgroup";qe.DRAW="draw";const j4=re(qe,qe.VERTEX),Vm=re(qe,qe.INSTANCE);qe.SUBGROUP;qe.INVOCATION_SUBGROUP;qe.INVOCATION_LOCAL;const G4=re(qe,qe.DRAW);class $4 extends ae{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=_e.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{instanceMatrix:t,instanceColor:r}=this,{count:s}=t;let{instanceMatrixNode:i,instanceColorNode:o}=this;if(i===null){if(s<=1e3)i=Bw(t.array,"mat4",Math.max(s,1)).element(Vm);else{const l=new J2(t.array,16,1);this.buffer=l;const c=t.usage===wi?qx:Wx,u=[c(l,"vec4",16,0),c(l,"vec4",16,4),c(l,"vec4",16,8),c(l,"vec4",16,12)];i=Vi(...u)}this.instanceMatrixNode=i}if(r&&o===null){const l=new eC(r.array,3),c=r.usage===wi?qx:Wx;this.bufferColor=l,o=X(c(l,"vec3",3,0)),this.instanceColorNode=o}const a=i.mul(kt).xyz;if(kt.assign(a),e.hasGeometryAttribute("normal")){const l=j5(sr,i);sr.assign(l)}this.instanceColorNode!==null&&Xc("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==wi&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==wi&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}class z4 extends $4{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:s}=e;super(t,r,s),this.instancedMesh=e}}const H4=Be(z4).setParameterLength(1);class W4 extends ae{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Vm:this.batchingIdNode=G4);const r=Y(([p])=>{const m=ze(Ws(cn(this.batchMesh._indirectTexture),0).x),y=ze(p).mod(m),x=ze(p).div(m);return cn(this.batchMesh._indirectTexture,xr(y,x)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(ze(this.batchingIdNode)),s=this.batchMesh._matricesTexture,i=ze(Ws(cn(s),0).x),o=$(r).mul(4).toInt().toVar(),a=o.mod(i),l=o.div(i),c=Vi(cn(s,xr(a,l)),cn(s,xr(a.add(1),l)),cn(s,xr(a.add(2),l)),cn(s,xr(a.add(3),l))),u=this.batchMesh._colorsTexture;if(u!==null){const m=Y(([y])=>{const x=ze(Ws(cn(u),0).x),b=y,v=b.mod(x),_=b.div(x);return cn(u,xr(v,_)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(r);Xc("vec3","vBatchColor").assign(m)}const d=$t(c);kt.assign(c.mul(kt));const h=sr.div(X(d[0].dot(d[0]),d[1].dot(d[1]),d[2].dot(d[2]))),f=d.mul(h).xyz;sr.assign(f),e.hasGeometryAttribute("tangent")&&Um.mulAssign(d)}}const q4=Be(W4).setParameterLength(1),sy=new WeakMap;class X4 extends ae{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=_e.OBJECT,this.skinIndexNode=is("skinIndex","uvec4"),this.skinWeightNode=is("skinWeight","vec4"),this.bindMatrixNode=Ve("bindMatrix","mat4"),this.bindMatrixInverseNode=Ve("bindMatrixInverse","mat4"),this.boneMatricesNode=Jx("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=kt,this.toPositionNode=kt,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:s,bindMatrixNode:i,bindMatrixInverseNode:o}=this,a=e.element(r.x),l=e.element(r.y),c=e.element(r.z),u=e.element(r.w),d=i.mul(t),h=Zt(a.mul(s.x).mul(d),l.mul(s.y).mul(d),c.mul(s.z).mul(d),u.mul(s.w).mul(d));return o.mul(h).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=sr){const{skinIndexNode:r,skinWeightNode:s,bindMatrixNode:i,bindMatrixInverseNode:o}=this,a=e.element(r.x),l=e.element(r.y),c=e.element(r.z),u=e.element(r.w);let d=Zt(s.x.mul(a),s.y.mul(l),s.z.mul(c),s.w.mul(u));return d=o.mul(d).mul(i),d.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=Jx("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Qx)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||X1(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&Qx.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const r=this.getSkinnedNormal();sr.assign(r),e.hasGeometryAttribute("tangent")&&Um.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;sy.get(t)!==e.frameId&&(sy.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const K4=n=>J(new X4(n));class Y4 extends ae{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const r={};for(let a=0,l=this.params.length-1;a<l;a++){const c=this.params[a],u=c.isNode!==!0&&c.name||this.getVarName(a),d=c.isNode!==!0&&c.type||"int";r[u]=to(u,d)}const s=e.addStack(),i=this.params[this.params.length-1](r);t.returnsNode=i.context({nodeLoop:i}),t.stackNode=s;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const a=Y(this.params[0].update)(r);t.updateNode=a.context({nodeLoop:a})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),r=this.params,s=t.stackNode;for(let o=0,a=r.length-1;o<a;o++){const l=r[o];let c=!1,u=null,d=null,h=null,f=null,p=null,m=null;l.isNode?l.getNodeType(e)==="bool"?(c=!0,f="bool",d=l.build(e,f)):(f="int",h=this.getVarName(o),u="0",d=l.build(e,f),p="<"):(f=l.type||"int",h=l.name||this.getVarName(o),u=l.start,d=l.end,p=l.condition,m=l.update,typeof u=="number"?u=e.generateConst(f,u):u&&u.isNode&&(u=u.build(e,f)),typeof d=="number"?d=e.generateConst(f,d):d&&d.isNode&&(d=d.build(e,f)),u!==void 0&&d===void 0?(u=u+" - 1",d="0",p=">="):d!==void 0&&u===void 0&&(u="0",p="<"),p===void 0&&(Number(u)>Number(d)?p=">=":p="<"));let y;if(c)y=`while ( ${d} )`;else{const x={start:u,end:d},b=x.start,v=x.end;let _;const w=()=>p.includes("<")?"+=":"-=";if(m!=null)switch(typeof m){case"function":_=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":_=h+" "+w()+" "+e.generateConst(f,m);break;case"string":_=h+" "+m;break;default:m.isNode?_=h+" "+w()+" "+m.build(e):(se("TSL: 'Loop( { update: ... } )' is not a function, string or number."),_="break /* invalid update */")}else f==="int"||f==="uint"?m=p.includes("<")?"++":"--":m=w()+" 1.",_=h+" "+m;const T=e.getVar(f,h)+" = "+b,N=h+" "+p+" "+v;y=`for ( ${T}; ${N}; ${_} )`}e.addFlowCode((o===0?`
`:"")+e.tab+y+` {

`).addFlowTab()}const i=s.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+i);for(let o=0,a=this.params.length-1;o<a;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const hn=(...n)=>new Y4(Ui(n,"int")).toStack(),Q4=()=>to("break").toStack(),kd=new WeakMap,tn=new et,iy=Y(({bufferMap:n,influence:e,stride:t,width:r,depth:s,offset:i})=>{const o=ze(j4).mul(t).add(i),a=o.div(r),l=o.sub(a.mul(r));return cn(n,xr(l,a)).depth(s).xyz.mul(e)});function Z4(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,r=n.morphAttributes.color!==void 0,s=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,i=s!==void 0?s.length:0;let o=kd.get(n);if(o===void 0||o.count!==i){let x=function(){m.dispose(),kd.delete(n),n.removeEventListener("dispose",x)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],c=n.morphAttributes.color||[];let u=0;e===!0&&(u=1),t===!0&&(u=2),r===!0&&(u=3);let d=n.attributes.position.count*u,h=1;const f=4096;d>f&&(h=Math.ceil(d/f),d=f);const p=new Float32Array(d*h*4*i),m=new tC(p,d,h,i);m.type=dn,m.needsUpdate=!0;const y=u*4;for(let b=0;b<i;b++){const v=a[b],_=l[b],w=c[b],T=d*h*4*b;for(let N=0;N<v.count;N++){const S=N*y;e===!0&&(tn.fromBufferAttribute(v,N),p[T+S+0]=tn.x,p[T+S+1]=tn.y,p[T+S+2]=tn.z,p[T+S+3]=0),t===!0&&(tn.fromBufferAttribute(_,N),p[T+S+4]=tn.x,p[T+S+5]=tn.y,p[T+S+6]=tn.z,p[T+S+7]=0),r===!0&&(tn.fromBufferAttribute(w,N),p[T+S+8]=tn.x,p[T+S+9]=tn.y,p[T+S+10]=tn.z,p[T+S+11]=w.itemSize===4?tn.w:1)}}o={count:i,texture:m,stride:u,size:new we(d,h)},kd.set(n,o),n.addEventListener("dispose",x)}return o}class J4 extends ae{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=pe(1),this.updateType=_e.OBJECT}setup(e){const{geometry:t}=e,r=t.morphAttributes.position!==void 0,s=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=i!==void 0?i.length:0,{texture:a,stride:l,size:c}=Z4(t);r===!0&&kt.mulAssign(this.morphBaseInfluence),s===!0&&sr.mulAssign(this.morphBaseInfluence);const u=ze(c.width);hn(o,({i:d})=>{const h=$(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?h.assign(cn(this.mesh.morphTexture,xr(ze(d).add(1),ze(Vm))).r):h.assign(Ve("morphTargetInfluences","float").element(d).toVar()),Xe(h.notEqual(0),()=>{r===!0&&kt.addAssign(iy({bufferMap:a,influence:h,stride:l,width:u,depth:d,offset:ze(0)})),s===!0&&sr.addAssign(iy({bufferMap:a,influence:h,stride:l,width:u,depth:d,offset:ze(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,r)=>t+r,0)}}const eV=Be(J4).setParameterLength(1);class go extends ae{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class tV extends go{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class nV extends ww{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,s=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r=X().toVar("directDiffuse"),s=X().toVar("directSpecular"),i=X().toVar("indirectDiffuse"),o=X().toVar("indirectSpecular"),a={directDiffuse:r,directSpecular:s,indirectDiffuse:i,indirectSpecular:o};return{radiance:X().toVar("radiance"),irradiance:X().toVar("irradiance"),iblIrradiance:X().toVar("iblIrradiance"),ambientOcclusion:$(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const rV=Be(nV);class sV extends go{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const mi=new we;class Jw extends po{static get type(){return"ViewportTextureNode"}constructor(e=Gi,t=null,r=null){let s=null;r===null?(s=new e_,s.minFilter=Gs,r=s):s=r,super(r,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=s,this.isOutputTextureNode=!0,this.updateBeforeType=_e.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,r;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,r=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,r=this._cacheTextures),e===null)return t;if(r.has(e)===!1){const s=t.clone();r.set(e,s)}return r.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,r=t.getRenderTarget();r===null?t.getDrawingBufferSize(mi):mi.set(r.width,r.height);const s=this.getTextureForReference(r);(s.image.width!==mi.width||s.image.height!==mi.height)&&(s.image.width=mi.width,s.image.height=mi.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const eS=Be(Jw,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Pl=null;class iV extends Jw{static get type(){return"ViewportDepthTextureNode"}constructor(e=Gi,t=null){Pl===null&&(Pl=new Qn),super(e,t,Pl)}getTextureForReference(){return Pl}}const oV=Be(iV).setParameterLength(0,2);class Xt extends ae{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Xt.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let s=null;if(t===Xt.DEPTH_BASE)r!==null&&(s=rS().assign(r));else if(t===Xt.DEPTH)e.isPerspectiveCamera?s=aV(ct.z,Ms,Ps):s=pa(ct.z,Ms,Ps);else if(t===Xt.LINEAR_DEPTH)if(r!==null)if(e.isPerspectiveCamera){const i=tS(r,Ms,Ps);s=pa(i,Ms,Ps)}else s=r;else s=pa(ct.z,Ms,Ps);return s}}Xt.DEPTH_BASE="depthBase";Xt.DEPTH="depth";Xt.LINEAR_DEPTH="linearDepth";const pa=(n,e,t)=>n.add(e).div(e.sub(t)),aV=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),tS=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),nS=(n,e,t)=>{e=e.max(1e-6).toVar();const r=Cr(n.negate().div(e)),s=Cr(t.div(e));return r.div(s)},rS=Be(Xt,Xt.DEPTH_BASE),sS=re(Xt,Xt.DEPTH),lV=Be(Xt,Xt.LINEAR_DEPTH).setParameterLength(0,1);oV();sS.assign=n=>rS(n);class gn extends ae{static get type(){return"ClippingNode"}constructor(e=gn.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:s}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===gn.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,s):this.scope===gn.HARDWARE?this.setupHardwareClipping(s,e):this.setupDefault(r,s)}setupAlphaToCoverage(e,t){return Y(()=>{const r=$().toVar("distanceToPlane"),s=$().toVar("distanceToGradient"),i=$(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const l=Mn(t).setGroup(fe);hn(o,({i:c})=>{const u=l.element(c);r.assign(ct.dot(u.xyz).negate().add(u.w)),s.assign(r.fwidth().div(2)),i.mulAssign(Br(s.negate(),s,r))})}const a=e.length;if(a>0){const l=Mn(e).setGroup(fe),c=$(1).toVar("intersectionClipOpacity");hn(a,({i:u})=>{const d=l.element(u);r.assign(ct.dot(d.xyz).negate().add(d.w)),s.assign(r.fwidth().div(2)),c.mulAssign(Br(s.negate(),s,r).oneMinus())}),i.mulAssign(c.oneMinus())}Re.a.mulAssign(i),Re.a.equal(0).discard()})()}setupDefault(e,t){return Y(()=>{const r=t.length;if(this.hardwareClipping===!1&&r>0){const i=Mn(t).setGroup(fe);hn(r,({i:o})=>{const a=i.element(o);ct.dot(a.xyz).greaterThan(a.w).discard()})}const s=e.length;if(s>0){const i=Mn(e).setGroup(fe),o=Am(!0).toVar("clipped");hn(s,({i:a})=>{const l=i.element(a);o.assign(ct.dot(l.xyz).greaterThan(l.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),Y(()=>{const s=Mn(e).setGroup(fe),i=tl(t.getClipDistance());hn(r,({i:o})=>{const a=s.element(o),l=ct.dot(a.xyz).sub(a.w).negate();i.element(o).assign(l)})})()}}gn.ALPHA_TO_COVERAGE="alphaToCoverage";gn.DEFAULT="default";gn.HARDWARE="hardware";const cV=()=>J(new gn),uV=()=>J(new gn(gn.ALPHA_TO_COVERAGE)),dV=()=>J(new gn(gn.HARDWARE)),hV=.05,oy=Y(([n])=>rr(Te(1e4,un(Te(17,n.x).add(Te(.1,n.y)))).mul(Zt(.1,rn(un(Te(13,n.y).add(n.x))))))),ay=Y(([n])=>oy(ne(oy(n.xy),n.z))),fV=Y(([n])=>{const e=vt(Rr(pw(n.xyz)),Rr(mw(n.xyz))),t=$(1).div($(hV).mul(e)).toVar("pixScale"),r=ne(Da(Hs(Cr(t))),Da(Dm(Cr(t)))),s=ne(ay(Hs(r.x.mul(n.xyz))),ay(Hs(r.y.mul(n.xyz)))),i=rr(Cr(t)),o=Zt(Te(i.oneMinus(),s.x),Te(i,s.y)),a=Ji(i,i.oneMinus()),l=X(o.mul(o).div(Te(2,a).mul(Ut(1,a))),o.sub(Te(.5,a)).div(Ut(1,a)),Ut(1,Ut(1,o).mul(Ut(1,o)).div(Te(2,a).mul(Ut(1,a))))),c=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(l.x,l.y),l.z);return Dr(c,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class pV extends Mw{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),r=e.hasGeometryAttribute(t);let s;return r===!0?s=super.generate(e):s=e.generateConst(this.nodeType,new et(1,1,1,1)),s}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const mV=(n=0)=>J(new pV(n)),gV=Y(([n])=>ve(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"});class ut extends jg{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{ie('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const r=this[t];r&&r.isNode===!0&&e.push({property:t,childNode:r})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:r}of this._getNodeChildren())e.push(Eu(t.slice(0,-4)),r.getCacheKey());return this.type+Za(e)}build(e){this.setup(e)}setupObserver(e){return new ZI(e)}setup(e){e.context.setupNormal=()=>ha(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();e.addStack();const s=ha(this.setupVertex(e),"VERTEX"),i=this.vertexNode||s;e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(r!==null?r.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);a!==null&&e.stack.addToStack(a);const c=ve(l,Re.a).max(0);o=this.setupOutput(e,c),da.assign(o);const u=this.outputNode!==null;if(u&&(o=this.outputNode),r!==null){const d=t.getMRT(),h=this.mrtNode;d!==null?(u&&da.assign(o),o=d,h!==null&&(o=d.merge(h))):h!==null&&(o=h)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=ve(l)),o=this.setupOutput(e,l)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let s=null;if(t.length>0||r.length>0){const i=e.renderer.currentSamples;this.alphaToCoverage&&i>1?s=uV():e.stack.addToStack(cV())}return s}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(dV()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let s=this.depthNode;if(s===null){const i=t.getMRT();i&&i.has("depth")?s=i.get("depth"):t.logarithmicDepthBuffer===!0&&(r.isPerspectiveCamera?s=nS(ct.z,Ms,Ps):s=pa(ct.z,Ms,Ps))}s!==null&&sS.assign(s).toStack()}setupPositionView(){return Bu.mul(kt).xyz}setupModelViewProjection(){return Fw.mul(ct)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),Zw}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&eV(t).toStack(),t.isSkinnedMesh===!0&&K4(t).toStack(),this.displacementMap){const s=qr("displacementMap","texture"),i=qr("displacementScale","float"),o=qr("displacementBias","float");kt.addAssign(sr.normalize().mul(s.x.mul(i).add(o)))}return t.isBatchedMesh&&q4(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&H4(t).toStack(),this.positionNode!==null&&kt.assign(ha(this.positionNode,"POSITION","vec3")),kt}setupDiffuseColor(e){const{object:t,geometry:r}=e;this.maskNode!==null&&Am(this.maskNode).not().discard();let s=this.colorNode?ve(this.colorNode):d4;this.vertexColors===!0&&r.hasAttribute("color")&&(s=s.mul(mV())),t.instanceColor&&(s=Xc("vec3","vInstanceColor").mul(s)),t.isBatchedMesh&&t._colorsTexture&&(s=Xc("vec3","vBatchColor").mul(s)),Re.assign(s);const i=this.opacityNode?$(this.opacityNode):Yw;Re.a.assign(Re.a.mul(i));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?$(this.alphaTestNode):u4,this.alphaToCoverage===!0?(Re.a=Br(o,o.add(gw(Re.a)),Re.a),Re.a.lessThanEqual(0).discard()):Re.a.lessThanEqual(o).discard()),this.alphaHash===!0&&Re.a.lessThan(fV(kt)).discard(),e.isOpaque()&&Re.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?X(0):Re.rgb}setupNormal(){return this.normalNode?X(this.normalNode):y4}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?qr("envMap","cubeTexture"):qr("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new sV(Qw)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const s=this.setupLightMap(e);if(s&&s.isLightingNode&&t.push(s),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:V4;t.push(new tV(o))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:s,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const c=this.setupLightingModel(e)||null;l=rV(a,c,r,s)}else r!==null&&(l=X(s!==null?We(l,r,s):r));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&($x.assign(X(i||f4)),l=l.add($x)),l}setupFog(e,t){const r=e.fogNode;return r&&(da.assign(t),t=ve(r.toVar())),t}setupPremultipliedAlpha(e,t){return gV(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const r in e){const s=e[r];this[r]===void 0&&(this[r]=s,s&&s.clone&&(this[r]=s.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&t[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const r=jg.prototype.toJSON.call(this,e);r.inputNodes={};for(const{property:i,childNode:o}of this._getNodeChildren())r.inputNodes[i]=o.toJSON(e).uuid;function s(i){const o=[];for(const a in i){const l=i[a];delete l.metadata,o.push(l)}return o}if(t){const i=s(e.textures),o=s(e.images),a=s(e.nodes);i.length>0&&(r.textures=i),o.length>0&&(r.images=o),a.length>0&&(r.nodes=a)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const xV=new Qv;class yV extends ut{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(xV),this.setValues(e)}}const bV=new x2;class vV extends ut{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(bV),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?$(this.offsetNode):I4,t=this.dashScaleNode?$(this.dashScaleNode):k4,r=this.dashSizeNode?$(this.dashSizeNode):F4,s=this.gapSizeNode?$(this.gapSizeNode):L4;Md.assign(r),zx.assign(s);const i=ls(is("lineDistance").mul(t));(e?i.add(e):i).mod(Md.add(zx)).greaterThan(Md).discard()}}const _V=n=>J(n).mul(.5).add(.5),TV=new m2;class wV extends ut{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(TV),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?$(this.opacityNode):Yw;Re.assign(Fm(ve(_V(Le),e),kp))}}const iS=Y(([n=Lw])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ne(e,t)});class oS extends X2{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,s=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new F_(5,5,5),o=iS(Lw),a=new ut;a.colorNode=Ce(t,o,0),a.side=Qt,a.blending=Wi;const l=new kn(i,a),c=new fu;c.add(l),t.minFilter===Gs&&(t.minFilter=Fn);const u=new K2(1,10,this),d=e.getMRT();return e.setMRT(null),u.update(e,c),e.setMRT(d),t.minFilter=r,t.currentGenerateMipmaps=s,l.geometry.dispose(),l.material.dispose(),this}}const ma=new WeakMap;class SV extends _t{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Fa(null);const t=new Vp;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=_e.RENDER}updateBefore(e){const{renderer:t,material:r}=e,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const i=s.isTextureNode?s.value:r[s.property];if(i&&i.isTexture){const o=i.mapping;if(o===Op||o===Up){if(ma.has(i)){const a=ma.get(i);ly(a,i.mapping),this._cubeTexture=a}else{const a=i.image;if(NV(a)){const l=new oS(a.height);l.fromEquirectangularTexture(t,i),ly(l.texture,i.mapping),this._cubeTexture=l.texture,ma.set(i,l.texture),i.addEventListener("dispose",aS)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function NV(n){return n==null?!1:n.height>0}function aS(n){const e=n.target;e.removeEventListener("dispose",aS);const t=ma.get(e);t!==void 0&&(ma.delete(e),t.dispose())}function ly(n,e){e===Op?n.mapping=Dc:e===Up&&(n.mapping=Bc)}const lS=Be(SV).setParameterLength(1);class jm extends go{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=lS(this.envNode)}}class AV extends go{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=$(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Fu{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class cS extends Fu{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,s=e.irradianceLightMap;r.indirectDiffuse.assign(ve(0)),s?r.indirectDiffuse.addAssign(s):r.indirectDiffuse.addAssign(ve(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(Re.rgb)}finish(e){const{material:t,context:r}=e,s=r.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case W2:s.rgb.assign(We(s.rgb,s.rgb.mul(i.rgb),yc.mul(Bd)));break;case H2:s.rgb.assign(We(s.rgb,i.rgb,yc.mul(Bd)));break;case z2:s.rgb.addAssign(i.rgb.mul(yc.mul(Bd)));break;default:ie("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const EV=new Hr;class CV extends ut{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(EV),this.setValues(e)}setupNormal(){return nl(ka)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new jm(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new AV(Qw)),t}setupOutgoingLight(){return Re.rgb}setupLightingModel(){return new cS}}const La=Y(({f0:n,f90:e,dotVH:t})=>{const r=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(r.oneMinus()).add(e.mul(r))}),ro=Y(n=>n.diffuseColor.mul(1/Math.PI)),RV=()=>$(.25),MV=Y(({dotNH:n})=>$f.mul($(.5)).add(1).mul($(1/Math.PI)).mul(n.pow($f))),PV=Y(({lightDirection:n})=>{const e=n.add(Qe).normalize(),t=Le.dot(e).clamp(),r=Qe.dot(e).clamp(),s=La({f0:En,f90:1,dotVH:r}),i=RV(),o=MV({dotNH:t});return s.mul(i).mul(o)});class uS extends cS{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const i=Le.dot(e).clamp().mul(t);r.directDiffuse.addAssign(i.mul(ro({diffuseColor:Re.rgb}))),this.specular===!0&&r.directSpecular.addAssign(i.mul(PV({lightDirection:e})).mul(yc))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(r.mul(ro({diffuseColor:Re}))),s.indirectDiffuse.mulAssign(t)}}const DV=new Xv;class BV extends ut{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(DV),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new jm(t):null}setupLightingModel(){return new uS(!1)}}const kV=new d2;class FV extends ut{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(kV),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new jm(t):null}setupLightingModel(){return new uS}setupVariants(){const e=(this.shininessNode?$(this.shininessNode):h4).max(1e-4);$f.assign(e);const t=this.specularNode||p4;En.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const LV=Y(n=>{if(n.geometry.hasAttribute("normal")===!1)return $(0);const e=ka.dFdx().abs().max(ka.dFdy().abs());return e.x.max(e.y).max(e.z)}),dS=Y(n=>{const{roughness:e}=n,t=LV();let r=e.max(.0525);return r=r.add(t),r=r.min(1),r}),IV=Y(({alpha:n,dotNL:e,dotNV:t})=>{const r=n.pow2(),s=e.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt()),i=t.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return nr(.5,s.add(i).max(cw))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),OV=Y(({alphaT:n,alphaB:e,dotTV:t,dotBV:r,dotTL:s,dotBL:i,dotNV:o,dotNL:a})=>{const l=a.mul(X(n.mul(t),e.mul(r),o).length()),c=o.mul(X(n.mul(s),e.mul(i),a).length());return nr(.5,l.add(c)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),UV=Y(({alpha:n,dotNH:e})=>{const t=n.pow2(),r=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),VV=$(1/Math.PI),jV=Y(({alphaT:n,alphaB:e,dotNH:t,dotTH:r,dotBH:s})=>{const i=n.mul(e),o=X(e.mul(r),n.mul(s),i.mul(t)),a=o.dot(o),l=i.div(a);return VV.mul(i.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),hS=Y(({lightDirection:n,f0:e,f90:t,roughness:r,f:s,normalView:i=Le,USE_IRIDESCENCE:o,USE_ANISOTROPY:a})=>{const l=r.pow2(),c=n.add(Qe).normalize(),u=i.dot(n).clamp(),d=i.dot(Qe).clamp(),h=i.dot(c).clamp(),f=Qe.dot(c).clamp();let p=La({f0:e,f90:t,dotVH:f}),m,y;if(Gx(o)&&(p=Rm.mix(p,s)),Gx(a)){const x=pc.dot(n),b=pc.dot(Qe),v=pc.dot(c),_=ji.dot(n),w=ji.dot(Qe),T=ji.dot(c);m=OV({alphaT:Gf,alphaB:l,dotTV:b,dotBV:w,dotTL:x,dotBL:_,dotNV:d,dotNL:u}),y=jV({alphaT:Gf,alphaB:l,dotNH:h,dotTH:v,dotBH:T})}else m=IV({alpha:l,dotNL:u,dotNV:d}),y=UV({alpha:l,dotNH:h});return p.mul(m).mul(y)}),GV=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let fr=null;const Jc=Y(({roughness:n,dotNV:e})=>{fr===null&&(fr=new P_(GV,32,32,Kr,jt),fr.minFilter=Fn,fr.magFilter=Fn,fr.wrapS=Ta,fr.wrapT=Ta,fr.generateMipmaps=!1,fr.needsUpdate=!0);const t=ne(n,e);return Ce(fr,t).rg}),$V=Y(({lightDirection:n,f0:e,f90:t,roughness:r,f:s,USE_IRIDESCENCE:i,USE_ANISOTROPY:o})=>{const a=hS({lightDirection:n,f0:e,f90:t,roughness:r,f:s,USE_IRIDESCENCE:i,USE_ANISOTROPY:o}),l=Le.dot(n).clamp(),c=Le.dot(Qe).clamp(),u=Jc({roughness:r,dotNV:c}),d=Jc({roughness:r,dotNV:l}),h=e.mul(u.x).add(t.mul(u.y)),f=e.mul(d.x).add(t.mul(d.y)),p=u.x.add(u.y),m=d.x.add(d.y),y=$(1).sub(p),x=$(1).sub(m),b=e.add(e.oneMinus().mul(.047619)),v=h.mul(f).mul(b).div($(1).sub(y.mul(x).mul(b).mul(b)).add(cw)),_=y.mul(x),w=v.mul(_);return a.add(w)}),fS=Y(n=>{const{dotNV:e,specularColor:t,specularF90:r,roughness:s}=n,i=Jc({dotNV:e,roughness:s});return t.mul(i.x).add(r.mul(i.y))}),zV=Y(({f:n,f90:e,dotVH:t})=>{const r=t.oneMinus().saturate(),s=r.mul(r),i=r.mul(s,s).clamp(0,.9999);return n.sub(X(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),HV=Y(({roughness:n,dotNH:e})=>{const t=n.pow2(),r=$(1).div(t),i=e.pow2().oneMinus().max(.0078125);return $(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),WV=Y(({dotNV:n,dotNL:e})=>$(1).div($(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),qV=Y(({lightDirection:n})=>{const e=n.add(Qe).normalize(),t=Le.dot(n).clamp(),r=Le.dot(Qe).clamp(),s=Le.dot(e).clamp(),i=HV({roughness:Cm,dotNH:s}),o=WV({dotNV:r,dotNL:t});return Ai.mul(i).mul(o)}),XV=Y(({N:n,V:e,roughness:t})=>{const i=.0078125,o=n.dot(e).saturate(),a=ne(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(i)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),KV=Y(({f:n})=>{const e=n.length();return vt(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Dl=Y(({v1:n,v2:e})=>{const t=n.dot(e),r=t.abs().toVar(),s=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),i=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=s.div(i),a=t.greaterThan(0).select(o,vt(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),cy=Y(({N:n,V:e,P:t,mInv:r,p0:s,p1:i,p2:o,p3:a})=>{const l=i.sub(s).toVar(),c=a.sub(s).toVar(),u=l.cross(c),d=X().toVar();return Xe(u.dot(t.sub(s)).greaterThanEqual(0),()=>{const h=e.sub(n.mul(e.dot(n))).normalize(),f=n.cross(h).negate(),p=r.mul($t(h,f,n).transpose()).toVar(),m=p.mul(s.sub(t)).normalize().toVar(),y=p.mul(i.sub(t)).normalize().toVar(),x=p.mul(o.sub(t)).normalize().toVar(),b=p.mul(a.sub(t)).normalize().toVar(),v=X(0).toVar();v.addAssign(Dl({v1:m,v2:y})),v.addAssign(Dl({v1:y,v2:x})),v.addAssign(Dl({v1:x,v2:b})),v.addAssign(Dl({v1:b,v2:m})),d.assign(X(KV({f:v})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Lu=1/6,pS=n=>Te(Lu,Te(n,Te(n,n.negate().add(3)).sub(3)).add(1)),Xf=n=>Te(Lu,Te(n,Te(n,Te(3,n).sub(6))).add(4)),mS=n=>Te(Lu,Te(n,Te(n,Te(-3,n).add(3)).add(3)).add(1)),Kf=n=>Te(Lu,Mu(n,3)),uy=n=>pS(n).add(Xf(n)),dy=n=>mS(n).add(Kf(n)),hy=n=>Zt(-1,Xf(n).div(pS(n).add(Xf(n)))),fy=n=>Zt(1,Kf(n).div(mS(n).add(Kf(n)))),py=(n,e,t)=>{const r=n.uvNode,s=Te(r,e.zw).add(.5),i=Hs(s),o=rr(s),a=uy(o.x),l=dy(o.x),c=hy(o.x),u=fy(o.x),d=hy(o.y),h=fy(o.y),f=ne(i.x.add(c),i.y.add(d)).sub(.5).mul(e.xy),p=ne(i.x.add(u),i.y.add(d)).sub(.5).mul(e.xy),m=ne(i.x.add(c),i.y.add(h)).sub(.5).mul(e.xy),y=ne(i.x.add(u),i.y.add(h)).sub(.5).mul(e.xy),x=uy(o.y).mul(Zt(a.mul(n.sample(f).level(t)),l.mul(n.sample(p).level(t)))),b=dy(o.y).mul(Zt(a.mul(n.sample(m).level(t)),l.mul(n.sample(y).level(t))));return x.add(b)},YV=Y(([n,e])=>{const t=ne(n.size(ze(e))),r=ne(n.size(ze(e.add(1)))),s=nr(1,t),i=nr(1,r),o=py(n,ve(s,t),Hs(e)),a=py(n,ve(i,r),Dm(e));return rr(e).mix(o,a)}),my=Y(([n,e,t,r,s])=>{const i=X(Tw(e.negate(),Jn(n),nr(1,r))),o=X(Rr(s[0].xyz),Rr(s[1].xyz),Rr(s[2].xyz));return Jn(i).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),QV=Y(([n,e])=>n.mul(Dr(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),ZV=eS(),JV=eS(),gy=Y(([n,e,t],{material:r})=>{const i=(r.side===Qt?ZV:JV).sample(n),o=Cr(Hf.x).mul(QV(e,t));return YV(i,o)}),xy=Y(([n,e,t])=>(Xe(t.notEqual(0),()=>{const r=dw(e).negate().div(t);return uw(r.negate().mul(n))}),X(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),ej=Y(([n,e,t,r,s,i,o,a,l,c,u,d,h,f,p])=>{let m,y;if(p){m=ve().toVar(),y=X().toVar();const w=u.sub(1).mul(p.mul(.025)),T=X(u.sub(w),u,u.add(w));hn({start:0,end:3},({i:N})=>{const S=T.element(N),C=my(n,e,d,S,a),D=o.add(C),F=c.mul(l.mul(ve(D,1))),j=ne(F.xy.div(F.w)).toVar();j.addAssign(1),j.divAssign(2),j.assign(ne(j.x,j.y.oneMinus()));const z=gy(j,t,S);m.element(N).assign(z.element(N)),m.a.addAssign(z.a),y.element(N).assign(r.element(N).mul(xy(Rr(C),h,f).element(N)))}),m.a.divAssign(3)}else{const w=my(n,e,d,u,a),T=o.add(w),N=c.mul(l.mul(ve(T,1))),S=ne(N.xy.div(N.w)).toVar();S.addAssign(1),S.divAssign(2),S.assign(ne(S.x,S.y.oneMinus())),m=gy(S,t,u),y=r.mul(xy(Rr(w),h,f))}const x=y.rgb.mul(m.rgb),b=n.dot(e).clamp(),v=X(fS({dotNV:b,specularColor:s,specularF90:i,roughness:t})),_=y.r.add(y.g,y.b).div(3);return ve(v.oneMinus().mul(x),m.a.oneMinus().mul(_).oneMinus())}),tj=$t(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),nj=n=>{const e=n.sqrt();return X(1).add(e).div(X(1).sub(e))},yy=(n,e)=>n.sub(e).div(n.add(e)).pow2(),rj=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),r=X(54856e-17,44201e-17,52481e-17),s=X(1681e3,1795300,2208400),i=X(43278e5,93046e5,66121e5),o=$(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=r.mul(i.mul(2*Math.PI).sqrt()).mul(s.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=X(a.x.add(o),a.y,a.z).div(10685e-11),tj.mul(a)},sj=Y(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:r,baseF0:s})=>{const i=We(n,e,Br(0,.03,r)),a=n.div(i).pow2().mul(t.pow2().oneMinus()).oneMinus();Xe(a.lessThan(0),()=>X(1));const l=a.sqrt(),c=yy(i,n),u=La({f0:c,f90:1,dotVH:t}),d=u.oneMinus(),h=i.lessThan(n).select(Math.PI,0),f=$(Math.PI).sub(h),p=nj(s.clamp(0,.9999)),m=yy(p,i.toVec3()),y=La({f0:m,f90:1,dotVH:l}),x=X(p.x.lessThan(i).select(Math.PI,0),p.y.lessThan(i).select(Math.PI,0),p.z.lessThan(i).select(Math.PI,0)),b=i.mul(r,l,2),v=X(f).add(x),_=u.mul(y).clamp(1e-5,.9999),w=_.sqrt(),T=d.pow2().mul(y).div(X(1).sub(_)),S=u.add(T).toVar(),C=T.sub(d).toVar();return hn({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{C.mulAssign(w);const F=rj($(D).mul(b),$(D).mul(v)).mul(2);S.addAssign(C.mul(F))}),S.max(X(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),ij=Y(({normal:n,viewDir:e,roughness:t})=>{const r=n.dot(e).saturate(),s=t.pow2(),i=Ct(t.lessThan(.25),$(-339.2).mul(s).add($(161.4).mul(t)).sub(25.9),$(-8.48).mul(s).add($(14.3).mul(t)).sub(9.95)),o=Ct(t.lessThan(.25),$(44).mul(s).sub($(23.7).mul(t)).add(3.26),$(1.97).mul(s).sub($(3.27).mul(t)).add(.72));return Ct(t.lessThan(.25),0,$(.1).mul(t).sub(.025)).add(i.mul(r).add(o).exp()).mul(1/Math.PI).saturate()}),Fd=X(.04),Ld=$(1);class gS extends Fu{constructor(e=!1,t=!1,r=!1,s=!1,i=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=s,this.transmission=i,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=X().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=X().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=X().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=X().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=X().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Le.dot(Qe).clamp();this.iridescenceFresnel=sj({outsideIOR:$(1),eta2:ew,cosTheta1:t,thinFilmThickness:tw,baseF0:En}),this.iridescenceF0=zV({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=no,r=B5.sub(no).normalize(),s=mo,i=e.context;i.backdrop=ej(s,r,Tr,Re,En,Qc,t,Js,Lr,Fw,mc,nw,sw,rw,this.dispersion?iw:null),i.backdropAlpha=zf,Re.a.mulAssign(We(1,i.backdrop.a,zf))}super.start(e)}computeMultiscattering(e,t,r){const s=Le.dot(Qe).clamp(),i=Jc({roughness:Tr,dotNV:s}),o=this.iridescenceF0?Rm.mix(En,this.iridescenceF0):En,a=o.mul(i.x).add(r.mul(i.y)),c=i.x.add(i.y).oneMinus(),u=o.add(o.oneMinus().mul(.047619)),d=a.mul(u).div(c.mul(u).oneMinus());e.addAssign(a),t.addAssign(d.mul(c))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const i=Le.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(qV({lightDirection:e}))),this.clearcoat===!0){const a=Ei.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(hS({lightDirection:e,f0:Fd,f90:Ld,roughness:Yc,normalView:Ei})))}r.directDiffuse.addAssign(i.mul(ro({diffuseColor:Re.rgb}))),r.directSpecular.addAssign(i.mul($V({lightDirection:e,f0:En,f90:1,roughness:Tr,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:s,reflectedLight:i,ltc_1:o,ltc_2:a}){const l=t.add(r).sub(s),c=t.sub(r).sub(s),u=t.sub(r).add(s),d=t.add(r).add(s),h=Le,f=Qe,p=ct.toVar(),m=XV({N:h,V:f,roughness:Tr}),y=o.sample(m).toVar(),x=a.sample(m).toVar(),b=$t(X(y.x,0,y.y),X(0,1,0),X(y.z,0,y.w)).toVar(),v=En.mul(x.x).add(En.oneMinus().mul(x.y)).toVar();i.directSpecular.addAssign(e.mul(v).mul(cy({N:h,V:f,P:p,mInv:b,p0:l,p1:c,p2:u,p3:d}))),i.directDiffuse.addAssign(e.mul(Re).mul(cy({N:h,V:f,P:p,mInv:$t(1,0,0,0,1,0,0,0,1),p0:l,p1:c,p2:u,p3:d})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(t.mul(ro({diffuseColor:Re})))}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:s}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(r.mul(Ai,ij({normal:Le,viewDir:Qe,roughness:Cm}))),this.clearcoat===!0){const u=Ei.dot(Qe).clamp(),d=fS({dotNV:u,specularColor:Fd,specularF90:Ld,roughness:Yc});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(d))}const i=X().toVar("singleScattering"),o=X().toVar("multiScattering"),a=r.mul(1/Math.PI);this.computeMultiscattering(i,o,Qc);const l=i.add(o),c=Re.mul(l.r.max(l.g).max(l.b).oneMinus());s.indirectSpecular.addAssign(t.mul(i)),s.indirectSpecular.addAssign(o.mul(a)),s.indirectDiffuse.addAssign(c.mul(a))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,i=Le.dot(Qe).clamp().add(t),o=Tr.mul(-16).oneMinus().negate().exp2(),a=t.sub(i.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const r=Ei.dot(Qe).clamp(),s=La({dotVH:r,f0:Fd,f90:Ld}),i=t.mul(jf.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(jf));t.assign(i)}if(this.sheen===!0){const r=Ai.r.max(Ai.g).max(Ai.b).mul(.157).oneMinus(),s=t.mul(r).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(s)}}}const by=$(1),Yf=$(-2),Bl=$(.8),Id=$(-1),kl=$(.4),Od=$(2),Fl=$(.305),Ud=$(3),vy=$(.21),oj=$(4),_y=$(4),aj=$(16),lj=Y(([n])=>{const e=X(rn(n)).toVar(),t=$(-1).toVar();return Xe(e.x.greaterThan(e.z),()=>{Xe(e.x.greaterThan(e.y),()=>{t.assign(Ct(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Ct(n.y.greaterThan(0),1,4))})}).Else(()=>{Xe(e.z.greaterThan(e.y),()=>{t.assign(Ct(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Ct(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),cj=Y(([n,e])=>{const t=ne().toVar();return Xe(e.equal(0),()=>{t.assign(ne(n.z,n.y).div(rn(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(ne(n.x.negate(),n.z.negate()).div(rn(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(ne(n.x.negate(),n.y).div(rn(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(ne(n.z.negate(),n.y).div(rn(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(ne(n.x.negate(),n.z).div(rn(n.y)))}).Else(()=>{t.assign(ne(n.x,n.y).div(rn(n.z)))}),Te(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),uj=Y(([n])=>{const e=$(0).toVar();return Xe(n.greaterThanEqual(Bl),()=>{e.assign(by.sub(n).mul(Id.sub(Yf)).div(by.sub(Bl)).add(Yf))}).ElseIf(n.greaterThanEqual(kl),()=>{e.assign(Bl.sub(n).mul(Od.sub(Id)).div(Bl.sub(kl)).add(Id))}).ElseIf(n.greaterThanEqual(Fl),()=>{e.assign(kl.sub(n).mul(Ud.sub(Od)).div(kl.sub(Fl)).add(Od))}).ElseIf(n.greaterThanEqual(vy),()=>{e.assign(Fl.sub(n).mul(oj.sub(Ud)).div(Fl.sub(vy)).add(Ud))}).Else(()=>{e.assign($(-2).mul(Cr(Te(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),dj=Y(([n,e])=>{const t=n.toVar();t.assign(Te(2,t).sub(1));const r=X(t,1).toVar();return Xe(e.equal(0),()=>{r.assign(r.zyx)}).ElseIf(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),hj=Y(([n,e,t,r,s,i])=>{const o=$(t),a=X(e),l=Dr(uj(o),Yf,i),c=rr(l),u=Hs(l),d=X(Ia(n,a,u,r,s,i)).toVar();return Xe(c.notEqual(0),()=>{const h=X(Ia(n,a,u.add(1),r,s,i)).toVar();d.assign(We(d,h,c))}),d}),Ia=Y(([n,e,t,r,s,i])=>{const o=$(t).toVar(),a=X(e),l=$(lj(a)).toVar(),c=$(vt(_y.sub(o),0)).toVar();o.assign(vt(o,_y));const u=$(Da(o)).toVar(),d=ne(cj(a,l).mul(u.sub(2)).add(1)).toVar();return Xe(l.greaterThan(2),()=>{d.y.addAssign(u),l.subAssign(3)}),d.x.addAssign(l.mul(u)),d.x.addAssign(c.mul(Te(3,aj))),d.y.addAssign(Te(4,Da(i).sub(u))),d.x.mulAssign(r),d.y.mulAssign(s),n.sample(d).grad(ne(),ne())}),Vd=Y(({envMap:n,mipInt:e,outputDirection:t,theta:r,axis:s,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=yr(r),c=t.mul(l).add(s.cross(t).mul(un(r))).add(s.mul(s.dot(t).mul(l.oneMinus())));return Ia(n,c,e,i,o,a)}),fj=Y(({n,latitudinal:e,poleAxis:t,outputDirection:r,weights:s,samples:i,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})=>{const h=X(Ct(e,t,Ba(t,r))).toVar();Xe(h.equal(X(0)),()=>{h.assign(X(r.z,0,r.x.negate()))}),h.assign(Jn(h));const f=X().toVar();return f.addAssign(s.element(0).mul(Vd({theta:0,axis:h,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),hn({start:ze(1),end:n},({i:p})=>{Xe(p.greaterThanEqual(i),()=>{Q4()});const m=$(o.mul($(p))).toVar();f.addAssign(s.element(p).mul(Vd({theta:m.mul(-1),axis:h,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),f.addAssign(s.element(p).mul(Vd({theta:m,axis:h,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})))}),ve(f,1)}),pj=Y(([n])=>{const e=it(n).toVar();return e.assign(e.shiftLeft(it(16)).bitOr(e.shiftRight(it(16)))),e.assign(e.bitAnd(it(1431655765)).shiftLeft(it(1)).bitOr(e.bitAnd(it(2863311530)).shiftRight(it(1)))),e.assign(e.bitAnd(it(858993459)).shiftLeft(it(2)).bitOr(e.bitAnd(it(3435973836)).shiftRight(it(2)))),e.assign(e.bitAnd(it(252645135)).shiftLeft(it(4)).bitOr(e.bitAnd(it(4042322160)).shiftRight(it(4)))),e.assign(e.bitAnd(it(16711935)).shiftLeft(it(8)).bitOr(e.bitAnd(it(4278255360)).shiftRight(it(8)))),$(e).mul(23283064365386963e-26)}),mj=Y(([n,e])=>ne($(n).div($(e)),pj(n))),gj=Y(([n,e,t])=>{const r=X(e).toVar(),s=$(t),i=s.mul(s).toVar(),o=Jn(X(i.mul(r.x),i.mul(r.y),r.z)).toVar(),a=o.x.mul(o.x).add(o.y.mul(o.y)),l=Ct(a.greaterThan(0),X(o.y.negate(),o.x,0).div(Os(a)),X(1,0,0)).toVar(),c=Ba(o,l).toVar(),u=Os(n.x),d=Te(2,3.14159265359).mul(n.y),h=u.mul(yr(d)).toVar(),f=u.mul(un(d)).toVar(),p=Te(.5,o.z.add(1));f.assign(p.oneMinus().mul(Os(h.mul(h).oneMinus())).add(p.mul(f)));const m=l.mul(h).add(c.mul(f)).add(o.mul(Os(vt(0,h.mul(h).add(f.mul(f)).oneMinus()))));return Jn(X(i.mul(m.x),i.mul(m.y),vt(0,m.z)))}),xj=Y(({roughness:n,mipInt:e,envMap:t,N_immutable:r,GGX_SAMPLES:s,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=X(r).toVar(),c=X(0).toVar(),u=$(0).toVar();return Xe(n.lessThan(.001),()=>{c.assign(Ia(t,l,e,i,o,a))}).Else(()=>{const d=Ct(rn(l.z).lessThan(.999),X(0,0,1),X(1,0,0)),h=Jn(Ba(d,l)).toVar(),f=Ba(l,h).toVar();hn({start:it(0),end:s},({i:p})=>{const m=mj(p,s),y=gj(m,X(0,0,1),n),x=Jn(h.mul(y.x).add(f.mul(y.y)).add(l.mul(y.z))),b=Jn(x.mul(eo(l,x).mul(2)).sub(l)),v=vt(eo(l,b),0);Xe(v.greaterThan(0),()=>{const _=Ia(t,b,e,i,o,a);c.addAssign(_.mul(v)),u.addAssign(v)})}),Xe(u.greaterThan(0),()=>{c.assign(c.div(u))})}),ve(c,1)}),Yr=4,Ty=[.125,.215,.35,.446,.526,.582],Ds=20,yj=512,Io=new Ip(-1,1,1,-1,0,1),bj=new _a(90,1),wy=new vn;let jd=null,Gd=0,$d=0;const vj=new ce,eu=new WeakMap,_j=[3,1,5,0,4,2],zd=dj(fo(),is("faceIndex")).normalize(),Iu=X(zd.x,zd.y,zd.z);class Tj{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,s=100,i={}){const{size:o=256,position:a=vj,renderTarget:l=null}=i;if(this._setSize(o),this._hasInitialized===!1){ie('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const u=l||this._allocateTarget();return i.renderTarget=u,this.fromSceneAsync(e,t,r,s,i),u}jd=this._renderer.getRenderTarget(),Gd=this._renderer.getActiveCubeFace(),$d=this._renderer.getActiveMipmapLevel();const c=l||this._allocateTarget();return c.depthBuffer=!0,this._init(c),this._sceneToCubeUV(e,r,s,c,a),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}async fromSceneAsync(e,t=0,r=.1,s=100,i={}){return ft('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,r,s,i)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){ie('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return ft('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){ie("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return ft('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Ny(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Ay(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Dc||e.mapping===Bc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(jd,Gd,$d),e.scissorTest=!1,gi(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),jd=this._renderer.getRenderTarget(),Gd=this._renderer.getActiveCubeFace(),$d=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return Sy(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Sy(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=wj(t)),this._blurMaterial=Sj(t,e.width,e.height),this._ggxMaterial=Nj(t,e.width,e.height)}}async _compileMaterial(e){const t=new kn(new Wa,e);await this._renderer.compile(t,Io)}_sceneToCubeUV(e,t,r,s,i){const o=bj;o.near=t,o.far=r;const a=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],c=this._renderer,u=c.autoClear;c.getClearColor(wy),c.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new kn(new F_,new Hr({name:"PMREM.Background",side:Qt,depthWrite:!1,depthTest:!1})));const d=this._backgroundBox,h=d.material;let f=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,f=!0):(h.color.copy(wy),f=!0),c.setRenderTarget(s),c.clear(),f&&c.render(d,o);for(let m=0;m<6;m++){const y=m%3;y===0?(o.up.set(0,a[m],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x+l[m],i.y,i.z)):y===1?(o.up.set(0,0,a[m]),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y+l[m],i.z)):(o.up.set(0,a[m],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y,i.z+l[m]));const x=this._cubeSize;gi(s,y*x,m>2?x:0,x,x),c.render(e,o)}c.autoClear=u,e.background=p}_textureToCubeUV(e,t){const r=this._renderer,s=e.mapping===Dc||e.mapping===Bc;s?this._cubemapMaterial===null&&(this._cubemapMaterial=Ny(e)):this._equirectMaterial===null&&(this._equirectMaterial=Ay(e));const i=s?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=i;const a=this._cubeSize;gi(t,0,0,3*a,2*a),r.setRenderTarget(t),r.render(o,Io)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const s=this._lodMeshes.length;for(let i=1;i<s;i++)this._applyGGXFilter(e,i-1,i);t.autoClear=r}_applyGGXFilter(e,t,r){const s=this._renderer,i=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[r];a.material=o;const l=eu.get(o),c=r/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),d=Math.sqrt(c*c-u*u),h=.05+c*.95,f=d*h,{_lodMax:p}=this,m=this._sizeLods[r],y=3*m*(r>p-Yr?r-p+Yr:0),x=4*(this._cubeSize-m);e.texture.frame=(e.texture.frame||0)+1,l.envMap.value=e.texture,l.roughness.value=f,l.mipInt.value=p-t,gi(i,y,x,3*m,2*m),s.setRenderTarget(i),s.render(a,Io),i.texture.frame=(i.texture.frame||0)+1,l.envMap.value=i.texture,l.roughness.value=0,l.mipInt.value=p-r,gi(e,y,x,3*m,2*m),s.setRenderTarget(e),s.render(a,Io)}_blur(e,t,r,s,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,s,"latitudinal",i),this._halfBlur(o,e,r,r,s,"longitudinal",i)}_halfBlur(e,t,r,s,i,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&se("blur direction must be either latitudinal or longitudinal!");const u=3,d=this._lodMeshes[s];d.material=c;const h=eu.get(c),f=this._sizeLods[r]-1,p=isFinite(i)?Math.PI/(2*f):2*Math.PI/(2*Ds-1),m=i/p,y=isFinite(i)?1+Math.floor(u*m):Ds;y>Ds&&ie(`sigmaRadians, ${i}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Ds}`);const x=[];let b=0;for(let N=0;N<Ds;++N){const S=N/m,C=Math.exp(-S*S/2);x.push(C),N===0?b+=C:N<y&&(b+=2*C)}for(let N=0;N<x.length;N++)x[N]=x[N]/b;e.texture.frame=(e.texture.frame||0)+1,h.envMap.value=e.texture,h.samples.value=y,h.weights.array=x,h.latitudinal.value=o==="latitudinal"?1:0,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=p,h.mipInt.value=v-r;const _=this._sizeLods[s],w=3*_*(s>v-Yr?s-v+Yr:0),T=4*(this._cubeSize-_);gi(t,w,T,3*_,2*_),l.setRenderTarget(t),l.render(d,Io)}}function wj(n){const e=[],t=[],r=[];let s=n;const i=n-Yr+1+Ty.length;for(let o=0;o<i;o++){const a=Math.pow(2,s);e.push(a);let l=1/a;o>n-Yr?l=Ty[o-n+Yr-1]:o===0&&(l=0),t.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,m=3,y=2,x=1,b=new Float32Array(m*p*f),v=new Float32Array(y*p*f),_=new Float32Array(x*p*f);for(let T=0;T<f;T++){const N=T%3*2/3-1,S=T>2?0:-1,C=[N,S,0,N+2/3,S,0,N+2/3,S+1,0,N,S,0,N+2/3,S+1,0,N,S+1,0],D=_j[T];b.set(C,m*p*D),v.set(h,y*p*D);const F=[D,D,D,D,D,D];_.set(F,x*p*D)}const w=new Wa;w.setAttribute("position",new rc(b,m)),w.setAttribute("uv",new rc(v,y)),w.setAttribute("faceIndex",new rc(_,x)),r.push(new kn(w,null)),s>Yr&&s--}return{lodMeshes:r,sizeLods:e,sigmas:t}}function Sy(n,e){const t={magFilter:Fn,minFilter:Fn,generateMipmaps:!1,type:jt,format:Pn,colorSpace:nC},r=new co(n,e,t);return r.texture.mapping=Ih,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function gi(n,e,t,r,s){n.viewport.set(e,t,r,s),n.scissor.set(e,t,r,s)}function Ou(n){const e=new ut;return e.depthTest=!1,e.depthWrite=!1,e.blending=Wi,e.name=`PMREM_${n}`,e}function Sj(n,e,t){const r=Mn(new Array(Ds).fill(0)),s=pe(new ce(0,1,0)),i=pe(0),o=$(Ds),a=pe(0),l=pe(1),c=Ce(),u=pe(0),d=$(1/e),h=$(1/t),f=$(n),p={n:o,latitudinal:a,weights:r,poleAxis:s,outputDirection:Iu,dTheta:i,samples:l,envMap:c,mipInt:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:f},m=Ou("blur");return m.fragmentNode=fj({...p,latitudinal:a.equal(1)}),eu.set(m,p),m}function Nj(n,e,t){const r=Ce(),s=pe(0),i=pe(0),o=$(1/e),a=$(1/t),l=$(n),c={envMap:r,roughness:s,mipInt:i,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:l},u=Ou("ggx");return u.fragmentNode=xj({...c,N_immutable:Iu,GGX_SAMPLES:it(yj)}),eu.set(u,c),u}function Ny(n){const e=Ou("cubemap");return e.fragmentNode=Fa(n,Iu),e}function Ay(n){const e=Ou("equirect");return e.fragmentNode=Ce(n,iS(Iu),0),e}const Ey=new WeakMap;function Aj(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function Ej(n,e,t){const r=Cj(e);let s=r.get(n);if((s!==void 0?s.pmremVersion:-1)!==n.pmremVersion){const o=n.image;if(n.isCubeTexture)if(Mj(o))s=t.fromCubemap(n,s);else return null;else if(Pj(o))s=t.fromEquirectangular(n,s);else return null;s.pmremVersion=n.pmremVersion,r.set(n,s)}return s.texture}function Cj(n){let e=Ey.get(n);return e===void 0&&(e=new WeakMap,Ey.set(n,e)),e}class Rj extends _t{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const s=new jp;s.isRenderTargetTexture=!0,this._texture=Ce(s),this._width=pe(0),this._height=pe(0),this._maxMip=pe(0),this.updateBeforeType=_e.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=Aj(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,s=this._value;r!==s.pmremVersion&&(s.isPMREMTexture===!0?t=s:t=Ej(s,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Tj(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=Vw.mul(X(t.x,t.y.negate(),t.z));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),hj(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function Mj(n){if(n==null)return!1;let e=0;const t=6;for(let r=0;r<t;r++)n[r]!==void 0&&e++;return e===t}function Pj(n){return n==null?!1:n.height>0}const xS=Be(Rj).setParameterLength(1,3),Cy=new WeakMap;class Dj extends go{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const d=r.isTextureNode?r.value:t[r.property];let h=Cy.get(d);h===void 0&&(h=xS(d),Cy.set(d,h)),r=h}const i=t.useAnisotropy===!0||t.anisotropy>0?s4:Le,o=r.context(Ry(Tr,i)).mul(Dd),a=r.context(Bj(mo)).mul(Math.PI).mul(Dd),l=fa(o),c=fa(a);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(c);const u=e.context.lightingModel.clearcoatRadiance;if(u){const d=r.context(Ry(Yc,Ei)).mul(Dd),h=fa(d);u.addAssign(h)}}}const Ry=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Qe.negate().reflect(e),t=bw(n).mix(t,e).normalize(),t=t.transformDirection(Lr)),t),getTextureLevel:()=>n}},Bj=n=>({getUV:()=>n,getTextureLevel:()=>$(1)}),kj=new h2;class yS extends ut{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(kj),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new Dj(t):null}setupLightingModel(){return new gS}setupSpecular(){const e=We(X(.04),Re.rgb,Kc);En.assign(e),Qc.assign(1)}setupVariants(){const e=this.metalnessNode?$(this.metalnessNode):x4;Kc.assign(e);let t=this.roughnessNode?$(this.roughnessNode):g4;t=dS({roughness:t}),Tr.assign(t),this.setupSpecular(),Re.assign(ve(Re.rgb.mul(e.oneMinus()),Re.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Fj=new f2;class Lj extends yS{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Fj),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?$(this.iorNode):P4;mc.assign(e),En.assign(We(Ji(yw(mc.sub(1).div(mc.add(1))).mul(m4),X(1)).mul(ry),Re.rgb,Kc)),Qc.assign(We(ry,1,Kc))}setupLightingModel(){return new gS(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?$(this.clearcoatNode):b4,r=this.clearcoatRoughnessNode?$(this.clearcoatRoughnessNode):v4;jf.assign(t),Yc.assign(dS({roughness:r}))}if(this.useSheen){const t=this.sheenNode?X(this.sheenNode):w4,r=this.sheenRoughnessNode?$(this.sheenRoughnessNode):S4;Ai.assign(t),Cm.assign(r)}if(this.useIridescence){const t=this.iridescenceNode?$(this.iridescenceNode):A4,r=this.iridescenceIORNode?$(this.iridescenceIORNode):E4,s=this.iridescenceThicknessNode?$(this.iridescenceThicknessNode):C4;Rm.assign(t),ew.assign(r),tw.assign(s)}if(this.useAnisotropy){const t=(this.anisotropyNode?ne(this.anisotropyNode):N4).toVar();Es.assign(t.length()),Xe(Es.equal(0),()=>{t.assign(ne(1,0))}).Else(()=>{t.divAssign(ne(Es)),Es.assign(Es.saturate())}),Gf.assign(Es.pow2().mix(Tr.pow2(),1)),pc.assign(ea[0].mul(t.x).add(ea[1].mul(t.y))),ji.assign(ea[1].mul(t.x).sub(ea[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?$(this.transmissionNode):R4,r=this.thicknessNode?$(this.thicknessNode):M4,s=this.attenuationDistanceNode?$(this.attenuationDistanceNode):D4,i=this.attenuationColorNode?X(this.attenuationColorNode):B4;if(zf.assign(t),nw.assign(r),rw.assign(s),sw.assign(i),this.useDispersion){const o=this.dispersionNode?$(this.dispersionNode):U4;iw.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?X(this.clearcoatNormalNode):_4}setup(e){e.context.setupClearcoatNormal=()=>ha(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const Ij=Y(({normal:n,lightDirection:e,builder:t})=>{const r=n.dot(e),s=ne(r.mul(.5).add(.5),0);if(t.material.gradientMap){const i=qr("gradientMap","texture").context({getUV:()=>s});return X(i.r)}else{const i=s.fwidth().mul(.5);return We(X(.7),X(1),Br($(.7).sub(i.x),$(.7).add(i.x),s.x))}});class Oj extends Fu{direct({lightDirection:e,lightColor:t,reflectedLight:r},s){const i=Ij({normal:Ow,lightDirection:e,builder:s}).mul(t);r.directDiffuse.addAssign(i.mul(ro({diffuseColor:Re.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:s}=e.context;s.indirectDiffuse.addAssign(r.mul(ro({diffuseColor:Re}))),s.indirectDiffuse.mulAssign(t)}}const Uj=new p2;class Vj extends ut{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Uj),this.setValues(e)}setupLightingModel(){return new Oj}}const jj=Y(()=>{const n=X(Qe.z,0,Qe.x.negate()).normalize(),e=Qe.cross(n);return ne(n.dot(Le),e.dot(Le)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),Gj=new g2;class $j extends ut{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Gj),this.setValues(e)}setupVariants(e){const t=jj;let r;e.material.matcap?r=qr("matcap","texture").context({getUV:()=>t}):r=X(We(.2,.8,t.y)),Re.rgb.mulAssign(r.rgb)}}class zj extends _t{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const i=t.cos(),o=t.sin();return Em(i,o,o.negate(),i).mul(r)}else{const i=t,o=Vi(ve(1,0,0,0),ve(0,yr(i.x),un(i.x).negate(),0),ve(0,un(i.x),yr(i.x),0),ve(0,0,0,1)),a=Vi(ve(yr(i.y),0,un(i.y),0),ve(0,1,0,0),ve(un(i.y).negate(),0,yr(i.y),0),ve(0,0,0,1)),l=Vi(ve(yr(i.z),un(i.z).negate(),0,0),ve(un(i.z),yr(i.z),0,0),ve(0,0,1,0),ve(0,0,0,1));return o.mul(a).mul(l).mul(ve(r,1)).xyz}}}const bS=Be(zj).setParameterLength(2),Hj=new b2;class vS extends ut{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Hj),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,{positionNode:s,rotationNode:i,scaleNode:o,sizeAttenuation:a}=this,l=Bu.mul(X(s||0));let c=ne(Js[0].xyz.length(),Js[1].xyz.length());o!==null&&(c=c.mul(ne(o))),r.isPerspectiveCamera&&a===!1&&(c=c.mul(l.z.negate()));let u=ku.xy;if(t.center&&t.center.isVector2===!0){const f=t5("center","vec2",t);u=u.sub(f.sub(.5))}u=u.mul(c);const d=$(i||T4),h=bS(u,d);return ve(l.xy.add(h),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Wj=new y2,qj=new we;class Xj extends vS{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Wj),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Bu.mul(X(e||kt)).xyz}setupVertexSprite(e){const{material:t,camera:r}=e,{rotationNode:s,scaleNode:i,sizeNode:o,sizeAttenuation:a}=this;let l=super.setupVertex(e);if(t.isNodeMaterial!==!0)return l;let c=o!==null?ne(o):O4;c=c.mul(P5),r.isPerspectiveCamera&&a===!0&&(c=c.mul(Kj.div(ct.z.negate()))),i&&i.isNode&&(c=c.mul(ne(i)));let u=ku.xy;if(s&&s.isNode){const d=$(s);u=bS(u,d)}return u=u.mul(c),u=u.div(D5.div(2)),u=u.mul(l.w),l=l.add(ve(u,0,0)),l}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const Kj=pe(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(qj);this.value=.5*e.y});class Yj extends Fu{constructor(){super(),this.shadowNode=$(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Re.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Re.rgb)}}const Qj=new v2;class Zj extends ut{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Qj),this.setValues(e)}setupLightingModel(){return new Yj}}rs("vec3");rs("vec3");rs("vec3");class Jj{constructor(e,t,r){this.renderer=e,this.nodes=t,this.info=r,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,r),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Ln{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let r=this.weakMap;for(let s=0;s<e.length-1;s++){const i=e[s];r.has(i)===!1&&r.set(i,new WeakMap),r=r.get(i)}return r.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return!1;return t.delete(e[e.length-1])}}let eG=0;function tG(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptors(t);for(const s in r)if(r[s]!==void 0){const i=r[s];i&&typeof i.get=="function"&&e.push(s)}t=Object.getPrototypeOf(t)}return e}class nG{constructor(e,t,r,s,i,o,a,l,c,u){this.id=eG++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=s,this.material=i,this.scene=o,this.camera=a,this.lightsNode=l,this.context=c,this.geometry=s.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=u!==null?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],s=new Set,i={};for(const o of e){let a;if(o.node&&o.node.attribute?a=o.node.attribute:(a=t.getAttribute(o.name),i[o.name]=a.version),a===void 0)continue;r.push(a);const l=a.isInterleavedBufferAttribute?a.data:a;s.add(l)}return this.attributes=r,this.attributesId=i,this.vertexBuffers=Array.from(s.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:s,drawRange:i}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),l=a!==null;let c=1;if(r.isInstancedBufferGeometry===!0?c=r.instanceCount:e.count!==void 0&&(c=Math.max(0,e.count)),c===0)return null;if(o.instanceCount=c,e.isBatchedMesh===!0)return o;let u=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(u=2);let d=i.start*u,h=(i.start+i.count)*u;s!==null&&(d=Math.max(d,s.start*u),h=Math.min(h,(s.start+s.count)*u));const f=r.attributes.position;let p=1/0;l?p=a.count:f!=null&&(p=f.count),d=Math.max(d,0),h=Math.min(h,p);const m=h-d;return m<0||m===1/0?null:(o.vertexCount=m,o.firstVertex=d,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const s=e.attributes[r];t+=r+",",s.data&&(t+=s.data.stride+","),s.offset&&(t+=s.offset+","),s.itemSize&&(t+=s.itemSize+","),s.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const s=e.morphAttributes[r];t+="morph-"+r+",";for(let i=0,o=s.length;i<o;i++){const a=s[i];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:r}=this;let s=t.customProgramCacheKey();for(const i of tG(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const o=t[i];let a;if(o!==null){const l=typeof o;l==="number"?a=o!==0?"1":"0":l==="object"?(a="{",o.isTexture&&(a+=o.mapping,r.backend.isWebGPUBackend===!0&&(a+=o.magFilter,a+=o.minFilter,a+=o.wrapS,a+=o.wrapT,a+=o.wrapR)),a+="}"):a=String(o)}else a=String(o);s+=a+","}return s+=this.clippingContextCacheKey+",",e.geometry&&(s+=this.getGeometryCacheKey()),e.skeleton&&(s+=e.skeleton.bones.length+","),e.isBatchedMesh&&(s+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(s+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(s+=e.uuid+","),s+=e.receiveShadow+",",Eu(s)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const r=this.geometry.getAttribute(t);if(r===void 0||e[t]!==r.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=ca(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=ca(e,1)),e=ca(e,this.camera.id),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const _s=[];class rG{constructor(e,t,r,s,i,o){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=s,this.bindings=i,this.info=o,this.chainMaps={}}get(e,t,r,s,i,o,a,l){const c=this.getChainMap(l);_s[0]=e,_s[1]=t,_s[2]=o,_s[3]=i;let u=c.get(_s);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,s,i,o,a,l),c.set(_s,u)):(u.updateClipping(a),u.needsGeometryUpdate&&u.setGeometry(e.geometry),(u.version!==t.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,t,r,s,i,o,a,l)):u.version=t.version)),_s.length=0,u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ln)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,s,i,o,a,l,c,u,d){const h=this.getChainMap(d),f=new nG(e,t,r,s,i,o,a,l,c,u);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.deleteForRender(f),this.nodes.delete(f),h.delete(f.getChainArray())},f}}class cs{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const pn={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Xr=16,sG=211,iG=212;class oG extends cs{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(r.version===void 0)t===pn.VERTEX?this.backend.createAttribute(e):t===pn.INDEX?this.backend.createIndexAttribute(e):t===pn.STORAGE?this.backend.createStorageAttribute(e):t===pn.INDIRECT&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const s=this._getBufferAttribute(e);(r.version<s.version||s.usage===wi)&&(this.backend.updateAttribute(e),r.version=s.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function _S(n){return n.index!==null?n.index.version:n.attributes.position.version}function My(n){const e=[],t=n.index,r=n.attributes.position;if(t!==null){const i=t.array;for(let o=0,a=i.length;o<a;o+=3){const l=i[o+0],c=i[o+1],u=i[o+2];e.push(l,c,c,u,u,l)}}else{const i=r.array;for(let o=0,a=i.length/3-1;o<a;o+=3){const l=o+0,c=o+1,u=o+2;e.push(l,c,c,u,u,l)}}const s=new(S2(e)?T2:w2)(e,1);return s.version=_S(n),s}class aG extends cs{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,r=this.get(t);r.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const i=t.index,o=e.getAttributes();i!==null&&this.attributes.delete(i);for(const l of o)this.attributes.delete(l);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",s),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",s),this._geometryDisposeListeners.set(t,s)}updateAttributes(e){const t=e.getAttributes();for(const i of t)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,pn.STORAGE):this.updateAttribute(i,pn.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,pn.INDEX);const s=e.geometry.indirect;s!==null&&this.updateAttribute(s,pn.INDIRECT)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:r}=e;let s=t.index;if(r.wireframe===!0){const i=this.wireframes;let o=i.get(t);o===void 0?(o=My(t),i.set(t,o)):o.version!==_S(t)&&(this.attributes.delete(o),o=My(t),i.set(t,o)),s=o}return s}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class lG{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):se("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class TS{constructor(e){this.cacheKey=e,this.usedTimes=0}}class cG extends TS{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class uG extends TS{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let dG=0;class Hd{constructor(e,t,r,s=null,i=null){this.id=dG++,this.code=e,this.stage=t,this.name=r,this.transforms=s,this.attributes=i,this.usedTimes=0}}class hG extends cs{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,s=this.get(e);if(this._needsComputeUpdate(e)){const i=s.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(i&&i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram),a=new Hd(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),r.createProgram(a));const l=this._getComputeCacheKey(e,a);let c=this.caches.get(l);c===void 0&&(i&&i.usedTimes===0&&this._releasePipeline(i),c=this._getComputePipeline(e,a,l,t)),c.usedTimes++,a.usedTimes++,s.version=e.version,s.pipeline=c}return s.pipeline}getForRender(e,t=null){const{backend:r}=this,s=this.get(e);if(this._needsRenderUpdate(e)){const i=s.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let l=this.programs.vertex.get(o.vertexShader);l===void 0&&(i&&i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),l=new Hd(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,l),r.createProgram(l));let c=this.programs.fragment.get(o.fragmentShader);c===void 0&&(i&&i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram),c=new Hd(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,c),r.createProgram(c));const u=this._getRenderCacheKey(e,l,c);let d=this.caches.get(u);d===void 0?(i&&i.usedTimes===0&&this._releasePipeline(i),d=this._getRenderPipeline(e,l,c,u,t)):e.pipeline=d,d.usedTimes++,l.usedTimes++,c.usedTimes++,s.pipeline=d}return s.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,s){r=r||this._getComputeCacheKey(e,t);let i=this.caches.get(r);return i===void 0&&(i=new uG(r,t),this.caches.set(r,i),this.backend.createComputePipeline(i,s)),i}_getRenderPipeline(e,t,r,s,i){s=s||this._getRenderCacheKey(e,t,r);let o=this.caches.get(s);return o===void 0&&(o=new cG(s,t,r),this.caches.set(s,o),e.pipeline=o,this.backend.createRenderPipeline(e,i)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class fG extends cs{constructor(e,t,r,s,i,o){super(),this.backend=e,this.textures=r,this.pipelines=i,this.attributes=s,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const s=this.get(r);s.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),s.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const s=this.get(r);s.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),s.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t)this.delete(r)}deleteForRender(e){const t=e.getBindings();for(const r of t)this.delete(r)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const r=t.attribute,s=r.isIndirectStorageBufferAttribute?pn.INDIRECT:pn.STORAGE;this.attributes.update(r,s)}}_update(e,t){const{backend:r}=this;let s=!1,i=!0,o=0,a=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isStorageBuffer){const c=l.attribute,u=c.isIndirectStorageBufferAttribute?pn.INDIRECT:pn.STORAGE;this.attributes.update(c,u)}if(l.isUniformBuffer)l.update()&&r.updateBinding(l);else if(l.isSampledTexture){const c=l.update(),u=l.texture,d=this.textures.get(u);if(c&&(this.textures.updateTexture(u),l.generation!==d.generation&&(l.generation=d.generation,s=!0,i=!1)),r.get(u).externalTexture!==void 0||d.isDefaultTexture?i=!1:(o=o*10+u.id,a+=u.version),u.isStorageTexture===!0&&u.mipmapsAutoUpdate===!0){const f=this.get(u);l.store===!0?f.needsMipmap=!0:this.textures.needsMipmaps(u)&&f.needsMipmap===!0&&(this.backend.generateMipmaps(u),f.needsMipmap=!1)}}else if(l.isSampler&&l.update()){const u=this.textures.updateSampler(l.texture);l.samplerKey!==u&&(l.samplerKey=u,s=!0,i=!1)}}s===!0&&this.backend.updateBindings(e,t,i?o:0,a)}}function pG(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function Py(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Dy(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===js&&n.forceSinglePass===!1}class mG{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,s,i,o,a){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:r,groupOrder:s,renderOrder:e.renderOrder,z:i,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=r,l.groupOrder=s,l.renderOrder=e.renderOrder,l.z=i,l.group=o,l.clippingContext=a),this.renderItemsIndex++,l}push(e,t,r,s,i,o,a){const l=this.getNextRenderItem(e,t,r,s,i,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Dy(r)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,r,s,i,o,a){const l=this.getNextRenderItem(e,t,r,s,i,o,a);r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Dy(r)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||pG),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||Py),this.transparent.length>1&&this.transparent.sort(t||Py)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}const Oo=[];class gG{constructor(e){this.lighting=e,this.lists=new Ln}get(e,t){const r=this.lists;Oo[0]=e,Oo[1]=t;let s=r.get(Oo);return s===void 0&&(s=new mG(this.lighting,e,t),r.set(Oo,s)),Oo.length=0,s}dispose(){this.lists=new Ln}}let xG=0;class yG{constructor(){this.id=xG++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new et,this.scissor=!1,this.scissorValue=new et,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return wS(this)}}function wS(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:r}=n,s=[t,r];for(const i of e)s.push(i.id);return Za(s)}const Uo=[],bG=new fu,vG=new n2;class _G{constructor(){this.chainMaps={}}get(e,t,r=null){Uo[0]=e,Uo[1]=t;let s;if(r===null)s="default";else{const a=r.texture.format;s=`${r.textures.length}:${a}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const i=this._getChainMap(s);let o=i.get(Uo);return o===void 0&&(o=new yG,i.set(Uo,o)),Uo.length=0,r!==null&&(o.sampleCount=r.samples===0?1:r.samples),o}getForClear(e=null){return this.get(bG,vG,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ln)}dispose(){this.chainMaps={}}}const TG=new ce;class wG extends cs{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),s=e.samples===0?1:e.samples,i=r.depthTextureMips||(r.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),l=a.width>>t,c=a.height>>t;let u=e.depthTexture||i[t];const d=e.depthBuffer===!0||e.stencilBuffer===!0;let h=!1;u===void 0&&d&&(u=new Qn,u.format=e.stencilBuffer?Zr:Jr,u.type=e.stencilBuffer?Qr:mt,u.image.width=l,u.image.height=c,u.image.depth=a.depth,u.renderTarget=e,u.isArrayTexture=e.multiview===!0&&a.depth>1,i[t]=u),(r.width!==a.width||a.height!==r.height)&&(h=!0,u&&(u.needsUpdate=!0,u.image.width=l,u.image.height=c,u.image.depth=u.isArrayTexture?u.image.depth:1)),r.width=a.width,r.height=a.height,r.textures=o,r.depthTexture=u||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==s&&(h=!0,u&&(u.needsUpdate=!0),r.sampleCount=s);const f={sampleCount:s};if(e.isXRRenderTarget!==!0){for(let p=0;p<o.length;p++){const m=o[p];h&&(m.needsUpdate=!0),this.updateTexture(m,f)}u&&this.updateTexture(u,f)}r.initialized!==!0&&(r.initialized=!0,r.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",r.onDispose))}updateTexture(e,t={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const s=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(s&&r.initialized===!0&&i.destroyTexture(e),e.isFramebufferTexture){const c=this.renderer.getRenderTarget();c?e.type=c.texture.type:e.type=sn}const{width:o,height:a,depth:l}=this.getSize(e);if(t.width=o,t.height=a,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,s||e.isStorageTexture===!0||e.isExternalTexture===!0)i.createTexture(e,t),r.generation=e.version;else if(e.version>0){const c=e.image;if(c===void 0)ie("Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)ie("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const d=[];for(const h of e.images)d.push(h);t.images=d}else t.image=c;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(i.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),e.source.dataReady===!0&&i.updateTexture(e,t);const u=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!u&&i.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else i.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version;r.initialized!==!0&&(r.initialized=!0,r.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&pt.getTransfer(e.colorSpace)!==be&&ie("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),r.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",r.onDispose)),r.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=TG){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement?(t.width=r.videoWidth||1,t.height=r.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&r instanceof VideoFrame?(t.width=r.displayWidth||1,t.height=r.displayHeight||1,t.depth=1):(t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let s;return e.mipmaps.length>0?s=e.mipmaps.length:e.isCompressedTexture===!0?s=1:s=Math.floor(Math.log2(Math.max(t,r)))+1,s}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),r=t.textures,s=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let i=0;i<r.length;i++)this._destroyTexture(r[i]);s&&this._destroyTexture(s),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const r=t.isDefaultTexture;this.backend.destroyTexture(e,r),this.delete(e),this.info.memory.textures--}}}class Gm extends vn{constructor(e,t,r,s=1){super(e,t,r),this.a=s}set(e,t,r,s=1){return this.a=s,super.set(e,t,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class SG extends Ie{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const r=this.getNodeType(e),s=e.getStructTypeNode(r);let i;return s!==null?i=s.getMemberType(e,t):(se(`TSL: Member "${t}" not found in struct "${r}".`),i="float"),i}getHash(){return this.uuid}generate(){return this.name}}class NG extends ae{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e){return e.isNode!==!0?(se("TSL: Invalid node added to stack."),this):(this.nodes.push(e),this)}If(e,t){const r=new Jo(t);return this._currentCond=Ct(e,r),this.addToStack(this._currentCond)}ElseIf(e,t){const r=new Jo(t),s=Ct(e,r);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(e){return this._currentCond.elseNode=new Jo(e),this}Switch(e){return this._expressionNode=J(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(J(e[a])));else se("TSL: Invalid parameter length. Case() requires at least two parameters.");const r=e[e.length-1],s=new Jo(r);let i=t[0];for(let a=1;a<t.length;a++)i=i.or(t[a]);const o=Ct(i,s);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const s of this.getChildren())s.isVarNode&&s.intent===!0&&s.isAssign(e)!==!0||(t["node"+r++]=s);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const r=Z1();qc(this),e.setActiveStack(this);const s=e.buildStage;for(const o of this.nodes)if(!(o.isVarNode&&o.intent===!0&&o.isAssign(e)!==!0)){if(s==="setup")o.build(e);else if(s==="analyze")o.build(e,this);else if(s==="generate"){const a=e.getDataFromNode(o,"any").stages,l=a&&a[e.shaderStage];if(o.isVarNode&&l&&l.length===1&&l[0]&&l[0].isStackNode)continue;o.build(e,"void")}}let i;return this.hasOutput?i=this.outputNode.build(e,...t):i=super.build(e,...t),qc(r),e.removeActiveStack(this),i}}const Wd=Be(NG).setParameterLength(0,1);new hu;new ce;new ce;new ce;new In;new ce(0,0,-1);new et;new ce;new ce;new et;new we;const AG=new co;Gi.flipX();AG.depthTexture=new Qn(1,1);const qd=new Ip(-1,1,1,-1,0,1);class EG extends Wa{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Mc([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Mc(t,2))}}const CG=new EG;class $m extends kn{constructor(e=null){super(CG,e),this.camera=qd,this.isQuadMesh=!0}async renderAsync(e){ft('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,qd)}render(e){e.render(this,qd)}}Y(([n])=>rr($(52.9829189).mul(rr(eo(n,ne(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]});class Ar extends ae{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Ar.OBJECT?this.updateType=_e.OBJECT:e===Ar.MATERIAL?this.updateType=_e.RENDER:e===Ar.BEFORE_OBJECT?this.updateBeforeType=_e.OBJECT:e===Ar.BEFORE_MATERIAL&&(this.updateBeforeType=_e.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Ar.OBJECT="object";Ar.MATERIAL="material";Ar.BEFORE_OBJECT="beforeObject";Ar.BEFORE_MATERIAL="beforeMaterial";const Vo=new k_,Xd=new In;class Kt extends ae{static get type(){return"SceneNode"}constructor(e=Kt.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=this.scene!==null?this.scene:e.scene;let s;return t===Kt.BACKGROUND_BLURRINESS?s=Ve("backgroundBlurriness","float",r):t===Kt.BACKGROUND_INTENSITY?s=Ve("backgroundIntensity","float",r):t===Kt.BACKGROUND_ROTATION?s=pe("mat4").setName("backgroundRotation").setGroup(fe).onRenderUpdate(()=>{const i=r.background;return i!==null&&i.isTexture&&i.mapping!==q2?(Vo.copy(r.backgroundRotation),Vo.x*=-1,Vo.y*=-1,Vo.z*=-1,Xd.makeRotationFromEuler(Vo)):Xd.identity(),Xd}):se("SceneNode: Unknown scope:",t),s}}Kt.BACKGROUND_BLURRINESS="backgroundBlurriness";Kt.BACKGROUND_INTENSITY="backgroundIntensity";Kt.BACKGROUND_ROTATION="backgroundRotation";const RG=re(Kt,Kt.BACKGROUND_BLURRINESS),By=re(Kt,Kt.BACKGROUND_INTENSITY),MG=re(Kt,Kt.BACKGROUND_ROTATION),PG=Y(({texture:n,uv:e})=>{const r=X().toVar();return Xe(e.x.lessThan(1e-4),()=>{r.assign(X(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{r.assign(X(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{r.assign(X(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{r.assign(X(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{r.assign(X(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{r.assign(X(0,0,-1))}).Else(()=>{const i=n.sample(e.add(X(-.01,0,0))).r.sub(n.sample(e.add(X(.01,0,0))).r),o=n.sample(e.add(X(0,-.01,0))).r.sub(n.sample(e.add(X(0,.01,0))).r),a=n.sample(e.add(X(0,0,-.01))).r.sub(n.sample(e.add(X(0,0,.01))).r);r.assign(X(i,o,a))}),r.normalize()});class DG extends po{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return X(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(ze(Ws(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return PG({texture:this,uv:e})}}const BG=Be(DG).setParameterLength(1,3),Ll=new we;class kG extends po{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class ky extends kG{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Uu extends _t{static get type(){return"PassNode"}constructor(e,t,r,s={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const i=new Qn;i.isRenderTargetTexture=!0,i.name="depth";const o=new co(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:jt,...s});o.texture.name="output",o.depthTexture=i,this.renderTarget=o,this._textures={output:o.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=pe(0),this._cameraFar=pe(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=_e.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return ie("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return ie("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const r=this._textures[e],s=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[s]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=J(new ky(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=J(new ky(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const r=this._cameraNear,s=this._cameraFar;this._viewZNodes[e]=t=tS(this.getTextureNode(e),r,s)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const r=this._cameraNear,s=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=pa(i,r,s)}return t}async compileAsync(e){const t=e.getRenderTarget(),r=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(r)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getColorBufferType(),this.scope===Uu.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let s,i;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(i=1,s=t.xr.getCamera(),t.xr.updateCamera(s),Ll.set(o.width,o.height)):(s=this.camera,i=t.getPixelRatio(),t.getSize(Ll)),this._pixelRatio=i,this.setSize(Ll.width,Ll.height);const a=t.getRenderTarget(),l=t.getMRT(),c=t.autoClear,u=s.layers.mask;this._cameraNear.value=s.near,this._cameraFar.value=s.far,this._layers!==null&&(s.layers.mask=this._layers.mask);for(const h in this._previousTextures)this.toggleTexture(h);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0;const d=r.name;r.name=this.name?this.name:r.name,t.render(r,s),r.name=d,t.setRenderTarget(a),t.setMRT(l),t.autoClear=c,s.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const r=Math.floor(this._width*this._pixelRatio*this._resolutionScale),s=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(r,s),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,r,s){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new et),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,r,s),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,r,s){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new et),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,r,s),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Uu.COLOR="color";Uu.DEPTH="depth";const FG=Y(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),LG=Y(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),IG=Y(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),r=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),OG=Y(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),UG=Y(([n,e])=>{const t=$t(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=$t(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=OG(n),n=r.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),VG=$t(X(1.6605,-.1246,-.0182),X(-.5876,1.1329,-.1006),X(-.0728,-.0083,1.1187)),jG=$t(X(.6274,.0691,.0164),X(.3293,.9195,.088),X(.0433,.0113,.8956)),GG=Y(([n])=>{const e=X(n).toVar(),t=X(e.mul(e)).toVar(),r=X(t.mul(t)).toVar();return $(15.5).mul(r.mul(t)).sub(Te(40.14,r.mul(e))).add(Te(31.96,r).sub(Te(6.868,t.mul(e))).add(Te(.4298,t).add(Te(.1191,e).sub(.00232))))}),$G=Y(([n,e])=>{const t=X(n).toVar(),r=$t(X(.856627153315983,.137318972929847,.11189821299995),X(.0951212405381588,.761241990602591,.0767994186031903),X(.0482516061458583,.101439036467562,.811302368396859)),s=$t(X(1.1271005818144368,-.1413297634984383,-.14132976349843826),X(-.11060664309660323,1.157823702216272,-.11060664309660294),X(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=$(-12.47393),o=$(4.026069);return t.mulAssign(e),t.assign(jG.mul(t)),t.assign(r.mul(t)),t.assign(vt(t,1e-10)),t.assign(Cr(t)),t.assign(t.sub(i).div(o.sub(i))),t.assign(Dr(t,0,1)),t.assign(GG(t)),t.assign(s.mul(t)),t.assign(Mu(vt(X(0),t),X(2.2))),t.assign(VG.mul(t)),t.assign(Dr(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),zG=Y(([n,e])=>{const t=$(.76),r=$(.15);n=n.mul(e);const s=Ji(n.r,Ji(n.g,n.b)),i=Ct(s.lessThan(.08),s.sub(Te(6.25,s.mul(s))),.04);n.subAssign(i);const o=vt(n.r,vt(n.g,n.b));Xe(o.lessThan(t),()=>n);const a=Ut(1,t),l=Ut(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(l.div(o));const c=Ut(1,nr(1,r.mul(o.sub(l)).add(1)));return We(n,X(l),c)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Nt extends ae{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const s of t)s.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class HG extends Nt{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),s=r.name,i=r.type,o=e.getCodeFromNode(this,i);s!==""&&(o.name=s);const a=e.getPropertyName(o),l=this.getNodeFunction(e).getCode(a);return o.code=l+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}function SS(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||ct.z).negate()}const WG=Y(([n,e],t)=>{const r=SS(t);return Br(n,e,r)}),qG=Y(([n],e)=>{const t=SS(e);return n.mul(n,t,t).negate().exp().oneMinus()}),Fy=Y(([n,e])=>ve(e.toFloat().mix(da.rgb,n.toVec3()),da.a));class XG extends ae{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;r.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Be(XG);class lr extends ae{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,s=this.method,i=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,l=this.valueNode,c=[];c.push(`&${a.build(e,o)}`),l!==null&&c.push(l.build(e,o));const u=`${e.getMethod(s,i)}( ${c.join(", ")} )`;if(r?r.length===1&&r[0].isStackNode===!0:!1)e.addLineFlowCode(u,this);else return t.constNode===void 0&&(t.constNode=to(u,i).toConst()),t.constNode.build(e)}}lr.ATOMIC_LOAD="atomicLoad";lr.ATOMIC_STORE="atomicStore";lr.ATOMIC_ADD="atomicAdd";lr.ATOMIC_SUB="atomicSub";lr.ATOMIC_MAX="atomicMax";lr.ATOMIC_MIN="atomicMin";lr.ATOMIC_AND="atomicAnd";lr.ATOMIC_OR="atomicOr";lr.ATOMIC_XOR="atomicXor";Be(lr);class De extends _t{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=r}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,r=this.bNode?this.bNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),i=e.isMatrix(r)?0:e.getTypeLength(r);return s>i?t:r}getNodeType(e){const t=this.method;return t===De.SUBGROUP_ELECT?"bool":t===De.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const r=this.method,s=this.getNodeType(e),i=this.getInputType(e),o=this.aNode,a=this.bNode,l=[];if(r===De.SUBGROUP_BROADCAST||r===De.SUBGROUP_SHUFFLE||r===De.QUAD_BROADCAST){const u=a.getNodeType(e);l.push(o.build(e,s),a.build(e,u==="float"?"int":s))}else r===De.SUBGROUP_SHUFFLE_XOR||r===De.SUBGROUP_SHUFFLE_DOWN||r===De.SUBGROUP_SHUFFLE_UP?l.push(o.build(e,s),a.build(e,"uint")):(o!==null&&l.push(o.build(e,i)),a!==null&&l.push(a.build(e,i)));const c=l.length===0?"()":`( ${l.join(", ")} )`;return e.format(`${e.getMethod(r,s)}${c}`,s,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}De.SUBGROUP_ELECT="subgroupElect";De.SUBGROUP_BALLOT="subgroupBallot";De.SUBGROUP_ADD="subgroupAdd";De.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";De.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";De.SUBGROUP_MUL="subgroupMul";De.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";De.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";De.SUBGROUP_AND="subgroupAnd";De.SUBGROUP_OR="subgroupOr";De.SUBGROUP_XOR="subgroupXor";De.SUBGROUP_MIN="subgroupMin";De.SUBGROUP_MAX="subgroupMax";De.SUBGROUP_ALL="subgroupAll";De.SUBGROUP_ANY="subgroupAny";De.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";De.QUAD_SWAP_X="quadSwapX";De.QUAD_SWAP_Y="quadSwapY";De.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";De.SUBGROUP_BROADCAST="subgroupBroadcast";De.SUBGROUP_SHUFFLE="subgroupShuffle";De.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";De.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";De.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";De.QUAD_BROADCAST="quadBroadcast";let Il;function Vu(n){Il=Il||new WeakMap;let e=Il.get(n);return e===void 0&&Il.set(n,e={}),e}function zm(n){const e=Vu(n);return e.shadowMatrix||(e.shadowMatrix=pe("mat4").setGroup(fe).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function KG(n,e=no){const t=zm(n).mul(e);return t.xyz.div(t.w)}function NS(n){const e=Vu(n);return e.position||(e.position=pe(new ce).setGroup(fe).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.matrixWorld)))}function YG(n){const e=Vu(n);return e.targetPosition||(e.targetPosition=pe(new ce).setGroup(fe).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.target.matrixWorld)))}function AS(n){const e=Vu(n);return e.viewPosition||(e.viewPosition=pe(new ce).setGroup(fe).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new ce,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const ES=n=>Lr.transformDirection(NS(n).sub(YG(n))),QG=n=>n.sort((e,t)=>e.id-t.id),ZG=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},Kd=new WeakMap,jo=[];class CS extends ae{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=rs("vec3","totalDiffuse"),this.totalSpecularNode=rs("vec3","totalSpecular"),this.outgoingLightNode=rs("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const s=e[r];if(jo.push(s.id),jo.push(s.castShadow?1:0),s.isSpotLight===!0){const i=s.map!==null?s.map.id:-1,o=s.colorNode?s.colorNode.getCacheKey():-1;jo.push(i,o)}}const t=Za(jo);return jo.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const r of this._lightNodes)t.push(r.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,s=QG(this._lights),i=e.renderer.library;for(const o of s)if(o.isNode)t.push(J(o));else{let a=null;if(r!==null&&(a=ZG(o.id,r)),a===null){const l=i.getLightNodeClass(o.constructor);if(l===null){ie(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let c=null;Kd.has(o)?c=Kd.get(o):(c=J(new l(o)),Kd.set(o,c)),t.push(c)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:s,reflectedLight:i}=e.context;s.direct({...r,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:s,reflectedLight:i}=e.context;s.directRectArea({...r,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const s=e.context,i=s.lightingModel,o=e.getNodeProperties(this);if(i){const{totalDiffuseNode:a,totalSpecularNode:l}=this;s.outgoingLight=r;const c=e.addStack();o.nodes=c.nodes,i.start(e);const{backdrop:u,backdropAlpha:d}=s,{directDiffuse:h,directSpecular:f,indirectDiffuse:p,indirectSpecular:m}=s.reflectedLight;let y=h.add(p);u!==null&&(d!==null?y=X(d.mix(y,u)):y=X(u)),a.assign(y),l.assign(f.add(m)),r.assign(a.add(l)),i.finish(e),r=r.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class JG extends ae{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=_e.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){RS.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||no)}}const RS=rs("vec3","shadowPositionWorld");function e$(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new vn),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function t$(n,e){return e=e$(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function n$(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function r$(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function s$(n,e){return e=r$(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function i$(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function o$(n,e,t){return t=t$(n,t),t=s$(e,t),t}function a$(n,e,t){n$(n,t),i$(e,t)}const Ly=new WeakMap,l$=Y(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Ce(n,e.xy).setName("t_basic");return n.isArrayTexture&&(r=r.depth(t)),r.compare(e.z)}),c$=Y(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const s=(y,x)=>{let b=Ce(n,y);return n.isArrayTexture&&(b=b.depth(r)),b.compare(x)},i=Ve("mapSize","vec2",t).setGroup(fe),o=Ve("radius","float",t).setGroup(fe),a=ne(1).div(i),l=a.x.negate().mul(o),c=a.y.negate().mul(o),u=a.x.mul(o),d=a.y.mul(o),h=l.div(2),f=c.div(2),p=u.div(2),m=d.div(2);return Zt(s(e.xy.add(ne(l,c)),e.z),s(e.xy.add(ne(0,c)),e.z),s(e.xy.add(ne(u,c)),e.z),s(e.xy.add(ne(h,f)),e.z),s(e.xy.add(ne(0,f)),e.z),s(e.xy.add(ne(p,f)),e.z),s(e.xy.add(ne(l,0)),e.z),s(e.xy.add(ne(h,0)),e.z),s(e.xy,e.z),s(e.xy.add(ne(p,0)),e.z),s(e.xy.add(ne(u,0)),e.z),s(e.xy.add(ne(h,m)),e.z),s(e.xy.add(ne(0,m)),e.z),s(e.xy.add(ne(p,m)),e.z),s(e.xy.add(ne(l,d)),e.z),s(e.xy.add(ne(0,d)),e.z),s(e.xy.add(ne(u,d)),e.z)).mul(1/17)}),u$=Y(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const s=(d,h)=>{let f=Ce(n,d);return n.isArrayTexture&&(f=f.depth(r)),f.compare(h)},i=Ve("mapSize","vec2",t).setGroup(fe),o=ne(1).div(i),a=o.x,l=o.y,c=e.xy,u=rr(c.mul(i).add(.5));return c.subAssign(u.mul(o)),Zt(s(c,e.z),s(c.add(ne(a,0)),e.z),s(c.add(ne(0,l)),e.z),s(c.add(o),e.z),We(s(c.add(ne(a.negate(),0)),e.z),s(c.add(ne(a.mul(2),0)),e.z),u.x),We(s(c.add(ne(a.negate(),l)),e.z),s(c.add(ne(a.mul(2),l)),e.z),u.x),We(s(c.add(ne(0,l.negate())),e.z),s(c.add(ne(0,l.mul(2))),e.z),u.y),We(s(c.add(ne(a,l.negate())),e.z),s(c.add(ne(a,l.mul(2))),e.z),u.y),We(We(s(c.add(ne(a.negate(),l.negate())),e.z),s(c.add(ne(a.mul(2),l.negate())),e.z),u.x),We(s(c.add(ne(a.negate(),l.mul(2))),e.z),s(c.add(ne(a.mul(2),l.mul(2))),e.z),u.x),u.y)).mul(1/9)}),d$=Y(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{const r=$(1).toVar();let s=Ce(n).sample(e.xy);n.isArrayTexture&&(s=s.depth(t)),s=s.rg;const i=xw(e.z,s.x);return Xe(i.notEqual($(1)),()=>{const o=e.z.sub(s.x),a=vt(0,s.y.mul(s.y));let l=a.div(a.add(o.mul(o)));l=Dr(Ut(l,.3).div(.95-.3)),r.assign(Dr(vt(i,l)))}),r}),h$=Y(([n,e,t])=>{let r=no.sub(n).length();return r=r.sub(e).div(t.sub(e)),r=r.saturate(),r}),f$=n=>{const e=n.shadow.camera,t=Ve("near","float",e).setGroup(fe),r=Ve("far","float",e).setGroup(fe),s=k5(n);return h$(s,t,r)},p$=n=>{let e=Ly.get(n);if(e===void 0){const t=n.isPointLight?f$(n):null;e=new ut,e.colorNode=ve(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,Ly.set(n,e)}return e},Iy=new Ln,xi=[],m$=(n,e,t,r)=>{xi[0]=n,xi[1]=e;let s=Iy.get(xi);return(s===void 0||s.shadowType!==t||s.useVelocity!==r)&&(s=(i,o,a,l,c,u,...d)=>{(i.castShadow===!0||i.receiveShadow&&t===lc)&&(r&&(X1(i).useVelocity=!0),i.onBeforeShadow(n,i,a,e.camera,l,o.overrideMaterial,u),n.renderObject(i,o,a,l,c,u,...d),i.onAfterShadow(n,i,a,e.camera,l,o.overrideMaterial,u))},s.shadowType=t,s.useVelocity=r,Iy.set(xi,s)),xi[0]=null,xi[1]=null,s},g$=Y(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:s})=>{const i=$(0).toVar("meanVertical"),o=$(0).toVar("squareMeanVertical"),a=n.lessThanEqual($(1)).select($(0),$(2).div(n.sub(1))),l=n.lessThanEqual($(1)).select($(0),$(-1));hn({start:ze(0),end:ze(n),type:"int",condition:"<"},({i:u})=>{const d=l.add($(u).mul(a));let h=r.sample(Zt(Du.xy,ne(0,d).mul(e)).div(t));r.value.isArrayTexture&&(h=h.depth(s)),h=h.x,i.addAssign(h),o.addAssign(h.mul(h))}),i.divAssign(n),o.divAssign(n);const c=Os(o.sub(i.mul(i)));return ne(i,c)}),x$=Y(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:s})=>{const i=$(0).toVar("meanHorizontal"),o=$(0).toVar("squareMeanHorizontal"),a=n.lessThanEqual($(1)).select($(0),$(2).div(n.sub(1))),l=n.lessThanEqual($(1)).select($(0),$(-1));hn({start:ze(0),end:ze(n),type:"int",condition:"<"},({i:u})=>{const d=l.add($(u).mul(a));let h=r.sample(Zt(Du.xy,ne(d,0).mul(e)).div(t));r.value.isArrayTexture&&(h=h.depth(s)),i.addAssign(h.x),o.addAssign(Zt(h.y.mul(h.y),h.x.mul(h.x)))}),i.divAssign(n),o.divAssign(n);const c=Os(o.sub(i.mul(i)));return ne(i,c)}),y$=[l$,c$,u$,d$];let Yd;const Ol=new $m;class MS extends JG{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:s,shadow:i,depthLayer:o}){const a=s.x.greaterThanEqual(0).and(s.x.lessThanEqual(1)).and(s.y.greaterThanEqual(0)).and(s.y.lessThanEqual(1)).and(s.z.lessThanEqual(1)),l=t({depthTexture:r,shadowCoord:s,shadow:i,depthLayer:o});return a.select(l,$(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:s}=e,i=Ve("bias","float",r).setGroup(fe);let o=t,a;if(r.camera.isOrthographicCamera||s.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,s.coordinateSystem===mu&&(a=a.mul(2).sub(1));else{const l=o.w;o=o.xy.div(l);const c=Ve("near","float",r.camera).setGroup(fe),u=Ve("far","float",r.camera).setGroup(fe);a=nS(l.negate(),c,u)}return o=X(o.x,o.y.oneMinus(),a.add(i)),o}getShadowFilterFn(e){return y$[e]}setupRenderTarget(e,t){const r=new Qn(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=Gp;const s=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return s.texture.name="ShadowMap",s.texture.type=e.mapType,s.depthTexture=r,{shadowMap:s,depthTexture:r}}setupShadow(e){const{renderer:t,camera:r}=e,{light:s,shadow:i}=this,o=t.shadowMap.type,{depthTexture:a,shadowMap:l}=this.setupRenderTarget(i,e);if(i.camera.coordinateSystem=r.coordinateSystem,i.camera.updateProjectionMatrix(),o===lc&&i.isPointLightShadow!==!0){a.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Kr,type:jt,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Kr,type:jt,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Kr,type:jt,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Kr,type:jt,depthBuffer:!1}));let v=Ce(a);a.isArrayTexture&&(v=v.depth(this.depthLayer));let _=Ce(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(_=_.depth(this.depthLayer));const w=Ve("blurSamples","float",i).setGroup(fe),T=Ve("radius","float",i).setGroup(fe),N=Ve("mapSize","vec2",i).setGroup(fe);let S=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ut);S.fragmentNode=g$({samples:w,radius:T,size:N,shadowPass:v,depthLayer:this.depthLayer}).context(e.getSharedContext()),S.name="VSMVertical",S=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ut),S.fragmentNode=x$({samples:w,radius:T,size:N,shadowPass:_,depthLayer:this.depthLayer}).context(e.getSharedContext()),S.name="VSMHorizontal"}const c=Ve("intensity","float",i).setGroup(fe),u=Ve("normalBias","float",i).setGroup(fe),d=zm(s).mul(RS.add(mo.mul(u))),h=this.setupShadowCoord(e,d),f=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(f===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const p=o===lc&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,m=this.setupShadowFilter(e,{filterFn:f,shadowTexture:l.texture,depthTexture:p,shadowCoord:h,shadow:i,depthLayer:this.depthLayer});let y=Ce(l.texture,h);a.isArrayTexture&&(y=y.depth(this.depthLayer));const x=We(1,m.rgb.mix(y,1),c.mul(y.a)).toVar();this.shadowMap=l,this.shadow.map=l;const b=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return x.toInspector(`${b} / Color`,()=>Ce(this.shadowMap.texture)).toInspector(`${b} / Depth`,()=>cn(this.shadowMap.depthTexture,fo().mul(Ws(Ce(this.shadowMap.depthTexture)))).x.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Y(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let r=this._node;return this.setupShadowPosition(e),r===null&&(this._node=r=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&ie('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(r=e.material.receivedShadowNode(r)),r})()}renderShadow(e){const{shadow:t,shadowMap:r,light:s}=this,{renderer:i,scene:o}=e;t.updateMatrices(s),r.setSize(t.mapSize.width,t.mapSize.height,r.depth);const a=o.name;o.name=`Shadow Map [ ${s.name||"ID: "+s.id} ]`,i.render(o,t.camera),o.name=a}updateShadow(e){const{shadowMap:t,light:r,shadow:s}=this,{renderer:i,scene:o,camera:a}=e,l=i.shadowMap.type,c=t.depthTexture.version;this._depthVersionCached=c;const u=s.camera.layers.mask;(s.camera.layers.mask&4294967294)===0&&(s.camera.layers.mask=a.layers.mask);const d=i.getRenderObjectFunction(),h=i.getMRT(),f=h?h.has("velocity"):!1;Yd=o$(i,o,Yd),o.overrideMaterial=p$(r),i.setRenderObjectFunction(m$(i,s,l,f)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(d),l===lc&&s.isPointLightShadow!==!0&&this.vsmPass(i),s.camera.layers.mask=u,a$(i,o,Yd)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),Ol.material=this.vsmMaterialVertical,Ol.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Ol.material=this.vsmMaterialHorizontal,Ol.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const b$=(n,e)=>J(new MS(n,e)),v$=new vn,Wn=Y(([n,e])=>{const t=n.toVar(),r=rn(t),s=nr(1,vt(r.x,vt(r.y,r.z)));r.mulAssign(s),t.mulAssign(s.mul(e.mul(2).oneMinus()));const i=ne(t.xy).toVar(),a=e.mul(1.5).oneMinus();return Xe(r.z.greaterThanEqual(a),()=>{Xe(t.z.greaterThan(0),()=>{i.x.assign(Ut(4,t.x))})}).ElseIf(r.x.greaterThanEqual(a),()=>{const l=Zc(t.x);i.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(r.y.greaterThanEqual(a),()=>{const l=Zc(t.y);i.x.assign(t.x.add(l.mul(2)).add(2)),i.y.assign(t.z.mul(l).sub(2))}),ne(.125,.25).mul(i).add(ne(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),_$=Y(({depthTexture:n,bd3D:e,dp:t,texelSize:r})=>Ce(n,Wn(e,r.y)).compare(t)),T$=Y(({depthTexture:n,bd3D:e,dp:t,texelSize:r,shadow:s})=>{const i=Ve("radius","float",s).setGroup(fe),o=ne(-1,1).mul(i).mul(r.y);return Ce(n,Wn(e.add(o.xyy),r.y)).compare(t).add(Ce(n,Wn(e.add(o.yyy),r.y)).compare(t)).add(Ce(n,Wn(e.add(o.xyx),r.y)).compare(t)).add(Ce(n,Wn(e.add(o.yyx),r.y)).compare(t)).add(Ce(n,Wn(e,r.y)).compare(t)).add(Ce(n,Wn(e.add(o.xxy),r.y)).compare(t)).add(Ce(n,Wn(e.add(o.yxy),r.y)).compare(t)).add(Ce(n,Wn(e.add(o.xxx),r.y)).compare(t)).add(Ce(n,Wn(e.add(o.yxx),r.y)).compare(t)).mul(1/9)}),w$=Y(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:r})=>{const s=t.xyz.toVar(),i=s.length(),o=pe("float").setGroup(fe).onRenderUpdate(()=>r.camera.near),a=pe("float").setGroup(fe).onRenderUpdate(()=>r.camera.far),l=Ve("bias","float",r).setGroup(fe),c=pe(r.mapSize).setGroup(fe),u=$(1).toVar();return Xe(i.sub(a).lessThanEqual(0).and(i.sub(o).greaterThanEqual(0)),()=>{const d=i.sub(o).div(a.sub(o)).toVar();d.addAssign(l);const h=s.normalize(),f=ne(1).div(c.mul(ne(4,2)));u.assign(n({depthTexture:e,bd3D:h,dp:d,texelSize:f,shadow:r}))}),u}),Oy=new et,yi=new we,Go=new we;class S$ extends MS{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===Y2?_$:T$}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:r,depthTexture:s,shadowCoord:i,shadow:o}){return w$({filterFn:t,shadowTexture:r,depthTexture:s,shadowCoord:i,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:r,light:s}=this,{renderer:i,scene:o}=e,a=t.getFrameExtents();Go.copy(t.mapSize),Go.multiply(a),r.setSize(Go.width,Go.height),yi.copy(t.mapSize);const l=i.autoClear,c=i.getClearColor(v$),u=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha),i.clear();const d=t.getViewportCount();for(let h=0;h<d;h++){const f=t.getViewport(h),p=yi.x*f.x,m=Go.y-yi.y-yi.y*f.y;Oy.set(p,m,yi.x*f.z,yi.y*f.w),r.viewport.copy(Oy),t.updateMatrices(s,h);const y=o.name;o.name=`Point Light Shadow [ ${s.name||"ID: "+s.id} ] - Face ${h+1}`,i.render(o,t.camera),o.name=y}i.autoClear=l,i.setClearColor(c,u)}}const N$=(n,e)=>J(new S$(n,e));class ei extends go{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new vn,this.colorNode=e&&e.colorNode||pe(this.color).setGroup(fe),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=_e.FRAME}getHash(){return this.light.uuid}getLightVector(e){return AS(this.light).sub(e.context.positionView||ct)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return b$(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){const s=this.light.shadow.shadowNode;let i;s!==void 0?i=J(s):i=this.setupShadowNode(),this.shadowNode=i,this.shadowColorNode=r=this.colorNode.mul(i),this.baseColorNode=this.colorNode}this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const PS=Y(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const r=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(n.div(e).pow4().oneMinus().clamp().pow2()),r)}),A$=({color:n,lightVector:e,cutoffDistance:t,decayExponent:r})=>{const s=e.normalize(),i=e.length(),o=PS({lightDistance:i,cutoffDistance:t,decayExponent:r}),a=n.mul(o);return{lightDirection:s,lightColor:a}};class E$ extends ei{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=pe(0).setGroup(fe),this.decayExponentNode=pe(2).setGroup(fe)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return N$(this.light)}setupDirect(e){return A$({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Y(([n=fo()],{renderer:e,material:t})=>{const r=vw(n.mul(2).sub(1));let s;if(t.alphaToCoverage&&e.currentSamples>0){const i=$(r.fwidth()).toVar();s=Br(i.oneMinus(),i.add(1),r).oneMinus()}else s=Ct(r.greaterThan(1),0,1);return s});const C$=Y(([n,e])=>{const t=n.x,r=n.y,s=n.z;let i=e.element(0).mul(.886227);return i=i.add(e.element(1).mul(2*.511664).mul(r)),i=i.add(e.element(2).mul(2*.511664).mul(s)),i=i.add(e.element(3).mul(2*.511664).mul(t)),i=i.add(e.element(4).mul(2*.429043).mul(t).mul(r)),i=i.add(e.element(5).mul(2*.429043).mul(r).mul(s)),i=i.add(e.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),i=i.add(e.element(7).mul(2*.429043).mul(t).mul(s)),i=i.add(e.element(8).mul(.429043).mul(Te(t,t).sub(Te(r,r)))),i}),_n=new Gm;class R$ extends cs{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const s=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(i===null)s._clearColor.getRGB(_n),_n.a=s._clearColor.a;else if(i.isColor===!0)i.getRGB(_n),_n.a=1,o=!0;else if(i.isNode===!0){const l=this.get(e),c=i;_n.copy(s._clearColor);let u=l.backgroundMesh;if(u===void 0){let m=function(){i.removeEventListener("dispose",m),u.material.dispose(),u.geometry.dispose()};const h=Pu(ve(c).mul(By),{getUV:()=>MG.mul(V5),getTextureLevel:()=>RG});let f=Zw;f=f.setZ(f.w);const p=new ut;p.name="Background.material",p.side=Qt,p.depthTest=!1,p.depthWrite=!1,p.allowOverride=!1,p.fog=!1,p.lights=!1,p.vertexNode=f,p.colorNode=h,l.backgroundMeshNode=h,l.backgroundMesh=u=new kn(new Bp(1,32,32),p),u.frustumCulled=!1,u.name="Background.mesh",u.onBeforeRender=function(y,x,b){this.matrixWorld.copyPosition(b.matrixWorld)},i.addEventListener("dispose",m)}const d=c.getCacheKey();l.backgroundCacheKey!==d&&(l.backgroundMeshNode.node=ve(c).mul(By),l.backgroundMeshNode.needsUpdate=!0,u.material.needsUpdate=!0,l.backgroundCacheKey=d),t.unshift(u,u.geometry,u.material,0,0,null,null)}else se("Renderer: Unsupported background configuration.",i);const a=s.xr.getEnvironmentBlendMode();if(a==="additive"?_n.set(0,0,0,1):a==="alpha-blend"&&_n.set(0,0,0,0),s.autoClear===!0||o===!0){const l=r.clearColorValue;l.r=_n.r,l.g=_n.g,l.b=_n.b,l.a=_n.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),r.depthClearValue=s._clearDepth,r.stencilClearValue=s._clearStencil,r.clearColor=s.autoClearColor===!0,r.clearDepth=s.autoClearDepth===!0,r.clearStencil=s.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let M$=0;class Qf{constructor(e="",t=[],r=0,s=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=s,this.id=M$++}}class P${constructor(e,t,r,s,i,o,a,l,c,u=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=u,this.nodeAttributes=s,this.bindings=i,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=l,this.observer=c,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const s=new Qf(t.name,[],t.index,t.bindingsReference);e.push(s);for(const i of t.bindings)s.bindings.push(i.clone())}else e.push(t);return e}}class Uy{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class D${constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class DS{constructor(e,t,r=!1,s=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=s}}class B$ extends DS{constructor(e,t,r=null,s=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=s}}class k${constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let F$=0;class Qd{constructor(e=null){this.id=F$++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class L${constructor(e,t){this.name=e,this.members=t,this.output=!1}}class us{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class I$ extends us{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class O$ extends us{constructor(e,t=new we){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class U$ extends us{constructor(e,t=new ce){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class V$ extends us{constructor(e,t=new et){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class j$ extends us{constructor(e,t=new vn){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class G$ extends us{constructor(e,t=new D_){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class $$ extends us{constructor(e,t=new qa){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class z$ extends us{constructor(e,t=new In){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class H$ extends I${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class W$ extends O${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class q$ extends U${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class X$ extends V${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class K$ extends j${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Y$ extends G${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Q$ extends $${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Z$ extends z${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let J$=0;const Vy=new WeakMap,e8=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Ul=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class BS{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Wd(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Qd,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:J$++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===$s&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=Vy.get(this.renderer);return e===void 0&&(e=new Ln,Vy.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new co(e,t,r)}createCubeRenderTarget(e,t){return new oS(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),s=[];let i=!0;for(const a of t)s.push(a),i=i&&a.groupNode.shared!==!0;let o;return i?(o=r.get(s),o===void 0&&(o=new Qf(e,s,this.bindingsIndexes[e].group,s),r.set(s,o))):o=new Qf(e,s,this.bindingsIndexes[e].group,s),o}getBindGroupArray(e,t){const r=this.bindings[t];let s=r[e];return s===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=s=[]),s}getBindings(){let e=this.bindGroups;if(e===null){const t={},r=this.bindings;for(const s of Ix)for(const i in r[s]){const o=r[s][i];(t[i]||(t[i]=[])).push(...o)}e=[];for(const s in t){const i=t[s],o=this._getBindGroup(s,i);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,r)=>t.bindings[0].groupNode.order-r.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==_e.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==_e.NONE&&this.updateBeforeNodes.push(e),r!==_e.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Fn||e.magFilter===Oh||e.magFilter===wa||e.magFilter===Gs||e.minFilter===Fn||e.minFilter===Oh||e.minFilter===wa||e.minFilter===Gs}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return r.cache===void 0&&(r.cache=new Qd(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){ie("Abstract function.")}getInstanceIndex(){ie("Abstract function.")}getDrawIndex(){ie("Abstract function.")}getFrontFacing(){ie("Abstract function.")}getFragCoord(){ie("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){ie("Abstract function.")}generateTextureLod(){ie("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let s=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const o=r?r[i]:null;o!==null?s+=o.build(this,e):s+=this.generateConst(e),i<t-1&&(s+=", ")}return s+=" )",s}generateStruct(e,t,r=null){const s=[];for(const i of t){const{name:o,type:a}=i;r&&r[o]&&r[o].isNode?s.push(r[o].build(this,a)):s.push(this.generateConst(a))}return e+"( "+s.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new vn:e==="vec2"?t=new we:e==="vec3"?t=new ce:e==="vec4"&&(t=new et)),e==="float")return Ul(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Ul(t.r)}, ${Ul(t.g)}, ${Ul(t.b)} )`;const r=this.getTypeLength(e),s=this.getComponentType(e),i=o=>this.generateConst(s,o);if(r===2)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)} )`;if(r===3)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)} )`;if(r===4&&e!=="mat2")return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)}, ${i(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(i).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const r=this.attributes;for(const i of r)if(i.name===e)return i;const s=new Uy(e,t);return this.registerDeclaration(s),r.push(s),s}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Ot)return"int";if(t===mt)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let r=eO(e);const s=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(r=r.replace("vec","mat")),s+r}getTypeFromArray(e){return e8.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,s=e.itemSize,i=e.normalized;let o;return!(e instanceof B_)&&i!==!0&&(o=this.getTypeFromArray(r)),this.getTypeFromLength(s,o)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return r!==null?Number(r[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=Wd(this.stack);const e=Z1();return this.stacks.push(e),qc(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const r=this.getDataFromNode(t);r.stack=e}return this.stack=e.parent,qc(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let s=r.getData(e);s===void 0&&(s={},r.setData(e,s)),s[t]===void 0&&(s[t]={});let i=s[t];const o=s.any?s.any.subBuilds:null,a=this.getClosestSubBuild(o);return a&&(i.subBuildsCache===void 0&&(i.subBuildsCache={}),i=i.subBuildsCache[a]||(i.subBuildsCache[a]={}),i.subBuilds=o),i}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e);let s=r.bufferAttribute;if(s===void 0){const i=this.uniforms.index++;s=new Uy("nodeAttribute"+i,t,e),this.bufferAttributes.push(s),r.bufferAttribute=s}return s}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,r=null,s=this.shaderStage){const i=this.getDataFromNode(e,s,this.globalCache);let o=i.structType;if(o===void 0){const a=this.structs.index++;r===null&&(r="StructType"+a),o=new L$(r,t),this.structs[s].push(o),this.types[s][r]=e,i.structType=o}return o}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,s=null){const i=this.getDataFromNode(e,r,this.globalCache);let o=i.uniform;if(o===void 0){const a=this.uniforms.index++;o=new D$(s||"nodeUniform"+a,t,e),this.uniforms[r].push(o),this.registerDeclaration(o),i.uniform=o}return o}getVarFromNode(e,t=null,r=e.getNodeType(this),s=this.shaderStage,i=!1){const o=this.getDataFromNode(e,s),a=this.getSubBuildProperty("variable",o.subBuilds);let l=o[a];if(l===void 0){const c=i?"_const":"_var",u=this.vars[s]||(this.vars[s]=[]),d=this.vars[c]||(this.vars[c]=0);t===null&&(t=(i?"nodeConst":"nodeVar")+d,this.vars[c]++),a!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const h=e.getArrayCount(this);l=new DS(t,r,i,h),i||u.push(l),this.registerDeclaration(l),o[a]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,r=e.getNodeType(this),s=null,i=null){const o=this.getDataFromNode(e,"any"),a=this.getSubBuildProperty("varying",o.subBuilds);let l=o[a];if(l===void 0){const c=this.varyings,u=c.length;t===null&&(t="nodeVarying"+u),a!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),l=new B$(t,r,s,i),c.push(l),this.registerDeclaration(l),o[a]=l}return l}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),s=this.getPropertyName(e);let i=1,o=s;for(;r[o]!==void 0;)o=s+"_"+i++;i>1&&(e.name=o,ie(`TSL: Declaration name '${s}' of '${e.type}' already in use. Renamed to '${o}'.`)),r[o]=e}getCodeFromNode(e,t,r=this.shaderStage){const s=this.getDataFromNode(e);let i=s.code;if(i===void 0){const o=this.codes[r]||(this.codes[r]=[]),a=o.length;i=new k$("nodeCode"+a,t),o.push(i),s.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:s}=this.getDataFromNode(e);let i=!0,o=t;for(;o;){if(s.get(o)===!0){i=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(i)for(const a of r)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,r){const s=this.getDataFromNode(e),i=s.flowCodes||(s.flowCodes=[]),o=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);i.push(t),o.set(r,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new HG,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)r[o.name]=new SG(o.type,o.name);e.layout=null;const s=e.call(r),i=this.flowStagesNode(s,t.type);return e.layout=t,i}flowBuildStage(e,t,r=null){const s=this.getBuildStage();this.setBuildStage(t);const i=e.build(this,r);return this.setBuildStage(s),i}flowStagesNode(e,t=null){const r=this.flow,s=this.vars,i=this.declarations,o=this.cache,a=this.buildStage,l=this.stack,c={code:""};this.flow=c,this.vars={},this.declarations={},this.cache=new Qd,this.stack=Wd();for(const u of Lx)this.setBuildStage(u),c.result=e.build(this,t);return c.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=s,this.declarations=i,this.cache=o,this.stack=l,this.setBuildStage(a),c}getFunctionOperator(){return null}buildFunctionCode(){ie("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,s={code:""};return this.flow=s,s.result=e.build(this,t),this.flow=r,s}flowNodeFromShaderStage(e,t,r=null,s=null){const i=this.tab,o=this.cache,a=this.shaderStage,l=this.context;this.setShaderStage(e);const c={...this.context};delete c.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=c;let u=null;if(this.buildStage==="generate"){const d=this.flowChildNode(t,r);s!==null&&(d.code+=`${this.tab+s} = ${d.result};
`),this.flowCode[e]=this.flowCode[e]+d.code,u=d}else u=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=i,this.context=l,u}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){ie("Abstract function.")}getVaryings(){ie("Abstract function.")}getVar(e,t,r=null){return`${r!==null?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(r!==void 0)for(const s of r)t+=`${this.getVar(s.type,s.name)}; `;return t}getUniforms(){ie("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(t!==void 0)for(const s of t)r+=s.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){ie("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const r=this.subBuildLayers;for(let s=t.length-1;s>=0;s--){const i=t[s];if(r.includes(i))return i}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let r;t!==null?r=this.getClosestSubBuild(t):r=this.subBuildFn;let s;return r?s=e?r+"_"+e:r:s=e,s}build(){const{object:e,material:t,renderer:r}=this;if(t!==null){let s=r.library.fromMaterial(t);s===null&&(se(`NodeMaterial: Material "${t.type}" is not compatible.`),s=new ut),s.build(this)}else this.addFlow("compute",e);for(const s of Lx){this.setBuildStage(s),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const i of Ix){this.setShaderStage(i);const o=this.flowNodes[i];for(const a of o)s==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new H$(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new W$(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new q$(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new X$(e);if(t==="color")return new K$(e);if(t==="mat2")return new Y$(e);if(t==="mat3")return new Q$(e);if(t==="mat4")return new Z$(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,r){if(t=this.getVectorType(t),r=this.getVectorType(r),t===r||r===null||this.isReference(r))return e;const s=this.getTypeLength(t),i=this.getTypeLength(r);return s===16&&i===9?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:s===9&&i===4?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:s>4||i>4||i===0?e:s===i?`${this.getType(r)}( ${e} )`:s>i?(e=r==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,i)}`,this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),r)):i===4&&s>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:s===2?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(s===1&&i>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${pu} - Node System
`}}class jy{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return r===void 0&&(r={renderId:0,frameId:0},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===_e.FRAME){const s=this._getMaps(this.updateBeforeMap,r);s.frameId!==this.frameId&&e.updateBefore(this)!==!1&&(s.frameId=this.frameId)}else if(t===_e.RENDER){const s=this._getMaps(this.updateBeforeMap,r);s.renderId!==this.renderId&&e.updateBefore(this)!==!1&&(s.renderId=this.renderId)}else t===_e.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===_e.FRAME){const s=this._getMaps(this.updateAfterMap,r);s.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(s.frameId=this.frameId)}else if(t===_e.RENDER){const s=this._getMaps(this.updateAfterMap,r);s.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(s.renderId=this.renderId)}else t===_e.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===_e.FRAME){const s=this._getMaps(this.updateMap,r);s.frameId!==this.frameId&&e.update(this)!==!1&&(s.frameId=this.frameId)}else if(t===_e.RENDER){const s=this._getMaps(this.updateMap,r);s.renderId!==this.renderId&&e.update(this)!==!1&&(s.renderId=this.renderId)}else t===_e.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class Hm{constructor(e,t,r=null,s="",i=!1){this.type=e,this.name=t,this.count=r,this.qualifier=s,this.isConst=i}}Hm.isNodeFunctionInput=!0;class t8 extends ei{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:ES(this.light),lightColor:e}}}const Zd=new In,Vl=new In;let $o=null;class n8 extends ei{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=pe(new ce).setGroup(fe),this.halfWidth=pe(new ce).setGroup(fe),this.updateType=_e.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;Vl.identity(),Zd.copy(t.matrixWorld),Zd.premultiply(r),Vl.extractRotation(Zd),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Vl),this.halfHeight.value.applyMatrix4(Vl)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=Ce($o.LTC_FLOAT_1),r=Ce($o.LTC_FLOAT_2)):(t=Ce($o.LTC_HALF_1),r=Ce($o.LTC_HALF_2));const{colorNode:s,light:i}=this,o=AS(i);return{lightColor:s,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){$o=e}}class Wm extends ei{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=pe(0).setGroup(fe),this.penumbraCosNode=pe(0).setGroup(fe),this.cutoffDistanceNode=pe(0).setGroup(fe),this.decayExponentNode=pe(0).setGroup(fe),this.colorNode=pe(this.color).setGroup(fe)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:s}=this;return Br(r,s,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return r===void 0&&(r=KG(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:s,light:i}=this,o=this.getLightVector(e),a=o.normalize(),l=a.dot(ES(i)),c=this.getSpotAttenuation(e,l),u=o.length(),d=PS({lightDistance:u,cutoffDistance:r,decayExponent:s});let h=t.mul(c).mul(d),f,p;return i.colorNode?(p=this.getLightCoord(e),f=i.colorNode(p)):i.map&&(p=this.getLightCoord(e),f=Ce(i.map,p.xy).onRenderUpdate(()=>i.map)),f&&(h=p.mul(2).sub(1).abs().lessThan(1).all().select(h.mul(f),h)),{lightColor:h,lightDirection:a}}}class r8 extends Wm{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let s=null;if(r&&r.isTexture===!0){const i=t.acos().mul(1/Math.PI);s=Ce(r,ne(i,0),0).r}else s=super.getSpotAttenuation(t);return s}}const s8=Y(([n,e])=>{const t=n.abs().sub(e);return Rr(vt(t,0)).add(Ji(vt(t.x,t.y),0))});class i8 extends Wm{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let r=1;t.map!==null&&(r=t.map.width/t.map.height),t.shadow.aspect=r}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=$(0),r=this.penumbraCosNode,s=zm(this.light).mul(e.context.positionWorld||no);return Xe(s.w.greaterThan(0),()=>{const i=s.xyz.div(s.w),o=s8(i.xy.sub(ne(.5)),ne(.5)),a=nr(-1,Ut(1,hw(r)).sub(1));t.assign(_w(o.mul(-2).mul(a)))}),t}}class o8 extends ei{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class a8 extends ei{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=NS(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=pe(new vn).setGroup(fe)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:s}=this,o=mo.dot(s).mul(.5).add(.5),a=We(r,t,o);e.context.irradiance.addAssign(a)}}class l8 extends ei{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new ce);this.lightProbe=Mn(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=C$(mo,this.lightProbe);e.context.irradiance.addAssign(t)}}class kS{parseFunction(){ie("Abstract function.")}}class qm{constructor(e,t,r="",s=""){this.type=e,this.inputs=t,this.name=r,this.precision=s}getCode(){ie("Abstract function.")}}qm.isNodeFunction=!0;const c8=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,u8=/[a-z_0-9]+/ig,Gy="#pragma main",d8=n=>{n=n.trim();const e=n.indexOf(Gy),t=e!==-1?n.slice(e+Gy.length):n,r=t.match(c8);if(r!==null&&r.length===5){const s=r[4],i=[];let o=null;for(;(o=u8.exec(s))!==null;)i.push(o);const a=[];let l=0;for(;l<i.length;){const p=i[l][0]==="const";p===!0&&l++;let m=i[l][0];m==="in"||m==="out"||m==="inout"?l++:m="";const y=i[l++][0];let x=Number.parseInt(i[l][0]);Number.isNaN(x)===!1?l++:x=null;const b=i[l++][0];a.push(new Hm(y,b,x,m,p))}const c=t.substring(r[0].length),u=r[3]!==void 0?r[3]:"",d=r[2],h=r[1]!==void 0?r[1]:"",f=e!==-1?n.slice(0,e):"";return{type:d,inputs:a,name:u,precision:h,inputsCode:s,blockCode:c,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class h8 extends qm{constructor(e){const{type:t,inputs:r,name:s,precision:i,inputsCode:o,blockCode:a,headerCode:l}=d8(e);super(t,r,s,i),this.inputsCode=o,this.blockCode=a,this.headerCode=l}getCode(e=this.name){let t;const r=this.blockCode;if(r!==""){const{type:s,inputsCode:i,headerCode:o,precision:a}=this;let l=`${s} ${e} ( ${i.trim()} )`;a!==""&&(l=`${a} ${l}`),t=o+l+r}else t="";return t}}class f8 extends kS{parseFunction(e){return new h8(e)}}const $y=new WeakMap,zn=[],Or=[];class p8 extends cs{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new jy,this.nodeBuilderCache=new Map,this.callHashCache=new Ln,this.groupsData=new Ln,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===aw.name)return!0;if(r===fe.name){const i=this.get(e),o=this.nodeFrame.renderId;return i.renderId!==o?(i.renderId=o,!0):!1}if(r===UO.name){const i=this.get(e),o=this.nodeFrame.frameId;return i.frameId!==o?(i.frameId=o,!0):!1}zn[0]=t,zn[1]=e;let s=this.groupsData.get(zn);return s===void 0&&this.groupsData.set(zn,s={}),zn.length=0,s.version!==t.version?(s.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:s}=this,i=this.getForRenderCacheKey(e);if(r=s.get(i),r===void 0){const o=l=>{const c=this.backend.createNodeBuilder(e.object,this.renderer);return c.scene=e.scene,c.material=l,c.camera=e.camera,c.context.material=l,c.lightsNode=e.lightsNode,c.environmentNode=this.getEnvironmentNode(e.scene),c.fogNode=this.getFogNode(e.scene),c.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&c.enableMultiview(),c};let a=o(e.material);try{a.build()}catch(l){a=o(new ut),a.build(),se("TSL: "+l)}r=this._createNodeBuilderState(a),s.set(i,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const s=this.backend.createNodeBuilder(e,this.renderer);s.build(),r=this._createNodeBuilderState(s),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new P$(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){zn[0]=e,zn[1]=t;const r=this.renderer.info.calls,s=this.callHashCache.get(zn)||{};if(s.callId!==r){const i=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Or.push(t.getCacheKey(!0)),i&&Or.push(i.getCacheKey()),o&&Or.push(o.getCacheKey()),Or.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Or.push(this.renderer.shadowMap.enabled?1:0),Or.push(this.renderer.shadowMap.type),s.callId=r,s.cacheKey=Za(Or),this.callHashCache.set(zn,s),Or.length=0}return zn.length=0,s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const s=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==r||s){const i=this.getCacheNode("background",r,()=>{if(r.isCubeTexture===!0||r.mapping===Op||r.mapping===Up||r.mapping===Ih){if(e.backgroundBlurriness>0||r.mapping===Ih)return xS(r);{let o;return r.isCubeTexture===!0?o=Fa(r):o=Ce(r),lS(o)}}else{if(r.isTexture===!0)return Ce(r,Gi.flipY()).setUpdateMatrix(!0);r.isColor!==!0&&se("WebGPUNodes: Unsupported background configuration.",r)}},s);t.backgroundNode=i,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,s=!1){const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=i.get(t);return(o===void 0||s)&&(o=r(),i.set(t,o)),o}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const s=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const i=Ve("color","color",r).setGroup(fe),o=Ve("density","float",r).setGroup(fe);return Fy(i,qG(o))}else if(r.isFog){const i=Ve("color","color",r).setGroup(fe),o=Ve("near","float",r).setGroup(fe),a=Ve("far","float",r).setGroup(fe);return Fy(i,WG(o,a))}else se("Renderer: Unsupported fog configuration.",r)});t.fogNode=s,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const s=this.getCacheNode("environment",r,()=>{if(r.isCubeTexture===!0)return Fa(r);if(r.isTexture===!0)return Ce(r);se("Nodes: Unsupported environment configuration.",r)});t.environmentNode=s,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,s=null,i=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=r,o.camera=s,o.material=i,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return $y.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),s=e.isArrayTexture?BG(e,X(Gi,tl("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Ce(e,Gi).renderOutput(t.toneMapping,t.currentColorSpace);return $y.set(e,r),s}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const s of r.updateNodes)t.updateNode(s)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const s of r.updateNodes)t.updateNode(s)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new jy,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Jd=new hu;class tu{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new qa,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const s=e.length;for(let i=0;i<s;i++){Jd.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[r+i],a=Jd.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=Jd.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const s=t.clippingPlanes,i=s.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+i){o.length=a+i;for(let l=0;l<i;l++)o[a+l]=new et;r=!0}this.projectPlanes(s,o,a),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new tu(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class m8{constructor(e,t){this.bundleGroup=e,this.camera=t}}const zo=[];class g8{constructor(){this.bundles=new Ln}get(e,t){const r=this.bundles;zo[0]=e,zo[1]=t;let s=r.get(zo);return s===void 0&&(s=new m8(e,t),r.set(zo,s)),zo.length=0,s}dispose(){this.bundles=new Ln}}class FS{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(r!==null){t=new r;for(const s in e)t[s]=e[s]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t)){ie(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}addClass(e,t,r){if(r.has(t)){ie(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}const x8=new CS,Ho=[];class y8 extends Ln{constructor(){super()}createNode(e=[]){return new CS().setLights(e)}getNode(e,t){if(e.isQuadMesh)return x8;Ho[0]=e,Ho[1]=t;let r=this.get(Ho);return r===void 0&&(r=this.createNode(),this.set(Ho,r)),Ho.length=0,r}}class ta extends co{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const zy=new ce,Hy=new ce;class b8 extends Lp{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new _a,this._cameraL.viewport=new et,this._cameraR=new _a,this._cameraR.viewport=new et,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new JE,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=N8.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new we,this._onSessionEvent=T8.bind(this),this._onSessionEnd=w8.bind(this),this._onInputSourcesChange=S8.bind(this),this._onAnimationFrame=A8.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&ie("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&ie("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,s,i,o,a,l={}){const c=new e2(e,t),u=new ta(i,o,{format:Pn,type:sn,depthTexture:new Qn(i,o,l.stencil?Qr:mt,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?Zr:Jr),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});u._autoAllocateDepthBuffer=!0;const d=new Hr({color:16777215,side:sa});d.map=u.texture,d.map.offset.y=1,d.map.repeat.y=-1;const h=new kn(c,d);h.position.copy(r),h.quaternion.copy(s);const f={type:"quad",width:e,height:t,translation:r,quaternion:s,pixelwidth:i,pixelheight:o,plane:h,material:d,rendercall:a,renderTarget:u};if(this._layers.push(f),this._session!==null){f.plane.material=new Hr({color:16777215,side:sa}),f.plane.material.blending=ia,f.plane.material.blendEquation=br,f.plane.material.blendSrc=Gr,f.plane.material.blendDst=Gr,f.xrlayer=this._createXRLayer(f);const p=this._session.renderState.layers;p.unshift(f.xrlayer),this._session.updateRenderState({layers:p})}else u.isXRRenderTarget=!1;return h}createCylinderLayer(e,t,r,s,i,o,a,l,c={}){const u=new Kv(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),d=new ta(o,a,{format:Pn,type:sn,depthTexture:new Qn(o,a,c.stencil?Qr:mt,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?Zr:Jr),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});d._autoAllocateDepthBuffer=!0;const h=new Hr({color:16777215,side:Qt});h.map=d.texture,h.map.offset.y=1,h.map.repeat.y=-1;const f=new kn(u,h);f.position.copy(s),f.quaternion.copy(i);const p={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:s,quaternion:i,pixelwidth:o,pixelheight:a,plane:f,material:h,rendercall:l,renderTarget:d};if(this._layers.push(p),this._session!==null){p.plane.material=new Hr({color:16777215,side:Qt}),p.plane.material.blending=ia,p.plane.material.blendEquation=br,p.plane.material.blendSrc=Gr,p.plane.material.blendDst=Gr,p.xrlayer=this._createXRLayer(p);const m=this._session.renderState.layers;m.unshift(p.xrlayer),this._session.updateRenderState({layers:m})}else d.isXRRenderTarget=!1;return f}renderLayers(){const e=new ce,t=new zi,r=this._renderer,s=this.isPresenting,i=r.getOutputRenderTarget(),o=r._frameBufferTarget;this.isPresenting=!1;const a=new we;r.getSize(a);const l=r._quad;for(const c of this._layers)if(c.renderTarget.isXRRenderTarget=this._session!==null,c.renderTarget._hasExternalTextures=c.renderTarget.isXRRenderTarget,c.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){c.xrlayer.transform=new XRRigidTransform(c.plane.getWorldPosition(e),c.plane.getWorldQuaternion(t));const u=this._glBinding.getSubImage(c.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(c.renderTarget,u.colorTexture,void 0),r._setXRLayerSize(c.renderTarget.width,c.renderTarget.height),r.setOutputRenderTarget(c.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:d,quad:h}=this._frameBufferTargets.get(c.renderTarget)||{frameBufferTarget:null,quad:null};d?(r._frameBufferTarget=d,r._quad=h):(r._quad=new $m(new ut),this._frameBufferTargets.set(c.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),c.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(c.renderTarget),c.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(i),r._frameBufferTarget=o,r._setXRLayerSize(a.x,a.y),r._quad=l,this.isPresenting=s}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const s=this._gl,i=s.getContextAttributes();if(this._session=e,e!==null){if(r.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,a=null,l=null;t.depth&&(l=t.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,o=t.stencil?Zr:Jr,a=t.stencil?Qr:mt);const c={colorFormat:s.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(c.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const u=this._glBinding.createProjectionLayer(c),d=[u];this._glProjLayer=u,t.setPixelRatio(1),t._setXRLayerSize(u.textureWidth,u.textureHeight);const h=this._useMultiview?2:1,f=new Qn(u.textureWidth,u.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,h);if(this._xrRenderTarget=new ta(u.textureWidth,u.textureHeight,{format:Pn,type:sn,colorSpace:t.outputColorSpace,depthTexture:f,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const p of this._layers)p.plane.material=new Hr({color:16777215,side:p.type==="cylinder"?Qt:sa}),p.plane.material.blending=ia,p.plane.material.blendEquation=br,p.plane.material.blendSrc=Gr,p.plane.material.blendDst=Gr,p.xrlayer=this._createXRLayer(p),d.unshift(p.xrlayer);e.updateRenderState({layers:d})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,s,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new ta(a.framebufferWidth,a.framebufferHeight,{format:Pn,type:sn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const r=e.near,s=e.far,i=this._cameraXR,o=this._cameraL,a=this._cameraR;i.near=a.near=o.near=r,i.far=a.far=o.far=s,i.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==i.near||this._currentDepthFar!==i.far)&&(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=e.layers.mask|6,o.layers.mask=i.layers.mask&3,a.layers.mask=i.layers.mask&5;const l=e.parent,c=i.cameras;Wy(i,l);for(let u=0;u<c.length;u++)Wy(c[u],l);c.length===2?v8(i,o,a):i.projectionMatrix.copy(o.projectionMatrix),_8(e,i,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new t2,this._controllers[e]=t),t}}function v8(n,e,t){zy.setFromMatrixPosition(e.matrixWorld),Hy.setFromMatrixPosition(t.matrixWorld);const r=zy.distanceTo(Hy),s=e.projectionMatrix.elements,i=t.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],u=(s[8]-1)/s[0],d=(i[8]+1)/i[0],h=o*u,f=o*d,p=r/(-u+d),m=p*-u;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(m),n.translateZ(p),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),s[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const y=o+p,x=a+p,b=h-m,v=f+(r-m),_=l*a/x*y,w=c*a/x*y;n.projectionMatrix.makePerspective(b,v,_,w,y,x),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function Wy(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function _8(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=_2*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function T8(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const r=this.getReferenceSpace();t.update(n.inputSource,n.frame,r),t.dispatchEvent({type:n.type,data:n.inputSource})}}function w8(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const r=this._controllerInputSources[t];r!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(r))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new ta(t.pixelwidth,t.pixelheight,{format:Pn,type:sn,depthTexture:new Qn(t.pixelwidth,t.pixelheight,t.stencilBuffer?Qr:mt,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?Zr:Jr),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function S8(n){const e=this._controllers,t=this._controllerInputSources;for(let r=0;r<n.removed.length;r++){const s=n.removed[r],i=t.indexOf(s);i>=0&&(t[i]=null,e[i].disconnect(s))}for(let r=0;r<n.added.length;r++){const s=n.added[r];let i=t.indexOf(s);if(i===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(s),i=a;break}else if(t[a]===null){t[a]=s,i=a;break}if(i===-1)break}const o=e[i];o&&o.connect(s)}}function N8(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function A8(n,e){if(e===void 0)return;const t=this._cameraXR,r=this._renderer,s=r.backend,i=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const l=a.views;this._glBaseLayer!==null&&s.setXRTarget(i.framebuffer);let c=!1;l.length!==t.cameras.length&&(t.cameras.length=0,c=!0);for(let u=0;u<l.length;u++){const d=l[u];let h;if(this._supportsLayers===!0){const p=this._glBinding.getViewSubImage(this._glProjLayer,d);h=p.viewport,u===0&&s.setXRRenderTargetTextures(this._xrRenderTarget,p.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:p.depthStencilTexture)}else h=i.getViewport(d);let f=this._cameras[u];f===void 0&&(f=new _a,f.layers.enable(u),f.viewport=new et,this._cameras[u]=f),f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.quaternion,f.scale),f.projectionMatrix.fromArray(d.projectionMatrix),f.projectionMatrixInverse.copy(f.projectionMatrix).invert(),f.viewport.set(h.x,h.y,h.width,h.height),u===0&&(t.matrix.copy(f.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),c===!0&&t.cameras.push(f)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const c=this._controllerInputSources[l],u=this._controllers[l];c!==null&&u!==void 0&&u.update(c,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class E8 extends Lp{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new et(0,0,this._width,this._height),this._scissor=new et(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new e_,this.depthTexture=new Qn}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,s){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,r,s)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,s,i=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,r,s),a.minDepth=i,a.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const qy=new fu,bi=new we,eh=new et,th=new GE,nh=new jE,jl=new In,pr=new et;class C8{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:s=!0,depth:i=!0,stencil:o=!1,antialias:a=!1,samples:l=0,getFallback:c=null,colorBufferType:u=jt,multiview:d=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=s,this.logarithmicDepthBuffer=r,this.outputColorSpace=kp,this.toneMapping=Fs,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=o,this.info=new lG,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new FS,this.lighting=new y8,this._samples=l||a===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new E8(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new Rw,this._inspector.setRenderer(this),this._getFallback=c,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new $m(new ut),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const h=this.alpha===!0?0:1;this._clearColor=new Gm(0,0,0,h),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=u,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:VE},this.xr=new b8(this,d),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(f,p,m)=>{await this.compileAsync(f,p);const y=this._renderLists.get(f,p),x=this._renderContexts.get(f,p,this._renderTarget),b=f.overrideMaterial||m.material,v=this._objects.get(m,b,f,p,y.lightsNode,x,x.clippingContext),{fragmentShader:_,vertexShader:w}=v.getNodeBuilderState();return{fragmentShader:_,vertexShader:w}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=r=this._getFallback(s),await r.init(this)}catch(i){t(i);return}else{t(s);return}}this._nodes=new p8(this,r),this._animation=new Jj(this,this._nodes,this.info),this._attributes=new oG(r),this._background=new R$(this,this._nodes),this._geometries=new aG(this._attributes,this.info),this._textures=new wG(this,r,this.info),this._pipelines=new hG(r,this._nodes),this._bindings=new fG(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new rG(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new gG(this.lighting),this._bundles=new g8,this._renderContexts=new _G,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,i=s.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=this._compilationPromises,c=e.isScene===!0?e:qy;r===null&&(r=e);const u=this._renderTarget,d=this._renderContexts.get(r,t,u),h=this._activeMipmapLevel,f=[];this._currentRenderContext=d,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,s.renderId++,s.update(),d.depth=this.depth,d.stencil=this.stencil,d.clippingContext||(d.clippingContext=new tu),d.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,u);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,d.clippingContext),r!==e&&r.traverseVisible(function(v){v.isLight&&v.layers.test(t.layers)&&p.pushLight(v)}),p.finish(),u!==null){this._textures.updateRenderTarget(u,h);const v=this._textures.get(u);d.textures=v.textures,d.depthTexture=v.depthTexture}else d.textures=null,d.depthTexture=null;this._background.update(c,p,d);const m=p.opaque,y=p.transparent,x=p.transparentDoublePass,b=p.lightsNode;this.opaque===!0&&m.length>0&&this._renderObjects(m,t,c,b),this.transparent===!0&&y.length>0&&this._renderTransparents(y,x,t,c,b),s.renderId=i,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){ft('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){se("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=Kx,this.overrideNodes.modelNormalViewMatrix=Yx):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===Kx&&this.overrideNodes.modelNormalViewMatrix===Yx}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),se(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:s,camera:i,renderList:o}=e,a=this._currentRenderContext,l=this._bundles.get(s,i),c=this.backend.get(l);c.renderContexts===void 0&&(c.renderContexts=new Set);const u=s.version!==c.version,d=c.renderContexts.has(a)===!1||u;if(c.renderContexts.add(a),d){this.backend.beginBundle(a),(c.renderObjects===void 0||u)&&(c.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:h,transparent:f,opaque:p}=o;this.opaque===!0&&p.length>0&&this._renderObjects(p,i,t,r),this.transparent===!0&&f.length>0&&this._renderTransparents(f,h,i,t,r),this._currentRenderBundle=null,this.backend.finishBundle(a,l),c.version=s.version}else{const{renderObjects:h}=c;for(let f=0,p=h.length;f<p;f++){const m=h[f];this._nodes.needsRefresh(m)&&(this._nodes.updateBefore(m),this._nodes.updateForRender(m),this._bindings.updateForRender(m),this._nodes.updateAfter(m))}}this.backend.addBundle(a,l)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,r=e!==Fs,s=t!==pt.workingColorSpace;if(r===!1&&s===!1)return null;const{width:i,height:o}=this.getDrawingBufferSize(bi),{depth:a,stencil:l}=this;let c=this._frameBufferTarget;c===null&&(c=new co(i,o,{depthBuffer:a,stencilBuffer:l,type:this._colorBufferType,format:Pn,colorSpace:pt.workingColorSpace,generateMipmaps:!1,minFilter:Fn,magFilter:Fn,samples:this.samples}),c.isPostProcessingRenderTarget=!0,this._frameBufferTarget=c);const u=this.getOutputRenderTarget();c.depthBuffer=a,c.stencilBuffer=l,u!==null?c.setSize(u.width,u.height,u.depth):c.setSize(i,o,1);const d=this._canvasTarget;return c.viewport.copy(d._viewport),c.scissor.copy(d._scissor),c.viewport.multiplyScalar(d._pixelRatio),c.scissor.multiplyScalar(d._pixelRatio),c.scissorTest=d._scissorTest,c.multiview=u!==null?u.multiview:!1,c.resolveDepthBuffer=u!==null?u.resolveDepthBuffer:!0,c._autoAllocateDepthBuffer=u!==null?u._autoAllocateDepthBuffer:!1,c}_renderScene(e,t,r=!0){if(this._isDeviceLost===!0)return;const s=r?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,o=i.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,c=e.isScene===!0?e:qy,u=this._renderTarget||this._outputRenderTarget,d=this._activeCubeFace,h=this._activeMipmapLevel;let f;s!==null?(f=s,this.setRenderTarget(f)):f=u;const p=this._renderContexts.get(e,t,f);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(p),this.inspector.beginRender(this.backend.getTimestampUID(p),e,t,f);const m=this.coordinateSystem,y=this.xr;if(t.coordinateSystem!==m&&y.isPresenting===!1&&(t.coordinateSystem=m,t.updateProjectionMatrix(),t.isArrayCamera))for(const A of t.cameras)A.coordinateSystem=m,A.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),y.enabled===!0&&y.isPresenting===!0&&(y.cameraAutoUpdate===!0&&y.updateCamera(t),t=y.getCamera());const x=this._canvasTarget;let b=x._viewport,v=x._scissor,_=x._pixelRatio;f!==null&&(b=f.viewport,v=f.scissor,_=1),this.getDrawingBufferSize(bi),eh.set(0,0,bi.width,bi.height);const w=b.minDepth===void 0?0:b.minDepth,T=b.maxDepth===void 0?1:b.maxDepth;p.viewportValue.copy(b).multiplyScalar(_).floor(),p.viewportValue.width>>=h,p.viewportValue.height>>=h,p.viewportValue.minDepth=w,p.viewportValue.maxDepth=T,p.viewport=p.viewportValue.equals(eh)===!1,p.scissorValue.copy(v).multiplyScalar(_).floor(),p.scissor=x._scissorTest&&p.scissorValue.equals(eh)===!1,p.scissorValue.width>>=h,p.scissorValue.height>>=h,p.clippingContext||(p.clippingContext=new tu),p.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,f);const N=t.isArrayCamera?nh:th;t.isArrayCamera||(jl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(jl,t.coordinateSystem,t.reversedDepth));const S=this._renderLists.get(e,t);if(S.begin(),this._projectObject(e,t,0,S,p.clippingContext),S.finish(),this.sortObjects===!0&&S.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,h);const A=this._textures.get(f);p.textures=A.textures,p.depthTexture=A.depthTexture,p.width=A.width,p.height=A.height,p.renderTarget=f,p.depth=f.depthBuffer,p.stencil=f.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=bi.width,p.height=bi.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=h,p.height>>=h,p.activeCubeFace=d,p.activeMipmapLevel=h,p.occlusionQueryCount=S.occlusionQueryCount,p.scissorValue.max(pr.set(0,0,0,0)),p.scissorValue.x+p.scissorValue.width>p.width&&(p.scissorValue.width=Math.max(p.width-p.scissorValue.x,0)),p.scissorValue.y+p.scissorValue.height>p.height&&(p.scissorValue.height=Math.max(p.height-p.scissorValue.y,0)),this._background.update(c,S,p),p.camera=t,this.backend.beginRender(p);const{bundles:C,lightsNode:D,transparentDoublePass:F,transparent:j,opaque:z}=S;return C.length>0&&this._renderBundles(C,c,D),this.opaque===!0&&z.length>0&&this._renderObjects(z,t,c,D),this.transparent===!0&&j.length>0&&this._renderTransparents(j,F,t,c,D),this.backend.finishRender(p),i.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=l,s!==null&&(this.setRenderTarget(u,d,h),this._renderOutput(f)),c.onAfterRender(this,e,t,f),this.inspector.finishRender(this.backend.getTimestampUID(p)),p}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,s=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=s}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,r)}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,r)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,r,s){this._canvasTarget.setScissor(e,t,r,s)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,r,s,i=0,o=1){this._canvasTarget.setViewport(e,t,r,s,i,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const s=this._renderTarget||this._getFrameBufferTarget();let i=null;if(s!==null){this._textures.updateRenderTarget(s);const o=this._textures.get(s);i=this._renderContexts.getForClear(s),i.textures=o.textures,i.depthTexture=o.depthTexture,i.width=o.width,i.height=o.height,i.renderTarget=s,i.depth=s.depthBuffer,i.stencil=s.stencilBuffer,i.clearColorValue=this.backend.getClearColor(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,i),s!==null&&this._renderTarget===null&&this._renderOutput(s)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){ft('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,r)}async clearColorAsync(){ft('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){ft('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){ft('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Fs,t=this.currentColorSpace!==pt.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Fs}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:pt.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return ie("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const r=this._nodes.nodeFrame,s=r.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const i=this.backend,o=this._pipelines,a=this._bindings,l=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const u of c){if(o.has(u)===!1){const f=()=>{u.removeEventListener("dispose",f),o.delete(u),a.deleteForCompute(u),l.delete(u)};u.addEventListener("dispose",f);const p=u.onInitFunction;p!==null&&p.call(u,{renderer:this})}l.updateForCompute(u),a.updateForCompute(u);const d=a.getForCompute(u),h=o.getForCompute(u,d);i.compute(e,u,d,h,t)}i.finishCompute(e),r.renderId=s,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return ft('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){ft('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=pr.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=pr.copy(t).floor();else{se("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=pr.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext,s;r!==null?s=r.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),r=this._textures.get(s))),this._textures.updateTexture(e,{renderTarget:s}),this.backend.copyFramebufferToTexture(e,r,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,r=null,s=null,i=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,s,i,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,r,s,i,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,r,s,i,a)}_projectObject(e,t,r,s,i){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)s.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?nh:th;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&pr.setFromMatrixPosition(e.matrixWorld).applyMatrix4(jl);const{geometry:c,material:u}=e;u.visible&&s.push(e,c,u,r,pr.z,null,i)}}else if(e.isLineLoop)se("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?nh:th;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:c,material:u}=e;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),pr.copy(c.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(jl)),Array.isArray(u)){const d=c.groups;for(let h=0,f=d.length;h<f;h++){const p=d[h],m=u[p.materialIndex];m&&m.visible&&s.push(e,c,m,r,pr.z,p,i)}}else u.visible&&s.push(e,c,u,r,pr.z,null,i)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=s;s=this._renderLists.get(e,t),s.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:s}),s.finish()}const a=e.children;for(let l=0,c=a.length;l<c;l++)this._projectObject(a[l],t,r,s,i)}_renderBundles(e,t,r){for(const s of e)this._renderBundle(s,t,r)}_renderTransparents(e,t,r,s,i){if(t.length>0){for(const{material:o}of t)o.side=Qt;this._renderObjects(t,r,s,i,"backSide");for(const{material:o}of t)o.side=sa;this._renderObjects(e,r,s,i);for(const{material:o}of t)o.side=js}else this._renderObjects(e,r,s,i)}_renderObjects(e,t,r,s,i=null){for(let o=0,a=e.length;o<a;o++){const{object:l,geometry:c,material:u,group:d,clippingContext:h}=e[o];this._currentRenderObjectFunction(l,r,t,c,u,d,s,h,i)}}_getShadowNodes(e){const t=e.version;let r=this._cacheShadowNodes.get(e);if(r===void 0||r.version!==t){const s=e.map!==null,i=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let a=null,l=null,c=null;if(s||i||o){let u,d;o?(u=e.castShadowNode.rgb,d=e.castShadowNode.a):(u=X(0),d=$(1)),s&&(d=d.mul(Ve("map","texture",e).a)),i&&(d=d.mul(e.colorNode.a)),l=ve(u,d)}e.depthNode&&e.depthNode.isNode&&(c=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?a=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(a=e.positionNode),r={version:t,colorNode:l,depthNode:c,positionNode:a},this._cacheShadowNodes.set(e,r)}return r}renderObject(e,t,r,s,i,o,a,l=null,c=null){let u=!1,d,h,f,p;if(e.onBeforeRender(this,t,r,s,i,o),i.allowOverride===!0&&t.overrideMaterial!==null){const m=t.overrideMaterial;if(u=!0,d=t.overrideMaterial.colorNode,h=t.overrideMaterial.depthNode,f=t.overrideMaterial.positionNode,p=t.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(m.positionNode=i.positionNode),m.alphaTest=i.alphaTest,m.alphaMap=i.alphaMap,m.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,m.isShadowPassMaterial){const{colorNode:y,depthNode:x,positionNode:b}=this._getShadowNodes(i);m.side=i.shadowSide===null?i.side:i.shadowSide,y!==null&&(m.colorNode=y),x!==null&&(m.depthNode=x),b!==null&&(m.positionNode=b)}i=m}i.transparent===!0&&i.side===js&&i.forceSinglePass===!1?(i.side=Qt,this._handleObjectFunction(e,i,t,r,a,o,l,"backSide"),i.side=sa,this._handleObjectFunction(e,i,t,r,a,o,l,c),i.side=js):this._handleObjectFunction(e,i,t,r,a,o,l,c),u&&(t.overrideMaterial.colorNode=d,t.overrideMaterial.depthNode=h,t.overrideMaterial.positionNode=f,t.overrideMaterial.side=p),e.onAfterRender(this,t,r,s,i,o)}_renderObjectDirect(e,t,r,s,i,o,a,l){const c=this._objects.get(e,t,r,s,i,this._currentRenderContext,a,l);c.drawRange=e.geometry.drawRange,c.group=o;const u=this._nodes.needsRefresh(c);u&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(c,this.info),u&&this._nodes.updateAfter(c)}_createObjectPipeline(e,t,r,s,i,o,a,l){const c=this._objects.get(e,t,r,s,i,this._currentRenderContext,a,l);c.drawRange=e.geometry.drawRange,c.group=o,this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._pipelines.getForRender(c,this._compilationPromises),this._nodes.updateAfter(c)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class LS{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function R8(n){return n+(Xr-n%Xr)%Xr}class IS extends LS{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return R8(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class OS extends IS{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let M8=0;class US extends OS{constructor(e,t){super("UniformBuffer_"+M8++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class P8 extends OS{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,s=this.uniforms.length;r<s;r++){const i=this.uniforms[r],o=i.boundary,a=i.itemSize*e,l=t%Xr,c=l%o,u=l+c;t+=c,u!==0&&Xr-u<a&&(t+=Xr-u),i.offset=t/e,t+=a}return Math.ceil(t/Xr)*Xr}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);se("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,s=e.getValue(),i=e.offset,o=e.getType();if(r[i]!==s){const a=this._getBufferForType(o);a[i]=r[i]=s,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,s=e.getValue(),i=e.offset,o=e.getType();if(r[i+0]!==s.x||r[i+1]!==s.y){const a=this._getBufferForType(o);a[i+0]=r[i+0]=s.x,a[i+1]=r[i+1]=s.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,s=e.getValue(),i=e.offset,o=e.getType();if(r[i+0]!==s.x||r[i+1]!==s.y||r[i+2]!==s.z){const a=this._getBufferForType(o);a[i+0]=r[i+0]=s.x,a[i+1]=r[i+1]=s.y,a[i+2]=r[i+2]=s.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,s=e.getValue(),i=e.offset,o=e.getType();if(r[i+0]!==s.x||r[i+1]!==s.y||r[i+2]!==s.z||r[i+4]!==s.w){const a=this._getBufferForType(o);a[i+0]=r[i+0]=s.x,a[i+1]=r[i+1]=s.y,a[i+2]=r[i+2]=s.z,a[i+3]=r[i+3]=s.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,s=e.getValue(),i=e.offset;if(r[i+0]!==s.r||r[i+1]!==s.g||r[i+2]!==s.b){const o=this.buffer;o[i+0]=r[i+0]=s.r,o[i+1]=r[i+1]=s.g,o[i+2]=r[i+2]=s.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,s=e.getValue().elements,i=e.offset;if(r[i+0]!==s[0]||r[i+1]!==s[1]||r[i+2]!==s[2]||r[i+4]!==s[3]||r[i+5]!==s[4]||r[i+6]!==s[5]||r[i+8]!==s[6]||r[i+9]!==s[7]||r[i+10]!==s[8]){const o=this.buffer;o[i+0]=r[i+0]=s[0],o[i+1]=r[i+1]=s[1],o[i+2]=r[i+2]=s[2],o[i+4]=r[i+4]=s[3],o[i+5]=r[i+5]=s[4],o[i+6]=r[i+6]=s[5],o[i+8]=r[i+8]=s[6],o[i+9]=r[i+9]=s[7],o[i+10]=r[i+10]=s[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,s=e.getValue().elements,i=e.offset;return B8(r,s,i)===!1&&(this.buffer.set(s,i),D8(r,s,i),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function D8(n,e,t){for(let r=0,s=e.length;r<s;r++)n[t+r]=e[r]}function B8(n,e,t){for(let r=0,s=e.length;r<s;r++)if(n[t+r]!==e[r])return!1;return!0}let k8=0;class VS extends P8{constructor(e,t){super(e),this.id=k8++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class jS extends LS{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let F8=0;class L8 extends jS{constructor(e,t){super(e,t),this.id=F8++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class ju extends L8{constructor(e,t,r,s=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=s}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class GS extends ju{constructor(e,t,r,s=null){super(e,t,r,s),this.isSampledCubeTexture=!0}}class Zf extends ju{constructor(e,t,r,s=null){super(e,t,r,s),this.isSampledTexture3D=!0}}const Xy={bitcast_int_uint:new Nt("uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }"),bitcast_uint_int:new Nt("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }")},I8={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint"},O8={low:"lowp",medium:"mediump",high:"highp"},Ky={swizzleAssign:!0,storageBuffer:!1},Yy={perspective:"smooth",linear:"noperspective"},Qy={centroid:"centroid"},Zy=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class U8 extends BS{constructor(e,t){super(e,t,new f8),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Hi}_include(e){const t=Xy[e];return t.build(this),this.addInclude(t),t}getMethod(e){return Xy[e]!==void 0&&this._include(e),I8[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getTernary(e,t,r){return`${e} ? ${t} : ${r}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),s=[];for(const o of t.inputs)s.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${s.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const r=t.array,s=t.count*t.itemSize,{itemSize:i}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?Hp:zp;i===2?a=o?Wp:Kr:i===3?a=o?$2:$p:i===4&&(a=o?qp:Pn);const l={Float32Array:dn,Uint8Array:sn,Uint16Array:Si,Uint32Array:mt,Int8Array:oa,Int16Array:aa,Int32Array:Ot,Uint8ClampedArray:sn},c=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/i))));let u=Math.ceil(s/i/c);c*u*i<s&&u++;const d=c*u*i,h=new r.constructor(d);h.set(r,0),t.array=h;const f=new P_(t.array,c,u,a,l[t.array.constructor.name]||dn);f.needsUpdate=!0,f.isPBOTexture=!0;const p=new po(f,null,null);p.setPrecision("high"),t.pboNode=p,t.pbo=p.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,s=t.value;if(this.renderer.backend.has(s)){const u=this.renderer.backend.get(s);u.pbo=s.pbo}const i=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(i);this.increaseUsage(r);const a=r.build(this,"uint"),l=this.getDataFromNode(e);let c=l.propertyName;if(c===void 0){const u=this.getVarFromNode(e);c=this.getPropertyName(u);const d=this.getDataFromNode(t);let h=d.propertySizeName;h===void 0&&(h=c+"Size",this.getVarFromNode(t,h,"uint"),this.addLineFlowCode(`${h} = uint( textureSize( ${o}, 0 ).x )`,e),d.propertySizeName=h);const{itemSize:f}=s,p="."+ho.join("").slice(0,f),m=`ivec2(${a} % ${h}, ${a} / ${h})`,y=this.generateTextureLoad(null,o,m,"0",null,null);let x="vec4";s.pbo.type===mt?x="uvec4":s.pbo.type===Ot&&(x="ivec4"),this.addLineFlowCode(`${c} = ${x}(${y})${p}`,e),l.propertyName=c}return c}generateTextureLoad(e,t,r,s,i,o){s===null&&(s="0");let a;return i?o?a=`texelFetchOffset( ${t}, ivec3( ${r}, ${i} ), ${s}, ${o} )`:a=`texelFetch( ${t}, ivec3( ${r}, ${i} ), ${s} )`:o?a=`texelFetchOffset( ${t}, ${r}, ${s}, ${o} )`:a=`texelFetch( ${t}, ${r}, ${s} )`,e!==null&&e.isDepthTexture&&(a+=".x"),a}generateTexture(e,t,r,s,i){return s&&(r=`vec3( ${r}, ${s} )`),e.isDepthTexture?i?`textureOffset( ${t}, ${r}, ${i} ).x`:`texture( ${t}, ${r} ).x`:i?`textureOffset( ${t}, ${r}, ${i} )`:`texture( ${t}, ${r} )`}generateTextureLevel(e,t,r,s,i){return i?`textureLodOffset( ${t}, ${r}, ${s}, ${i} )`:`textureLod( ${t}, ${r}, ${s} )`}generateTextureBias(e,t,r,s,i){return i?`textureOffset( ${t}, ${r}, ${i}, ${s} )`:`texture( ${t}, ${r}, ${s} )`}generateTextureGrad(e,t,r,s,i){return i?`textureGradOffset( ${t}, ${r}, ${s[0]}, ${s[1]}, ${i} )`:`textureGrad( ${t}, ${r}, ${s[0]}, ${s[1]} )`}generateTextureCompare(e,t,r,s,i,o,a=this.shaderStage){if(a==="fragment")return i?o?`textureOffset( ${t}, vec4( ${r}, ${i}, ${s} ), ${o} )`:`texture( ${t}, vec4( ${r}, ${i}, ${s} ) )`:o?`textureOffset( ${t}, vec3( ${r}, ${s} ), ${o} )`:`texture( ${t}, vec3( ${r}, ${s} ) )`;se(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const s of r)t.push(`${this.getVar(s.type,s.name,s.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],r=[],s={};for(const o of t){let a=null,l=!1;if(o.type==="texture"||o.type==="texture3D"){const u=o.node.value;let d="";(u.isDataTexture===!0||u.isData3DTexture===!0)&&(u.type===mt?d="u":u.type===Ot&&(d="i")),o.type==="texture3D"&&u.isArrayTexture===!1?a=`${d}sampler3D ${o.name};`:u.compareFunction?u.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:u.isArrayTexture===!0||u.isDataArrayTexture===!0||u.isCompressedArrayTexture===!0?a=`${d}sampler2DArray ${o.name};`:a=`${d}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="buffer"){const u=o.node,d=this.getType(u.bufferType),h=u.bufferCount,f=h>0?h:"";a=`${u.name} {
	${d} ${o.name}[${f}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,l=!0;const c=o.node.precision;if(c!==null&&(a=O8[c]+" "+a),l){a="	"+a;const u=o.groupNode.name;(s[u]||(s[u]=[])).push(a)}else a="uniform "+a,r.push(a)}let i="";for(const o in s){const a=s[o];i+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return i+=r.join(`
`),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Ot){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const s=r.array;s instanceof Uint32Array||s instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let s=0;for(const i of r)t+=`layout( location = ${s++} ) in ${i.type} ${i.name};
`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`	${r.type} ${r.name};`);return t.join(`
`)}getStructs(e){const t=[],r=this.structs[e],s=[];for(const i of r)if(i.output)for(const o of i.members)s.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+i.name+` {
`;o+=this.getStructMembers(i),o+=`
};
`,t.push(o)}return s.length===0&&s.push("layout( location = 0 ) out vec4 fragColor;"),`
`+s.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const s of r){e==="compute"&&(s.needsInterpolation=!0);const i=this.getType(s.type);if(s.needsInterpolation)if(s.interpolationType){const o=Yy[s.interpolationType]||s.interpolationType,a=Qy[s.interpolationSampling]||"";t+=`${o} ${a} out ${i} ${s.name};
`}else{const o=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";t+=`${o}out ${i} ${s.name};
`}else t+=`${i} ${s.name};
`}else if(e==="fragment"){for(const s of r)if(s.needsInterpolation){const i=this.getType(s.type);if(s.interpolationType){const o=Yy[s.interpolationType]||s.interpolationType,a=Qy[s.interpolationSampling]||"";t+=`${o} ${a} in ${i} ${s.name};
`}else{const o=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";t+=`${o}in ${i} ${s.name};
`}}}for(const s of this.builtins[e])t+=`${s};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((r,s)=>r*s,1)}u`}getSubgroupSize(){se("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){se("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){se("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const s=this.extensions[r]||(this.extensions[r]=new Map);s.has(e)===!1&&s.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(r!==void 0)for(const{name:s,behavior:i}of r.values())t.push(`#extension ${s} : ${i}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=Ky[e];if(t===void 0){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance";break}if(r!==void 0){const s=this.renderer.backend.extensions;s.has(r)&&(s.get(r),t=!0)}Ky[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const s=e[r],i=this.getPropertyName(s.attributeNode);i&&(t+=`${s.varyingName} = ${i};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Zy}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Zy}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],i=s[s.length-1];for(const a of s){const l=this.getFlowData(a),c=a.name;c&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${c}
	`),r+=`${l.code}
	`,a===i&&t!=="compute"&&(r+=`// result
	`,t==="vertex"?(r+="gl_Position = ",r+=`${l.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${l.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,s=null){const i=super.getUniformFromNode(e,t,r,s),o=this.getDataFromNode(e,r,this.globalCache);let a=o.uniformGPU;if(a===void 0){const l=e.groupNode,c=l.name,u=this.getBindGroupArray(c,r);if(t==="texture")a=new ju(i.name,i.node,l),u.push(a);else if(t==="cubeTexture")a=new GS(i.name,i.node,l),u.push(a);else if(t==="texture3D")a=new Zf(i.name,i.node,l),u.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,i.name=`buffer${e.id}`;const d=new US(e,l);d.name=e.name,u.push(d),a=d}else{const d=this.uniformGroups[r]||(this.uniformGroups[r]={});let h=d[c];h===void 0&&(h=new VS(r+"_"+c,l),d[c]=h,u.push(h)),a=this.getNodeUniform(i,t),h.addUniform(a)}o.uniformGPU=a}return i}}let rh=null,vi=null;class $S{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[qn.RENDER]:null,[qn.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),r=this.renderer.info.frame;let s;e.isComputeNode===!0?s="c:"+this.renderer.info.compute.frameCalls:s="r:"+this.renderer.info.render.frameCalls,t.timestampUID=s+":"+e.id+":f"+r}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?qn.COMPUTE:qn.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){ft("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return rh=rh||new we,this.renderer.getDrawingBufferSize(rh)}setScissorTest(){}getClearColor(){const e=this.renderer;return vi=vi||new Gm,e.getClearColor(vi),vi.getRGB(vi),vi}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:r2(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${pu} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let V8=0;class j8{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class G8{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:s}=r,i=e.array,o=e.usage||s.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,l=r.get(a);let c=l.bufferGPU;c===void 0&&(c=this._createBuffer(s,t,i,o),l.bufferGPU=c,l.bufferType=t,l.version=a.version);let u;if(i instanceof Float32Array)u=s.FLOAT;else if(typeof Float16Array<"u"&&i instanceof Float16Array)u=s.HALF_FLOAT;else if(i instanceof Uint16Array)e.isFloat16BufferAttribute?u=s.HALF_FLOAT:u=s.UNSIGNED_SHORT;else if(i instanceof Int16Array)u=s.SHORT;else if(i instanceof Uint32Array)u=s.UNSIGNED_INT;else if(i instanceof Int32Array)u=s.INT;else if(i instanceof Int8Array)u=s.BYTE;else if(i instanceof Uint8Array)u=s.UNSIGNED_BYTE;else if(i instanceof Uint8ClampedArray)u=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);let d={bufferGPU:c,bufferType:t,type:u,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:u===s.INT||u===s.UNSIGNED_INT||e.gpuType===Ot,id:V8++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const h=this._createBuffer(s,t,i,o);d=new j8(d,h)}r.set(e,d)}updateAttribute(e){const t=this.backend,{gl:r}=t,s=e.array,i=e.isInterleavedBufferAttribute?e.data:e,o=t.get(i),a=o.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(a,o.bufferGPU),l.length===0)r.bufferSubData(a,0,s);else{for(let c=0,u=l.length;c<u;c++){const d=l[c];r.bufferSubData(a,d.start*s.BYTES_PER_ELEMENT,s,d.start,d.count)}i.clearUpdateRanges()}r.bindBuffer(a,null),o.version=i.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const s=t.get(e);r.deleteBuffer(s.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,s=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(s),o=e.array,a=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,i);const l=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,l),r.bufferData(r.COPY_WRITE_BUFFER,a,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const c=new e.array.constructor(o.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,l),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,c),r.deleteBuffer(l),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),c.buffer}_createBuffer(e,t,r,s){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,r,s),e.bindBuffer(t,null),i}}let sh,Wo;class $8{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;sh={[br]:e.FUNC_ADD,[u_]:e.FUNC_SUBTRACT,[c_]:e.FUNC_REVERSE_SUBTRACT},Wo={[Gr]:e.ZERO,[v_]:e.ONE,[b_]:e.SRC_COLOR,[y_]:e.SRC_ALPHA,[x_]:e.SRC_ALPHA_SATURATE,[g_]:e.DST_COLOR,[m_]:e.DST_ALPHA,[p_]:e.ONE_MINUS_SRC_COLOR,[f_]:e.ONE_MINUS_SRC_ALPHA,[h_]:e.ONE_MINUS_DST_COLOR,[d_]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=new et().fromArray(t),this.currentViewport=new et().fromArray(r),this._tempVec4=new et}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==i2?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===o2?t.cullFace(t.BACK):e===a2?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,r,s,i,o,a,l){const{gl:c}=this;if(e===Wi){this.currentBlendingEnabled===!0&&(this.disable(c.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(c.BLEND),this.currentBlendingEnabled=!0),e!==ia){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==br||this.currentBlendEquationAlpha!==br)&&(c.blendEquation(c.FUNC_ADD),this.currentBlendEquation=br,this.currentBlendEquationAlpha=br),l)switch(e){case $s:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case Rc:c.blendFunc(c.ONE,c.ONE);break;case Cc:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case Ec:c.blendFuncSeparate(c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA,c.ZERO,c.ONE);break;default:se("WebGLState: Invalid blending: ",e);break}else switch(e){case $s:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case Rc:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE,c.ONE,c.ONE);break;case Cc:se("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ec:se("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:se("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}i=i||t,o=o||r,a=a||s,(t!==this.currentBlendEquation||i!==this.currentBlendEquationAlpha)&&(c.blendEquationSeparate(sh[t],sh[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),(r!==this.currentBlendSrc||s!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(c.blendFuncSeparate(Wo[r],Wo[s],Wo[o],Wo[a]),this.currentBlendSrc=r,this.currentBlendDst=s,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case C_:t.depthFunc(t.NEVER);break;case E_:t.depthFunc(t.ALWAYS);break;case A_:t.depthFunc(t.LESS);break;case N_:t.depthFunc(t.LEQUAL);break;case S_:t.depthFunc(t.EQUAL);break;case w_:t.depthFunc(t.GEQUAL);break;case T_:t.depthFunc(t.GREATER);break;case __:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,s){const i=this._tempVec4.set(e,t,r,s);if(this.currentScissor.equals(i)===!1){const{gl:o}=this;o.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,r,s){const i=this._tempVec4.set(e,t,r,s);if(this.currentViewport.equals(i)===!1){const{gl:o}=this;o.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:s}=this;e.side===js?this.disable(s.CULL_FACE):this.enable(s.CULL_FACE);let i=e.side===Qt;t&&(i=!i),this.setFlipSided(i),e.blending===$s&&e.transparent===!1?this.setBlending(Wi):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(s.SAMPLE_ALPHA_TO_COVERAGE):this.disable(s.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r)for(let l=0;l<8;l++)l<r?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,r){const{gl:s}=this;e?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==r)&&(s.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const r=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(r.bindVertexArray(e),t!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:s}=this;return s[e]!==t?(r.bindFramebuffer(e,t),s[e]=t,e===r.DRAW_FRAMEBUFFER&&(s[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(s[r.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:r}=this;let s=[],i=!1;if(e.textures!==null){s=this.currentDrawbuffers.get(t),s===void 0&&(s=[],this.currentDrawbuffers.set(t,s));const o=e.textures;if(s.length!==o.length||s[0]!==r.COLOR_ATTACHMENT0){for(let a=0,l=o.length;a<l;a++)s[a]=r.COLOR_ATTACHMENT0+a;s.length=o.length,i=!0}}else s[0]!==r.BACK&&(s[0]=r.BACK,i=!0);i&&r.drawBuffers(s)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:s}=this;e===void 0&&(e=t.TEXTURE0+s-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:s,currentTextureSlot:i,currentBoundTextures:o,maxTextures:a}=this;r===void 0&&(i===null?r=s.TEXTURE0+a-1:r=i);let l=o[r];l===void 0&&(l={type:void 0,texture:void 0},o[r]=l),(l.type!==e||l.texture!==t)&&(i!==r&&(s.activeTexture(r),this.currentTextureSlot=r),s.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,r){const{gl:s}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]!==r?(s.bindBufferBase(e,t,r),this.currentBoundBufferBases[i]=r,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,s=r[t];s!==void 0&&s.type!==void 0&&(e.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}class z8{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Hi){const{gl:r,extensions:s}=this;let i;const o=pt.getTransfer(t);if(e===sn)return r.UNSIGNED_BYTE;if(e===l2)return r.UNSIGNED_SHORT_4_4_4_4;if(e===c2)return r.UNSIGNED_SHORT_5_5_5_1;if(e===R_)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===M_)return r.UNSIGNED_INT_10F_11F_11F_REV;if(e===oa)return r.BYTE;if(e===aa)return r.SHORT;if(e===Si)return r.UNSIGNED_SHORT;if(e===Ot)return r.INT;if(e===mt)return r.UNSIGNED_INT;if(e===dn)return r.FLOAT;if(e===jt)return r.HALF_FLOAT;if(e===u2)return r.ALPHA;if(e===$p)return r.RGB;if(e===Pn)return r.RGBA;if(e===Jr)return r.DEPTH_COMPONENT;if(e===Zr)return r.DEPTH_STENCIL;if(e===zp)return r.RED;if(e===Hp)return r.RED_INTEGER;if(e===Kr)return r.RG;if(e===Wp)return r.RG_INTEGER;if(e===qp)return r.RGBA_INTEGER;if(e===sc||e===ic||e===oc||e===ac)if(o===be)if(i=s.get("WEBGL_compressed_texture_s3tc_srgb"),i!==null){if(e===sc)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===ic)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===oc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===ac)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=s.get("WEBGL_compressed_texture_s3tc"),i!==null){if(e===sc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===ic)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===oc)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ac)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===$g||e===zg||e===Hg||e===Wg)if(i=s.get("WEBGL_compressed_texture_pvrtc"),i!==null){if(e===$g)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===zg)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Hg)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Wg)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Uh||e===Vh||e===jh)if(i=s.get("WEBGL_compressed_texture_etc"),i!==null){if(e===Uh||e===Vh)return o===be?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===jh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Gh||e===$h||e===zh||e===Hh||e===Wh||e===qh||e===Xh||e===Kh||e===Yh||e===Qh||e===Zh||e===Jh||e===ef||e===tf)if(i=s.get("WEBGL_compressed_texture_astc"),i!==null){if(e===Gh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===$h)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===zh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Hh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Wh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===qh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Xh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Kh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Yh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Qh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Zh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Jh)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===ef)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===tf)return o===be?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===nf)if(i=s.get("EXT_texture_compression_bptc"),i!==null){if(e===nf)return o===be?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===rf||e===sf||e===of||e===af)if(i=s.get("EXT_texture_compression_rgtc"),i!==null){if(e===rf)return i.COMPRESSED_RED_RGTC1_EXT;if(e===sf)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===of)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===af)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Qr?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,s)=>{function i(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),s();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(i);return}e.deleteSync(t),r()}i()})}}let Jy=!1,Gl,ih,eb;class H8{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,Jy===!1&&(this._init(),Jy=!0)}_init(){const e=this.gl;Gl={[xu]:e.REPEAT,[Ta]:e.CLAMP_TO_EDGE,[gu]:e.MIRRORED_REPEAT},ih={[Cn]:e.NEAREST,[t_]:e.NEAREST_MIPMAP_NEAREST,[wa]:e.NEAREST_MIPMAP_LINEAR,[Fn]:e.LINEAR,[Oh]:e.LINEAR_MIPMAP_NEAREST,[Gs]:e.LINEAR_MIPMAP_LINEAR},eb={[l_]:e.NEVER,[a_]:e.ALWAYS,[Gp]:e.LESS,[o_]:e.LEQUAL,[i_]:e.EQUAL,[s_]:e.GEQUAL,[r_]:e.GREATER,[n_]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return e.isCubeTexture===!0?r=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?r=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=t.TEXTURE_3D:r=t.TEXTURE_2D,r}getInternalFormat(e,t,r,s,i=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];ie("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===o.RED&&(r===o.FLOAT&&(l=o.R32F),r===o.HALF_FLOAT&&(l=o.R16F),r===o.UNSIGNED_BYTE&&(l=o.R8),r===o.UNSIGNED_SHORT&&(l=o.R16),r===o.UNSIGNED_INT&&(l=o.R32UI),r===o.BYTE&&(l=o.R8I),r===o.SHORT&&(l=o.R16I),r===o.INT&&(l=o.R32I)),t===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(l=o.R8UI),r===o.UNSIGNED_SHORT&&(l=o.R16UI),r===o.UNSIGNED_INT&&(l=o.R32UI),r===o.BYTE&&(l=o.R8I),r===o.SHORT&&(l=o.R16I),r===o.INT&&(l=o.R32I)),t===o.RG&&(r===o.FLOAT&&(l=o.RG32F),r===o.HALF_FLOAT&&(l=o.RG16F),r===o.UNSIGNED_BYTE&&(l=o.RG8),r===o.UNSIGNED_SHORT&&(l=o.RG16),r===o.UNSIGNED_INT&&(l=o.RG32UI),r===o.BYTE&&(l=o.RG8I),r===o.SHORT&&(l=o.RG16I),r===o.INT&&(l=o.RG32I)),t===o.RG_INTEGER&&(r===o.UNSIGNED_BYTE&&(l=o.RG8UI),r===o.UNSIGNED_SHORT&&(l=o.RG16UI),r===o.UNSIGNED_INT&&(l=o.RG32UI),r===o.BYTE&&(l=o.RG8I),r===o.SHORT&&(l=o.RG16I),r===o.INT&&(l=o.RG32I)),t===o.RGB){const c=i?Gg:pt.getTransfer(s);r===o.FLOAT&&(l=o.RGB32F),r===o.HALF_FLOAT&&(l=o.RGB16F),r===o.UNSIGNED_BYTE&&(l=o.RGB8),r===o.UNSIGNED_SHORT&&(l=o.RGB16),r===o.UNSIGNED_INT&&(l=o.RGB32UI),r===o.BYTE&&(l=o.RGB8I),r===o.SHORT&&(l=o.RGB16I),r===o.INT&&(l=o.RGB32I),r===o.UNSIGNED_BYTE&&(l=c===be?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(l=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(l=o.RGB9_E5),r===o.UNSIGNED_INT_10F_11F_11F_REV&&(l=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(r===o.UNSIGNED_BYTE&&(l=o.RGB8UI),r===o.UNSIGNED_SHORT&&(l=o.RGB16UI),r===o.UNSIGNED_INT&&(l=o.RGB32UI),r===o.BYTE&&(l=o.RGB8I),r===o.SHORT&&(l=o.RGB16I),r===o.INT&&(l=o.RGB32I)),t===o.RGBA){const c=i?Gg:pt.getTransfer(s);r===o.FLOAT&&(l=o.RGBA32F),r===o.HALF_FLOAT&&(l=o.RGBA16F),r===o.UNSIGNED_BYTE&&(l=o.RGBA8),r===o.UNSIGNED_SHORT&&(l=o.RGBA16),r===o.UNSIGNED_INT&&(l=o.RGBA32UI),r===o.BYTE&&(l=o.RGBA8I),r===o.SHORT&&(l=o.RGBA16I),r===o.INT&&(l=o.RGBA32I),r===o.UNSIGNED_BYTE&&(l=c===be?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(l=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(l=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(r===o.UNSIGNED_BYTE&&(l=o.RGBA8UI),r===o.UNSIGNED_SHORT&&(l=o.RGBA16UI),r===o.UNSIGNED_INT&&(l=o.RGBA32UI),r===o.BYTE&&(l=o.RGBA8I),r===o.SHORT&&(l=o.RGBA16I),r===o.INT&&(l=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_SHORT&&(l=o.DEPTH_COMPONENT16),r===o.UNSIGNED_INT&&(l=o.DEPTH_COMPONENT24),r===o.FLOAT&&(l=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(l=o.DEPTH24_STENCIL8),(l===o.R16F||l===o.R32F||l===o.RG16F||l===o.RG32F||l===o.RGBA16F||l===o.RGBA32F)&&a.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:r,extensions:s,backend:i}=this,o=pt.getPrimaries(pt.workingColorSpace),a=t.colorSpace===Hi?null:pt.getPrimaries(t.colorSpace),l=t.colorSpace===Hi||o===a?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),r.texParameteri(e,r.TEXTURE_WRAP_S,Gl[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,Gl[t.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,Gl[t.wrapR])),r.texParameteri(e,r.TEXTURE_MAG_FILTER,ih[t.magFilter]);const c=t.mipmaps!==void 0&&t.mipmaps.length>0,u=t.minFilter===Fn&&c?Gs:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,ih[u]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,eb[t.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Cn||t.minFilter!==wa&&t.minFilter!==Gs||t.type===dn&&s.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const d=s.get("EXT_texture_filter_anisotropic");r.texParameterf(e,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:s}=this,i=this.getGLTextureType(e);let o=s[i];o===void 0&&(o=t.createTexture(),r.state.bindTexture(i,o),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),s[i]=o),r.set(e,{textureGPU:o,glTextureType:i})}createTexture(e,t){const{gl:r,backend:s}=this,{levels:i,width:o,height:a,depth:l}=t,c=s.utils.convert(e.format,e.colorSpace),u=s.utils.convert(e.type),d=this.getInternalFormat(e.internalFormat,c,u,e.colorSpace,e.isVideoTexture),h=r.createTexture(),f=this.getGLTextureType(e);s.state.bindTexture(f,h),this.setTextureParameters(f,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,i,d,o,a,l):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,i,d,o,a,l):e.isVideoTexture||r.texStorage2D(f,i,d,o,a),s.set(e,{textureGPU:h,glTextureType:f,glFormat:c,glType:u,glInternalFormat:d})}copyBufferToTexture(e,t){const{gl:r,backend:s}=this,{textureGPU:i,glTextureType:o,glFormat:a,glType:l}=s.get(t),{width:c,height:u}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),s.state.bindTexture(o,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,c,u,a,l,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:s,height:i}=t,{textureGPU:o,glTextureType:a,glFormat:l,glType:c,glInternalFormat:u}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const d=e.mipmaps,h=t.image;for(let f=0;f<d.length;f++){const p=d[f];e.isCompressedArrayTexture?e.format!==r.RGBA?l!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,f,0,0,0,p.width,p.height,h.depth,l,p.data):ie("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,f,0,0,0,p.width,p.height,h.depth,l,c,p.data):l!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,f,0,0,p.width,p.height,l,p.data):ie("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images,h=e.mipmaps;for(let f=0;f<6;f++){const p=$l(d[f]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,s,i,l,c,p);for(let m=0;m<h.length;m++){const y=h[m],x=$l(y.images[f]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+f,m+1,0,0,x.width,x.height,l,c,x)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const d=t.image;if(e.layerUpdates.size>0){const h=s2(d.width,d.height,e.format,e.type);for(const f of e.layerUpdates){const p=d.data.subarray(f*h/d.data.BYTES_PER_ELEMENT,(f+1)*h/d.data.BYTES_PER_ELEMENT);r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,f,d.width,d.height,1,l,c,p)}e.clearLayerUpdates()}else r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,l,c,d.data)}else if(e.isData3DTexture){const d=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,l,c,d.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(a,0,u,l,c,t.image);else{const d=e.mipmaps;if(d.length>0)for(let h=0,f=d.length;h<f;h++){const p=d[h],m=$l(p);r.texSubImage2D(a,h,0,0,p.width,p.height,l,c,m)}else{const h=$l(t.image);r.texSubImage2D(a,0,0,0,s,i,l,c,h)}}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:s,glTextureType:i}=r.get(e);r.state.bindTexture(i,s),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const s=r.get(e);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const i in s.framebuffers)t.deleteFramebuffer(s.framebuffers[i]);delete s.framebuffers}if(s.depthRenderbuffer&&(t.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(t.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(t.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let i=0;i<s.msaaRenderbuffers.length;i++)t.deleteRenderbuffer(s.msaaRenderbuffers[i]);delete s.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:r,backend:s}=this,{textureGPU:i,renderTarget:o}=s.get(e);this.deallocateRenderBuffers(o),t===!1&&r.deleteTexture(i),s.delete(e)}copyTextureToTexture(e,t,r=null,s=null,i=0,o=0){const{gl:a,backend:l}=this,{state:c}=this.backend,{textureGPU:u,glTextureType:d,glType:h,glFormat:f}=l.get(t);c.bindTexture(d,u);let p,m,y,x,b,v,_,w,T;const N=e.isCompressedTexture?e.mipmaps[o]:e.image;if(r!==null)p=r.max.x-r.min.x,m=r.max.y-r.min.y,y=r.isBox3?r.max.z-r.min.z:1,x=r.min.x,b=r.min.y,v=r.isBox3?r.min.z:0;else{const O=Math.pow(2,-i);p=Math.floor(N.width*O),m=Math.floor(N.height*O),e.isDataArrayTexture||e.isArrayTexture?y=N.depth:e.isData3DTexture?y=Math.floor(N.depth*O):y=1,x=0,b=0,v=0}s!==null?(_=s.x,w=s.y,T=s.z):(_=0,w=0,T=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const S=a.getParameter(a.UNPACK_ROW_LENGTH),C=a.getParameter(a.UNPACK_IMAGE_HEIGHT),D=a.getParameter(a.UNPACK_SKIP_PIXELS),F=a.getParameter(a.UNPACK_SKIP_ROWS),j=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,N.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,N.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,x),a.pixelStorei(a.UNPACK_SKIP_ROWS,b),a.pixelStorei(a.UNPACK_SKIP_IMAGES,v);const z=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,A=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const O=l.get(e),k=l.get(t),R=l.get(O.renderTarget),I=l.get(k.renderTarget),P=R.framebuffers[O.cacheKey],W=I.framebuffers[k.cacheKey];c.bindFramebuffer(a.READ_FRAMEBUFFER,P),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,W);for(let L=0;L<y;L++)z&&(a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,O.textureGPU,i,v+L),a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,o,T+L)),a.blitFramebuffer(x,b,p,m,_,w,p,m,a.DEPTH_BUFFER_BIT,a.NEAREST);c.bindFramebuffer(a.READ_FRAMEBUFFER,null),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else if(i!==0||e.isRenderTargetTexture||l.has(e)){const O=l.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=a.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=a.createFramebuffer()),c.bindFramebuffer(a.READ_FRAMEBUFFER,this._srcFramebuffer),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let k=0;k<y;k++)z?a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,O.textureGPU,i,v+k):a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,O.textureGPU,i),A?a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,o,T+k):a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,u,o),i!==0?a.blitFramebuffer(x,b,p,m,_,w,p,m,a.COLOR_BUFFER_BIT,a.NEAREST):A?a.copyTexSubImage3D(d,o,_,w,T+k,x,b,p,m):a.copyTexSubImage2D(d,o,_,w,x,b,p,m);c.bindFramebuffer(a.READ_FRAMEBUFFER,null),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else A?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(d,o,_,w,T,p,m,y,f,h,N.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(d,o,_,w,T,p,m,y,f,N.data):a.texSubImage3D(d,o,_,w,T,p,m,y,f,h,N):e.isDataTexture?a.texSubImage2D(a.TEXTURE_2D,o,_,w,p,m,f,h,N.data):e.isCompressedTexture?a.compressedTexSubImage2D(a.TEXTURE_2D,o,_,w,N.width,N.height,f,N.data):a.texSubImage2D(a.TEXTURE_2D,o,_,w,p,m,f,h,N);a.pixelStorei(a.UNPACK_ROW_LENGTH,S),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,C),a.pixelStorei(a.UNPACK_SKIP_PIXELS,D),a.pixelStorei(a.UNPACK_SKIP_ROWS,F),a.pixelStorei(a.UNPACK_SKIP_IMAGES,j),o===0&&t.generateMipmaps&&a.generateMipmap(d),c.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:s}=this,{state:i}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:l,z:c,w:u}=r,d=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,h=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(d){const f=a!==0||l!==0;let p,m;if(e.isDepthTexture===!0?(p=s.DEPTH_BUFFER_BIT,m=s.DEPTH_ATTACHMENT,t.stencil&&(p|=s.STENCIL_BUFFER_BIT)):(p=s.COLOR_BUFFER_BIT,m=s.COLOR_ATTACHMENT0),f){const y=this.backend.get(t.renderTarget),x=y.framebuffers[t.getCacheKey()],b=y.msaaFrameBuffer;i.bindFramebuffer(s.DRAW_FRAMEBUFFER,x),i.bindFramebuffer(s.READ_FRAMEBUFFER,b);const v=h-l-u;s.blitFramebuffer(a,v,a+c,v+u,a,v,a+c,v+u,p,s.NEAREST),i.bindFramebuffer(s.READ_FRAMEBUFFER,x),i.bindTexture(s.TEXTURE_2D,o),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,a,v,c,u),i.unbindTexture()}else{const y=s.createFramebuffer();i.bindFramebuffer(s.DRAW_FRAMEBUFFER,y),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,m,s.TEXTURE_2D,o,0),s.blitFramebuffer(0,0,c,u,0,0,c,u,p,s.NEAREST),s.deleteFramebuffer(y)}}else i.bindTexture(s.TEXTURE_2D,o),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,a,h-u-l,c,u),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,s=!1){const{gl:i}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:l,stencilBuffer:c,width:u,height:d}=o;if(i.bindRenderbuffer(i.RENDERBUFFER,e),l&&!c){let h=i.DEPTH_COMPONENT24;s===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,o.samples,h,u,d):r>0?(a&&a.isDepthTexture&&a.type===i.FLOAT&&(h=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,r,h,u,d)):i.renderbufferStorage(i.RENDERBUFFER,h,u,d),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else l&&c&&(r>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,r,i.DEPTH24_STENCIL8,u,d):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,u,d),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,r,s,i,o){const{backend:a,gl:l}=this,{textureGPU:c,glFormat:u,glType:d}=this.backend.get(e),h=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,h);const f=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+o:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,c,0);const p=this._getTypedArrayType(d),m=this._getBytesPerTexel(d,u),x=s*i*m,b=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,b),l.bufferData(l.PIXEL_PACK_BUFFER,x,l.STREAM_READ),l.readPixels(t,r,s,i,u,d,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const v=new p(x/p.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,b),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,v),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(h),v}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let s=0;if(e===r.UNSIGNED_BYTE&&(s=1),(e===r.UNSIGNED_SHORT_4_4_4_4||e===r.UNSIGNED_SHORT_5_5_5_1||e===r.UNSIGNED_SHORT_5_6_5||e===r.UNSIGNED_SHORT||e===r.HALF_FLOAT)&&(s=2),(e===r.UNSIGNED_INT||e===r.FLOAT)&&(s=4),t===r.RGBA)return s*4;if(t===r.RGB)return s*3;if(t===r.ALPHA)return s}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function $l(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class W8{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class q8{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const tb={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class X8{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:s,object:i,type:o,info:a,index:l}=this;l!==0?r.drawElements(s,t,o,e):r.drawArrays(s,e,t),a.update(i,t,1)}renderInstances(e,t,r){const{gl:s,mode:i,type:o,index:a,object:l,info:c}=this;r!==0&&(a!==0?s.drawElementsInstanced(i,t,o,e,r):s.drawArraysInstanced(i,e,t,r),c.update(l,t,r))}renderMultiDraw(e,t,r){const{extensions:s,mode:i,object:o,info:a}=this;if(r===0)return;const l=s.get("WEBGL_multi_draw");if(l===null)for(let c=0;c<r;c++)this.render(e[c],t[c]);else{this.index!==0?l.multiDrawElementsWEBGL(i,t,0,this.type,e,0,r):l.multiDrawArraysWEBGL(i,e,0,t,0,r);let c=0;for(let u=0;u<r;u++)c+=t[u];a.update(o,c,1)}}renderMultiDrawInstances(e,t,r,s){const{extensions:i,mode:o,object:a,info:l}=this;if(r===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<r;u++)this.renderInstances(e[u],t[u],s[u]);else{this.index!==0?c.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,s,0,r):c.multiDrawArraysInstancedWEBGL(o,e,0,t,0,s,0,r);let u=0;for(let d=0;d<r;d++)u+=t[d]*s[d];l.update(a,u,1)}}}class zS{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(ie(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class K8 extends zS{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){ie("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let s=0;s<this.maxQueries;s++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const r=this.queries[t];if(r)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(s){s("Error in beginQuery:",s),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){r("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[i,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const l=this.queries[o];e.set(i,this.resolveQuery(l))}if(e.size===0)return this.lastValue;const t={},r=[];for(const[i,o]of e){const a=i.match(/^(.*):f(\d+)$/),l=parseInt(a[2]);r.includes(l)===!1&&r.push(l),t[l]===void 0&&(t[l]=0);const c=await o;this.timestamps.set(i,c),t[l]+=c}const s=t[r[r.length-1]];return this.lastValue=s,this.frames=r,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,s}catch(e){return e("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let r,s=!1;const i=()=>{r&&(clearTimeout(r),r=null)},o=l=>{s||(s=!0,i(),t(l))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){r=setTimeout(a,1);return}const u=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(u)/1e6)}catch(l){l("Error checking query:",l),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class nb extends $S{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},s=t.context!==void 0?t.context:e.domElement.getContext("webgl2",r);function i(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=s,this.extensions=new W8(this),this.capabilities=new q8(this),this.attributeUtils=new G8(this),this.textureUtils=new H8(this),this.bufferRenderer=new X8(this),this.state=new $8(this),this.utils=new z8(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return Ac}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const s=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:s.RGBA8}),r!==null){const i=e.stencilBuffer?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:i}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&ie("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new K8(this.gl,e,2048));const r=this.timestampQueryPool[e];r.allocateQueriesForContext(t)!==null&&r.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:i,height:o}=this.getDrawingBufferSize();t.viewport(0,0,i,o)}if(e.scissor){const{x:i,y:o,width:a,height:l}=e.scissorValue;t.scissor(i,e.height-l-o,a,l)}this.initTimestampQuery(qn.RENDER,this.getTimestampUID(e)),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const s=e.occlusionQueryCount;s>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(s),r.occlusionQueryObjects=new Array(s),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,s=this.get(e),i=s.previousContext;r.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>s.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let l=0;l<a.length;l++){const c=a[l];c.generateMipmaps&&this.generateMipmaps(c)}if(this._currentContext=i,this._resolveRenderTarget(e),i!==null)if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:l,height:c}=this.getDrawingBufferSize();r.viewport(0,0,l,c)}this.prepareTimestampBuffer(qn.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:s}=t;if(r&&s){const i=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let l=0;for(let c=0;c<r.length;c++){const u=r[c];u!==null&&o.getQueryParameter(u,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(u,o.QUERY_RESULT)===0&&i.add(s[c]),r[c]=null,o.deleteQuery(u),l++)}l<r.length?requestAnimationFrame(a):t.occluded=i};a()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:s,width:i,height:o}=e.viewportValue;t.viewport(r,e.height-o-s,i,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,s=null,i=!0,o=!0){const{gl:a,renderer:l}=this;s===null&&(s={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=a.COLOR_BUFFER_BIT),t&&(c|=a.DEPTH_BUFFER_BIT),r&&(c|=a.STENCIL_BUFFER_BIT),c!==0){let u;s.clearColorValue?u=s.clearColorValue:u=this.getClearColor();const d=l.getClearDepth(),h=l.getClearStencil();if(t&&this.state.setDepthMask(!0),s.textures===null)a.clearColor(u.r,u.g,u.b,u.a),a.clear(c);else{if(i&&this._setFramebuffer(s),e)for(let f=0;f<s.textures.length;f++)f===0?a.clearBufferfv(a.COLOR,f,[u.r,u.g,u.b,u.a]):a.clearBufferfv(a.COLOR,f,[0,0,0,1]);t&&r?a.clearBufferfi(a.DEPTH_STENCIL,0,d,h):t?a.clearBufferfv(a.DEPTH,0,[d]):r&&a.clearBufferiv(a.STENCIL,0,[h]),i&&o&&this._resolveRenderTarget(s)}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(qn.COMPUTE,this.getTimestampUID(e))}compute(e,t,r,s,i=null){const{state:o,gl:a}=this;this.discard===!1&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:c,attributes:u}=this.get(s),d=this._getVaoKey(u),h=this.vaoCache[d];h===void 0?this.vaoCache[d]=this._createVao(u):o.setVertexState(h),o.useProgram(l),this._bindUniforms(r);const f=this._getTransformFeedback(c);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,f),a.beginTransformFeedback(a.POINTS),i=i!==null?i:t.count,Array.isArray(i)?(ft("WebGLBackend.compute(): The count parameter must be a single number, not an array."),i=i[0]):i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute&&(ft("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),i=t.count),u[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,i):a.drawArrays(a.POINTS,0,i),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let p=0;p<c.length;p++){const m=c[p];m.pbo&&this.has(m.pbo)&&this.textureUtils.copyBufferToTexture(m.transformBuffer,m.pbo),m.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(qn.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:s,context:i,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(r),{gl:l,state:c}=this,u=this.get(i),d=e.getDrawParameters();if(d===null)return;this._bindUniforms(e.getBindings());const h=t.isMesh&&t.matrixWorld.determinant()<0;c.setMaterial(s,h,o),c.useProgram(a);const f=e.getAttributes(),p=this.get(f);let m=p.vaoGPU;if(m===void 0){const S=this._getVaoKey(f);m=this.vaoCache[S],m===void 0&&(m=this._createVao(f),this.vaoCache[S]=m,p.vaoGPU=m)}const y=e.getIndex(),x=y!==null?this.get(y).bufferGPU:null;c.setVertexState(m,x);const b=u.lastOcclusionObject;if(b!==t&&b!==void 0){if(b!==null&&b.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),t.occlusionTest===!0){const S=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,S),u.occlusionQueries[u.occlusionQueryIndex]=S,u.occlusionQueryObjects[u.occlusionQueryIndex]=t}u.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=l.POINTS:t.isLineSegments?v.mode=l.LINES:t.isLine?v.mode=l.LINE_STRIP:t.isLineLoop?v.mode=l.LINE_LOOP:s.wireframe===!0?(c.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=l.LINES):v.mode=l.TRIANGLES;const{vertexCount:_,instanceCount:w}=d;let{firstVertex:T}=d;if(v.object=t,y!==null){T*=y.array.BYTES_PER_ELEMENT;const S=this.get(y);v.index=y.count,v.type=S.type}else v.index=0;const N=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(ft("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):ft("WebGLBackend: WEBGL_multi_draw not supported."):w>1?v.renderInstances(T,_,w):v.render(T,_)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const S=this.get(e.camera),C=e.camera.cameras,D=e.getBindingGroup("cameraIndex").bindings[0];if(S.indexesGPU===void 0||S.indexesGPU.length!==C.length){const k=new Uint32Array([0,0,0,0]),R=[];for(let I=0,P=C.length;I<P;I++){const W=l.createBuffer();k[0]=I,l.bindBuffer(l.UNIFORM_BUFFER,W),l.bufferData(l.UNIFORM_BUFFER,k,l.STATIC_DRAW),R.push(W)}S.indexesGPU=R}const F=this.get(D),j=this.renderer.getPixelRatio(),z=this._currentContext.renderTarget,A=this._isRenderCameraDepthArray(this._currentContext),O=this._currentContext.activeCubeFace;if(A){const k=this.get(z.depthTexture);if(k.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){k.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:R}=z;for(let I=0,P=C.length;I<P;I++)this.renderer._activeCubeFace=I,this._currentContext.activeCubeFace=I,this._setFramebuffer(this._currentContext),this.clear(!1,!0,R,this._currentContext,!1,!1);this.renderer._activeCubeFace=O,this._currentContext.activeCubeFace=O}}for(let k=0,R=C.length;k<R;k++){const I=C[k];if(t.layers.test(I.layers)){A&&(this.renderer._activeCubeFace=k,this._currentContext.activeCubeFace=k,this._setFramebuffer(this._currentContext));const P=I.viewport;if(P!==void 0){const W=P.x*j,L=P.y*j,G=P.width*j,Z=P.height*j;c.viewport(Math.floor(W),Math.floor(e.context.height-Z-L),Math.floor(G),Math.floor(Z))}c.bindBufferBase(l.UNIFORM_BUFFER,F.index,S.indexesGPU[k]),N()}this._currentContext.activeCubeFace=O,this.renderer._activeCubeFace=O}}else N()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,s,i,o){return this.textureUtils.copyTextureToBuffer(e,t,r,s,i,o)}updateSampler(){return""}createNodeBuilder(e,t){return new U8(e,t)}createProgram(e){const t=this.gl,{stage:r,code:s}=e,i=r==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,s),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,s=e.pipeline,{fragmentProgram:i,vertexProgram:o}=s,a=r.createProgram(),l=this.get(i).shaderGPU,c=this.get(o).shaderGPU;if(r.attachShader(a,l),r.attachShader(a,c),r.linkProgram(a),this.set(s,{programGPU:a,fragmentShader:l,vertexShader:c}),t!==null&&this.parallel){const u=new Promise(d=>{const h=this.parallel,f=()=>{r.getProgramParameter(a,h.COMPLETION_STATUS_KHR)?(this._completeCompile(e,s),d()):requestAnimationFrame(f)};f()});t.push(u);return}this._completeCompile(e,s)}_handleSource(e,t){const r=e.split(`
`),s=[],i=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let a=i;a<o;a++){const l=a+1;s.push(`${l===t?">":" "} ${l}: ${r[a]}`)}return s.join(`
`)}_getShaderErrors(e,t,r){const s=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(s&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const l=parseInt(a[1]);return r.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),l)}else return o}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const s=this.gl,o=(s.getProgramInfoLog(e)||"").trim();if(s.getProgramParameter(e,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,e,r,t);else{const a=this._getShaderErrors(s,r,"vertex"),l=this._getShaderErrors(s,t,"fragment");se("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(e,s.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+a+`
`+l)}else o!==""&&ie("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:r,gl:s}=this,i=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:l}=i;s.getProgramParameter(o,s.LINK_STATUS)===!1&&this._logProgramError(o,a,l),r.useProgram(o);const c=e.getBindings();this._setupBindings(c,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:r,gl:s}=this,i={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(i);const{computeProgram:o}=e,a=s.createProgram(),l=this.get(i).shaderGPU,c=this.get(o).shaderGPU,u=o.transforms,d=[],h=[];for(let y=0;y<u.length;y++){const x=u[y];d.push(x.varyingName),h.push(x.attributeNode)}s.attachShader(a,l),s.attachShader(a,c),s.transformFeedbackVaryings(a,d,s.SEPARATE_ATTRIBS),s.linkProgram(a),s.getProgramParameter(a,s.LINK_STATUS)===!1&&this._logProgramError(a,l,c),r.useProgram(a),this._setupBindings(t,a);const f=o.attributes,p=[],m=[];for(let y=0;y<f.length;y++){const x=f[y].node.attribute;p.push(x),this.has(x)||this.attributeUtils.createAttribute(x,s.ARRAY_BUFFER)}for(let y=0;y<h.length;y++){const x=h[y].attribute;this.has(x)||this.attributeUtils.createAttribute(x,s.ARRAY_BUFFER);const b=this.get(x);m.push(b)}this.set(e,{programGPU:a,transformBuffers:m,attributes:p})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let r=0,s=0;for(const i of t){this.set(i,{textures:s,uniformBuffers:r});for(const o of i.bindings)o.isUniformBuffer&&r++,o.isSampledTexture&&s++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let s=r.uniformBuffers,i=r.textures;for(const o of e.bindings){const a=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const l=o.buffer;let{bufferGPU:c}=this.get(l);c===void 0?(c=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW),this.set(l,{bufferGPU:c})):(t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferSubData(t.UNIFORM_BUFFER,0,l)),a.index=s++,a.bufferGPU=c,this.set(o,a)}else if(o.isSampledTexture){const{textureGPU:l,glTextureType:c}=this.get(o.texture);a.index=i++,a.textureGPU=l,a.glTextureType=c,this.set(o,a)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const s=this.get(e).bufferGPU,i=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,s),t.bufferData(t.UNIFORM_BUFFER,i,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(tb).filter(s=>tb[s]===e),r=this.extensions;for(let s=0;s<t.length;s++)if(r.has(t[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,s=null,i=0,o=0){this.textureUtils.copyTextureToTexture(e,t,r,s,i,o)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let s=null;if(e.textures!==null){const i=e.renderTarget,o=this.get(i),{samples:a,depthBuffer:l,stencilBuffer:c}=i,u=i.isWebGLCubeRenderTarget===!0,d=i.isRenderTarget3D===!0,h=i.depth>1,f=i.isXRRenderTarget===!0,p=f===!0&&i._hasExternalTextures===!0;let m=o.msaaFrameBuffer,y=o.depthRenderbuffer;const x=this.extensions.get("WEBGL_multisampled_render_to_texture"),b=this.extensions.get("OVR_multiview2"),v=this._useMultisampledExtension(i),_=wS(e);let w;if(u?(o.cubeFramebuffers||(o.cubeFramebuffers={}),w=o.cubeFramebuffers[_]):f&&p===!1?w=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),w=o.framebuffers[_]),w===void 0){w=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,w);const T=e.textures,N=[];if(u){o.cubeFramebuffers[_]=w;const{textureGPU:C}=this.get(T[0]),D=this.renderer._activeCubeFace,F=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+D,C,F)}else{o.framebuffers[_]=w;for(let C=0;C<T.length;C++){const D=T[C],F=this.get(D);F.renderTarget=e.renderTarget,F.cacheKey=_;const j=t.COLOR_ATTACHMENT0+C;if(i.multiview)b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,j,F.textureGPU,0,a,0,2);else if(d||h){const z=this.renderer._activeCubeFace,A=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,j,F.textureGPU,A,z)}else if(v)x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,j,t.TEXTURE_2D,F.textureGPU,0,a);else{const z=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,j,t.TEXTURE_2D,F.textureGPU,z)}}}const S=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const C=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(C,e,0,v),o.xrDepthRenderbuffer=C,N.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,C),t.framebufferRenderbuffer(t.FRAMEBUFFER,S,t.RENDERBUFFER,C)}else if(e.depthTexture!==null){N.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const C=this.get(e.depthTexture);if(C.renderTarget=e.renderTarget,C.cacheKey=_,i.multiview)b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,S,C.textureGPU,0,a,0,2);else if(p&&v)x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const D=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,S,C.textureGPU,0,D)}else t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0)}o.depthInvalidationArray=N}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,w);const N=this.renderer._activeCubeFace,S=this.get(e.depthTexture),C=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,C,S.textureGPU,0,N)}if((f||v||i.multiview)&&i._isOpaqueFramebuffer!==!0){r.bindFramebuffer(t.FRAMEBUFFER,w);const N=this.get(e.textures[0]);i.multiview?b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,N.textureGPU,0,a,0,2):v?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,N.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,N.textureGPU,0);const S=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const C=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,C),t.framebufferRenderbuffer(t.FRAMEBUFFER,S,t.RENDERBUFFER,C)}else{const C=this.get(e.depthTexture);i.multiview?b.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,S,C.textureGPU,0,a,0,2):v?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,S,t.TEXTURE_2D,C.textureGPU,0)}}}if(a>0&&v===!1&&!i.multiview){if(m===void 0){const T=[];m=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,m);const N=[],S=e.textures;for(let C=0;C<S.length;C++){N[C]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,N[C]),T.push(t.COLOR_ATTACHMENT0+C);const D=e.textures[C],F=this.get(D);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,F.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+C,t.RENDERBUFFER,N[C])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=m,o.msaaRenderbuffers=N,l&&y===void 0){y=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(y,e,a),o.depthRenderbuffer=y;const C=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;T.push(C)}o.invalidationArray=T}s=o.msaaFrameBuffer}else s=w;r.drawBuffers(e,w)}r.bindFramebuffer(t.FRAMEBUFFER,s)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){const s=this.get(e[r]);t+=":"+s.id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();t.bindVertexArray(r);for(let s=0;s<e.length;s++){const i=e[s],o=this.get(i);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(s);let a,l;i.isInterleavedBufferAttribute===!0?(a=i.data.stride*o.bytesPerElement,l=i.offset*o.bytesPerElement):(a=0,l=0),o.isInteger?t.vertexAttribIPointer(s,i.itemSize,o.type,a,l):t.vertexAttribPointer(s,i.itemSize,o.type,i.normalized,a,l),i.isInstancedBufferAttribute&&!i.isInterleavedBufferAttribute?t.vertexAttribDivisor(s,i.meshPerAttribute):i.isInterleavedBufferAttribute&&i.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(s,i.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),r}_getTransformFeedback(e){let t="";for(let i=0;i<e.length;i++)t+=":"+e[i].id;let r=this.transformFeedbackCache[t];if(r!==void 0)return r;const{gl:s}=this;r=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,r);for(let i=0;i<e.length;i++){const o=e[i];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,i,o.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const s of e)for(const i of s.bindings){const a=this.get(i).index;if(i.isUniformsGroup||i.isUniformBuffer){const l=r.getUniformBlockIndex(t,i.name);r.uniformBlockBinding(t,l,a)}else if(i.isSampledTexture){const l=r.getUniformLocation(t,i.name);r.uniform1i(l,a)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const s of e)for(const i of s.bindings){const o=this.get(i),a=o.index;i.isUniformsGroup||i.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):i.isSampledTexture&&r.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_resolveRenderTarget(e){const{gl:t,state:r}=this,s=e.renderTarget;if(e.textures!==null&&s){const i=this.get(s);if(s.samples>0&&this._useMultisampledExtension(s)===!1){const o=i.framebuffers[e.getCacheKey()];let a=t.COLOR_BUFFER_BIT;s.resolveDepthBuffer&&(s.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),s.stencilBuffer&&s.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT));const l=i.msaaFrameBuffer,c=i.msaaRenderbuffers,u=e.textures,d=u.length>1;if(r.bindFramebuffer(t.READ_FRAMEBUFFER,l),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),d)for(let h=0;h<u.length;h++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.TEXTURE_2D,null,0);for(let h=0;h<u.length;h++){if(d){const{textureGPU:f}=this.get(u[h]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c[h]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0)}if(e.scissor){const{x:f,y:p,width:m,height:y}=e.scissorValue,x=e.height-y-p;t.blitFramebuffer(f,x,f+m,x+y,f,x,f+m,x+y,a,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST)}if(d)for(let h=0;h<u.length;h++){const{textureGPU:f}=this.get(u[h]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.RENDERBUFFER,c[h]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,t.TEXTURE_2D,f,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray)}else if(s.resolveDepthBuffer===!1&&i.framebuffers){const o=i.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Ci={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},St={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},It={Store:"store"},ke={Load:"load",Clear:"clear"},rb={CCW:"ccw",CW:"cw"},sb={None:"none",Back:"back"},so={Uint16:"uint16",Uint32:"uint32"},M={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},oh={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Bs={Linear:"linear",Nearest:"nearest"},Ae={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Ts={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},ib={None:0,All:15},Ur={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},ah={Storage:"storage",ReadOnlyStorage:"read-only-storage"},lh={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},ob={NonFiltering:"non-filtering",Comparison:"comparison"},ws={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},ab={TwoD:"2d",ThreeD:"3d"},ht={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},Y8={All:"all"},zl={Vertex:"vertex",Instance:"instance"},Jf={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},lb={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class Q8 extends jS{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Z8 extends IS{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let J8=0;class e6 extends Z8{constructor(e,t){super("StorageBuffer_"+J8++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Xn.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class t6 extends cs{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Bs.Linear}),this.flipYSampler=e.createSampler({minFilter:Bs.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:s})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Ci.TriangleStrip,stripIndexFormat:so.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Ci.TriangleStrip,stripIndexFormat:so.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const s=t.format,{width:i,height:o}=t.size,a=this.getTransferPipeline(s),l=this.getFlipYPipeline(s),c=this.device.createTexture({size:{width:i,height:o,depthOrArrayLayers:1},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:r}),d=c.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),f=(p,m,y)=>{const x=p.getBindGroupLayout(0),b=this.device.createBindGroup({layout:x,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:m}]}),v=h.beginRenderPass({colorAttachments:[{view:y,loadOp:ke.Clear,storeOp:It.Store,clearValue:[0,0,0,0]}]});v.setPipeline(p),v.setBindGroup(0,b),v.draw(4,1,0,0),v.end()};f(a,u,d),f(l,d,u),this.device.queue.submit([h.finish()]),c.destroy()}generateMipmaps(e,t,r=0,s=null){const i=this.get(e);i.layers===void 0&&(i.layers=[]);const o=i.layers[r]||this._mipmapCreateBundles(e,t,r),a=s||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,o),s===null&&this.device.queue.submit([a.finish()]),i.layers[r]=o}_mipmapCreateBundles(e,t,r){const s=this.getTransferPipeline(t.format),i=s.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:r});const a=[];for(let l=1;l<t.mipLevelCount;l++){const c=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),u=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:ht.TwoD,baseArrayLayer:r}),d={colorAttachments:[{view:u,loadOp:ke.Clear,storeOp:It.Store,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[t.format]});h.setPipeline(s),h.setBindGroup(0,c),h.draw(4,1,0,0),a.push({renderBundles:[h.finish()],passDescriptor:d}),o=u}return a}_mipmapRunBundles(e,t){const r=t.length;for(let s=0;s<r;s++){const i=t[s],o=e.beginRenderPass(i.passDescriptor);o.executeBundles(i.renderBundles),o.end()}}}const n6={[l_]:"never",[Gp]:"less",[i_]:"equal",[o_]:"less-equal",[r_]:"greater",[s_]:"greater-equal",[a_]:"always",[n_]:"not-equal"},r6=[0,1,3,2,4,5];class s6{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,r=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let s=this._samplerCache.get(r);if(s===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Bs.Linear&&o.minFilter===Bs.Linear&&o.mipmapFilter===Bs.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=n6[e.compareFunction]),s={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(r,s)}const i=t.get(e);if(i.sampler!==s.sampler){if(i.sampler!==void 0){const o=this._samplerCache.get(i.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=r,i.sampler=s.sampler,s.usedTimes++}return r}createDefaultTexture(e){let t;const r=ep(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,s=r.get(e);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){s.texture=e.sourceTexture,s.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:i,height:o,depth:a,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const c=this._getDimension(e),u=e.internalFormat||t.format||ep(e,r.device);s.format=u;const{samples:d,primarySamples:h,isMSAA:f}=r.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(p|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&u!==M.RGB9E5UFloat&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const m={label:e.name,size:{width:i,height:o,depthOrArrayLayers:a},mipLevelCount:l,sampleCount:h,dimension:c,format:u,usage:p};if(u===void 0){ie("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(m.textureBindingViewDimension=ht.Cube),s.texture=r.device.createTexture(m),f){const y=Object.assign({},m);y.label=y.label+"-msaa",y.sampleCount=d,y.mipLevelCount=1,s.msaaTexture=r.device.createTexture(y)}s.initialized=!0,s.textureDescriptorGPU=m}destroyTexture(e,t=!1){const r=this.backend,s=r.get(e);s.texture!==void 0&&t===!1&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),r.delete(e)}generateMipmaps(e,t=null){const r=this.backend.get(e);if(e.isCubeTexture)for(let s=0;s<6;s++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,s,t);else{const s=e.image.depth||1;for(let i=0;i<s;i++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,i,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:r,height:s}=e.getDrawingBufferSize(),i=e.renderer.currentSamples,o=t.colorTexture,a=e.get(o);if(o.width===r&&o.height===s&&o.samples===i)return a.texture;let l=a.texture;return l&&l.destroy(),l=e.device.createTexture({label:"colorBuffer",size:{width:r,height:s,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=r,o.source.height=s,o.samples=i,a.texture=l,l}getDepthBuffer(e=!0,t=!1){const r=this.backend,s=r.renderer.getCanvasTarget(),{width:i,height:o}=r.getDrawingBufferSize(),a=r.renderer.currentSamples,l=s.depthTexture;if(l.width===i&&l.height===o&&l.samples===a&&l.depth===e&&l.stencil===t)return r.get(l).texture;const c=r.get(l).texture;let u,d;if(t?(u=Zr,d=Qr):e&&(u=Jr,d=mt),c!==void 0){if(l.image.width===i&&l.image.height===o&&l.format===u&&l.type===d&&l.samples===a)return c;this.destroyTexture(l)}return l.name="depthBuffer",l.format=u,l.type=d,l.image.width=i,l.image.height=o,l.samples=a,this.createTexture(l,{width:i,height:o}),r.get(l).texture}updateTexture(e,t){const r=this.backend.get(e),s=e.mipmaps,{textureDescriptorGPU:i}=r;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)if(s.length>0)for(let o=0,a=s.length;o<a;o++){const l=s[o];this._copyBufferToTexture(l,r.texture,i,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,r.texture,i,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,r.texture,i,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,r.texture,i);else if(s.length>0)for(let o=0,a=s.length;o<a;o++){const l=s[o];this._copyImageToTexture(l,r.texture,i,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,r.texture,i,0,e.flipY,e.premultiplyAlpha);r.version=e.version}}async copyTextureToBuffer(e,t,r,s,i,o){const a=this.backend.device,l=this.backend.get(e),c=l.texture,u=l.textureDescriptorGPU.format,d=this._getBytesPerTexel(u);let h=s*d;h=Math.ceil(h/256)*256;const f=a.createBuffer({size:(i-1)*h+s*d,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=a.createCommandEncoder();p.copyTextureToBuffer({texture:c,origin:{x:t,y:r,z:o}},{buffer:f,bytesPerRow:h},{width:s,height:i});const m=this._getTypedArrayType(u);a.queue.submit([p.finish()]),await f.mapAsync(GPUMapMode.READ);const y=f.getMappedRange();return new m(y)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new jp;r.minFilter=Cn,r.magFilter=Cn,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new Vp;r.minFilter=Cn,r.magFilter=Cn,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,r){const s=e.images,i=e.mipmaps;for(let o=0;o<6;o++){const a=s[o],l=e.flipY===!0?r6[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,r,l,e.flipY):this._copyImageToTexture(a,t,r,l,e.flipY,e.premultiplyAlpha);for(let c=0;c<i.length;c++){const d=i[c].images[o];d.isDataTexture?this._copyBufferToTexture(d.image,t,r,l,e.flipY,0,c+1):this._copyImageToTexture(d,t,r,l,e.flipY,e.premultiplyAlpha,c+1)}}}_copyImageToTexture(e,t,r,s,i,o,a=0){const l=this.backend.device,c=a>0?e.width:r.size.width,u=a>0?e.height:r.size.height;l.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:a,origin:{x:0,y:0,z:s},premultipliedAlpha:o},{width:c,height:u,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new t6(this.backend.device)),e}_generateMipmaps(e,t,r=0,s=null){this._getPassUtils().generateMipmaps(e,t,r,s)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,s,i,o=0,a=0){const l=this.backend.device,c=e.data,u=this._getBytesPerTexel(r.format),d=e.width*u;l.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:s}},c,{offset:e.width*e.height*u*o,bytesPerRow:d},{width:e.width,height:e.height,depthOrArrayLayers:1}),i===!0&&this._flipY(t,r,s)}_copyCompressedBufferToTexture(e,t,r){const s=this.backend.device,i=this._getBlockData(r.format),o=r.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const l=e[a],c=l.width,u=l.height,d=o?r.size.depthOrArrayLayers:1,h=Math.ceil(c/i.width)*i.byteLength,f=h*Math.ceil(u/i.height);for(let p=0;p<d;p++)s.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:p}},l.data,{offset:p*f,bytesPerRow:h,rowsPerImage:Math.ceil(u/i.height)},{width:Math.ceil(c/i.width)*i.width,height:Math.ceil(u/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===M.BC1RGBAUnorm||e===M.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===M.BC2RGBAUnorm||e===M.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.BC3RGBAUnorm||e===M.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.BC4RUnorm||e===M.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===M.BC5RGUnorm||e===M.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===M.BC6HRGBUFloat||e===M.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===M.BC7RGBAUnorm||e===M.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.ETC2RGB8Unorm||e===M.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===M.ETC2RGB8A1Unorm||e===M.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===M.ETC2RGBA8Unorm||e===M.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===M.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===M.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===M.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===M.ASTC4x4Unorm||e===M.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===M.ASTC5x4Unorm||e===M.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===M.ASTC5x5Unorm||e===M.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===M.ASTC6x5Unorm||e===M.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===M.ASTC6x6Unorm||e===M.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===M.ASTC8x5Unorm||e===M.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===M.ASTC8x6Unorm||e===M.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===M.ASTC8x8Unorm||e===M.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===M.ASTC10x5Unorm||e===M.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===M.ASTC10x6Unorm||e===M.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===M.ASTC10x8Unorm||e===M.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===M.ASTC10x10Unorm||e===M.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===M.ASTC12x10Unorm||e===M.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===M.ASTC12x12Unorm||e===M.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=oh.ClampToEdge;return e===xu?t=oh.Repeat:e===gu&&(t=oh.MirrorRepeat),t}_convertFilterMode(e){let t=Bs.Linear;return(e===Cn||e===t_||e===wa)&&(t=Bs.Nearest),t}_getBytesPerTexel(e){if(e===M.R8Unorm||e===M.R8Snorm||e===M.R8Uint||e===M.R8Sint)return 1;if(e===M.R16Uint||e===M.R16Sint||e===M.R16Float||e===M.RG8Unorm||e===M.RG8Snorm||e===M.RG8Uint||e===M.RG8Sint)return 2;if(e===M.R32Uint||e===M.R32Sint||e===M.R32Float||e===M.RG16Uint||e===M.RG16Sint||e===M.RG16Float||e===M.RGBA8Unorm||e===M.RGBA8UnormSRGB||e===M.RGBA8Snorm||e===M.RGBA8Uint||e===M.RGBA8Sint||e===M.BGRA8Unorm||e===M.BGRA8UnormSRGB||e===M.RGB9E5UFloat||e===M.RGB10A2Unorm||e===M.RG11B10UFloat||e===M.Depth32Float||e===M.Depth24Plus||e===M.Depth24PlusStencil8||e===M.Depth32FloatStencil8)return 4;if(e===M.RG32Uint||e===M.RG32Sint||e===M.RG32Float||e===M.RGBA16Uint||e===M.RGBA16Sint||e===M.RGBA16Float)return 8;if(e===M.RGBA32Uint||e===M.RGBA32Sint||e===M.RGBA32Float)return 16}_getTypedArrayType(e){if(e===M.R8Uint)return Uint8Array;if(e===M.R8Sint)return Int8Array;if(e===M.R8Unorm)return Uint8Array;if(e===M.R8Snorm)return Int8Array;if(e===M.RG8Uint)return Uint8Array;if(e===M.RG8Sint)return Int8Array;if(e===M.RG8Unorm)return Uint8Array;if(e===M.RG8Snorm)return Int8Array;if(e===M.RGBA8Uint)return Uint8Array;if(e===M.RGBA8Sint)return Int8Array;if(e===M.RGBA8Unorm||e===M.RGBA8UnormSRGB)return Uint8Array;if(e===M.RGBA8Snorm)return Int8Array;if(e===M.R16Uint)return Uint16Array;if(e===M.R16Sint)return Int16Array;if(e===M.RG16Uint)return Uint16Array;if(e===M.RG16Sint)return Int16Array;if(e===M.RGBA16Uint)return Uint16Array;if(e===M.RGBA16Sint)return Int16Array;if(e===M.R16Float||e===M.RG16Float||e===M.RGBA16Float)return Uint16Array;if(e===M.R32Uint)return Uint32Array;if(e===M.R32Sint)return Int32Array;if(e===M.R32Float)return Float32Array;if(e===M.RG32Uint)return Uint32Array;if(e===M.RG32Sint)return Int32Array;if(e===M.RG32Float)return Float32Array;if(e===M.RGBA32Uint)return Uint32Array;if(e===M.RGBA32Sint)return Int32Array;if(e===M.RGBA32Float)return Float32Array;if(e===M.BGRA8Unorm||e===M.BGRA8UnormSRGB)return Uint8Array;if(e===M.RGB10A2Unorm||e===M.RGB9E5UFloat||e===M.RG11B10UFloat)return Uint32Array;if(e===M.Depth32Float)return Float32Array;if(e===M.Depth24Plus||e===M.Depth24PlusStencil8)return Uint32Array;if(e===M.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=ab.ThreeD:t=ab.TwoD,t}}function ep(n,e=null){const t=n.format,r=n.type,s=n.colorSpace,i=pt.getTransfer(s);let o;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case sc:case ic:o=i===be?M.BC1RGBAUnormSRGB:M.BC1RGBAUnorm;break;case oc:o=i===be?M.BC2RGBAUnormSRGB:M.BC2RGBAUnorm;break;case ac:o=i===be?M.BC3RGBAUnormSRGB:M.BC3RGBAUnorm;break;case rf:o=M.BC4RUnorm;break;case sf:o=M.BC4RSnorm;break;case of:o=M.BC5RGUnorm;break;case af:o=M.BC5RGSnorm;break;case nf:o=i===be?M.BC7RGBAUnormSRGB:M.BC7RGBAUnorm;break;case Vh:case Uh:o=i===be?M.ETC2RGB8UnormSRGB:M.ETC2RGB8Unorm;break;case jh:o=i===be?M.ETC2RGBA8UnormSRGB:M.ETC2RGBA8Unorm;break;case Gh:o=i===be?M.ASTC4x4UnormSRGB:M.ASTC4x4Unorm;break;case $h:o=i===be?M.ASTC5x4UnormSRGB:M.ASTC5x4Unorm;break;case zh:o=i===be?M.ASTC5x5UnormSRGB:M.ASTC5x5Unorm;break;case Hh:o=i===be?M.ASTC6x5UnormSRGB:M.ASTC6x5Unorm;break;case Wh:o=i===be?M.ASTC6x6UnormSRGB:M.ASTC6x6Unorm;break;case qh:o=i===be?M.ASTC8x5UnormSRGB:M.ASTC8x5Unorm;break;case Xh:o=i===be?M.ASTC8x6UnormSRGB:M.ASTC8x6Unorm;break;case Kh:o=i===be?M.ASTC8x8UnormSRGB:M.ASTC8x8Unorm;break;case Yh:o=i===be?M.ASTC10x5UnormSRGB:M.ASTC10x5Unorm;break;case Qh:o=i===be?M.ASTC10x6UnormSRGB:M.ASTC10x6Unorm;break;case Zh:o=i===be?M.ASTC10x8UnormSRGB:M.ASTC10x8Unorm;break;case Jh:o=i===be?M.ASTC10x10UnormSRGB:M.ASTC10x10Unorm;break;case ef:o=i===be?M.ASTC12x10UnormSRGB:M.ASTC12x10Unorm;break;case tf:o=i===be?M.ASTC12x12UnormSRGB:M.ASTC12x12Unorm;break;case Pn:o=i===be?M.RGBA8UnormSRGB:M.RGBA8Unorm;break;default:se("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Pn:switch(r){case oa:o=M.RGBA8Snorm;break;case aa:o=M.RGBA16Sint;break;case Si:o=M.RGBA16Uint;break;case mt:o=M.RGBA32Uint;break;case Ot:o=M.RGBA32Sint;break;case sn:o=i===be?M.RGBA8UnormSRGB:M.RGBA8Unorm;break;case jt:o=M.RGBA16Float;break;case dn:o=M.RGBA32Float;break;default:se("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case $p:switch(r){case R_:o=M.RGB9E5UFloat;break;case M_:o=M.RG11B10UFloat;break;default:se("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case zp:switch(r){case oa:o=M.R8Snorm;break;case aa:o=M.R16Sint;break;case Si:o=M.R16Uint;break;case mt:o=M.R32Uint;break;case Ot:o=M.R32Sint;break;case sn:o=M.R8Unorm;break;case jt:o=M.R16Float;break;case dn:o=M.R32Float;break;default:se("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case Kr:switch(r){case oa:o=M.RG8Snorm;break;case aa:o=M.RG16Sint;break;case Si:o=M.RG16Uint;break;case mt:o=M.RG32Uint;break;case Ot:o=M.RG32Sint;break;case sn:o=M.RG8Unorm;break;case jt:o=M.RG16Float;break;case dn:o=M.RG32Float;break;default:se("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case Jr:switch(r){case Si:o=M.Depth16Unorm;break;case mt:o=M.Depth24Plus;break;case dn:o=M.Depth32Float;break;default:se("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case Zr:switch(r){case Qr:o=M.Depth24PlusStencil8;break;case dn:e&&e.features.has(Jf.Depth32FloatStencil8)===!1&&se('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=M.Depth32FloatStencil8;break;default:se("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case Hp:switch(r){case Ot:o=M.R32Sint;break;case mt:o=M.R32Uint;break;default:se("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case Wp:switch(r){case Ot:o=M.RG32Sint;break;case mt:o=M.RG32Uint;break;default:se("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case qp:switch(r){case Ot:o=M.RGBA32Sint;break;case mt:o=M.RGBA32Uint;break;default:se("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:se("WebGPURenderer: Unsupported texture format.",t)}return o}const i6=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,o6=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,cb={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},a6=n=>{n=n.trim();const e=n.match(i6);if(e!==null&&e.length===4){const t=e[2],r=[];let s=null;for(;(s=o6.exec(t))!==null;)r.push({name:s[1],type:s[2]});const i=[];for(let u=0;u<r.length;u++){const{name:d,type:h}=r[u];let f=h;f.startsWith("ptr")?f="pointer":(f.startsWith("texture")&&(f=h.split("<")[0]),f=cb[f]),i.push(new Hm(f,d))}const o=n.substring(e[0].length),a=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:cb[a]||a,inputs:i,name:l,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class l6 extends qm{constructor(e){const{type:t,inputs:r,name:s,inputsCode:i,blockCode:o,outputType:a}=a6(e);super(t,r,s),this.inputsCode=i,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class c6 extends kS{parseFunction(e){return new l6(e)}}const _i=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},u6={[Xn.READ_ONLY]:"read",[Xn.WRITE_ONLY]:"write",[Xn.READ_WRITE]:"read_write"},ub={[xu]:"repeat",[Ta]:"clamp",[gu]:"mirror"},Hl={vertex:_i?_i.VERTEX:1,fragment:_i?_i.FRAGMENT:2,compute:_i?_i.COMPUTE:4},db={instance:!0,swizzleAssign:!1,storageBuffer:!0},d6={"^^":"tsl_xor"},h6={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},hb={},qo={tsl_xor:new Nt("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Nt("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Nt("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Nt("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Nt("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Nt("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Nt("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Nt("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Nt("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Nt("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Nt("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Nt("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Nt(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},f6={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};let HS="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(HS+=`diagnostic( off, derivative_uniformity );
`);class p6 extends BS{constructor(e,t){super(e,t,new c6),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,r,s,i,o=this.shaderStage){return o==="fragment"?s?i?`textureSample( ${t}, ${t}_sampler, ${r}, ${s}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${r}, ${s} )`:i?`textureSample( ${t}, ${t}_sampler, ${r}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this.generateTextureSampleLevel(e,t,r,"0",s)}generateTextureSampleLevel(e,t,r,s,i,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${s}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,s):this.generateTextureLod(e,t,r,i,o,s)}generateWrapFunction(e){const t=`tsl_coord_${ub[e.wrapS]}S_${ub[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let r=hb[t];if(r===void 0){const s=[],i=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${i} ) -> ${i} {

	return ${i}(
`;const a=(l,c)=>{l===xu?(s.push(qo.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${c} )`):l===Ta?(s.push(qo.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${c} )`):l===gu?(s.push(qo.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${c} )`):(o+=`		coord.${c}`,ie(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,hb[t]=r=new Nt(o,s)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const s=this.getDataFromNode(e,this.shaderStage,this.globalCache);s.dimensionsSnippet===void 0&&(s.dimensionsSnippet={});let i=s.dimensionsSnippet[r];if(s.dimensionsSnippet[r]===void 0){let o,a;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),c=l>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",c||e.isStorageTexture?o=t:o=`${t}${r?`, u32( ${r} )`:""}`,i=new gc(new xc(`textureDimensions( ${o} )`,a)),s.dimensionsSnippet[r]=i,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(s.arrayLayerCount=new gc(new xc(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(s.cubeFaceCount=new gc(new xc("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,r,s,i="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,i);return s&&(r=`${r} + vec2<f32>(${s}) / ${a}`),`tsl_biquadraticTexture( ${t}, ${o}( ${r} ), ${a}, u32( ${i} ) )`}generateTextureLod(e,t,r,s,i,o="0u"){const a=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,o),c=e.isData3DTexture?"vec3":"vec2";i&&(r=`${r} + ${c}<f32>(${i}) / ${c}<f32>( ${l} )`);const u=`${c}<u32>( ${a}( ${r} ) * ${c}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,u,o,s,null)}generateTextureLoad(e,t,r,s,i,o){s===null&&(s="0u"),o&&(r=`${r} + ${o}`);let a;return i?a=`textureLoad( ${t}, ${r}, ${i}, u32( ${s} ) )`:(a=`textureLoad( ${t}, ${r}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,r,s,i){let o;return s?o=`textureStore( ${t}, ${r}, ${s}, ${i} )`:o=`textureStore( ${t}, ${r}, ${i} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===dn||this.isSampleCompare(e)===!1&&e.minFilter===Cn&&e.magFilter===Cn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,s,i,o=this.shaderStage){let a=null;return this.isUnfilterable(e)?a=this.generateTextureLod(e,t,r,s,i,"0",o):a=this._generateTextureSample(e,t,r,s,i,o),a}generateTextureGrad(e,t,r,s,i,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${s[0]}, ${s[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${s[0]}, ${s[1]} )`;se(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,r,s,i,o,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${s}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${s} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s} )`;se(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,r,s,i,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${s}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${s} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,s):this.generateTextureLod(e,t,r,i,o,s)}generateTextureBias(e,t,r,s,i,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${s}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${s} )`;se(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,s=e.type;return s==="texture"||s==="cubeTexture"||s==="storageTexture"||s==="texture3D"?r:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?this.isCustomStruct(e)?r:r+".value":e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=d6[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(ie("WebGPURenderer: Atomic operations are only supported in compute shaders."),Xn.READ_WRITE):Xn.READ_ONLY:e.access}getStorageAccess(e,t){return u6[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,s=null){const i=super.getUniformFromNode(e,t,r,s),o=this.getDataFromNode(e,r,this.globalCache);if(o.uniformGPU===void 0){let a;const l=e.groupNode,c=l.name,u=this.getBindGroupArray(c,r);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let d=null;const h=this.getNodeAccess(e,r);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?d=new Zf(i.name,i.node,l,h):d=new ju(i.name,i.node,l,h):t==="cubeTexture"?d=new GS(i.name,i.node,l,h):t==="texture3D"&&(d=new Zf(i.name,i.node,l,h)),d.store=e.isStorageTextureNode===!0,d.mipLevel=d.store?e.mipLevel:0,d.setVisibility(Hl[r]),this.isUnfilterable(e.value)===!1&&d.store===!1){const f=new Q8(`${i.name}_sampler`,i.node,l);f.setVisibility(Hl[r]),u.push(f,d),a=[f,d]}else u.push(d),a=[d]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const d=t==="buffer"?US:e6,h=new d(e,l);h.setVisibility(Hl[r]),u.push(h),a=h,i.name=s||"NodeBuffer_"+i.id}else{const d=this.uniformGroups[r]||(this.uniformGroups[r]={});let h=d[c];h===void 0&&(h=new VS(c,l),h.setVisibility(Hl[r]),d[c]=h,u.push(h)),a=this.getNodeUniform(i,t),h.addUniform(a)}o.uniformGPU=a}return i}getBuiltin(e,t,r,s=this.shaderStage){const i=this.builtins[s]||(this.builtins[s]=new Map);return i.has(e)===!1&&i.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),s=[];for(const o of t.inputs)s.push(o.name+" : "+this.getType(o.type));let i=`fn ${t.name}( ${s.join(", ")} ) -> ${this.getType(t.type)} {
${r.vars}
${r.code}
`;return r.result&&(i+=`	return ${r.result};
`),i+=`
}
`,i}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(r!==void 0)for(const s of r)t.push(`enable ${s};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(r!==void 0)for(const{name:s,property:i,type:o}of r.values())t.push(`@builtin( ${s} ) ${i} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,r,s){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:s}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:r,scope:s,bufferType:i,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(i);t.push(`var<${s}> ${r}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&t.push(r);const s=this.getAttributesArray();for(let i=0,o=s.length;i<o;i++){const a=s[i],l=a.name,c=this.getType(a.type);t.push(`@location( ${i} ) ${l} : ${c}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const r of e.members){const s=e.output?"@location( "+r.index+" ) ":"";let i=this.getType(r.type);r.atomic&&(i="atomic< "+i+" >"),t.push(`	${s+r.name} : ${i}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const s=[];for(const i of r){let o=`struct ${i.name} {
`;o+=this.getStructMembers(i),o+=`
};`,s.push(o)}t=`
`+s.join(`

`)+`
`}return t}getVar(e,t,r=null){let s=`var ${t} : `;return r!==null?s+=this.generateArrayDeclaration(e,r):s+=this.getType(e),s}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const s of r)t.push(`	${this.getVar(s.type,s.name,s.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const i=this.varyings,o=this.vars[e];for(let a=0;a<i.length;a++){const l=i[a];if(l.needsInterpolation){let c=`@location( ${a} )`;if(l.interpolationType){const u=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";c+=` @interpolate( ${l.interpolationType}${u}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(c+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${c} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&o.includes(l)===!1&&o.push(l)}}const r=this.getBuiltins(e);r&&t.push(r);const s=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}isCustomStruct(e){const t=e.value,r=e.node,s=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&r.structTypeNode!==null,i=r.value&&r.value.array&&typeof r.value.itemSize=="number"&&r.value.array.length>r.value.itemSize;return s&&!i}getUniforms(e){const t=this.uniforms[e],r=[],s=[],i=[],o={};for(const l of t){const c=l.groupNode.name,u=this.bindingsIndexes[c];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const d=l.node.value;this.isUnfilterable(d)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(d)?r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name}_sampler : sampler_comparison;`):r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name}_sampler : sampler;`));let h,f="";const{primarySamples:p}=this.renderer.backend.utils.getTextureSampleData(d);if(p>1&&(f="_multisampled"),d.isCubeTexture===!0)h="texture_cube<f32>";else if(d.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&d.compareFunction===null?h=`texture${f}_2d<f32>`:h=`texture_depth${f}_2d${d.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const m=ep(d),y=this.getStorageAccess(l.node,e),x=l.node.value.is3DTexture,b=l.node.value.isArrayTexture;h=`texture_storage_${x?"3d":`2d${b?"_array":""}`}<${m}, ${y}>`}else if(d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0)h="texture_2d_array<f32>";else if(d.is3DTexture===!0||d.isData3DTexture===!0)h="texture_3d<f32>";else{const m=this.getComponentTypeFromTexture(d).charAt(0);h=`texture${f}_2d<${m}32>`}r.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${l.name} : ${h};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const d=l.node,h=this.getType(d.getNodeType(this)),f=d.bufferCount,p=f>0&&l.type==="buffer"?", "+f:"",m=d.isStorageBufferNode?`storage, ${this.getStorageAccess(d,e)}`:"uniform";if(this.isCustomStruct(l))s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var<${m}> ${l.name} : ${h};`);else{const x=`	value : array< ${d.isAtomic?`atomic<${h}>`:`${h}`}${p} >`;s.push(this._getWGSLStructBinding(l.name,x,m,u.binding++,u.group))}}else{const d=this.getType(this.getVectorType(l.type)),h=l.groupNode.name;(o[h]||(o[h]={index:u.binding++,id:u.group,snippets:[]})).snippets.push(`	${l.name} : ${d}`)}}for(const l in o){const c=o[l];i.push(this._getWGSLStructBinding(l,c.snippets.join(`,
`),"uniform",c.index,c.id))}let a=r.join(`
`);return a+=s.join(`
`),a+=i.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let s=`// code

`;s+=this.flowCode[t];const i=this.flowNodes[t],o=i[i.length-1],a=o.outputNode,l=a!==void 0&&a.isOutputStructNode===!0;for(const c of i){const u=this.getFlowData(c),d=c.name;if(d&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${d}
`),s+=`${u.code}
	`,c===o&&t!=="compute"){if(s+=`// result

	`,t==="vertex")s+=`varyings.Vertex = ${u.result};`;else if(t==="fragment")if(l)r.returnType=a.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",s+=`return ${u.result};`;else{let h="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(h+=`,
	`+f),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",h),r.structs+=`
var<private> output : OutputStruct;`,s+=`output.color = ${u.result};

	return output;`}}}r.flow=s}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let r;return t!==null&&(r=this._getWGSLMethod(e+"_"+t)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getTernary(e,t,r){return`select( ${r}, ${t}, ${e} )`}getType(e){return h6[e]||e}isAvailable(e){let t=db[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),db[e]=t),t}_getWGSLMethod(e){return qo[e]!==void 0&&this._include(e),f6[e]}_include(e){const t=qo[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${HS}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[r,s,i]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${r}, ${s}, ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${r} * numWorkgroups.x )
		+ globalId.z * ( ${r} * numWorkgroups.x ) * ( ${s} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,r,s=0,i=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${s} ) @group( ${i} )
var<${r}> ${e} : ${o};`}}class m6{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=M.Depth24PlusStencil8:e.depth&&(t=M.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const i=this.backend.renderer,o=i.getRenderTarget();t=o?o.samples:i.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Ci.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Ci.LineList;if(e.isLine)return Ci.LineStrip;if(e.isMesh)return Ci.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===sn)return M.BGRA8Unorm;if(e===jt)return M.RGBA16Float;throw new Error("Unsupported outputType")}}const WS=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&WS.set(Float16Array,["float16"]);const g6=new Map([[B_,["float16"]]]),x6=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class y6{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),s=this.backend,i=s.get(r);let o=i.buffer;if(o===void 0){const a=s.device;let l=r.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let d=0;d<l.length;d++)l[d]===65535&&(l[d]=4294967295)}if(r.array=l,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){l=new l.constructor(r.count*4);for(let d=0;d<r.count;d++)l.set(r.array.subarray(d*3,d*3+3),d*4);r.itemSize=4,r.array=l,i._force3to4BytesAlignment=!0}const c=l.byteLength,u=c+(4-c%4)%4;o=a.createBuffer({label:r.name,size:u,usage:t,mappedAtCreation:!0}),new l.constructor(o.getMappedRange()).set(l),o.unmap(),i.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,s=r.device,i=r.get(t),o=r.get(t).buffer;let a=t.array;if(i._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let u=0;u<t.count;u++)a.set(t.array.subarray(u*3,u*3+3),u*4);t.array=a}const l=this._isTypedArray(a),c=t.updateRanges;if(c.length===0)s.queue.writeBuffer(o,0,a,0);else{const u=l?1:a.BYTES_PER_ELEMENT;for(let d=0,h=c.length;d<h;d++){const f=c[d];let p,m;if(i._force3to4BytesAlignment===!0){const x=Math.floor(f.start/3),b=Math.ceil(f.count/3);p=x*4*u,m=b*4*u}else p=f.start*u,m=f.count*u;const y=p*(l?a.BYTES_PER_ELEMENT:1);s.queue.writeBuffer(o,y,a,p,m)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let s=0;s<t.length;s++){const i=t[s],o=i.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(i);let l=r.get(a);if(l===void 0){let d,h;i.isInterleavedBufferAttribute===!0?(d=i.data.stride*o,h=i.data.isInstancedInterleavedBuffer?zl.Instance:zl.Vertex):(d=i.itemSize*o,h=i.isInstancedBufferAttribute?zl.Instance:zl.Vertex),i.normalized===!1&&(i.array.constructor===Int16Array||i.array.constructor===Uint16Array)&&(d=4),l={arrayStride:d,attributes:[],stepMode:h},r.set(a,l)}const c=this._getVertexFormat(i),u=i.isInterleavedBufferAttribute===!0?i.offset*o:0;l.attributes.push({shaderLocation:s,offset:u,format:c})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,i=t.get(this._getBufferAttribute(e)).buffer,o=i.size,a=r.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=r.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(i,0,a,0,o);const c=l.finish();r.queue.submit([c]),await a.mapAsync(GPUMapMode.READ);const u=a.getMappedRange(),d=new e.array.constructor(u.slice(0));return a.unmap(),d.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,s=e.array.constructor,i=e.constructor;let o;if(t===1)o=x6.get(s);else{const l=(g6.get(i)||WS.get(s))[r?1:0];if(l){const c=s.BYTES_PER_ELEMENT*t,d=Math.floor((c+3)/4)*4/s.BYTES_PER_ELEMENT;if(d%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${l}x${d}`}}return o||se("WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class b6{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,r=t.device,s=[];let i=0;for(const o of e.bindings){const a={binding:i++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const l={};o.isStorageBuffer&&(o.visibility&4&&(o.access===Xn.READ_WRITE||o.access===Xn.WRITE_ONLY)?l.type=ah.Storage:l.type=ah.ReadOnlyStorage),a.buffer=l}else if(o.isSampledTexture&&o.store){const l={};l.format=this.backend.get(o.texture).texture.format;const c=o.access;c===Xn.READ_WRITE?l.access=lh.ReadWrite:c===Xn.WRITE_ONLY?l.access=lh.WriteOnly:l.access=lh.ReadOnly,o.texture.isArrayTexture?l.viewDimension=ht.TwoDArray:o.texture.is3DTexture&&(l.viewDimension=ht.ThreeD),a.storageTexture=l}else if(o.isSampledTexture){const l={},{primarySamples:c}=t.utils.getTextureSampleData(o.texture);if(c>1&&(l.multisampled=!0,o.texture.isDepthTexture||(l.sampleType=ws.UnfilterableFloat)),o.texture.isDepthTexture)t.compatibilityMode&&o.texture.compareFunction===null?l.sampleType=ws.UnfilterableFloat:l.sampleType=ws.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const u=o.texture.type;u===Ot?l.sampleType=ws.SInt:u===mt?l.sampleType=ws.UInt:u===dn&&(this.backend.hasFeature("float32-filterable")?l.sampleType=ws.Float:l.sampleType=ws.UnfilterableFloat)}o.isSampledCubeTexture?l.viewDimension=ht.Cube:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?l.viewDimension=ht.TwoDArray:o.isSampledTexture3D&&(l.viewDimension=ht.ThreeD),a.texture=l}else if(o.isSampler){const l={};o.texture.isDepthTexture&&(o.texture.compareFunction!==null?l.type=ob.Comparison:t.compatibilityMode&&(l.type=ob.NonFiltering)),a.sampler=l}else se(`WebGPUBindingUtils: Unsupported binding "${o}".`);s.push(a)}return r.createBindGroupLayout({entries:s})}createBindings(e,t,r,s=0){const{backend:i,bindGroupLayoutCache:o}=this,a=i.get(e);let l=o.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),o.set(e.bindingsReference,l));let c;r>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[r]===s&&(c=a.groups[r])),c===void 0&&(c=this.createBindGroup(e,l),r>0&&(a.groups[r]=c,a.versions[r]=s)),a.group=c,a.layout=l}updateBinding(e){const t=this.backend,r=t.device,s=e.buffer,i=t.get(e).buffer;r.queue.writeBuffer(i,0,s,0)}createBindGroupIndex(e,t){const s=this.backend.device,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=s.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:i});s.queue.writeBuffer(a,0,e,0);const l=[{binding:0,resource:{buffer:a}}];return s.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:l})}createBindGroup(e,t){const r=this.backend,s=r.device;let i=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const l=r.get(a);if(l.buffer===void 0){const c=a.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,d=s.createBuffer({label:"bindingBuffer_"+a.name,size:c,usage:u});l.buffer=d}o.push({binding:i,resource:{buffer:l.buffer}})}else if(a.isStorageBuffer){const l=r.get(a);if(l.buffer===void 0){const c=a.attribute;l.buffer=r.get(c).buffer}o.push({binding:i,resource:{buffer:l.buffer}})}else if(a.isSampledTexture){const l=r.get(a.texture);let c;if(l.externalTexture!==void 0)c=s.importExternalTexture({source:l.externalTexture});else{const u=a.store?1:l.texture.mipLevelCount,d=a.store?a.mipLevel:0;let h=`view-${l.texture.width}-${l.texture.height}`;if(l.texture.depthOrArrayLayers>1&&(h+=`-${l.texture.depthOrArrayLayers}`),h+=`-${u}-${d}`,c=l[h],c===void 0){const f=Y8.All;let p;a.isSampledCubeTexture?p=ht.Cube:a.isSampledTexture3D?p=ht.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?p=ht.TwoDArray:p=ht.TwoD,c=l[h]=l.texture.createView({aspect:f,dimension:p,mipLevelCount:u,baseMipLevel:d})}}o.push({binding:i,resource:c})}else if(a.isSampler){const l=r.get(a.texture);o.push({binding:i,resource:l.sampler})}i++}return s.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class v6{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:s,geometry:i,pipeline:o}=e,{vertexProgram:a,fragmentProgram:l}=o,c=this.backend,u=c.device,d=c.utils,h=c.get(o),f=[];for(const z of e.getBindings()){const A=c.get(z);f.push(A.layout)}const p=c.attributeUtils.createShaderVertexBuffers(e);let m;s.blending!==Wi&&(s.blending!==$s||s.transparent!==!1)&&(m=this._getBlending(s));let y={};s.stencilWrite===!0&&(y={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const x=this._getColorWriteMask(s),b=[];if(e.context.textures!==null){const z=e.context.textures;for(let A=0;A<z.length;A++){const O=d.getTextureFormatGPU(z[A]);b.push({format:O,blend:m,writeMask:x})}}else{const z=d.getCurrentColorFormat(e.context);b.push({format:z,blend:m,writeMask:x})}const v=c.get(a).module,_=c.get(l).module,w=this._getPrimitiveState(r,i,s),T=this._getDepthCompare(s),N=d.getCurrentDepthStencilFormat(e.context),S=this._getSampleCount(e.context),C={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},v,{buffers:p}),fragment:Object.assign({},_,{targets:b}),primitive:w,multisample:{count:S,alphaToCoverageEnabled:s.alphaToCoverage&&S>1},layout:u.createPipelineLayout({bindGroupLayouts:f})},D={},F=e.context.depth,j=e.context.stencil;if((F===!0||j===!0)&&(F===!0&&(D.format=N,D.depthWriteEnabled=s.depthWrite,D.depthCompare=T),j===!0&&(D.stencilFront=y,D.stencilBack={},D.stencilReadMask=s.stencilFuncMask,D.stencilWriteMask=s.stencilWriteMask),s.polygonOffset===!0&&(D.depthBias=s.polygonOffsetUnits,D.depthBiasSlopeScale=s.polygonOffsetFactor,D.depthBiasClamp=0),C.depthStencil=D),u.pushErrorScope("validation"),t===null)h.pipeline=u.createRenderPipeline(C),u.popErrorScope().then(z=>{z!==null&&(h.error=!0,se(z.message))});else{const z=new Promise(async A=>{try{h.pipeline=await u.createRenderPipelineAsync(C)}catch{}const O=await u.popErrorScope();O!==null&&(h.error=!0,se(O.message)),A()});t.push(z)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:s,device:i}=r,o=s.getCurrentDepthStencilFormat(e),a=s.getCurrentColorFormats(e),l=this._getSampleCount(e),c={label:t,colorFormats:a,depthStencilFormat:o,sampleCount:l};return i.createRenderBundleEncoder(c)}createComputePipeline(e,t){const r=this.backend,s=r.device,i=r.get(e.computeProgram).module,o=r.get(e),a=[];for(const l of t){const c=r.get(l);a.push(c.layout)}o.pipeline=s.createComputePipeline({compute:i,layout:s.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,r;const s=e.blending,i=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(s===ia){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:i,c=e.blendDstAlpha!==null?e.blendDstAlpha:o,u=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},r={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(c),operation:this._getBlendOperation(u)}}else{const l=e.premultipliedAlpha,c=(u,d,h,f)=>{t={srcFactor:u,dstFactor:d,operation:Ts.Add},r={srcFactor:h,dstFactor:f,operation:Ts.Add}};if(l)switch(s){case $s:c(Ae.One,Ae.OneMinusSrcAlpha,Ae.One,Ae.OneMinusSrcAlpha);break;case Rc:c(Ae.One,Ae.One,Ae.One,Ae.One);break;case Cc:c(Ae.Zero,Ae.OneMinusSrc,Ae.Zero,Ae.One);break;case Ec:c(Ae.Dst,Ae.OneMinusSrcAlpha,Ae.Zero,Ae.One);break}else switch(s){case $s:c(Ae.SrcAlpha,Ae.OneMinusSrcAlpha,Ae.One,Ae.OneMinusSrcAlpha);break;case Rc:c(Ae.SrcAlpha,Ae.One,Ae.One,Ae.One);break;case Cc:se("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ec:se("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&r!==void 0)return{color:t,alpha:r};se("WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(e){let t;switch(e){case Gr:t=Ae.Zero;break;case v_:t=Ae.One;break;case b_:t=Ae.Src;break;case p_:t=Ae.OneMinusSrc;break;case y_:t=Ae.SrcAlpha;break;case f_:t=Ae.OneMinusSrcAlpha;break;case g_:t=Ae.Dst;break;case h_:t=Ae.OneMinusDst;break;case m_:t=Ae.DstAlpha;break;case d_:t=Ae.OneMinusDstAlpha;break;case x_:t=Ae.SrcAlphaSaturated;break;case sG:t=Ae.Constant;break;case iG:t=Ae.OneMinusConstant;break;default:se("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case D2:t=St.Never;break;case P2:t=St.Always;break;case M2:t=St.Less;break;case R2:t=St.LessEqual;break;case C2:t=St.Equal;break;case E2:t=St.GreaterEqual;break;case A2:t=St.Greater;break;case N2:t=St.NotEqual;break;default:se("WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case V2:t=Ur.Keep;break;case U2:t=Ur.Zero;break;case O2:t=Ur.Replace;break;case I2:t=Ur.Invert;break;case L2:t=Ur.IncrementClamp;break;case F2:t=Ur.DecrementClamp;break;case k2:t=Ur.IncrementWrap;break;case B2:t=Ur.DecrementWrap;break;default:se("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case br:t=Ts.Add;break;case u_:t=Ts.Subtract;break;case c_:t=Ts.ReverseSubtract;break;case G2:t=Ts.Min;break;case j2:t=Ts.Max;break;default:se("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const s={},i=this.backend.utils;s.topology=i.getPrimitiveTopology(e,r),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(s.stripIndexFormat=t.index.array instanceof Uint16Array?so.Uint16:so.Uint32);let o=r.side===Qt;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),s.frontFace=o===!0?rb.CW:rb.CCW,s.cullMode=r.side===js?sb.None:sb.Back,s}_getColorWriteMask(e){return e.colorWrite===!0?ib.All:ib.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=St.Always;else{const r=e.depthFunc;switch(r){case C_:t=St.Never;break;case E_:t=St.Always;break;case A_:t=St.Less;break;case N_:t=St.LessEqual;break;case S_:t=St.Equal;break;case w_:t=St.GreaterEqual;break;case T_:t=St.Greater;break;case __:t=St.NotEqual;break;default:se("WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class _6 extends zS{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const s=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return ft(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const s=this.device.createCommandEncoder();s.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),s.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const i=s.finish();if(this.device.queue.submit([i]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,r)),a={},l=[];for(const[u,d]of e){const h=u.match(/^(.*):f(\d+)$/),f=parseInt(h[2]);l.includes(f)===!1&&l.push(f),a[f]===void 0&&(a[f]=0);const p=o[d],m=o[d+1],y=Number(m-p)/1e6;this.timestamps.set(u,y),a[f]+=y}const c=a[l[l.length-1]];return this.resultBuffer.unmap(),this.lastValue=c,this.frames=l,c}catch(e){return e("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){e("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){e("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class T6 extends $S{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new m6(this),this.attributeUtils=new y6(this),this.bindingUtils=new b6(this),this.pipelineUtils=new v6(this),this.textureUtils=new s6(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(t.device===void 0){const s={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},i=typeof navigator<"u"?await navigator.gpu.requestAdapter(s):null;if(i===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(Jf),a=[];for(const c of o)i.features.has(c)&&a.push(c);const l={requiredFeatures:a,requiredLimits:t.requiredLimits};r=await i.requestDevice(l)}else r=t.device;r.lost.then(s=>{const i={api:"WebGPU",message:s.message||"Unknown reason",reason:s.reason||null,originalEvent:s};e.onDeviceLost(i)}),this.device=r,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Jf.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let r=t.context;if(r===void 0){const s=this.parameters;e.isDefaultCanvasTarget===!0&&s.context!==void 0?r=s.context:r=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${pu} webgpu`);const i=s.alpha?"premultiplied":"opaque",o=s.outputType===jt?"extended":"standard";r.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:o}}),t.context=r}return r}get coordinateSystem(){return mu}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),r=this.get(t),s=e.currentSamples;let i=r.descriptor;if(i===void 0||r.samples!==s){i={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const a=i.colorAttachments[0];s>0?a.view=this.textureUtils.getColorBuffer().createView():a.resolveTarget=void 0,r.descriptor=i,r.samples=s}const o=i.colorAttachments[0];return s>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,s=this.get(r);let i=s.descriptors;(i===void 0||s.width!==r.width||s.height!==r.height||s.samples!==r.samples)&&(i={},s.descriptors=i);const o=e.getCacheKey();let a=i[o];if(a===void 0){const c=e.textures,u=[];let d;const h=this._isRenderCameraDepthArray(e);for(let f=0;f<c.length;f++){const p=this.get(c[f]),m={label:`colorAttachment_${f}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:ht.TwoD};if(r.isRenderTarget3D)d=e.activeCubeFace,m.baseArrayLayer=0,m.dimension=ht.ThreeD,m.depthOrArrayLayers=c[f].image.depth;else if(r.isRenderTarget&&c[f].image.depth>1)if(h===!0){const y=e.camera.cameras;for(let x=0;x<y.length;x++){const b={...m,baseArrayLayer:x,arrayLayerCount:1,dimension:ht.TwoD},v=p.texture.createView(b);u.push({view:v,resolveTarget:void 0,depthSlice:void 0})}}else m.dimension=ht.TwoDArray,m.depthOrArrayLayers=c[f].image.depth;if(h!==!0){const y=p.texture.createView(m);let x,b;p.msaaTexture!==void 0?(x=p.msaaTexture.createView(),b=y):(x=y,b=void 0),u.push({view:x,resolveTarget:b,depthSlice:d})}}if(a={textureViews:u},e.depth){const f=this.get(e.depthTexture),p={};e.depthTexture.isArrayTexture&&(p.dimension=ht.TwoD,p.arrayLayerCount=1,p.baseArrayLayer=e.activeCubeFace),a.depthStencilView=f.texture.createView(p)}i[o]=a,s.width=r.width,s.height=r.height,s.samples=r.samples,s.activeMipmapLevel=e.activeMipmapLevel,s.activeCubeFace=e.activeCubeFace}const l={colorAttachments:[]};for(let c=0;c<a.textureViews.length;c++){const u=a.textureViews[c];let d={r:0,g:0,b:0,a:1};c===0&&t.clearValue&&(d=t.clearValue),l.colorAttachments.push({view:u.view,depthSlice:u.depthSlice,resolveTarget:u.resolveTarget,loadOp:t.loadOp||ke.Load,storeOp:t.storeOp||It.Store,clearValue:d})}return a.depthStencilView&&(l.depthStencilAttachment={view:a.depthStencilView}),l}beginRender(e){const t=this.get(e),r=this.device,s=e.occlusionQueryCount;let i;s>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=r.createQuerySet({type:"occlusion",count:s,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(s),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:ke.Load}),this.initTimestampQuery(qn.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=i;const a=o.depthStencilAttachment;if(e.textures!==null){const c=o.colorAttachments;for(let u=0;u<c.length;u++){const d=c[u];e.clearColor?(d.clearValue=u===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=ke.Clear):d.loadOp=ke.Load,d.storeOp=It.Store}}else{const c=o.colorAttachments[0];e.clearColor?(c.clearValue=e.clearColorValue,c.loadOp=ke.Clear):c.loadOp=ke.Load,c.storeOp=It.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=ke.Clear):a.depthLoadOp=ke.Load,a.depthStoreOp=It.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=ke.Clear):a.stencilLoadOp=ke.Load,a.stencilStoreOp=It.Store);const l=r.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const c=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==c.length?this._createDepthLayerDescriptors(e,t,o,c):this._updateDepthLayerDescriptors(e,t,c),t.bundleEncoders=[],t.bundleSets=[];for(let u=0;u<c.length;u++){const d=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+u),h={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(d),t.bundleSets.push(h)}t.currentPass=null}else{const c=l.beginRenderPass(o);t.currentPass=c,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,s){const i=r.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<s.length;a++){const l={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[a].view}]};if(r.depthStencilAttachment){const c=a;o.viewCache[c]||(o.viewCache[c]=o.texture.createView({dimension:ht.TwoD,baseArrayLayer:a,arrayLayerCount:1})),l.depthStencilAttachment={view:o.viewCache[c],depthLoadOp:i.depthLoadOp||ke.Clear,depthStoreOp:i.depthStoreOp||It.Store,depthClearValue:i.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else l.depthStencilAttachment={...i};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,r){for(let s=0;s<r.length;s++){const i=t.layerDescriptors[s];if(i.depthStencilAttachment){const o=i.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=ke.Clear):o.depthLoadOp=ke.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=ke.Clear):o.stencilLoadOp=ke.Load)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const s=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const i=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];i.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<i.length){const a=t.layerDescriptors[o],l=s.beginRenderPass(a);if(e.viewport){const{x:c,y:u,width:d,height:h,minDepth:f,maxDepth:p}=e.viewportValue;l.setViewport(c,u,d,h,f,p)}if(e.scissor){const{x:c,y:u,width:d,height:h}=e.scissorValue;l.setScissorRect(c,u,d,h)}l.executeBundles([i[o]]),l.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const i=r*8;let o=this.occludedResolveCache.get(i);o===void 0&&(o=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,o));const a=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,i),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const i=e.textures;for(let o=0;o<i.length;o++){const a=i[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:s}=t;if(r&&s){const i=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const o=r.getMappedRange(),a=new BigUint64Array(o);for(let l=0;l<s.length;l++)a[l]===BigInt(0)&&i.add(s[l]);r.destroy(),t.occluded=i}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:s,width:i,height:o,minDepth:a,maxDepth:l}=e.viewportValue;t.setViewport(r,s,i,o,a,l)}updateScissor(e){const{currentPass:t}=this.get(e),{x:r,y:s,width:i,height:o}=e.scissorValue;t.setScissorRect(r,s,i,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,s=null){const i=this.device,o=this.renderer;let a=[],l,c,u,d;if(e){const p=this.getClearColor();c={r:p.r,g:p.g,b:p.b,a:p.a}}if(s===null){u=o.depth,d=o.stencil;const p=this._getDefaultRenderPassDescriptor();if(e){a=p.colorAttachments;const m=a[0];m.clearValue=c,m.loadOp=ke.Clear,m.storeOp=It.Store}(u||d)&&(l=p.depthStencilAttachment)}else{u=s.depth,d=s.stencil;const p={loadOp:e?ke.Clear:ke.Load,clearValue:e?c:void 0};u&&(p.depthLoadOp=t?ke.Clear:ke.Load,p.depthClearValue=t?o.getClearDepth():void 0,p.depthStoreOp=It.Store),d&&(p.stencilLoadOp=r?ke.Clear:ke.Load,p.stencilClearValue=r?o.getClearStencil():void 0,p.stencilStoreOp=It.Store);const m=this._getRenderPassDescriptor(s,p);a=m.colorAttachments,l=m.depthStencilAttachment}u&&l&&(t?(l.depthLoadOp=ke.Clear,l.depthClearValue=o.getClearDepth(),l.depthStoreOp=It.Store):(l.depthLoadOp=ke.Load,l.depthStoreOp=It.Store)),d&&l&&(r?(l.stencilLoadOp=ke.Clear,l.stencilClearValue=o.getClearStencil(),l.stencilStoreOp=It.Store):(l.stencilLoadOp=ke.Load,l.stencilStoreOp=It.Store));const h=i.createCommandEncoder({label:"clear"});h.beginRenderPass({colorAttachments:a,depthStencilAttachment:l}).end(),i.queue.submit([h.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(qn.COMPUTE,this.getTimestampUID(e),r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,s,i=null){const o=this.get(t),{passEncoderGPU:a}=this.get(e),l=this.get(s).pipeline;this.pipelineUtils.setPipeline(a,l);for(let c=0,u=r.length;c<u;c++){const d=r[c],h=this.get(d);a.setBindGroup(c,h.group)}if(i===null&&(i=t.count),i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute){const c=this.get(i).buffer;a.dispatchWorkgroupsIndirect(c,0);return}if(typeof i=="number"){const c=i;if(o.dispatchSize===void 0||o.count!==c){o.dispatchSize=[0,1,1],o.count=c;const u=t.workgroupSize;let d=u[0];for(let p=1;p<u.length;p++)d*=u[p];const h=Math.ceil(c/d),f=this.device.limits.maxComputeWorkgroupsPerDimension;i=[h,1,1],h>f&&(i[0]=Math.min(h,f),i[1]=Math.ceil(h/f)),o.dispatchSize=i}i=o.dispatchSize}a.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:r,material:s,context:i,pipeline:o}=e,a=e.getBindings(),l=this.get(i),c=this.get(o),u=c.pipeline;if(c.error===!0)return;const d=e.getIndex(),h=d!==null,f=e.getDrawParameters();if(f===null)return;const p=(y,x)=>{this.pipelineUtils.setPipeline(y,u),x.pipeline=u;const b=x.bindingGroups;for(let _=0,w=a.length;_<w;_++){const T=a[_],N=this.get(T);b[T.index]!==T.id&&(y.setBindGroup(T.index,N.group),b[T.index]=T.id)}if(h===!0&&x.index!==d){const _=this.get(d).buffer,w=d.array instanceof Uint16Array?so.Uint16:so.Uint32;y.setIndexBuffer(_,w),x.index=d}const v=e.getVertexBuffers();for(let _=0,w=v.length;_<w;_++){const T=v[_];if(x.attributes[_]!==T){const N=this.get(T).buffer;y.setVertexBuffer(_,N),x.attributes[_]=T}}i.stencil===!0&&s.stencilWrite===!0&&l.currentStencilRef!==s.stencilRef&&(y.setStencilReference(s.stencilRef),l.currentStencilRef=s.stencilRef)},m=(y,x)=>{if(p(y,x),r.isBatchedMesh===!0){const b=r._multiDrawStarts,v=r._multiDrawCounts,_=r._multiDrawCount,w=r._multiDrawInstances;w!==null&&ft("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let T=0;T<_;T++){const N=w?w[T]:1,S=N>1?0:T;h===!0?y.drawIndexed(v[T],N,b[T]/d.array.BYTES_PER_ELEMENT,0,S):y.draw(v[T],N,b[T],S),t.update(r,v[T],N)}}else if(h===!0){const{vertexCount:b,instanceCount:v,firstVertex:_}=f,w=e.getIndirect();if(w!==null){const T=this.get(w).buffer;y.drawIndexedIndirect(T,0)}else y.drawIndexed(b,v,_,0,0);t.update(r,b,v)}else{const{vertexCount:b,instanceCount:v,firstVertex:_}=f,w=e.getIndirect();if(w!==null){const T=this.get(w).buffer;y.drawIndirect(T,0)}else y.draw(b,v,_,0);t.update(r,b,v)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const y=this.get(e.camera),x=e.camera.cameras,b=e.getBindingGroup("cameraIndex");if(y.indexesGPU===void 0||y.indexesGPU.length!==x.length){const _=this.get(b),w=[],T=new Uint32Array([0,0,0,0]);for(let N=0,S=x.length;N<S;N++){T[0]=N;const C=this.bindingUtils.createBindGroupIndex(T,_.layout);w.push(C)}y.indexesGPU=w}const v=this.renderer.getPixelRatio();for(let _=0,w=x.length;_<w;_++){const T=x[_];if(r.layers.test(T.layers)){const N=T.viewport;let S=l.currentPass,C=l.currentSets;if(l.bundleEncoders){const D=l.bundleEncoders[_],F=l.bundleSets[_];S=D,C=F}N&&S.setViewport(Math.floor(N.x*v),Math.floor(N.y*v),Math.floor(N.width*v),Math.floor(N.height*v),i.viewportValue.minDepth,i.viewportValue.maxDepth),b&&y.indexesGPU&&(S.setBindGroup(b.index,y.indexesGPU[_]),C.bindingGroups[b.index]=b.id),m(S,C)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const y=l.lastOcclusionObject;y!==r&&(y!==null&&y.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),r.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=r),l.lastOcclusionObject=r)}m(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:s}=e,i=this.utils,o=i.getSampleCountRenderContext(e.context),a=i.getCurrentColorSpace(e.context),l=i.getCurrentColorFormat(e.context),c=i.getCurrentDepthStencilFormat(e.context),u=i.getPrimitiveTopology(r,s);let d=!1;return(t.material!==s||t.materialVersion!==s.version||t.transparent!==s.transparent||t.blending!==s.blending||t.premultipliedAlpha!==s.premultipliedAlpha||t.blendSrc!==s.blendSrc||t.blendDst!==s.blendDst||t.blendEquation!==s.blendEquation||t.blendSrcAlpha!==s.blendSrcAlpha||t.blendDstAlpha!==s.blendDstAlpha||t.blendEquationAlpha!==s.blendEquationAlpha||t.colorWrite!==s.colorWrite||t.depthWrite!==s.depthWrite||t.depthTest!==s.depthTest||t.depthFunc!==s.depthFunc||t.stencilWrite!==s.stencilWrite||t.stencilFunc!==s.stencilFunc||t.stencilFail!==s.stencilFail||t.stencilZFail!==s.stencilZFail||t.stencilZPass!==s.stencilZPass||t.stencilFuncMask!==s.stencilFuncMask||t.stencilWriteMask!==s.stencilWriteMask||t.side!==s.side||t.alphaToCoverage!==s.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==l||t.depthStencilFormat!==c||t.primitiveTopology!==u||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=s,t.materialVersion=s.version,t.transparent=s.transparent,t.blending=s.blending,t.premultipliedAlpha=s.premultipliedAlpha,t.blendSrc=s.blendSrc,t.blendDst=s.blendDst,t.blendEquation=s.blendEquation,t.blendSrcAlpha=s.blendSrcAlpha,t.blendDstAlpha=s.blendDstAlpha,t.blendEquationAlpha=s.blendEquationAlpha,t.colorWrite=s.colorWrite,t.depthWrite=s.depthWrite,t.depthTest=s.depthTest,t.depthFunc=s.depthFunc,t.stencilWrite=s.stencilWrite,t.stencilFunc=s.stencilFunc,t.stencilFail=s.stencilFail,t.stencilZFail=s.stencilZFail,t.stencilZPass=s.stencilZPass,t.stencilFuncMask=s.stencilFuncMask,t.stencilWriteMask=s.stencilWriteMask,t.side=s.side,t.alphaToCoverage=s.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=l,t.depthStencilFormat=c,t.primitiveTopology=u,t.clippingContextCacheKey=e.clippingContextCacheKey,d=!0),d}getRenderCacheKey(e){const{object:t,material:r}=e,s=this.utils,i=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,o,s.getSampleCountRenderContext(i),s.getCurrentColorSpace(i),s.getCurrentColorFormat(i),s.getCurrentDepthStencilFormat(i),s.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,s,i,o){return this.textureUtils.copyTextureToBuffer(e,t,r,s,i,o)}initTimestampQuery(e,t,r){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new _6(this.device,e,2048));const s=this.timestampQueryPool[e],i=s.allocateQueriesForContext(t);r.timestampWrites={querySet:s.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new p6(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),i=r.currentPass.finish();this.get(t).bundleGPU=i,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,s){this.bindingUtils.createBindings(e,t,r,s)}updateBindings(e,t,r,s){this.bindingUtils.createBindings(e,t,r,s)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return lb[e]!==void 0&&(e=lb[e]),this.device.features.has(e)}copyTextureToTexture(e,t,r=null,s=null,i=0,o=0){let a=0,l=0,c=0,u=0,d=0,h=0,f=e.image.width,p=e.image.height,m=1;r!==null&&(r.isBox3===!0?(u=r.min.x,d=r.min.y,h=r.min.z,f=r.max.x-r.min.x,p=r.max.y-r.min.y,m=r.max.z-r.min.z):(u=r.min.x,d=r.min.y,f=r.max.x-r.min.x,p=r.max.y-r.min.y,m=1)),s!==null&&(a=s.x,l=s.y,c=s.z||0);const y=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),x=this.get(e).texture,b=this.get(t).texture;y.copyTextureToTexture({texture:x,mipLevel:i,origin:{x:u,y:d,z:h}},{texture:b,mipLevel:o,origin:{x:a,y:l,z:c}},[f,p,m]),this.device.queue.submit([y.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const s=this.get(t);let i=null;t.renderTarget?e.isDepthTexture?i=this.get(t.depthTexture).texture:i=this.get(t.textures[0]).texture:e.isDepthTexture?i=this.textureUtils.getDepthBuffer(t.depth,t.stencil):i=this.context.getCurrentTexture();const o=this.get(e).texture;if(i.format!==o.format){se("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,o.format);return}let a;if(s.currentPass?(s.currentPass.end(),a=s.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:i,origin:[r.x,r.y,0]},{texture:o},[r.z,r.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,a),s.currentPass){const{descriptor:l}=s;for(let c=0;c<l.colorAttachments.length;c++)l.colorAttachments[c].loadOp=ke.Load;t.depth&&(l.depthStencilAttachment.depthLoadOp=ke.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=ke.Load),s.currentPass=a.beginRenderPass(l),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([a.finish()])}dispose(){this.textureUtils.dispose()}}class w6 extends Fp{constructor(e,t,r,s,i,o){super(e,t,r,s,i,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class S6 extends Fp{constructor(e,t,r,s,i,o){super(e,t,r,s,i,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class N6 extends FS{constructor(){super(),this.addMaterial(FV,"MeshPhongMaterial"),this.addMaterial(yS,"MeshStandardMaterial"),this.addMaterial(Lj,"MeshPhysicalMaterial"),this.addMaterial(Vj,"MeshToonMaterial"),this.addMaterial(CV,"MeshBasicMaterial"),this.addMaterial(BV,"MeshLambertMaterial"),this.addMaterial(wV,"MeshNormalMaterial"),this.addMaterial($j,"MeshMatcapMaterial"),this.addMaterial(yV,"LineBasicMaterial"),this.addMaterial(vV,"LineDashedMaterial"),this.addMaterial(Xj,"PointsMaterial"),this.addMaterial(vS,"SpriteMaterial"),this.addMaterial(Zj,"ShadowMaterial"),this.addLight(E$,$E),this.addLight(t8,Zv),this.addLight(n8,zE),this.addLight(Wm,Fp),this.addLight(o8,Jv),this.addLight(a8,HE),this.addLight(l8,WE),this.addLight(r8,w6),this.addLight(i8,S6),this.addToneMapping(FG,qE),this.addToneMapping(LG,XE),this.addToneMapping(IG,KE),this.addToneMapping(UG,YE),this.addToneMapping($G,QE),this.addToneMapping(zG,ZE)}}class A6 extends C8{constructor(e={}){let t;e.forceWebGL?t=nb:(t=T6,e.getFallback=()=>(ie("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new nb(e)));const r=new t(e);super(r,e),this.library=new N6,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const ch={type:"change"},Xm={type:"start"},Km={type:"end"},fb=1e-6,Fe={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},Wl=new we,Vr=new we,E6=new ce,ql=new ce,uh=new ce,Ti=new zi,pb=new ce,Xl=new ce,dh=new ce,Kl=new ce;class C6 extends du{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Et.ROTATE,MIDDLE:Et.DOLLY,RIGHT:Et.PAN},this.target=new ce,this.state=Fe.NONE,this.keyState=Fe.NONE,this._lastPosition=new ce,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ce,this._movePrev=new we,this._moveCurr=new we,this._lastAxis=new ce,this._zoomStart=new we,this._zoomEnd=new we,this._panStart=new we,this._panEnd=new we,this._pointers=[],this._pointerPositions={},this._onPointerMove=M6.bind(this),this._onPointerDown=R6.bind(this),this._onPointerUp=P6.bind(this),this._onPointerCancel=D6.bind(this),this._onContextMenu=U6.bind(this),this._onMouseWheel=O6.bind(this),this._onKeyDown=k6.bind(this),this._onKeyUp=B6.bind(this),this._onTouchStart=V6.bind(this),this._onTouchMove=j6.bind(this),this._onTouchEnd=G6.bind(this),this._onMouseDown=F6.bind(this),this._onMouseMove=L6.bind(this),this._onMouseUp=I6.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>fb&&(this.dispatchEvent(ch),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>fb||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(ch),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Fe.NONE,this.keyState=Fe.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(ch),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Vr.copy(this._panEnd).sub(this._panStart),Vr.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Vr.x*=e,Vr.y*=t}Vr.multiplyScalar(this._eye.length()*this.panSpeed),ql.copy(this._eye).cross(this.object.up).setLength(Vr.x),ql.add(E6.copy(this.object.up).setLength(Vr.y)),this.object.position.add(ql),this.target.add(ql),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Vr.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){Kl.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=Kl.length();e?(this._eye.copy(this.object.position).sub(this.target),pb.copy(this._eye).normalize(),Xl.copy(this.object.up).normalize(),dh.crossVectors(Xl,pb).normalize(),Xl.setLength(this._moveCurr.y-this._movePrev.y),dh.setLength(this._moveCurr.x-this._movePrev.x),Kl.copy(Xl.add(dh)),uh.crossVectors(Kl,this._eye).normalize(),e*=this.rotateSpeed,Ti.setFromAxisAngle(uh,e),this._eye.applyQuaternion(Ti),this.object.up.applyQuaternion(Ti),this._lastAxis.copy(uh),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Ti.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Ti),this.object.up.applyQuaternion(Ti)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Fe.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Pc.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Pc.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return Wl.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),Wl}_getMouseOnCircle(e,t){return Wl.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),Wl}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new we,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function R6(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function M6(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function P6(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function D6(n){this._removePointer(n)}function B6(){this.enabled!==!1&&(this.keyState=Fe.NONE,window.addEventListener("keydown",this._onKeyDown))}function k6(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Fe.NONE&&(n.code===this.keys[Fe.ROTATE]&&!this.noRotate?this.keyState=Fe.ROTATE:n.code===this.keys[Fe.ZOOM]&&!this.noZoom?this.keyState=Fe.ZOOM:n.code===this.keys[Fe.PAN]&&!this.noPan&&(this.keyState=Fe.PAN)))}function F6(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Et.DOLLY:this.state=Fe.ZOOM;break;case Et.ROTATE:this.state=Fe.ROTATE;break;case Et.PAN:this.state=Fe.PAN;break;default:this.state=Fe.NONE}const t=this.keyState!==Fe.NONE?this.keyState:this.state;t===Fe.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Fe.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Fe.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(Xm)}function L6(n){const e=this.keyState!==Fe.NONE?this.keyState:this.state;e===Fe.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Fe.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Fe.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function I6(){this.state=Fe.NONE,this.dispatchEvent(Km)}function O6(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(Xm),this.dispatchEvent(Km)}}function U6(n){this.enabled!==!1&&n.preventDefault()}function V6(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Fe.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Fe.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,s=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,s)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(Xm)}function j6(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,r=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const s=(n.pageX+e.x)/2,i=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,i));break}}function G6(n){switch(this._pointers.length){case 0:this.state=Fe.NONE;break;case 1:this.state=Fe.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Fe.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(Km)}const mb={type:"change"},Ym={type:"start"},qS={type:"end"},Yl=new aC,gb=new hu,$6=Math.cos(70*Pc.DEG2RAD),yt=new ce,Wt=2*Math.PI,je={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},hh=1e-6;class z6 extends du{constructor(e,t=null){super(e,t),this.state=je.NONE,this.target=new ce,this.cursor=new ce,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Et.ROTATE,MIDDLE:Et.DOLLY,RIGHT:Et.PAN},this.touches={ONE:wr.ROTATE,TWO:wr.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ce,this._lastQuaternion=new zi,this._lastTargetPosition=new ce,this._quat=new zi().setFromUnitVectors(e.up,new ce(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Xg,this._sphericalDelta=new Xg,this._scale=1,this._panOffset=new ce,this._rotateStart=new we,this._rotateEnd=new we,this._rotateDelta=new we,this._panStart=new we,this._panEnd=new we,this._panDelta=new we,this._dollyStart=new we,this._dollyEnd=new we,this._dollyDelta=new we,this._dollyDirection=new ce,this._mouse=new we,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=W6.bind(this),this._onPointerDown=H6.bind(this),this._onPointerUp=q6.bind(this),this._onContextMenu=ez.bind(this),this._onMouseWheel=Y6.bind(this),this._onKeyDown=Q6.bind(this),this._onTouchStart=Z6.bind(this),this._onTouchMove=J6.bind(this),this._onMouseDown=X6.bind(this),this._onMouseMove=K6.bind(this),this._interceptControlDown=tz.bind(this),this._interceptControlUp=nz.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(mb),this.update(),this.state=je.NONE}update(e=null){const t=this.object.position;yt.copy(t).sub(this.target),yt.applyQuaternion(this._quat),this._spherical.setFromVector3(yt),this.autoRotate&&this.state===je.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(r)&&isFinite(s)&&(r<-Math.PI?r+=Wt:r>Math.PI&&(r-=Wt),s<-Math.PI?s+=Wt:s>Math.PI&&(s-=Wt),r<=s?this._spherical.theta=Math.max(r,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+s)/2?Math.max(r,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=o!=this._spherical.radius}if(yt.setFromSpherical(this._spherical),yt.applyQuaternion(this._quatInverse),t.copy(this.target).add(yt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=yt.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),i=!!l}else if(this.object.isOrthographicCamera){const a=new ce(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=l!==this.object.zoom;const c=new ce(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=yt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Yl.origin.copy(this.object.position),Yl.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Yl.direction))<$6?this.object.lookAt(this.target):(gb.setFromNormalAndCoplanarPoint(this.object.up,this.target),Yl.intersectPlane(gb,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>hh||8*(1-this._lastQuaternion.dot(this.object.quaternion))>hh||this._lastTargetPosition.distanceToSquared(this.target)>hh?(this.dispatchEvent(mb),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Wt/60*this.autoRotateSpeed*e:Wt/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){yt.setFromMatrixColumn(t,0),yt.multiplyScalar(-e),this._panOffset.add(yt)}_panUp(e,t){this.screenSpacePanning===!0?yt.setFromMatrixColumn(t,1):(yt.setFromMatrixColumn(t,0),yt.crossVectors(this.object.up,yt)),yt.multiplyScalar(e),this._panOffset.add(yt)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;yt.copy(s).sub(this.target);let i=yt.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/r.clientHeight,this.object.matrix),this._panUp(2*t*i/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),s=e-r.left,i=t-r.top,o=r.width,a=r.height;this._mouse.x=s/o*2-1,this._mouse.y=-(i/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Wt*this._rotateDelta.x/t.clientHeight),this._rotateUp(Wt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Wt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._rotateStart.set(r,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panStart.set(r,s)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,s=e.pageY-t.y,i=Math.sqrt(r*r+s*s);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),s=.5*(e.pageX+r.x),i=.5*(e.pageY+r.y);this._rotateEnd.set(s,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Wt*this._rotateDelta.x/t.clientHeight),this._rotateUp(Wt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panEnd.set(r,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,s=e.pageY-t.y,i=Math.sqrt(r*r+s*s);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new we,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function H6(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function W6(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function q6(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(qS),this.state=je.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function X6(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Et.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=je.DOLLY;break;case Et.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=je.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=je.ROTATE}break;case Et.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=je.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=je.PAN}break;default:this.state=je.NONE}this.state!==je.NONE&&this.dispatchEvent(Ym)}function K6(n){switch(this.state){case je.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case je.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case je.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function Y6(n){this.enabled===!1||this.enableZoom===!1||this.state!==je.NONE||(n.preventDefault(),this.dispatchEvent(Ym),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(qS))}function Q6(n){this.enabled!==!1&&this._handleKeyDown(n)}function Z6(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case wr.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=je.TOUCH_ROTATE;break;case wr.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=je.TOUCH_PAN;break;default:this.state=je.NONE}break;case 2:switch(this.touches.TWO){case wr.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=je.TOUCH_DOLLY_PAN;break;case wr.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=je.TOUCH_DOLLY_ROTATE;break;default:this.state=je.NONE}break;default:this.state=je.NONE}this.state!==je.NONE&&this.dispatchEvent(Ym)}function J6(n){switch(this._trackPointer(n),this.state){case je.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case je.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case je.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case je.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=je.NONE}}function ez(n){this.enabled!==!1&&n.preventDefault()}function tz(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function nz(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const rz={type:"change"},xb=1e-6,yb=new zi;class sz extends du{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ce(0,0,0),this._rotationVector=new ce(0,0,0),this._lastQuaternion=new zi,this._lastPosition=new ce,this._status=0,this._onKeyDown=iz.bind(this),this._onKeyUp=oz.bind(this),this._onPointerMove=lz.bind(this),this._onPointerDown=az.bind(this),this._onPointerUp=cz.bind(this),this._onPointerCancel=uz.bind(this),this._onContextMenu=dz.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,r=e*this.movementSpeed,s=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),yb.set(this._rotationVector.x*s,this._rotationVector.y*s,this._rotationVector.z*s,1).normalize(),t.quaternion.multiply(yb),(this._lastPosition.distanceToSquared(t.position)>xb||8*(1-this._lastQuaternion.dot(t.quaternion))>xb)&&(this.dispatchEvent(rz),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function iz(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function oz(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function az(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function lz(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function cz(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function uz(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function dz(n){this.enabled!==!1&&n.preventDefault()}const hz={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Gu{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const fz=new Ip(-1,1,1,-1,0,1);class pz extends Wa{constructor(){super(),this.setAttribute("position",new Mc([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Mc([0,2,0,0,2,0],2))}}const mz=new pz;class gz{constructor(e){this._mesh=new kn(mz,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,fz)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class xz extends Gu{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Kg?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=lC.clone(e.uniforms),this.material=new Kg({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new gz(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class bb extends Gu{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const s=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),i.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(s.EQUAL,1,4294967295),i.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),i.buffers.stencil.setLocked(!0)}}class yz extends Gu{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class bz{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new we);this._width=r.width,this._height=r.height,t=new cC(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:jt}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new xz(hz),this.copyPass.material.blending=Wi,this.clock=new L_}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let s=0,i=this.passes.length;s<i;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}bb!==void 0&&(o instanceof bb?r=!0:o instanceof yz&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new we);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(r,s),this.renderTarget2.setSize(r,s);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class vz extends Gu{constructor(e,t,r=null,s=null,i=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=s,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new vn}render(e,t,r){const s=e.autoClear;e.autoClear=!1;let i,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(i),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=s}}function _z(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Oa(n,e){return Oa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Oa(n,e)}function Tz(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Oa(n,e)}function tp(n){return tp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tp(n)}function wz(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function XS(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XS=function(){return!!n})()}function Sz(n,e,t){if(XS())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var s=new(n.bind.apply(n,r));return t&&Oa(s,t.prototype),s}function np(n){var e=typeof Map=="function"?new Map:void 0;return np=function(r){if(r===null||!wz(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,s)}function s(){return Sz(r,arguments,tp(this).constructor)}return s.prototype=Object.create(r.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Oa(s,r)},np(n)}var Kn=(function(n){Tz(e,n);function e(t){var r;return r=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,_z(r)}return e})(np(Error));function fh(n){return Math.round(n*255)}function Nz(n,e,t){return fh(n)+","+fh(e)+","+fh(t)}function nu(n,e,t,r){if(r===void 0&&(r=Nz),e===0)return r(t,t,t);var s=(n%360+360)%360/60,i=(1-Math.abs(2*t-1))*e,o=i*(1-Math.abs(s%2-1)),a=0,l=0,c=0;s>=0&&s<1?(a=i,l=o):s>=1&&s<2?(a=o,l=i):s>=2&&s<3?(l=i,c=o):s>=3&&s<4?(l=o,c=i):s>=4&&s<5?(a=o,c=i):s>=5&&s<6&&(a=i,c=o);var u=t-i/2,d=a+u,h=l+u,f=c+u;return r(d,h,f)}var vb={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function Az(n){if(typeof n!="string")return n;var e=n.toLowerCase();return vb[e]?"#"+vb[e]:n}var Ez=/^#[a-fA-F0-9]{6}$/,Cz=/^#[a-fA-F0-9]{8}$/,Rz=/^#[a-fA-F0-9]{3}$/,Mz=/^#[a-fA-F0-9]{4}$/,ph=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Pz=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Dz=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Bz=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function io(n){if(typeof n!="string")throw new Kn(3);var e=Az(n);if(e.match(Ez))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(Cz)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(Rz))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(Mz)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var s=ph.exec(e);if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10)};var i=Pz.exec(e.substring(0,50));if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10),alpha:parseFloat(""+i[4])>1?parseFloat(""+i[4])/100:parseFloat(""+i[4])};var o=Dz.exec(e);if(o){var a=parseInt(""+o[1],10),l=parseInt(""+o[2],10)/100,c=parseInt(""+o[3],10)/100,u="rgb("+nu(a,l,c)+")",d=ph.exec(u);if(!d)throw new Kn(4,e,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10)}}var h=Bz.exec(e.substring(0,50));if(h){var f=parseInt(""+h[1],10),p=parseInt(""+h[2],10)/100,m=parseInt(""+h[3],10)/100,y="rgb("+nu(f,p,m)+")",x=ph.exec(y);if(!x)throw new Kn(4,e,y);return{red:parseInt(""+x[1],10),green:parseInt(""+x[2],10),blue:parseInt(""+x[3],10),alpha:parseFloat(""+h[4])>1?parseFloat(""+h[4])/100:parseFloat(""+h[4])}}throw new Kn(5)}function kz(n){var e=n.red/255,t=n.green/255,r=n.blue/255,s=Math.max(e,t,r),i=Math.min(e,t,r),o=(s+i)/2;if(s===i)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,l=s-i,c=o>.5?l/(2-s-i):l/(s+i);switch(s){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;default:a=(e-t)/l+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:c,lightness:o,alpha:n.alpha}:{hue:a,saturation:c,lightness:o}}function ds(n){return kz(io(n))}var Fz=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},rp=Fz;function Cs(n){var e=n.toString(16);return e.length===1?"0"+e:e}function mh(n){return Cs(Math.round(n*255))}function Lz(n,e,t){return rp("#"+mh(n)+mh(e)+mh(t))}function KS(n,e,t){return nu(n,e,t,Lz)}function Iz(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return KS(n.hue,n.saturation,n.lightness);throw new Kn(1)}function Oz(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?KS(n.hue,n.saturation,n.lightness):"rgba("+nu(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new Kn(2)}function YS(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return rp("#"+Cs(n)+Cs(e)+Cs(t));if(typeof n=="object"&&e===void 0&&t===void 0)return rp("#"+Cs(n.red)+Cs(n.green)+Cs(n.blue));throw new Kn(6)}function $u(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?YS(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new Kn(7)}var Uz=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},Vz=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},jz=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},Gz=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function hs(n){if(typeof n!="object")throw new Kn(8);if(Vz(n))return $u(n);if(Uz(n))return YS(n);if(Gz(n))return Oz(n);if(jz(n))return Iz(n);throw new Kn(8)}function QS(n,e,t){return function(){var s=t.concat(Array.prototype.slice.call(arguments));return s.length>=e?n.apply(this,s):QS(n,e,s)}}function an(n){return QS(n,n.length,[])}function $z(n,e){if(e==="transparent")return e;var t=ds(e);return hs(yn({},t,{hue:t.hue+parseFloat(n)}))}an($z);function xo(n,e,t){return Math.max(n,Math.min(e,t))}function zz(n,e){if(e==="transparent")return e;var t=ds(e);return hs(yn({},t,{lightness:xo(0,1,t.lightness-parseFloat(n))}))}an(zz);function Hz(n,e){if(e==="transparent")return e;var t=ds(e);return hs(yn({},t,{saturation:xo(0,1,t.saturation-parseFloat(n))}))}an(Hz);function Wz(n,e){if(e==="transparent")return e;var t=ds(e);return hs(yn({},t,{lightness:xo(0,1,t.lightness+parseFloat(n))}))}an(Wz);function qz(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var r=io(e),s=yn({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),i=io(t),o=yn({},i,{alpha:typeof i.alpha=="number"?i.alpha:1}),a=s.alpha-o.alpha,l=parseFloat(n)*2-1,c=l*a===-1?l:l+a,u=1+l*a,d=(c/u+1)/2,h=1-d,f={red:Math.floor(s.red*d+o.red*h),green:Math.floor(s.green*d+o.green*h),blue:Math.floor(s.blue*d+o.blue*h),alpha:s.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return $u(f)}var Xz=an(qz),ZS=Xz;function Kz(n,e){if(e==="transparent")return e;var t=io(e),r=typeof t.alpha=="number"?t.alpha:1,s=yn({},t,{alpha:xo(0,1,(r*100+parseFloat(n)*100)/100)});return $u(s)}var Yz=an(Kz),Qz=Yz;function Zz(n,e){if(e==="transparent")return e;var t=ds(e);return hs(yn({},t,{saturation:xo(0,1,t.saturation+parseFloat(n))}))}an(Zz);function Jz(n,e){return e==="transparent"?e:hs(yn({},ds(e),{hue:parseFloat(n)}))}an(Jz);function e9(n,e){return e==="transparent"?e:hs(yn({},ds(e),{lightness:parseFloat(n)}))}an(e9);function t9(n,e){return e==="transparent"?e:hs(yn({},ds(e),{saturation:parseFloat(n)}))}an(t9);function n9(n,e){return e==="transparent"?e:ZS(parseFloat(n),"rgb(0, 0, 0)",e)}an(n9);function r9(n,e){return e==="transparent"?e:ZS(parseFloat(n),"rgb(255, 255, 255)",e)}an(r9);function s9(n,e){if(e==="transparent")return e;var t=io(e),r=typeof t.alpha=="number"?t.alpha:1,s=yn({},t,{alpha:xo(0,1,+(r*100-parseFloat(n)*100).toFixed(2)/100)});return $u(s)}an(s9);var qs=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-qs.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?qs.Bounce.In(n*2)*.5:qs.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),na=function(){return performance.now()},JS=(function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=na()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<r.length;s++){var i=this._tweens[r[s]],o=!t;i&&i.update(e,o)===!1&&!t&&delete this._tweens[r[s]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n})(),sp={Linear:function(n,e){var t=n.length-1,r=t*e,s=Math.floor(r),i=sp.Utils.Linear;return e<0?i(n[0],n[1],r):e>1?i(n[t],n[t-1],t-r):i(n[s],n[s+1>t?t:s+1],r-s)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},eN=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),ip=new JS,_b=(function(){function n(e,t){t===void 0&&(t=ip),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=qs.Linear.None,this._interpolationFunction=sp.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=eN.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=na()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var i in this._valuesEnd)s[i]=this._valuesEnd[i];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,s,i){for(var o in r){var a=e[o],l=Array.isArray(a),c=l?"array":typeof a,u=!l&&Array.isArray(r[o]);if(!(c==="undefined"||c==="function")){if(u){var d=r[o];if(d.length===0)continue;for(var h=[a],f=0,p=d.length;f<p;f+=1){var m=this._handleRelativeValue(a,d[f]);if(isNaN(m)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(m)}u&&(r[o]=h)}if((c==="object"||l)&&a&&!u){t[o]=l?[]:{};var y=a;for(var x in y)t[o][x]=y[x];s[o]=l?[]:{};var d=r[o];if(!this._isDynamic){var b={};for(var x in d)b[x]=d[x];r[o]=d=b}this._setupProperties(y,t[o],d,s[o],i)}else(typeof t[o]>"u"||i)&&(t[o]=a),l||(t[o]*=1),u?s[o]=r[o].slice().reverse():s[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=na()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=na()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=ip),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=qs.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=sp.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,s;if(e===void 0&&(e=na()),t===void 0&&(t=!0),this._isPaused)return!0;var i,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,l=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),c=this._duration+this._repeat*l,u=function(){if(r._duration===0||a>c)return 1;var y=Math.trunc(a/l),x=a-y*l,b=Math.min(x/r._duration,1);return b===0&&a===r._duration?1:b},d=u(),h=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||a>=this._duration)if(this._repeat>0){var f=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=f);for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*f,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var p=0,m=this._chainedTweens.length;p<m;p++)this._chainedTweens[p].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,s){for(var i in r)if(t[i]!==void 0){var o=t[i]||0,a=r[i],l=Array.isArray(e[i]),c=Array.isArray(a),u=!l&&c;u?e[i]=this._interpolationFunction(a,s):typeof a=="object"&&a?this._updateProperties(e[i],o,a,s):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[i]=o+(a-o)*s))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n})();eN.nextId;var ir=ip;ir.getAll.bind(ir);ir.removeAll.bind(ir);ir.add.bind(ir);ir.remove.bind(ir);ir.update.bind(ir);var rl,Ze,tN,nN,ks,Tb,rN,sN,iN,Qm,op,ap,Ua={},oN=[],i9=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,zu=Array.isArray;function Yn(n,e){for(var t in e)n[t]=e[t];return n}function Zm(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function o9(n,e,t){var r,s,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?rl.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(i in n.defaultProps)o[i]===void 0&&(o[i]=n.defaultProps[i]);return ga(n,o,r,s,null)}function ga(n,e,t,r,s){var i={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++tN,__i:-1,__u:0};return s==null&&Ze.vnode!=null&&Ze.vnode(i),i}function Hu(n){return n.children}function bc(n,e){this.props=n,this.context=e}function oo(n,e){if(e==null)return n.__?oo(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?oo(n):null}function aN(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return aN(n)}}function wb(n){(!n.__d&&(n.__d=!0)&&ks.push(n)&&!ru.__r++||Tb!=Ze.debounceRendering)&&((Tb=Ze.debounceRendering)||rN)(ru)}function ru(){for(var n,e,t,r,s,i,o,a=1;ks.length;)ks.length>a&&ks.sort(sN),n=ks.shift(),a=ks.length,n.__d&&(t=void 0,r=void 0,s=(r=(e=n).__v).__e,i=[],o=[],e.__P&&((t=Yn({},r)).__v=r.__v+1,Ze.vnode&&Ze.vnode(t),Jm(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[s]:null,i,s??oo(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,uN(i,t,o),r.__e=r.__=null,t.__e!=s&&aN(t)));ru.__r=0}function lN(n,e,t,r,s,i,o,a,l,c,u){var d,h,f,p,m,y,x,b=r&&r.__k||oN,v=e.length;for(l=a9(t,e,b,l,v),d=0;d<v;d++)(f=t.__k[d])!=null&&(h=f.__i==-1?Ua:b[f.__i]||Ua,f.__i=d,y=Jm(n,f,h,s,i,o,a,l,c,u),p=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&eg(h.ref,null,f),u.push(f.ref,f.__c||p,f)),m==null&&p!=null&&(m=p),(x=!!(4&f.__u))||h.__k===f.__k?l=cN(f,l,n,x):typeof f.type=="function"&&y!==void 0?l=y:p&&(l=p.nextSibling),f.__u&=-7);return t.__e=m,l}function a9(n,e,t,r,s){var i,o,a,l,c,u=t.length,d=u,h=0;for(n.__k=new Array(s),i=0;i<s;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[i]=ga(null,o,null,null,null):zu(o)?o=n.__k[i]=ga(Hu,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=n.__k[i]=ga(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[i]=o,l=i+h,o.__=n,o.__b=n.__b+1,(c=o.__i=l9(o,t,l,d))!=-1&&(d--,(a=t[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(s>u?h--:s<u&&h++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?h--:c==l+1?h++:(c>l?h--:h++,o.__u|=4))):n.__k[i]=null;if(d)for(i=0;i<u;i++)(a=t[i])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=oo(a)),hN(a,a));return r}function cN(n,e,t,r){var s,i;if(typeof n.type=="function"){for(s=n.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=n,e=cN(s[i],e,t,r));return e}n.__e!=e&&(r&&(e&&n.type&&!e.parentNode&&(e=oo(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function l9(n,e,t,r){var s,i,o,a=n.key,l=n.type,c=e[t],u=c!=null&&(2&c.__u)==0;if(c===null&&a==null||u&&a==c.key&&l==c.type)return t;if(r>(u?1:0)){for(s=t-1,i=t+1;s>=0||i<e.length;)if((c=e[o=s>=0?s--:i++])!=null&&(2&c.__u)==0&&a==c.key&&l==c.type)return o}return-1}function Sb(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||i9.test(e)?t:t+"px"}function Ql(n,e,t,r,s){var i,o;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||Sb(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||Sb(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(iN,"$1")),o=e.toLowerCase(),e=o in n||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+i]=t,t?r?t.u=r.u:(t.u=Qm,n.addEventListener(e,i?ap:op,i)):n.removeEventListener(e,i?ap:op,i);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Nb(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Qm++;else if(e.t<t.u)return;return t(Ze.event?Ze.event(e):e)}}}function Jm(n,e,t,r,s,i,o,a,l,c){var u,d,h,f,p,m,y,x,b,v,_,w,T,N,S,C,D,F=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),i=[a=e.__e=t.__e]),(u=Ze.__b)&&u(e);e:if(typeof F=="function")try{if(x=e.props,b="prototype"in F&&F.prototype.render,v=(u=F.contextType)&&r[u.__c],_=u?v?v.props.value:u.__:r,t.__c?y=(d=e.__c=t.__c).__=d.__E:(b?e.__c=d=new F(x,_):(e.__c=d=new bc(x,_),d.constructor=F,d.render=u9),v&&v.sub(d),d.state||(d.state={}),d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),b&&d.__s==null&&(d.__s=d.state),b&&F.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Yn({},d.__s)),Yn(d.__s,F.getDerivedStateFromProps(x,d.__s))),f=d.props,p=d.state,d.__v=e,h)b&&F.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),b&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(b&&F.getDerivedStateFromProps==null&&x!==f&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(x,_),e.__v==t.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(x,d.__s,_)===!1){for(e.__v!=t.__v&&(d.props=x,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(j){j&&(j.__=e)}),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(x,d.__s,_),b&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(f,p,m)})}if(d.context=_,d.props=x,d.__P=n,d.__e=!1,T=Ze.__r,N=0,b){for(d.state=d.__s,d.__d=!1,T&&T(e),u=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do d.__d=!1,T&&T(e),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++N<25);d.state=d.__s,d.getChildContext!=null&&(r=Yn(Yn({},r),d.getChildContext())),b&&!h&&d.getSnapshotBeforeUpdate!=null&&(m=d.getSnapshotBeforeUpdate(f,p)),C=u,u!=null&&u.type===Hu&&u.key==null&&(C=dN(u.props.children)),a=lN(n,zu(C)?C:[C],e,t,r,s,i,o,a,l,c),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(j){if(e.__v=null,l||i!=null)if(j.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else{for(D=i.length;D--;)Zm(i[D]);lp(e)}else e.__e=t.__e,e.__k=t.__k,j.then||lp(e);Ze.__e(j,e,t)}else i==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=c9(t.__e,e,t,r,s,i,o,l,c);return(u=Ze.diffed)&&u(e),128&e.__u?void 0:a}function lp(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(lp)}function uN(n,e,t){for(var r=0;r<t.length;r++)eg(t[r],t[++r],t[++r]);Ze.__c&&Ze.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(i){i.call(s)})}catch(i){Ze.__e(i,s.__v)}})}function dN(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:zu(n)?n.map(dN):Yn({},n)}function c9(n,e,t,r,s,i,o,a,l){var c,u,d,h,f,p,m,y=t.props||Ua,x=e.props,b=e.type;if(b=="svg"?s="http://www.w3.org/2000/svg":b=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((f=i[c])&&"setAttribute"in f==!!b&&(b?f.localName==b:f.nodeType==3)){n=f,i[c]=null;break}}if(n==null){if(b==null)return document.createTextNode(x);n=document.createElementNS(s,b,x.is&&x),a&&(Ze.__m&&Ze.__m(e,i),a=!1),i=null}if(b==null)y===x||a&&n.data==x||(n.data=x);else{if(i=i&&rl.call(n.childNodes),!a&&i!=null)for(y={},c=0;c<n.attributes.length;c++)y[(f=n.attributes[c]).name]=f.value;for(c in y)if(f=y[c],c!="children"){if(c=="dangerouslySetInnerHTML")d=f;else if(!(c in x)){if(c=="value"&&"defaultValue"in x||c=="checked"&&"defaultChecked"in x)continue;Ql(n,c,null,f,s)}}for(c in x)f=x[c],c=="children"?h=f:c=="dangerouslySetInnerHTML"?u=f:c=="value"?p=f:c=="checked"?m=f:a&&typeof f!="function"||y[c]===f||Ql(n,c,f,y[c],s);if(u)a||d&&(u.__html==d.__html||u.__html==n.innerHTML)||(n.innerHTML=u.__html),e.__k=[];else if(d&&(n.innerHTML=""),lN(e.type=="template"?n.content:n,zu(h)?h:[h],e,t,r,b=="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:t.__k&&oo(t,0),a,l),i!=null)for(c=i.length;c--;)Zm(i[c]);a||(c="value",b=="progress"&&p==null?n.removeAttribute("value"):p!=null&&(p!==n[c]||b=="progress"&&!p||b=="option"&&p!=y[c])&&Ql(n,c,p,y[c],s),c="checked",m!=null&&m!=n[c]&&Ql(n,c,m,y[c],s))}return n}function eg(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(s){Ze.__e(s,t)}}function hN(n,e,t){var r,s;if(Ze.unmount&&Ze.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||eg(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){Ze.__e(i,e)}r.base=r.__P=null}if(r=n.__k)for(s=0;s<r.length;s++)r[s]&&hN(r[s],e,t||typeof n.type!="function");t||Zm(n.__e),n.__c=n.__=n.__e=void 0}function u9(n,e,t){return this.constructor(n,t)}function d9(n,e,t){var r,s,i,o;e==document&&(e=document.documentElement),Ze.__&&Ze.__(n,e),s=(r=!1)?null:e.__k,i=[],o=[],Jm(e,n=e.__k=o9(Hu,null,[n]),s||Ua,Ua,e.namespaceURI,s?null:e.firstChild?rl.call(e.childNodes):null,i,s?s.__e:e.firstChild,r,o),uN(i,n,o)}function fN(n,e,t){var r,s,i,o,a=Yn({},n.props);for(i in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)i=="key"?r=e[i]:i=="ref"?s=e[i]:a[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(a.children=arguments.length>3?rl.call(arguments,2):t),ga(n.type,a,r||n.key,s||n.ref,null)}rl=oN.slice,Ze={__e:function(n,e,t,r){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(n)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,r||{}),o=s.__d),o)return s.__E=s}catch(a){n=a}throw n}},tN=0,nN=function(n){return n!=null&&n.constructor==null},bc.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Yn({},this.state),typeof n=="function"&&(n=n(Yn({},t),this.props)),n&&Yn(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),wb(this))},bc.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),wb(this))},bc.prototype.render=Hu,ks=[],rN=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,sN=function(n,e){return n.__v.__b-e.__v.__b},ru.__r=0,iN=/(PointerCapture)$|Capture$/i,Qm=0,op=Nb(!1),ap=Nb(!0);function Ab(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function h9(n){if(Array.isArray(n))return n}function f9(n,e,t){return(e=b9(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function p9(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function m9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function g9(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Eb(Object(t),!0).forEach(function(r){f9(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Eb(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function x9(n,e){return h9(n)||p9(n,e)||v9(n,e)||m9()}function y9(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function b9(n){var e=y9(n,"string");return typeof e=="symbol"?e:e+""}function su(n){"@babel/helpers - typeof";return su=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},su(n)}function v9(n,e){if(n){if(typeof n=="string")return Ab(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ab(n,e):void 0}}var cp=function(e){if(su(e)!=="object")return e;var t=fN(e);if(t.props){var r;t.props=g9({},t.props),t!=null&&(r=t.props)!==null&&r!==void 0&&r.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(cp):cp(t.props.children))}return t},_9=function(e){return nN(fN(e))},T9=function(e,t){delete t.__k,d9(cp(e),t)};function w9(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}}var S9=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;w9(S9);var N9=Su({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.style,i=s===void 0?{}:s,o=!!e&&su(e)==="object"&&!!e.node&&typeof e.node=="function",a=Bt(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(i).forEach(function(c){var u=x9(c,2),d=u[0],h=u[1];return t.tooltipEl.style(d,h)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(l),function(c){t.mouseInside=!0;var u=Nn(c),d=a.node(),h=d.offsetWidth,f=d.offsetHeight,p=[t.offsetX===null||t.offsetX===void 0?"-".concat(u[0]/h*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?f>130&&f-u[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",u[0]+"px").style("top",u[1]+"px").style("transform","translate(".concat(p.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):_9(e.content)?(e.tooltipEl.text(""),T9(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function A9(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}}var E9=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;A9(E9);function up(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function C9(n){if(Array.isArray(n))return n}function R9(n){if(Array.isArray(n))return up(n)}function M9(n,e,t){return(e=I9(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function P9(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function D9(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],l=!0,c=!1;try{if(i=(t=t.call(n)).next,e!==0)for(;!(l=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function B9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k9(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F9(n,e){return C9(n)||D9(n,e)||pN(n,e)||B9()}function Ss(n){return R9(n)||P9(n)||pN(n)||k9()}function L9(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function I9(n){var e=L9(n,"string");return typeof e=="symbol"?e:e+""}function pN(n,e){if(n){if(typeof n=="string")return up(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?up(n,e):void 0}}var Ke=window.THREE?window.THREE:{WebGLRenderer:dC,Scene:fu,PerspectiveCamera:_a,Raycaster:Wv,SRGBColorSpace:kp,TextureLoader:uC,Vector2:we,Vector3:ce,Box3:Yv,Color:vn,Mesh:kn,SphereGeometry:Bp,MeshBasicMaterial:Hr,BackSide:Qt,Clock:L_},mN=Su({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var s=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&s.sort(function(o,a){return e.hoverOrderComparator(o.object,a.object)});var i=s.find(function(o){return e.hoverFilter(o.object)})||null;r=i?i.object:null,e.intersection=i||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&Ee(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,r=t.x,s=t.y;return{x:r,y:s}},cameraPosition:function(e,t,r,s){var i=e.camera;if(t&&e.initialised){var o=t,a=r||{x:0,y:0,z:0};if(!s)u(o),d(a);else{var l=Object.assign({},i.position),c=h();e.tweenGroup.add(new _b(l).to(o,s).easing(qs.Quadratic.Out).onUpdate(u).start()),e.tweenGroup.add(new _b(c).to(a,s/3).easing(qs.Quadratic.Out).onUpdate(d).start())}return this}return Object.assign({},i.position,{lookAt:h()});function u(f){var p=f.x,m=f.y,y=f.z;p!==void 0&&(i.position.x=p),m!==void 0&&(i.position.y=m),y!==void 0&&(i.position.z=y)}function d(f){var p=new Ke.Vector3(f.x,f.y,f.z);e.controls.enabled&&e.controls.target?e.controls.target=p:i.lookAt(p)}function h(){return Object.assign(new Ke.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,s=arguments.length,i=new Array(s>3?s-3:0),o=3;o<s;o++)i[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,i),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,i=e.camera;if(t){var o=new Ke.Vector3(0,0,0),a=Math.max.apply(Math,Ss(Object.entries(t).map(function(f){var p=F9(f,2),m=p[0],y=p[1];return Math.max.apply(Math,Ss(y.map(function(x){return Math.abs(o[m]-x)})))})))*2,l=(1-s*2/e.height)*i.fov,c=a/Math.atan(l*Math.PI/180),u=c/i.aspect,d=Math.max(c,u);if(d>0){var h=o.clone().sub(i.position).normalize().multiplyScalar(-d);this.cameraPosition(h,o,r)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},r=new Ke.Box3(new Ke.Vector3(0,0,0),new Ke.Vector3(0,0,0)),s=e.objects.filter(t);return s.length?(s.forEach(function(i){return r.expandByObject(i)}),Object.assign.apply(Object,Ss(["x","y","z"].map(function(i){return M9({},i,[r.min[i],r.max[i]])})))):null},getScreenCoords:function(e,t,r,s){var i=new Ke.Vector3(t,r,s);return i.project(this.camera()),{x:(i.x+1)*e.width/2,y:-(i.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=new Ke.Vector2(t/e.width*2-1,-(r/e.height)*2+1),o=new Ke.Raycaster;return o.setFromCamera(i,e.camera),Object.assign({},o.ray.at(s,new Ke.Vector3))},intersectingObjects:function(e,t,r){var s=new Ke.Vector2(t/e.width*2-1,-(r/e.height)*2+1),i=new Ke.Raycaster;return i.params.Line.threshold=e.lineHoverPrecision,i.params.Points.threshold=e.pointsHoverPrecision,i.setFromCamera(s,e.camera),i.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Ke.Scene,camera:new Ke.PerspectiveCamera,clock:new Ke.Clock,tweenGroup:new JS,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.controlType,i=s===void 0?"trackball":s,o=r.useWebGPU,a=o===void 0?!1:o,l=r.rendererConfig,c=l===void 0?{}:l,u=r.extraRenderers,d=u===void 0?[]:u,h=r.waitForLoadComplete,f=h===void 0?!0:h;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new N9(t.container),t.pointerPos=new Ke.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(p){return t.container.addEventListener(p,function(m){if(p==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&m.type==="pointermove"&&(m.pressure>0||t.isPointerPressed)&&(m.pointerType==="mouse"||m.movementX===void 0||[m.movementX,m.movementY].some(function(b){return Math.abs(b)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var y=x(t.container);t.pointerPos.x=m.pageX-y.left,t.pointerPos.y=m.pageY-y.top}function x(b){var v=b.getBoundingClientRect(),_=window.pageXOffset||document.documentElement.scrollLeft,w=window.pageYOffset||document.documentElement.scrollTop;return{top:v.top+w,left:v.left+_}}},{passive:!0})}),t.container.addEventListener("pointerup",function(p){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){p.button===0&&t.onClick(t.hoverObj||null,p,t.intersection),p.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,p,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(p){t.onRightClick&&p.preventDefault()}),t.renderer=new(a?A6:Ke.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},c)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=d,t.extraRenderers.forEach(function(p){p.domElement.style.position="absolute",p.domElement.style.top="0px",p.domElement.style.pointerEvents="none",t.container.appendChild(p.domElement)}),t.postProcessingComposer=new bz(t.renderer),t.postProcessingComposer.addPass(new vz(t.scene,t.camera)),t.controls=new{trackball:C6,orbit:z6,fly:sz}[i](t.camera,t.renderer.domElement),i==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(i==="trackball"||i==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Ss(t.extraRenderers)).forEach(function(p){return p.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Ke.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!f,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,s=e.width,i=e.height;e.container.style.width="".concat(s,"px"),e.container.style.height="".concat(i,"px"),[e.renderer,e.postProcessingComposer].concat(Ss(e.extraRenderers)).forEach(function(f){return f.setSize(s,i)}),e.camera.aspect=s/i;var o=e.viewOffset.slice(0,2);o.some(function(f){return f})&&(r=e.camera).setViewOffset.apply(r,[s,i].concat(Ss(o),[s,i])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var a,l=e.width,c=e.height,u=e.viewOffset.slice(0,2);u.some(function(f){return f})?(a=e.camera).setViewOffset.apply(a,[l,c].concat(Ss(u),[l,c])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Ke.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var d=io(e.backgroundColor).alpha;d===void 0&&(d=1),e.renderer.setClearColor(new Ke.Color(Qz(1,e.backgroundColor)),d)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Ke.TextureLoader().load(e.backgroundImageUrl,function(f){f.colorSpace=Ke.SRGBColorSpace,e.skysphere.material=new Ke.MeshBasicMaterial({map:f,side:Ke.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&h()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&h())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(f){return e.scene.remove(f)}),e.lights.forEach(function(f){return e.scene.add(f)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(f){return e.scene.remove(f)}),e.objects.forEach(function(f){return e.scene.add(f)}));function h(){e.loadComplete=e.scene.visible=!0}}});function O9(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}}var U9=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;O9(U9);function dp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function V9(n){if(Array.isArray(n))return dp(n)}function sl(n,e,t){return(e=z9(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function j9(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function G9(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cb(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Zl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cb(Object(t),!0).forEach(function(r){sl(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Cb(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Wu(n){return V9(n)||j9(n)||H9(n)||G9()}function $9(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function z9(n){var e=$9(n,"string");return typeof e=="symbol"?e:e+""}function H9(n,e){if(n){if(typeof n=="string")return dp(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?dp(n,e):void 0}}function gN(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(s){return{default:t[s](),onChange:function(o,a){a[n][s](o)},triggerUpdate:!1}},linkMethod:function(s){return function(i){for(var o=i[n],a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];var u=o[s].apply(o,l);return u===o?this:u}}}}var gh=window.THREE?window.THREE:{AmbientLight:Jv,DirectionalLight:Zv,REVISION:pu},W9=170,xN=gN("forceGraph",q1),q9=Object.assign.apply(Object,Wu(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return sl({},n,xN.linkProp(n))}))),X9=Object.assign.apply(Object,Wu(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return sl({},n,xN.linkMethod(n))}))),vc=gN("renderObjs",mN),K9=Object.assign.apply(Object,Wu(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return sl({},n,vc.linkProp(n))}))),Y9=Object.assign.apply(Object,Wu(["lights","cameraPosition","postProcessingComposer"].map(function(n){return sl({},n,vc.linkMethod(n))})).concat([{graph2ScreenCoords:vc.linkMethod("getScreenCoords"),screen2GraphCoords:vc.linkMethod("getSceneCoords")}])),Q9=Su({props:Zl(Zl({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var r=t.renderObjs.controls();r&&(r.enabled=e,e&&r.domElement&&r.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},showPointerCursor:{default:!0,triggerUpdate:!1}},q9),K9),methods:Zl(Zl({zoomToFit:function(e,t,r){for(var s,i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];return e.renderObjs.fitToBbox((s=e.forceGraph).getGraphBbox.apply(s,o),t,r),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},X9),Y9),stateInit:function(e){var t=e.controlType,r=e.rendererConfig,s=e.extraRenderers,i=new q1;return{forceGraph:i,renderObjs:mN({controlType:t,rendererConfig:r,extraRenderers:s}).objects([i]).lights([new gh.AmbientLight(13421772,Math.PI),new gh.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var r=document.createElement("div");t.container.appendChild(r),t.renderObjs(r);var s=t.renderObjs.camera(),i=t.renderObjs.renderer(),o=t.renderObjs.controls();o.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=s.position.z;var a;t.container.appendChild(a=document.createElement("div")),a.className="graph-info-msg",a.textContent="",t.forceGraph.onLoading(function(){a.textContent="Loading..."}).onFinishLoading(function(){a.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),s.position.x===0&&s.position.y===0&&s.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(s.lookAt(t.forceGraph.position),t.lastSetCameraZ=s.position.z=Math.cbrt(t.graphData.nodes.length)*W9)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(u){return u.__initialFixedPos&&!u.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var c=t._dragControls=new Ck(t.graphData.nodes.map(function(u){return u.__threeObj}).filter(function(u){return u}),s,i.domElement);c.addEventListener("dragstart",function(u){var d=mr(u.object);if(d){o.enabled=!1,u.object.__initialPos=u.object.position.clone(),u.object.__prevPos=u.object.position.clone();var h=d.__data;!h.__initialFixedPos&&(h.__initialFixedPos={fx:h.fx,fy:h.fy,fz:h.fz}),!h.__initialPos&&(h.__initialPos={x:h.x,y:h.y,z:h.z}),["x","y","z"].forEach(function(f){return h["f".concat(f)]=h[f]}),i.domElement.classList.add("grabbable")}}),c.addEventListener("drag",function(u){var d=mr(u.object);if(d){if(!u.object.hasOwnProperty("__graphObjType")){var h=u.object.__initialPos,f=u.object.__prevPos,p=u.object.position;d.position.add(p.clone().sub(f)),f.copy(p),p.copy(h)}var m=d.__data,y=d.position,x={x:y.x-m.x,y:y.y-m.y,z:y.z-m.z};["x","y","z"].forEach(function(b){return m["f".concat(b)]=m[b]=y[b]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),m.__dragged=!0,t.onNodeDrag(m,x)}}),c.addEventListener("dragend",function(u){var d=mr(u.object);if(d){delete u.object.__initialPos,delete u.object.__prevPos;var h=d.__data;h.__disposeControlsAfterDrag&&(c.dispose(),delete h.__disposeControlsAfterDrag);var f=h.__initialFixedPos,p=h.__initialPos,m={x:p.x-h.x,y:p.y-h.y,z:p.z-h.z};if(f&&(["x","y","z"].forEach(function(x){var b="f".concat(x);f[b]===void 0&&delete h[b]}),delete h.__initialFixedPos,delete h.__initialPos,h.__dragged&&(delete h.__dragged,t.onNodeDragEnd(h,m))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls){var y;o.enabled=!0,o._status&&((y=o._onPointerCancel)===null||y===void 0||y.call(o)),o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))}i.domElement.classList.remove("grabbable")}})}}),gh.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,c){var u=mr(l);if(!u)return 1;var d=mr(c);if(!d)return-1;var h=function(p){return p.__graphObjType==="node"};return h(d)-h(u)}).tooltipContent(function(l){var c=mr(l);return c&&Ee(t["".concat(c.__graphObjType,"Label")])(c.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var c=mr(l);if(c!==t.hoverObj){var u=t.hoverObj?t.hoverObj.__graphObjType:null,d=t.hoverObj?t.hoverObj.__data:null,h=c?c.__graphObjType:null,f=c?c.__data:null;if(u&&u!==h){var p=t["on".concat(u==="node"?"Node":"Link","Hover")];p&&p(null,d)}if(h){var m=t["on".concat(h==="node"?"Node":"Link","Hover")];m&&m(f,u===h?d:null)}i.domElement.classList[(c&&t["on".concat(h==="node"?"Node":"Link","Click")]||!c&&t.onBackgroundClick)&&Ee(t.showPointerCursor)(f)?"add":"remove"]("clickable"),t.hoverObj=c}}).clickAfterDrag(!1).onClick(function(l,c){var u=mr(l);if(u){var d=t["on".concat(u.__graphObjType==="node"?"Node":"Link","Click")];d&&d(u.__data,c)}else t.onBackgroundClick&&t.onBackgroundClick(c)}).onRightClick(function(l,c){var u=mr(l);if(u){var d=t["on".concat(u.__graphObjType==="node"?"Node":"Link","RightClick")];d&&d(u.__data,c)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(c)}),this._animationCycle()}});function mr(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var xh={exports:{}},yh,Rb;function Z9(){if(Rb)return yh;Rb=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return yh=n,yh}var bh,Mb;function J9(){if(Mb)return bh;Mb=1;var n=Z9();function e(){}function t(){}return t.resetWarningCache=e,bh=function(){function r(o,a,l,c,u,d){if(d!==n){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}r.isRequired=r;function s(){return r}var i={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:s,element:r,elementType:r,instanceOf:s,node:r,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return i.PropTypes=i,i},bh}var Pb;function eH(){return Pb||(Pb=1,xh.exports=J9()()),xh.exports}var tH=eH();const B=Hv(tH),qu={width:B.number,height:B.number,graphData:B.shape({nodes:B.arrayOf(B.object).isRequired,links:B.arrayOf(B.object).isRequired}),backgroundColor:B.string,nodeRelSize:B.number,nodeId:B.string,nodeLabel:B.oneOfType([B.string,B.func]),nodeVal:B.oneOfType([B.number,B.string,B.func]),nodeVisibility:B.oneOfType([B.bool,B.string,B.func]),nodeColor:B.oneOfType([B.string,B.func]),nodeAutoColorBy:B.oneOfType([B.string,B.func]),onNodeHover:B.func,onNodeClick:B.func,linkSource:B.string,linkTarget:B.string,linkLabel:B.oneOfType([B.string,B.func]),linkVisibility:B.oneOfType([B.bool,B.string,B.func]),linkColor:B.oneOfType([B.string,B.func]),linkAutoColorBy:B.oneOfType([B.string,B.func]),linkWidth:B.oneOfType([B.number,B.string,B.func]),linkCurvature:B.oneOfType([B.number,B.string,B.func]),linkDirectionalArrowLength:B.oneOfType([B.number,B.string,B.func]),linkDirectionalArrowColor:B.oneOfType([B.string,B.func]),linkDirectionalArrowRelPos:B.oneOfType([B.number,B.string,B.func]),linkDirectionalParticles:B.oneOfType([B.number,B.string,B.func]),linkDirectionalParticleSpeed:B.oneOfType([B.number,B.string,B.func]),linkDirectionalParticleOffset:B.oneOfType([B.number,B.string,B.func]),linkDirectionalParticleWidth:B.oneOfType([B.number,B.string,B.func]),linkDirectionalParticleColor:B.oneOfType([B.string,B.func]),onLinkHover:B.func,onLinkClick:B.func,dagMode:B.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:B.number,dagNodeFilter:B.func,onDagError:B.func,d3AlphaMin:B.number,d3AlphaDecay:B.number,d3VelocityDecay:B.number,warmupTicks:B.number,cooldownTicks:B.number,cooldownTime:B.number,onEngineTick:B.func,onEngineStop:B.func,getGraphBbox:B.func},yN={zoomToFit:B.func,onNodeRightClick:B.func,onNodeDrag:B.func,onNodeDragEnd:B.func,onLinkRightClick:B.func,linkHoverPrecision:B.number,onBackgroundClick:B.func,onBackgroundRightClick:B.func,showPointerCursor:B.oneOfType([B.bool,B.func]),enablePointerInteraction:B.bool,enableNodeDrag:B.bool},tg={showNavInfo:B.bool,nodeOpacity:B.number,nodeResolution:B.number,nodeThreeObject:B.oneOfType([B.object,B.string,B.func]),nodeThreeObjectExtend:B.oneOfType([B.bool,B.string,B.func]),nodePositionUpdate:B.func,linkOpacity:B.number,linkResolution:B.number,linkCurveRotation:B.oneOfType([B.number,B.string,B.func]),linkMaterial:B.oneOfType([B.object,B.string,B.func]),linkThreeObject:B.oneOfType([B.object,B.string,B.func]),linkThreeObjectExtend:B.oneOfType([B.bool,B.string,B.func]),linkPositionUpdate:B.func,linkDirectionalArrowResolution:B.number,linkDirectionalParticleResolution:B.number,linkDirectionalParticleThreeObject:B.oneOfType([B.object,B.string,B.func]),forceEngine:B.oneOf(["d3","ngraph"]),ngraphPhysics:B.object,numDimensions:B.oneOf([1,2,3])};Object.assign({},qu,yN,{linkLineDash:B.oneOfType([B.arrayOf(B.number),B.string,B.func]),nodeCanvasObjectMode:B.oneOfType([B.string,B.func]),nodeCanvasObject:B.func,nodePointerAreaPaint:B.func,linkCanvasObjectMode:B.oneOfType([B.string,B.func]),linkCanvasObject:B.func,linkPointerAreaPaint:B.func,linkDirectionalParticleCanvasObject:B.func,autoPauseRedraw:B.bool,minZoom:B.number,maxZoom:B.number,enableZoomInteraction:B.oneOfType([B.bool,B.func]),enablePanInteraction:B.oneOfType([B.bool,B.func]),onZoom:B.func,onZoomEnd:B.func,onRenderFramePre:B.func,onRenderFramePost:B.func});const nH=Object.assign({},qu,yN,tg,{enableNavigationControls:B.bool,controlType:B.oneOf(["trackball","orbit","fly"]),rendererConfig:B.object,extraRenderers:B.arrayOf(B.shape({render:B.func.isRequired}))});Object.assign({},qu,tg,{nodeDesc:B.oneOfType([B.string,B.func]),linkDesc:B.oneOfType([B.string,B.func])});Object.assign({},qu,tg,{markerAttrs:B.object,yOffset:B.number,glScale:B.number});const ng=Ek(Q9,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});ng.displayName="ForceGraph3D";ng.propTypes=nH;const rH=()=>{const[n,e]=E.useState({nodes:[],links:[]}),[t,r]=E.useState(!1),s=E.useRef(),i=E.useRef(0);E.useEffect(()=>{const a=async()=>{try{const u=await(await fetch("/api/galaxy")).json();u.simulation&&r(!0),u&&u.nodes&&e(u)}catch(c){console.error("Failed to fetch galaxy data:",c)}};a();const l=setInterval(a,1e4);return()=>clearInterval(l)},[]),E.useEffect(()=>{const a=()=>{if(s.current){i.current+=.003;const l=i.current,c=800;s.current.cameraPosition({x:c*Math.sin(l),z:c*Math.cos(l)})}requestAnimationFrame(a)};a()},[]);const o=a=>{switch(a.group){case"start":return"#ef4444";case"core":return"#ffffff";case"sector":return"#f59e0b";case"agent":return"#00f3ff";case"knowledge":return"#a855f7";default:return"#64748b"}};return g.jsxs("div",{className:"w-full h-full relative bg-black/50 rounded overflow-hidden cursor-move",children:[g.jsxs("div",{className:"absolute top-4 left-4 z-10 pointer-events-none w-full pr-8",children:[g.jsxs("div",{className:"flex justify-between items-start",children:[g.jsxs("div",{className:"flex flex-col gap-1",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(ss,{size:20,className:"text-[var(--hud-accent)] animate-pulse"}),g.jsx("h2",{className:"text-xl font-bold text-white tracking-widest uppercase font-mono",children:"Neural Ops Center"})]}),g.jsx("span",{className:"text-xs text-[var(--hud-text-dim)] font-mono",children:"LIVE SYSTEM TELEMETRY"})]}),g.jsxs("div",{className:"flex gap-8 bg-black/40 backdrop-blur-md p-4 rounded-lg border border-white/10",children:[g.jsxs("div",{className:"flex flex-col items-center",children:[g.jsx("span",{className:"text-2xl font-bold text-[#00f3ff] text-shadow-neon",children:n.stats?.cache_efficiency||"--%"}),g.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"CACHE EFFICIENCY"})]}),g.jsxs("div",{className:"flex flex-col items-center border-l border-white/10 pl-8",children:[g.jsx("span",{className:"text-2xl font-bold text-[#a855f7]",children:n.stats?.total_memories||0}),g.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"ACTIVE NODES"})]}),g.jsxs("div",{className:"flex flex-col items-center border-l border-white/10 pl-8",children:[g.jsx("span",{className:"text-2xl font-bold text-[#f59e0b]",children:n.stats?.active_agents||0}),g.jsx("span",{className:"text-[10px] text-white/60 font-mono tracking-wider",children:"AGENTS ONLINE"})]})]})]}),t&&g.jsxs("div",{className:"inline-flex items-center gap-2 bg-[rgba(255,165,0,0.1)] border border-orange-500/50 px-2 py-1 rounded mt-2",children:[g.jsx(Xp,{size:12,className:"text-orange-500 animate-pulse"}),g.jsx("span",{className:"text-[10px] text-orange-400 font-mono",children:"SIMULATION MODE"})]})]}),n.nodes.length===0&&g.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:g.jsx("span",{className:"text-[var(--hud-text-dim)] font-mono animate-pulse",children:"ESTABLISHING UPLINK..."})}),n.nodes.length>0&&g.jsx(ng,{ref:s,graphData:n,nodeLabel:"name",nodeColor:o,nodeVal:a=>a.val||5,nodeResolution:16,linkColor:()=>"rgba(0, 243, 255, 0.15)",linkWidth:1,linkDirectionalParticles:2,linkDirectionalParticleSpeed:.005,linkDirectionalParticleWidth:2,linkDirectionalParticleColor:()=>"#00f3ff",backgroundColor:"rgba(0,0,0,0)",showNavInfo:!1,bloomStrength:1.5,enableNodeDrag:!1,onNodeClick:a=>{const c=1+100/Math.hypot(a.x,a.y,a.z);s.current&&s.current.cameraPosition({x:a.x*c,y:a.y*c,z:a.z*c},a,3e3)}}),g.jsx("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none bg-black/60 backdrop-blur p-2 rounded border border-white/10",children:g.jsxs("div",{className:"flex flex-col gap-1 text-[10px] font-mono text-[var(--hud-text-dim)]",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00f3ff] shadow-[0_0_5px_#00f3ff]"})," AGENT NODE"]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"w-2 h-2 rounded-full bg-[#a855f7] shadow-[0_0_5px_#a855f7]"})," KNOWLEDGE"]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"w-2 h-2 rounded-full bg-[#f59e0b] shadow-[0_0_5px_#f59e0b]"})," SECTOR HUB"]})]})})]})},sH=E.createContext(null),Xu=()=>E.useContext(sH);function iH(){const{token:n}=Xu(),[e,t]=E.useState([]),[r,s]=E.useState([]),[i,o]=E.useState(null);return E.useEffect(()=>{if(!n)return;const a=async()=>{try{const h=await(await fetch("/api/admin-stats",{headers:{Authorization:`Bearer ${n}`}})).json();if(h&&h.top_users){const f=h.top_users.map((p,m)=>({rank:m+1,name:p.email.split("@")[0]||"Unknown Agent",score:p.requests,sector:"General"}));t(f)}else t([{rank:1,name:"System-Prime",score:1e3,sector:"Core"}])}catch(d){console.error("Failed to fetch leaderboard:",d)}};a();const l=setInterval(a,6e4),c=new EventSource("/api/events/stream");c.onmessage=d=>{const h=JSON.parse(d.data);if(h.type!=="sys:connected"&&(h.type==="CACHE_HIT"||h.type==="OPTIMIZATION"||Math.random()>.7)){const f={id:Date.now(),agent:h.agentId||"Swarm-Node",pattern:h.type==="CACHE_HIT"?"Pattern Match":"Optimization Found",improvement:Math.floor(Math.random()*20)+5,time:new Date().toLocaleTimeString()};s(p=>[f,...p].slice(0,8))}},o({status:"Running Experiment #8492",progress:45,target:"Global Latency Optimization"});const u=setInterval(()=>{o(d=>({...d,progress:d.progress>=100?0:d.progress+1}))},1e3);return()=>{clearInterval(l),clearInterval(u),c.close()}},[]),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-8rem)]",children:[g.jsx("div",{className:"space-y-6",children:g.jsx(Ue,{title:"Live Discoveries",icon:Xp,className:"h-full flex flex-col",children:g.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-3 custom-scrollbar",children:[r.map(a=>g.jsxs("div",{className:"p-3 rounded bg-[rgba(255,255,255,0.03)] border-l-2 border-[var(--hud-accent)] animate-in slide-in-from-left duration-300",children:[g.jsxs("div",{className:"flex justify-between items-start mb-1",children:[g.jsx("span",{className:"text-sm font-bold text-white",children:a.agent}),g.jsx("span",{className:"text-[10px] font-mono text-[var(--hud-text-dim)]",children:a.time})]}),g.jsxs("div",{className:"text-xs text-[var(--hud-text-dim)] mb-2",children:["Found: ",g.jsx("span",{className:"text-white",children:a.pattern})]}),g.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono text-[var(--hud-success)]",children:[g.jsx(yu,{size:12}),g.jsxs("span",{children:["+",a.improvement,"% Efficiency"]})]})]},a.id)),r.length===0&&g.jsx("div",{className:"text-center text-[var(--hud-text-dim)] py-8 italic",children:"Listening for swarm signals..."})]})})}),g.jsx("div",{className:"lg:col-span-1 flex flex-col gap-6 relative",children:g.jsxs(Ue,{className:"flex-1 relative overflow-hidden p-0 border-[var(--hud-accent)] shadow-[0_0_30px_rgba(0,243,255,0.1)]",children:[g.jsx(rH,{}),g.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-[rgba(0,0,0,0.8)] backdrop-blur p-4 border-t border-[var(--hud-border)] pointer-events-none",children:[g.jsxs("div",{className:"flex justify-between items-center mb-2",children:[g.jsx("span",{className:"text-xs font-bold text-[var(--hud-text-dim)]",children:"ACTIVE EXPERIMENT"}),g.jsx("span",{className:"text-xs font-mono text-[var(--hud-accent)] animate-pulse",children:"RUNNING"})]}),g.jsx("div",{className:"text-sm font-medium text-white mb-3",children:i?.target}),g.jsx("div",{className:"h-1 bg-[rgba(255,255,255,0.1)] rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-[var(--hud-accent)] transition-all duration-300",style:{width:`${i?.progress}%`}})})]})]})}),g.jsx("div",{className:"space-y-6",children:g.jsx(Ue,{title:"Top Agents",icon:$_,className:"h-full",children:g.jsx(Sa,{columns:[{header:"Rank",accessor:"rank",render:a=>g.jsxs("span",{className:"font-mono text-[var(--hud-accent)]",children:["#",a.rank]})},{header:"Agent Name",accessor:"name",render:a=>g.jsx("span",{className:"font-bold text-white",children:a.name})},{header:"Score",accessor:"score",render:a=>g.jsx("span",{className:"font-mono text-[var(--hud-warning)]",children:a.score})}],data:e})})})]})}const rg=E.createContext({});function sg(n){const e=E.useRef(null);return e.current===null&&(e.current=n()),e.current}const ig=typeof window<"u",bN=ig?E.useLayoutEffect:E.useEffect,Ku=E.createContext(null);function og(n,e){n.indexOf(e)===-1&&n.push(e)}function ag(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const kr=(n,e,t)=>t>e?e:t<n?n:t;let lg=()=>{};const Fr={},vN=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function _N(n){return typeof n=="object"&&n!==null}const TN=n=>/^0[^.\s]+$/u.test(n);function cg(n){let e;return()=>(e===void 0&&(e=n()),e)}const xn=n=>n,oH=(n,e)=>t=>e(n(t)),il=(...n)=>n.reduce(oH),Va=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class ug{constructor(){this.subscriptions=[]}add(e){return og(this.subscriptions,e),()=>ag(this.subscriptions,e)}notify(e,t,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,t,r);else for(let i=0;i<s;i++){const o=this.subscriptions[i];o&&o(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const er=n=>n*1e3,mn=n=>n/1e3;function wN(n,e){return e?n*(1e3/e):0}const SN=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,aH=1e-7,lH=12;function cH(n,e,t,r,s){let i,o,a=0;do o=e+(t-e)/2,i=SN(o,r,s)-n,i>0?t=o:e=o;while(Math.abs(i)>aH&&++a<lH);return o}function ol(n,e,t,r){if(n===e&&t===r)return xn;const s=i=>cH(i,0,1,n,t);return i=>i===0||i===1?i:SN(s(i),e,r)}const NN=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,AN=n=>e=>1-n(1-e),EN=ol(.33,1.53,.69,.99),dg=AN(EN),CN=NN(dg),RN=n=>(n*=2)<1?.5*dg(n):.5*(2-Math.pow(2,-10*(n-1))),hg=n=>1-Math.sin(Math.acos(n)),MN=AN(hg),PN=NN(hg),uH=ol(.42,0,1,1),dH=ol(0,0,.58,1),DN=ol(.42,0,.58,1),hH=n=>Array.isArray(n)&&typeof n[0]!="number",BN=n=>Array.isArray(n)&&typeof n[0]=="number",fH={linear:xn,easeIn:uH,easeInOut:DN,easeOut:dH,circIn:hg,circInOut:PN,circOut:MN,backIn:dg,backInOut:CN,backOut:EN,anticipate:RN},pH=n=>typeof n=="string",Db=n=>{if(BN(n)){lg(n.length===4);const[e,t,r,s]=n;return ol(e,t,r,s)}else if(pH(n))return fH[n];return n},Jl=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function mH(n,e){let t=new Set,r=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(u){o.has(u)&&(c.schedule(u),n()),u(a)}const c={schedule:(u,d=!1,h=!1)=>{const p=h&&s?t:r;return d&&o.add(u),p.has(u)||p.add(u),u},cancel:u=>{r.delete(u),o.delete(u)},process:u=>{if(a=u,s){i=!0;return}s=!0,[t,r]=[r,t],t.forEach(l),t.clear(),s=!1,i&&(i=!1,c.process(u))}};return c}const gH=40;function kN(n,e){let t=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},i=()=>t=!0,o=Jl.reduce((v,_)=>(v[_]=mH(i),v),{}),{setup:a,read:l,resolveKeyframes:c,preUpdate:u,update:d,preRender:h,render:f,postRender:p}=o,m=()=>{const v=Fr.useManualTiming?s.timestamp:performance.now();t=!1,Fr.useManualTiming||(s.delta=r?1e3/60:Math.max(Math.min(v-s.timestamp,gH),1)),s.timestamp=v,s.isProcessing=!0,a.process(s),l.process(s),c.process(s),u.process(s),d.process(s),h.process(s),f.process(s),p.process(s),s.isProcessing=!1,t&&e&&(r=!1,n(m))},y=()=>{t=!0,r=!0,s.isProcessing||n(m)};return{schedule:Jl.reduce((v,_)=>{const w=o[_];return v[_]=(T,N=!1,S=!1)=>(t||y(),w.schedule(T,N,S)),v},{}),cancel:v=>{for(let _=0;_<Jl.length;_++)o[Jl[_]].cancel(v)},state:s,steps:o}}const{schedule:Je,cancel:os,state:At,steps:vh}=kN(typeof requestAnimationFrame<"u"?requestAnimationFrame:xn,!0);let _c;function xH(){_c=void 0}const Yt={now:()=>(_c===void 0&&Yt.set(At.isProcessing||Fr.useManualTiming?At.timestamp:performance.now()),_c),set:n=>{_c=n,queueMicrotask(xH)}},FN=n=>e=>typeof e=="string"&&e.startsWith(n),fg=FN("--"),yH=FN("var(--"),pg=n=>yH(n)?bH.test(n.split("/*")[0].trim()):!1,bH=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,yo={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},ja={...yo,transform:n=>kr(0,1,n)},ec={...yo,default:1},xa=n=>Math.round(n*1e5)/1e5,mg=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function vH(n){return n==null}const _H=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,gg=(n,e)=>t=>!!(typeof t=="string"&&_H.test(t)&&t.startsWith(n)||e&&!vH(t)&&Object.prototype.hasOwnProperty.call(t,e)),LN=(n,e,t)=>r=>{if(typeof r!="string")return r;const[s,i,o,a]=r.match(mg);return{[n]:parseFloat(s),[e]:parseFloat(i),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},TH=n=>kr(0,255,n),_h={...yo,transform:n=>Math.round(TH(n))},Us={test:gg("rgb","red"),parse:LN("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+_h.transform(n)+", "+_h.transform(e)+", "+_h.transform(t)+", "+xa(ja.transform(r))+")"};function wH(n){let e="",t="",r="",s="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),s=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),s=n.substring(4,5),e+=e,t+=t,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const hp={test:gg("#"),parse:wH,transform:Us.transform},al=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),jr=al("deg"),tr=al("%"),xe=al("px"),SH=al("vh"),NH=al("vw"),Bb={...tr,parse:n=>tr.parse(n)/100,transform:n=>tr.transform(n*100)},Ri={test:gg("hsl","hue"),parse:LN("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+tr.transform(xa(e))+", "+tr.transform(xa(t))+", "+xa(ja.transform(r))+")"},dt={test:n=>Us.test(n)||hp.test(n)||Ri.test(n),parse:n=>Us.test(n)?Us.parse(n):Ri.test(n)?Ri.parse(n):hp.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Us.transform(n):Ri.transform(n),getAnimatableNone:n=>{const e=dt.parse(n);return e.alpha=0,dt.transform(e)}},AH=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function EH(n){return isNaN(n)&&typeof n=="string"&&(n.match(mg)?.length||0)+(n.match(AH)?.length||0)>0}const IN="number",ON="color",CH="var",RH="var(",kb="${}",MH=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ga(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},s=[];let i=0;const a=e.replace(MH,l=>(dt.test(l)?(r.color.push(i),s.push(ON),t.push(dt.parse(l))):l.startsWith(RH)?(r.var.push(i),s.push(CH),t.push(l)):(r.number.push(i),s.push(IN),t.push(parseFloat(l))),++i,kb)).split(kb);return{values:t,split:a,indexes:r,types:s}}function UN(n){return Ga(n).values}function VN(n){const{split:e,types:t}=Ga(n),r=e.length;return s=>{let i="";for(let o=0;o<r;o++)if(i+=e[o],s[o]!==void 0){const a=t[o];a===IN?i+=xa(s[o]):a===ON?i+=dt.transform(s[o]):i+=s[o]}return i}}const PH=n=>typeof n=="number"?0:dt.test(n)?dt.getAnimatableNone(n):n;function DH(n){const e=UN(n);return VN(n)(e.map(PH))}const as={test:EH,parse:UN,createTransformer:VN,getAnimatableNone:DH};function Th(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function BH({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let s=0,i=0,o=0;if(!e)s=i=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;s=Th(l,a,n+1/3),i=Th(l,a,n),o=Th(l,a,n-1/3)}return{red:Math.round(s*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:r}}function iu(n,e){return t=>t>0?e:n}const rt=(n,e,t)=>n+(e-n)*t,wh=(n,e,t)=>{const r=n*n,s=t*(e*e-r)+r;return s<0?0:Math.sqrt(s)},kH=[hp,Us,Ri],FH=n=>kH.find(e=>e.test(n));function Fb(n){const e=FH(n);if(!e)return!1;let t=e.parse(n);return e===Ri&&(t=BH(t)),t}const Lb=(n,e)=>{const t=Fb(n),r=Fb(e);if(!t||!r)return iu(n,e);const s={...t};return i=>(s.red=wh(t.red,r.red,i),s.green=wh(t.green,r.green,i),s.blue=wh(t.blue,r.blue,i),s.alpha=rt(t.alpha,r.alpha,i),Us.transform(s))},fp=new Set(["none","hidden"]);function LH(n,e){return fp.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function IH(n,e){return t=>rt(n,e,t)}function xg(n){return typeof n=="number"?IH:typeof n=="string"?pg(n)?iu:dt.test(n)?Lb:VH:Array.isArray(n)?jN:typeof n=="object"?dt.test(n)?Lb:OH:iu}function jN(n,e){const t=[...n],r=t.length,s=n.map((i,o)=>xg(i)(i,e[o]));return i=>{for(let o=0;o<r;o++)t[o]=s[o](i);return t}}function OH(n,e){const t={...n,...e},r={};for(const s in t)n[s]!==void 0&&e[s]!==void 0&&(r[s]=xg(n[s])(n[s],e[s]));return s=>{for(const i in r)t[i]=r[i](s);return t}}function UH(n,e){const t=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const i=e.types[s],o=n.indexes[i][r[i]],a=n.values[o]??0;t[s]=a,r[i]++}return t}const VH=(n,e)=>{const t=as.createTransformer(e),r=Ga(n),s=Ga(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?fp.has(n)&&!s.values.length||fp.has(e)&&!r.values.length?LH(n,e):il(jN(UH(r,s),s.values),t):iu(n,e)};function GN(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?rt(n,e,t):xg(n)(n,e)}const jH=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>Je.update(e,t),stop:()=>os(e),now:()=>At.isProcessing?At.timestamp:Yt.now()}},$N=(n,e,t=10)=>{let r="";const s=Math.max(Math.round(e/t),2);for(let i=0;i<s;i++)r+=Math.round(n(i/(s-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},ou=2e4;function yg(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<ou;)e+=t,r=n.next(e);return e>=ou?1/0:e}function GH(n,e=100,t){const r=t({...n,keyframes:[0,e]}),s=Math.min(yg(r),ou);return{type:"keyframes",ease:i=>r.next(s*i).value/e,duration:mn(s)}}const $H=5;function zN(n,e,t){const r=Math.max(e-$H,0);return wN(t-n(r),e-r)}const ot={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Sh=.001;function zH({duration:n=ot.duration,bounce:e=ot.bounce,velocity:t=ot.velocity,mass:r=ot.mass}){let s,i,o=1-e;o=kr(ot.minDamping,ot.maxDamping,o),n=kr(ot.minDuration,ot.maxDuration,mn(n)),o<1?(s=c=>{const u=c*o,d=u*n,h=u-t,f=pp(c,o),p=Math.exp(-d);return Sh-h/f*p},i=c=>{const d=c*o*n,h=d*t+t,f=Math.pow(o,2)*Math.pow(c,2)*n,p=Math.exp(-d),m=pp(Math.pow(c,2),o);return(-s(c)+Sh>0?-1:1)*((h-f)*p)/m}):(s=c=>{const u=Math.exp(-c*n),d=(c-t)*n+1;return-Sh+u*d},i=c=>{const u=Math.exp(-c*n),d=(t-c)*(n*n);return u*d});const a=5/n,l=WH(s,i,a);if(n=er(n),isNaN(l))return{stiffness:ot.stiffness,damping:ot.damping,duration:n};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:o*2*Math.sqrt(r*c),duration:n}}}const HH=12;function WH(n,e,t){let r=t;for(let s=1;s<HH;s++)r=r-n(r)/e(r);return r}function pp(n,e){return n*Math.sqrt(1-e*e)}const qH=["duration","bounce"],XH=["stiffness","damping","mass"];function Ib(n,e){return e.some(t=>n[t]!==void 0)}function KH(n){let e={velocity:ot.velocity,stiffness:ot.stiffness,damping:ot.damping,mass:ot.mass,isResolvedFromDuration:!1,...n};if(!Ib(n,XH)&&Ib(n,qH))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),s=r*r,i=2*kr(.05,1,1-(n.bounce||0))*Math.sqrt(s);e={...e,mass:ot.mass,stiffness:s,damping:i}}else{const t=zH(n);e={...e,...t,mass:ot.mass},e.isResolvedFromDuration=!0}return e}function au(n=ot.visualDuration,e=ot.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:s}=t;const i=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:u,duration:d,velocity:h,isResolvedFromDuration:f}=KH({...t,velocity:-mn(t.velocity||0)}),p=h||0,m=c/(2*Math.sqrt(l*u)),y=o-i,x=mn(Math.sqrt(l/u)),b=Math.abs(y)<5;r||(r=b?ot.restSpeed.granular:ot.restSpeed.default),s||(s=b?ot.restDelta.granular:ot.restDelta.default);let v;if(m<1){const w=pp(x,m);v=T=>{const N=Math.exp(-m*x*T);return o-N*((p+m*x*y)/w*Math.sin(w*T)+y*Math.cos(w*T))}}else if(m===1)v=w=>o-Math.exp(-x*w)*(y+(p+x*y)*w);else{const w=x*Math.sqrt(m*m-1);v=T=>{const N=Math.exp(-m*x*T),S=Math.min(w*T,300);return o-N*((p+m*x*y)*Math.sinh(S)+w*y*Math.cosh(S))/w}}const _={calculatedDuration:f&&d||null,next:w=>{const T=v(w);if(f)a.done=w>=d;else{let N=w===0?p:0;m<1&&(N=w===0?er(p):zN(v,w,T));const S=Math.abs(N)<=r,C=Math.abs(o-T)<=s;a.done=S&&C}return a.value=a.done?o:T,a},toString:()=>{const w=Math.min(yg(_),ou),T=$N(N=>_.next(w*N).value,w,30);return w+"ms "+T},toTransition:()=>{}};return _}au.applyToOptions=n=>{const e=GH(n,100,au);return n.ease=e.ease,n.duration=er(e.duration),n.type="keyframes",n};function mp({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const d=n[0],h={done:!1,value:d},f=S=>a!==void 0&&S<a||l!==void 0&&S>l,p=S=>a===void 0?l:l===void 0||Math.abs(a-S)<Math.abs(l-S)?a:l;let m=t*e;const y=d+m,x=o===void 0?y:o(y);x!==y&&(m=x-d);const b=S=>-m*Math.exp(-S/r),v=S=>x+b(S),_=S=>{const C=b(S),D=v(S);h.done=Math.abs(C)<=c,h.value=h.done?x:D};let w,T;const N=S=>{f(h.value)&&(w=S,T=au({keyframes:[h.value,p(h.value)],velocity:zN(v,S,h.value),damping:s,stiffness:i,restDelta:c,restSpeed:u}))};return N(0),{calculatedDuration:null,next:S=>{let C=!1;return!T&&w===void 0&&(C=!0,_(S),N(S)),w!==void 0&&S>=w?T.next(S-w):(!C&&_(S),h)}}}function YH(n,e,t){const r=[],s=t||Fr.mix||GN,i=n.length-1;for(let o=0;o<i;o++){let a=s(n[o],n[o+1]);if(e){const l=Array.isArray(e)?e[o]||xn:e;a=il(l,a)}r.push(a)}return r}function QH(n,e,{clamp:t=!0,ease:r,mixer:s}={}){const i=n.length;if(lg(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[i-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=YH(e,r,s),l=a.length,c=u=>{if(o&&u<n[0])return e[0];let d=0;if(l>1)for(;d<n.length-2&&!(u<n[d+1]);d++);const h=Va(n[d],n[d+1],u);return a[d](h)};return t?u=>c(kr(n[0],n[i-1],u)):c}function ZH(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const s=Va(0,e,r);n.push(rt(t,1,s))}}function JH(n){const e=[0];return ZH(e,n.length-1),e}function e7(n,e){return n.map(t=>t*e)}function t7(n,e){return n.map(()=>e||DN).splice(0,n.length-1)}function ya({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const s=hH(r)?r.map(Db):Db(r),i={done:!1,value:e[0]},o=e7(t&&t.length===e.length?t:JH(e),n),a=QH(o,e,{ease:Array.isArray(s)?s:t7(e,s)});return{calculatedDuration:n,next:l=>(i.value=a(l),i.done=l>=n,i)}}const n7=n=>n!==null;function bg(n,{repeat:e,repeatType:t="loop"},r,s=1){const i=n.filter(n7),a=s<0||e&&t!=="loop"&&e%2===1?0:i.length-1;return!a||r===void 0?i[a]:r}const r7={decay:mp,inertia:mp,tween:ya,keyframes:ya,spring:au};function HN(n){typeof n.type=="string"&&(n.type=r7[n.type])}class vg{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const s7=n=>n/100;class _g extends vg{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==Yt.now()&&this.tick(Yt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;HN(e);const{type:t=ya,repeat:r=0,repeatDelay:s=0,repeatType:i,velocity:o=0}=e;let{keyframes:a}=e;const l=t||ya;l!==ya&&typeof a[0]!="number"&&(this.mixKeyframes=il(s7,GN(a[0],a[1])),a=[0,100]);const c=l({...e,keyframes:a});i==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-o})),c.calculatedDuration===null&&(c.calculatedDuration=yg(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+s,this.totalDuration=this.resolvedDuration*(r+1)-s,this.generator=c}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:s,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:c=0,keyframes:u,repeat:d,repeatType:h,repeatDelay:f,type:p,onUpdate:m,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const x=this.currentTime-c*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?x<0:x>s;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let v=this.currentTime,_=r;if(d){const S=Math.min(this.currentTime,s)/a;let C=Math.floor(S),D=S%1;!D&&S>=1&&(D=1),D===1&&C--,C=Math.min(C,d+1),!!(C%2)&&(h==="reverse"?(D=1-D,f&&(D-=f/a)):h==="mirror"&&(_=o)),v=kr(0,1,D)*a}const w=b?{done:!1,value:u[0]}:_.next(v);i&&(w.value=i(w.value));let{done:T}=w;!b&&l!==null&&(T=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const N=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return N&&p!==mp&&(w.value=bg(u,this.options,y,this.speed)),m&&m(w.value),N&&this.finish(),w}then(e,t){return this.finished.then(e,t)}get duration(){return mn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+mn(e)}get time(){return mn(this.currentTime)}set time(e){e=er(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Yt.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=mn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=jH,startTime:t}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Yt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function i7(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const Vs=n=>n*180/Math.PI,gp=n=>{const e=Vs(Math.atan2(n[1],n[0]));return xp(e)},o7={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:gp,rotateZ:gp,skewX:n=>Vs(Math.atan(n[1])),skewY:n=>Vs(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},xp=n=>(n=n%360,n<0&&(n+=360),n),Ob=gp,Ub=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),Vb=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),a7={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Ub,scaleY:Vb,scale:n=>(Ub(n)+Vb(n))/2,rotateX:n=>xp(Vs(Math.atan2(n[6],n[5]))),rotateY:n=>xp(Vs(Math.atan2(-n[2],n[0]))),rotateZ:Ob,rotate:Ob,skewX:n=>Vs(Math.atan(n[4])),skewY:n=>Vs(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function yp(n){return n.includes("scale")?1:0}function bp(n,e){if(!n||n==="none")return yp(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,s;if(t)r=a7,s=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=o7,s=a}if(!s)return yp(e);const i=r[e],o=s[1].split(",").map(c7);return typeof i=="function"?i(o):o[i]}const l7=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return bp(t,e)};function c7(n){return parseFloat(n.trim())}const bo=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],vo=new Set(bo),jb=n=>n===yo||n===xe,u7=new Set(["x","y","z"]),d7=bo.filter(n=>!u7.has(n));function h7(n){const e=[];return d7.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Xs={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>bp(e,"x"),y:(n,{transform:e})=>bp(e,"y")};Xs.translateX=Xs.x;Xs.translateY=Xs.y;const Ks=new Set;let vp=!1,_p=!1,Tp=!1;function WN(){if(_p){const n=Array.from(Ks).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const s=h7(r);s.length&&(t.set(r,s),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=t.get(r);s&&s.forEach(([i,o])=>{r.getValue(i)?.set(o)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}_p=!1,vp=!1,Ks.forEach(n=>n.complete(Tp)),Ks.clear()}function qN(){Ks.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(_p=!0)})}function f7(){Tp=!0,qN(),WN(),Tp=!1}class Tg{constructor(e,t,r,s,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=s,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Ks.add(this),vp||(vp=!0,Je.read(qN),Je.resolveKeyframes(WN))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:s}=this;if(e[0]===null){const i=s?.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(r&&t){const a=r.readValue(t,o);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=o),s&&i===void 0&&s.set(e[0])}i7(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Ks.delete(this)}cancel(){this.state==="scheduled"&&(Ks.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const p7=n=>n.startsWith("--");function m7(n,e,t){p7(e)?n.style.setProperty(e,t):n.style[e]=t}const g7=cg(()=>window.ScrollTimeline!==void 0),x7={};function y7(n,e){const t=cg(n);return()=>x7[e]??t()}const XN=y7(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ra=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,Gb={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ra([0,.65,.55,1]),circOut:ra([.55,0,1,.45]),backIn:ra([.31,.01,.66,-.59]),backOut:ra([.33,1.53,.69,.99])};function KN(n,e){if(n)return typeof n=="function"?XN()?$N(n,e):"ease-out":BN(n)?ra(n):Array.isArray(n)?n.map(t=>KN(t,e)||Gb.easeOut):Gb[n]}function b7(n,e,t,{delay:r=0,duration:s=300,repeat:i=0,repeatType:o="loop",ease:a="easeOut",times:l}={},c=void 0){const u={[e]:t};l&&(u.offset=l);const d=KN(a,s);Array.isArray(d)&&(u.easing=d);const h={delay:r,duration:s,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return c&&(h.pseudoElement=c),n.animate(u,h)}function YN(n){return typeof n=="function"&&"applyToOptions"in n}function v7({type:n,...e}){return YN(n)&&XN()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class _7 extends vg{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:s,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,lg(typeof e.type!="string");const c=v7(e);this.animation=b7(t,r,s,c,i),c.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const u=bg(s,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(u):m7(t,r,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return mn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+mn(e)}get time(){return mn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=er(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&g7()?(this.animation.timeline=e,xn):t(this)}}const QN={anticipate:RN,backInOut:CN,circInOut:PN};function T7(n){return n in QN}function w7(n){typeof n.ease=="string"&&T7(n.ease)&&(n.ease=QN[n.ease])}const $b=10;class S7 extends _7{constructor(e){w7(e),HN(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:s,element:i,...o}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new _g({...o,autoplay:!1}),l=er(this.finishedTime??this.time);t.setWithVelocity(a.sample(l-$b).value,a.sample(l).value,$b),a.stop()}}const zb=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(as.test(n)||n==="0")&&!n.startsWith("url("));function N7(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function A7(n,e,t,r){const s=n[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const i=n[n.length-1],o=zb(s,e),a=zb(i,e);return!o||!a?!1:N7(n)||(t==="spring"||YN(t))&&r}function wp(n){n.duration=0,n.type="keyframes"}const E7=new Set(["opacity","clipPath","filter","transform"]),C7=cg(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function R7(n){const{motionValue:e,name:t,repeatDelay:r,repeatType:s,damping:i,type:o}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=e.owner.getProps();return C7()&&t&&E7.has(t)&&(t!=="transform"||!c)&&!l&&!r&&s!=="mirror"&&i!==0&&o!=="inertia"}const M7=40;class P7 extends vg{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:l,motionValue:c,element:u,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Yt.now();const h={autoplay:e,delay:t,type:r,repeat:s,repeatDelay:i,repeatType:o,name:l,motionValue:c,element:u,...d},f=u?.KeyframeResolver||Tg;this.keyframeResolver=new f(a,(p,m,y)=>this.onKeyframesResolved(p,m,h,!y),l,c,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,s){this.keyframeResolver=void 0;const{name:i,type:o,velocity:a,delay:l,isHandoff:c,onUpdate:u}=r;this.resolvedAt=Yt.now(),A7(e,i,o,a)||((Fr.instantAnimations||!l)&&u?.(bg(e,r,t)),e[0]=e[e.length-1],wp(r),r.repeat=0);const h={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>M7?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},f=!c&&R7(h)?new S7({...h,element:h.motionValue.owner.current}):new _g(h);f.finished.then(()=>this.notifyFinished()).catch(xn),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),f7()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const D7=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function B7(n){const e=D7.exec(n);if(!e)return[,];const[,t,r,s]=e;return[`--${t??r}`,s]}function ZN(n,e,t=1){const[r,s]=B7(n);if(!r)return;const i=window.getComputedStyle(e).getPropertyValue(r);if(i){const o=i.trim();return vN(o)?parseFloat(o):o}return pg(s)?ZN(s,e,t+1):s}function wg(n,e){return n?.[e]??n?.default??n}const JN=new Set(["width","height","top","left","right","bottom",...bo]),k7={test:n=>n==="auto",parse:n=>n},eA=n=>e=>e.test(n),tA=[yo,xe,tr,jr,NH,SH,k7],Hb=n=>tA.find(eA(n));function F7(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||TN(n):!0}const L7=new Set(["brightness","contrast","saturate","opacity"]);function I7(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(mg)||[];if(!r)return n;const s=t.replace(r,"");let i=L7.has(e)?1:0;return r!==t&&(i*=100),e+"("+i+s+")"}const O7=/\b([a-z-]*)\(.*?\)/gu,Sp={...as,getAnimatableNone:n=>{const e=n.match(O7);return e?e.map(I7).join(" "):n}},Wb={...yo,transform:Math.round},U7={rotate:jr,rotateX:jr,rotateY:jr,rotateZ:jr,scale:ec,scaleX:ec,scaleY:ec,scaleZ:ec,skew:jr,skewX:jr,skewY:jr,distance:xe,translateX:xe,translateY:xe,translateZ:xe,x:xe,y:xe,z:xe,perspective:xe,transformPerspective:xe,opacity:ja,originX:Bb,originY:Bb,originZ:xe},Sg={borderWidth:xe,borderTopWidth:xe,borderRightWidth:xe,borderBottomWidth:xe,borderLeftWidth:xe,borderRadius:xe,radius:xe,borderTopLeftRadius:xe,borderTopRightRadius:xe,borderBottomRightRadius:xe,borderBottomLeftRadius:xe,width:xe,maxWidth:xe,height:xe,maxHeight:xe,top:xe,right:xe,bottom:xe,left:xe,padding:xe,paddingTop:xe,paddingRight:xe,paddingBottom:xe,paddingLeft:xe,margin:xe,marginTop:xe,marginRight:xe,marginBottom:xe,marginLeft:xe,backgroundPositionX:xe,backgroundPositionY:xe,...U7,zIndex:Wb,fillOpacity:ja,strokeOpacity:ja,numOctaves:Wb},V7={...Sg,color:dt,backgroundColor:dt,outlineColor:dt,fill:dt,stroke:dt,borderColor:dt,borderTopColor:dt,borderRightColor:dt,borderBottomColor:dt,borderLeftColor:dt,filter:Sp,WebkitFilter:Sp},nA=n=>V7[n];function rA(n,e){let t=nA(n);return t!==Sp&&(t=as),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const j7=new Set(["auto","none","0"]);function G7(n,e,t){let r=0,s;for(;r<n.length&&!s;){const i=n[r];typeof i=="string"&&!j7.has(i)&&Ga(i).values.length&&(s=n[r]),r++}if(s&&t)for(const i of e)n[i]=rA(t,s)}class $7 extends Tg{constructor(e,t,r,s,i){super(e,t,r,s,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),pg(c))){const u=ZN(c,t.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!JN.has(r)||e.length!==2)return;const[s,i]=e,o=Hb(s),a=Hb(i);if(o!==a)if(jb(o)&&jb(a))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else Xs[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let s=0;s<e.length;s++)(e[s]===null||F7(e[s]))&&r.push(s);r.length&&G7(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Xs[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const s=t[t.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const s=e.getValue(t);s&&s.jump(this.measuredOrigin,!1);const i=r.length-1,o=r[i];r[i]=Xs[t](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,l])=>{e.getValue(a).set(l)}),this.resolveNoneKeyframes()}}function z7(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const s=t?.[n]??r.querySelectorAll(n);return s?Array.from(s):[]}return Array.from(n)}const sA=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function iA(n){return _N(n)&&"offsetHeight"in n}const qb=30,H7=n=>!isNaN(parseFloat(n));class W7{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const s=Yt.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Yt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=H7(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new ug);const r=this.events[e].add(t);return e==="change"?()=>{r(),Je.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Yt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>qb)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,qb);return wN(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ao(n,e){return new W7(n,e)}const{schedule:Ng}=kN(queueMicrotask,!1),Sn={x:!1,y:!1};function oA(){return Sn.x||Sn.y}function q7(n){return n==="x"||n==="y"?Sn[n]?null:(Sn[n]=!0,()=>{Sn[n]=!1}):Sn.x||Sn.y?null:(Sn.x=Sn.y=!0,()=>{Sn.x=Sn.y=!1})}function aA(n,e){const t=z7(n),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[t,s,()=>r.abort()]}function Xb(n){return!(n.pointerType==="touch"||oA())}function X7(n,e,t={}){const[r,s,i]=aA(n,t),o=a=>{if(!Xb(a))return;const{target:l}=a,c=e(l,a);if(typeof c!="function"||!l)return;const u=d=>{Xb(d)&&(c(d),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,s)};return r.forEach(a=>{a.addEventListener("pointerenter",o,s)}),i}const lA=(n,e)=>e?n===e?!0:lA(n,e.parentElement):!1,Ag=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,K7=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Y7(n){return K7.has(n.tagName)||n.tabIndex!==-1}const Tc=new WeakSet;function Kb(n){return e=>{e.key==="Enter"&&n(e)}}function Nh(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Q7=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=Kb(()=>{if(Tc.has(t))return;Nh(t,"down");const s=Kb(()=>{Nh(t,"up")}),i=()=>Nh(t,"cancel");t.addEventListener("keyup",s,e),t.addEventListener("blur",i,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function Yb(n){return Ag(n)&&!oA()}function Z7(n,e,t={}){const[r,s,i]=aA(n,t),o=a=>{const l=a.currentTarget;if(!Yb(a))return;Tc.add(l);const c=e(l,a),u=(f,p)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),Tc.has(l)&&Tc.delete(l),Yb(f)&&typeof c=="function"&&c(f,{success:p})},d=f=>{u(f,l===window||l===document||t.useGlobalTarget||lA(l,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",d,s),window.addEventListener("pointercancel",h,s)};return r.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",o,s),iA(a)&&(a.addEventListener("focus",c=>Q7(c,s)),!Y7(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),i}function cA(n){return _N(n)&&"ownerSVGElement"in n}function J7(n){return cA(n)&&n.tagName==="svg"}const Ft=n=>!!(n&&n.getVelocity),eW=[...tA,dt,as],tW=n=>eW.find(eA(n)),Eg=E.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function Qb(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function nW(...n){return e=>{let t=!1;const r=n.map(s=>{const i=Qb(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():Qb(n[s],null)}}}}function rW(...n){return E.useCallback(nW(...n),n)}class sW extends E.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,s=iA(r)&&r.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=s-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function iW({children:n,isPresent:e,anchorX:t,root:r}){const s=E.useId(),i=E.useRef(null),o=E.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=E.useContext(Eg),l=rW(i,n?.ref);return E.useInsertionEffect(()=>{const{width:c,height:u,top:d,left:h,right:f}=o.current;if(e||!i.current||!c||!u)return;const p=t==="left"?`left: ${h}`:`right: ${f}`;i.current.dataset.motionPopId=s;const m=document.createElement("style");a&&(m.nonce=a);const y=r??document.head;return y.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${u}px !important;
            ${p}px !important;
            top: ${d}px !important;
          }
        `),()=>{y.contains(m)&&y.removeChild(m)}},[e]),g.jsx(sW,{isPresent:e,childRef:i,sizeRef:o,children:E.cloneElement(n,{ref:l})})}const oW=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:s,presenceAffectsLayout:i,mode:o,anchorX:a,root:l})=>{const c=sg(aW),u=E.useId();let d=!0,h=E.useMemo(()=>(d=!1,{id:u,initial:e,isPresent:t,custom:s,onExitComplete:f=>{c.set(f,!0);for(const p of c.values())if(!p)return;r&&r()},register:f=>(c.set(f,!1),()=>c.delete(f))}),[t,c,r]);return i&&d&&(h={...h}),E.useMemo(()=>{c.forEach((f,p)=>c.set(p,!1))},[t]),E.useEffect(()=>{!t&&!c.size&&r&&r()},[t]),o==="popLayout"&&(n=g.jsx(iW,{isPresent:t,anchorX:a,root:l,children:n})),g.jsx(Ku.Provider,{value:h,children:n})};function aW(){return new Map}function uA(n=!0){const e=E.useContext(Ku);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:s}=e,i=E.useId();E.useEffect(()=>{if(n)return s(i)},[n]);const o=E.useCallback(()=>n&&r&&r(i),[i,r,n]);return!t&&r?[!1,o]:[!0]}const tc=n=>n.key||"";function Zb(n){const e=[];return E.Children.forEach(n,t=>{E.isValidElement(t)&&e.push(t)}),e}const dA=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:i="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[c,u]=uA(o),d=E.useMemo(()=>Zb(n),[n]),h=o&&!c?[]:d.map(tc),f=E.useRef(!0),p=E.useRef(d),m=sg(()=>new Map),[y,x]=E.useState(d),[b,v]=E.useState(d);bN(()=>{f.current=!1,p.current=d;for(let T=0;T<b.length;T++){const N=tc(b[T]);h.includes(N)?m.delete(N):m.get(N)!==!0&&m.set(N,!1)}},[b,h.length,h.join("-")]);const _=[];if(d!==y){let T=[...d];for(let N=0;N<b.length;N++){const S=b[N],C=tc(S);h.includes(C)||(T.splice(N,0,S),_.push(S))}return i==="wait"&&_.length&&(T=_),v(Zb(T)),x(d),null}const{forceRender:w}=E.useContext(rg);return g.jsx(g.Fragment,{children:b.map(T=>{const N=tc(T),S=o&&!c?!1:d===b||h.includes(N),C=()=>{if(m.has(N))m.set(N,!0);else return;let D=!0;m.forEach(F=>{F||(D=!1)}),D&&(w?.(),v(p.current),o&&u?.(),r&&r())};return g.jsx(oW,{isPresent:S,initial:!f.current||t?void 0:!1,custom:e,presenceAffectsLayout:s,mode:i,root:l,onExitComplete:S?void 0:C,anchorX:a,children:T},N)})})},hA=E.createContext({strict:!1}),Jb={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},lo={};for(const n in Jb)lo[n]={isEnabled:e=>Jb[n].some(t=>!!e[t])};function lW(n){for(const e in n)lo[e]={...lo[e],...n[e]}}const cW=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function lu(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||cW.has(n)}let fA=n=>!lu(n);function uW(n){typeof n=="function"&&(fA=e=>e.startsWith("on")?!lu(e):n(e))}try{uW(require("@emotion/is-prop-valid").default)}catch{}function dW(n,e,t){const r={};for(const s in n)s==="values"&&typeof n.values=="object"||(fA(s)||t===!0&&lu(s)||!e&&!lu(s)||n.draggable&&s.startsWith("onDrag"))&&(r[s]=n[s]);return r}const Yu=E.createContext({});function Qu(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function $a(n){return typeof n=="string"||Array.isArray(n)}const Cg=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Rg=["initial",...Cg];function Zu(n){return Qu(n.animate)||Rg.some(e=>$a(n[e]))}function pA(n){return!!(Zu(n)||n.variants)}function hW(n,e){if(Zu(n)){const{initial:t,animate:r}=n;return{initial:t===!1||$a(t)?t:void 0,animate:$a(r)?r:void 0}}return n.inherit!==!1?e:{}}function fW(n){const{initial:e,animate:t}=hW(n,E.useContext(Yu));return E.useMemo(()=>({initial:e,animate:t}),[ev(e),ev(t)])}function ev(n){return Array.isArray(n)?n.join(" "):n}const za={};function pW(n){for(const e in n)za[e]=n[e],fg(e)&&(za[e].isCSSVariable=!0)}function mA(n,{layout:e,layoutId:t}){return vo.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!za[n]||n==="opacity")}const mW={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},gW=bo.length;function xW(n,e,t){let r="",s=!0;for(let i=0;i<gW;i++){const o=bo[i],a=n[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||t){const c=sA(a,Sg[o]);if(!l){s=!1;const u=mW[o]||o;r+=`${u}(${c}) `}t&&(e[o]=c)}}return r=r.trim(),t?r=t(e,s?"":r):s&&(r="none"),r}function Mg(n,e,t){const{style:r,vars:s,transformOrigin:i}=n;let o=!1,a=!1;for(const l in e){const c=e[l];if(vo.has(l)){o=!0;continue}else if(fg(l)){s[l]=c;continue}else{const u=sA(c,Sg[l]);l.startsWith("origin")?(a=!0,i[l]=u):r[l]=u}}if(e.transform||(o||t?r.transform=xW(e,n.transform,t):r.transform&&(r.transform="none")),a){const{originX:l="50%",originY:c="50%",originZ:u=0}=i;r.transformOrigin=`${l} ${c} ${u}`}}const Pg=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function gA(n,e,t){for(const r in e)!Ft(e[r])&&!mA(r,t)&&(n[r]=e[r])}function yW({transformTemplate:n},e){return E.useMemo(()=>{const t=Pg();return Mg(t,e,n),Object.assign({},t.vars,t.style)},[e])}function bW(n,e){const t=n.style||{},r={};return gA(r,t,n),Object.assign(r,yW(n,e)),r}function vW(n,e){const t={},r=bW(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const _W={offset:"stroke-dashoffset",array:"stroke-dasharray"},TW={offset:"strokeDashoffset",array:"strokeDasharray"};function wW(n,e,t=1,r=0,s=!0){n.pathLength=1;const i=s?_W:TW;n[i.offset]=xe.transform(-r);const o=xe.transform(e),a=xe.transform(t);n[i.array]=`${o} ${a}`}function xA(n,{attrX:e,attrY:t,attrScale:r,pathLength:s,pathSpacing:i=1,pathOffset:o=0,...a},l,c,u){if(Mg(n,a,c),l){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:d,style:h}=n;d.transform&&(h.transform=d.transform,delete d.transform),(h.transform||d.transformOrigin)&&(h.transformOrigin=d.transformOrigin??"50% 50%",delete d.transformOrigin),h.transform&&(h.transformBox=u?.transformBox??"fill-box",delete d.transformBox),e!==void 0&&(d.x=e),t!==void 0&&(d.y=t),r!==void 0&&(d.scale=r),s!==void 0&&wW(d,s,i,o,!1)}const yA=()=>({...Pg(),attrs:{}}),bA=n=>typeof n=="string"&&n.toLowerCase()==="svg";function SW(n,e,t,r){const s=E.useMemo(()=>{const i=yA();return xA(i,e,bA(r),n.transformTemplate,n.style),{...i.attrs,style:{...i.style}}},[e]);if(n.style){const i={};gA(i,n.style,n),s.style={...i,...s.style}}return s}const NW=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Dg(n){return typeof n!="string"||n.includes("-")?!1:!!(NW.indexOf(n)>-1||/[A-Z]/u.test(n))}function AW(n,e,t,{latestValues:r},s,i=!1){const a=(Dg(n)?SW:vW)(e,r,s,n),l=dW(e,typeof n=="string",i),c=n!==E.Fragment?{...l,...a,ref:t}:{},{children:u}=e,d=E.useMemo(()=>Ft(u)?u.get():u,[u]);return E.createElement(n,{...c,children:d})}function tv(n){const e=[{},{}];return n?.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function Bg(n,e,t,r){if(typeof e=="function"){const[s,i]=tv(r);e=e(t!==void 0?t:n.custom,s,i)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[s,i]=tv(r);e=e(t!==void 0?t:n.custom,s,i)}return e}function wc(n){return Ft(n)?n.get():n}function EW({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,s){return{latestValues:CW(t,r,s,n),renderState:e()}}function CW(n,e,t,r){const s={},i=r(n,{});for(const h in i)s[h]=wc(i[h]);let{initial:o,animate:a}=n;const l=Zu(n),c=pA(n);e&&c&&!l&&n.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=t?t.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!Qu(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const p=Bg(n,h[f]);if(p){const{transitionEnd:m,transition:y,...x}=p;for(const b in x){let v=x[b];if(Array.isArray(v)){const _=u?v.length-1:0;v=v[_]}v!==null&&(s[b]=v)}for(const b in m)s[b]=m[b]}}}return s}const vA=n=>(e,t)=>{const r=E.useContext(Yu),s=E.useContext(Ku),i=()=>EW(n,e,r,s);return t?i():sg(i)};function kg(n,e,t){const{style:r}=n,s={};for(const i in r)(Ft(r[i])||e.style&&Ft(e.style[i])||mA(i,n)||t?.getValue(i)?.liveStyle!==void 0)&&(s[i]=r[i]);return s}const RW=vA({scrapeMotionValuesFromProps:kg,createRenderState:Pg});function _A(n,e,t){const r=kg(n,e,t);for(const s in n)if(Ft(n[s])||Ft(e[s])){const i=bo.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[i]=n[s]}return r}const MW=vA({scrapeMotionValuesFromProps:_A,createRenderState:yA}),PW=Symbol.for("motionComponentSymbol");function Mi(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function DW(n,e,t){return E.useCallback(r=>{r&&n.onMount&&n.onMount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):Mi(t)&&(t.current=r))},[e])}const Fg=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),BW="framerAppearId",TA="data-"+Fg(BW),wA=E.createContext({});function kW(n,e,t,r,s){const{visualElement:i}=E.useContext(Yu),o=E.useContext(hA),a=E.useContext(Ku),l=E.useContext(Eg).reducedMotion,c=E.useRef(null);r=r||o.renderer,!c.current&&r&&(c.current=r(n,{visualState:e,parent:i,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const u=c.current,d=E.useContext(wA);u&&!u.projection&&s&&(u.type==="html"||u.type==="svg")&&FW(c.current,t,s,d);const h=E.useRef(!1);E.useInsertionEffect(()=>{u&&h.current&&u.update(t,a)});const f=t[TA],p=E.useRef(!!f&&!window.MotionHandoffIsComplete?.(f)&&window.MotionHasOptimisedAnimation?.(f));return bN(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),p.current&&u.animationState&&u.animationState.animateChanges())}),E.useEffect(()=>{u&&(!p.current&&u.animationState&&u.animationState.animateChanges(),p.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(f)}),p.current=!1),u.enteringChildren=void 0)}),u}function FW(n,e,t,r){const{layoutId:s,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:SA(n.parent)),n.projection.setOptions({layoutId:s,layout:i,alwaysMeasureLayout:!!o||a&&Mi(a),visualElement:n,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:u,layoutScroll:l,layoutRoot:c})}function SA(n){if(n)return n.options.allowProjection!==!1?n.projection:SA(n.parent)}function Ah(n,{forwardMotionProps:e=!1}={},t,r){t&&lW(t);const s=Dg(n)?MW:RW;function i(a,l){let c;const u={...E.useContext(Eg),...a,layoutId:LW(a)},{isStatic:d}=u,h=fW(a),f=s(a,d);if(!d&&ig){IW();const p=OW(u);c=p.MeasureLayout,h.visualElement=kW(n,f,u,r,p.ProjectionNode)}return g.jsxs(Yu.Provider,{value:h,children:[c&&h.visualElement?g.jsx(c,{visualElement:h.visualElement,...u}):null,AW(n,a,DW(f,h.visualElement,l),f,d,e)]})}i.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const o=E.forwardRef(i);return o[PW]=n,o}function LW({layoutId:n}){const e=E.useContext(rg).id;return e&&n!==void 0?e+"-"+n:n}function IW(n,e){E.useContext(hA).strict}function OW(n){const{drag:e,layout:t}=lo;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function UW(n,e){if(typeof Proxy>"u")return Ah;const t=new Map,r=(i,o)=>Ah(i,o,n,e),s=(i,o)=>r(i,o);return new Proxy(s,{get:(i,o)=>o==="create"?r:(t.has(o)||t.set(o,Ah(o,void 0,n,e)),t.get(o))})}function NA({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function VW({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function jW(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function Eh(n){return n===void 0||n===1}function Np({scale:n,scaleX:e,scaleY:t}){return!Eh(n)||!Eh(e)||!Eh(t)}function Rs(n){return Np(n)||AA(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function AA(n){return nv(n.x)||nv(n.y)}function nv(n){return n&&n!=="0%"}function cu(n,e,t){const r=n-t,s=e*r;return t+s}function rv(n,e,t,r,s){return s!==void 0&&(n=cu(n,s,r)),cu(n,t,r)+e}function Ap(n,e=0,t=1,r,s){n.min=rv(n.min,e,t,r,s),n.max=rv(n.max,e,t,r,s)}function EA(n,{x:e,y:t}){Ap(n.x,e.translate,e.scale,e.originPoint),Ap(n.y,t.translate,t.scale,t.originPoint)}const sv=.999999999999,iv=1.0000000000001;function GW(n,e,t,r=!1){const s=t.length;if(!s)return;e.x=e.y=1;let i,o;for(let a=0;a<s;a++){i=t[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Di(n,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,EA(n,o)),r&&Rs(i.latestValues)&&Di(n,i.latestValues))}e.x<iv&&e.x>sv&&(e.x=1),e.y<iv&&e.y>sv&&(e.y=1)}function Pi(n,e){n.min=n.min+e,n.max=n.max+e}function ov(n,e,t,r,s=.5){const i=rt(n.min,n.max,s);Ap(n,e,t,i,r)}function Di(n,e){ov(n.x,e.x,e.scaleX,e.scale,e.originX),ov(n.y,e.y,e.scaleY,e.scale,e.originY)}function CA(n,e){return NA(jW(n.getBoundingClientRect(),e))}function $W(n,e,t){const r=CA(n,t),{scroll:s}=e;return s&&(Pi(r.x,s.offset.x),Pi(r.y,s.offset.y)),r}const av=()=>({translate:0,scale:1,origin:0,originPoint:0}),Bi=()=>({x:av(),y:av()}),lv=()=>({min:0,max:0}),bt=()=>({x:lv(),y:lv()}),Ep={current:null},RA={current:!1};function zW(){if(RA.current=!0,!!ig)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>Ep.current=n.matches;n.addEventListener("change",e),e()}else Ep.current=!1}const HW=new WeakMap;function WW(n,e,t){for(const r in e){const s=e[r],i=t[r];if(Ft(s))n.addValue(r,s);else if(Ft(i))n.addValue(r,ao(s,{owner:n}));else if(i!==s)if(n.hasValue(r)){const o=n.getValue(r);o.liveStyle===!0?o.jump(s):o.hasAnimated||o.set(s)}else{const o=n.getStaticValue(r);n.addValue(r,ao(o!==void 0?o:s,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const cv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qW{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Tg,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=Yt.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Je.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=Zu(t),this.isVariantNode=pA(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const h in d){const f=d[h];l[h]!==void 0&&Ft(f)&&f.set(l[h])}}mount(e){this.current=e,HW.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),RA.current||zW(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Ep.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),os(this.notifyUpdate),os(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=vo.has(e);r&&this.onBindTransform&&this.onBindTransform();const s=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Je.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{s(),i&&i(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in lo){const t=lo[e];if(!t)continue;const{isEnabled:r,Feature:s}=t;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):bt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<cv.length;r++){const s=cv[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const i="on"+s,o=e[i];o&&(this.propEventSubscriptions[s]=this.on(s,o))}this.prevMotionValues=WW(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=ao(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(vN(r)||TN(r))?r=parseFloat(r):!tW(r)&&as.test(t)&&(r=rA(e,t)),this.setBaseTarget(e,Ft(r)?r.get():r)),Ft(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const i=Bg(this.props,t,this.presenceContext?.custom);i&&(r=i[e])}if(t&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!Ft(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new ug),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){Ng.render(this.render)}}class MA extends qW{constructor(){super(...arguments),this.KeyframeResolver=$7}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ft(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function PA(n,{style:e,vars:t},r,s){const i=n.style;let o;for(o in e)i[o]=e[o];s?.applyProjectionStyles(i,r);for(o in t)i.setProperty(o,t[o])}function XW(n){return window.getComputedStyle(n)}class KW extends MA{constructor(){super(...arguments),this.type="html",this.renderInstance=PA}readValueFromInstance(e,t){if(vo.has(t))return this.projection?.isProjecting?yp(t):l7(e,t);{const r=XW(e),s=(fg(t)?r.getPropertyValue(t):r[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return CA(e,t)}build(e,t,r){Mg(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return kg(e,t,r)}}const DA=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function YW(n,e,t,r){PA(n,e,void 0,r);for(const s in e.attrs)n.setAttribute(DA.has(s)?s:Fg(s),e.attrs[s])}class QW extends MA{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=bt}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(vo.has(t)){const r=nA(t);return r&&r.default||0}return t=DA.has(t)?t:Fg(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return _A(e,t,r)}build(e,t,r){xA(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,s){YW(e,t,r,s)}mount(e){this.isSVGTag=bA(e.tagName),super.mount(e)}}const ZW=(n,e)=>Dg(n)?new QW(e):new KW(e,{allowProjection:n!==E.Fragment});function $i(n,e,t){const r=n.getProps();return Bg(r,e,t!==void 0?t:r.custom,n)}const Cp=n=>Array.isArray(n);function JW(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,ao(t))}function eq(n){return Cp(n)?n[n.length-1]||0:n}function tq(n,e){const t=$i(n,e);let{transitionEnd:r={},transition:s={},...i}=t||{};i={...i,...r};for(const o in i){const a=eq(i[o]);JW(n,o,a)}}function nq(n){return!!(Ft(n)&&n.add)}function Rp(n,e){const t=n.getValue("willChange");if(nq(t))return t.add(e);if(!t&&Fr.WillChange){const r=new Fr.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function BA(n){return n.props[TA]}const rq=n=>n!==null;function sq(n,{repeat:e,repeatType:t="loop"},r){const s=n.filter(rq),i=e&&t!=="loop"&&e%2===1?0:s.length-1;return s[i]}const iq={type:"spring",stiffness:500,damping:25,restSpeed:10},oq=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),aq={type:"keyframes",duration:.8},lq={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},cq=(n,{keyframes:e})=>e.length>2?aq:vo.has(n)?n.startsWith("scale")?oq(e[1]):iq:lq;function uq({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:s,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const Lg=(n,e,t,r={},s,i)=>o=>{const a=wg(r,n)||{},l=a.delay||r.delay||0;let{elapsed:c=0}=r;c=c-er(l);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-c,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:i?void 0:s};uq(a)||Object.assign(u,cq(n,u)),u.duration&&(u.duration=er(u.duration)),u.repeatDelay&&(u.repeatDelay=er(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(wp(u),u.delay===0&&(d=!0)),(Fr.instantAnimations||Fr.skipAnimations)&&(d=!0,wp(u),u.delay=0),u.allowFlatten=!a.type&&!a.ease,d&&!i&&e.get()!==void 0){const h=sq(u.keyframes,a);if(h!==void 0){Je.update(()=>{u.onUpdate(h),u.onComplete()});return}}return a.isSync?new _g(u):new P7(u)};function dq({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function kA(n,e,{delay:t=0,transitionOverride:r,type:s}={}){let{transition:i=n.getDefaultTransition(),transitionEnd:o,...a}=e;r&&(i=r);const l=[],c=s&&n.animationState&&n.animationState.getState()[s];for(const u in a){const d=n.getValue(u,n.latestValues[u]??null),h=a[u];if(h===void 0||c&&dq(c,u))continue;const f={delay:t,...wg(i||{},u)},p=d.get();if(p!==void 0&&!d.isAnimating&&!Array.isArray(h)&&h===p&&!f.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){const x=BA(n);if(x){const b=window.MotionHandoffAnimation(x,u,Je);b!==null&&(f.startTime=b,m=!0)}}Rp(n,u),d.start(Lg(u,d,h,n.shouldReduceMotion&&JN.has(u)?{type:!1}:f,n,m));const y=d.animation;y&&l.push(y)}return o&&Promise.all(l).then(()=>{Je.update(()=>{o&&tq(n,o)})}),l}function FA(n,e,t,r=0,s=1){const i=Array.from(n).sort((c,u)=>c.sortNodePosition(u)).indexOf(e),o=n.size,a=(o-1)*r;return typeof t=="function"?t(i,o):s===1?i*r:a-i*r}function Mp(n,e,t={}){const r=$i(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:s=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(s=t.transitionOverride);const i=r?()=>Promise.all(kA(n,r,t)):()=>Promise.resolve(),o=n.variantChildren&&n.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:d}=s;return hq(n,e,l,c,u,d,t)}:()=>Promise.resolve(),{when:a}=s;if(a){const[l,c]=a==="beforeChildren"?[i,o]:[o,i];return l().then(()=>c())}else return Promise.all([i(),o(t.delay)])}function hq(n,e,t=0,r=0,s=0,i=1,o){const a=[];for(const l of n.variantChildren)l.notify("AnimationStart",e),a.push(Mp(l,e,{...o,delay:t+(typeof r=="function"?0:r)+FA(n.variantChildren,l,r,s,i)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function fq(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(i=>Mp(n,i,t));r=Promise.all(s)}else if(typeof e=="string")r=Mp(n,e,t);else{const s=typeof e=="function"?$i(n,e,t.custom):e;r=Promise.all(kA(n,s,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function LA(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const pq=Rg.length;function IA(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?IA(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<pq;t++){const r=Rg[t],s=n.props[r];($a(s)||s===!1)&&(e[r]=s)}return e}const mq=[...Cg].reverse(),gq=Cg.length;function xq(n){return e=>Promise.all(e.map(({animation:t,options:r})=>fq(n,t,r)))}function yq(n){let e=xq(n),t=uv(),r=!0;const s=l=>(c,u)=>{const d=$i(n,u,l==="exit"?n.presenceContext?.custom:void 0);if(d){const{transition:h,transitionEnd:f,...p}=d;c={...c,...p,...f}}return c};function i(l){e=l(n)}function o(l){const{props:c}=n,u=IA(n.parent)||{},d=[],h=new Set;let f={},p=1/0;for(let y=0;y<gq;y++){const x=mq[y],b=t[x],v=c[x]!==void 0?c[x]:u[x],_=$a(v),w=x===l?b.isActive:null;w===!1&&(p=y);let T=v===u[x]&&v!==c[x]&&_;if(T&&r&&n.manuallyAnimateOnMount&&(T=!1),b.protectedKeys={...f},!b.isActive&&w===null||!v&&!b.prevProp||Qu(v)||typeof v=="boolean")continue;const N=bq(b.prevProp,v);let S=N||x===l&&b.isActive&&!T&&_||y>p&&_,C=!1;const D=Array.isArray(v)?v:[v];let F=D.reduce(s(x),{});w===!1&&(F={});const{prevResolvedValues:j={}}=b,z={...j,...F},A=R=>{S=!0,h.has(R)&&(C=!0,h.delete(R)),b.needsAnimating[R]=!0;const I=n.getValue(R);I&&(I.liveStyle=!1)};for(const R in z){const I=F[R],P=j[R];if(f.hasOwnProperty(R))continue;let W=!1;Cp(I)&&Cp(P)?W=!LA(I,P):W=I!==P,W?I!=null?A(R):h.add(R):I!==void 0&&h.has(R)?A(R):b.protectedKeys[R]=!0}b.prevProp=v,b.prevResolvedValues=F,b.isActive&&(f={...f,...F}),r&&n.blockInitialAnimation&&(S=!1);const O=T&&N;S&&(!O||C)&&d.push(...D.map(R=>{const I={type:x};if(typeof R=="string"&&r&&!O&&n.manuallyAnimateOnMount&&n.parent){const{parent:P}=n,W=$i(P,R);if(P.enteringChildren&&W){const{delayChildren:L}=W.transition||{};I.delay=FA(P.enteringChildren,n,L)}}return{animation:R,options:I}}))}if(h.size){const y={};if(typeof c.initial!="boolean"){const x=$i(n,Array.isArray(c.initial)?c.initial[0]:c.initial);x&&x.transition&&(y.transition=x.transition)}h.forEach(x=>{const b=n.getBaseTarget(x),v=n.getValue(x);v&&(v.liveStyle=!0),y[x]=b??null}),d.push({animation:y})}let m=!!d.length;return r&&(c.initial===!1||c.initial===c.animate)&&!n.manuallyAnimateOnMount&&(m=!1),r=!1,m?e(d):Promise.resolve()}function a(l,c){if(t[l].isActive===c)return Promise.resolve();n.variantChildren?.forEach(d=>d.animationState?.setActive(l,c)),t[l].isActive=c;const u=o(l);for(const d in t)t[d].protectedKeys={};return u}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>t,reset:()=>{t=uv()}}}function bq(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!LA(e,n):!1}function Ns(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function uv(){return{animate:Ns(!0),whileInView:Ns(),whileHover:Ns(),whileTap:Ns(),whileDrag:Ns(),whileFocus:Ns(),exit:Ns()}}class fs{constructor(e){this.isMounted=!1,this.node=e}update(){}}class vq extends fs{constructor(e){super(e),e.animationState||(e.animationState=yq(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Qu(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let _q=0;class Tq extends fs{constructor(){super(...arguments),this.id=_q++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);t&&!e&&s.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const wq={animation:{Feature:vq},exit:{Feature:Tq}};function Ha(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function ll(n){return{point:{x:n.pageX,y:n.pageY}}}const Sq=n=>e=>Ag(e)&&n(e,ll(e));function ba(n,e,t,r){return Ha(n,e,Sq(t),r)}const OA=1e-4,Nq=1-OA,Aq=1+OA,UA=.01,Eq=0-UA,Cq=0+UA;function Gt(n){return n.max-n.min}function Rq(n,e,t){return Math.abs(n-e)<=t}function dv(n,e,t,r=.5){n.origin=r,n.originPoint=rt(e.min,e.max,n.origin),n.scale=Gt(t)/Gt(e),n.translate=rt(t.min,t.max,n.origin)-n.originPoint,(n.scale>=Nq&&n.scale<=Aq||isNaN(n.scale))&&(n.scale=1),(n.translate>=Eq&&n.translate<=Cq||isNaN(n.translate))&&(n.translate=0)}function va(n,e,t,r){dv(n.x,e.x,t.x,r?r.originX:void 0),dv(n.y,e.y,t.y,r?r.originY:void 0)}function hv(n,e,t){n.min=t.min+e.min,n.max=n.min+Gt(e)}function Mq(n,e,t){hv(n.x,e.x,t.x),hv(n.y,e.y,t.y)}function fv(n,e,t){n.min=e.min-t.min,n.max=n.min+Gt(e)}function uu(n,e,t){fv(n.x,e.x,t.x),fv(n.y,e.y,t.y)}function ln(n){return[n("x"),n("y")]}const VA=({current:n})=>n?n.ownerDocument.defaultView:null,pv=(n,e)=>Math.abs(n-e);function Pq(n,e){const t=pv(n.x,e.x),r=pv(n.y,e.y);return Math.sqrt(t**2+r**2)}class jA{constructor(e,t,{transformPagePoint:r,contextWindow:s=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Rh(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,p=Pq(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!p)return;const{point:m}=h,{timestamp:y}=At;this.history.push({...m,timestamp:y});const{onStart:x,onMove:b}=this.handlers;f||(x&&x(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Ch(f,this.transformPagePoint),Je.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:p,onSessionEnd:m,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=Rh(h.type==="pointercancel"?this.lastMoveEventInfo:Ch(f,this.transformPagePoint),this.history);this.startEvent&&p&&p(h,x),m&&m(h,x)},!Ag(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=s||window;const a=ll(e),l=Ch(a,this.transformPagePoint),{point:c}=l,{timestamp:u}=At;this.history=[{...c,timestamp:u}];const{onSessionStart:d}=t;d&&d(e,Rh(l,this.history)),this.removeListeners=il(ba(this.contextWindow,"pointermove",this.handlePointerMove),ba(this.contextWindow,"pointerup",this.handlePointerUp),ba(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),os(this.updatePoint)}}function Ch(n,e){return e?{point:e(n.point)}:n}function mv(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Rh({point:n},e){return{point:n,delta:mv(n,GA(e)),offset:mv(n,Dq(e)),velocity:Bq(e,.1)}}function Dq(n){return n[0]}function GA(n){return n[n.length-1]}function Bq(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const s=GA(n);for(;t>=0&&(r=n[t],!(s.timestamp-r.timestamp>er(e)));)t--;if(!r)return{x:0,y:0};const i=mn(s.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const o={x:(s.x-r.x)/i,y:(s.y-r.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function kq(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?rt(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?rt(t,n,r.max):Math.min(n,t)),n}function gv(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function Fq(n,{top:e,left:t,bottom:r,right:s}){return{x:gv(n.x,t,s),y:gv(n.y,e,r)}}function xv(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function Lq(n,e){return{x:xv(n.x,e.x),y:xv(n.y,e.y)}}function Iq(n,e){let t=.5;const r=Gt(n),s=Gt(e);return s>r?t=Va(e.min,e.max-r,n.min):r>s&&(t=Va(n.min,n.max-s,e.min)),kr(0,1,t)}function Oq(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Pp=.35;function Uq(n=Pp){return n===!1?n=0:n===!0&&(n=Pp),{x:yv(n,"left","right"),y:yv(n,"top","bottom")}}function yv(n,e,t){return{min:bv(n,e),max:bv(n,t)}}function bv(n,e){return typeof n=="number"?n:n[e]||0}const Vq=new WeakMap;class jq{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=bt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=d=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ll(d).point)},o=(d,h)=>{const{drag:f,dragPropagation:p,onDragStart:m}=this.getProps();if(f&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=q7(f),!this.openDragLock))return;this.latestPointerEvent=d,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ln(x=>{let b=this.getAxisMotionValue(x).get()||0;if(tr.test(b)){const{projection:v}=this.visualElement;if(v&&v.layout){const _=v.layout.layoutBox[x];_&&(b=Gt(_)*(parseFloat(b)/100))}}this.originPoint[x]=b}),m&&Je.postRender(()=>m(d,h)),Rp(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h;const{dragPropagation:f,dragDirectionLock:p,onDirectionLock:m,onDrag:y}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:x}=h;if(p&&this.currentDirection===null){this.currentDirection=Gq(x),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",h.point,x),this.updateAxis("y",h.point,x),this.visualElement.render(),y&&y(d,h)},l=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h,this.stop(d,h),this.latestPointerEvent=null,this.latestPanInfo=null},c=()=>ln(d=>this.getAnimationState(d)==="paused"&&this.getAxisMotionValue(d).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new jA(e,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:r,contextWindow:VA(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,s=t||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!s||!r)return;const{velocity:o}=s;this.startAnimation(o);const{onDragEnd:a}=this.getProps();a&&Je.postRender(()=>a(r,s))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:s}=this.getProps();if(!r||!nc(e,s,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=kq(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,s=this.constraints;e&&Mi(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=Fq(r.layoutBox,e):this.constraints=!1,this.elastic=Uq(t),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&ln(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=Oq(r.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Mi(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const i=$W(r,s.root,this.visualElement.getTransformPagePoint());let o=Lq(s.layout.layoutBox,i);if(t){const a=t(VW(o));this.hasMutatedConstraints=!!a,a&&(o=NA(a))}return o}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:s,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=ln(u=>{if(!nc(u,t,this.currentDirection))return;let d=l&&l[u]||{};o&&(d={min:0,max:0});const h=s?200:1e6,f=s?40:1e7,p={type:"inertia",velocity:r?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...i,...d};return this.startAxisValueAnimation(u,p)});return Promise.all(c).then(a)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return Rp(this.visualElement,e),r.start(Lg(e,r,0,t,this.visualElement,!1))}stopAnimation(){ln(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ln(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[t];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){ln(t=>{const{drag:r}=this.getProps();if(!nc(t,r,this.currentDirection))return;const{projection:s}=this.visualElement,i=this.getAxisMotionValue(t);if(s&&s.layout){const{min:o,max:a}=s.layout.layoutBox[t];i.set(e[t]-rt(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!Mi(t)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};ln(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();s[o]=Iq({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),ln(o=>{if(!nc(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(rt(l,c,s[o]))})}addListeners(){if(!this.visualElement.current)return;Vq.set(this.visualElement,this);const e=this.visualElement.current,t=ba(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Mi(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,i=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Je.read(r);const o=Ha(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(ln(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=l[u].translate,d.set(d.get()+l[u].translate))}),this.visualElement.render())}));return()=>{o(),t(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:i=!1,dragElastic:o=Pp,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:s,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function nc(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Gq(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class $q extends fs{constructor(e){super(e),this.removeGroupControls=xn,this.removeListeners=xn,this.controls=new jq(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||xn}unmount(){this.removeGroupControls(),this.removeListeners()}}const vv=n=>(e,t)=>{n&&Je.postRender(()=>n(e,t))};class zq extends fs{constructor(){super(...arguments),this.removePointerDownListener=xn}onPointerDown(e){this.session=new jA(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:VA(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:vv(e),onStart:vv(t),onMove:r,onEnd:(i,o)=>{delete this.session,s&&Je.postRender(()=>s(i,o))}}}mount(){this.removePointerDownListener=ba(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Sc={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function _v(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Xo={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(xe.test(n))n=parseFloat(n);else return n;const t=_v(n,e.target.x),r=_v(n,e.target.y);return`${t}% ${r}%`}},Hq={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,s=as.parse(n);if(s.length>5)return r;const i=as.createTransformer(n),o=typeof s[0]!="number"?1:0,a=t.x.scale*e.x,l=t.y.scale*e.y;s[0+o]/=a,s[1+o]/=l;const c=rt(a,l,.5);return typeof s[2+o]=="number"&&(s[2+o]/=c),typeof s[3+o]=="number"&&(s[3+o]/=c),i(s)}};let Mh=!1;class Wq extends E.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:s}=this.props,{projection:i}=e;pW(qq),i&&(t.group&&t.group.add(i),r&&r.register&&s&&r.register(i),Mh&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Sc.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:s,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,Mh=!0,s||e.layoutDependency!==t||t===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Je.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Ng.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:s}=e;Mh=!0,s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function $A(n){const[e,t]=uA(),r=E.useContext(rg);return g.jsx(Wq,{...n,layoutGroup:r,switchLayoutGroup:E.useContext(wA),isPresent:e,safeToRemove:t})}const qq={borderRadius:{...Xo,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Xo,borderTopRightRadius:Xo,borderBottomLeftRadius:Xo,borderBottomRightRadius:Xo,boxShadow:Hq};function Xq(n,e,t){const r=Ft(n)?n:ao(n);return r.start(Lg("",r,e,t)),r.animation}const Kq=(n,e)=>n.depth-e.depth;class Yq{constructor(){this.children=[],this.isDirty=!1}add(e){og(this.children,e),this.isDirty=!0}remove(e){ag(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Kq),this.isDirty=!1,this.children.forEach(e)}}function Qq(n,e){const t=Yt.now(),r=({timestamp:s})=>{const i=s-t;i>=e&&(os(r),n(i-e))};return Je.setup(r,!0),()=>os(r)}const zA=["TopLeft","TopRight","BottomLeft","BottomRight"],Zq=zA.length,Tv=n=>typeof n=="string"?parseFloat(n):n,wv=n=>typeof n=="number"||xe.test(n);function Jq(n,e,t,r,s,i){s?(n.opacity=rt(0,t.opacity??1,eX(r)),n.opacityExit=rt(e.opacity??1,0,tX(r))):i&&(n.opacity=rt(e.opacity??1,t.opacity??1,r));for(let o=0;o<Zq;o++){const a=`border${zA[o]}Radius`;let l=Sv(e,a),c=Sv(t,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||wv(l)===wv(c)?(n[a]=Math.max(rt(Tv(l),Tv(c),r),0),(tr.test(c)||tr.test(l))&&(n[a]+="%")):n[a]=c}(e.rotate||t.rotate)&&(n.rotate=rt(e.rotate||0,t.rotate||0,r))}function Sv(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const eX=HA(0,.5,MN),tX=HA(.5,.95,xn);function HA(n,e,t){return r=>r<n?0:r>e?1:t(Va(n,e,r))}function Nv(n,e){n.min=e.min,n.max=e.max}function Tn(n,e){Nv(n.x,e.x),Nv(n.y,e.y)}function Av(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function Ev(n,e,t,r,s){return n-=e,n=cu(n,1/t,r),s!==void 0&&(n=cu(n,1/s,r)),n}function nX(n,e=0,t=1,r=.5,s,i=n,o=n){if(tr.test(e)&&(e=parseFloat(e),e=rt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=rt(i.min,i.max,r);n===i&&(a-=e),n.min=Ev(n.min,e,t,a,s),n.max=Ev(n.max,e,t,a,s)}function Cv(n,e,[t,r,s],i,o){nX(n,e[t],e[r],e[s],e.scale,i,o)}const rX=["x","scaleX","originX"],sX=["y","scaleY","originY"];function Rv(n,e,t,r){Cv(n.x,e,rX,t?t.x:void 0,r?r.x:void 0),Cv(n.y,e,sX,t?t.y:void 0,r?r.y:void 0)}function Mv(n){return n.translate===0&&n.scale===1}function WA(n){return Mv(n.x)&&Mv(n.y)}function Pv(n,e){return n.min===e.min&&n.max===e.max}function iX(n,e){return Pv(n.x,e.x)&&Pv(n.y,e.y)}function Dv(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function qA(n,e){return Dv(n.x,e.x)&&Dv(n.y,e.y)}function Bv(n){return Gt(n.x)/Gt(n.y)}function kv(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class oX{constructor(){this.members=[]}add(e){og(this.members,e),e.scheduleRender()}remove(e){if(ag(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(s=>e===s);if(t===0)return!1;let r;for(let s=t;s>=0;s--){const i=this.members[s];if(i.isPresent!==!1){r=i;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function aX(n,e,t){let r="";const s=n.x.translate/e.x,i=n.y.translate/e.y,o=t?.z||0;if((s||i||o)&&(r=`translate3d(${s}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:c,rotate:u,rotateX:d,rotateY:h,skewX:f,skewY:p}=t;c&&(r=`perspective(${c}px) ${r}`),u&&(r+=`rotate(${u}deg) `),d&&(r+=`rotateX(${d}deg) `),h&&(r+=`rotateY(${h}deg) `),f&&(r+=`skewX(${f}deg) `),p&&(r+=`skewY(${p}deg) `)}const a=n.x.scale*e.x,l=n.y.scale*e.y;return(a!==1||l!==1)&&(r+=`scale(${a}, ${l})`),r||"none"}const Ph=["","X","Y","Z"],lX=1e3;let cX=0;function Dh(n,e,t,r){const{latestValues:s}=e;s[n]&&(t[n]=s[n],e.setStaticValue(n,0),r&&(r[n]=0))}function XA(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=BA(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:s,layoutId:i}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Je,!(s||i))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&XA(r)}function KA({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(o={},a=e?.()){this.id=cX++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(hX),this.nodes.forEach(gX),this.nodes.forEach(xX),this.nodes.forEach(fX)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Yq)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new ug),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=cA(o)&&!J7(o),this.instance=o;const{layoutId:a,layout:l,visualElement:c}=this.options;if(c&&!c.current&&c.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),n){let u,d=0;const h=()=>this.root.updateBlockedByResize=!1;Je.read(()=>{d=window.innerWidth}),n(o,()=>{const f=window.innerWidth;f!==d&&(d=f,this.root.updateBlockedByResize=!0,u&&u(),u=Qq(h,250),Sc.hasAnimatedSinceResize&&(Sc.hasAnimatedSinceResize=!1,this.nodes.forEach(Iv)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&c&&(a||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:d,hasRelativeLayoutChanged:h,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||c.getDefaultTransition()||TX,{onLayoutAnimationStart:m,onLayoutAnimationComplete:y}=c.getProps(),x=!this.targetLayout||!qA(this.targetLayout,f),b=!d&&h;if(this.options.layoutRoot||this.resumeFrom||b||d&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...wg(p,"layout"),onPlay:m,onComplete:y};(c.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(u,b)}else d||Iv(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),os(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(yX),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&XA(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Fv);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Lv);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(mX),this.nodes.forEach(uX),this.nodes.forEach(dX)):this.nodes.forEach(Lv),this.clearAllSnapshots();const a=Yt.now();At.delta=kr(0,1e3/60,a-At.timestamp),At.timestamp=a,At.isProcessing=!0,vh.update.process(At),vh.preRender.process(At),vh.render.process(At),At.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Ng.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(pX),this.sharedNodes.forEach(bX)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Je.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Je.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Gt(this.snapshot.measuredBox.x)&&!Gt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=bt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!WA(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&this.instance&&(a||Rs(this.latestValues)||u)&&(s(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),wX(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return bt();const a=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(SX))){const{scroll:c}=this.root;c&&(Pi(a.x,c.offset.x),Pi(a.y,c.offset.y))}return a}removeElementScroll(o){const a=bt();if(Tn(a,o),this.scroll?.wasRoot)return a;for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:d}=c;c!==this.root&&u&&d.layoutScroll&&(u.wasRoot&&Tn(a,o),Pi(a.x,u.offset.x),Pi(a.y,u.offset.y))}return a}applyTransform(o,a=!1){const l=bt();Tn(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Di(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Rs(u.latestValues)&&Di(l,u.latestValues)}return Rs(this.latestValues)&&Di(l,this.latestValues),l}removeTransform(o){const a=bt();Tn(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Rs(c.latestValues))continue;Np(c.latestValues)&&c.updateSnapshot();const u=bt(),d=c.measurePageBox();Tn(u,d),Rv(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Rs(this.latestValues)&&Rv(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==At.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(o||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:d}=this.options;if(!this.layout||!(u||d))return;this.resolvedRelativeTargetAt=At.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=bt(),this.targetWithTransforms=bt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Mq(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Tn(this.target,this.layout.layoutBox),EA(this.target,this.targetDelta)):Tn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Np(this.parent.latestValues)||AA(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,a,l){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=bt(),this.relativeTargetOrigin=bt(),uu(this.relativeTargetOrigin,a,l),Tn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),a=!!this.resumingFrom||this!==o;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===At.timestamp&&(l=!1),l)return;const{layout:c,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||u))return;Tn(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,h=this.treeScale.y;GW(this.layoutCorrected,this.treeScale,this.path,a),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=bt());const{target:f}=o;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Av(this.prevProjectionDelta.x,this.projectionDelta.x),Av(this.prevProjectionDelta.y,this.projectionDelta.y)),va(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==h||!kv(this.projectionDelta.x,this.prevProjectionDelta.x)||!kv(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Bi(),this.projectionDelta=Bi(),this.projectionDeltaWithTransform=Bi()}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},d=Bi();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=bt(),f=l?l.source:void 0,p=this.layout?this.layout.source:void 0,m=f!==p,y=this.getStack(),x=!y||y.members.length<=1,b=!!(m&&!x&&this.options.crossfade===!0&&!this.path.some(_X));this.animationProgress=0;let v;this.mixTargetDelta=_=>{const w=_/1e3;Ov(d.x,o.x,w),Ov(d.y,o.y,w),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(uu(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),vX(this.relativeTarget,this.relativeTargetOrigin,h,w),v&&iX(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=bt()),Tn(v,this.relativeTarget)),m&&(this.animationValues=u,Jq(u,c,this.latestValues,w,b,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(os(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Je.update(()=>{Sc.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ao(0)),this.currentAnimation=Xq(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(lX),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&YA(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||bt();const d=Gt(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const h=Gt(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}Tn(a,l),Di(a,u),va(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new oX),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&Dh("z",o,c,this.animationValues);for(let u=0;u<Ph.length;u++)Dh(`rotate${Ph[u]}`,o,c,this.animationValues),Dh(`skew${Ph[u]}`,o,c,this.animationValues);o.render();for(const u in c)o.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);o.scheduleRender()}applyProjectionStyles(o,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=wc(a?.pointerEvents)||"",o.transform=l?l(this.latestValues,""):"none";return}const c=this.getLead();if(!this.projectionDelta||!this.layout||!c.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=wc(a?.pointerEvents)||""),this.hasProjected&&!Rs(this.latestValues)&&(o.transform=l?l({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=c.animationValues||c.latestValues;this.applyTransformsToTarget();let d=aX(this.projectionDeltaWithTransform,this.treeScale,u);l&&(d=l(u,d)),o.transform=d;const{x:h,y:f}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${f.origin*100}% 0`,c.animationValues?o.opacity=c===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=c===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const p in za){if(u[p]===void 0)continue;const{correct:m,applyTo:y,isCSSVariable:x}=za[p],b=d==="none"?u[p]:m(u[p],c);if(y){const v=y.length;for(let _=0;_<v;_++)o[y[_]]=b}else x?this.options.visualElement.renderState.vars[p]=b:o[p]=b}this.options.layoutId&&(o.pointerEvents=c===this?wc(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(Fv),this.root.sharedNodes.clear()}}}function uX(n){n.updateLayout()}function dX(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=n.layout,{animationType:s}=n.options,i=e.source!==n.layout.source;s==="size"?ln(u=>{const d=i?e.measuredBox[u]:e.layoutBox[u],h=Gt(d);d.min=t[u].min,d.max=d.min+h}):YA(s,e.layoutBox,t)&&ln(u=>{const d=i?e.measuredBox[u]:e.layoutBox[u],h=Gt(t[u]);d.max=d.min+h,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[u].max=n.relativeTarget[u].min+h)});const o=Bi();va(o,t,e.layoutBox);const a=Bi();i?va(a,n.applyTransform(r,!0),e.measuredBox):va(a,t,e.layoutBox);const l=!WA(o);let c=!1;if(!n.resumeFrom){const u=n.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:d,layout:h}=u;if(d&&h){const f=bt();uu(f,e.layoutBox,d.layoutBox);const p=bt();uu(p,t,h.layoutBox),qA(f,p)||(c=!0),u.options.layoutRoot&&(n.relativeTarget=p,n.relativeTargetOrigin=f,n.relativeParent=u)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:a,layoutDelta:o,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function hX(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function fX(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function pX(n){n.clearSnapshot()}function Fv(n){n.clearMeasurements()}function Lv(n){n.isLayoutDirty=!1}function mX(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Iv(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function gX(n){n.resolveTargetDelta()}function xX(n){n.calcProjection()}function yX(n){n.resetSkewAndRotation()}function bX(n){n.removeLeadSnapshot()}function Ov(n,e,t){n.translate=rt(e.translate,0,t),n.scale=rt(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function Uv(n,e,t,r){n.min=rt(e.min,t.min,r),n.max=rt(e.max,t.max,r)}function vX(n,e,t,r){Uv(n.x,e.x,t.x,r),Uv(n.y,e.y,t.y,r)}function _X(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const TX={duration:.45,ease:[.4,0,.1,1]},Vv=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),jv=Vv("applewebkit/")&&!Vv("chrome/")?Math.round:xn;function Gv(n){n.min=jv(n.min),n.max=jv(n.max)}function wX(n){Gv(n.x),Gv(n.y)}function YA(n,e,t){return n==="position"||n==="preserve-aspect"&&!Rq(Bv(e),Bv(t),.2)}function SX(n){return n!==n.root&&n.scroll?.wasRoot}const NX=KA({attachResizeListener:(n,e)=>Ha(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Bh={current:void 0},QA=KA({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Bh.current){const n=new NX({});n.mount(window),n.setOptions({layoutScroll:!0}),Bh.current=n}return Bh.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),AX={pan:{Feature:zq},drag:{Feature:$q,ProjectionNode:QA,MeasureLayout:$A}};function $v(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const s="onHover"+t,i=r[s];i&&Je.postRender(()=>i(e,ll(e)))}class EX extends fs{mount(){const{current:e}=this.node;e&&(this.unmount=X7(e,(t,r)=>($v(this.node,r,"Start"),s=>$v(this.node,s,"End"))))}unmount(){}}class CX extends fs{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=il(Ha(this.node.current,"focus",()=>this.onFocus()),Ha(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function zv(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const s="onTap"+(t==="End"?"":t),i=r[s];i&&Je.postRender(()=>i(e,ll(e)))}class RX extends fs{mount(){const{current:e}=this.node;e&&(this.unmount=Z7(e,(t,r)=>(zv(this.node,r,"Start"),(s,{success:i})=>zv(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Dp=new WeakMap,kh=new WeakMap,MX=n=>{const e=Dp.get(n.target);e&&e(n)},PX=n=>{n.forEach(MX)};function DX({root:n,...e}){const t=n||document;kh.has(t)||kh.set(t,{});const r=kh.get(t),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(PX,{root:n,...e})),r[s]}function BX(n,e,t){const r=DX(e);return Dp.set(n,t),r.observe(n),()=>{Dp.delete(n),r.unobserve(n)}}const kX={some:0,all:1};class FX extends fs{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:s="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:kX[s]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=c?u:d;h&&h(l)};return BX(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(LX(e,t))&&this.startObserver()}unmount(){}}function LX({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const IX={inView:{Feature:FX},tap:{Feature:RX},focus:{Feature:CX},hover:{Feature:EX}},OX={layout:{ProjectionNode:QA,MeasureLayout:$A}},UX={...wq,...IX,...AX,...OX},Nc=UW(UX,ZW);function VX({traces:n}){return g.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 backdrop-blur-xl h-[500px] overflow-hidden flex flex-col w-full shadow-2xl",children:[g.jsxs("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[g.jsxs("h3",{className:"font-mono text-sm uppercase tracking-widest text-white/70 flex items-center gap-2",children:[g.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),"Live Neural Feed"]}),g.jsx("span",{className:"text-xs text-white/30 font-mono",children:"Real-time Ingestion"})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 relative no-scrollbar",children:[g.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(transparent_0%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_4px] opacity-20"}),g.jsx(dA,{initial:!1,children:n.map(e=>g.jsxs(Nc.div,{initial:{x:-20,opacity:0,filter:"blur(10px)"},animate:{x:0,opacity:1,filter:"blur(0px)"},exit:{opacity:0,scale:.9},transition:{type:"spring",stiffness:300,damping:30},className:`
                group relative flex items-center gap-4 p-3 rounded-lg border 
                ${e.type==="hit"?"border-emerald-500/20 bg-emerald-500/5 hover:bg-emerald-500/10":""}
                ${e.type==="miss"?"border-blue-500/20 bg-blue-500/5 hover:bg-blue-500/10":""}
                ${e.type==="error"?"border-rose-500/20 bg-rose-500/5 hover:bg-rose-500/10":""}
                transition-colors duration-300
              `,children:[g.jsx("div",{className:`
                    w-1 h-full absolute left-0 top-0 bottom-0 rounded-l-lg
                    ${e.type==="hit"?"bg-emerald-500":""}
                    ${e.type==="miss"?"bg-blue-500":""}
                    ${e.type==="error"?"bg-rose-500":""}
                    opacity-50 group-hover:opacity-100 transition-opacity
                `}),g.jsxs("div",{className:"p-2 rounded-md bg-white/5",children:[e.type==="hit"&&g.jsx(jX,{className:"w-4 h-4 text-emerald-400"}),e.type==="miss"&&g.jsx(CC,{className:"w-4 h-4 text-blue-400"}),e.type==="error"&&g.jsx(nR,{className:"w-4 h-4 text-rose-400"})]}),g.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 items-center",children:[g.jsxs("div",{className:"col-span-4",children:[g.jsx("div",{className:"text-sm font-medium text-white/90 font-mono truncate",children:e.model}),g.jsx("div",{className:"text-[10px] text-white/40 uppercase tracking-wide",children:e.id.slice(0,8)})]}),g.jsxs("div",{className:"col-span-4 flex items-center gap-2",children:[g.jsx(lR,{className:"w-3 h-3 text-white/30"}),g.jsxs("span",{className:`text-xs font-mono ${e.latency<100?"text-emerald-400":"text-amber-400"}`,children:[e.latency,"ms"]})]}),g.jsx("div",{className:"col-span-4 flex justify-end items-center gap-1",children:e.type==="hit"?g.jsxs("span",{className:"text-xs font-bold text-emerald-400 flex items-center bg-emerald-500/10 px-2 py-0.5 rounded-full",children:[g.jsx(PC,{className:"w-3 h-3"}),"SAVED"]}):g.jsxs("span",{className:"text-xs text-white/30",children:["$ ",e.cost.toFixed(5)]})})]}),g.jsx("div",{className:"absolute inset-0 rounded-lg group-hover:shadow-[0_0_20px_rgba(255,255,255,0.05)] pointer-events-none transition-shadow"})]},e.id))}),n.length===0&&g.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/20 gap-2",children:[g.jsx(_C,{className:"w-8 h-8 opacity-20"}),g.jsx("span",{className:"text-xs font-mono",children:"Awaiting Neural Signals..."})]})]})]})}function jX({className:n}){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:g.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}function ZA({children:n}){return g.jsxs("div",{className:"min-h-screen bg-[#050505] text-white selection:bg-cyan-500/30 overflow-hidden relative font-sans",children:[g.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[g.jsx("div",{className:"absolute top-0 left-1/4 w-[500px] h-[500px] bg-indigo-600/10 rounded-full blur-[120px] animate-pulse"}),g.jsx("div",{className:"absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-cyan-600/10 rounded-full blur-[120px] animate-pulse",style:{animationDelay:"2s"}}),g.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle_at_center,transparent_0%,#000000_100%)]"})]}),g.jsx("div",{className:"fixed inset-0 z-0 opacity-[0.03]",style:{backgroundImage:"linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px)",backgroundSize:"40px 40px"}}),g.jsxs("div",{className:"relative z-10 p-6 md:p-10 max-w-[1600px] mx-auto flex flex-col gap-8 h-screen",children:[g.jsxs("header",{className:"flex justify-between items-end border-b border-white/5 pb-6",children:[g.jsxs("div",{children:[g.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-white/50",children:"Neural Ops Center"}),g.jsxs("p",{className:"text-white/40 font-mono text-sm mt-1 uppercase tracking-widest",children:["System State: ",g.jsx("span",{className:"text-emerald-400",children:"Optimal"})]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsxs("div",{className:"text-right",children:[g.jsx("div",{className:"text-xs text-white/30 uppercase",children:"Region"}),g.jsx("div",{className:"font-mono text-sm text-cyan-400",children:"US-EAST-1"})]}),g.jsxs("div",{className:"text-right",children:[g.jsx("div",{className:"text-xs text-white/30 uppercase",children:"Uptime"}),g.jsx("div",{className:"font-mono text-sm text-emerald-400",children:"99.99%"})]})]})]}),g.jsx("main",{className:"flex-1 flex flex-col gap-8 min-h-0",children:n})]})]})}function GX(){const[n,e]=E.useState([]),[t,r]=E.useState(null),[s,i]=E.useState(null),[o,a]=E.useState(null),[l,c]=E.useState(!0),u=async()=>{try{const[p,m,y]=await Promise.all([fetch("/api/observability/clusters"),fetch("/api/observability/network"),fetch("/api/observability/telemetry")]),x=await p.json(),b=await m.json(),v=await y.json();Array.isArray(x)&&e(x),r(b),i(v)}catch(p){console.error("Failed to map cognitive landscape:",p)}finally{c(!1)}};E.useEffect(()=>{u();const p=setInterval(u,5e3);return()=>clearInterval(p)},[]);const d=p=>{e(m=>m.map(y=>y.id===p?{...y,state:"crystallized",color:"bg-cyan-400",value:y.value*1.5}:y))},f=s?((p,m)=>({x:(m+180)/360*100,y:(90-p)/180*100}))(s.space.latitude,s.space.longitude):{x:50,y:50};return g.jsxs("div",{className:"relative w-full h-full bg-slate-950 rounded-2xl border border-white/10 overflow-hidden shadow-2xl",children:[g.jsxs("div",{className:"absolute inset-0 opacity-20 pointer-events-none",children:[g.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"20px 20px"}}),g.jsxs("div",{className:"absolute top-[40%] left-[20%]",children:[g.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-ping absolute"}),g.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full relative"}),g.jsxs("div",{className:"text-[10px] text-emerald-500 font-mono mt-2 whitespace-nowrap",children:["SERVER_LOC: ",t?.server.region?.toUpperCase()||"SEARCHING..."]})]}),g.jsxs("svg",{className:"absolute inset-0 w-full h-full",children:[g.jsx("line",{x1:"20%",y1:"40%",x2:"50%",y2:"30%",stroke:"rgba(16, 185, 129, 0.2)",strokeWidth:"1",strokeDasharray:"5,5"}),g.jsx("line",{x1:"20%",y1:"40%",x2:"50%",y2:"60%",stroke:"rgba(16, 185, 129, 0.2)",strokeWidth:"1",strokeDasharray:"5,5"}),s&&g.jsx("line",{x1:"20%",y1:"40%",x2:`${f.x}%`,y2:`${f.y}%`,stroke:"rgba(0, 243, 255, 0.1)",strokeWidth:"1"})]})]}),s&&g.jsxs(g.Fragment,{children:[g.jsxs(Nc.div,{className:"absolute w-8 h-8 -ml-4 -mt-4 flex items-center justify-center z-10 pointer-events-none",animate:{left:`${f.x}%`,top:`${f.y}%`},transition:{duration:5,ease:"linear"},children:[g.jsx("div",{className:"absolute inset-0 border border-cyan-500/50 rounded-full animate-ping"}),g.jsx("div",{className:"bg-black/50 p-1 rounded-full border border-cyan-400 text-cyan-400",children:g.jsx(Xp,{size:12})}),g.jsxs("div",{className:"absolute top-full mt-1 text-[8px] font-mono text-cyan-500 whitespace-nowrap",children:["ISS (Alt: ",Math.round(s.space.altitude),"km)"]})]}),g.jsx("div",{className:"absolute bottom-4 left-4 p-3 bg-black/40 backdrop-blur border border-white/10 rounded-lg flex items-center gap-4 z-20",children:g.jsxs("div",{className:"flex flex-col",children:[g.jsxs("span",{className:"text-[8px] text-white/40 uppercase tracking-widest",children:["Atmosphere (",s.atmosphere.location,")"]}),g.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[g.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-mono",children:[g.jsx(oR,{size:12,className:"text-amber-400"}),s.atmosphere.temp_c,"C"]}),g.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-mono",children:[g.jsx(gR,{size:12,className:"text-blue-400"}),s.atmosphere.wind_kph,"kph"]}),g.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-mono",children:[g.jsx(AC,{size:12,className:"text-slate-400"}),s.atmosphere.humidity,"%"]})]})]})})]}),g.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3 pointer-events-none",children:[g.jsx("div",{className:"w-10 h-10 rounded-lg bg-black/50 backdrop-blur border border-white/10 flex items-center justify-center text-cyan-400",children:g.jsx(lf,{size:20})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-white font-bold text-sm tracking-widest uppercase",children:"Global Neural Map"}),g.jsx("div",{className:"flex items-center gap-2 text-white/40 text-xs font-mono",children:l?"CALIBRATING...":g.jsxs(g.Fragment,{children:[g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${t?.server.status==="operational"?"bg-emerald-500":"bg-amber-500"}`}),"SYSTEM ",t?.server.status.toUpperCase()]}),g.jsx("span",{className:"text-white/20",children:"|"}),g.jsxs("span",{children:["NET_LATENCY: ",t?.connectivity[0]?.latency||0,"ms"]})]})})]})]}),n.length===0&&!l&&g.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white/20 font-mono text-sm pointer-events-none z-20",children:"WAITING FOR NEURAL TRAFFIC..."}),n.map(p=>g.jsxs(Nc.div,{className:`absolute rounded-full cursor-grab active:cursor-grabbing flex items-center justify-center group ${p.color} bg-opacity-20 border border-white/20`,style:{left:`${p.x}%`,top:`${p.y}%`,width:Math.max(60,p.size*1.5),height:Math.max(60,p.size*1.5)},drag:!0,dragMomentum:!1,initial:{scale:0},animate:{scale:1,boxShadow:p.state==="crystallized"?"0 0 30px rgba(6,182,212,0.4)":"0 0 0 rgba(0,0,0,0)"},whileHover:{scale:1.1},onClick:()=>a(p),children:[g.jsx("div",{className:`w-3 h-3 rounded-full ${p.state==="crystallized"?"bg-white animate-pulse":p.color.replace("bg-","text-")}`}),g.jsxs("div",{className:"absolute -bottom-8 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity bg-black/80 px-2 py-1 rounded text-xs text-white pointer-events-none z-30",children:[p.label," (",p.count,")"]}),p.state==="crystallized"&&g.jsx("div",{className:"absolute inset-0 bg-[url('/assets/noise.png')] opacity-20 mix-blend-overlay rounded-full"})]},p.id)),g.jsx(dA,{children:o&&g.jsxs(Nc.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},className:"absolute right-0 top-0 bottom-0 w-80 bg-slate-900/95 backdrop-blur-xl border-l border-white/10 p-6 z-40 flex flex-col",children:[g.jsx("button",{onClick:()=>a(null),className:"absolute top-4 right-4 text-white/40 hover:text-white",children:g.jsx(W_,{size:20})}),g.jsxs("div",{className:"mt-8 mb-6",children:[g.jsx("div",{className:"text-xs text-white/40 font-mono uppercase tracking-widest mb-2",children:"Live Semantic Cluster"}),g.jsx("h2",{className:"text-2xl font-bold text-white mb-2 break-words",children:o.label}),g.jsx("div",{className:"flex items-center gap-2",children:g.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${o.state==="crystallized"?"bg-cyan-500/20 text-cyan-400":"bg-rose-500/20 text-rose-400"}`,children:o.state==="crystallized"?"Asset (Frozen)":"Liquid (Active)"})})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[g.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[g.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Trace Volume"}),g.jsx("div",{className:"text-xl font-mono text-emerald-400",children:o.count})]}),g.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5",children:[g.jsx("div",{className:"text-[10px] text-white/40 uppercase",children:"Avg Value"}),g.jsxs("div",{className:"text-xl font-mono text-white",children:["$",(o.value/(o.count||1)).toFixed(4)]})]})]}),g.jsxs("div",{className:"mt-auto",children:[o.state==="liquid"?g.jsxs("button",{onClick:()=>d(o.id),className:"w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl shadow-lg shadow-cyan-500/20 flex items-center justify-center gap-2 group transition-all",children:[g.jsx(Jg,{className:"group-hover:rotate-12 transition-transform"}),"Crystallize Intelligence"]}):g.jsxs("div",{className:"w-full py-4 bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 font-bold rounded-xl flex items-center justify-center gap-2",children:[g.jsx(Jg,{size:18}),"Asset Frozen"]}),g.jsx("p",{className:"text-[10px] text-center text-white/20 mt-3",children:"Freezing converts this logic pattern into a permanent L3 asset."})]})]})})]})}function $X(){const[n,e]=E.useState([]),[t,r]=E.useState(!0),s=async()=>{try{const a=await(await fetch("/api/observability/agents")).json();Array.isArray(a)&&e(a)}catch(o){console.error("Failed to fetch agent leaderboard:",o)}finally{r(!1)}};E.useEffect(()=>{s();const o=setInterval(s,5e3);return()=>clearInterval(o)},[]);const i=o=>o>70?"text-[var(--hud-success)]":o>30?"text-[var(--hud-accent)]":"text-[var(--hud-warning)]";return g.jsx(Ue,{title:"Top Agents",icon:$_,className:"h-full flex flex-col",children:t?g.jsx("div",{className:"flex-1 flex items-center justify-center text-[var(--hud-text-dim)] font-mono animate-pulse",children:"SCANNING NETWORK..."}):n.length===0?g.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-[var(--hud-text-dim)] font-mono opacity-50 space-y-2",children:[g.jsx(j_,{size:32}),g.jsx("span",{children:"NO ACTIVE AGENTS"})]}):g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsx(Sa,{columns:[{header:"AGENT",accessor:"name",render:o=>g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"font-bold text-white text-sm",children:o.name.toUpperCase()}),g.jsx("span",{className:"text-[10px] text-[var(--hud-text-dim)] font-mono",children:o.provider})]})},{header:"THROUGHPUT",accessor:"requests",render:o=>g.jsxs("span",{className:"font-mono text-[var(--hud-accent)]",children:[o.requests.toLocaleString()," ops"]})},{header:"LATENCY",accessor:"avgLatency",render:o=>g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(ss,{size:12,className:o.avgLatency<500?"text-[var(--hud-success)]":"text-[var(--hud-warning)]"}),g.jsxs("span",{className:"font-mono text-white text-xs",children:[o.avgLatency,"ms"]})]})},{header:"EFFICIENCY",accessor:"hitRate",render:o=>g.jsxs("div",{className:`flex items-center gap-1 font-bold ${i(o.hitRate)}`,children:[g.jsx(yu,{size:12}),g.jsxs("span",{children:[o.hitRate,"%"]})]})}],data:n})})})}function zX(){const{token:n}=Xu(),[e,t]=E.useState({requests:0,hitRate:0,tokensSaved:0,costSaved:0,latency:0}),[r,s]=E.useState([]);return E.useEffect(()=>{const i=async()=>{try{const l=await(await fetch("/api/observability/stats")).json();l.error||t(l)}catch(a){console.error("Stats Error:",a)}};i();const o=setInterval(i,5e3);return()=>clearInterval(o)},[]),E.useEffect(()=>{const i=new EventSource("/api/observability/stream");return i.onmessage=o=>{try{const a=JSON.parse(o.data);if(a.type==="traces"&&Array.isArray(a.data)){const l=a.data.map(c=>typeof c=="string"?JSON.parse(c):c);s(c=>{const u=new Set(c.map(h=>h.id)),d=l.filter(h=>!u.has(h.id));return d.length===0?c:[...d,...c].slice(0,50)})}}catch(a){console.error("Stream Parse Error:",a)}},()=>i.close()},[]),g.jsxs("div",{className:"flex flex-col gap-6 h-full pb-6",children:[g.jsxs("div",{className:"flex justify-between items-center border-b border-white/10 pb-4 px-2",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"}),g.jsx("h2",{className:"text-xl font-bold tracking-[0.2em] text-white",children:"AGENTCACHE"}),g.jsx("div",{className:"h-4 w-px bg-white/20"}),g.jsx("span",{className:"text-xs font-mono text-emerald-500 tracking-widest",children:"SYSTEM ONLINE"})]}),g.jsxs("div",{className:"flex items-center gap-8 bg-black/40 border border-white/10 rounded-full px-6 py-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[10px] text-white/40 font-mono uppercase tracking-wider",children:"Grid Status"}),g.jsx("span",{className:"text-xs text-emerald-400 font-bold font-mono",children:"OPTIMAL"})]}),g.jsx("div",{className:"w-px h-3 bg-white/10"}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[10px] text-white/40 font-mono uppercase tracking-wider",children:"Latency"}),g.jsxs("span",{className:"text-xs text-cyan-400 font-bold font-mono",children:[e.latency,"ms"]})]}),g.jsx("div",{className:"w-px h-3 bg-white/10"}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[10px] text-white/40 font-mono uppercase tracking-wider",children:"Active Agents"}),g.jsx("span",{className:"text-xs text-white font-bold font-mono",children:"8,492"})]})]}),g.jsx("div",{className:"flex items-center gap-4 text-white/40",children:g.jsxs("span",{className:"font-mono text-xs",children:[new Date().toLocaleTimeString("en-US",{hour12:!1})," UTC"]})})]}),g.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-4 gap-6",children:[g.jsx("div",{className:"lg:col-span-1 min-h-0 flex flex-col",children:g.jsx(DiscoveryFeed,{})}),g.jsx("div",{className:"lg:col-span-2 min-h-0 flex flex-col gap-4 relative",children:g.jsxs("div",{className:"flex-1 relative rounded-2xl overflow-hidden border border-white/10 bg-black/20",children:[g.jsx(GX,{}),g.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black via-black/80 to-transparent",children:g.jsx(ExperimentCard,{})})]})}),g.jsx("div",{className:"lg:col-span-1 min-h-0 flex flex-col",children:g.jsx($X,{})})]}),g.jsx("div",{className:"flex-none h-32 border-t border-white/5 pt-4",children:g.jsx(VX,{traces:r})})]})}function HX(){const[n,e]=E.useState("compression");return g.jsxs("div",{className:"flex flex-col h-full gap-6",children:[g.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 pb-4",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx(V_,{className:"text-purple-400"}),g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-bold text-white",children:"Research Lab"}),g.jsx("p",{className:"text-xs text-white/40 font-mono",children:"Experimental Features & Prototypes"})]})]}),g.jsxs("div",{className:"flex bg-black/40 rounded-lg p-1 border border-white/5",children:[g.jsx("button",{onClick:()=>e("compression"),className:`px-4 py-1.5 rounded-md text-xs font-bold font-mono transition-all ${n==="compression"?"bg-purple-500/20 text-purple-400 shadow-[0_0_10px_rgba(168,85,247,0.2)]":"text-white/40 hover:text-white"}`,children:"COMPRESSION"}),g.jsx("button",{onClick:()=>e("intelligence"),className:`px-4 py-1.5 rounded-md text-xs font-bold font-mono transition-all ${n==="intelligence"?"bg-cyan-500/20 text-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.2)]":"text-white/40 hover:text-white"}`,children:"HIVE MIND"})]})]}),n==="compression"?g.jsx(WX,{}):g.jsx(qX,{})]})}function WX(){const[n,e]=E.useState(""),[t,r]=E.useState(null),[s,i]=E.useState(!1),[o,a]=E.useState("16x"),l=async()=>{if(n){i(!0);try{const u=await(await fetch("/api/cognitive/compress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,compression_ratio:o})})).json();r(u)}catch(c){console.error(c)}i(!1)}};return g.jsxs(ZA,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-2 gap-8 p-6",children:[g.jsxs("div",{className:"flex flex-col gap-4",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("label",{className:"text-sm font-bold text-cyan-400 font-mono",children:"SOURCE DOCUMENT"}),g.jsxs("select",{value:o,onChange:c=>a(c.target.value),className:"bg-black/40 border border-white/10 rounded text-xs text-white px-2 py-1 font-mono outline-none",children:[g.jsx("option",{value:"16x",children:"16x Compression"}),g.jsx("option",{value:"32x",children:"32x Compression"}),g.jsx("option",{value:"128x",children:"128x Compression"})]})]}),g.jsx("textarea",{value:n,onChange:c=>e(c.target.value),placeholder:"Paste long context...",className:"flex-1 bg-black/20 border border-white/10 rounded-lg p-4 text-sm font-mono text-white/80 resize-none outline-none focus:border-purple-500/50 transition-colors"})]}),g.jsxs("div",{className:"flex flex-col gap-4 relative",children:[g.jsx("div",{className:"absolute top-1/2 -left-4 -translate-y-1/2 z-10 hidden lg:block",children:g.jsx("button",{onClick:l,disabled:s||!n,className:`p-3 rounded-full border border-white/10 shadow-[0_0_20px_rgba(168,85,247,0.2)] transition-all ${s?"bg-purple-500/10":"bg-black hover:bg-purple-500/20 text-purple-400"}`,children:s?g.jsx(yu,{size:24,className:"animate-spin"}):g.jsx(O_,{size:24})})}),g.jsx("div",{className:"flex justify-between items-center",children:g.jsx("label",{className:"text-sm font-bold text-purple-400 font-mono",children:"COGNITIVE MEMORY"})}),g.jsx("div",{className:`flex-1 rounded-lg border border-white/10 p-4 font-mono text-sm overflow-hidden ${t?"bg-purple-900/10 border-purple-500/30":"bg-black/20 border-dashed"}`,children:t?g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-white/90 break-all",children:t.compressed_text}),g.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 grid grid-cols-2 gap-4",children:[g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"text-[10px] text-white/40",children:"SAVED"}),g.jsxs("span",{className:"text-xl font-bold text-emerald-400",children:[t.stats.saved_tokens," tokens"]})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"text-[10px] text-white/40",children:"VALUE"}),g.jsx("span",{className:"text-xl font-bold text-white",children:t.stats.saved_cost})]})]})]}):g.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-white/20",children:[g.jsx(qi,{size:48,className:"opacity-50"}),g.jsx("p",{children:"Waiting..."})]})})]})]})}function qX(){const[n,e]=E.useState(""),[t,r]=E.useState(null),[s,i]=E.useState(!1),o=async()=>{if(n){i(!0);try{const[a,l]=await Promise.all([fetch("/api/router/route",{method:"POST",body:JSON.stringify({prompt:n})}),fetch("/api/predict",{method:"POST",body:JSON.stringify({query:n})})]),c=await a.json(),u=await l.json();r({router:c,predictions:u.predictions})}catch(a){console.error(a)}i(!1)}};return g.jsxs(ZA,{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-2 gap-8 p-6",children:[g.jsxs("div",{className:"flex flex-col gap-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"text-sm font-bold text-cyan-400 font-mono mb-2 block",children:"USER INTENT INPUT"}),g.jsxs("div",{className:"relative",children:[g.jsx("input",{type:"text",value:n,onChange:a=>e(a.target.value),onKeyDown:a=>a.key==="Enter"&&o(),placeholder:'Try "What is weather?" or "Compare quantum mechanics..."',className:"w-full bg-black/40 border border-white/10 rounded-lg p-4 pr-12 text-lg font-mono text-white outline-none focus:border-cyan-500/50 transition-colors"}),g.jsx("button",{onClick:o,className:"absolute right-2 top-2 p-2 text-cyan-400 hover:text-white transition-colors",children:s?g.jsx(ss,{className:"animate-spin"}):g.jsx(eR,{})})]})]}),g.jsxs("div",{className:"flex-1 bg-black/20 border border-white/10 rounded-lg p-4",children:[g.jsxs("h3",{className:"text-xs font-bold text-white/40 mb-4 flex items-center gap-2",children:[g.jsx(jC,{size:14})," PREDICTIVE SYNAPSE (What you might ask next)"]}),g.jsx("div",{className:"space-y-3",children:t?.predictions?t.predictions.map((a,l)=>g.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded border border-white/5",children:[g.jsx("span",{className:"text-cyan-300 font-mono text-sm",children:a.query}),g.jsxs("span",{className:"text-xs font-bold text-emerald-400",children:[(a.probability*100).toFixed(0),"%"]})]},l)):g.jsx("div",{className:"text-center text-white/20 py-8 italic",children:"Waiting for input signal..."})})]})]}),g.jsxs("div",{className:"flex flex-col gap-4",children:[g.jsx("div",{className:"text-sm font-bold text-purple-400 font-mono",children:"COGNITIVE ROUTER (System 2 Decision)"}),g.jsx("div",{className:"flex-1 bg-black/20 border border-white/10 rounded-lg p-6 relative overflow-hidden flex flex-col items-center justify-center gap-8",children:t?.router?g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"w-full text-center",children:[g.jsx("div",{className:"text-xs text-white/40 mb-2 font-mono uppercase",children:"COMPLEXITY SCORE"}),g.jsxs("div",{className:"text-4xl font-bold text-white mb-2",children:[(t.router.signals.complexity*100).toFixed(0),g.jsx("span",{className:"text-lg text-white/40",children:"/100"})]}),g.jsx("div",{className:"w-full h-2 bg-white/10 rounded-full overflow-hidden",children:g.jsx("div",{className:`h-full transition-all duration-1000 ${t.router.signals.complexity>.7?"bg-red-500":"bg-emerald-500"}`,style:{width:`${t.router.signals.complexity*100}%`}})})]}),g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsxs("div",{className:`p-4 rounded-xl border border-white/10 flex flex-col items-center gap-2 w-32 transition-all ${t.router.route==="cache"?"bg-emerald-500/20 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.3)] scale-110":"opacity-30"}`,children:[g.jsx(qi,{size:24}),g.jsx("span",{className:"text-xs font-bold",children:"CACHE"})]}),g.jsx("div",{className:"h-0.5 w-8 bg-white/10"}),g.jsxs("div",{className:`p-4 rounded-xl border border-white/10 flex flex-col items-center gap-2 w-32 transition-all ${t.router.route==="system_2"?"bg-purple-500/20 border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.3)] scale-110":"opacity-30"}`,children:[g.jsx(Qg,{size:24}),g.jsx("span",{className:"text-xs font-bold",children:"SYSTEM 2"})]})]}),g.jsxs("div",{className:"text-center font-mono text-sm text-white/60",children:["ROUTED TO: ",g.jsx("span",{className:"text-white font-bold uppercase",children:t.router.route.replace("_"," ")})]})]}):g.jsxs("div",{className:"text-center text-white/20",children:[g.jsx(Qg,{size:64,className:"mx-auto mb-4 opacity-20"}),g.jsx("div",{children:"Awaiting neural input..."})]})})]})]})}const XX=({nodes:n})=>{const e=E.useRef(null),[t,r]=E.useState({width:0,height:0});return E.useEffect(()=>{const s=()=>{if(e.current){const i=e.current.parentElement.getBoundingClientRect();r({width:i.width,height:i.height})}};return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]),E.useEffect(()=>{if(!n||n.length===0||!e.current||t.width===0)return;const s=t.width,i=t.height,o=Bt(e.current);o.selectAll("*").remove();const a=n.map(d=>{if(d.x&&d.y)return d;const h=d.id.split("").reduce((f,p)=>f+p.charCodeAt(0),0);return{...d,x:(Math.sin(h)*.4+.5)*s,y:(Math.cos(h)*.4+.5)*i,cluster:h%5}}),l=o.append("g"),c=vT().scaleExtent([.5,4]).on("zoom",d=>{l.attr("transform",d.transform)});o.call(c);const u=xm(oI);l.selectAll("circle").data(a).join("circle").attr("cx",d=>d.x).attr("cy",d=>d.y).attr("r",5).attr("fill",d=>u(d.cluster)).attr("stroke","#000").attr("stroke-width",1).attr("opacity",.8).on("mouseover",function(d,h){Bt(this).transition().duration(200).attr("r",10).attr("stroke","#fff"),l.append("text").attr("id","tooltip").attr("x",h.x+15).attr("y",h.y).text(h.name||h.key).attr("fill","#fff").style("font-size","12px").style("font-family","monospace").style("pointer-events","none").style("text-shadow","0 0 5px #000")}).on("mouseout",function(){Bt(this).transition().duration(200).attr("r",5).attr("stroke","#000"),Bt("#tooltip").remove()})},[n,t]),g.jsx("svg",{ref:e,className:"w-full h-full bg-black/40 rounded-lg"})};function KX(){const[n,e]=E.useState("activity"),[t,r]=E.useState([]),[s,i]=E.useState(!1),[o,a]=E.useState(""),[l,c]=E.useState(null);E.useEffect(()=>{n==="inspector"&&u()},[n]);const u=async()=>{i(!0);try{const f=await(await fetch("/api/explorer/nodes?limit=50")).json();f.nodes&&r(f.nodes)}catch(h){console.error(h)}finally{i(!1)}},d=async()=>{if(o.trim()){i(!0);try{const f=await(await fetch("/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o})})).json();c(f)}catch(h){c({error:h.message})}finally{i(!1)}}};return g.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col gap-6",children:[g.jsx("div",{className:"flex items-center justify-between",children:g.jsx("div",{className:"flex gap-2 bg-black/50 p-1 rounded-lg border border-[var(--hud-border)]",children:[{id:"activity",label:"Cache Activity",icon:ss},{id:"inspector",label:"Cache Inspector",icon:qi},{id:"embeddings",label:"Vector Lab",icon:Zg}].map(h=>g.jsxs("button",{onClick:()=>e(h.id),className:`px-4 py-2 rounded flex items-center gap-2 text-sm font-bold transition-all ${n===h.id?"bg-[var(--hud-accent)] text-black shadow-[0_0_10px_var(--hud-accent)]":"text-[var(--hud-text-dim)] hover:text-white hover:bg-[rgba(255,255,255,0.05)]"}`,children:[g.jsx(h.icon,{size:16}),h.label]},h.id))})}),g.jsxs("div",{className:"flex-1 overflow-hidden",children:[n==="activity"&&g.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[g.jsxs("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-6",children:[g.jsxs(Ue,{className:"bg-[rgba(0,255,128,0.05)] border-[var(--hud-success)]",children:[g.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Global Hit Rate"}),g.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-success)]",children:"94.2%"}),g.jsxs("div",{className:"text-xs text-[var(--hud-success)] mt-2 flex items-center gap-1",children:[g.jsx(O_,{size:12,className:"-rotate-45"})," +2.4% this week"]})]}),g.jsxs(Ue,{children:[g.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Data Cached"}),g.jsx("div",{className:"text-3xl font-mono font-bold text-white",children:"4.2 TB"})]}),g.jsxs(Ue,{children:[g.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Requests Served"}),g.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-accent)]",children:"8.4M"})]}),g.jsxs(Ue,{children:[g.jsx("div",{className:"text-[var(--hud-text-dim)] text-xs uppercase tracking-wider mb-1",children:"Avg Latency"}),g.jsx("div",{className:"text-3xl font-mono font-bold text-[var(--hud-accent-secondary)]",children:"12ms"})]})]}),g.jsxs(Ue,{title:"Throughput Analysis",className:"lg:col-span-2",children:[g.jsx("div",{className:"h-64 flex items-end justify-between gap-2 px-4 pb-4 border-b border-[var(--hud-border)]",children:[40,65,45,80,55,90,70].map((h,f)=>g.jsx("div",{className:"w-full bg-[var(--hud-accent)]/20 hover:bg-[var(--hud-accent)]/40 transition-colors rounded-t relative group",style:{height:`${h}%`},children:g.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-black border border-[var(--hud-border)] px-2 py-1 text-xs rounded opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10",children:[h*100," req/s"]})},f))}),g.jsxs("div",{className:"flex justify-between mt-2 text-xs text-[var(--hud-text-dim)] font-mono px-4",children:[g.jsx("span",{children:"MON"}),g.jsx("span",{children:"TUE"}),g.jsx("span",{children:"WED"}),g.jsx("span",{children:"THU"}),g.jsx("span",{children:"FRI"}),g.jsx("span",{children:"SAT"}),g.jsx("span",{children:"SUN"})]})]}),g.jsx(Ue,{title:"Top Agents",className:"lg:col-span-1",children:g.jsx(Sa,{columns:[{header:"Agent",accessor:"agent"},{header:"Ops/Sec",accessor:"ops",render:h=>g.jsx("span",{className:"text-[var(--hud-success)] font-mono",children:h.ops})}],data:[{agent:"Clinical-Bot-1",ops:"1,204"},{agent:"Trading-Alpha",ops:"940"},{agent:"Legal-Reviewer",ops:"850"},{agent:"Support-Swarm",ops:"420"}]})})]}),n==="inspector"&&g.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[g.jsx("div",{className:"lg:col-span-2 flex flex-col",children:g.jsxs(Ue,{title:"Knowledge Lattice (Public/Community)",icon:ss,className:"flex-1 relative overflow-hidden p-0",children:[g.jsx("div",{className:"absolute top-0 left-0 w-full h-full",children:g.jsx(XX,{nodes:t})}),s&&g.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-20 backdrop-blur-sm",children:g.jsx("div",{className:"text-[var(--hud-accent)] animate-pulse font-mono",children:"SCANNING SECTOR..."})})]})}),g.jsx(Ue,{title:"Node Inspector",icon:qi,className:"h-full flex flex-col",children:g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsx(Sa,{columns:[{header:"ID",accessor:"id",render:h=>g.jsxs("span",{className:"font-mono text-xs text-[var(--hud-text-dim)]",children:[h.id.substring(0,6),"..."]})},{header:"Key / Topic",accessor:"key",render:h=>g.jsx("span",{className:"text-white truncate max-w-[150px] block",children:h.key||h.prompt||"Untitled"})},{header:"Conf.",accessor:"confidence",render:h=>g.jsxs("span",{className:"text-[var(--hud-success)] font-mono",children:[(h.confidence*100).toFixed(0),"%"]})}],data:t})})})]}),n==="embeddings"&&g.jsxs("div",{className:"h-full grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in slide-in-from-bottom-4",children:[g.jsx(Ue,{title:"Vector Laboratory",icon:Zg,children:g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"text-xs text-[var(--hud-text-dim)] uppercase tracking-wider mb-2 block",children:"Input Text"}),g.jsx("textarea",{value:o,onChange:h=>a(h.target.value),className:"w-full h-32 bg-black border border-[var(--hud-border)] rounded p-3 text-sm focus:border-[var(--hud-accent)] focus:outline-none transition-colors",placeholder:"Enter text to vectorize..."})]}),g.jsxs("button",{onClick:d,disabled:s,className:"btn-cyber btn-cyber-primary w-full py-3 font-bold flex items-center justify-center gap-2",children:[s?g.jsx(uf,{className:"animate-spin",size:16}):g.jsx(uf,{size:16}),"GENERATE VECTOR"]})]})}),g.jsx(Ue,{title:"Vector Output",className:"font-mono text-xs",children:l?g.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar space-y-4",children:[g.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-[rgba(255,255,255,0.05)]",children:[g.jsx("span",{className:"text-[var(--hud-text-dim)]",children:"Status"}),g.jsx("span",{className:l.cached?"text-[var(--hud-success)]":"text-[var(--hud-warning)]",children:l.cached?"CACHE HIT":"CACHE MISS"})]}),g.jsxs("div",{children:[g.jsx("div",{className:"text-[var(--hud-text-dim)] mb-1",children:"Vector Preview (First 50 dims)"}),g.jsxs("div",{className:"p-3 rounded bg-black border border-[var(--hud-border)] text-[var(--hud-accent)] break-all leading-relaxed",children:["[",l.embedding?.slice(0,50).map(h=>h.toFixed(4)).join(", "),"...]"]})]})]}):g.jsx("div",{className:"h-full flex items-center justify-center text-[var(--hud-text-dim)] italic",children:"Waiting for input..."})})]})]})]})}const YX=[{id:"Darwin",icon:"",label:"Darwin",desc:"Survival of the fittest. High mutation, ruthless culling.",color:"text-orange-400",border:"border-orange-500/50",bg:"bg-orange-500/10"},{id:"Utopia",icon:"",label:"Utopia",desc:"High cooperation, shared rewards, altruistic caching.",color:"text-cyan-400",border:"border-cyan-500/50",bg:"bg-cyan-500/10"},{id:"WallStreet",icon:"",label:"Wall Street",desc:"Profit maximization. High competition for tokens.",color:"text-emerald-400",border:"border-emerald-500/50",bg:"bg-emerald-500/10"},{id:"ArtistColony",icon:"",label:"Artist Colony",desc:"High temperature, novelty seeking, creative risks.",color:"text-pink-400",border:"border-pink-500/50",bg:"bg-pink-500/10"},{id:"DoomerPrepper",icon:"",label:"Doomer Prepper",desc:"Extreme safety, redundancy, low risk tolerance.",color:"text-slate-400",border:"border-slate-500/50",bg:"bg-slate-500/10"}];function QX(){const{token:n}=Xu(),[e,t]=E.useState(null),[r,s]=E.useState(null),[i,o]=E.useState(!0),[a,l]=E.useState(!1);E.useEffect(()=>{if(!n)return;(async()=>{try{const d={Authorization:`Bearer ${n}`},[h,f,p,m]=await Promise.all([fetch("/api/governance/org",{headers:d}),fetch("/api/governance/members",{headers:d}),fetch("/api/governance/keys",{headers:d}),fetch("/api/governance/presets",{headers:d})]);if(!h.ok)throw new Error("Failed to fetch org data");const y=await h.json(),x=await f.json(),b=await p.json(),v=await m.json();s({...y,members:x.members||[],apiKeys:b.apiKeys||[]}),t(v.mode||"Default")}catch(d){console.error("Failed to fetch governance data:",d)}finally{o(!1)}})()},[n]);const c=async u=>{l(!0);try{(await fetch("/api/governance/presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:u,parameters:{timestamp:Date.now()}})})).ok&&t(u)}catch(d){console.error("Failed to switch mode:",d)}finally{l(!1)}};return i?g.jsx("div",{className:"p-8 text-slate-400",children:"Loading governance data..."}):g.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[g.jsxs("header",{className:"mb-8",children:[g.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:"Governance"}),g.jsxs("p",{className:"text-slate-400",children:["Organization settings, access control, and ",g.jsx("span",{className:"text-purple-400",children:"Reality Switching"}),"."]})]}),g.jsxs("section",{className:"mb-12",children:[g.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[g.jsx("span",{className:"text-purple-500",children:""})," Reality Switcher",g.jsx("span",{className:"text-xs font-normal text-slate-500 ml-2 border border-slate-700 px-2 py-0.5 rounded",children:"Global Simulation Parameters"})]}),g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:YX.map(u=>{const d=e===u.id;return g.jsxs("button",{onClick:()=>c(u.id),disabled:a,className:`relative p-4 rounded-xl border text-left transition-all ${d?`${u.bg} ${u.border} shadow-[0_0_20px_rgba(0,0,0,0.3)] scale-[1.02]`:"bg-slate-900/40 border-slate-800 hover:border-slate-600 hover:bg-slate-800/60"}`,children:[d&&g.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.8)]"}),g.jsx("div",{className:"text-2xl mb-2",children:u.icon}),g.jsx("div",{className:`font-bold mb-1 ${d?"text-white":"text-slate-300"}`,children:u.label}),g.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:u.desc})]},u.id)})})]}),g.jsx("div",{className:"border-t border-slate-800/50 my-8"}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[g.jsxs("div",{className:"lg:col-span-2 bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[g.jsxs("div",{className:"flex justify-between items-start mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-bold text-white",children:r.name}),g.jsxs("div",{className:"text-sm text-slate-500 font-mono mt-1",children:["ID: ",r.id]})]}),g.jsxs("span",{className:"px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-xs font-bold border border-purple-500/30",children:[r.plan.toUpperCase()," PLAN"]})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[g.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[g.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Your Role"}),g.jsx("div",{className:"font-semibold text-green-400",children:r.role})]}),g.jsxs("div",{className:"p-4 bg-slate-950 rounded-lg border border-slate-800",children:[g.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"Region"}),g.jsx("div",{className:"font-semibold text-white",children:"US-East (N. Virginia)"})]})]})]}),g.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"Compliance"}),g.jsxs("div",{className:"space-y-3",children:[g.jsx(Fh,{label:"SOC 2 Type II",status:"active"}),g.jsx(Fh,{label:"GDPR",status:"active"}),g.jsx(Fh,{label:"HIPAA",status:"pending"})]})]})]}),g.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6 mb-8",children:[g.jsxs("div",{className:"flex justify-between items-center mb-6",children:[g.jsx("h3",{className:"text-lg font-bold",children:"Team Members"}),g.jsx("button",{className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Invite Member"})]}),g.jsx("div",{className:"overflow-x-auto",children:g.jsxs("table",{className:"w-full text-left text-sm",children:[g.jsx("thead",{children:g.jsxs("tr",{className:"border-b border-slate-800 text-slate-400",children:[g.jsx("th",{className:"pb-3 pl-2",children:"User"}),g.jsx("th",{className:"pb-3",children:"Role"}),g.jsx("th",{className:"pb-3",children:"2FA"}),g.jsx("th",{className:"pb-3 text-right pr-2",children:"Actions"})]})}),g.jsx("tbody",{className:"divide-y divide-slate-800",children:r.members.map(u=>g.jsxs("tr",{className:"group hover:bg-slate-800/30 transition-colors",children:[g.jsxs("td",{className:"py-3 pl-2",children:[g.jsx("div",{className:"font-medium text-white",children:u.name}),g.jsx("div",{className:"text-slate-500",children:u.email})]}),g.jsx("td",{className:"py-3",children:g.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium capitalize
                      ${u.role==="owner"?"bg-purple-500/10 text-purple-400":u.role==="admin"?"bg-blue-500/10 text-blue-400":"bg-slate-700/50 text-slate-400"}`,children:u.role})}),g.jsx("td",{className:"py-3",children:g.jsx("span",{className:"text-green-400",children:"Enabled"})}),g.jsx("td",{className:"py-3 text-right pr-2",children:g.jsx("button",{className:"text-slate-500 hover:text-white",children:""})})]},u.id))})]})})]}),g.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-xl p-6",children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"Active API Keys"}),g.jsx("div",{className:"space-y-3",children:r.apiKeys.map((u,d)=>g.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950 rounded-lg border border-slate-800",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-8 h-8 rounded bg-slate-900 flex items-center justify-center text-slate-400",children:""}),g.jsxs("div",{children:[g.jsxs("div",{className:"font-mono text-sm text-white",children:[u.prefix,"****************"]}),g.jsxs("div",{className:"text-xs text-slate-500",children:["Created ",u.created]})]})]}),g.jsx("div",{className:"flex gap-2",children:u.scopes.map(h=>g.jsx("span",{className:"px-2 py-1 bg-slate-800 text-slate-300 text-xs rounded border border-slate-700",children:h},h))})]},d))})]})]})}function Fh({label:n,status:e}){const t={active:"bg-green-500",pending:"bg-yellow-500",inactive:"bg-slate-500"};return g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-sm text-slate-300",children:n}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:`w-2 h-2 rounded-full ${t[e]}`}),g.jsx("span",{className:"text-xs text-slate-500 capitalize",children:e})]})]})}function ZX(){const{user:n}=Xu(),[e,t]=E.useState("profile"),r=[{id:"profile",label:"Profile",icon:z_},{id:"api",label:"API Keys",icon:cf},{id:"team",label:"Team",icon:df},{id:"billing",label:"Billing",icon:H_}];return g.jsxs("div",{className:"flex flex-col h-full p-6 text-white overflow-hidden",children:[g.jsxs("div",{className:"flex justify-between items-center mb-6",children:[g.jsx("h2",{className:"text-2xl font-bold tracking-wide",children:"Account Settings"}),g.jsxs("div",{className:"text-sm text-white/40 font-mono",children:["ID: ",n?.id?.substring(0,8)||"Unknown"]})]}),g.jsxs("div",{className:"flex flex-1 gap-6 min-h-0",children:[g.jsx("div",{className:"w-64 flex flex-col gap-2",children:r.map(s=>g.jsxs("button",{onClick:()=>t(s.id),className:`flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-all
                                ${e===s.id?"bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 shadow-[0_0_15px_rgba(6,182,212,0.1)]":"text-white/60 hover:bg-white/5 hover:text-white"}`,children:[g.jsx(s.icon,{size:16}),s.label]},s.id))}),g.jsxs("div",{className:"flex-1 overflow-y-auto pr-2",children:[e==="profile"&&g.jsx(JX,{user:n}),e==="api"&&g.jsx(eK,{}),e==="team"&&g.jsx(tK,{}),e==="billing"&&g.jsx(nK,{})]})]})]})}function JX({user:n}){return g.jsxs("div",{className:"space-y-6",children:[g.jsx(Ue,{title:"Personal Information",icon:z_,children:g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-2",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs text-white/40 uppercase font-bold tracking-wider",children:"Display Name"}),g.jsx("input",{type:"text",defaultValue:n?.email?.split("@")[0]||"Agent Architect",className:"w-full bg-black/40 border border-white/10 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-500/50"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs text-white/40 uppercase font-bold tracking-wider",children:"Email Address"}),g.jsx("input",{type:"email",defaultValue:n?.email||"user@example.com",disabled:!0,className:"w-full bg-white/5 border border-white/5 rounded px-3 py-2 text-white/50 cursor-not-allowed"})]})]})}),g.jsx(Ue,{title:"Notifications",icon:U_,children:g.jsxs("div",{className:"space-y-4 p-2",children:[g.jsx(Lh,{label:"Security Alerts",desc:"Login attempts and policy violations",defaultChecked:!0}),g.jsx(Lh,{label:"Weekly Digest",desc:"Performance summary and efficiency report",defaultChecked:!0}),g.jsx(Lh,{label:"Product Updates",desc:"New features and changelog"})]})})]})}function eK(){return g.jsx("div",{className:"space-y-6",children:g.jsx(Ue,{title:"Active API Keys",icon:cf,children:g.jsxs("div",{className:"p-2 space-y-4",children:[g.jsxs("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded border border-white/10",children:[g.jsxs("div",{children:[g.jsx("div",{className:"font-mono text-cyan-400 font-bold",children:"sk-live-8f92...9d2a"}),g.jsx("div",{className:"text-xs text-white/40 mt-1",children:"Created 2 days ago  Last used just now"})]}),g.jsx("button",{className:"text-xs text-red-400 hover:text-red-300 border border-red-500/20 px-3 py-1.5 rounded bg-red-500/10",children:"Revoke"})]}),g.jsxs("button",{className:"w-full py-2 bg-cyan-500/10 border border-cyan-500/20 text-cyan-400 rounded hover:bg-cyan-500/20 transition-colors flex items-center justify-center gap-2 font-bold text-sm",children:[g.jsx(cf,{size:14})," Generate New Key"]})]})})})}function tK(){return g.jsx(Ue,{title:"Team Members",icon:df,children:g.jsxs("div",{className:"p-8 text-center text-white/40 text-sm font-mono",children:[g.jsx(df,{size:32,className:"mx-auto mb-4 opacity-50"}),"Invite functionality coming in v1.2"]})})}function nK(){return g.jsxs(Ue,{title:"Pro Plan",icon:H_,children:[g.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-500/20 to-cyan-500/20 border border-white/10 rounded mb-4",children:g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsxs("div",{children:[g.jsx("div",{className:"text-lg font-bold text-white",children:"AgentCache Pro"}),g.jsx("div",{className:"text-sm text-white/60",children:"$49/month"})]}),g.jsx("div",{className:"px-3 py-1 bg-emerald-500 rounded text-black font-bold text-xs uppercase",children:"Active"})]})}),g.jsx("div",{className:"text-center",children:g.jsx("button",{className:"text-white/60 hover:text-white text-sm underline",children:"Manage Subscription & Invoices"})})]})}function Lh({label:n,desc:e,defaultChecked:t}){const[r,s]=E.useState(t);return g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsxs("div",{children:[g.jsx("div",{className:"text-sm font-bold text-white",children:n}),g.jsx("div",{className:"text-xs text-white/40",children:e})]}),g.jsx("button",{onClick:()=>s(!r),className:`w-10 h-5 rounded-full relative transition-colors ${r?"bg-cyan-500":"bg-white/10"}`,children:g.jsx("div",{className:`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${r?"translate-x-5":"translate-x-0"}`})})]})}const rK=()=>{const n=()=>{const o=window.location.pathname;return o.includes("observability")?"observability":o.includes("pipeline")?"pipeline":o.includes("lab")?"lab":o.includes("data")?"data":o.includes("governance")?"governance":o.includes("settings")?"settings":"swarm"},[e,t]=E.useState(n()),{user:r,loading:s}=useAuth();if(s)return g.jsx("div",{className:"h-screen flex items-center justify-center text-[var(--hud-accent)] font-mono",children:"INITIALIZING..."});if(!r)return g.jsx(LoginOverlay,{});const i=()=>{switch(e){case"overview":return g.jsx(e0,{});case"pipeline":return g.jsx(lk,{});case"swarm":return g.jsx(iH,{});case"observability":return g.jsx(zX,{});case"lab":return g.jsx(HX,{});case"data":return g.jsx(KX,{});case"governance":return g.jsx(QX,{});case"settings":return g.jsx(ZX,{});default:return g.jsx(e0,{})}};return g.jsx(SectorProvider,{children:g.jsxs("div",{className:"flex h-screen bg-[var(--hud-bg)] text-[var(--hud-text)] overflow-hidden font-sans selection:bg-[var(--hud-accent)] selection:text-black",children:[g.jsx(_R,{activeView:e,setActiveView:t,user:r}),g.jsxs("div",{className:"flex-1 flex flex-col pl-16 transition-all duration-300",children:[g.jsx(TR,{}),g.jsxs("main",{className:"flex-1 overflow-y-auto overflow-x-hidden pt-16 p-6 relative",children:[g.jsx("div",{className:"fixed inset-0 pointer-events-none z-0 opacity-20",style:{backgroundImage:"linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),g.jsx("div",{className:"relative z-10 max-w-7xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:i()})]})]})]})})},sK=()=>g.jsx(AuthProvider,{children:g.jsx(rK,{})});BE.createRoot(document.getElementById("root")).render(g.jsx(K.StrictMode,{children:g.jsx(sK,{})}));
